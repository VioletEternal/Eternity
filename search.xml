<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>莫队</title>
      <link href="/Eternity/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/OI/mo-algo/"/>
      <url>/Eternity/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/OI/mo-algo/</url>
      
        <content type="html"><![CDATA[<p>“迷旋交错的尖针，在不同的时间流速之中，下一秒，又会指向何方？”</p><span id="more"></span><p><strong>莫队</strong>实际上是一种<strong>优化暴力</strong>的<strong>离线</strong>算法，其收集所有的询问，并统一处理。</p><p>给出文章的宏定义：</p><p>$n$ 为数列长度，$m$ 为询问个数。</p><h2 id="暴力莫队"><a href="#暴力莫队" class="headerlink" title="暴力莫队"></a>暴力莫队</h2><p>这是一个不可过的算法，时间复杂度 $\mathcal O(nm)$ 。</p><p>其实现在于：</p><p>离线后用一种方式为询问排序，一次处理，并使用 $i-1$ 区间的答案转移至 $i$ 区间。通俗的讲，就是类似于记忆化，用已经得到的答案来处理当前询问。</p><p>那么，如果需要便于处理，我们区间询问的排序方式是：</p><p>对于区间 $[l,r]$ ，以 $l$ 为第一关键字，以 $r$ 为第二关键字，从小到大。</p><p>这样可以保证每次转移时满足一定是往右转移。</p><h3 id="转移"><a href="#转移" class="headerlink" title="转移"></a>转移</h3><p>对于当前指针 $i,j$ 表示 $[l_{k-1},r_{k-1}]$ 的区间，那么，移动 $j$ 从 $r_{k-1}$ 至 $r_k$ ，并每一次加入当前数 $x_j$ ，并更新答案；然后移动 $i$ 指针至 $l_{k-1}$ ，以此更新答案直到到达区间 $[l_k,r_k]$ 。</p><p>这种转移方式类似于<strong>双指针算法</strong>。</p><h3 id="分析"><a href="#分析" class="headerlink" title="分析"></a>分析</h3><p>这样的时间复杂度依然是 $\mathcal O(nm)$ ，对于每一询问，$i,j$ 的移动次数都是 $n$ 级的。</p><hr><h2 id="基础莫队"><a href="#基础莫队" class="headerlink" title="基础莫队"></a>基础莫队</h2><p>我们需要把 $\mathcal O(nm)$ 优化到 $\mathcal O(n\sqrt n)$ ，而对于带根号的时间，就肯定会想到<strong>分块</strong>。</p><h3 id="分析-1"><a href="#分析-1" class="headerlink" title="分析"></a>分析</h3><p>更改排序方式为：</p><p>以 $bel[l]$ 为第一关键字，$r$ 为第二关键字，从小到大。<br>通俗的讲，首先排左指针的块编号，然后单调右指针。</p><p>此时的复杂度也是可以计算的：</p><p>右指针 $r$ 最多移动 $\mathcal O(n\sqrt n)$ 次，</p><p>而对于左指针：</p><ul><li>在块内，最多移动 $\mathcal O(\sqrt n)$ 次，共 $\mathcal O(m\sqrt n)$ 次；</li><li>块与块之间，共 $\mathcal O(2\sqrt n)$ 次，共 $\mathcal O(2n)$ 次。</li></ul><p>由此，时间复杂度为 $\mathcal O(m\sqrt n)$ 次。</p><p>可以证明，当块长为 $\frac{n}{\sqrt m}$ 时，时间复杂度最优。</p><p>其分析可见 <a href="https://oi-wiki.org/misc/mo-algo/#_5">$\text{OI-Wiki}$</a> 。</p><h3 id="模板"><a href="#模板" class="headerlink" title="模板"></a>模板</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">Move</span><span class="params">(<span class="type">int</span> pos,<span class="type">int</span> val)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="comment">//update res</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">Solve</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    std::<span class="built_in">sort</span>(Que+<span class="number">1</span>,Que+<span class="number">1</span>+M,cmp);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>,l=<span class="number">0</span>,r=<span class="number">0</span>;i&lt;=M;++i)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">const</span> Query &amp;q=Que[i];</span><br><span class="line">        <span class="keyword">while</span>(l&gt;q.l) <span class="built_in">Move</span>(--l,<span class="number">1</span>);</span><br><span class="line">        <span class="keyword">while</span>(r&lt;q.r) <span class="built_in">Move</span>(r++,<span class="number">1</span>);</span><br><span class="line">        <span class="keyword">while</span>(l&lt;q.l) <span class="built_in">Move</span>(l++,<span class="number">-1</span>);</span><br><span class="line">        <span class="keyword">while</span>(r&gt;q.r) <span class="built_in">Move</span>(--r,<span class="number">-1</span>);</span><br><span class="line">        ans[q.id]=res;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>如果觉得 <code>val</code> 的定义不够明确，也可以使用下列方法。</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">Move</span><span class="params">(<span class="type">int</span> pos,<span class="type">int</span> val)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="comment">//update res</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">Solve</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    std::<span class="built_in">sort</span>(Que+<span class="number">1</span>,Que+<span class="number">1</span>+M,cmp);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>,l=<span class="number">0</span>,r=<span class="number">0</span>;i&lt;=M;++i)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">const</span> Query &amp;q=Que[i];</span><br><span class="line">        <span class="keyword">while</span>(l&gt;q.l) <span class="built_in">add</span>(--l);</span><br><span class="line">        <span class="keyword">while</span>(r&lt;q.r) <span class="built_in">add</span>(r++);</span><br><span class="line">        <span class="keyword">while</span>(l&lt;q.l) <span class="built_in">del</span>(l++);</span><br><span class="line">        <span class="keyword">while</span>(r&gt;q.r) <span class="built_in">del</span>(--r);</span><br><span class="line">        ans[q.id]=res;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="例题"><a href="#例题" class="headerlink" title="例题"></a>例题</h3><h4 id="HH-的项链"><a href="#HH-的项链" class="headerlink" title="HH 的项链"></a>HH 的项链</h4><blockquote><p>给出一个长度为 $n$ 的数列 $a$ 和 $m$ 个询问：</p><p>每次询问一个区间 $[l,r]$ ，求 $[a_l,a_r]$ 中不同数字的个数。</p><p>其中 $n\leq 10^5,m\leq 2\times10^5$ 。</p></blockquote><p>其实洛谷上是有这道题的，但数据经过了加强，使普通莫队无法通过，变成了主席树的练习题，但<strong>魔改莫队算法</strong>可以过（之后会提及）。</p><p>因为 <code>Solve()</code> 是一样的，所以这里只给出 <code>Move()</code> 的写法。</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">Move</span><span class="params">(<span class="type">int</span> pos,<span class="type">int</span> val)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(!Cnt[pos]&amp;&amp;val==<span class="number">1</span>) ++res;</span><br><span class="line">   Cnt[pos]+=val;</span><br><span class="line">    <span class="keyword">if</span>(!Cnt[pos]) --res; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h4 id="P1494"><a href="#P1494" class="headerlink" title="P1494"></a><a href="https://www.luogu.com.cn/problem/P1494">P1494</a></h4><p>背到了莫队的板子之后，就只需要考虑填充 <code>add()</code> 和 <code>del()</code> 就好了。（就像是学会了树链剖分就又回到了线段树一样）</p><p>对于区间 $[i,i]$ ，答案显然是 $1$ ，然后就从当前区间推进到下一区间。</p><p>定义当前颜色为 $Col[i]$ ，第 $i$ 种颜色出现的次数为 $Cnt[i]$ ，$res$ 为当前答案。</p><p>增长区间时，更新答案 $res+=C^2_{Cnt[Col[k]]+1}-C^2_{Cnt[Col[k]]}$ ；</p><p>缩短区间时，更新答案 $res-=C^2_{Cnt[Col[k]]}-C^2_{Col[Cnt[k]]-1}$ 。</p><p>询问答案为 $\frac{res}{C^2_{r-l+1}}$</p><p>其中 $C^2_{r-l+1}=\frac{(r-l)\times(r-l+1)}{2}$ 。</p><p>且有 $C^2_{a+1}-C^2_{a}=a$ ，所以 $C^2_{Cnt[Col[ik]+1}-C^2_{Cnt[Col[k]]}=Cnt[Col[k]]$ 。</p><details>    <summary>AC Code</summary><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;ctime&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iomanip&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stack&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;map&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> gh() getchar()</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> re register</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> ll;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    x=<span class="number">0</span>;</span><br><span class="line">    <span class="type">char</span> ch=<span class="built_in">gh</span>(),t=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(ch&lt;<span class="string">&#x27;0&#x27;</span>||ch&gt;<span class="string">&#x27;9&#x27;</span>) t|=ch==<span class="string">&#x27;-&#x27;</span>,ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">while</span>(ch&gt;=<span class="string">&#x27;0&#x27;</span>&amp;&amp;ch&lt;=<span class="string">&#x27;9&#x27;</span>) x=(x&lt;&lt;<span class="number">3</span>)+(x&lt;&lt;<span class="number">1</span>)+(ch^<span class="number">48</span>),ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">if</span>(t) x=-x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T,<span class="keyword">class</span> ...T1&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x,T1 &amp;...x1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">read</span>(x),<span class="built_in">read</span>(x1...);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">write</span><span class="params">(T x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(x&lt;<span class="number">0</span>) <span class="built_in">putchar</span>(<span class="string">&#x27;-&#x27;</span>),x=-x;</span><br><span class="line">    <span class="keyword">if</span>(x&gt;<span class="number">9</span>) <span class="built_in">write</span>(x/<span class="number">10</span>);</span><br><span class="line">    <span class="built_in">putchar</span>(x%<span class="number">10</span>+<span class="string">&#x27;0&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">checkMax</span><span class="params">(T &amp;x,T &amp;y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x&lt;y?x=y,<span class="number">1</span>:<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">checkMin</span><span class="params">(T &amp;x,T &amp;y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x&gt;y?x=y,<span class="number">1</span>:<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN=<span class="number">5e4</span>+<span class="number">10</span>;</span><br><span class="line"><span class="type">int</span> N,M,Unit;</span><br><span class="line"><span class="type">int</span> Col[MAXN],Cnt[MAXN];</span><br><span class="line">ll res,ans[<span class="number">2</span>][MAXN];</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Query</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> l,r,id;</span><br><span class="line">    <span class="type">bool</span> <span class="keyword">operator</span>&lt;(<span class="type">const</span> Query &amp;x) <span class="type">const</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(l/Unit!=x.l/Unit) <span class="keyword">return</span> l&lt;x.l;</span><br><span class="line">        <span class="keyword">return</span> (l/Unit)&amp;<span class="number">1</span>?r&lt;x.r:r&gt;x.r;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;Que[MAXN];</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">add</span><span class="params">(<span class="type">int</span> pos)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    res+=Cnt[pos];++Cnt[pos];</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">del</span><span class="params">(<span class="type">int</span> pos)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    --Cnt[pos];res-=Cnt[pos];</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">ll <span class="title">Gcd</span><span class="params">(ll a,ll b)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> b==<span class="number">0</span>?a:<span class="built_in">Gcd</span>(b,a%b);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">Solve</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    std::<span class="built_in">sort</span>(Que+<span class="number">1</span>,Que+<span class="number">1</span>+M);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>,l=<span class="number">1</span>,r=<span class="number">0</span>;i&lt;=M;++i)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">auto</span> q=Que[i];</span><br><span class="line">        <span class="keyword">if</span>(q.l==q.r)</span><br><span class="line">        &#123;</span><br><span class="line">            ans[<span class="number">0</span>][q.id]=<span class="number">0</span>,ans[<span class="number">1</span>][q.id]=<span class="number">1</span>;</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">while</span>(l&gt;q.l) <span class="built_in">add</span>(Col[--l]);</span><br><span class="line">        <span class="keyword">while</span>(r&lt;q.r) <span class="built_in">add</span>(Col[++r]);</span><br><span class="line">        <span class="keyword">while</span>(l&lt;q.l) <span class="built_in">del</span>(Col[l++]);</span><br><span class="line">        <span class="keyword">while</span>(r&gt;q.r) <span class="built_in">del</span>(Col[r--]);</span><br><span class="line">        ans[<span class="number">0</span>][q.id]=res;</span><br><span class="line">        ans[<span class="number">1</span>][q.id]=<span class="number">1ll</span>*(r-l+<span class="number">1</span>)*(r-l)/<span class="number">2</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// freopen(&quot;mo-algo.in&quot;,&quot;r&quot;,stdin);</span></span><br><span class="line">    <span class="comment">// freopen(&quot;mo-algo.out&quot;,&quot;w&quot;,stdout);</span></span><br><span class="line">    <span class="built_in">read</span>(N,M);</span><br><span class="line">    Unit=<span class="built_in">sqrt</span>((<span class="type">double</span>)N*N/(<span class="type">double</span>)M);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=N;++i) <span class="built_in">read</span>(Col[i]);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=M;++i)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">read</span>(Que[i].l,Que[i].r);</span><br><span class="line">        Que[i].id=i;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">Solve</span>();</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=M;++i)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(ans[<span class="number">0</span>][i])</span><br><span class="line">        &#123;</span><br><span class="line">            ll g=<span class="built_in">Gcd</span>(ans[<span class="number">0</span>][i],ans[<span class="number">1</span>][i]);</span><br><span class="line">            ans[<span class="number">0</span>][i]/=g,ans[<span class="number">1</span>][i]/=g;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> ans[<span class="number">1</span>][i]=<span class="number">1</span>;</span><br><span class="line">        <span class="built_in">write</span>(ans[<span class="number">0</span>][i]),<span class="built_in">putchar</span>(<span class="string">&#x27;/&#x27;</span>),</span><br><span class="line">        <span class="built_in">write</span>(ans[<span class="number">1</span>][i]),<span class="built_in">puts</span>(<span class="string">&quot;&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">6 4</span></span><br><span class="line"><span class="comment">1 2 3 3 3 2</span></span><br><span class="line"><span class="comment">2 6</span></span><br><span class="line"><span class="comment">1 3</span></span><br><span class="line"><span class="comment">3 5</span></span><br><span class="line"><span class="comment">1 6</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure></details><hr><h4 id="P2709"><a href="#P2709" class="headerlink" title="P2709"></a><a href="https://www.luogu.com.cn/problem/P2709">P2709</a></h4><p>常规莫队板子，转移方程是平方差公式，应该都会：$a^2-(a-1)^2=2a-1$</p><details>    <summary>AC Code</summary><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;ctime&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iomanip&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stack&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;map&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> gh() getchar()</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> re register</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> ll;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    x=<span class="number">0</span>;</span><br><span class="line">    <span class="type">char</span> ch=<span class="built_in">gh</span>(),t=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(ch&lt;<span class="string">&#x27;0&#x27;</span>||ch&gt;<span class="string">&#x27;9&#x27;</span>) t|=ch==<span class="string">&#x27;-&#x27;</span>,ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">while</span>(ch&gt;=<span class="string">&#x27;0&#x27;</span>&amp;&amp;ch&lt;=<span class="string">&#x27;9&#x27;</span>) x=(x&lt;&lt;<span class="number">3</span>)+(x&lt;&lt;<span class="number">1</span>)+(ch^<span class="number">48</span>),ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">if</span>(t) x=-x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T,<span class="keyword">class</span> ...T1&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x,T1 &amp;...x1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">read</span>(x),<span class="built_in">read</span>(x1...);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">write</span><span class="params">(T x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(x&lt;<span class="number">0</span>) <span class="built_in">putchar</span>(<span class="string">&#x27;-&#x27;</span>),x=-x;</span><br><span class="line">    <span class="keyword">if</span>(x&gt;<span class="number">9</span>) <span class="built_in">write</span>(x/<span class="number">10</span>);</span><br><span class="line">    <span class="built_in">putchar</span>(x%<span class="number">10</span>+<span class="string">&#x27;0&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">checkMax</span><span class="params">(T &amp;x,T &amp;y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x&lt;y?x=y,<span class="number">1</span>:<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">checkMin</span><span class="params">(T &amp;x,T &amp;y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x&gt;y?x=y,<span class="number">1</span>:<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN=<span class="number">5e4</span>+<span class="number">10</span>;</span><br><span class="line"><span class="type">int</span> N,M,K,Uni;</span><br><span class="line"><span class="type">int</span> Val[MAXN],Cnt[MAXN],res;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Query</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> l,r,id;</span><br><span class="line">    <span class="type">bool</span> <span class="keyword">operator</span>&lt;(<span class="type">const</span> Query &amp;x) <span class="type">const</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(l/Uni!=x.l/Uni) <span class="keyword">return</span> l&lt;x.l;</span><br><span class="line">        <span class="keyword">return</span> (l/Uni)&amp;<span class="number">1</span>?r&lt;x.r:r&gt;x.r;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;Q[MAXN];</span><br><span class="line"><span class="type">int</span> ans[MAXN];</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">add</span><span class="params">(<span class="type">int</span> pos)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    ++Cnt[pos];</span><br><span class="line">    res+=(Cnt[pos]*<span class="number">2</span><span class="number">-1</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">del</span><span class="params">(<span class="type">int</span> pos)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    res-=(Cnt[pos]*<span class="number">2</span><span class="number">-1</span>);</span><br><span class="line">    --Cnt[pos];</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">Solve</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    std::<span class="built_in">sort</span>(Q+<span class="number">1</span>,Q+<span class="number">1</span>+M);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>,l=<span class="number">2</span>,r=<span class="number">1</span>;i&lt;=M;++i)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">auto</span> q=Q[i];</span><br><span class="line">        <span class="keyword">while</span>(l&gt;q.l) <span class="built_in">add</span>(Val[--l]);</span><br><span class="line">        <span class="keyword">while</span>(r&lt;q.r) <span class="built_in">add</span>(Val[++r]);</span><br><span class="line">        <span class="keyword">while</span>(l&lt;q.l) <span class="built_in">del</span>(Val[l++]);</span><br><span class="line">        <span class="keyword">while</span>(r&gt;q.r) <span class="built_in">del</span>(Val[r--]);</span><br><span class="line">        ans[q.id]=res;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// freopen(&quot;mo-algo.in&quot;,&quot;r&quot;,stdin);</span></span><br><span class="line">    <span class="comment">// freopen(&quot;mo-algo.out&quot;,&quot;w&quot;,stdout);</span></span><br><span class="line">    <span class="built_in">read</span>(N,M,K);</span><br><span class="line">    Uni=std::<span class="built_in">sqrt</span>((<span class="type">double</span>)N*N/(<span class="type">double</span>)M);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=N;++i) <span class="built_in">read</span>(Val[i]);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=M;++i)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">read</span>(Q[i].l,Q[i].r);</span><br><span class="line">        Q[i].id=i;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">Solve</span>();</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=M;++i) <span class="built_in">write</span>(ans[i]),<span class="built_in">puts</span>(<span class="string">&quot;&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">6 4 3</span></span><br><span class="line"><span class="comment">1 3 2 1 1 3</span></span><br><span class="line"><span class="comment">1 4</span></span><br><span class="line"><span class="comment">2 6</span></span><br><span class="line"><span class="comment">3 5</span></span><br><span class="line"><span class="comment">5 6</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure></details><hr><h3 id="奇偶化排序"><a href="#奇偶化排序" class="headerlink" title="奇偶化排序"></a>奇偶化排序</h3><p>我们已经知道了，当 $Uni=\frac{n}{\sqrt m}$ 时，莫队的复杂度应该是最优秀的。但是，仅仅从块长和单调两方面来排序的话，也是很有可能被卡掉的。</p><p>这个优化的意思是，在处理第奇数个问题时，将 $r$ 从小到大排序，而对于第偶数个问题，$r$ 从大到小，这样的话，我们在处理完一个问题时，可以到达的下一个问题的右指针是对于当前问题而言较近的。而不是为了全局最优而去舍掉局部最优。这个思路就有点像<strong>反悔贪心</strong>。用多个次优解顶替最优解。</p><p>后来这个优化被证明是正确的，其优化了 $r$ 的移动次数，在一般情况下，能够使莫队的时间复杂度降低 $30\%$ 左右。</p><p>有以下两种写法：</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> Uni;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Query</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> l,r,id;</span><br><span class="line">    <span class="type">bool</span> <span class="keyword">operator</span>&lt;(<span class="type">const</span> Query &amp;x) <span class="type">const</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> l/Uni==x.l/Uni?(r==x.r?<span class="number">0</span>:((l/Uni)&amp;<span class="number">1</span>)^(r&lt;x.r)):l&lt;x.l;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;Que[MAXN];</span><br></pre></td></tr></table></figure><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">Query</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> l,r,id;</span><br><span class="line">    <span class="type">bool</span> <span class="keyword">operator</span>&lt;(<span class="type">const</span> Query &amp;x) <span class="type">const</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(l/Uni!=x.l/Uni) <span class="keyword">return</span> l&lt;x.l;</span><br><span class="line">        <span class="keyword">return</span> (l?Uni)&amp;<span class="number">1</span>?r&lt;x.r:r&gt;x.r;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;Q[MAXN];</span><br></pre></td></tr></table></figure><p><strong>注意：</strong>这里 $r$ 和 $x.r$ 比较任何地方都不能取等，如果没有 <code>r==x.r</code> 的特判的话，因为不可以出现 $a&gt;b$ 和 $a&lt;b$ 同时成立的情况，否则会 $\text{RE}$ 。</p><hr><h3 id="后话"><a href="#后话" class="headerlink" title="后话"></a>后话</h3><p>莫队的板子实际上比较简单，但是，里面有一个非常重要的易错点，即四个 <code>while</code> 的位置。</p><p>对于 <code>l--</code> ，<code>r--</code> ，<code>l++</code> ，<code>r++</code> 四个的排列，一共 $24$ 种，而实际上正确的只有 $6$ 种，其他的方式都会出锅。所以，建议读者在理解了其中一种之后就直接背熟，然后不要更改其顺序了。</p><hr><h2 id="带修莫队"><a href="#带修莫队" class="headerlink" title="带修莫队"></a>带修莫队</h2><hr><h2 id="树上莫队"><a href="#树上莫队" class="headerlink" title="树上莫队"></a>树上莫队</h2><hr><h2 id="回滚莫队"><a href="#回滚莫队" class="headerlink" title="回滚莫队"></a>回滚莫队</h2><hr><h2 id="莫队二次离线"><a href="#莫队二次离线" class="headerlink" title="莫队二次离线"></a>莫队二次离线</h2>]]></content>
      
      
      <categories>
          
          <category> 学习笔记 </category>
          
          <category> OI </category>
          
      </categories>
      
      
        <tags>
            
            <tag> RMQ </tag>
            
            <tag> 搜索 </tag>
            
            <tag> 枚举，暴力 </tag>
            
            <tag> 数据结构 </tag>
            
            <tag> 块状链表，块状数组，分块 </tag>
            
            <tag> 双指针 </tag>
            
            <tag> 莫队 </tag>
            
            <tag> 哈希 </tag>
            
            <tag> 回滚莫队 </tag>
            
            <tag> 莫队二次离线 </tag>
            
            <tag> 第十四分块 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>堆与左偏树</title>
      <link href="/Eternity/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/OI/heap-and-leftist-tree/"/>
      <url>/Eternity/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/OI/heap-and-leftist-tree/</url>
      
        <content type="html"><![CDATA[<p>欲承之冠，以造极之锋芒；<br>俯首之势，作缄默之冷妄。</p><span id="more"></span><h2 id="堆"><a href="#堆" class="headerlink" title="堆"></a>堆</h2><p>堆是一个树型结构，拥有左儿子和右儿子。</p><p>满足性质【父结点权值大于子结点】的堆称为<strong>大根堆</strong>；<br>满足性质【父结点权值小于子结点】的堆称为<strong>小根堆</strong>。</p><p>常见的，<code>std::priority_queue</code> 的初始就是一个大根堆。（$\text{Stl}$ 大法吼啊）</p><h2 id="可并堆-配对堆"><a href="#可并堆-配对堆" class="headerlink" title="可并堆/配对堆"></a>可并堆/配对堆</h2><p>见 <a href="https://oi-wiki.org/ds/pairing-heap/">$\text{OI-Wiki}$</a> 。</p><p>说实话，堆需要学习的，就左偏树就够了。</p><h2 id="左偏树"><a href="#左偏树" class="headerlink" title="左偏树"></a>左偏树</h2><p>拥有<strong>线段树合并</strong>的部分功能，且码量极小。</p><h3 id="功能"><a href="#功能" class="headerlink" title="功能"></a>功能</h3><p>可以维护一个堆（一个集合），支持操作：</p><ol><li>插入一个数；效率 $\mathcal O(\log n)$ ；</li><li>求取最小值；效率 $\mathcal O(1)$ ；</li><li>删除最小值；（或任意值），删除最小值的效率为 $\mathcal O(\log n)$ ；</li><li>合并堆（两棵树），效率 $\mathcal O(\log n)$ 。</li></ol><p>而左偏树的特性就在于第四个操作。</p><h3 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h3><p>以小根堆为例。</p><p>左偏树的每一个结点都会维护一些信息：</p><div class="table-container"><table><thead><tr><th style="text-align:center">$val$</th><th style="text-align:center">$dist$</th></tr></thead><tbody><tr><td style="text-align:center">点权值</td><td style="text-align:center">到最近空结点的距离</td></tr></tbody></table></div><p>定义叶结点的 $dist$ 为 $1$ ，左偏树的<strong>左偏</strong>性质在于【左儿子的 $dist$ 大于右儿子的 $dist$】，即左子树比右子树更深。</p><blockquote><p>左偏树操作的复杂度与距离成正比，且 $\mathcal O(\log n)$ 为上界。</p></blockquote><p>有性质：$dist[root]\leq\mathcal O(\log n)$ 。</p><p>定义函数 $f(k)$ 表示距离为 $k$ 的点的子树至少包含了 $f(k)$ 个点。</p><p>可以知道 $f(1)=1$ ，并容易证明 $f(k)\geq 2^k-1$ 。</p><blockquote><p>假设 $n=k-1$ 时成立，证明 $n=k$ 时成立。</p><p>设 $dist[root]=k$ </p><p>则 $dist[root.rightson]=k-1$<br>且 $dist[root.leftson]\geq k-1$ </p><p>则 $f(root)=f(root.leftson)+f(root.rightson)$</p><p>则 $f(n)\geq(2^{n-1}-1)+(2^{n-1}-1)+1$ </p><p>化简得到 $f(n)\geq 2^n-1$ 。</p></blockquote><p>所以有 $dist\leq\mathcal O(\log n)$ 。</p><hr><h4 id="合并"><a href="#合并" class="headerlink" title="合并"></a>合并</h4><p>定义函数 <code>merge(a,b)</code> 为合并 $a,b$ 两棵子树并返回合并后的根结点。</p><p>首先比较 $a_{root}$ 和 $b_{root}$ 的深度，返回较小的值作为根结点，记为 $c$ 。</p><p>从 $c$ 开始向下递归，将剩下的子树（假设 $c$ 为 $a$ ，剩余 $b$）$b$ 与 $a$ 的右子树合并。并维护左偏性质，可以将 $c$ 的左右子树进行交换。</p><p>期望复杂度 $\mathcal O(dist[a]+dist[b])$ ，实际复杂度 $\mathcal O(\log n)$ 。</p><hr><h4 id="插入"><a href="#插入" class="headerlink" title="插入"></a>插入</h4><p>建立原根堆，与需要插入的数，共两个堆，并将两个堆合并。</p><hr><h4 id="删除"><a href="#删除" class="headerlink" title="删除"></a>删除</h4><p>删除根结点，并合并左子树和右子树。</p><hr><h4 id="查询极值"><a href="#查询极值" class="headerlink" title="查询极值"></a>查询极值</h4><p>直接返回根结点。</p><hr><h3 id="例题"><a href="#例题" class="headerlink" title="例题"></a>例题</h3><h4 id="P3377"><a href="#P3377" class="headerlink" title="P3377"></a><a href="https://www.luogu.com.cn/problem/P3377">P3377</a></h4><p>我们需要同时维护 $n$ 个左偏树和一套并查集以查询当前的 $(x,y)$ 的所属，并直接合并其并查代表元素。</p><p>这里的并查集与左偏树必须对应，而并查集并不支持删除操作，且左偏树在合并之后会形成一个新的左偏树，会与并查的映射偏离。如果每次删除操作重置初始化的话，时间复杂度会高达 $\mathcal O(n)$ ，有悖题意。</p><p>不过，容易想到，并查集的映射并不会影响我们左偏树的查询，所以，我们不需要去删除并查集的点，因为不会影响后续答案。</p><p>但是，我们必须保证并查集的代表元素是新左偏树的根结点，所以我们需要对并查集进行<strong>换根</strong>。这个操作只有一步，就是把原来的代表元素指向新的根结点就行了。不理解的读者可以去重修一下并查集。</p><p>对于洛谷的这道模板题，会出现一个输出 <code>-1</code> 的情况，所以给出一个 $Del[x]$ 数组表示当前数是否被删除过，即可</p><details>    <summary>AC Code</summary><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;ctime&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iomanip&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stack&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;map&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> gh() getchar()</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> re register</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> ll;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    x=<span class="number">0</span>;</span><br><span class="line">    <span class="type">char</span> ch=<span class="built_in">gh</span>(),t=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(ch&lt;<span class="string">&#x27;0&#x27;</span>||ch&gt;<span class="string">&#x27;9&#x27;</span>) t|=ch==<span class="string">&#x27;-&#x27;</span>,ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">while</span>(ch&gt;=<span class="string">&#x27;0&#x27;</span>&amp;&amp;ch&lt;=<span class="string">&#x27;9&#x27;</span>) x=(x&lt;&lt;<span class="number">3</span>)+(x&lt;&lt;<span class="number">1</span>)+(ch^<span class="number">48</span>),ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">if</span>(t) x=-x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T,<span class="keyword">class</span> ...T1&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x,T1 &amp;...x1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">read</span>(x),<span class="built_in">read</span>(x1...);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">write</span><span class="params">(T x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(x&lt;<span class="number">0</span>) <span class="built_in">putchar</span>(<span class="string">&#x27;-&#x27;</span>),x=-x;</span><br><span class="line">    <span class="keyword">if</span>(x&gt;<span class="number">9</span>) <span class="built_in">write</span>(x/<span class="number">10</span>);</span><br><span class="line">    <span class="built_in">putchar</span>(x%<span class="number">10</span>+<span class="string">&#x27;0&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">checkMax</span><span class="params">(T &amp;x,T &amp;y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x&lt;y?x=y,<span class="number">1</span>:<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">checkMin</span><span class="params">(T &amp;x,T &amp;y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x&gt;y?x=y,<span class="number">1</span>:<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN=<span class="number">2e5</span>+<span class="number">10</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> INF=<span class="number">0x3f3f3f3f</span>;</span><br><span class="line"><span class="type">int</span> N,M,Val[MAXN],Dist[MAXN];</span><br><span class="line"><span class="type">int</span> Fa[MAXN],Le[MAXN],Ri[MAXN];</span><br><span class="line"><span class="type">bool</span> Del[MAXN];</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">Cmp</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(Val[x]==Val[y]) <span class="keyword">return</span> x&lt;y;</span><br><span class="line">    <span class="keyword">return</span> Val[x]&lt;Val[y];</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">getFa</span><span class="params">(<span class="type">int</span> x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> Fa[x]==x?x:Fa[x]=<span class="built_in">getFa</span>(Fa[x]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">merge</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(!x||!y) <span class="keyword">return</span> x+y;</span><br><span class="line">    <span class="keyword">if</span>(<span class="built_in">Cmp</span>(y,x)) std::<span class="built_in">swap</span>(x,y);</span><br><span class="line">    Ri[x]=<span class="built_in">merge</span>(Ri[x],y);</span><br><span class="line">    <span class="keyword">if</span>(Dist[Ri[x]]&gt;Dist[Le[x]]) std::<span class="built_in">swap</span>(Le[x],Ri[x]);</span><br><span class="line">    Dist[x]=Dist[Ri[x]]+<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">return</span> x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// freopen(&quot;leftist-tree.in&quot;,&quot;r&quot;,stdin);</span></span><br><span class="line">    <span class="comment">// freopen(&quot;leftist-tree.out&quot;,&quot;w&quot;,stdout);</span></span><br><span class="line">    <span class="built_in">read</span>(N,M);</span><br><span class="line">    Dist[<span class="number">0</span>]=<span class="number">-1</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=N;++i) <span class="built_in">read</span>(Val[i]),Fa[i]=i;</span><br><span class="line">    <span class="keyword">while</span>(M--)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> opt;</span><br><span class="line">        <span class="built_in">read</span>(opt);</span><br><span class="line">        <span class="keyword">if</span>(opt==<span class="number">1</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="type">int</span> x,y;<span class="built_in">read</span>(x,y);</span><br><span class="line">            <span class="keyword">if</span>(Del[x]||Del[y]) <span class="keyword">continue</span>;</span><br><span class="line">            x=<span class="built_in">getFa</span>(x),y=<span class="built_in">getFa</span>(y);</span><br><span class="line">            <span class="keyword">if</span>(x!=y)Fa[x]=Fa[y]=<span class="built_in">merge</span>(x,y);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="type">int</span> x;<span class="built_in">read</span>(x);</span><br><span class="line">            <span class="keyword">if</span>(Del[x])</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="built_in">puts</span>(<span class="string">&quot;-1&quot;</span>);</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            x=<span class="built_in">getFa</span>(x);</span><br><span class="line">            Del[x]=<span class="number">1</span>;</span><br><span class="line">            <span class="built_in">write</span>(Val[x]),<span class="built_in">puts</span>(<span class="string">&quot;&quot;</span>);</span><br><span class="line">            Fa[x]=Fa[Ri[x]]=Fa[Le[x]]=<span class="built_in">merge</span>(Le[x],Ri[x]);</span><br><span class="line">            Dist[x]=Le[x]=Ri[x]=<span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">5 5</span></span><br><span class="line"><span class="comment">1 5 4 2 3</span></span><br><span class="line"><span class="comment">1 1 5</span></span><br><span class="line"><span class="comment">1 2 5</span></span><br><span class="line"><span class="comment">2 2</span></span><br><span class="line"><span class="comment">1 4 2</span></span><br><span class="line"><span class="comment">2 2</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure></details><hr><h4 id="P4331"><a href="#P4331" class="headerlink" title="P4331"></a><a href="https://www.luogu.com.cn/problem/P4331">P4331</a></h4><p>这道题的思路似乎也出奇的多，什么线段树，贪心等等。</p><p>首先，把严格递增的要求转换为非严格就会好求得多，所以设：</p><p>$a_i’=a_i+i,b_i’=b_i+i$ </p><p>根据数学知识的经验，给定一个数列 $a_i$ ，构造一个数 $b$ 使得 $\displaystyle\sum|a_i-b|$ 最小的话，$b$ 必定是 $a$ 的<strong>中位数</strong>。</p><p>那么，这道题现在就有两个情况：</p><ol><li>对于其一个子区间，其中 $a_{l\sim r}$ 单调递增，则对应 $b_{l\sim r}$ 一一对应；</li><li>对于其一个子区间，其中 $a_{l\sim r}$ 单调递减，则对应 $b_{l\sim r}$ 取中位数。</li></ol><p>所以我们将原序列拆分成若干个单调区间，然后合并。但是，对于区间与区间之间的答案可能会互相影响。</p><p>然后有一个非常离谱但是是对的的结论：</p><blockquote><p>合并两个区间并再次取出中位数。</p></blockquote><p>这点几乎所有题解都没有提及，所幸 $\text{yxc}$ 给出了证明（虽然我还是不会证），也可以参考某一篇集训队论文，也给出了证明，这道题也是改编于此。</p><p>所以我们从前往后遍历 $a$ 数列，并在线维护中位数，更新答案。</p><p>对于维护中位数，可以建立一个只有 $\lceil\frac{size}{2}\rceil$ 的大根堆，此时的堆顶就是中位数。</p><p>而区间的合并也不一定会按照顺序，所以选择用栈维护。</p><details>    <summary>AC Code</summary><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    x=<span class="number">0</span>;</span><br><span class="line">    <span class="type">char</span> ch=<span class="built_in">getchar</span>(),t=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(ch&lt;<span class="string">&#x27;0&#x27;</span>||ch&gt;<span class="string">&#x27;9&#x27;</span>) t|=ch==<span class="string">&#x27;-&#x27;</span>,ch=<span class="built_in">getchar</span>();</span><br><span class="line">    <span class="keyword">while</span>(ch&gt;=<span class="string">&#x27;0&#x27;</span>&amp;&amp;ch&lt;=<span class="string">&#x27;9&#x27;</span>) x=(x&lt;&lt;<span class="number">3</span>)+(x&lt;&lt;<span class="number">1</span>)+(ch^<span class="number">48</span>),ch=<span class="built_in">getchar</span>();</span><br><span class="line">    <span class="keyword">if</span>(t) x=-x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T,<span class="keyword">class</span> ...T1&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x,T1 &amp;...x1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">read</span>(x),<span class="built_in">read</span>(x1...);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">write</span><span class="params">(T x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(x&lt;<span class="number">0</span>) <span class="built_in">putchar</span>(<span class="string">&#x27;-&#x27;</span>),x=-x;</span><br><span class="line">    <span class="keyword">if</span>(x&gt;<span class="number">9</span>) <span class="built_in">write</span>(x/<span class="number">10</span>);</span><br><span class="line">    <span class="built_in">putchar</span>(x%<span class="number">10</span>+<span class="string">&#x27;0&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> ll;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN=<span class="number">1e6</span>+<span class="number">10</span>;</span><br><span class="line"><span class="type">int</span> N,Val[MAXN],Dist[MAXN],Le[MAXN],Ri[MAXN];</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Seg</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> end,rt,siz;</span><br><span class="line">&#125;Stk[MAXN];</span><br><span class="line"><span class="type">int</span> Top,ans[MAXN];</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">merge</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(!x||!y) <span class="keyword">return</span> x+y;</span><br><span class="line">    <span class="keyword">if</span>(Val[x]&lt;Val[y]) std::<span class="built_in">swap</span>(x,y);</span><br><span class="line">    Ri[x]=<span class="built_in">merge</span>(Ri[x],y);</span><br><span class="line">    <span class="keyword">if</span>(Dist[Ri[x]]&gt;Dist[Le[x]]) std::<span class="built_in">swap</span>(Le[x],Ri[x]);</span><br><span class="line">    Dist[x]=Dist[Ri[x]]+<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">return</span> x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">pop</span><span class="params">(<span class="type">int</span> x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">merge</span>(Le[x],Ri[x]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">read</span>(N);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=N;++i)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">read</span>(Val[i]);</span><br><span class="line">        Val[i]-=i;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=N;++i)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">auto</span> cur=(Seg)&#123;i,i,<span class="number">1</span>&#125;;Dist[i]=<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">while</span>(Top&amp;&amp;Val[cur.rt]&lt;Val[Stk[Top].rt])</span><br><span class="line">        &#123;</span><br><span class="line">            cur.rt=<span class="built_in">merge</span>(cur.rt,Stk[Top].rt);</span><br><span class="line">            <span class="keyword">if</span>(cur.siz%<span class="number">2</span>&amp;&amp;Stk[Top].siz%<span class="number">2</span>)</span><br><span class="line">                cur.rt=<span class="built_in">pop</span>(cur.rt);</span><br><span class="line">            cur.siz+=Stk[Top].siz;--Top;</span><br><span class="line">        &#125;</span><br><span class="line">        Stk[++Top]=cur;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>,j=<span class="number">1</span>;i&lt;=Top;++i)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">while</span>(j&lt;=Stk[i].end)</span><br><span class="line">            ans[j++]=Val[Stk[i].rt];</span><br><span class="line">    &#125;</span><br><span class="line">    ll res=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=N;++i) res+=std::<span class="built_in">abs</span>(Val[i]-ans[i]);</span><br><span class="line">    <span class="built_in">write</span>(res),<span class="built_in">puts</span>(<span class="string">&quot;&quot;</span>);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=N;++i) <span class="built_in">write</span>(ans[i]+i),<span class="built_in">putchar</span>(<span class="string">&#x27; &#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">5</span></span><br><span class="line"><span class="comment">2 5 46 12 1</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure></details><hr>]]></content>
      
      
      <categories>
          
          <category> 学习笔记 </category>
          
          <category> OI </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 数论 </tag>
            
            <tag> 队列 </tag>
            
            <tag> 数据结构 </tag>
            
            <tag> STL </tag>
            
            <tag> 并查集 </tag>
            
            <tag> 堆 </tag>
            
            <tag> 左偏树 </tag>
            
            <tag> 可并堆 </tag>
            
            <tag> 二叉堆 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>群论</title>
      <link href="/Eternity/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/Math/group-theory/"/>
      <url>/Eternity/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/Math/group-theory/</url>
      
        <content type="html"><![CDATA[<p>“请为一切不真实事物感到骄傲，因为我们高于这个世界！”</p><span id="more"></span><h2 id="群"><a href="#群" class="headerlink" title="群"></a>群</h2><p><strong>群</strong>（$\text{group}$）是由一个集合及一个二元运算符组成的，符合<strong>群公理</strong>的代数结构。</p><p>一般表示成 $(G,\cdot)$ ，其中 $G$ 是集合，$\cdot$ 表示一种二元运算。$G$ 中的元素 $a,b$ 所进行的运算表示为 $a\cdot b$ 。</p><h3 id="群公理"><a href="#群公理" class="headerlink" title="群公理"></a>群公理</h3><h4 id="封闭性"><a href="#封闭性" class="headerlink" title="封闭性"></a>封闭性</h4><p>满足 $\forall a,b\in G,a\cdot b\in G$ 的性质。</p><p>则有 $(\mathbb Z,+)$ 因为任何两个整数的和依然是整数，还有 $(R,\times)$ ，任意两个实数的积依然是实数。</p><hr><h4 id="结合律"><a href="#结合律" class="headerlink" title="结合律"></a>结合律</h4><p>其结合律（$\text{associativity}$）与所谓的结合律如出一辙，即：</p><p>$\forall a,b,c\in G,(a\cdot b)\cdot c=a\cdot(b\cdot c)$</p><hr><h4 id="单位元-幺元"><a href="#单位元-幺元" class="headerlink" title="单位元 / 幺元"></a>单位元 / 幺元</h4><p>在集合 $G$ 中存在元素 $e$ ，使 $\forall a\in G,e\cdot a=a\cdot e=a$ 成立，则称 $e$ 为 $G$ 是该群的单位元，也称幺元（$\text{identity element}$）。可以证明 $e$ 唯一。</p><hr><h4 id="逆元"><a href="#逆元" class="headerlink" title="逆元"></a>逆元</h4><p>对于 $G$ 中的任何一个元素 $a$ 都存在一个元素 $b\in G$ ，使 $a\cdot b=b\cdot a=e$ ，则 $b$ 为 $a$ 的逆元（$\text{inverse element}$），记作 $a^{-1}$ 。</p><hr><h4 id="生成元"><a href="#生成元" class="headerlink" title="生成元"></a>生成元</h4><p>存在一个元素 $g$ 使得群 $G$ 能够表示为 $G=\{g^0,g^1…g^k\}$ 的形式，则 $G$ 为<strong>循环群</strong>，而 $g$ 称为 $G$ 的生成元。</p><hr><h3 id="群的衍生结构"><a href="#群的衍生结构" class="headerlink" title="群的衍生结构"></a>群的衍生结构</h3><h4 id="代数系统"><a href="#代数系统" class="headerlink" title="代数系统"></a>代数系统</h4><p>满足封闭性的集合，如 $(\mathbb N,+),(R,\times)$ 。</p><hr><h4 id="半群"><a href="#半群" class="headerlink" title="半群"></a>半群</h4><p>其运算存在结合律的代数系统，称为<strong>半群</strong>（$\text{semigroup}$）。</p><hr><h4 id="幺半群（幺群）"><a href="#幺半群（幺群）" class="headerlink" title="幺半群（幺群）"></a>幺半群（幺群）</h4><p>存在单位元的半群，称为幺半群（$\text{monoid}$）。</p><p>有性质：幺群中单位元唯一。</p><blockquote><p>证明：设存在两个单位元 $e_1,e_2$</p><p>则有：$e_1=e_1e_2=e_2$ 。</p><p>$\text{Q.E.D}$</p></blockquote><hr><p><strong>左逆与右逆</strong></p><p>若存在 $xy=1$ ，则 $x$ 为 $y$ 的左逆，$y$ 为 $x$ 的右逆。</p><p>性质一：如果对于 $x$ 有 $y$ 使得 $xy=yx=1$ ，则称 $y$ 为 $x$ 的逆元。</p><p>性质二：逆元唯一。</p><hr><h4 id="群-1"><a href="#群-1" class="headerlink" title="群"></a>群</h4><p>若幺群里的每个元素都存在其逆元，则该幺群称为群。</p><p>常见的群有 $(\mathbb Z,+)$ 其中单位元是 $0$ ，元素 $a$ 的逆元是 $-a$ 。</p><hr><h4 id="阿贝尔群"><a href="#阿贝尔群" class="headerlink" title="阿贝尔群"></a>阿贝尔群</h4><p>满足交换律（$a\cdot b=b\cdot a$）的群称为<strong>阿贝尔群</strong>（$\text{Abelian group}$），又称<strong>交换群</strong>（$\text{commutative group}$）。</p><hr><h4 id="循环群"><a href="#循环群" class="headerlink" title="循环群"></a>循环群</h4><p>具有生成元的阿贝尔群称为<strong>循环群</strong>。</p><hr><h3 id="群同态"><a href="#群同态" class="headerlink" title="群同态"></a>群同态</h3><p><strong>群同态</strong>是一种保持群结构的函数。</p><p>例如：从群 $(G,\cdot)$ 到 群 $(H,\ast)$ 的同态是一个函数 $\varphi:G\to H$ 使 $\forall a,b\in G$ ，满足 $\varphi(a\cdot b)=\varphi(a)\ast\varphi(b)$</p><p>这里的 $\cdot,\varphi$ 和 $\ast$ 都并不一定是本来的含义。</p><hr><h3 id="子群"><a href="#子群" class="headerlink" title="子群"></a>子群</h3><p><strong>子群</strong>是一个被包含在更大的群 $G$ 内的一个群 $H$ ，满足：$H$ 的集合是 $G$ 集合的子集，且 $H,G$ 的操作是相同的。</p><p>其中，$G$ 的单位元素必须包含在 $H$ 中。且如果 $h_1,h_2$ 在 $H$ 中，则 $h_1\cdot h_2,h_1^{-1},h_2^{-1}$ 都应在 $H$ 中。</p><p>所以 $H$ 中的元素和在 $G$ 限制下为 $H$ 的群操作，构成了一个群体。</p><p>也有数学意义下的定义：群 $(G,\cdot)$ 中，若集合 $A\subseteq G$ ，且 $(A,\cdot)$ 是一个群。则记作 $A\le G$ ，$A$ 是 $G$ 的子群。</p><p>判断子群（判断 $A$ 是否是 $G$ 的子群）：</p><ul><li>$\varnothing\ne A\subset G$ ；</li><li>$\forall a,b\in A,ab^{-1}\in A$ 。</li></ul><p>前者突出 $A$ 和 $G$ 集合的从属关系，后者强调 $A$ 的群结构。</p><hr><h3 id="群的陪集分解"><a href="#群的陪集分解" class="headerlink" title="群的陪集分解"></a>群的陪集分解</h3><p>设群 $(G,\cdot)$ ，而有群 $H$ 为 $G$ 的子群，$g$ 为 $G$ 中元素，则：</p><ul><li>$g\cdot H=\{g\cdot h,h\in H\}$ ，为 $H$ 在 $G$ 中的<strong>左陪集</strong>（注意，指得是 $g\cdot H$ 的结果是 $H$ 的左陪集）；</li><li>$H\cdot g=\{h\cdot g,h\in H\}$ ，为 $H$ 在 $G$ 中的<strong>右陪集</strong>（注意，这里的运算并不一定满足交换律，所以顺序不能换）。</li></ul><p>这里的陪集结果是一个<strong>集合</strong>。</p><p>陪集性质：</p><ul><li>设 $H\le G$ ，且存在陪集 $a_1H,a_2H$ ，则满足 $a_1H=a_2H$ 或 $a_1H\cap a_2H$ 。</li></ul><blockquote><p>若 $a_1H\cap a_2H=\varnothing$ ，则设 $a_1h=a_2h,h\in H$ ，则有 $a_1H=bh’h^{-1}=bH$</p><p>$\operatorname{Q.E.D}$</p></blockquote><p>这是陪集一个非常重要的结论，而且这和 $\operatorname{SAM}$ 的 $endpos$ 结论如出一辙。</p><ul><li>设 $A,B$ 为 $G$ 的子群，且有 $xA=yB,x,y\in G$ ，则 $A=B$ ，且<strong>不同子群有不同陪集</strong>。</li></ul><blockquote><p>有 $xa=yb,a\in A,b\in B$ ，则 $yB=xA=yba^{-1}A=ybA$ ，则 $A=b^{-1}B=B$ 。</p><p>$\operatorname{Q.E.D}$</p></blockquote><ul><li>设 $H$ 是 $G$ 的子群，对 $G$ 进行陪集分解得到 $G=H\cup a_1H\cup … \cup a_{r-1}H$ ，则称 $r$ 为子群 $H$ 的<strong>指数</strong>（$\text{index}$），记作 $[G:H]$  。</li></ul><hr><h3 id="阶"><a href="#阶" class="headerlink" title="阶"></a>阶</h3><p>记一个群 $G$ 的阶定义为 $G$ 中包含的元素个数，表示为 $\mid G\mid$ 。</p><p>其中元素 $g\in G$ 的阶表示为使 $g^n=1$ 成立的最小正整数 $n$ 。若 $g^n\ne 1$ 恒成立，则 $g$ 为<strong>无限阶元素</strong>，否则 $g$ 为<strong>有限阶元素</strong>。</p><hr><h3 id="拉格朗日定理"><a href="#拉格朗日定理" class="headerlink" title="拉格朗日定理"></a>拉格朗日定理</h3><p>拉格朗日定理（$\text{Lagrange}$）的理论：若有 $A\le  G$ ，则 $|G|=|A|\cdot[G:A]$ 。</p><p>$\text{Lagrange}$ 定理的证明分为三步，总体思路为：构造一个等价关系，使 $H$ 的每个左陪集都是其中的等价类。</p><ul><li>构造一个二元关系 $a\sim b\Leftrightarrow ab^{-1}\in H$ ，则证明：$a\sim b$ 是 $G$ 上的等价关系。</li></ul><blockquote><p>自反性：$g\sim g:g\cdot g^{-1}=1\in G$</p><p>对称性：$\displaystyle g\sim h\Rightarrow gh^{-1}\in G\Rightarrow(gh^{-1})^{-1}=hg^{-1}\in G\Rightarrow h\sim g$</p><p>传递性：$g\sim h,h\sim i\Rightarrow gh^{-1}\in G,hi^{-1}\in G\Rightarrow gh^{-1}hi^{-1}=gi^{-1}\in G\Rightarrow g\sim i$</p></blockquote><ul><li>证明 $\sim$ 的等价类是 $H$ 的左陪集。</li></ul><blockquote><p>因为有 $b\in aH$ 时，当且仅当 $a^{-1}b\in H$ 成立。</p><p>所以有 $\sim$ 的 $[a]=aH$ 。</p></blockquote><ul><li>证明 $H$ 的所有左陪集要么 $aH=bH$ ，要么 $aH\cap bH=\varnothing$ 。</li></ul><blockquote><p>这个在<strong>陪集性质</strong>里已经证过了。</p></blockquote><p>则等价关系 $\sim$ 构成 $G$ 的一个划分。</p><p>因为每一个等价类都是一个左陪集，且陪集的元素个数表示为 $|H|$ ，所以 $|G|=$ 等价类的数量 $\times|H|$ 。</p><p>用数学公示表示为：$|G|=|A|[G:A]$ ，从而可以得到指数的新定义：$[G:H]=\frac{|G|}{|H|}$ 。</p><p>也可以写作：若 $H\le G$ ，则 $H$ 的阶整除 $G$ 的阶。（因为 $[G:H]$ 肯定是整数）</p><p>$\text{Lagrange}$ 定理推论：若 $A\le B\le G$ ，则 $[G:A]=[G:B]\cdot[B:A]$ 。</p><hr><h2 id="环"><a href="#环" class="headerlink" title="环"></a>环</h2><p>环（$\text{ring}$）是一个定义了两个二元运算 $+,\cdot$ 的集合 $S$ ，记作 $(S,+,\cdot)$。其中有：</p><ol><li>$(S,+)$ 构成交换群，单位元为 $0$ ，加法逆元是 $-a$ 。</li><li>$(S,\cdot)$ 构成半群。</li><li>混合运算符合<strong>分配律</strong>（$\text{distributivity}$），即 $a\cdot(b+c)=a\cdot b+a\cdot c$ 和 $(a+b)\cdot c=a\cdot c+b\cdot c$ 成立。</li></ol><p>在抽象代数中，研究环的分支为<strong>环论</strong>。</p><h3 id="环的衍生结构"><a href="#环的衍生结构" class="headerlink" title="环的衍生结构"></a>环的衍生结构</h3><h4 id="交换环"><a href="#交换环" class="headerlink" title="交换环"></a>交换环</h4><p>乘法满足交换律的环 $R$ 称为<strong>交换环</strong>（$\text{commutative ring}$）。</p><hr><h4 id="幺环"><a href="#幺环" class="headerlink" title="幺环"></a>幺环</h4><p>存在乘法单位元 $1$ 的环 $R$ 称为<strong>幺环</strong>（$\text{ring with identiy}$）。</p><hr><h4 id="除环"><a href="#除环" class="headerlink" title="除环"></a>除环</h4><p>环上所有非 $0$ 元素 $a$ 都存在乘法逆元 $a^{-1}$ 的环 $R$ 称为<strong>除环</strong>（$\text{division ring}$）。</p><hr><h2 id="域"><a href="#域" class="headerlink" title="域"></a>域</h2><p>域（$\text{field}$）是一种比环性质更强的代数结构，通俗地讲，域是一种<strong>交换除环</strong>。</p><p>在抽象代数中，同样存在<strong>域论</strong>的一个研究分支。</p><hr>]]></content>
      
      
      <categories>
          
          <category> 学习笔记 </category>
          
          <category> Math </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 数论 </tag>
            
            <tag> 逆元 </tag>
            
            <tag> 群论 </tag>
            
            <tag> 群 </tag>
            
            <tag> 置换 </tag>
            
            <tag> 复数 </tag>
            
            <tag> Pólya定理 </tag>
            
            <tag> 抽象代数 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>指针功</title>
      <link href="/Eternity/%E7%9F%AD%E7%AF%87%E5%B0%8F%E8%AF%B4/%E6%97%AD%E6%97%A5%E4%B8%9C%E5%8D%87%E7%9A%84%E4%BC%A0%E8%AF%B4/pointer-cult/"/>
      <url>/Eternity/%E7%9F%AD%E7%AF%87%E5%B0%8F%E8%AF%B4/%E6%97%AD%E6%97%A5%E4%B8%9C%E5%8D%87%E7%9A%84%E4%BC%A0%E8%AF%B4/pointer-cult/</url>
      
        <content type="html"><![CDATA[<div class="hbe hbe-container" id="hexo-blog-encrypt" data-wpm="Oh, this is an invalid password. Check and try again, please." data-whm="OOPS, these decrypted content may changed, but you can still have a look.">  <script id="hbeData" type="hbeData" data-hmacdigest="7e3c0f9c4c438169d04656e533cc024e00767387565b69367265e310affade8b">b2cba2151d0d2bd8ad8f075cfbfd57d50760cb19136776966c9f273df8f912df53000f3f555c93662f74a74256d873bf62f613ed95b4113aa86eb6d8d6288792db88e81137d21a45e0c1fe19b2c65ef016a2c7618a3b5cdac8f8caf7143fdf0ccf0103c6584dca7901e725e8d30319df47340c228f1550c969fdb4fa82ec5b5615506b3cd22e7462ad556df7f51addb163217f31428480d3a01067adab3d1daa275571cd5f499cbc4e0b6e823676a7f3f88585e67ed46056ec7133b85a38768e8de2d7e717201015747169f5c5537c52e1b8fa7e6398bdeec0496ce363b95f8b5a036cec89f1966820cfe76d5f25f18cdf9e4844600f497e8e6bed6ee74da97a1364faa967ebf4ac65ec99b1dd10e57eea32a549c5fb070b94dfeca339ecd1103547d5fcb69dc5d8d8d30edae51089356e5e2e487442f13b6745c9818cd9c6695e95903c15485d625c2a915d0426d3440aa94a34fa1612682b4bce2e3a29b7d4dbc069a9cc241cc57198cffd08cd0b58a7ac785ab8728b620851ebd63fffaab9656d0decd8ed01ecb187e63e8604ca27c253e04ffb773aa688ec666481fd2fab2707c4e5338963af67dbfc40c07ffd89fbab5d5a1f3b285e5991408d13cf4e5257eedf4d4fb52ba2dfc82a26eb2bee46b84d8446335c9110d87ec6a70460cf3cac2559ada99362203c6e430ab799e54d2936ce56e151969aa5739b56183b203191272286efb0b9f1ff57b2b38237cb9400cf45aad9cefc0d6d5fe42253c1c6e0d7c99432555c46ee41b48e93d86f7fd5fbdee8cdcd09649f52b2c591614d7637ee841f1991bf86d10e2c1ec16a8f362077d181b8300c3cf388d88398fc1376c1b1ef206bcd1006f8f5f497d615e54ffd6c43f41f63547d24621451f3e014f8a1fa9d5e87852c33e5e5d8e6aeecc771dcf28355726ae43010156849cb0a9499eb4efc63cfc96bc7e67f883a5939ae3951fbf58f7cd41efd69fe4120743fbe72de95e221b20aa53d3df9120ad98e9d48087e9cb1a94c6db12432c9017e8acfb1b0ceb4e7b0a4409a52f7165ef47e8cc90b498a10e4dd749a9c2e7da873c5edaeeb1e0e9a3f226670ff2e64bdd708674911aea98ce74655dbdfb360729be565f2e222cd6df85dcb07c114b0308f16d217b28491e671c2340894e755e16001a428a845604e0d741b6ff4c402fa505294e55218f6019172eceec8a5eec7b4a62b21bc4425ec718b82d4671162fa552f9ca71c1dc2aeaab412362a26b109201e55b0ce6ac1dfcfabe1c5a3b5ae47ec21a720e2b757dc9f4d01a4c403821b5d3f1bc49f7d6fda87a56418a5cbeb6a3f7c590e89adf2d6c883671cf66f3cffb2d46599e4474e06cc9c579e957b38d86163897c8ee520b2c97ae20c52cc5c796051e81e3470ed81f6f838635338662303ebd715287e9e0d073a4e30043cceb94cb77a954ace97be6245e94f630d8e3bfa9458ea3a0eb21095a4b72d9e1e7ba0d61dd793eeab7021e443f88852602d379e0d9222fa70432d5c04f0b91f244cc9e2bf8e96c105d977f3a495b34007bc2777580881fbbe622a09f8f420181031ee198bade35f400bfcb608804f7e17b25335428a14a2a019a12a3974e49b6d25972868660c69f555b52de539aa5bdf9ad9ecbbeb9b559dfabd190e9af43d5bf31a5272cc40452555ca8935fbdb3f87008d97d0c5891ba8d7c0bc1e2f4995cc9052c05eba8c61a7141cad628682b35bbf8230d1eb3937fe5ff7966883af688892a0064815a58b9262303ba67fbbaab8f5c2959bee88a25ceca695db0cc54a2bb267b2e9db59478e4a04c80130a866dca52cc0a8a9cecd60f109ac18d48714ed6a9a2130f2be299dc561983aabde2a8f92da443ded26fe5d670e5420ff1425e00e4e5a41b9bb1ad03b71b65798babf94ec5cc5b29fa5eb7a80b152404d11a5abb967f2ff7965ec3a4be9991a9ee99256d94768885dfbb676741975e5cfed85046fdb719c4f7a82684de731d6f3c1ebb1fc1121a0724025e18d2e3ac613bca416f9a9c76fb11b6dfbbe0f09c744e5fe722671be82401957ebb290b3f77ca76203bf7dd733f88134f0e57a1369c71a4659fa24bfabb05fbbe01937297104354d418c8009efb58395f95e94589ab23a709b612a71898bfdb0d9f1146a2cfaf16484fffc6d85ad764092af6d76021f39ca178fa25f446d3833833d63d1d309c2fe759897cc28c1885d74606a34fc170f5ac24d06f3e87d30592def89110cb75f20bd35582483561017b3cafead43d15d1d2871307425a91c37a4d99570bf23083e80a5ec898bba3633a01574fdf24c99b5c73c1aab6980f08995c969193aca3d35d7c68c8318fda8ab294ea51f6f47a865cae21fd9c09e18a05bc8842ec490a75b975b3d00969e6a37cc32526ba407f135263037c32cc532b7a50febb79b30d12e3d0d8d1ca5c0952e0e23f46c6c85499152d2dbe715cb2f9a07859aa067c7ac2b574bf12e0e4bee13dced52c4aca3d541153ef79c1d9c8a27b52b8d5db35a91f51bb9ee3be2d9e11f887381e4c7ec38a9a6bc305c9c238c69d18fc4e9c62e04d8b268cfdb564915ce34622721db41c4f46747f749c3e1e48f71bb8c9de7a5cfbc35a0ca57b92c2dab7738c8a7ca0a47c9b71ba9060711c3b8af5825977b0d36659f7b22d714eab49d6428aea2c28257fbe81bfaceb90816592a1e4aa749436eb04d0ed53f8066d291c59f5e5c060f76d7c955032876c05166a4ecb8cfaa0d004893462ced00eec4a637b722fa673da4d4b8a0211551d18bb91df8c57317d72e454df09ca6098ec4894ae5c7b6c502fc93b421db50ef8edee35317e77578bfe7544bb76081b7acd1eac431a6c7b61b0d445c0f8552f17dec7e2dab5f2008a2e4a09f2a69deb4b5a934a571fcb913d9e1bf6ba3e3473e1152322325ae25f8cb8178f4b000a5ba2abdc16f018722f2ea997ce56448c121de2eb8d979432f363bc9e94982e7a108ece7d706aac263b273eed32e15d4890fcc1c9ccd6663624c965327c974c4416bdc1e65dbb3888439f77050cfa37a598e44badd47629b45594af2326c2f897ea1093e5ca67980a0cd94a8a5ab30d58559ea0ba7158e8c120fa7ce4358d45eec20a4edc4e8fd9451424065d1f70d4bb3f9257661778a28753a57131d96c8d0afe5f46bf57d0bc5d7260eb374d05e6beff00ee711c9975916ef02600f2a392ec7c0656a82ab4549bef3f3fed7ea9d53a70211446fce95fee258b475faaa942548009dcc4b5700fc1d605305b245941d2b979501de807e5c1e986536e7cfb10a4a29459dd61c568b7ea1762b284a0332932d49db44b62533ab8eb9487529067d089cfb4db1e56b9404a63dbd633fbb44d6ec790284bd6fcfe5c219341c53e05fb59514f121c9fd60c03d3db3ef0ab659d4bd1c87a78550f14add8e41f17b8f66b892c4d49c964eec65afb12db510916ebc0c259ae9c201bcc1793b06a0d3a58703bf7c77eac5585ef3b704446505182abfc546d4ed97649f9560daf6a3f516ee2bc98a91b87f3ca41e73e1b514a998a5b44aac08547938426299b11f2361c9ca1f1265b128f6a5e11c7f20208d266bf6b4d11d2161676863995f29a848f78e3ac66113b65a70f1d1d9d5a78a297ae7d82c60f3cfae2b334d6062ad3786cd72eaac264d96ce549e25fc7aab15042eb60ab612478499a3097bb2633c32b16efa3f3303747ab986c499e0d28271de93987d27e5caa8a382712eb80c310f6c07279767f8763a332e89a98594792073a0ed94735992978f3505d7ff8b64a8840141accf24f79892c4fd9e56f7b5dd3cdf3829f0e49e944e1c436c3564775f093856ff87a767c5a4946f1c6a509fd318e06e8f2bd3ad866e0fdc4309fa374151cf5cdeee1403db6ed5016e17920edc7cc117c6dc7798d456ad42bd95eedfd87147925abdebe9fc7025ec3231de585c36a59acd1ce6e73d92292b563c7f8dd045fd2a69052b459f0df878f0e702b4b237278a415a820ea1c65e1fb95cb3a0586c0a31279d1f85968c06bc03a8a6c204be2953f47d459ee091327d19bdb5a375d89a52a517bd42ab6a11b4b6d79e9568b59dc8cf1f15804e8a6612de52a7312d42ba15c4419ff6040e05cc9b94ce4cba41f25c78cefc00c94e8866f668ef7e0133b39bbba26c49ce5ecb0f9f7563dc78bc15412ffceadf35079c9462102fbdd8ab3a023ab785a151b464088346a37bfda86172ec7cd5adc0b5f5f11f69bc1358821bce183a90856b5ef2a174b45d98179658482392bf21844f74e491b08c97e0aca9e82df97bb602c900ee288c48ca5ef671e6f293be5e03e235f13663812bc9298dd1be55ea85b8006024b017017a10a755c62629997fb0fcc2eb8c422620303445b75173eccb37ba619084658831e4b13e97be6ba02e48af9c8b0d889e03dbe15cabca3148a2f53b583facba4ff607c5415f17f38591efebb6659c96a64224306921ff53918ee0c659605c9071f158bc71e4de82491961cd8bdf88c8d46f93c916949e25db8e1e83d1a303742bd835bbc3f3c77ed95f2b845f41c78ed980c4d0a302917e94e6e88fe3ae65a8708935586e0d618eb2df41d6955b0f1c76c42101d724af49a3f79613a658833907cf72965f9baeeaa15fd0021c5da408d858c9761bacfea4432713f1503174b2c16d46e29b8408eaba60535cfbcdf44a5220682960677daf8741af992c7813af81a8a7015e263c9dac4c6ff297abb08bdd52970dd95549d58017851f07993d9844a690fb97c23dedbf610a32ab0f0d95d56dd52e86ccacdb972ce51486a37d61004987ed71424858c6bb3bd199cd5215759604db01c3a8dac9e1a699e1cf5248a894160740f3ddb8b2459bb37ee44f89e01163d8b62e513ac3c967b9d7c2f5f73c7dedb9f7cf64430fa1f0ad0b545d60f1a8ce6bb3e43633e98e9bd8121ece09a086cbe697cef78c3efa68ba06ccd6f56e1d336484232e500a9b94c9619e8f99230a88525cd65543e70a79e7b6cfd19aa012583a163bd56cf523b77243eca6babcb7162a9fb4ddf790d7814b9ec1d6a187208e073e89e80a99ff848227ad5c0518d40d86cd7fba5f4478582cda510b38a4342c18a0e823723da31395b905db9e8103d7443673743a023461c6bf7450b426c21d678cda825c12afb1885840719ed9c004cbacfedf2d5e16283674737b39a68b3df438bfd6e4ff2c518dba3042866c5d07500195b8315931bdf07a88bb680f8c2c2c5cc4b6f16fd5d8912354f84e52e1e2b88689d0a0e261026b9d541b917c7ce8c7ee8fe99787cedf9a0059f676ec7816cae32c85b1724e8c2597b72129d86befd33091f8edccb96fc502730a86957e37dad9f0caff73f109194f9bd65bae317dc4870cba08cd7f9bb7c2879a9d4edc789dc16f02e44a2250c7c1326bcad69dd1adc8cc081b485c0ddfc0fb0bba6f92af87c15dfd6d573550340052e3272ae64047232dd4a2b695498c4cb71cb9a165b56bcfc14e9280aecc4e74f5783b8261284e48e965a5d7a401e0f09e64f70d826556968f314a92f3728c6eb06de95d6280110f0324719eb526c2d799e02cb6ad51a5cea528f095132d9a6f2f80011e3ad5095705fbedd0d2462bae2a2a787484a089da6536e6a90ea3b30dcc8cdfcaf6fffdb26a7f8002ca2a284f58f3a29d0e6fcb13b0b7d97c46296d621f8f313ae16e479decbf50c009280ad8269a8b008f3c7e8587a4d82fe3821aff5399289cbd801504d7387aaa9a96065aedb46bfa5b5066d4ea63f51145fbf2f2447dbcb9ca44d0e6888a4d4d70d7a6b08af20b0a83ac336d37f46c801cf58993bffd93a3a5fd5df36f03d7788a358f95ce32ecce813752cc10da6f9c9953c6bd54765e33f9ef676e864e533f16cbfbb0baad48891d2ff7b28c1aa8b71648b8d9d0510f90ff51cb4c5cafbd8e197391d3f31b83281f40a05e95857a6db145c069bbb203cf4f2b751f0e7e33ca2faed00a1498eb3c47586a662caea336f7f14f095dfeff48c9293c89f9fc4aa98d458f1c2cfa488a3bfa2e47adf2de1ad89202f0b3b2695b21fc325c1593c30b6d283010989bf5332cf902170e5412d357c975a6d790aa012aae69687b89ae59070f3e4799459955561c7b884d60f38f245a038105726fc10660079955902f5461d8de05bd5fa54a1f46d258864ea00f1e7cf994581e60439cd73115c35d95b5021eb547d07ad575ff1cb61882bca8b18d6e035491a165a536ae3dcbebcb1394d9a3ba64896366cdee6436e90074b2e0d29fbcba9627104da67a7cabaa3508e5c6b33b276f33d415c9ceafec1f2a23007179981ff977db0df5f31a9f1c2962b8a29246ab0e20c6054b02d6b4247db60934fea70226ff958f81ca03964c2504b13f5a7b4b171a61b7cb122c96e948c4ee9f987ecb394cea87d218834c3a16796b775e8daca924662bed6dfba1a188655524399f00958507873ac34270db55c0600ecb15affd84bcbd11de0b6b8f1654ee0ce9c801732d3fba41e7e96b6cc6ee03556767b17cdb972c2702bd5ad7ee1c46f34de8b62993bd5f20c1ec1dd9a64fb3222e86b2fdea8a27f6b6973f53e027e575d876602584e5c35c2e4c7a7b0703bd3410e631b87f1e4c671a1fd7e49dc856855258ff7f80486577a3815e22d8442abe7aa35b8eaacad5ba5a9448301d6e62906a2b4f6fc0a0dec051f0a93f4178fcb60f93a8f9c845e7acbc818700a60e275423311775acfae1dcf4d115944a0613c8f41f119b1b6c5eb2b1597c38644f38bb7e313b79d287d229e6ebc3e92084c9ab58b33ef75daae92c4e576088ec6aae0a9c4af27efc6b081ec564cbc89fab49c52d22ebf4d9c40d8ccce49be217c4e100c8d8b8a19f83ca2655804086634afbddab21c919c27b1abffb7aeba2224ff0b09fef8756e919673449f0daa86e2d600b77807ca20a4e6a32ba4e3ebb276697c132c6668e2dccd315783a738579325ac5665dc3161070cd750d638524d8aec9787cf349779de55e9d3b30987642b663ba8fb22c4609a55c0b44d7b04ca4245dca6b1bfadc1215adb000419035f41c80a53102218abeb1c616c23e6c59cb715d103dc045a9ba0e6f7911424684bd0119241dda12980e8ed0c270f23e5e939de18df417350ceeaec9ef5596764961b86035ace972b98d6a4ae46b3017db89d78957dee7b5bcc7e1699efef936ef88999a072c2622e3b37f9594cae6d7fd75b2c7658b2a2c95506cb11973546d135dfc0999124a732d3c23c7e05a6f75d4643d658d9147707edf85f2673b303f29fb83353daaef8380be08e2a842475e647ebecd231bd0a9ff8fb7e9c1f66b4458ca337512c0eb329f8417105dab4edde48872a9f8047f9281161a9c8db8910dc929de788190927170ac015389553d68f48bfa1976c7511ce15ec9dbb997cbda46422708a042b712d399ecff8cc9f9980f6c70129d567f91d2b3fe7ecc3b61a7b653d8f052fc5c14dd2bd56b05acd1018cfa192c30ac1f4c3d1d6f03996afd122322daca8c83096244742be7d7f017ebbe5fc17d457209d8cd3ceeaa3fda2a4261eb7901a79ea3ef06ee90c024df1eac00a0ecd6b242f93575ad9ca2eab6c4c074384178ffd49ab8888af9260cd57be24af06b492b81baaa14ea6ecb320993991e9c1bbe24c74e55380365f55ed4b1b5110ca72935da4fd3efefab22c56bd80dcc5eb575ca7cb70aa4fa5f4f224c5bc853a5d18d0931049e1ac7159a82a9dffd8919d64fda0d7b169e9a5caf50136378e34d28d84ee5af6c8b8f58378e201f4b4491cab194cdf6c7b27fcd2cabf70a604161261a8de8a25ca81dac12e9d802615d2461d95f078951d5f9f33d624f0da6610e5635edbb82acb6311bb1d5e7d369c498cde7db1ad52469ba5759343128332f3f097a6f479c4abba5d1fc197c3b91647fde9cd1621f17c0182a52cad24bdf673e266e79827a452d9e9838c04311ada354402e9f970fa87ecf84ed2948db344acbe2fb3a1ba84078f4eaaee04a638498a23fd86d995a34aa5d84c2594d7e5a13c77d14954dd566fef65f149995d738b2a2218b13c2f4faa21cc0ddac58cb41774155e3d37ffe9055a8fec780a96576285d05e5cf6f78a23b29b6e6618ec6ae34693879206eb60563d51cf1ed877b9558389c336a4cf8b174e6855cc61af2fb7bdd65ae5913964e3f1e0a2c73d4561f89f2d9d6d83941a7e6ec10a23199f18d14f35b3280c7a065e657006e4c75d6b573d5c1e0a3971a9e2ae2c5092bdb8cce8e5c6b79dd938815edd97d36b3f49bb223c5f9d33751577c2d0e3c66e4cb5d08340944fb5f2e72e148fcb255b6fc804480cd3dc356f1f78d705c64f172075bdeeb09ba5556fcdb19493b40cd090f67a4982327baefdf86e883cf86eaaad3b23ea3ab62d6e665420d6783dee5543a248bbebfde4f837febe006a537eeb435a29fbd4520bf72b2e129bc8a0fd6e3bd4c917da97642dc928fd1bdbc387148cc69ec201da97cbad0a0b200209cb822a65ee3805ca0a4366795ed601084b98431d23348a90895e5d3f237b88a4b485588b911588d2f28aaba06c13837746a90ec4676abbf68efae87a7d65bda78b5405d192a93d5656424e760083b8ae4eca4b1b1f639b1674cfe796a5f9f56fc3270377b38868aa96c373bb83382cb36c4f98f03ca41a559f7338e683ff245aecdc1db5a197c881504ba28a085604b6a514b71f276fdaa5a4cf8f13d7718397ae609c597bbf98fe8bfe154a182fbc7dd7bfa67376928125ddec549d9286b385a190b4e919c7cda0485fd14744329615fcc4f889cb9b895eb150e7818edecb55dbfffc528f162d99851d06a5bb70f8bad6804a82ad9cf97939503b4aee21630af8859b0362704f76bbef354381dd8eee8a30806dcfba400110478881ed12e6d76c0e19a6d3fdb5a0ab0de61ce1480ad6f2e5f1100fff292ad0574ecf731252f39eea5ec08162a7438a7d23cae004936226de7a02e6a9be2e777c483dc2291cbc999396cd5086c9e520cafd8e63ca7275e4761746ca2dad1baf76235fb8cdbc29b3336cbe9e95957b9d5a9568c09c6dd0b3daa22293f90c03513d6c006187366f25da8c3effe96194d736e530fe12eab6ba2dacb3f7f26e78a31bcbe977ed5432ab07343733d0d8c10d67fe87683027c21751e4b636549ac4354865b7e52dbde2b94cfba49407924dba14d9432f0c1165eaffb3d8708922fc49649f2407d0f02e024b783d00d134ffc868837ae5e34dc5b664f1245622a189e989d40f17f22051232e710f23db6ce6057a4da4c</script>  <div class="hbe hbe-content">    <div class="hbe hbe-input hbe-input-xray">      <input class="hbe hbe-input-field hbe-input-field-xray" type="password" id="hbePass">      <label class="hbe hbe-input-label hbe-input-label-xray" for="hbePass">        <span class="hbe hbe-input-label-content hbe-input-label-content-xray">Eternalにはいくつかの秘密があります。</span>      </label>      <svg class="hbe hbe-graphic hbe-graphic-xray" width="300%" height="100%" viewBox="0 0 1200 60" preserveAspectRatio="none">        <path d="M0,56.5c0,0,298.666,0,399.333,0C448.336,56.5,513.994,46,597,46c77.327,0,135,10.5,200.999,10.5c95.996,0,402.001,0,402.001,0"></path>        <path d="M0,2.5c0,0,298.666,0,399.333,0C448.336,2.5,513.994,13,597,13c77.327,0,135-10.5,200.999-10.5c95.996,0,402.001,0,402.001,0"></path>      </svg>    </div>  </div></div><script data-pjax src="/Eternity/lib/hbe.js"></script><link href="/Eternity/css/hbe.style.css" rel="stylesheet" type="text/css">]]></content>
      
      
      <categories>
          
          <category> 短篇小说 </category>
          
          <category> 旭日东升的传说 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Link-Cut Tree</title>
      <link href="/Eternity/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/OI/link-cut-tree/"/>
      <url>/Eternity/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/OI/link-cut-tree/</url>
      
        <content type="html"><![CDATA[<p>“梦有归途，心有鸿鹄；所向之处，魂萦冢孤。”</p><span id="more"></span><p>顶级数据结构（指码量）。动态树的第一种，也是估计唯一要学的一种。</p><h2 id="动态树"><a href="#动态树" class="headerlink" title="动态树"></a>动态树</h2><p>常见的动态树有 $\text{Link-Cut Tree,Euler Tour Tree}$ 和 $\text{Top Tree}$ 。</p><p>动态树是一类问题，<strong>动态树问题</strong>是指与<strong>森林</strong>有关的问题。</p><p>举个例子，写出一个可维护以下操作的数据结构：</p><ul><li>修改树上路径权值；</li><li>查询树上路径权值；</li><li>修改树上子树权值；</li><li>查询树上子树权值。</li></ul><p>这……树剖爆切。</p><p>再加两个操作：</p><ul><li>断边；</li><li>连边。</li></ul><p>保证依然是一棵树。则这棵树就是动态的，那么就需要一个能求解动态树问题的数据结构——$\text{Link/Cut Tree}$ 。</p><hr><h3 id="动态树问题"><a href="#动态树问题" class="headerlink" title="动态树问题"></a>动态树问题</h3><p>维护一个<strong>森林</strong>，支持删除某条边，加入某条边，并保证加边，删边之后仍是森林。我们要维护这个森林的一些信息。</p><p>一般的操作有两点连通性，两点路径权值和，连接两点和切断某条边、修改信息等。</p><hr><h3 id="链剖分"><a href="#链剖分" class="headerlink" title="链剖分"></a>链剖分</h3><p>首先，我们应该知道，链的剖分不止一种。</p><p>有可用于树上区间问题的<strong>重链剖分</strong>，有可用于优化 $\text{dp}$ 的<strong>长链剖分</strong>，那么，接下来，也存在用于动态树问题的<strong>实链剖分</strong>。</p><hr><h3 id="实链剖分"><a href="#实链剖分" class="headerlink" title="实链剖分"></a>实链剖分</h3><p>由于动态维护一个森林，显然我们希望这个链是我们指定的链，以便利用来求解。对于一个点连向它所有儿子的边，我们自己选择一条边进行剖分，我们称被选择的边为实边，其他边则为虚边。对于实边，我们称它所连接的儿子为实儿子。对于一条由实边组成的链，我们同样称之为<strong>实链</strong>。</p><p>请记住我们选择实链剖分的最重要的原因：它是我们选择的，灵活且可变。正是它的这种灵活可变性，我们采用 $\text{Splay Tree}$ 来维护这些实链。</p><p>那么，对于 $\text{LCT}$ 的实现，我们就是用一<strong>些 </strong>$\text{Splay}$ 来动态维护实链剖分，以实现动态树问题的区间操作。并对每一条实链建 $\text{Splay}$ 树维护整个链区间的信息。 </p><h2 id="LCT"><a href="#LCT" class="headerlink" title="LCT"></a>LCT</h2><h3 id="辅助树"><a href="#辅助树" class="headerlink" title="辅助树"></a>辅助树</h3><p>就像是后缀自动机里 $\text{Parent Tree}$ 和自动机的关系一样，这些 $\text{Splay}$ 构成了一棵<strong>辅助树</strong>，每一棵辅助树维护一棵原树，一<strong>些</strong>辅助树构成 $\text{LCT}$ ，并维护整个森林。</p><p>辅助树有以下性质：</p><ol><li>辅助树由多棵 $\text{Splay}$ 组成，每棵 $\text{Splay}$ 维护原树中的一条路径，且中序遍历这棵 $\text{Splay}$ 得到的点序列，从前到后对应原树“从上到下”的一条路径。</li><li>原树每个节点与辅助树的 $\text{Splay}$ 节点一一对应。</li><li>辅助树的各棵 $\text{Splay}$ 之间并不是独立的。每棵 Splay 的根节点的父亲节点本应是空，但在 $\text{LCT}$ 中每棵 $\text{Splay}$ 的根节点的父亲节点指向原树中<strong>这条链</strong>的父亲节点（即链最顶端的点的父亲节点）。这类父亲链接与通常 $\text{Splay}$ 的父亲链接区别在于儿子认父亲，而父亲不认儿子，对应原树的一条<strong>虚边</strong>。因此，每个连通块恰好有一个点的父亲节点为空。</li><li>由于辅助树的以上性质，我们维护任何操作都不需要维护原树，辅助树可以在任何情况下拿出一个唯一的原树，我们只需要维护辅助树即可。</li></ol><blockquote><p>摘自 $\text{OI-Wiki}$ 。</p></blockquote><h4 id="原树与辅助树的结构关系"><a href="#原树与辅助树的结构关系" class="headerlink" title="原树与辅助树的结构关系"></a>原树与辅助树的结构关系</h4><ul><li>原树中的实链 : 在辅助树中节点都在一棵 $\text{Splay}$ 中。</li><li>原树中的虚链 : 在辅助树中，子节点所在 $\text{Splay}$的 <code>Father</code> 指向父节点，但是父节点的两个儿子都不指向子节点。</li><li>注意：原树的根不等于辅助树的根。</li><li>原树的 <code>Father</code> 指向不等于辅助树的 <code>Father</code> 指向。</li><li>辅助树是可以在满足辅助树、$\text{Splay}$ 的性质下任意换根的。</li><li>虚实链变换可以轻松在辅助树上完成，这也就是实现了动态维护树链剖分。</li></ul><h3 id="变量实意"><a href="#变量实意" class="headerlink" title="变量实意"></a>变量实意</h3><div class="table-container"><table><thead><tr><th style="text-align:center"><code>chi[p][2]</code></th><th style="text-align:center"><code>fa[p]</code></th><th style="text-align:center"><code>sum[p]</code></th><th style="text-align:center"><code>val[p]</code></th><th style="text-align:center"><code>tag[p]</code></th><th style="text-align:center"><code>laz[p]</code></th><th style="text-align:center"><code>siz[p]</code></th><th style="text-align:center"></th></tr></thead><tbody><tr><td style="text-align:center">左右儿子的指针</td><td style="text-align:center">父亲结点指针</td><td style="text-align:center">路径权值和</td><td style="text-align:center">点权</td><td style="text-align:center">翻转标记</td><td style="text-align:center">权值下传标记</td><td style="text-align:center">辅助树子树大小</td></tr></tbody></table></div><h3 id="函数声明"><a href="#函数声明" class="headerlink" title="函数声明"></a>函数声明</h3><h4 id="通常函数"><a href="#通常函数" class="headerlink" title="通常函数"></a>通常函数</h4><p><code>pushUp(p)</code> ：向上传递。</p><p><code>pushDown(p)</code> ：向下传递。</p><p>一般用于线段树或者平衡树里。</p><h4 id="文艺平衡树（Splay-系函数）"><a href="#文艺平衡树（Splay-系函数）" class="headerlink" title="文艺平衡树（Splay 系函数）"></a>文艺平衡树（Splay 系函数）</h4><p><code>getId(x)</code> ：获取 $x$ 是父亲儿子的编号。</p><p><code>Splay(x)</code> ：将 $x$ 旋转到<strong>当前</strong> $\text{Splay}$ 的根结点。</p><p><code>rotate(x)</code> ：<code>Splay(x)</code> 的具体操作，将 $x$ 向上旋转一层。</p><h4 id="LCT-操作函数"><a href="#LCT-操作函数" class="headerlink" title="LCT 操作函数"></a>LCT 操作函数</h4><p><code>Access(x)</code> ：把从 $x$ 到根结点路径上所经过的所有结点加入实链，使 $x$ 到根的简单路径成为一条<strong>实路径</strong>，并放在同一 $\text{Splay}$ 里。</p><blockquote><p>在实现 $\text{LCT}$ 时，只有 <code>access(x)</code> 操作是必要的，就如同在 $\text{Splay}$ 中的 <code>Splay(x,k)</code> 一样。其他操作都与题目本身息息相关。</p></blockquote><p><code>isRoot(x)</code> ：判断 $x$ 是否是所属 $\text{Splay}$ 树的根结点；。</p><p><code>update(x)</code> ：用于 <code>Access(x)</code> 操作之后，以<strong>递归</strong>的方式<strong>从下到上</strong> <code>pushDown</code> 更新树的信息。</p><p><code>makeRoot(x)</code> ：使 $x$ 点成为其所在树的根。</p><p><code>link(u,v)</code> ：加边。</p><p><code>cut(u,v)</code> ：删边。</p><p><code>getAnc(x)</code> ：求出 $x$ 所在树的根结点。</p><p><code>modifyX(x,v)</code> ：修改 $x$ 的点权为 $v$ 。</p><p><code>split(u,v)</code> ：提取 $(u,v)$ 的路径以区间操作。</p><hr><h3 id="函数实现"><a href="#函数实现" class="headerlink" title="函数实现"></a>函数实现</h3><h4 id="传递"><a href="#传递" class="headerlink" title="传递"></a>传递</h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">pushUp</span><span class="params">(<span class="type">int</span> p)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">//其它信息。</span></span><br><span class="line">    Tre[p].siz=Tre[ls].siz+Tre[rs].siz+<span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">pushDown</span><span class="params">(<span class="type">int</span> p)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(Tre[p].tag!=-INF)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">//传递。</span></span><br><span class="line">        Tre[p].tag=-INF;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="平衡树"><a href="#平衡树" class="headerlink" title="平衡树"></a>平衡树</h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> getId(x) (chi[Fa[x]][1]==x)</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">rotate</span><span class="params">(<span class="type">int</span> x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> y=Tre[x].fa,z=Tre[y].fa,k=<span class="built_in">getId</span>(x);</span><br><span class="line">    <span class="keyword">if</span>(!<span class="built_in">isRoot</span>(y)) Tre[z].chi[Tre[z].chi[<span class="number">1</span>]==y]=x;</span><br><span class="line">    <span class="comment">//这句话是Splay没有的，因为特判isRoot</span></span><br><span class="line">    Tre[y].chi[k]=Tre[x].chi[!k],Tre[y].fa=x,Tre[x].fa=z;</span><br><span class="line">    Tre[x].chi[!k]=y,Tre[y].fa=x,Tre[x].fa=z;</span><br><span class="line">    <span class="built_in">pushUp</span>(y),<span class="built_in">pushUp</span>(x);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">Splay</span><span class="params">(<span class="type">int</span> x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">update</span>(x);</span><br><span class="line">    <span class="comment">//在Splay之前把旋转过的路径全部pushDown</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> fa;fa=Tre[x].fa,!<span class="built_in">isRoot</span>(x);<span class="built_in">rotate</span>(x))</span><br><span class="line">        <span class="keyword">if</span>(!<span class="built_in">isRoot</span>(fa)) <span class="built_in">rotate</span>(<span class="built_in">get</span>(fa)==<span class="built_in">get</span>(x)?fa:x);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="LCT-1"><a href="#LCT-1" class="headerlink" title="LCT"></a>LCT</h4><p>判断根，这玩意儿其实可以不用函数，直接重定义也可：</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> isRoot(x) (Tre[Tre[x].fa].chi[0]!=x&amp;&amp;Tre[Tre[x].fa].chi[1]!=x)</span></span><br></pre></td></tr></table></figure><p>这样做的原因是：因为 $\text{LCT}$ 有【如果一个儿子不是实儿子，他的父亲就不会指向他】的特性。所以，如果一个点不是他父亲的左右儿子所指，他就是当前 $\text{Splay}$ 的根。</p><hr><p>虚实变换（<code>access</code>）</p><p>这是 $\text{LCT}$ 的核心操作，就好比求解一条由 $\text{Splay}$ 组成的路径。每一次直接调用结点信息即可。</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">Access</span><span class="params">(<span class="type">int</span> x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> p;</span><br><span class="line">    <span class="keyword">for</span>(p=<span class="number">0</span>;x;p=x,x=Tre[x].fa)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">Splay</span>(x);</span><br><span class="line">        Tre[x].chi[<span class="number">1</span>]=p;<span class="built_in">pushUp</span>(x);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> p;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这个方法的实质就是从下向上逐步更新 $\text{Splay}$ ，把 $x$ 旋到当前 $\text{Splay}$ 的根。</p><p>为了保证辅助树（$\text{AuxTree}$）的性质，我们需要把 $x$ 之后的所有实边更改为虚边。还是因为有认父不认子的性质，我们直接把 $x$ 的子结点指向 $\text{Null}$ 。</p><p>这个过程不太好叙述，所以可以去 $\text{Oi-Wiki}$ 看一下过程。</p><p><code>Access(x)</code> 的操作可以概括为四步：</p><ol><li>把 $x$ 旋转到根结点；</li><li>把其子结点换成之前结点；</li><li>更新当前结点的维护信息；</li><li>把当前结点换成当前结点的父结点，继续操作。</li></ol><p>这里的 <code>Access(x)</code> 会返回一个 <code>int</code> 值，这个返回值代表的是最后一次虚实链变换时，虚边父亲结点的编号。这个值的含义有：</p><ul><li>连续两次 <code>Access</code> 操作时，第二次返回的值是两次 <code>Access</code> 结点的 $\text{LCA}$ ；</li><li>这个值也表示 $x$ 到根所在的链中的 $\text{Splay}$ 树的根结点。而这个结点会被旋转到根结点，所以其父结点是 $\text{Null}$ 。</li></ul><hr><p><code>Splay(x)</code> 中的 <code>update(x)</code> 操作：</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">update</span><span class="params">(<span class="type">int</span> p)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(!<span class="built_in">isRoot</span>(p)) <span class="built_in">update</span>(Tre[p].fa);</span><br><span class="line">    <span class="built_in">pushDown</span>(p);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><p><code>makeRoot(x)</code></p><p>话说这个函数的作用和 <code>Access(x)</code> 一样重要。在维护信息时，会出现路径深度无法严格递增的情况，这是不能够出现在 $\text{Splay}$ 树中的。</p><p>而 <code>makeRoot(x)</code> 的作用就是指定的结点成为原树的根。</p><p>我们已知，在 <code>Access(x)</code> 中的返回值就是当前 $\text{Splay}$ 的根，而 $x$ 到当前根的路径就会恰好构成一棵 $\text{Splay}$ 树，且根结点已知。（设为 $y$ ）</p><p>考虑将树用有向图表示，并把树的无向边修改为有向边，并从子结点到父结点。然后仔细思考，对于换根操作，就是把 $x$ 到 $y$ 的路径的边全部反向。</p><p>然后，将 $x$ 到当前根 $y$ 的路径翻转，就是 <code>makeRoot(x)</code> 的操作。</p><p>而 $y$ 就是 $x$ 到当前根的路径所代表的 $\text{Splay}$ 的根，所以把以 $y$ 为根的 $\text{Splay}$ 的树进行区间翻转即可。</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">makeRoot</span><span class="params">(<span class="type">int</span> p)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    p=<span class="built_in">Access</span>(p);</span><br><span class="line">    std::<span class="built_in">swap</span>(Tre[p].chi[<span class="number">0</span>],Tre[p].chi[<span class="number">1</span>]);</span><br><span class="line">    tag[p]^=<span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><p><code>link(u,v)</code></p><p>连边，首先执行 <code>makeRoot(u)</code> ，然后把 $u$ 的父结点指向 $v$ ，但这个操作不可能发生在同一棵树上，所以需要先执行一次 <code>Splay(x)</code> 。</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">link</span><span class="params">(<span class="type">int</span> u,<span class="type">int</span> v)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">makeRoot</span>(u);<span class="built_in">Splay</span>(u);</span><br><span class="line">    Tre[u].fa=v;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><p><code>cut(u,v)</code></p><p>如果我们要删除一条边，肯定首先这条边得存在才能算合法。</p><p>如果题目保证合法，我们就不需要特判一次，直接 <code>split(u,v)</code> ，这时候 $v $ 是提取的根结点，而 $x$ 是它的子结点，然后直接双向断开。</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">cut</span><span class="params">(<span class="type">int</span> u,<span class="type">int</span> v)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">makeRoot</span>(u),<span class="built_in">Access</span>(v),<span class="built_in">Splay</span>(v);</span><br><span class="line">    Tre[v].chi[<span class="number">0</span>]=Tre[u].fa=<span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>而对于不保证合法，可以用一个 <code>std::map</code> 来存储。</p><p>边存在的性质：</p><ol><li>$(x,y)$ 连通；</li><li>$(x,y)$ 路径上没有其它链存在；</li><li>$x$ 没有右儿子。</li></ol><p>然后 $(x,y)$ 就存在边。</p><hr><p><code>split(u,v)</code></p><p>操作意义是，拿出一棵 $\text{Splay}$ 树，然后维护 $(u,v)$ 路径。</p><p>这个操作使 $(u,v)$ 路径保证在 $v$ 的子树上，就可以轻松解决一些问题。</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">split</span><span class="params">(<span class="type">int</span> u,<span class="type">int</span> v)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">makeRoot</span>(u),<span class="built_in">Access</span>(v),<span class="built_in">Splay</span>(v);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>然后你会发现这代码很好打，所以一般而言不会打出 <code>split(u,v)</code> 的函数形式，直接一键三连带走。</p><hr><p><code>getAnc(p)</code></p><p>找到当前辅助树上的根，在 <code>Access(p)</code> 后再 <code>Splay(p)</code> 即可，这样根就是树里最小的那个，沿着左子树一直 <code>pushDown</code> 即可，最后再次 <code>Splay(p)</code> 以保证复杂度。</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">getAnc</span><span class="params">(<span class="type">int</span> p)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">Access</span>(p),<span class="built_in">Splay</span>(p),<span class="built_in">pushDown</span>(p);</span><br><span class="line">    <span class="keyword">while</span>(Tre[p].chi[<span class="number">0</span>]) p=Tre[p].chi[<span class="number">0</span>],<span class="built_in">pushDown</span>(p);</span><br><span class="line">    <span class="built_in">Splay</span>(p);</span><br><span class="line">    <span class="keyword">return</span> p;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><p>还有三点应该知道，以免暴毙的：</p><ol><li>一定要记得在应该执行的时候执行 <code>pushUp()</code> 和 <code>pushDown()</code> ，$\text{LCT}$ 的这两步不同于 $\text{SegmentTree}$ ，如果少执行一次，并不仅仅是影响答案，还可能把修改改到不该改的点上。（深知 $\text{Dyd}$ 没有 <code>pushDown</code> 而调半天的经历）</li><li>其 <code>rotate</code> 和文艺平衡树的区别。</li><li>因为这里的 $\text{Splay}$ 只是一个辅助工具，所以不存在不旋转的根的情况，所以不需要传第二个参数。</li></ol><hr><h2 id="例题"><a href="#例题" class="headerlink" title="例题"></a>例题</h2><h3 id="维护树链"><a href="#维护树链" class="headerlink" title="维护树链"></a>维护树链</h3><h4 id="Tree-II"><a href="#Tree-II" class="headerlink" title="Tree II"></a><a href="https://www.luogu.com.cn/problem/P1501">Tree II</a></h4><p>不愧它有个 $\text{II}$ 的名字，这道题乍一看就是在<a href="https://www.luogu.com.cn/problem/P3373">《线段树2》</a>的操作放在树上并加上改边操作。</p><p>然后就打了一遍 $\text{LCT}$ 的板子。</p><details>    <summary>AC Code</summary><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;ctime&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iomanip&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stack&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;map&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> gh() getchar()</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> re register</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> int long long</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> ll;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN=<span class="number">1e5</span>+<span class="number">10</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> Mod=<span class="number">51061</span>;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    x=<span class="number">0</span>;</span><br><span class="line">    <span class="type">char</span> ch=<span class="built_in">gh</span>(),t=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(ch&lt;<span class="string">&#x27;0&#x27;</span>||ch&gt;<span class="string">&#x27;9&#x27;</span>) t|=ch==<span class="string">&#x27;-&#x27;</span>,ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">while</span>(ch&gt;=<span class="string">&#x27;0&#x27;</span>&amp;&amp;ch&lt;=<span class="string">&#x27;9&#x27;</span>) x=(x&lt;&lt;<span class="number">3</span>)+(x&lt;&lt;<span class="number">1</span>)+(ch^<span class="number">48</span>),ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">if</span>(t) x=-x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T,<span class="keyword">class</span> ...T1&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x,T1 &amp;...x1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">read</span>(x),<span class="built_in">read</span>(x1...);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">write</span><span class="params">(T x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(x&lt;<span class="number">0</span>) <span class="built_in">putchar</span>(<span class="string">&#x27;-&#x27;</span>),x=-x;</span><br><span class="line">    <span class="keyword">if</span>(x&gt;<span class="number">9</span>) <span class="built_in">write</span>(x/<span class="number">10</span>);</span><br><span class="line">    <span class="built_in">putchar</span>(x%<span class="number">10</span>+<span class="string">&#x27;0&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">checkMax</span><span class="params">(T &amp;x,T &amp;y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x&lt;y?x=y,<span class="number">1</span>:<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">checkMin</span><span class="params">(T &amp;x,T &amp;y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x&gt;y?x=y,<span class="number">1</span>:<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> N,Q;</span><br><span class="line"><span class="keyword">namespace</span> LCT</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">LC</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> chi[<span class="number">2</span>],fa,siz,val,sum,add,mul,rev;</span><br><span class="line">            <span class="comment">//子结点，父结点，点权值，区间权值和</span></span><br><span class="line">            <span class="comment">//加法标记，乘法标记，翻转标记</span></span><br><span class="line">        <span class="meta">#<span class="keyword">define</span> chi(p,i) Tre[p].chi[i]</span></span><br><span class="line">        <span class="meta">#<span class="keyword">define</span> fa(p) Tre[p].fa</span></span><br><span class="line">        <span class="meta">#<span class="keyword">define</span> siz(p) Tre[p].siz</span></span><br><span class="line">        <span class="meta">#<span class="keyword">define</span> val(p) Tre[p].val</span></span><br><span class="line">        <span class="meta">#<span class="keyword">define</span> sum(p) Tre[p].sum</span></span><br><span class="line">        <span class="meta">#<span class="keyword">define</span> add(p) Tre[p].add</span></span><br><span class="line">        <span class="meta">#<span class="keyword">define</span> mul(p) Tre[p].mul</span></span><br><span class="line">        <span class="meta">#<span class="keyword">define</span> rev(p) Tre[p].rev</span></span><br><span class="line">    &#125;Tre[MAXN];</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">clear</span><span class="params">(<span class="type">int</span> p)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">/*LC *t = &amp;Tre[0];</span></span><br><span class="line"><span class="comment">        t-&gt;chi*/</span></span><br><span class="line">        <span class="built_in">chi</span>(p,<span class="number">0</span>)=<span class="built_in">chi</span>(p,<span class="number">1</span>)=<span class="built_in">fa</span>(p)=<span class="built_in">siz</span>(p)=<span class="built_in">val</span>(p)=<span class="built_in">sum</span>(p)=<span class="built_in">rev</span>(p)=<span class="built_in">add</span>(p)=<span class="number">0</span>;</span><br><span class="line">        <span class="built_in">mul</span>(p)=<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/*inline rot(int x)</span></span><br><span class="line"><span class="comment">    &#123;</span></span><br><span class="line"><span class="comment">        y = fa[x], z = fa[y];</span></span><br><span class="line"><span class="comment">        int k = ch[y][1] == x;</span></span><br><span class="line"><span class="comment">        ch[fa[x] = z][ch[z][1] == y] = x;</span></span><br><span class="line"><span class="comment">        fa[ch[x][k ^ 1]] = y, ch[y][k] = ch[x][k ^ 1];</span></span><br><span class="line"><span class="comment">        fa[y] = x, ch[x][k ^ 1] = y;</span></span><br><span class="line"><span class="comment">    &#125;*/</span></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">getId</span><span class="params">(<span class="type">int</span> p)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> (<span class="built_in">chi</span>(<span class="built_in">fa</span>(p),<span class="number">1</span>)==p);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">isRoot</span><span class="params">(<span class="type">int</span> p)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="built_in">clear</span>(<span class="number">0</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">chi</span>(<span class="built_in">fa</span>(p),<span class="number">0</span>)!=p&amp;&amp;<span class="built_in">chi</span>(<span class="built_in">fa</span>(p),<span class="number">1</span>)!=p;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">pushUp</span><span class="params">(<span class="type">int</span> p)</span>   <span class="comment">//mainTain(p)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="built_in">clear</span>(<span class="number">0</span>);</span><br><span class="line">        <span class="built_in">siz</span>(p)=(<span class="built_in">siz</span>(<span class="built_in">chi</span>(p,<span class="number">0</span>))+<span class="built_in">siz</span>(<span class="built_in">chi</span>(p,<span class="number">1</span>))+<span class="number">1</span>)%Mod;</span><br><span class="line">        <span class="built_in">sum</span>(p)=(<span class="built_in">sum</span>(<span class="built_in">chi</span>(p,<span class="number">0</span>))+<span class="built_in">sum</span>(<span class="built_in">chi</span>(p,<span class="number">1</span>))+<span class="built_in">val</span>(p))%Mod;</span><br><span class="line">    &#125;   </span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">pushDown</span><span class="params">(<span class="type">int</span> p)</span> <span class="comment">//和线段树2类似，需要传两个tag</span></span></span><br><span class="line"><span class="function">                                <span class="comment">//且要注意顺序。</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="built_in">clear</span>(<span class="number">0</span>);</span><br><span class="line">        <span class="keyword">if</span>(<span class="built_in">mul</span>(p)!=<span class="number">1</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span>(<span class="built_in">chi</span>(p,<span class="number">0</span>))        <span class="comment">//存在左儿子</span></span><br><span class="line">            &#123;</span><br><span class="line">                <span class="built_in">mul</span>(<span class="built_in">chi</span>(p,<span class="number">0</span>))=(<span class="built_in">mul</span>(<span class="built_in">chi</span>(p,<span class="number">0</span>))*<span class="built_in">mul</span>(p))%Mod;</span><br><span class="line">                <span class="built_in">val</span>(<span class="built_in">chi</span>(p,<span class="number">0</span>))=(<span class="built_in">val</span>(<span class="built_in">chi</span>(p,<span class="number">0</span>))*<span class="built_in">mul</span>(p))%Mod;</span><br><span class="line">                <span class="built_in">sum</span>(<span class="built_in">chi</span>(p,<span class="number">0</span>))=(<span class="built_in">sum</span>(<span class="built_in">chi</span>(p,<span class="number">0</span>))*<span class="built_in">mul</span>(p))%Mod;</span><br><span class="line">                <span class="built_in">add</span>(<span class="built_in">chi</span>(p,<span class="number">0</span>))=(<span class="built_in">add</span>(<span class="built_in">chi</span>(p,<span class="number">0</span>))*<span class="built_in">mul</span>(p))%Mod;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(<span class="built_in">chi</span>(p,<span class="number">1</span>))        <span class="comment">//存在右儿子</span></span><br><span class="line">            &#123;</span><br><span class="line">                <span class="built_in">mul</span>(<span class="built_in">chi</span>(p,<span class="number">1</span>))=(<span class="built_in">mul</span>(<span class="built_in">chi</span>(p,<span class="number">1</span>))*<span class="built_in">mul</span>(p))%Mod;</span><br><span class="line">                <span class="built_in">val</span>(<span class="built_in">chi</span>(p,<span class="number">1</span>))=(<span class="built_in">val</span>(<span class="built_in">chi</span>(p,<span class="number">1</span>))*<span class="built_in">mul</span>(p))%Mod;</span><br><span class="line">                <span class="built_in">sum</span>(<span class="built_in">chi</span>(p,<span class="number">1</span>))=(<span class="built_in">sum</span>(<span class="built_in">chi</span>(p,<span class="number">1</span>))*<span class="built_in">mul</span>(p))%Mod;</span><br><span class="line">                <span class="built_in">add</span>(<span class="built_in">chi</span>(p,<span class="number">1</span>))=(<span class="built_in">add</span>(<span class="built_in">chi</span>(p,<span class="number">1</span>))*<span class="built_in">mul</span>(p))%Mod;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="built_in">mul</span>(p)=<span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(<span class="built_in">add</span>(p))              <span class="comment">//同上</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span>(<span class="built_in">chi</span>(p,<span class="number">0</span>))</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="built_in">add</span>(<span class="built_in">chi</span>(p,<span class="number">0</span>))=(<span class="built_in">add</span>(<span class="built_in">chi</span>(p,<span class="number">0</span>))+<span class="built_in">add</span>(p))%Mod;</span><br><span class="line">                <span class="built_in">val</span>(<span class="built_in">chi</span>(p,<span class="number">0</span>))=(<span class="built_in">val</span>(<span class="built_in">chi</span>(p,<span class="number">0</span>))+<span class="built_in">add</span>(p))%Mod;</span><br><span class="line">                <span class="built_in">sum</span>(<span class="built_in">chi</span>(p,<span class="number">0</span>))=(<span class="built_in">sum</span>(<span class="built_in">chi</span>(p,<span class="number">0</span>))+<span class="built_in">add</span>(p)*<span class="built_in">siz</span>(<span class="built_in">chi</span>(p,<span class="number">0</span>))%Mod)%Mod;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(<span class="built_in">chi</span>(p,<span class="number">1</span>))</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="built_in">add</span>(<span class="built_in">chi</span>(p,<span class="number">1</span>))=(<span class="built_in">add</span>(<span class="built_in">chi</span>(p,<span class="number">1</span>))+<span class="built_in">add</span>(p))%Mod;</span><br><span class="line">                <span class="built_in">val</span>(<span class="built_in">chi</span>(p,<span class="number">1</span>))=(<span class="built_in">val</span>(<span class="built_in">chi</span>(p,<span class="number">1</span>))+<span class="built_in">add</span>(p))%Mod;</span><br><span class="line">                <span class="built_in">sum</span>(<span class="built_in">chi</span>(p,<span class="number">1</span>))=(<span class="built_in">sum</span>(<span class="built_in">chi</span>(p,<span class="number">1</span>))+<span class="built_in">add</span>(p)*<span class="built_in">siz</span>(<span class="built_in">chi</span>(p,<span class="number">1</span>))%Mod)%Mod;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="built_in">add</span>(p)=<span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(<span class="built_in">rev</span>(p))</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span>(<span class="built_in">chi</span>(p,<span class="number">0</span>)) <span class="built_in">rev</span>(<span class="built_in">chi</span>(p,<span class="number">0</span>))^=<span class="number">1</span>,std::<span class="built_in">swap</span>(<span class="built_in">chi</span>(<span class="built_in">chi</span>(p,<span class="number">0</span>),<span class="number">0</span>),<span class="built_in">chi</span>(<span class="built_in">chi</span>(p,<span class="number">0</span>),<span class="number">1</span>));</span><br><span class="line">            <span class="keyword">if</span>(<span class="built_in">chi</span>(p,<span class="number">1</span>)) <span class="built_in">rev</span>(<span class="built_in">chi</span>(p,<span class="number">1</span>))^=<span class="number">1</span>,std::<span class="built_in">swap</span>(<span class="built_in">chi</span>(<span class="built_in">chi</span>(p,<span class="number">1</span>),<span class="number">0</span>),<span class="built_in">chi</span>(<span class="built_in">chi</span>(p,<span class="number">1</span>),<span class="number">1</span>));</span><br><span class="line">            <span class="built_in">rev</span>(p)=<span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">update</span><span class="params">(<span class="type">int</span> p)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(!<span class="built_in">isRoot</span>(p)) <span class="built_in">update</span>(<span class="built_in">fa</span>(p));</span><br><span class="line">        <span class="built_in">pushDown</span>(p);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">printOut</span><span class="params">(<span class="type">int</span> p)</span> <span class="comment">//中序遍历</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(!p) <span class="keyword">return</span> ;</span><br><span class="line">        <span class="built_in">pushDown</span>(p);</span><br><span class="line">        <span class="built_in">printOut</span>(<span class="built_in">chi</span>(p,<span class="number">0</span>));</span><br><span class="line">        <span class="built_in">write</span>(p),<span class="built_in">puts</span>(<span class="string">&quot;&quot;</span>);</span><br><span class="line">        <span class="built_in">printOut</span>(<span class="built_in">chi</span>(p,<span class="number">1</span>));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">rotate</span><span class="params">(<span class="type">int</span> x)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="type">int</span> y=<span class="built_in">fa</span>(x),z=<span class="built_in">fa</span>(y),k=<span class="built_in">getId</span>(x);</span><br><span class="line">        <span class="built_in">fa</span>(x)=z;</span><br><span class="line">        <span class="keyword">if</span>(!<span class="built_in">isRoot</span>(y)) <span class="built_in">chi</span>(z,<span class="built_in">getId</span>(y))=x;</span><br><span class="line">        <span class="built_in">chi</span>(y,k)=<span class="built_in">chi</span>(x,k^<span class="number">1</span>),<span class="built_in">fa</span>(<span class="built_in">chi</span>(x,k^<span class="number">1</span>))=y;</span><br><span class="line">        <span class="built_in">chi</span>(x,k^<span class="number">1</span>)=y,<span class="built_in">fa</span>(y)=x;</span><br><span class="line">        <span class="built_in">pushUp</span>(y),<span class="built_in">pushUp</span>(x),<span class="built_in">pushUp</span>(z);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">Splay</span><span class="params">(<span class="type">int</span> p)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="built_in">update</span>(p);</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> f=<span class="built_in">fa</span>(p);f=<span class="built_in">fa</span>(p),!<span class="built_in">isRoot</span>(p);<span class="built_in">rotate</span>(p))</span><br><span class="line">            <span class="keyword">if</span>(!<span class="built_in">isRoot</span>(f)) <span class="built_in">rotate</span>(<span class="built_in">getId</span>(p)==<span class="built_in">getId</span>(f)?f:p);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">Access</span><span class="params">(<span class="type">int</span> p)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> f=<span class="number">0</span>;p;f=p,p=<span class="built_in">fa</span>(p)) <span class="built_in">Splay</span>(p),<span class="built_in">chi</span>(p,<span class="number">1</span>)=f,<span class="built_in">pushUp</span>(p);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">makeRoot</span><span class="params">(<span class="type">int</span> p)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="built_in">Access</span>(p),<span class="built_in">Splay</span>(p);</span><br><span class="line">        std::<span class="built_in">swap</span>(<span class="built_in">chi</span>(p,<span class="number">0</span>),<span class="built_in">chi</span>(p,<span class="number">1</span>));</span><br><span class="line">        <span class="built_in">rev</span>(p)^=<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">getAnc</span><span class="params">(<span class="type">int</span> p)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="built_in">Access</span>(p),<span class="built_in">Splay</span>(p);</span><br><span class="line">        <span class="keyword">while</span>(<span class="built_in">chi</span>(p,<span class="number">0</span>)) p=<span class="built_in">chi</span>(p,<span class="number">0</span>);</span><br><span class="line">        <span class="built_in">Splay</span>(p);</span><br><span class="line">        <span class="keyword">return</span> p;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="type">char</span> opt[<span class="number">10</span>];</span><br><span class="line"><span class="type">int</span> Qu,Qv,Qc;</span><br><span class="line"><span class="function"><span class="type">signed</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// freopen(&quot;LCT.in&quot;,&quot;r&quot;,stdin);</span></span><br><span class="line">    <span class="comment">// freopen(&quot;LCT.out&quot;,&quot;w&quot;,stdout);</span></span><br><span class="line">    <span class="built_in">read</span>(N,Q);</span><br><span class="line">    <span class="keyword">for</span>(re <span class="type">int</span> i=<span class="number">1</span>;i&lt;=N;++i) LCT::<span class="built_in">val</span>(i)=<span class="number">1</span>,LCT::<span class="built_in">pushUp</span>(i);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>,u,v;i&lt;N;++i)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">read</span>(u,v);</span><br><span class="line">        <span class="keyword">if</span>(LCT::<span class="built_in">getAnc</span>(u)!=LCT::<span class="built_in">getAnc</span>(v))</span><br><span class="line">            LCT::<span class="built_in">makeRoot</span>(u),LCT::<span class="built_in">fa</span>(u)=v;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span>(Q--)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>,opt+<span class="number">1</span>);</span><br><span class="line">        <span class="keyword">if</span>(opt[<span class="number">1</span>]==<span class="string">&#x27;+&#x27;</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">read</span>(Qu,Qv,Qc);</span><br><span class="line">            LCT::<span class="built_in">makeRoot</span>(Qu),LCT::<span class="built_in">Access</span>(Qv),LCT::<span class="built_in">Splay</span>(Qv);</span><br><span class="line">            LCT::<span class="built_in">val</span>(Qv)=(LCT::<span class="built_in">val</span>(Qv)+Qc)%Mod;</span><br><span class="line">            LCT::<span class="built_in">sum</span>(Qv)=(LCT::<span class="built_in">sum</span>(Qv)+LCT::<span class="built_in">siz</span>(Qv)*Qc%Mod)%Mod;</span><br><span class="line">            LCT::<span class="built_in">add</span>(Qv)=(LCT::<span class="built_in">add</span>(Qv)+Qc)%Mod;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(opt[<span class="number">1</span>]==<span class="string">&#x27;-&#x27;</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">read</span>(Qu,Qv);</span><br><span class="line">            LCT::<span class="built_in">makeRoot</span>(Qu),LCT::<span class="built_in">Access</span>(Qv),LCT::<span class="built_in">Splay</span>(Qv);</span><br><span class="line">            <span class="keyword">if</span>(LCT::<span class="built_in">chi</span>(Qv,<span class="number">0</span>)==Qu&amp;&amp;!LCT::<span class="built_in">chi</span>(Qu,<span class="number">1</span>))</span><br><span class="line">                LCT::<span class="built_in">chi</span>(Qv,<span class="number">0</span>)=LCT::<span class="built_in">fa</span>(Qu)=<span class="number">0</span>;</span><br><span class="line">            <span class="built_in">read</span>(Qu,Qv);</span><br><span class="line">            <span class="keyword">if</span>(LCT::<span class="built_in">getAnc</span>(Qu)!=LCT::<span class="built_in">getAnc</span>(Qv))</span><br><span class="line">                LCT::<span class="built_in">makeRoot</span>(Qu),LCT::<span class="built_in">fa</span>(Qu)=Qv;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(opt[<span class="number">1</span>]==<span class="string">&#x27;*&#x27;</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">read</span>(Qu,Qv,Qc);</span><br><span class="line">            LCT::<span class="built_in">makeRoot</span>(Qu),LCT::<span class="built_in">Access</span>(Qv),LCT::<span class="built_in">Splay</span>(Qv);</span><br><span class="line">            LCT::<span class="built_in">val</span>(Qv)=LCT::<span class="built_in">val</span>(Qv)*Qc%Mod;</span><br><span class="line">            LCT::<span class="built_in">sum</span>(Qv)=LCT::<span class="built_in">sum</span>(Qv)*Qc%Mod;</span><br><span class="line">            LCT::<span class="built_in">mul</span>(Qv)=LCT::<span class="built_in">mul</span>(Qv)*Qc%Mod;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(opt[<span class="number">1</span>]==<span class="string">&#x27;/&#x27;</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">read</span>(Qu,Qv);</span><br><span class="line">            LCT::<span class="built_in">makeRoot</span>(Qu),LCT::<span class="built_in">Access</span>(Qv),LCT::<span class="built_in">Splay</span>(Qv);</span><br><span class="line">            <span class="built_in">write</span>(LCT::<span class="built_in">sum</span>(Qv)),<span class="built_in">puts</span>(<span class="string">&quot;&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">3 2</span></span><br><span class="line"><span class="comment">1 2</span></span><br><span class="line"><span class="comment">2 3</span></span><br><span class="line"><span class="comment">* 1 3 4</span></span><br><span class="line"><span class="comment">/ 1 1</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure></details><hr>]]></content>
      
      
      <categories>
          
          <category> 学习笔记 </category>
          
          <category> OI </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 平衡树 </tag>
            
            <tag> 数据结构 </tag>
            
            <tag> 树型结构 </tag>
            
            <tag> 树链剖分 </tag>
            
            <tag> Splay </tag>
            
            <tag> Link-Cut Tree </tag>
            
            <tag> 动态树 </tag>
            
            <tag> 森林 </tag>
            
            <tag> 实链剖分 </tag>
            
            <tag> 虚实链 </tag>
            
            <tag> 连通图 </tag>
            
            <tag> 连通分量 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>树套树</title>
      <link href="/Eternity/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/OI/tree-set/"/>
      <url>/Eternity/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/OI/tree-set/</url>
      
        <content type="html"><![CDATA[<p>“没有独自完成的赞歌，没有携手共进的归冢。”</p><span id="more"></span><p>顾名思义，由于一些神奇的原因，我们将一个数据结构维护的每一个点都建立另一个数据结构以达到维护问题答案的操作。一般而言分为<strong>外层树</strong>和<strong>内层树</strong>。</p><p>外层树一般有线段树和树状数组；<br>内层树一般有平衡树，线段树和 $\text{Stl}$ 。</p><hr><h2 id="树链剖分"><a href="#树链剖分" class="headerlink" title="树链剖分"></a>树链剖分</h2><p>其实树剖就是树套树这个思想的前身。因为树剖是树链套数据结构。</p><p>其中的外层树就是树链，内层树就是所需要的数据结构。而树套树也就需要这个思想，但外层树不仅仅是树链，而是另一种所需的数据结构。</p><hr><h2 id="线段树套-Stl"><a href="#线段树套-Stl" class="headerlink" title="线段树套 Stl"></a>线段树套 Stl</h2><p>维护区间前继与修改操作：</p><blockquote><p>写出一种数据结构，可维护以下操作：</p><ol><li>把第 $i$ 个数修改成 $x$ ；</li><li>求 $x$ 在区间 $[l,r]$ 内的前继。</li></ol></blockquote><p>对于单点修改和区间查询，我们可以很容易想到线段树，而对前继操作，则考虑 <code>std::set</code> 或者 <code>std::multiset</code> 。</p><p>不用担心空间复杂度的条件，因为线段树的性质，<code>std::set</code> 的个数不会超过 $\mathcal O(n\log n)$ （虽然听起来也挺多的了）。</p><p>对于操作一，我们可以在原来的 <code>std::set</code> 中删去原数，并添加上 $x$ ，总共会修改 $\mathcal O(\log n)$ 个区间，一次修改的时间复杂度为 $\mathcal O(\log^2 n)$ 。</p><p>对于操作二，直接在区间中使用 <code>std::set</code> 中的 <code>lower_bound</code> 或 <code>upper_bound</code> 即可。</p><h3 id="P5838"><a href="#P5838" class="headerlink" title="P5838"></a><a href="https://www.luogu.com.cn/problem/P5838">P5838</a></h3><p>这道题的做法出奇的多，不过总归到底还是一个树链剖分的练习。</p><p>正解有什么 $\operatorname{Tarjan}$ ，主席树，智慧法（神仙离线线性算法），分块，莫队等等。</p><p>但给一个懒人打法：</p><p>树剖套线段树套平衡树（虽然码量大）</p><p>首先，用树剖维护路径并对每一条链建立一个线段树，线段树维护 $dfn[]$ 序区间的颜色出现情况，用 <code>std::map</code> 或者 <code>std::set</code> 来维护。</p><p>因为本人过菜不会使用 <code>std::set</code> 所以选择了更为费时但简单的 <code>std::map</code> 。</p><p>每次查询就 $\operatorname{or}$ 上当前区间的 $Map[c]$ ，当 $res\ne 0$ 时直接判断 $\text{true}$ 。</p><p>但总之，$\operatorname{Stl}$ 的存在就已经证明了这个 $\mathcal O(n\log^3 n)$ 的方法不可过，所以直接吸氧，然后解决。现在大部分的比赛都会自带 $\operatorname{O_2}$ 优化，所以不必过于担心。</p><details>    <summary>AC Code</summary><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;ctime&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iomanip&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stack&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;map&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> gh() getchar()</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> re register</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> ll;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN=<span class="number">1e5</span>+<span class="number">10</span>;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    x=<span class="number">0</span>;</span><br><span class="line">    <span class="type">char</span> ch=<span class="built_in">gh</span>(),t=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(ch&lt;<span class="string">&#x27;0&#x27;</span>||ch&gt;<span class="string">&#x27;9&#x27;</span>) t|=ch==<span class="string">&#x27;-&#x27;</span>,ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">while</span>(ch&gt;=<span class="string">&#x27;0&#x27;</span>&amp;&amp;ch&lt;=<span class="string">&#x27;9&#x27;</span>) x=(x&lt;&lt;<span class="number">3</span>)+(x&lt;&lt;<span class="number">1</span>)+(ch^<span class="number">48</span>),ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">if</span>(t) x=-x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T,<span class="keyword">class</span> ...T1&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x,T1 &amp;...x1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">read</span>(x),<span class="built_in">read</span>(x1...);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">write</span><span class="params">(T x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(x&lt;<span class="number">0</span>) <span class="built_in">putchar</span>(<span class="string">&#x27;-&#x27;</span>),x=-x;</span><br><span class="line">    <span class="keyword">if</span>(x&gt;<span class="number">9</span>) <span class="built_in">write</span>(x/<span class="number">10</span>);</span><br><span class="line">    <span class="built_in">putchar</span>(x%<span class="number">10</span>+<span class="string">&#x27;0&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">checkMax</span><span class="params">(T &amp;x,T &amp;y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x&lt;y?x=y,<span class="number">1</span>:<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">checkMin</span><span class="params">(T &amp;x,T &amp;y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x&gt;y?x=y,<span class="number">1</span>:<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> N,Q,T[MAXN];</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">G</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> next,to;</span><br><span class="line">&#125;Edge[MAXN&lt;&lt;<span class="number">1</span>];</span><br><span class="line"><span class="type">int</span> Head[MAXN],Total;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">addEdge</span><span class="params">(<span class="type">int</span> u,<span class="type">int</span> v)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Edge[++Total]=(G)&#123;Head[u],v&#125;;Head[u]=Total;</span><br><span class="line">    Edge[++Total]=(G)&#123;Head[v],u&#125;;Head[v]=Total;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> Fa[MAXN],Son[MAXN],Dep[MAXN],Siz[MAXN];</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dfsTree</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> last)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Fa[x]=last,Dep[x]=Dep[last]+<span class="number">1</span>,Siz[x]=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> e=Head[x],v;e;e=Edge[e].next)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>((v=Edge[e].to)==last) <span class="keyword">continue</span>;</span><br><span class="line">        <span class="built_in">dfsTree</span>(v,x);</span><br><span class="line">        Siz[x]+=Siz[v];</span><br><span class="line">        <span class="keyword">if</span>(!Son[x]||Siz[v]&gt;Siz[Son[x]]) Son[x]=v;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> Top[MAXN],Dfn[MAXN],Bck[MAXN],Cnt;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dfsChain</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> topf)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Top[x]=topf,Dfn[x]=++Cnt;</span><br><span class="line">    Bck[Cnt]=x;</span><br><span class="line">    <span class="keyword">if</span>(!Son[x]) <span class="keyword">return</span> ;</span><br><span class="line">    <span class="built_in">dfsChain</span>(Son[x],topf);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> e=Head[x],v;e;e=Edge[e].next)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>((v=Edge[e].to)==Fa[x]||v==Son[x]) <span class="keyword">continue</span>;</span><br><span class="line">        <span class="built_in">dfsChain</span>(v,v);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ls p&lt;&lt;1</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> rs p&lt;&lt;1|1</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">ST</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> l,r;</span><br><span class="line">    std::map&lt;<span class="type">int</span>,<span class="type">bool</span>&gt;Mp;</span><br><span class="line">&#125;Tree[MAXN&lt;&lt;<span class="number">2</span>];</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">build</span><span class="params">(<span class="type">int</span> p,<span class="type">int</span> l,<span class="type">int</span> r)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Tree[p].l=l,Tree[p].r=r;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=l;i&lt;=r;++i) Tree[p].Mp[T[Bck[i]]]=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span>(l==r) <span class="keyword">return</span> ;</span><br><span class="line">    <span class="type">int</span> mid=(l+r)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">    <span class="built_in">build</span>(ls,l,mid),<span class="built_in">build</span>(rs,mid+<span class="number">1</span>,r);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">queryT</span><span class="params">(<span class="type">int</span> p,<span class="type">int</span> l,<span class="type">int</span> r,<span class="type">int</span> T)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(l&lt;=Tree[p].l&amp;&amp;Tree[p].r&lt;=r) <span class="keyword">return</span> Tree[p].Mp[T];</span><br><span class="line">    <span class="type">int</span> mid=(Tree[p].l+Tree[p].r)&gt;&gt;<span class="number">1</span>,res=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span>(l&lt;=mid) res|=<span class="built_in">queryT</span>(ls,l,r,T);</span><br><span class="line">    <span class="keyword">if</span>(mid&lt;r) res|=<span class="built_in">queryT</span>(rs,l,r,T);</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">queryTPath</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> y,<span class="type">int</span> T)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> res=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(Top[x]!=Top[y])</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(Dep[Top[x]]&lt;Dep[Top[y]]) std::<span class="built_in">swap</span>(x,y);</span><br><span class="line">        res|=<span class="built_in">queryT</span>(<span class="number">1</span>,Dfn[Top[x]],Dfn[x],T);</span><br><span class="line">        <span class="keyword">if</span>(res) <span class="keyword">return</span> res;</span><br><span class="line">        x=Fa[Top[x]];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(Dep[x]&gt;Dep[y]) std::<span class="built_in">swap</span>(x,y);</span><br><span class="line">    res|=<span class="built_in">queryT</span>(<span class="number">1</span>,Dfn[x],Dfn[y],T);</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> ans[MAXN];</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// freopen(&quot;treechain-segmenttree-std::map.in&quot;,&quot;r&quot;,stdin);</span></span><br><span class="line">    <span class="comment">// freopen(&quot;treechain-segmenttree-std::map.out&quot;,&quot;w&quot;,stdout);</span></span><br><span class="line">    <span class="built_in">read</span>(N,Q);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=N;++i) <span class="built_in">read</span>(T[i]);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">2</span>,u,v;i&lt;=N;++i)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">read</span>(u,v);<span class="built_in">addEdge</span>(u,v);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">dfsTree</span>(<span class="number">1</span>,<span class="number">0</span>);<span class="built_in">dfsChain</span>(<span class="number">1</span>,<span class="number">1</span>);</span><br><span class="line">    <span class="built_in">build</span>(<span class="number">1</span>,<span class="number">1</span>,N);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>,x,y,t;i&lt;=Q;++i)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">read</span>(x,y,t);</span><br><span class="line">        ans[i]=<span class="built_in">queryTPath</span>(x,y,t);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=Q;++i) <span class="built_in">putchar</span>(ans[i]+<span class="string">&#x27;0&#x27;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">5 5</span></span><br><span class="line"><span class="comment">1 1 2 1 2</span></span><br><span class="line"><span class="comment">1 2</span></span><br><span class="line"><span class="comment">2 3</span></span><br><span class="line"><span class="comment">2 4</span></span><br><span class="line"><span class="comment">1 5</span></span><br><span class="line"><span class="comment">1 4 1</span></span><br><span class="line"><span class="comment">1 4 2</span></span><br><span class="line"><span class="comment">1 3 2</span></span><br><span class="line"><span class="comment">1 3 1</span></span><br><span class="line"><span class="comment">5 5 1</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure></details><hr><h2 id="线段树套平衡树"><a href="#线段树套平衡树" class="headerlink" title="线段树套平衡树"></a>线段树套平衡树</h2><p>其实 <code>std::set</code> 本身就是一个平衡树，只是这个平衡树已经封装好了，不需要你自己来实现。而现在，我们需要根据题目定义自己实现平衡树。</p><h3 id="二逼平衡树"><a href="#二逼平衡树" class="headerlink" title="二逼平衡树"></a>二逼平衡树</h3><p><a href="https://www.luogu.com.cn/problem/P3380">二逼平衡树</a>板子。简化一下题意：</p><blockquote><ol><li>询问区间 $k$ 排名；</li><li>询问区间排名 $k$ ；</li><li>单点修改；</li><li>查询区间前驱；</li><li>查询区间后驱。</li></ol></blockquote><p>除去区间之外，都是平衡树常见的操作，所以考虑外部线段树，内部平衡树。</p><p>最慢的操作达到 $\mathcal O(\log^3 n)$ ，所以整个问题的时间复杂度为 $\mathcal O(m\log ^3 n)$ 。</p><p><strong>另话</strong>：洛谷里这道题似乎非常卡常，离大谱。（调个线段树套 $\text{Splay}$ 调的人心态爆炸，结果最后因为没去 <code>freopen</code> ？？？）还是开了 $\mathcal O_2$ 才过的。</p><p>码风指导：封装加 $\text{Splay}$ 。（有时间再写个线段树套 $\text{Treap}$ ）</p><details>    <summary>AC Code Splay ver.</summary><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;ctime&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iomanip&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stack&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;map&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> gh() getchar()</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> re register</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> ll;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN=<span class="number">3e6</span>+<span class="number">10</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> INF=<span class="number">2147483647</span>;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    x=<span class="number">0</span>;</span><br><span class="line">    <span class="type">char</span> ch=<span class="built_in">gh</span>(),t=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(ch&lt;<span class="string">&#x27;0&#x27;</span>||ch&gt;<span class="string">&#x27;9&#x27;</span>) t|=ch==<span class="string">&#x27;-&#x27;</span>,ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">while</span>(ch&gt;=<span class="string">&#x27;0&#x27;</span>&amp;&amp;ch&lt;=<span class="string">&#x27;9&#x27;</span>) x=(x&lt;&lt;<span class="number">3</span>)+(x&lt;&lt;<span class="number">1</span>)+(ch^<span class="number">48</span>),ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">if</span>(t) x=-x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T,<span class="keyword">class</span> ...T1&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x,T1 &amp;...x1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">read</span>(x),<span class="built_in">read</span>(x1...);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">write</span><span class="params">(T x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(x&lt;<span class="number">0</span>) <span class="built_in">putchar</span>(<span class="string">&#x27;-&#x27;</span>),x=-x;</span><br><span class="line">    <span class="keyword">if</span>(x&gt;<span class="number">9</span>) <span class="built_in">write</span>(x/<span class="number">10</span>);</span><br><span class="line">    <span class="built_in">putchar</span>(x%<span class="number">10</span>+<span class="string">&#x27;0&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">checkMax</span><span class="params">(T &amp;x,T &amp;y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x&lt;y?x=y,<span class="number">1</span>:<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">checkMin</span><span class="params">(T &amp;x,T &amp;y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x&gt;y?x=y,<span class="number">1</span>:<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> N,Q,Val[MAXN];</span><br><span class="line"><span class="keyword">namespace</span> B_T<span class="comment">//平衡树</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">Balanced</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> siz,chi[<span class="number">2</span>],fa,val;</span><br><span class="line">        <span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">init</span><span class="params">(<span class="type">int</span> _v,<span class="type">int</span> _fa)</span></span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            val=_v,fa=_fa,siz=<span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;Tre[MAXN&lt;&lt;<span class="number">4</span>];</span><br><span class="line">    <span class="type">int</span> Idx=<span class="number">0</span>;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">pushUp</span><span class="params">(<span class="type">int</span> p)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        Tre[p].siz=Tre[Tre[p].chi[<span class="number">0</span>]].siz+Tre[Tre[p].chi[<span class="number">1</span>]].siz+<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">rotate</span><span class="params">(<span class="type">int</span> x)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="type">int</span> y=Tre[x].fa;</span><br><span class="line">        <span class="type">int</span> z=Tre[y].fa;</span><br><span class="line">        <span class="type">int</span> k=Tre[y].chi[<span class="number">1</span>]==x;</span><br><span class="line">        Tre[z].chi[Tre[z].chi[<span class="number">1</span>]==y]=x,Tre[x].fa=z;</span><br><span class="line">        Tre[y].chi[k]=Tre[x].chi[k^<span class="number">1</span>],Tre[Tre[x].chi[k^<span class="number">1</span>]].fa=y;</span><br><span class="line">        Tre[x].chi[k^<span class="number">1</span>]=y,Tre[y].fa=x;</span><br><span class="line">        <span class="built_in">pushUp</span>(y),<span class="built_in">pushUp</span>(x);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">Splay</span><span class="params">(<span class="type">int</span> &amp;Rt,<span class="type">int</span> x,<span class="type">int</span> k)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">while</span>(Tre[x].fa!=k)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="type">int</span> y=Tre[x].fa;</span><br><span class="line">            <span class="type">int</span> z=Tre[y].fa;</span><br><span class="line">            <span class="keyword">if</span>(z!=k)</span><br><span class="line">                (Tre[y].chi[<span class="number">1</span>]==x)^(Tre[z].chi[<span class="number">1</span>]==y)?<span class="built_in">rotate</span>(x):<span class="built_in">rotate</span>(y);</span><br><span class="line">            <span class="built_in">rotate</span>(x);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(!k) Rt=x;</span><br><span class="line">    &#125;<span class="comment">//Splay经典操作</span></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">insert</span><span class="params">(<span class="type">int</span> &amp;Rt,<span class="type">int</span> v)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="type">int</span> u=Rt,p=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span>(u) p=u,u=Tre[u].chi[v&gt;Tre[u].val];</span><br><span class="line">        u=++Idx;</span><br><span class="line">        <span class="keyword">if</span>(p) Tre[p].chi[v&gt;Tre[p].val]=u;</span><br><span class="line">        Tre[u].<span class="built_in">init</span>(v,p);<span class="built_in">Splay</span>(Rt,u,<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">lowerCnt</span><span class="params">(<span class="type">int</span> Rt,<span class="type">int</span> v)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="type">int</span> u=Rt,res=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span>(u)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span>(Tre[u].val&lt;v) res+=Tre[Tre[u].chi[<span class="number">0</span>]].siz+<span class="number">1</span>,u=Tre[u].chi[<span class="number">1</span>];</span><br><span class="line">            <span class="keyword">else</span> u=Tre[u].chi[<span class="number">0</span>];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;<span class="comment">//查找比v小的数的个数</span></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">modifyX</span><span class="params">(<span class="type">int</span> &amp;Rt,<span class="type">int</span> x,<span class="type">int</span> k)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="type">int</span> u=Rt;</span><br><span class="line">        <span class="keyword">while</span>(u)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span>(Tre[u].val==x) <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">if</span>(Tre[u].val&lt;x) u=Tre[u].chi[<span class="number">1</span>];</span><br><span class="line">            <span class="keyword">else</span> u=Tre[u].chi[<span class="number">0</span>];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">Splay</span>(Rt,u,<span class="number">0</span>);</span><br><span class="line">        <span class="type">int</span> l=Tre[u].chi[<span class="number">0</span>],r=Tre[u].chi[<span class="number">1</span>];</span><br><span class="line">        <span class="keyword">while</span>(Tre[l].chi[<span class="number">1</span>]) l=Tre[l].chi[<span class="number">1</span>];</span><br><span class="line">        <span class="keyword">while</span>(Tre[r].chi[<span class="number">0</span>]) r=Tre[r].chi[<span class="number">0</span>];</span><br><span class="line">        <span class="built_in">Splay</span>(Rt,l,<span class="number">0</span>),<span class="built_in">Splay</span>(Rt,r,l);</span><br><span class="line">        Tre[r].chi[<span class="number">0</span>]=<span class="number">0</span>;</span><br><span class="line">        <span class="built_in">pushUp</span>(r),<span class="built_in">pushUp</span>(l);</span><br><span class="line">        <span class="built_in">insert</span>(Rt,k);</span><br><span class="line">    &#125;<span class="comment">//修改操作：删去原数，添加新数</span></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">lowerNum</span><span class="params">(<span class="type">int</span> Rt,<span class="type">int</span> v)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="type">int</span> u=Rt,res=-INF;</span><br><span class="line">        <span class="keyword">while</span>(u)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span>(Tre[u].val&lt;v)</span><br><span class="line">                res=std::<span class="built_in">max</span>(res,Tre[u].val),u=Tre[u].chi[<span class="number">1</span>];</span><br><span class="line">            <span class="keyword">else</span> u=Tre[u].chi[<span class="number">0</span>];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;<span class="comment">//前驱</span></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">upperNum</span><span class="params">(<span class="type">int</span> Rt,<span class="type">int</span> v)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="type">int</span> u=Rt,res=INF;</span><br><span class="line">        <span class="keyword">while</span>(u)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span>(Tre[u].val&gt;v)</span><br><span class="line">                res=std::<span class="built_in">min</span>(res,Tre[u].val),u=Tre[u].chi[<span class="number">0</span>];</span><br><span class="line">            <span class="keyword">else</span> u=Tre[u].chi[<span class="number">1</span>];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;<span class="comment">//后驱</span></span><br><span class="line">&#125;;<span class="comment">//注意：函数里所有的根节点传的都是实参</span></span><br><span class="line"><span class="keyword">namespace</span> S_T<span class="comment">//线段树</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="meta">#<span class="keyword">define</span> ls p&lt;&lt;1</span></span><br><span class="line">    <span class="meta">#<span class="keyword">define</span> rs p&lt;&lt;1|1</span></span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">Segment</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> l,r,Rt;</span><br><span class="line">    &#125;Tree[MAXN&lt;&lt;<span class="number">2</span>];</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">build</span><span class="params">(<span class="type">int</span> p,<span class="type">int</span> l,<span class="type">int</span> r)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        Tree[p].l=l,Tree[p].r=r;</span><br><span class="line">        B_T::<span class="built_in">insert</span>(Tree[p].Rt,-INF),B_T::<span class="built_in">insert</span>(Tree[p].Rt,INF);</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=l;i&lt;=r;++i) B_T::<span class="built_in">insert</span>(Tree[p].Rt,Val[i]);</span><br><span class="line">        <span class="comment">//初始化，讨论区里好像说不需要每个Splay都开极值，</span></span><br><span class="line">        <span class="comment">//可以判空，这样更快（500ms左右），但我懒，没写。</span></span><br><span class="line">        <span class="keyword">if</span>(l==r) <span class="keyword">return</span> ;</span><br><span class="line">        <span class="type">int</span> mid=(l+r)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">        <span class="built_in">build</span>(ls,l,mid),<span class="built_in">build</span>(rs,mid+<span class="number">1</span>,r);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">queryCnt</span><span class="params">(<span class="type">int</span> p,<span class="type">int</span> l,<span class="type">int</span> r,<span class="type">int</span> k)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(l&lt;=Tree[p].l&amp;&amp;Tree[p].r&lt;=r) <span class="keyword">return</span> B_T::<span class="built_in">lowerCnt</span>(Tree[p].Rt,k)<span class="number">-1</span>;</span><br><span class="line">        <span class="type">int</span> mid=(Tree[p].l+Tree[p].r)&gt;&gt;<span class="number">1</span>,res=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">if</span>(l&lt;=mid) res+=<span class="built_in">queryCnt</span>(ls,l,r,k);</span><br><span class="line">        <span class="keyword">if</span>(mid&lt;r) res+=<span class="built_in">queryCnt</span>(rs,l,r,k);</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;<span class="comment">//区间查找比k小的数的个数</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">modifyX</span><span class="params">(<span class="type">int</span> p,<span class="type">int</span> x,<span class="type">int</span> k)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        B_T::<span class="built_in">modifyX</span>(Tree[p].Rt,Val[x],k);</span><br><span class="line">        <span class="keyword">if</span>(Tree[p].l==Tree[p].r) <span class="keyword">return</span> ;</span><br><span class="line">        <span class="type">int</span> mid=(Tree[p].l+Tree[p].r)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span>(x&lt;=mid) <span class="built_in">modifyX</span>(ls,x,k);</span><br><span class="line">        <span class="keyword">else</span> <span class="built_in">modifyX</span>(rs,x,k);</span><br><span class="line">    &#125;<span class="comment">//修改，每个区间都要修改</span></span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">queryLower</span><span class="params">(<span class="type">int</span> p,<span class="type">int</span> l,<span class="type">int</span> r,<span class="type">int</span> v)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(l&lt;=Tree[p].l&amp;&amp;Tree[p].r&lt;=r) <span class="keyword">return</span> B_T::<span class="built_in">lowerNum</span>(Tree[p].Rt,v);</span><br><span class="line">        <span class="type">int</span> mid=(Tree[p].l+Tree[p].r)&gt;&gt;<span class="number">1</span>,res=-INF;</span><br><span class="line">        <span class="keyword">if</span>(l&lt;=mid) res=std::<span class="built_in">max</span>(res,<span class="built_in">queryLower</span>(ls,l,r,v));</span><br><span class="line">        <span class="keyword">if</span>(mid&lt;r) res=std::<span class="built_in">max</span>(res,<span class="built_in">queryLower</span>(rs,l,r,v));</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;<span class="comment">//区间前驱</span></span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">queryUpper</span><span class="params">(<span class="type">int</span> p,<span class="type">int</span> l,<span class="type">int</span> r,<span class="type">int</span> v)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(l&lt;=Tree[p].l&amp;&amp;Tree[p].r&lt;=r) <span class="keyword">return</span> B_T::<span class="built_in">upperNum</span>(Tree[p].Rt,v);</span><br><span class="line">        <span class="type">int</span> mid=(Tree[p].l+Tree[p].r)&gt;&gt;<span class="number">1</span>,res=INF;</span><br><span class="line">        <span class="keyword">if</span>(l&lt;=mid) res=std::<span class="built_in">min</span>(res,<span class="built_in">queryUpper</span>(ls,l,r,v));</span><br><span class="line">        <span class="keyword">if</span>(mid&lt;r) res=std::<span class="built_in">min</span>(res,<span class="built_in">queryUpper</span>(rs,l,r,v));</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;<span class="comment">//区间后驱</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="type">int</span> MaxQx,MinQx=<span class="number">1e8</span>;</span><br><span class="line"><span class="comment">//小优化，二分时记录当前输入的极值</span></span><br><span class="line"><span class="comment">//而非每次二分[0,1e8]，似乎会快300ms左右</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// freopen(&quot;tree-set.in&quot;,&quot;r&quot;,stdin);</span></span><br><span class="line">    <span class="comment">// freopen(&quot;tree-set.out&quot;,&quot;w&quot;,stdout);</span></span><br><span class="line">    <span class="built_in">read</span>(N,Q);</span><br><span class="line">    <span class="keyword">for</span>(re <span class="type">int</span> i=<span class="number">1</span>;i&lt;=N;++i) <span class="built_in">read</span>(Val[i]);</span><br><span class="line">    S_T::<span class="built_in">build</span>(<span class="number">1</span>,<span class="number">1</span>,N);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=N;++i)</span><br><span class="line">    &#123;</span><br><span class="line">        MaxQx=std::<span class="built_in">max</span>(Val[i],MaxQx);</span><br><span class="line">        MinQx=std::<span class="built_in">min</span>(MinQx,Val[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span>(Q--)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> opt,Ql,Qr,Qx;</span><br><span class="line">        <span class="built_in">read</span>(opt);</span><br><span class="line">        <span class="keyword">if</span>(opt==<span class="number">1</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">read</span>(Ql,Qr,Qx);</span><br><span class="line">            <span class="built_in">write</span>(S_T::<span class="built_in">queryCnt</span>(<span class="number">1</span>,Ql,Qr,Qx)+<span class="number">1</span>),<span class="built_in">puts</span>(<span class="string">&quot;&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(opt==<span class="number">2</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">read</span>(Ql,Qr,Qx);</span><br><span class="line">            <span class="type">int</span> l=MinQx,r=MaxQx,ans;</span><br><span class="line">            <span class="keyword">while</span>(l&lt;=r)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="type">int</span> mid=(l+r)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">                <span class="keyword">if</span>(S_T::<span class="built_in">queryCnt</span>(<span class="number">1</span>,Ql,Qr,mid)+<span class="number">1</span>&lt;=Qx) l=mid+<span class="number">1</span>,ans=mid;</span><br><span class="line">                <span class="keyword">else</span> r=mid<span class="number">-1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="built_in">write</span>(ans),<span class="built_in">puts</span>(<span class="string">&quot;&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(opt==<span class="number">3</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">read</span>(Ql,Qx);</span><br><span class="line">            S_T::<span class="built_in">modifyX</span>(<span class="number">1</span>,Ql,Qx);</span><br><span class="line">            Val[Ql]=Qx;</span><br><span class="line">            MaxQx=std::<span class="built_in">max</span>(Qx,MaxQx),MinQx=std::<span class="built_in">min</span>(MinQx,Qx);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(opt==<span class="number">4</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">read</span>(Ql,Qr,Qx);</span><br><span class="line">            <span class="built_in">write</span>(S_T::<span class="built_in">queryLower</span>(<span class="number">1</span>,Ql,Qr,Qx)),<span class="built_in">puts</span>(<span class="string">&quot;&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">read</span>(Ql,Qr,Qx);</span><br><span class="line">            <span class="built_in">write</span>(S_T::<span class="built_in">queryUpper</span>(<span class="number">1</span>,Ql,Qr,Qx)),<span class="built_in">puts</span>(<span class="string">&quot;&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">9 6</span></span><br><span class="line"><span class="comment">4 2 2 1 9 4 0 1 1</span></span><br><span class="line"><span class="comment">2 1 4 3</span></span><br><span class="line"><span class="comment">3 4 10</span></span><br><span class="line"><span class="comment">2 1 4 3</span></span><br><span class="line"><span class="comment">1 2 5 9</span></span><br><span class="line"><span class="comment">4 3 9 5</span></span><br><span class="line"><span class="comment">5 2 8 5</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure></details><hr><h2 id="分块套树状数组"><a href="#分块套树状数组" class="headerlink" title="分块套树状数组"></a>分块套树状数组</h2><p>这个代码似乎<strong>相对而言</strong>比较简短，容易实现。</p><p>可以用于二维平面中的矩阵区域的点数查询与修改。</p><h3 id="例子一"><a href="#例子一" class="headerlink" title="例子一"></a><a href="https://www.luogu.com.cn/problem/U235631">例子一</a></h3><blockquote><p>给出 $n$ 个二维平面的点 $(x_i,y_i)$ ，实现操作：</p><ol><li>$opt,a,b,c,d$ ，询问左上角为 $(a,b)$ ，右下角为 $(c,d)$ 的矩阵区域内的点的个数。</li><li>$opt,x,y$ ，把横坐标为 $x$ 的点的纵坐标改为 $y$ 。</li></ol><p><strong>强制在线</strong>，保证 $x_i\ne x_j(1\le i,j\le n,i\ne j)$ ，$1\le i\le n,1\le x_i,y_i\le n,1\le n\le 10^5$ 。</p></blockquote><p>因为一个 $x$ 只对应一个 $y$ ，所以用一个数组记录这个映射关系，令 $Y[i]$ 表示横坐标为 $i$ 的纵坐标。</p><p>以 $\sqrt n$ 分块横坐标，为每一个块建立权值树状数组，记 $Tre[i]$ 为第 $i$ 个块的树状数组，则 $Tre[i][j]$ 表示块 $i$ 里纵坐标在 $\displaystyle\left(j-\operatorname{lowbit}(j),j\right]$ 内点的个数。</p><p>这是一个区间带修改的二维偏序问题（至于偏序，之后有机会再写），根据矩阵容斥，可以知道：</p><p> $[a,b,c,d]=[1,1,c,d]-[1,1,a,d]-[1,1,b,c]+[1,1,a,b]$ </p><h4 id="查询"><a href="#查询" class="headerlink" title="查询"></a>查询</h4><p>首先暴力处理左右的非完整块区间，统计答案；然后对于完整的块，暴力扫描该块之前的所有块中 $Tre[i][b]$ 的值，即查询 $Tre$ 的前缀和，可以进行性质技巧优化。</p><h4 id="修改"><a href="#修改" class="headerlink" title="修改"></a>修改</h4><p>可以直接找到 $x$ 所在的块，然后 $add(y_1,1),add(y_2,-1)$ ，并赋值 $Y[x]=y$ 。</p><p>对上述操作进行优化，可以视为删点和加点。</p><h4 id="空间复杂度"><a href="#空间复杂度" class="headerlink" title="空间复杂度"></a>空间复杂度</h4><p>分块 $\mathcal O(\sqrt n)$ ，树状数组 $\mathcal O(n)$ ，总共 $\mathcal O(n\sqrt n)$ 。</p><h4 id="时间复杂度"><a href="#时间复杂度" class="headerlink" title="时间复杂度"></a>时间复杂度</h4><p>遍历非完整块段 $\mathcal O(\sqrt n)$ ，遍历完整块段 $\mathcal O(\log\sqrt n)$ ，完整块的树状数组查询 $\mathcal O(\log n)$ ，时间复杂度 $\mathcal O(\sqrt n+\log(n+\sqrt n))$ 。</p><h4 id="补充"><a href="#补充" class="headerlink" title="补充"></a>补充</h4><p>感谢 <a href="https://www.luogu.com.cn/user/523491">$\text{@reveal}$</a> 提供的代码，让我有了一些深入的理解。</p><blockquote><p>这是在线带修二维偏序吧。</p><p>对序列分块，值域建树状数组就好了啊。</p><p>假设用朴素的方式，大概流程：</p><ul><li>读入</li><li>对序列进行分块</li><li>扫描每一个块，按值域大小建立树状数组</li><li>将每一个块内的数字放入对应的树状数组</li></ul><p>修改：</p><ul><li>将原来的数字从树状数组中删除</li><li>将新的数字加入树状数组</li></ul><p>查询：</p><ul><li>扫描散块，统计</li><li>扫描整块，在树状数组上查找区间和（即某个值域的数字总数）</li></ul><p>然后对于非朴素的方式，注意到复杂度并不均匀，查询时扫描整块并查询为复杂度瓶颈。</p><p>注意到这具有前缀和形式，即可以通过统计前若干块整块的答案来得到答案。</p><p>那么我们可以在修改时，对于对应点之后的整块做修改（类似于树状数组的形式），之后的查询也同样处理即可。</p></blockquote><details>    <summary>Example Code @reveal ver.</summary><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">using</span> uni=<span class="type">unsigned</span>;</span><br><span class="line"><span class="keyword">using</span> ll=<span class="type">long</span> <span class="type">long</span>;</span><br><span class="line"><span class="keyword">using</span> db=<span class="type">double</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N=<span class="number">100010</span>,BMAX=<span class="number">350</span>,FSIZE=<span class="number">1</span>&lt;&lt;<span class="number">26</span>;</span><br><span class="line"><span class="comment">// is 为所属块的编号，lst 为所属块的起始，nxt 为所属快的结尾</span></span><br><span class="line"><span class="type">int</span> n,q,a[N],is[N],lst[N],nxt[N];</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">FT</span>&#123;  <span class="comment">// 经典树状数组</span></span><br><span class="line">    <span class="type">int</span> size;</span><br><span class="line">    vector&lt;<span class="type">int</span>&gt; a;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">build</span><span class="params">(<span class="type">int</span> x)</span></span>&#123;a.<span class="built_in">resize</span>((size=x)+<span class="number">1</span>);&#125;</span><br><span class="line">    <span class="type">void</span> <span class="keyword">operator</span>+=(<span class="type">int</span> x)&#123;</span><br><span class="line">        <span class="keyword">for</span>(;x&lt;=size;x+=x&amp;-x) ++a[x];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">void</span> <span class="keyword">operator</span>-=(<span class="type">int</span> x)&#123;</span><br><span class="line">        <span class="keyword">for</span>(;x&lt;=size;x+=x&amp;-x) --a[x];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">calc</span><span class="params">(<span class="type">int</span> x)</span></span>&#123;</span><br><span class="line">        <span class="type">int</span> re=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(;x;x-=x&amp;-x) re+=a[x];</span><br><span class="line">        <span class="keyword">return</span>(re);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">query</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> y)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span>(<span class="built_in">calc</span>(y)-<span class="built_in">calc</span>(x<span class="number">-1</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;t[BMAX];</span><br><span class="line"></span><br><span class="line"><span class="type">char</span> BuF[FSIZE],*InF=BuF;</span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;<span class="function"><span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x)</span></span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(;<span class="number">48</span>&gt;*InF||*InF&gt;<span class="number">57</span>;++InF);</span><br><span class="line">    <span class="keyword">for</span>(x=<span class="number">0</span>;<span class="number">47</span>&lt;*InF&amp;&amp;*InF&lt;<span class="number">58</span>;x=x*<span class="number">10</span>+(*InF++^<span class="number">48</span>));</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="built_in">fread</span>(BuF,<span class="number">1</span>,FSIZE,stdin);</span><br><span class="line">    <span class="built_in">read</span>(n);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// BS 为块长，ALL 为最大可能的块的编号</span></span><br><span class="line">    <span class="type">const</span> <span class="type">int</span> BS=<span class="built_in">sqrt</span>(n),ALL=n/BS+<span class="number">2</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 外层树状数组添加数字</span></span><br><span class="line">    <span class="keyword">auto</span> add=[&amp;](<span class="type">int</span> x,<span class="type">int</span> y)&#123;</span><br><span class="line">        <span class="keyword">for</span>(;x&lt;=ALL;x+=x&amp;-x) t[x]+=y;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 外层树状数组删除数字</span></span><br><span class="line">    <span class="keyword">auto</span> del=[&amp;](<span class="type">int</span> x,<span class="type">int</span> y)&#123;</span><br><span class="line">        <span class="keyword">for</span>(;x&lt;=ALL;x+=x&amp;-x) t[x]-=y;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 外层树状数组求前缀</span></span><br><span class="line">    <span class="keyword">auto</span> calc=[&amp;](<span class="type">int</span> x,<span class="type">int</span> l,<span class="type">int</span> r)&#123;</span><br><span class="line">        <span class="type">int</span> re=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(;x;x-=x&amp;-x) re+=t[x].<span class="built_in">query</span>(l,r);</span><br><span class="line">        <span class="keyword">return</span>(re);</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 外层树状数组求区间</span></span><br><span class="line">    <span class="keyword">auto</span> query=[&amp;](<span class="type">int</span> x,<span class="type">int</span> y,<span class="type">int</span> l,<span class="type">int</span> r)&#123;</span><br><span class="line">        <span class="built_in">return</span>(x&gt;y?<span class="number">0</span>:<span class="built_in">calc</span>(y,l,r)-<span class="built_in">calc</span>(x<span class="number">-1</span>,l,r));</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 建立内层树状数组</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;n/BS+<span class="number">1</span>;++i) t[i].<span class="built_in">build</span>(n);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>,x;i&lt;=n;++i)&#123;</span><br><span class="line">        <span class="built_in">read</span>(x),<span class="built_in">read</span>(a[i]);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// is 为所属块的编号</span></span><br><span class="line">        is[i]=(i<span class="number">-1</span>)/BS+<span class="number">1</span>;</span><br><span class="line">        <span class="built_in">add</span>(is[i],a[i]);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// lst 为所属块的起始，nxt 为所属快的结尾</span></span><br><span class="line">        lst[i]=(is[i]<span class="number">-1</span>)*BS+<span class="number">1</span>;</span><br><span class="line">        nxt[i]=<span class="built_in">min</span>(is[i]*BS,n);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">read</span>(q);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> t,x,y,l,r;q--;)&#123;</span><br><span class="line">        <span class="built_in">read</span>(t);<span class="built_in">read</span>(x);<span class="built_in">read</span>(y);</span><br><span class="line">        <span class="keyword">if</span>(t==<span class="number">0</span>)&#123;</span><br><span class="line">            <span class="built_in">del</span>(is[x],a[x]);  <span class="comment">// 删除原数</span></span><br><span class="line">            <span class="built_in">add</span>(is[x],a[x]=y);  <span class="comment">// 加入新数</span></span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="type">int</span> ans=<span class="number">0</span>;</span><br><span class="line">            <span class="built_in">read</span>(l);<span class="built_in">read</span>(r);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// get 为暴力处理</span></span><br><span class="line">            <span class="keyword">auto</span> get=[&amp;](<span class="type">int</span> x,<span class="type">int</span> y,<span class="type">int</span> l,<span class="type">int</span> r)&#123;</span><br><span class="line">                <span class="type">int</span> re=<span class="number">0</span>;</span><br><span class="line">                <span class="keyword">for</span>(<span class="type">int</span> i=x;i&lt;=y;++i)</span><br><span class="line">                    re+=l&lt;=a[i]&amp;&amp;a[i]&lt;=r;</span><br><span class="line">                <span class="keyword">return</span>(re);&#125;;</span><br><span class="line"></span><br><span class="line">            ans=is[x]+<span class="number">1</span>&gt;is[y]<span class="number">-1</span>?</span><br><span class="line">                <span class="built_in">get</span>(x,y,l,r)  <span class="comment">// 块足够小，直接暴力处理</span></span><br><span class="line">                :</span><br><span class="line">                <span class="built_in">get</span>(x,nxt[x],l,r)+  <span class="comment">// 左端散块</span></span><br><span class="line">                <span class="built_in">get</span>(lst[y],y,l,r)+  <span class="comment">// 右端散块</span></span><br><span class="line">                <span class="built_in">query</span>(is[x]+<span class="number">1</span>,is[y]<span class="number">-1</span>,l,r);  <span class="comment">// 整块</span></span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,ans);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">fclose</span>(stdin);</span><br><span class="line">    <span class="built_in">fclose</span>(stdout);</span><br><span class="line">    <span class="keyword">return</span>(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">6</span></span><br><span class="line"><span class="comment">1 3</span></span><br><span class="line"><span class="comment">2 7</span></span><br><span class="line"><span class="comment">3 4</span></span><br><span class="line"><span class="comment">4 8</span></span><br><span class="line"><span class="comment">5 10</span></span><br><span class="line"><span class="comment">6 1</span></span><br><span class="line"><span class="comment">10</span></span><br><span class="line"><span class="comment">1 1 10 1 10</span></span><br><span class="line"><span class="comment">0 6 11</span></span><br><span class="line"><span class="comment">1 1 10 1 10</span></span><br><span class="line"><span class="comment">0 6 1</span></span><br><span class="line"><span class="comment">1 1 10 1 10</span></span><br><span class="line"><span class="comment">0 4 6</span></span><br><span class="line"><span class="comment">1 2 5 3 4</span></span><br><span class="line"><span class="comment">1 1 7 2 6</span></span><br><span class="line"><span class="comment">1 3 9 5 7</span></span><br><span class="line"><span class="comment">0 3 14</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure></details><hr><details>    <summary>Example Code Eternity's ver.</summary><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    x=<span class="number">0</span>;</span><br><span class="line">    <span class="type">char</span> ch=<span class="built_in">getchar</span>(),t=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(ch&lt;<span class="string">&#x27;0&#x27;</span>||ch&gt;<span class="string">&#x27;9&#x27;</span>) t|=ch==<span class="string">&#x27;-&#x27;</span>,ch=<span class="built_in">getchar</span>();</span><br><span class="line">    <span class="keyword">while</span>(ch&gt;=<span class="string">&#x27;0&#x27;</span>&amp;&amp;ch&lt;=<span class="string">&#x27;9&#x27;</span>) x=(x&lt;&lt;<span class="number">3</span>)+(x&lt;&lt;<span class="number">1</span>)+(ch^<span class="number">48</span>),ch=<span class="built_in">getchar</span>();</span><br><span class="line">    <span class="keyword">if</span>(t) x=-x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T,<span class="keyword">class</span> ...T1&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x,T1 &amp;...x1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">read</span>(x),<span class="built_in">read</span>(x1...);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">write</span><span class="params">(T x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(x&lt;<span class="number">0</span>) <span class="built_in">putchar</span>(<span class="string">&#x27;-&#x27;</span>),x=-x;</span><br><span class="line">    <span class="keyword">if</span>(x&gt;<span class="number">9</span>) <span class="built_in">write</span>(x/<span class="number">10</span>);</span><br><span class="line">    <span class="built_in">putchar</span>(x%<span class="number">10</span>+<span class="number">48</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN=<span class="number">1e5</span>+<span class="number">10</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXB=<span class="number">3e2</span>+<span class="number">50</span>;</span><br><span class="line"><span class="type">int</span> N,Q,Val[MAXN],Blo,All;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">lowbit</span><span class="params">(<span class="type">int</span> x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x&amp;(-x);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">BIT</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> size;</span><br><span class="line">    std::vector&lt;<span class="type">int</span>&gt;Tre;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">build</span><span class="params">(<span class="type">int</span> n)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        Tre.<span class="built_in">resize</span>((size=n)+<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">void</span> <span class="keyword">operator</span>+=(<span class="type">int</span> k)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">for</span>(;k&lt;=size;k+=<span class="built_in">lowbit</span>(k)) ++Tre[k];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">void</span> <span class="keyword">operator</span>-=(<span class="type">int</span> k)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">for</span>(;k&lt;=size;k+=<span class="built_in">lowbit</span>(k)) --Tre[k];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">calc</span><span class="params">(<span class="type">int</span> x)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="type">int</span> res=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(;x;x-=<span class="built_in">lowbit</span>(x)) res+=Tre[x];</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">query</span><span class="params">(<span class="type">int</span> l,<span class="type">int</span> r)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">calc</span>(r)-<span class="built_in">calc</span>(l<span class="number">-1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;Tre[MAXB];</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Block</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> Blg,Lst,Nxt;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">init</span><span class="params">(<span class="type">int</span> id)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        Blg=(id<span class="number">-1</span>)/Blo+<span class="number">1</span>;</span><br><span class="line">        Lst=(Blg<span class="number">-1</span>)*Blo+<span class="number">1</span>;</span><br><span class="line">        Nxt=std::<span class="built_in">min</span>(Blg*Blo,N);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;Blk[MAXN];</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">add</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(;x&lt;=All;x+=<span class="built_in">lowbit</span>(x)) Tre[x]+=y;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">del</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(;x&lt;=All;x+=<span class="built_in">lowbit</span>(x)) Tre[x]-=y;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">calc</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> l,<span class="type">int</span> r)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> res=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(;x;x-=<span class="built_in">lowbit</span>(x)) res+=Tre[x].<span class="built_in">query</span>(l,r);</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">query</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> y,<span class="type">int</span> l,<span class="type">int</span> r)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// std:: cout &lt;&lt; calc(y, l, r) &lt;&lt; &quot; &quot; &lt;&lt; calc(x - 1, l, r) &lt;&lt; &#x27;\n&#x27;;</span></span><br><span class="line">    <span class="keyword">return</span> (x&gt;y?<span class="number">0</span>:<span class="built_in">calc</span>(y,l,r)-<span class="built_in">calc</span>(x<span class="number">-1</span>,l,r));</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">get</span><span class="params">(<span class="type">int</span> a,<span class="type">int</span> b,<span class="type">int</span> c,<span class="type">int</span> d)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> res=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=a;i&lt;=b;++i) res+=(c&lt;=Val[i]&amp;&amp;Val[i]&lt;=d);</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> lastans;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// freopen(&quot;.in&quot;,&quot;r&quot;,stdin);</span></span><br><span class="line">    <span class="comment">// freopen(&quot;.out&quot;,&quot;w&quot;,stdout);</span></span><br><span class="line">    <span class="built_in">read</span>(N);</span><br><span class="line">    Blo=std::<span class="built_in">sqrt</span>(N),All=N/Blo+<span class="number">2</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;N/Blo+<span class="number">1</span>;++i) Tre[i].<span class="built_in">build</span>(N);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>,x;i&lt;=N;++i)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">read</span>(x,Val[i]);</span><br><span class="line">        Blk[i].<span class="built_in">init</span>(i);</span><br><span class="line">        <span class="built_in">add</span>(Blk[i].Blg,Val[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">read</span>(Q);</span><br><span class="line">    <span class="type">int</span> flag = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> opt,a,b,c,d;Q--;)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">read</span>(opt,a,b);</span><br><span class="line">        <span class="keyword">if</span>(opt==<span class="number">0</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">del</span>(Blk[a].Blg,Val[a]);</span><br><span class="line">            <span class="built_in">add</span>(Blk[a].Blg,Val[a]=b);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            flag ++;</span><br><span class="line">            <span class="comment">// if(flag == 6)</span></span><br><span class="line">            <span class="comment">// &#123;</span></span><br><span class="line">            <span class="comment">//     std:: cout &lt;&lt; &quot;duck&quot; &lt;&lt; std:: endl;</span></span><br><span class="line">            <span class="comment">// &#125;</span></span><br><span class="line">            <span class="built_in">read</span>(c,d);</span><br><span class="line">            <span class="type">int</span> ans=Blk[a].Blg+<span class="number">1</span>&gt;Blk[b].Blg<span class="number">-1</span>?</span><br><span class="line">                <span class="built_in">get</span>(a,b,c,d):</span><br><span class="line">                <span class="built_in">get</span>(a,Blk[a].Nxt,c,d)+</span><br><span class="line">                <span class="built_in">get</span>(Blk[b].Lst,b,c,d)+</span><br><span class="line">                <span class="built_in">query</span>(Blk[a].Blg+<span class="number">1</span>,Blk[b].Blg<span class="number">-1</span>,c,d);</span><br><span class="line">            <span class="comment">// if(Blk[a].Blg + 1 &lt;= Blk[b].Blg - 1) std:: cout &lt;&lt; get(a,Blk[a].Nxt,c,d) &lt;&lt; &quot; &quot; &lt;&lt; get(Blk[b].Lst,b,c,d) &lt;&lt; &quot; &quot; &lt;&lt; query(Blk[a].Blg+1,Blk[b].Blg-1,c,d) &lt;&lt; &#x27;\n&#x27;;</span></span><br><span class="line">            <span class="built_in">write</span>(lastans=ans),<span class="built_in">puts</span>(<span class="string">&quot;&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// std:: cout &lt;&lt; calc(2, 1, 10) &lt;&lt; &#x27;\n&#x27;;</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">6</span></span><br><span class="line"><span class="comment">1 3</span></span><br><span class="line"><span class="comment">2 7</span></span><br><span class="line"><span class="comment">3 4</span></span><br><span class="line"><span class="comment">4 8</span></span><br><span class="line"><span class="comment">5 10</span></span><br><span class="line"><span class="comment">6 1</span></span><br><span class="line"><span class="comment">10</span></span><br><span class="line"><span class="comment">1 1 10 1 10</span></span><br><span class="line"><span class="comment">0 6 11</span></span><br><span class="line"><span class="comment">1 1 10 1 10</span></span><br><span class="line"><span class="comment">0 6 1</span></span><br><span class="line"><span class="comment">1 1 10 1 10</span></span><br><span class="line"><span class="comment">0 4 6</span></span><br><span class="line"><span class="comment">1 2 5 3 4</span></span><br><span class="line"><span class="comment">1 1 7 2 6</span></span><br><span class="line"><span class="comment">1 3 9 5 7</span></span><br><span class="line"><span class="comment">0 3 14</span></span><br><span class="line"><span class="comment">6</span></span><br><span class="line"><span class="comment">5</span></span><br><span class="line"><span class="comment">6</span></span><br><span class="line"><span class="comment">1</span></span><br><span class="line"><span class="comment">3</span></span><br><span class="line"><span class="comment">1</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure></details><hr><h3 id="CF1093E-Intersection-of-Permutations"><a href="#CF1093E-Intersection-of-Permutations" class="headerlink" title="CF1093E Intersection of Permutations"></a><a href="https://www.luogu.com.cn/problem/CF1093E">CF1093E Intersection of Permutations</a></h3><p>乍一看，是一个不可做题。实际上，<del>它确实是个不可做题</del>。</p><p>我们要查找 $b$ 数组在 $[l_b,r_b]$ 区间在 $a$ 数组的 $[l_a,r_a]$ 区间的映射。</p><p>因为 $a,b$ 都是 $n$ 的全排列，所以可以考虑 $\operatorname{Hash}$ 。</p><p>用 $Xa[i]$ 表示 $i$ 在 $a$ 中的编号，用 $Xb[i]$ 表示 $b$ 中的第 $i$ 个数在 $a$ 中的编号；构造平面直角坐标系，然后描点 $(Xa[i],Xb[i])$ ，我们就会发现，实际上的询问就是 $[l_a,l_b]$ 到 $[r_a,r_b]$ 中点的个数，然后就可以转换为上一道题。</p><p>后面的模板其实都没什么太大难度。主要是上述映射的理解和实现，非常繁琐（我想了一上午都不太清楚怎么实现）</p><p>然后直接一波拿下 $\text{11.03s}$ 的最优解第一名。</p><details>    <summary>AC Code</summary><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> print(x) putchar(x) </span></span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    x=<span class="number">0</span>;</span><br><span class="line">    <span class="type">char</span> ch=<span class="built_in">getchar</span>(),t=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(ch&lt;<span class="string">&#x27;0&#x27;</span>||ch&gt;<span class="string">&#x27;9&#x27;</span>) t|=ch==<span class="string">&#x27;-&#x27;</span>,ch=<span class="built_in">getchar</span>();</span><br><span class="line">    <span class="keyword">while</span>(ch&gt;=<span class="string">&#x27;0&#x27;</span>&amp;&amp;ch&lt;=<span class="string">&#x27;9&#x27;</span>) x=(x&lt;&lt;<span class="number">3</span>)+(x&lt;&lt;<span class="number">1</span>)+(ch^<span class="number">48</span>),ch=<span class="built_in">getchar</span>();</span><br><span class="line">    <span class="keyword">if</span>(t) x=-x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T,<span class="keyword">class</span> ...T1&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x,T1 &amp;...x1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">read</span>(x),<span class="built_in">read</span>(x1...);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">write</span><span class="params">(T x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(x&lt;<span class="number">0</span>) <span class="built_in">print</span>(<span class="string">&#x27;-&#x27;</span>),x=-x;</span><br><span class="line">    <span class="keyword">if</span>(x&gt;<span class="number">9</span>) <span class="built_in">write</span>(x/<span class="number">10</span>);</span><br><span class="line">    <span class="built_in">print</span>(x%<span class="number">10</span>+<span class="number">48</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN=<span class="number">2e5</span>+<span class="number">10</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXB=<span class="number">5e2</span>+<span class="number">10</span>;</span><br><span class="line"><span class="type">int</span> N,Q,Xa[MAXN],Xb[MAXN];</span><br><span class="line"><span class="type">int</span> Bel[MAXN],Lst[MAXB],Nxt[MAXB],Num,All;</span><br><span class="line"><span class="type">int</span> Tre[MAXB][MAXN];</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">lowbit</span><span class="params">(<span class="type">int</span> x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x&amp;(-x);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">build</span><span class="params">(<span class="type">int</span> n)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    All=std::<span class="built_in">sqrt</span>(n),Num=n/All;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=Num;++i)</span><br><span class="line">    &#123;</span><br><span class="line">        Lst[i]=Nxt[i<span class="number">-1</span>]+<span class="number">1</span>;</span><br><span class="line">        Nxt[i]=i*All;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(Nxt[Num]&lt;n)</span><br><span class="line">    &#123;</span><br><span class="line">        ++Num;</span><br><span class="line">        Lst[Num]=Nxt[Num<span class="number">-1</span>]+<span class="number">1</span>;</span><br><span class="line">        Nxt[Num]=n;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=Num;++i)</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j=Lst[i];j&lt;=Nxt[i];++j)</span><br><span class="line">            Bel[j]=i;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">add</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> k,<span class="type">int</span> val)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(x=Bel[x];x&lt;=Num;x+=<span class="built_in">lowbit</span>(x))</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j=k;j&lt;=N;j+=<span class="built_in">lowbit</span>(j))</span><br><span class="line">            Tre[x][j]+=val;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">calc</span><span class="params">(<span class="type">int</span> l,<span class="type">int</span> r)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(!l) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> res=<span class="number">0</span>,id=Bel[l];</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=Lst[id];i&lt;=l;++i) res+=(Xb[i]&lt;=r);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=id<span class="number">-1</span>;i;i-=<span class="built_in">lowbit</span>(i))</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j=r;j;j-=<span class="built_in">lowbit</span>(j))</span><br><span class="line">            res+=Tre[i][j];</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">query</span><span class="params">(<span class="type">int</span> a,<span class="type">int</span> b,<span class="type">int</span> l,<span class="type">int</span> r)</span> </span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (<span class="built_in">calc</span>(r,b)-<span class="built_in">calc</span>(r,a<span class="number">-1</span>)-<span class="built_in">calc</span>(l<span class="number">-1</span>,b)+<span class="built_in">calc</span>(l<span class="number">-1</span>,a<span class="number">-1</span>));</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">read</span>(N,Q);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>,v;i&lt;=N;++i) <span class="built_in">read</span>(v),Xa[v]=i;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>,v;i&lt;=N;++i) <span class="built_in">read</span>(v),Xb[i]=Xa[v];</span><br><span class="line">    <span class="built_in">build</span>(N);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=N;++i) <span class="built_in">add</span>(i,Xb[i],<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> opt,a,b,l,r;Q--;)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">read</span>(opt);</span><br><span class="line">        <span class="keyword">if</span>(opt==<span class="number">1</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">read</span>(a,b,l,r);</span><br><span class="line">            <span class="built_in">write</span>(<span class="built_in">query</span>(a,b,l,r)),<span class="built_in">puts</span>(<span class="string">&quot;&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> </span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">read</span>(a,b);</span><br><span class="line">            <span class="built_in">add</span>(a,Xb[a],<span class="number">-1</span>),<span class="built_in">add</span>(b,Xb[b],<span class="number">-1</span>);</span><br><span class="line">            std::<span class="built_in">swap</span>(Xb[a],Xb[b]);</span><br><span class="line">            <span class="built_in">add</span>(a,Xb[a],<span class="number">1</span>),<span class="built_in">add</span>(b,Xb[b],<span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">6 7 </span></span><br><span class="line"><span class="comment">5 1 4 2 3 6</span></span><br><span class="line"><span class="comment">2 5 3 1 4 6</span></span><br><span class="line"><span class="comment">1 1 2 4 5</span></span><br><span class="line"><span class="comment">2 2 4</span></span><br><span class="line"><span class="comment">1 1 2 4 5</span></span><br><span class="line"><span class="comment">1 2 3 3 5</span></span><br><span class="line"><span class="comment">1 1 6 1 2</span></span><br><span class="line"><span class="comment">2 4 1</span></span><br><span class="line"><span class="comment">1 4 4 1 3</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure></details>]]></content>
      
      
      <categories>
          
          <category> 学习笔记 </category>
          
          <category> OI </category>
          
      </categories>
      
      
        <tags>
            
            <tag> RMQ </tag>
            
            <tag> 平衡树 </tag>
            
            <tag> 数据结构 </tag>
            
            <tag> 线段树 </tag>
            
            <tag> 树状数组 </tag>
            
            <tag> 树型结构 </tag>
            
            <tag> 块状链表，块状数组，分块 </tag>
            
            <tag> Dfs序 </tag>
            
            <tag> LCA </tag>
            
            <tag> Tarjan </tag>
            
            <tag> 树链剖分 </tag>
            
            <tag> Splay </tag>
            
            <tag> STL </tag>
            
            <tag> Link-Cut Tree </tag>
            
            <tag> 主席树 </tag>
            
            <tag> 可持久化数据结构 </tag>
            
            <tag> CDQ分治 </tag>
            
            <tag> Treap </tag>
            
            <tag> map </tag>
            
            <tag> set </tag>
            
            <tag> rope </tag>
            
            <tag> 可持久化线段树 </tag>
            
            <tag> 可持久化数组 </tag>
            
            <tag> 树套树 </tag>
            
            <tag> 二逼平衡树 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>善罪</title>
      <link href="/Eternity/%E7%9F%AD%E7%AF%87%E5%B0%8F%E8%AF%B4/%E6%A2%A6%C2%B7%E5%87%8C/innocent-kindness/"/>
      <url>/Eternity/%E7%9F%AD%E7%AF%87%E5%B0%8F%E8%AF%B4/%E6%A2%A6%C2%B7%E5%87%8C/innocent-kindness/</url>
      
        <content type="html"><![CDATA[<div class="hbe hbe-container" id="hexo-blog-encrypt" data-wpm="Oh, this is an invalid password. Check and try again, please." data-whm="OOPS, these decrypted content may changed, but you can still have a look.">  <script id="hbeData" type="hbeData" data-hmacdigest="c179bc2cfa5cb44138f3d69621ccab5f1a342de475d492bd47bab5554effecea">b2cba2151d0d2bd8ad8f075cfbfd57d5a7646163d7e7c6be566e7d46c3b93ce5a6fc18f52e0bcca05706b9a71d3016c2ea42687c1f479145b796224f60a1f3742076612180d04a233b923031a3609cf2a52f03fd3fa5ee384fa29bede20bad9fde989e248705172750ebec0504ed2a0bf7fcd7761e938856cb0d92216c3c7fe3feadd4b6c12788136ee19392d1ec5862e33c6d8a0570162e4b2cf0740c1ee2cb762a2e88eae93cdcd540260bd716b7de421f3f36444b7da680028ff204e84409f34ec6fc9cac2545e3f46c97f60af68eca6a743f2d51adaf3fa3f6884a8e4b0697eb87cf3cbb0f90465e5f07a155e2191b647e3f3bd10f41b2b198816031e29ecd64e280c5d00aa5401487dfc092879b1a29df1c7ac9e0fa5e45aa12d02799ac4c28e79e90e85e053c89b5beaa4015abbd5080295a18c9e1fd838c2a3cadaafb8fd36ab9a19262be4ffa38479a938deed249c2b122b5d9269854c1f3e7f7e02a53bb7d86ad7ec2c7c004e26cf7620ec83b0d15576aa9c878d1b792d6a1624e5eb92a206f71d3dd92ba481c419c39ffee0db9a8e68d42ef3b2e7c7214475de1d1b19fac237a7b45cc046bd9e6eb0d414181a442db6e5c5d93e8fc66ed0f5241db0ac23139f5b104e6f5f7f3f6fba421ac98c5a05fa8279ded227082ac8abcfe601db590ba0294b8db7e12d81c21eb2956ada065030d4fb12ab6d467bd47be4d7240cd8efc085503f506ed41d1c1d0996f63fddf0e6f266777d92417e9940b65cadee574cc5ca9eb7ff8dd54a302920e11494380ac40b6f59a22e03e5edb381b11ff9c4dbca7bfba5a3941f3fafdcd1e1131fff29a96f790102e5014b82dcb2abea6f9ba77e82efc3650357673a006994c6af59e0bd4081761564b331434b4cc3d37ab65d8bdc89505b2778eac4903a79f585f0fc9c9a2df0ae93588f30aa2818372f87f4e294a48b94310e3cb87d9abf57f066ad9bbde462457b1d83c3954d5a037879c6141bad49435451f550baffa0d8fa3165ad7949e22dd3a53e930ffa7cedc190efb33dc26772f27c7d6d6a57cf3036cdbbcfafe17c823c1cca93899f378e6338d790b501457d86c0b9e2ab9415545cd7b845478d5b47664fca0686eba6e7cad15e7d533e4582209b339f3e01e4dc8154bac66e5d1fef66eebadc100d2c66e996a8b11b677e0ecb42154b28ce0d725bb9b7e2b448be5ed6e7be7146104870ce799599a7113690c35ce9fc91b7e71e6f2e7818fb0b3e810d5bb6c967bd4730022d2726e5f1db42d7aff3e479873dd9a57311c58ea6e495151b2536b5339da01ea53bc72b71ee4d09f61afe007fa27087f52e15b3e58cf8763859611903d67faafd08ad66180ee7ef0147190c368079d88dae63caffdcc382783285524be2ef54b93e9e9302dcdbafd775842af304415336978ef3981dd8e1469ad44b34751132e43983c5e70358aa35fc3823fefebfa1c315660cccff0b3d0fc617f936a4c0716ca3a1364924284a1447e82c913ea310a9a4b697bac5528ad407233d69c1adb3576ec045ef7410585b806752ec035c03f36d9e0b6558e003d610cfedd4d0adc077e1f40cb0f6fcd9d5356c6d4998f748930a3897be891c969e65a30f2cffbcd30374cfb46a478740a65447dc6ac4473801292f46dd492945f8a52064b1505b9d88a9208969953647f21d7db6ade23b960d7cb77cc9c075bf896e1693be71465263221a9b1412dc9920e904f827e9091557ad2494e15c9e6d4f4a3efae9674956db35867e62c45a0d76e7086b06dc379fd4de86db1d64cd03f9a617ca4dfd3128e0119414cb46954a7691766c9caed5c25287974661f1d78349a47b6eb6e74c5e3ad16f83277c4dedca801717c7f27ccb479cba6aff8947ba631f31c16e21a537f2f447a2f1e99266a5591289775b6b95cd06ca5433d17ba90126ae7293d8f030e1ee725fddd62e5c2782de081ce66678f3b5e80c5878b0f0d64619745200af7156f11f70a6fe63db38d7c393e416b56c39e5cfb06fa9b638bffcee6f64ae4293a41de572ec8a22ea45a8019b3c161fcd73296805ad48e7eadabd1d08e96c77cb3c7fcd6edc0d02afd758cc7d589657d35617fa311b92aa36fe971125fb1518a1bae87d90fba453f29c9a4ece8bc6cf209ad45022278dc883320777ac3927cda1cd145ecdd375b07f09c882dfcfa8593563c9d551933c4351525c939f14abfeaa2e27ff02b6b42616560f6086421fd336982e2e04a484f79772ba085208ef6a905068ac5d804f2f4a2cde31e0880dfb5e7d8af030eb2bda4f88726feae1f248e7ecf0b2694005eaf5b2b34117aad24f3d3499d3ec61d561eddf7ed84cabce1b3fe5d0bb65a4eb7ce3b302f5176c1e0110095ff3341ef021aa46352a6af00d90e1c17a71e95a424d1dac6d9cbb76a40e737f9e38291bd391f1461a1e2e93aa3f734eb5382c474d7ef7322d4e059f2743f2b796bdb722ae1695495a3f64044a4154208560b4a7c6043c3248c94fea027bed6e4369f449d6b3abaa5968856b854dcf6fdb5a9434e70a5a68583be91e921fccee775e5d6b8e9d432406bf4436d9b73a3cf7021852c4b59511e1ec04d0927d36418961aa8970a32e98dbf38ba2d560ce54a03f4c4f75e79140a6517e9c737294418a2cb4b5bf6c1e680c7991d17cbbab70c5846eb998d770043dbf49fc27dc554a7df4783b89cd4786719f3a3ccd863e54b3426fc0911d904e42bf92f51fb462350c4162ee17efded015bee2fc3e2e308bbe825868f64c244f831af3dc4c276f2d301531b61823d8866f393c56660fde39d4193c3e18ec220733910a165ec87c2df0836be8383b9b4dee461627b6b5ddac481f0359655ca0d5da8ef2358f9d419ae0caa2c93ebe8b0dda3e8c54a4889ecd743919d42a9578a60661485131152694feb501d51ebe4eafb19648e61b7fdfd735bc0281b97e5de731db0d3a0765f08728e88113e6e771959d8099a0d9b4ff0ee0563a164611e3a8cb9cf0124c48a68da6c50c42614f1714c60cc10c7e36c2ed64f9e1f5e0fb561f5dc7f4140ac593983a5ca356b2c33a1a1d9ae1c2d09f450813aa47877f28a0519ede91adaec9e9d10ed3c3bd4831ceb122dec824cb17ed10c9ef5214435a9b51c7262a5bd218920ead8f161a462be5e82502af35da9d8d23b12b57890e8de6d650eb7c31c5d7bbdeecad7f96017d842009d7d94c0b46e874a28e5b3020d9733f6159d48774c9ab8fd3d4cddfc31d9d3d1897f7b8c239e100bf7ea8061fb0a3ceaa355cac38230d6815e8862309bbd44e666a75d48128e9bdf919a4ea411e53e2d193aebccd8093d02dec456d0c1cfe59f77f7aeefeb4532f29214a8e768e998b6f70a10a2146f6d4d38424506d1614a58c337371789f5d9372b58250119e74613fce116dc3060e6dfe6a08f15bcc8995a5358aa57af85787c8fd4d39417c6e032c887f13be1e16e0e3b2f21c2f90a8043ec0c4b932dfac89b5306d1086af4b4b73a950a4a993798cd826e6c63b09bf0a6fb3a184e41f4b6df5d9d356ea00541142c34824d9c8e284255e59ee495cb8c4b5f1f00bc0d68613dcfa183a269c47f02e7554662dd9b87c51c448f90e80ad580040b850fe8dcec8f9aea3ceef1c980967f87e3980d302c12e4a10fd376c8ca8b6011f1bfd6711cad7ebd7dd9276818d0bc004b216529558a055513e88cf025567236f4677f4ddae324dcdacce19fa1b3a65981c33de0b84c88b5376aa2d711d7de0b889d3714009b67c3e6ad20defc1ce8d9773528005aee0824445ee3d1b184b839f38121e5b0d83e207144be2cbd691101964c868d53da3c3080c7e5ed199a4b08494187f13aa0f4ed5b8b11614a7200a11783071cdf886e38cc8ad67f80cd04fd87595b3e929ffadcf1550c4404b07d535441dba93e02b04126e2f3e3717ddc6aee95f2dafeb82dbb3a78e05ea756f7c50fb4440e83d09882f2ebfe0cbc9a4506d74023196718dfa2af495139d2349446905768d5d161520bcb052dfacfc68eacffe3da15dff026d47989e77717619b32656fae53e06a9c915b515b677ca4efd57fd903997172110af70e637c74f157be475ea4a29ba99f6ed09a73cba28b57e9128830f50d5db1db82e63736221393f9676bf5ff3b99e4ff9f4aabd35962ed6ffd564a0946ca7a0a5eb70d572b75dbf842b252f06d19f438c9abcb839d4d59fa992324993ef786e7bf58d50b1123c55419334f0f3a546a021d45d9ca6b352e47063027ecbb28136ebd64395f958c0df01ea8810f5b8cd4f68c4018ed451688db20111fb314c68f7b2718557820e9bd1e5ac89ae599c6a35be550aa7076f9dc5dcf1ee01835fac2d878c1ab333fcc7047b51ff263bfcb161c11f53d4a57654547497371ec0fe627bd386147384209b3da10c43a5a1ef6e23cbd155349e41eb6ba8c5d03f90e24e2084564ace37037328ca9eb7a0c13774e02dc56631112ea9aeb6abadca0caa98a0bde4758724405e2bcfcc88d7483c084523ee56562be4a422a03c982667fba8217144f890e63d223a99db2f99c65b95183e2fc1670afeafb5e7836a466b7d2d4c4eaebed0ed2c05c5f517ca94134e18b6a49359550ac72aab4190b772d9d118abd409644fe4e9a1d3b988f55ee505a59380c3d104973eff4f4962834b76d2a8f060a781d3bb96516d6a262e25b3ef437318e9b43659562842f9dc4e3c74243b5bcfaa75287778b0c4cb5b07bea096875f7c73891e4451f8e0767c5ce7512d9d3950407acdc485d7a36eaaeb5c995737bc1c54b3c3d8bbd8897209b7e2cd5f1fbb1ee7f61b20eb3b4c03050ace04b82e002ffcc1c2ed401e87bda238c096979e046d0bc95e5143cc96475293ac4a97f0a2295adc056ad5a0cd7b4a132a7bdbefa1be40c2e9369880d6b32fae5685b91d7aa6f87320db76deee0d6a07b003bebf044a061acccc7ac2bb68383c86d62815901612866aae3e6fe989cb2e6db5e1826109a3feca7caf3fabf35cd0b39b0778dfceb5a86f72d293feca3366f3bc81cccb44055c63de79b4346bc0e58b06061d33da700dee6e0ba18d143a416cc5720709cca3a29f21a7edde9d8bbc451b4b10e07cf104e557201687747d093af52ce3d5b14e1aa16737169500ef4d61df808da266989fd7e6d48b65c4a4b5948095c05e71f3642e9012e348ff159cf204a99e456ace249215108a72ee66d681c0ab068a30225104c2121bcbf29f5bd1fcb7a49960e753ae7cdf5954be67610242219dc63ea518071d6c491e6dab70da45748d6351a18abc222ec417d08e1c8df5a471be87ffbc0a7c56231a9cb59fac1d38c0e4512d5275080c0d387d5db4642b0c3f3cea9b0bc5ef63357de68f89a93a4d153f920689ad4140fd1d7ff8a78eefe2feb0d0c6a6619766d680d8656c1d863a4fc1f7df2a38975d1dc50a39f5b2cae7582580b48664bccc421605001d19fa9afcc17be61ea72bfa918a622eaf49fdecc495aa0766fa06dee46a141d517fc112b8ddecff92ac7d3e120726d3bf6f61a14a9d4200cdf49e6763b7aedb8a5252663aa2777ce403bb43185e1bb7535b29eb4c519622bddda8f07cb51c14e51702f0fa571ceef535cc48433a88e3d99060100bd6b428825b67de12705bff5e978dc9e1a2e309ac60fe09bead65dba9b2d8e85513ba165f0929a8a713f000d261c989a80550178caf91e6b3596b4cbd1491bb14e8e8e85fda2dd310c094e670c92f0d26dbf590cb2c7d88b762c7f2d76cec57a4c4639f572d4c72c3bccc1a5c0bb97ad14ab1778ef2eacac14c163f3256ad5e1ccd81793b7196076be10c0e6fc37eff222c6254262baf4a67b11f29a492c38582d123b7670f42981861f42eacd423858f0c9ac5640b3c6cb939270656097745c16c00b503026ff847b9676fd9623175c232f73189ed582188430a8dfc8d2b6802b79cb1e341160fdf12f3896c564947fb8b3b82e7478fc422e2e3d031353af65b4d6e40053d65d2eb053eed74710ca97d93437465fadaa980c98c4ce06c607cc8109923cfe3c2f76c07ad0856ea8fcff6f34a6c9a8a79227c40edd9d2a40900c512ee7e6cd48c57ed84ac97028a8cb09bfab7ab13a94eaad5fb81824cdeea69b4bcd942c0688e87bc0d59af82cc3b44454cbd261df5f41d2da50baae980d901d32e33393304bd3c0f0df300dccb397d74415d6700111a1dc835a90ca6ca3401f0c7e281b473b7fee16ed6618f548b4d5a46aed69803b865a87439400b363a318a321966423da0edf6cc6213e27f3632177a63f3932fd5cca66d978dab094f4e112950e47098bd33e384a9a12df6b1ec55f01f2111bd95151e0baee8b3e25daaca8ed0fee31805d96b195af9c4a892681dd3f933a13f853175a400101e266a6ed9ead43c35837c6fb0320d63cc42264080f0971e619fbd134d73b6c34aa75a35a6a9f19e187c1a7e313c56690be0851566dd0370c3831f386bff354e368be79e266d16698918a44412cd7faf2bafd270be6766c83d2c226e314e4d2fafe144aa25c53376d8bbd0f371299c82e83f7804e3785f66b138af67605b11300c7d6c1007d50de3471971f4b8913c57a6ab8e816757681732ee28d2cd6d8146cde9188c65b7ac54340842c26f25cb80d558ea54e360bc53549c017bf29646693b769f968cb77cda57a51bcd4e3e4a50cf9b49cbb5b6f65fd7a19108c977ede15c328e04744192b88dc0913f48d40f1abc9e4dd3f3c64233d7a05194f7f193e1c641aeaeecd5e8ada8c277ae5d1bbc95575d5d0e64d8ab780bef209947ba654f20dfb2f3b79eb24072c4328e8c50ac94692513416b1cc5054aedc3cdac746bb3a4186426785d112dc0fae6812b15108e4efe16c0112ae68f0c83d6e69259dde64049d462372b976b31d8a6dc7789da2f6ea4194e7eaf913addd9f03ec3d93aad1e69874b6a783b82ce910191b9ea9bac8c027bf94f4991b733bf858aaccd983845a87358b3db882876097043c4f1396d59853fb6d45513cce490f15860787cb4af44bfc0137cc3f8eb7f46ff44b4d7cd4361bf33c57a66c8dff49a98aa3c1a2946c2e2588f334a087ccad9aa903da5d2bb4362493a80d50865ab7a2831dc4a3826b77e5e23a7740ee1cea20febcfe712d6f5882eeec815edf86bdc555c980fd63f28d2f6dac201a2cc2f3e0426454c4a8645eb1d868701b648a536cb5ac223323c0334ff26b2434b27d5e7d4f8505bb5aec518280047f337b2156d7efa47ec803f63ee4f77dbf1d092eac00dc7aa0340c9f89bb6b2463d92755414af63bfac69b09f03e953d924050752853e4365c9c7a47b6b038edb9228ad22d1f84626fb9b22401af2a876b7213d2e2565af4cfed4f6b4f3bbc087d9f38497293b0b201caaa170c5b21bc9426def4397a33bb0ba41bfcb4cbc2614f495c716ac55637e80321257ce7e1547baf95cbbced75163d7ec72fda65fb727add7f51d2f65258f0cc96f4b872a88d1990f495c96e4979baf859987f61ea0c02551f629cc144a753f50c3b4f0c1c7b3ecb2cb1018a73e3be3031bda256a2154538bd0a5636c9767e522b00e78e3cc3d0b06d81784a8bdf9f32da371ab0d37e17f51ad3c698e3e868c20b873b28a204e18381a60c0a169d100fd5efbe9c4c67846445ce1378530b255ad4b71932aaaa016c9dd0986991018a22f3219b5c23468b9f959d2850bc91cd37cbe2136b2578bf70fb5866cf79f43956986db946898e7697a282d8d14e1f24647f11c7cb9bcec5f52033b13f56bf4943a211de3a5ea388829b3f0a134862a0c96c897ef668cdda11e3db292d04c51bd503380e6724d191f18c614b311b4db5c73ee3d45c8db83b3213d349dbd134cd453c4cd5337628a1a5db2ccc8676400f4df570f38f2b75be1d6d470af2fa469f96c6ab8f39d3dfd119fe2589dd9f462f6f9b4e1b0e7b017aaaef018e0c667bc6f3f88d712957011140c5b8a373ccbe2de2f1413eec84cc2f3ffe50f1be7db80be20eb0af7ec94fb4492e6034b7c405f13b01dbfcbc4d0e6a7b3decfe1ea9e10a7866155b7405264736a92c9b89c8d5963ed0398f1694ff295ecf5de5e755c70ca9c626aef1f5eeb6e52f431948f49d55082b883ca6e487941b795385d4627ff7a243713f3df6b11def5c3758917db6eb16f526dc97df9eeac07ac0b28405ebba56db5a513d55f3fd4c40b8d453f70b5ed6d72b567ddf079891c37e4fb7e9392447f87ef6b56d7d832b3cace60c6ddf28f9dedd3c77eb6a2f3060a79d46040e19ff2080e8c9e6a9933259159dc09c1afb4dc2df8c781ecb85d33dbe1216b44ec57994df65634deb4c6b47581ae812793f5af1dac53a322c2e641873d22de9d8c6957fcffe0c53fa2401e07fa2f9d6e42e1f624397ac66a698de1488b4f2337409d2ae0942e6aa7a4547e06824711075b2591b53638f9cbc916cddf208d2f29986cc4343268c273bd0b0e3103962194b247a5cb9abc9ea24846bbfab086de956f525313b4757d2c54af77352137f383ad364e7098f853087a3f1022a006fd8f7c924d8fc8c3db30e55da10ab55c4293a26ddd3a2260bf87b73320156b0c922f43955eed70ff57807d796d224c8589e49e1d7737e4215bf09992b8e4246316ca0d2b1827c79aa829ceb9fa58dd526bc03acb1bb553dbab22ad91c6ab1c20812c94db5ccb027b6202485dc55bb5effc641fccb97e5b820d33d0c7ce98f7f0b97cf46d6a049ab5f029c4c90cdbbc64d8087c27bf396e2444d05222fde05ebfaa67197527e005e67bcb3dcbf487ecfe3d75315692923f15e78469aceb6e58f47bf1dea2027ae5fa80c011093c3f2ca259214376324f9db51f44faf524c1f8753dba1ac6de4e241e45dd09867a901c873dcbe900c12278c197ee87d9668fb5ad04bbb8ababacd3ff6ae7faf449e5446ae7d4a3027359b3f54627b24bcc9e4c230a08f982bb7940b99ca7e8c4b40f842e151d4d767d50a45ca3b46c4355fa094bb46867a38534e1b17417c915a7be91989852b8dce45e3c6501c3cb484f914ebf5a0f7bd80373bf0baf32ea44e003a30abd60432ee4f7994f35194921a26cefe2c764db0cc4f5689fd74b4ba91c4f173d7ffc1a5e0e50bdb1c6148dd84ef8c5ff300006adf7e2ba535985e5d98daa17b65a3f4a8ee4aa02970f848dfd466051837ce989c73795aeb3b242d1210f5ebf30cca5c80f8047189249d35f9093658304a4e01e56db3d00acf05aabaed85cdcf44aeaa0b89b9a5f64bc6be44b358e467317fe3710e01fd2888fe90c36069e7d458ce7aebcc8db7def008b309c63007a5c943f3157c1a145ee6736bdaab691425a734d91750cd92ac9c6842acaa00c8fa2a1c30930d772bd9ed9b9f5f04dc5cdedbcc9229570e4b511b114445871ae5d71c0d75923a10f9af297a0b0f3eccd7d6c3d9f8d45ddad1b210157dcd7483b0881a4d481e673f9c46e676f357a40e7781a797b46ed8598eca49c5bd3f8ce2fbe5522864cf1b08514fa6061769dbfe1baa3321364a77b1ee00dca6f177a521f4fba3015c96cacfde8b7a7026cc181b409e4588f282648281041d596cd0f93bf9b421e6d1130a99a42700fc95b6cbba6ee57dc3dbc8d212bf9bbdea299472f36ae64c5a39394bf422748082a16e49eabf416307d68f6ca07d66a4335e9b680e35139522af505fb4a56bf253ecd2310c209f38f9ff36bba526a97f709b527a73df4d55ca8980ceb542a5d405662523a5d24196217058acb502d9d2b98858905d231502a015c73049c4a965a84ec9a7ad02b8d70846b668773723358c213d4fbfc9053ca99d38d5b62f1e70ebc0dc6d7a1185306e03c9229ae6e912144629a7a5d9b31177b4e6ff840844e8d5700e08f4b1a698bb67cd5d46b27bfcd7e07cbae0cb5e3f71fe91e646a8f8128d71fd05065649e8938492fdbb2f77549bd29b6bd71190d89b5b0f5f1d2c43a2eab4f83e7201d1f3574fa3136ff30305074efd90902ed9e31b04ccb7aa6fafdbe16bcf4071a9b4ccdd152186840748b1a9bbbb937cbf5d12c1d2f03b80775045a6803970d9ed8ae6a26959a5a0ab25fa02ab72db823b797fedeb40a17de3d2f42ec5dbaec1d0008e1cec8d44182e</script>  <div class="hbe hbe-content">    <div class="hbe hbe-input hbe-input-xray">      <input class="hbe hbe-input-field hbe-input-field-xray" type="password" id="hbePass">      <label class="hbe hbe-input-label hbe-input-label-xray" for="hbePass">        <span class="hbe hbe-input-label-content hbe-input-label-content-xray">Eternalにはいくつかの秘密があります。</span>      </label>      <svg class="hbe hbe-graphic hbe-graphic-xray" width="300%" height="100%" viewBox="0 0 1200 60" preserveAspectRatio="none">        <path d="M0,56.5c0,0,298.666,0,399.333,0C448.336,56.5,513.994,46,597,46c77.327,0,135,10.5,200.999,10.5c95.996,0,402.001,0,402.001,0"></path>        <path d="M0,2.5c0,0,298.666,0,399.333,0C448.336,2.5,513.994,13,597,13c77.327,0,135-10.5,200.999-10.5c95.996,0,402.001,0,402.001,0"></path>      </svg>    </div>  </div></div><script data-pjax src="/Eternity/lib/hbe.js"></script><link href="/Eternity/css/hbe.style.css" rel="stylesheet" type="text/css">]]></content>
      
      
      <categories>
          
          <category> 短篇小说 </category>
          
          <category> 梦·凌 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 轻小说 </tag>
            
            <tag> 恋爱 </tag>
            
            <tag> 校园 </tag>
            
            <tag> 治愈 </tag>
            
            <tag> 致郁 </tag>
            
            <tag> 东辰 </tag>
            
            <tag> 青春 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>生成函数</title>
      <link href="/Eternity/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/Math/generating-function/"/>
      <url>/Eternity/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/Math/generating-function/</url>
      
        <content type="html"><![CDATA[<p>“生命是自然的奇迹，归心是灵魂的光彩。”</p><span id="more"></span><h2 id="生成函数"><a href="#生成函数" class="headerlink" title="生成函数"></a>生成函数</h2><p>又可以被称为母函数（$\text{Generating Function,GF}$），是一种形式幂级数，其每一项的<strong>系数</strong>都对应原序列的信息，一般用 $F(x)=\sum a_nk_n(x)$ 表示。</p><p>其中 $a_n$ 表示系数，$k_n(x)$ 是<strong>核函数</strong>，不同的核函数可以通过求导得到不同的生成函数。</p><p>常见的生成函数：</p><ul><li>普通生成函数 $k_n(x)=x^n$ ；</li><li>指数生成函数 $k_n(x)=\frac{x^n}{n!}$ ；</li><li>狄利克雷生成函数 $k_n(x)=\frac{1}{x^n}$ 。</li></ul><p>一般有定义为 $a_n=[k_n(x)]F(x)$ ，表示第 $n$ 项核函数对应的系数。</p><h2 id="普通生成函数"><a href="#普通生成函数" class="headerlink" title="普通生成函数"></a>普通生成函数</h2><p>序列 $a$ 的普通生成函数（$\text{Ordinary Generating Function,OGF}$）定义为形式幂级数 $F(x)=\sum_na^nx^n$ 。</p><p>无论 $a$ 有序无序，有界无界，是否收敛，是否有限，$a$ 的 $\operatorname{OGF}$ 都是存在的。</p><p>例如：</p><ul><li>序列 $\{1,2,3\}$ 的普通生成函数是 $1+2x+3x^2$ ；</li><li>序列 $\{1,1,1..\}$ 的普通生成函数是 $\sum_{n\ge 0}x^n=\frac{1}{1-x}$ ；</li><li>序列 $\{1,p,p^2,p^3…p^k\}$ 的普通生成函数是 $\frac{1}{1-px}$ 。</li></ul><p>有一个较明显的性质：</p><blockquote><p>数列的<strong>加法</strong>对应生成函数的<strong>加法</strong>，而数列的<strong>卷积</strong>对应生成函数的<strong>乘法</strong>。</p></blockquote><p>生成函数有<strong>级数形式</strong>，也存在其<strong>封闭形式</strong>。由等比数列的求和公式可以得到：$1+x+x^2+…$ 可以表示为 $\frac{1}{1-x}$ 。</p><hr><h3 id="等比数列"><a href="#等比数列" class="headerlink" title="等比数列"></a>等比数列</h3><ul><li>定义式：$\frac{a_n}{a_{n-1}}=q(n\ge 2,a_{n-1}\ne 0,q\ne 0)$ ；</li><li>通项公式：$a_n=a_1\times q^{n-1}$ ；</li><li>求和公式：$S=\begin{cases}na_1&amp;,q=1\\\frac{a_1(1-q^n)}{1-q}&amp;,q\ne 1\end{cases}$ 。</li></ul><p>而对于 $1+x+x^2…+x^{\infty}$ 的求和公式是通过极限的思想得到的：</p><script type="math/tex; mode=display">\begin{aligned}S(\infty)&=\frac{1\times(1-x^{\infty})}{1-x}\\&\because x^{\infty}\to0,0<x<1\\&\therefore (1-x^{\infty}) \to 1,0<x<1\\&=\frac{1}{1-x}\end{aligned}\nonumber</script><p>相当于是 $x^{\infty}$ 可以忽略不计。</p><p>其实我觉得上面这个方法是不严谨的，所以有了第二种解释</p><p>第二种解释是，对于这个数列，它是无限的，所以满足性质：</p><p>$F(x)x+1=F(x)$</p><p>即我们将 $F(x)$ 的每一位都乘上 $x$ 在添上本身的第一项 $1$ ，它是与原数列等价的（因为数列无线）。</p><p>所以我们将 $F(x)$ 作为未知数，解这个方程：</p><script type="math/tex; mode=display">\begin{aligned}F(x)x+1&=F(x)\\\\(x-1)F(x)&=-1\\\\F(x)&=\frac{-1}{x-1}\\\\F(x)&=\frac{1}{1-x}\end{aligned}\nonumber</script><p>得到 $F(x)=\frac{1}{1-x}$ 。</p><hr><h3 id="运用"><a href="#运用" class="headerlink" title="运用"></a>运用</h3><p>生成函数广泛运用于<strong>组合计数</strong>中。</p><h4 id="模型一"><a href="#模型一" class="headerlink" title="模型一"></a>模型一</h4><blockquote><p>对于 $m$ 件物品，每一种物品只有 $1$ 件，求取 $n$ 件物品的总方案数。</p></blockquote><p>构造单个物品的生成函数为 $1+x$ ，则 $m$ 种物品的生成函数就是 $(1+x)^m=\sum\limits_{i=0}^mC^i_mx^m$ ，通过二项式定理展开得到 $n$ 次项的系数为 $C^n_m$ 。</p><h4 id="模型二"><a href="#模型二" class="headerlink" title="模型二"></a>模型二</h4><blockquote><p>对于 $m$ 件物品，每一种物品有无数件，求取 $n$ 件物品的总方案数。</p></blockquote><p>依然选择构造单个生成函数为 $1+x+x^2+…=\frac{1}{1-x}$ ，得到 $m$ 种物品的生成函数就是：</p><script type="math/tex; mode=display">\begin{aligned}\nonumber\frac{1}{(1-x)^m}&=(1-x)^{-m}    \nonumber\\&=\sum_{i=0}^{\infty}\frac{-m\times(-m-1)...(-m-i+1)}{i!}(-x)^i    \nonumber\\&=\sum_{i=0}^{\infty}\frac{(-1)^i\times m\times(m+1)...(m+i-1)}{i!}(-1)^ix^i    \nonumber\\&=\sum_{i=0}^{\infty}\frac{(m+i-1)!}{i!(m-1)!}x^i\\&=\sum_{i=0}^{\infty}C^{m-1}_{m+i-1}x^i\end{aligned}\nonumber</script><p>这是通过广义二项式定理展开得到的。</p><p>也可以得到第 $n$ 次项的系数就是 $C^{m-1}_{m+n-1}$ ，从组合数学的意义上而言，这道题等价于把 $n$ 个相同的球放进 $m$ 个不同的盒子的方案数。通过隔板法也可以得到最后的式子。</p><hr><h3 id="广义二项式定理"><a href="#广义二项式定理" class="headerlink" title="广义二项式定理"></a>广义二项式定理</h3><p>首先应该知道二项式定理：</p><p>$\left(^n_m\right)=\frac{n!}{m!(n-m)!}$</p><p>其中 $n,m$ 都指整数。</p><p>那么<strong>牛顿广义二项式定理</strong>就是把 $n$ 扩展到了实数范围，则有：</p><p>$(x+y)^{\alpha}=\sum\limits_{k=0}^{\infty}\left(^{\alpha}_k\right)x^{\alpha-k}y^k$ 。</p><p>其中 $\left(^{\alpha}_k\right)$ 表示 $\frac{\alpha(\alpha-1)(\alpha-2)…(\alpha-k+1)}{k!}=\frac{(\alpha)_k}{k!}$ 。</p><hr><h3 id="例题"><a href="#例题" class="headerlink" title="例题"></a>例题</h3><h4 id="BZOJ-3028"><a href="#BZOJ-3028" class="headerlink" title="BZOJ 3028"></a>BZOJ 3028</h4><p>没有链接。</p><p>似乎是一道非常模板的生成函数题，直接根据每一种食物建立生成函数之后相乘即可。计算得到 $f(n)=\frac{x}{(1-x)^4}$ 。</p><p>而我们需要求得的答案为 $[x^n]F(x)$ ，即 $[x^{n-1}]\frac{1}{(1,x)^4}$ ，是 $4$ 个 $\frac{1}{1-x}$ 卷积的结果。</p><p>如果从组合数学的方式考虑，用插板法得出答案为 $(^{n+2}_3)$ 。</p><hr><h4 id="P2000"><a href="#P2000" class="headerlink" title="P2000"></a><a href="https://www.luogu.com.cn/problem/P2000">P2000</a></h4><hr><h2 id="指数生成函数"><a href="#指数生成函数" class="headerlink" title="指数生成函数"></a>指数生成函数</h2><p>序列 $a$ 的指数生成函数（$\text{Exponential Generating Function,EGF}$）被定义为形式幂级数 $F(x)=\sum_{n}a^n\frac{x^n}{n!}$ 。</p><p>有几个例子：</p><ul><li>序列 $\{1,1..1\}$ 的 $\text{EGF}$ 为 $e^x$ ；</li><li>序列 $\{1,p,p^2…p^k\}$ 的 $\text{EGF}$ 为 $e^{px}$ 。</li></ul><p>排列数对应序列的 $\text{EGF}$ 是 $F(x)=\sum_{n\ge 0}\frac{n!x^n}{n!}=\frac{1}{1-x}$ 。</p><h3 id="例题-1"><a href="#例题-1" class="headerlink" title="例题"></a>例题</h3><h4 id="圆排列数"><a href="#圆排列数" class="headerlink" title="圆排列数"></a>圆排列数</h4><blockquote><p>将 $n$ 个数排成一个环，求方案数。方案不同当且仅当其无限循环的母串不同。</p></blockquote><p>$n$ 个数的圆排列数是 $(n-1)!$ 。</p><p>圆排列数的 $\text{EGF}$ 是 $G(x)=\sum_{n\ge 0}\frac{(n-1)!x^n}{n!}=\sum_{n\ge 0}\frac{x^n}{n}=\ln(\frac{1}{1-x})$ 。</p><p>对于这道题的另一解法，从组合的意义上来理解。</p><p>将一个排列 $p$ 看作是一个图，从数点 $i$ 有一条出边指向 $p_i$ ，那么整个图是一个由若干个环组成的（称为<strong>置换环</strong>），而每个环的内部方案数就是圆排列数。</p><p>从而把长度为 $n$ 的排列的方案数就是把 $1,2,3..n$ 分成若干个集合，每个集合的圆排列数积的总和，就是 $\exp$ 在 $\text{EGF}$ 中的组合意义。</p><p>同理，有标号生成树的 $\text{EGF}$ 经过 $\exp$ 后得到有标号生成森林的 $\text{EGF}$ ，有标号无向连通图的 $\text{EGF}$ 经过 $\exp$ 后得到有标号无向图的 $\text{EGF}$ 。</p><p>取 $\ln$ 就是相应的逆运算。</p><hr>]]></content>
      
      
      <categories>
          
          <category> 学习笔记 </category>
          
          <category> Math </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 组合数学 </tag>
            
            <tag> 构造 </tag>
            
            <tag> 生成函数 </tag>
            
            <tag> 组合计数 </tag>
            
            <tag> 多项式 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>筛</title>
      <link href="/Eternity/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/OI/sieve/"/>
      <url>/Eternity/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/OI/sieve/</url>
      
        <content type="html"><![CDATA[<p>“临近深渊的时刻，钟表将停止转动。”</p><span id="more"></span><p>这里定义，本文中提及的 $p$ 在无特殊说明的前提下皆表示<strong>质数</strong>。</p><h2 id="线性筛质数"><a href="#线性筛质数" class="headerlink" title="线性筛质数"></a>线性筛质数</h2><p>这个应该很简单啦，使用线性筛即可。背板子。</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">bool</span> is[MAXN],pr[MAXN],tot;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">sieve</span><span class="params">(<span class="type">int</span> n)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">memset</span>(is,<span class="number">1</span>,<span class="built_in">sizeof</span>(is));</span><br><span class="line">    is[<span class="number">1</span>]=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">2</span>;i&lt;=n;++i)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(is[i]) pr[++tot]=i;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">1</span>;j&lt;=tot&amp;&amp;i*pri[j]&lt;=n;++j)</span><br><span class="line">        &#123;</span><br><span class="line">            is[i*pri[j]]=<span class="number">0</span>;</span><br><span class="line">            <span class="keyword">if</span>(i%pri[j]==<span class="number">0</span>) <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="有意思的练习题"><a href="#有意思的练习题" class="headerlink" title="有意思的练习题"></a>有意思的练习题</h3><h4 id="UVA1644"><a href="#UVA1644" class="headerlink" title="UVA1644"></a><a href="https://www.luogu.com.cn/problem/UVA1644">UVA1644</a></h4><p>这道题有够水的，甚至于 $\mathcal O(n\sqrt n)$ 都能勉强卡过。</p><p>不过我们还是先一遍线性筛，然后二分查找第一个比 $n$ 大的质数。</p><p>时间复杂度 $\mathcal O(n\log\frac{sum}{\ln sum}+sum)$ ，其中 $sum=2\times 10^6$ 。</p><details>    <summary>AC Code</summary><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;ctime&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iomanip&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stack&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;map&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> gh() getchar()</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> re register</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> ll;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN=<span class="number">2e6</span>+<span class="number">1</span>;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    x=<span class="number">0</span>;</span><br><span class="line">    <span class="type">char</span> ch=<span class="built_in">gh</span>(),t=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(ch&lt;<span class="string">&#x27;0&#x27;</span>||ch&gt;<span class="string">&#x27;9&#x27;</span>) t|=ch==<span class="string">&#x27;-&#x27;</span>,ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">while</span>(ch&gt;=<span class="string">&#x27;0&#x27;</span>&amp;&amp;ch&lt;=<span class="string">&#x27;9&#x27;</span>) x=(x&lt;&lt;<span class="number">3</span>)+(x&lt;&lt;<span class="number">1</span>)+(ch^<span class="number">48</span>),ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">if</span>(t) x=-x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T,<span class="keyword">class</span> ...T1&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x,T1 &amp;...x1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">read</span>(x),<span class="built_in">read</span>(x1...);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">write</span><span class="params">(T x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(x&lt;<span class="number">0</span>) <span class="built_in">putchar</span>(<span class="string">&#x27;-&#x27;</span>),x=-x;</span><br><span class="line">    <span class="keyword">if</span>(x&gt;<span class="number">9</span>) <span class="built_in">write</span>(x/<span class="number">10</span>);</span><br><span class="line">    <span class="built_in">putchar</span>(x%<span class="number">10</span>+<span class="string">&#x27;0&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">checkMax</span><span class="params">(T &amp;x,T &amp;y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x&lt;y?x=y,<span class="number">1</span>:<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">checkMin</span><span class="params">(T &amp;x,T &amp;y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x&gt;y?x=y,<span class="number">1</span>:<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> Pri[MAXN],Tot;</span><br><span class="line"><span class="type">bool</span> Is[MAXN];</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">Sieve</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">memset</span>(Is,<span class="number">1</span>,<span class="built_in">sizeof</span>(Is));Is[<span class="number">1</span>]=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">2</span>;i&lt;MAXN;++i)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(Is[i]) Pri[++Tot]=i;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">1</span>;j&lt;=Tot&amp;&amp;i*Pri[j]&lt;MAXN;++j)</span><br><span class="line">        &#123;</span><br><span class="line">            Is[i*Pri[j]]=<span class="number">0</span>;</span><br><span class="line">            <span class="keyword">if</span>(i%Pri[j]==<span class="number">0</span>) <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> N;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// freopen(&quot;sieve.in&quot;,&quot;r&quot;,stdin);</span></span><br><span class="line">    <span class="comment">// freopen(&quot;sieve.out&quot;,&quot;w&quot;,stdout);</span></span><br><span class="line">    <span class="built_in">Sieve</span>();</span><br><span class="line">    <span class="built_in">read</span>(N);</span><br><span class="line">    <span class="keyword">while</span>(N)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(Is[N]) <span class="built_in">puts</span>(<span class="string">&quot;0&quot;</span>);</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="type">int</span> l=<span class="number">1</span>,r=Tot;</span><br><span class="line">            <span class="keyword">while</span>(l&lt;r)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="type">int</span> mid=(l+r)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">                <span class="keyword">if</span>(Pri[mid]&gt;N) r=mid;</span><br><span class="line">                <span class="keyword">else</span> l=mid+<span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="built_in">write</span>(Pri[l]-Pri[l<span class="number">-1</span>]),<span class="built_in">puts</span>(<span class="string">&quot;&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">read</span>(N);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">10</span></span><br><span class="line"><span class="comment">11</span></span><br><span class="line"><span class="comment">27</span></span><br><span class="line"><span class="comment">2</span></span><br><span class="line"><span class="comment">492170</span></span><br><span class="line"><span class="comment">0</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure></details><hr><h4 id="P1621"><a href="#P1621" class="headerlink" title="P1621"></a><a href="https://www.luogu.com.cn/problem/P1621">P1621</a></h4><p>这道题教会我一个道理，最优的筛法并不一定最优。</p><p>这道题，如果使用欧拉筛的话，每一个数只会被自己最小的质因子筛掉。而我们的 $p$ 可以是任一质因子。而正巧，我们有一个复杂度没那么优秀，但依然优秀的筛法——埃氏筛。</p><p>埃氏筛保证每一个数都会被自己的所有质因子筛到。所以我们直接求取 $1\sim b$ 的所有质数，并在其中处理满足 $(i,j)\ge p$ 条件的，并把它们在并查集中合并。</p><p>令当前质数为 $p_0\ge p$ ，我们枚举 $2p_0\sim\min(kp_0,b)$ ，显然，$kp_0$ 和 $(k-1)p_0$ 有一个质因子为 $p_0\ge p$ ，所以 $kp_0$ 和 $(k-1)p_0$ 必在一个集合。所以我们扫一遍，然后把上述的两个连在一起就好了。</p><p>时间复杂度如果我没记错的话，是 $\mathcal O(b\log\log b)$ 。</p><details>    <summary>AC Code</summary><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;ctime&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iomanip&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stack&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;map&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> gh() getchar()</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> re register</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> ll;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN=<span class="number">1e5</span>+<span class="number">1</span>;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    x=<span class="number">0</span>;</span><br><span class="line">    <span class="type">char</span> ch=<span class="built_in">gh</span>(),t=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(ch&lt;<span class="string">&#x27;0&#x27;</span>||ch&gt;<span class="string">&#x27;9&#x27;</span>) t|=ch==<span class="string">&#x27;-&#x27;</span>,ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">while</span>(ch&gt;=<span class="string">&#x27;0&#x27;</span>&amp;&amp;ch&lt;=<span class="string">&#x27;9&#x27;</span>) x=(x&lt;&lt;<span class="number">3</span>)+(x&lt;&lt;<span class="number">1</span>)+(ch^<span class="number">48</span>),ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">if</span>(t) x=-x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T,<span class="keyword">class</span> ...T1&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x,T1 &amp;...x1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">read</span>(x),<span class="built_in">read</span>(x1...);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">write</span><span class="params">(T x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(x&lt;<span class="number">0</span>) <span class="built_in">putchar</span>(<span class="string">&#x27;-&#x27;</span>),x=-x;</span><br><span class="line">    <span class="keyword">if</span>(x&gt;<span class="number">9</span>) <span class="built_in">write</span>(x/<span class="number">10</span>);</span><br><span class="line">    <span class="built_in">putchar</span>(x%<span class="number">10</span>+<span class="string">&#x27;0&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">checkMax</span><span class="params">(T &amp;x,T &amp;y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x&lt;y?x=y,<span class="number">1</span>:<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">checkMin</span><span class="params">(T &amp;x,T &amp;y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x&gt;y?x=y,<span class="number">1</span>:<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">bool</span> Is[MAXN];</span><br><span class="line"><span class="type">int</span> a,b,p,Fa[MAXN];</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">Anc</span><span class="params">(<span class="type">int</span> x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> Fa[x]==x?x:Fa[x]=<span class="built_in">Anc</span>(Fa[x]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">Sieve</span><span class="params">(<span class="type">int</span> n)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">2</span>;i&lt;=n;++i)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(!Is[i])</span><br><span class="line">            <span class="keyword">if</span>(i&gt;=p)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">for</span>(<span class="type">int</span> j=i&lt;&lt;<span class="number">1</span>;j&lt;=n;j+=i)</span><br><span class="line">                &#123;</span><br><span class="line">                    Is[j]=<span class="number">1</span>;</span><br><span class="line">                    <span class="keyword">if</span>(j-i&gt;=a&amp;&amp;<span class="built_in">Anc</span>(j)!=<span class="built_in">Anc</span>(j-i))</span><br><span class="line">                        Fa[<span class="built_in">Anc</span>(j)]=Fa[<span class="built_in">Anc</span>(j-i)];</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">for</span>(<span class="type">int</span> j=i&lt;&lt;<span class="number">1</span>;j&lt;=n;j+=i) Is[j]=<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// freopen(&quot;sieve.in&quot;,&quot;r&quot;,stdin);</span></span><br><span class="line">    <span class="comment">// freopen(&quot;sieve.out&quot;,&quot;w&quot;,stdout);</span></span><br><span class="line">    <span class="built_in">read</span>(a,b,p);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=a;i&lt;=b;++i) Fa[i]=i;</span><br><span class="line">    <span class="built_in">Sieve</span>(b);</span><br><span class="line">    <span class="type">int</span> ans=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=a;i&lt;=b;++i) <span class="keyword">if</span>(Fa[i]==i) ++ans;</span><br><span class="line">    <span class="built_in">write</span>(ans);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">10 20 3</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure></details><hr><h2 id="线性筛-欧拉筛"><a href="#线性筛-欧拉筛" class="headerlink" title="线性筛/欧拉筛"></a>线性筛/欧拉筛</h2><p>在 $\mathcal O(n)$ 的时间内筛出积性函数 $f$ 的 $1\sim n$ 的值，使用前提是 $f(p^k)$ 能够在 $\mathcal O(1)$ 的时间内计算。</p><p>对于合数 $n$ 的分解为 $n=\prod p_i^{k_i}$ ，记录最小的质因子 $p_1$ 的贡献部分为 $g(n)=p_1^{k_1}$ 。作为线性筛的前提，每一个合数都只能被自己的最小质因子筛中。</p><p>所以当 $n$ 被 $x\cdot p$ 筛到时，若 $x$ 是 $p$ 的倍数，则 $g(n)=g(x)\times p$ ，否则 $g(n)=p$ 。若有 $g(n)=n$ ，说明 $n=p_1^{k_1}$ ，此时 $f(n)$ 可以使用 $\mathcal O(1)$ 的时间计算，否则有 $f(n)=f(g(n))\times f(\frac{n}{g(n)})$ 。</p><h3 id="线性筛欧拉函数"><a href="#线性筛欧拉函数" class="headerlink" title="线性筛欧拉函数"></a>线性筛欧拉函数</h3><p>首先，欧拉函数的计算公式 $\varphi(n)=n\times\prod(1-\frac{1}{p_i})$ 。</p><p>有性质：</p><ol><li>$\varphi(p)=p-1$ ；</li><li>$\varphi(x\times p)=\varphi(x)\times p,p\mid x$ ，此时可以直接 <code>break;</code> ；</li><li>$\varphi(x\times p)=\varphi(x)\times(p-1),p\not\mid x$ 。</li></ol><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">bool</span> is[MAXN],pr[MAXN],phi[MAXN],tot;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">sieve</span><span class="params">(<span class="type">int</span> n)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">memset</span>(is,<span class="number">1</span>,<span class="built_in">sizeof</span>(is));</span><br><span class="line">    is[<span class="number">1</span>]=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">2</span>;i&lt;=n;++i)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(is[i]) pr[++tot]=i,phi[i]=i<span class="number">-1</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">1</span>;j&lt;=tot&amp;&amp;i*pri[j]&lt;=n;++j)</span><br><span class="line">        &#123;</span><br><span class="line">            is[i*pri[j]]=<span class="number">0</span>;</span><br><span class="line">            <span class="keyword">if</span>(i%pri[j]==<span class="number">0</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                phi[i*pri[j]]=phi[i]*pri[j];</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            phi[i*pri[j]]=phi[i]*(pri[j]<span class="number">-1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="线性筛莫比乌斯函数"><a href="#线性筛莫比乌斯函数" class="headerlink" title="线性筛莫比乌斯函数"></a>线性筛莫比乌斯函数</h3><p><del>莫比乌斯函数的计算公式太难写了，就不写了</del>。</p><p>首先，初始化 $\mu(1)=1$ ，然后线性筛，筛出：</p><ol><li>$\mu(i\times pri[j])=0,i\% pri[j]=0$ ，并执行 <code>break;</code> ；</li><li>$\mu(i\times pri[j])=-1\times\mu(i),i\% pri[j]\ne 0$ 。</li></ol><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">bool</span> is[MAXN],pr[MAXN],mu[MAXN],tot;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">sieve</span><span class="params">(<span class="type">int</span> n)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">memset</span>(is,<span class="number">1</span>,<span class="built_in">sizeof</span>(is));</span><br><span class="line">    is[<span class="number">1</span>]=<span class="number">0</span>;mu[<span class="number">1</span>]=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">2</span>;i&lt;=n;++i)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(is[i]) pr[++tot]=i,mu[i]=<span class="number">-1</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">1</span>;j&lt;=tot&amp;&amp;i*pri[j]&lt;=n;++j)</span><br><span class="line">        &#123;</span><br><span class="line">            is[i*pri[j]]=<span class="number">0</span>;</span><br><span class="line">            <span class="keyword">if</span>(i%pri[j]==<span class="number">0</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                mu[i*pri[j]]=<span class="number">0</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            mu[i*pri[j]]=-mu[i];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><p>线性筛主要还是用于预处理的，作为解一些与质数，最大公约数，或者莫比乌斯反演的题的预处理。</p><hr><h2 id="杜教筛"><a href="#杜教筛" class="headerlink" title="杜教筛"></a>杜教筛</h2><p>在 $\mathcal O(n^{\frac{2}{3}})$ 的时间复杂度内求出一个积性函数 $f$ 的前缀和。</p><p>定义 $S(n)=\sum_{i&lt;n}f(i)$ ，找两个易于求前缀和的积性函数 $g,h$ 满足 $f\ast g=h$ ，则有：</p><p>$\sum_{i=1}^nh(i)=\sum_{i=1}^n\sum_{d\mid i}f(d)g(\frac{i}{d})$</p><p>$\sum_{i=1}^nh(i)=\sum_{d=1}^ng(d)\sum_{i=1}^{\lfloor\frac{n}{d}\rfloor}f(i)$</p><p>$\sum_{i=1}^nh(i)=g(1)\cdot S(n)+\sum_{d=2}^ng(d)S(\lfloor\frac{n}{d}\rfloor)$</p><p>$g(1)\times S(n)=\sum_{i=1}^nh(i)-\sum_{d=2}^ng(d)S(\lfloor\frac{n}{d}\rfloor)$</p><p>对于杜教筛的实现，可以线性筛预处理出 $f$ 的前 $\mathcal O(\sqrt n)$ 项前缀和，再递归计算 $S(n)$ ，用 $\operatorname{Hash}$ 和 $\operatorname{map}$ 记忆化计算结果。</p><p>常用的构造 $f\ast g=h$ 有 $\mu\ast I=\epsilon,\varphi\ast I=id,id\ast \mu=\varphi$ 等。</p><h3 id="求解"><a href="#求解" class="headerlink" title="求解"></a>求解</h3><p>对于数论函数 $f$ ，我们的任务就是构造一个 $S(n)$ 关于 $S(\lfloor\frac{n}{i}\rfloor)$ 的递推式以在低于线性时间的复杂度内求解 $f$ 的前缀和。</p><p>对于任意一个数论函数 $g$ 必满足：</p><script type="math/tex; mode=display">\begin{aligned}\sum_{i=1}^n\sum_{d\mid i}g(d)f\left(\frac{i}{d}\right)&=\sum_{i=1}^{n}g(i)S\left(\left\lfloor\frac{n}{i}\right\rfloor\right)\\\iff\sum_{i=1}^n(f\ast g)(i)&=\sum_{i=1}^{n}g(i)S\left(\left\lfloor\frac{n}{i}\right\rfloor\right)\end{aligned}\nonumber</script><p>从而得到递推式：</p><p>$\displaystyle g(1)S(n)=\sum_{i=1}^n(f\ast g)(i)-\sum_{i=2}^ng(i)S\left(\left\lfloor\frac{n}{i}\right\rfloor\right)$</p><h3 id="模板"><a href="#模板" class="headerlink" title="模板"></a>模板</h3><h4 id="莫比乌斯函数前缀和"><a href="#莫比乌斯函数前缀和" class="headerlink" title="莫比乌斯函数前缀和"></a>莫比乌斯函数前缀和</h4><p>$\displaystyle S_{\mu}(n)=\sum_{i=1}^n\epsilon(i)-\sum_{i=2}^nS_{\mu}(\lfloor\frac{n}{i}\rfloor)=1-\sum_{i=2}^nS_{\mu}(\lfloor\frac{n}{i}\rfloor)$</p><p>使用整数分块，直接计算 $\mathcal O(n^{\frac{3}{4}})$ ，预处理前 $n^{\frac{2}{3}}$ 项，剩余复杂度为 $\displaystyle\mathcal O(\int^{n^{\frac{1}{3}}}_{0}\sqrt{\frac{n}{x}}dx)=\mathcal O(n^{\frac{2}{3}})$</p><p>对于无法直接使用 $\text{Hash}$ 的较大数值，考虑 <code>std::map</code> 。</p><h4 id="欧拉函数前缀和"><a href="#欧拉函数前缀和" class="headerlink" title="欧拉函数前缀和"></a>欧拉函数前缀和</h4><p>可以使用杜教筛 $\varphi(n)$ 的前缀和，也可以使用莫比乌斯反演。这里考虑杜教筛：</p><p>有 $\varphi\ast 1=id$</p><script type="math/tex; mode=display">\begin{aligned}\sum_{i=1}^n(\varphi\ast 1)(i)&=\sum_{i=1}^n1\cdot S\left(\left\lfloor\frac{n}{i}\right\rfloor\right)\\\sum_{i=1}^nid(i)&=\sum_{i=1}^{n}1\cdot S\left(\left\lfloor\frac{n}{i}\right\rfloor\right)\\\frac{1}{2}n(n+1)&=\sum_{i=1}^nS\left(\left\lfloor\frac{n}{i}\right\rfloor\right)\\\\&S(n)=\frac{1}{2}n(n+1)-\sum_{i=2}^nS\left(\left\lfloor\frac{n}{i}\right\rfloor\right)\\\end{aligned}\nonumber</script><p>结束。</p><h4 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h4><details>    <summary>AC Code</summary><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN=<span class="number">2e6</span>+<span class="number">10</span>;</span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> ll;</span><br><span class="line">ll Test,N,Pri[MAXN],Cur,Mubi[MAXN],S_M[MAXN];</span><br><span class="line"><span class="type">bool</span> Vis[MAXN];</span><br><span class="line">std::map&lt;ll,ll&gt;Mp_M;</span><br><span class="line"><span class="function">ll <span class="title">mobius_S</span><span class="params">(ll x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(x&lt;MAXN) <span class="keyword">return</span> S_M[x];</span><br><span class="line">    <span class="keyword">if</span>(Mp_M[x]) <span class="keyword">return</span> Mp_M[x];</span><br><span class="line">    ll ret=<span class="number">1ll</span>;</span><br><span class="line">    <span class="keyword">for</span>(ll i=<span class="number">2</span>,j;i&lt;=x;i=j+<span class="number">1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        j=x/(x/i);</span><br><span class="line">        ret-=<span class="built_in">mobius_S</span>(x/i)*(j-i+<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> Mp_M[x]=ret;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">ll <span class="title">phi_S</span><span class="params">(ll x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    ll ret=<span class="number">0ll</span>;</span><br><span class="line">    <span class="keyword">for</span>(ll i=<span class="number">1</span>,j;i&lt;=x;i=j+<span class="number">1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        j=x/(x/i);</span><br><span class="line">        ret+=(<span class="built_in">mobius_S</span>(j)-<span class="built_in">mobius_S</span>(i<span class="number">-1</span>))*(x/i)*(x/i);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> (ret<span class="number">-1</span>)/<span class="number">2</span>+<span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">Sieve</span><span class="params">(<span class="type">int</span> N)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Mubi[<span class="number">1</span>]=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">2</span>;i&lt;=N;++i)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(!Vis[i])</span><br><span class="line">            Pri[++Cur]=i,Mubi[i]=<span class="number">-1</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">1</span>;j&lt;=Cur&amp;&amp;i*Pri[j]&lt;=N;++j)</span><br><span class="line">        &#123;</span><br><span class="line">            Vis[i*Pri[j]]=<span class="number">1</span>;</span><br><span class="line">            <span class="keyword">if</span>(i%Pri[j]==<span class="number">0</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                Mubi[i*Pri[j]]=<span class="number">0</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125; </span><br><span class="line">            Mubi[i*Pri[j]]=-Mubi[i];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=N;++i) S_M[i]=S_M[i<span class="number">-1</span>]+Mubi[i];</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    std::cin&gt;&gt;Test;</span><br><span class="line">    <span class="built_in">Sieve</span>(MAXN<span class="number">-1</span>);</span><br><span class="line">    <span class="keyword">while</span>(Test--)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%lld&quot;</span>,&amp;N);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%lld %lld\n&quot;</span>,<span class="built_in">phi_S</span>(N),<span class="built_in">mobius_S</span>(N));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">6</span></span><br><span class="line"><span class="comment">1</span></span><br><span class="line"><span class="comment">2</span></span><br><span class="line"><span class="comment">8</span></span><br><span class="line"><span class="comment">13</span></span><br><span class="line"><span class="comment">30</span></span><br><span class="line"><span class="comment">2333</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure></details><hr><h2 id="Min-25-筛"><a href="#Min-25-筛" class="headerlink" title="Min_25 筛"></a>Min_25 筛</h2><p>也是一种求积性函数前缀和的筛法，时间复杂度为 $\mathcal O(\frac{n^{\frac{3}{4}}}{\log_2n})$ ，空间复杂度 $\mathcal O(\sqrt n)$ 。要求质数 $p$ 处的函数值是一个多项式。该筛法要求 $F(p^k)$ 是一个多项式（如果不是，可能会算不出来）。</p><p>记 $cnt$ 为 $\le n$ 的质数个数，$p_i$ 表示第 $i$ 个质数，$R(x)$ 表示 $x$ 的最小质因子，$F(x)$ 是一个积性函数。（这里我们定义除法默认下取整）</p><p>$\text{Min}_\text{25}$ 筛的实现分为两个部分。</p><h3 id="Part-1"><a href="#Part-1" class="headerlink" title="Part 1"></a>Part 1</h3><p>考虑求解一个式子：</p><script type="math/tex; mode=display">\nonumber\sum^{cnt}_{i=1}F(p_i)=\sum_n^{x=1}F(x)[x\in Prime]</script><p>定义一个二元函数 $g$ ，表示为：</p><script type="math/tex; mode=display">\nonumberg(n,j)=\sum_{i=2}^nf(i)[i\in Prime\vee R(i)>p_j]</script><p>这里假设函数 $f$ 的计算方法和都和 $F$ 中素数的计算方法一致。例如 $F(x)=\varphi(x),f(x)=x-1$ 等之类的。</p><p>这里的 $f$ 被要求为一个完全积性函数，这是执行筛法的要求。而我们要求的 $\sum_{i=1}^{cnt}F(p_i)=g(n,cnt)$ ，所需要的是 $g(n,cnt)$ ，而 $g$ 中只有素数的函数值，所以和原式是相等的。</p><p>而 $n$ 以内的数最小质因子显然不会超过 $\sqrt{n}$ ，所以也可以写成 $g(n,m),p^2_m\ge n$ 。</p><p>作为筛法，应当考虑 $g(n,j)$ 的递推计算。若有 $p_j^2\ge n$ ，则 $g(n,j)=g(n,j-1)$ ，因为不会存在 $R(i)\ge p_j$ 的数。</p><p>那么，我们可以得出 $g(n,j)$ 的转移式：</p><script type="math/tex; mode=display">g(n,j)=\nonumber\begin{cases}g(n,j-1)&p_j^2\ge n\\\\g(n,j-1)-f(p_j)\times(g(\frac{n}{p_j},j-1)-\sum_{k=1}^{j-1}f(p_k))&otherwise\end{cases}</script><p>对于 $otherwise$ 的探讨：考虑 $g(n,j-1)$ 和 $g(n,j)$ 的差别，根据 $g$ 的定义，不难看出，$g(n,j)$ 比 $g(n,j-1)$ 缺少的部分就是那些以 $p_j$ 为最小质因子的合数的函数值。所以减去的那部分就是刚刚提及的那部分。</p><p>我们尝试把 $g$ 的空间复杂度压到 $\mathcal O(\sqrt n)$ 。</p><p>$g$ 的第一维用于存储 $\frac{n}{i}$ 这些位置，且其转移只存在于 $n\to \frac{n}{p_j}$ ，而向下取整的除法可结合，即 $\frac{\frac{x}{a}}{b}=\frac{x}{ab}$ ，无论怎么除，都只需要 $g(n,m)$ ，只会用到 $\mathcal O(\sqrt n)$ 个关键位置。</p><p>$g$ 的第二维用于转移 $j\to j-1$ ，而与此同时第一维不断缩小，我们只需要 $g(n,m)$ ，可以直接压掉第二维后滚动数组。</p><p>下面是 $F(x)=1,g(n,m)$ 求 $n$ 以内的质数个数的代码：</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> sqN=<span class="built_in">ceil</span>(<span class="built_in">sqrt</span>(n));</span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=Tot;++i) g[i]=w[i]<span class="number">-1</span>;<span class="comment">//g(w[i],0)</span></span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">1</span>;j&lt;=Cnt;++j)</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=Tot&amp;&amp;Pri[j]*Pri[j]&lt;=w[i];++i)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="type">int</span> k=w[i]/Pri[j];</span><br><span class="line">            <span class="keyword">if</span>(k&lt;=sqN) k=id[<span class="number">0</span>][k];</span><br><span class="line">            <span class="keyword">else</span> k=id[<span class="number">1</span>][n/k];</span><br><span class="line">            g[i]-=g[k]-j+<span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line"><span class="built_in">write</span>(g[<span class="number">1</span>]);</span><br></pre></td></tr></table></figure><p>其中</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Tot表示关键点个数</span><br><span class="line">w[i]表示从大到小的第i个关键点</span><br><span class="line">g[i]表示当前的g(w[i],j)</span><br><span class="line">id[0/1][k]分别表示k和n/k是第几个关键点</span><br></pre></td></tr></table></figure><p>从而完成 $\sum\limits_{x=1}^{n}F(x)[x\in Prime]$ 的计算。</p><p>时间复杂度为 $\mathcal O(\frac{n^{\frac{3}{4}}}{\log_2n})$ 。</p><h3 id="Part-2"><a href="#Part-2" class="headerlink" title="Part 2"></a>Part 2</h3><p>对于求解 $F(x)$ 在所有位置的函数值之和 $ans=\sum\limits_{i=1}^{n}F(i)$ 。定义一个二元函数为 $S$ ：</p><script type="math/tex; mode=display">S(n, j) = \sum_{i = 2}^n F(i)[R(i) \ge p_j]\nonumber</script><p>则有 $ans=S(n,1)+F(1)$ 。</p><p>把 $S$ 的计算拆成素数部分和合数部分，素数部分显然是 $g(n,cnt)-\sum\limits_{i=1}^{j-1}F(p_i)$ 。而对于合数部分，我们需要进一步计算。</p><p>枚举最小质因子 $p_k$ 以及其次幂 $e$ ，不重不漏地计算 $R(i)\ge p_j$ 的合数。枚举幂次，使得 $p_k^e$ 被提及之后，就不会存在质因子 $p_k$ ，函数值就可以直接与括号外相乘。对于 $p_k^e,e\ge 2$ 作为合数，不会被枚举，所以我们需要手动加上。</p><script type="math/tex; mode=display">S(n, j) = g(n, cnt) - \sum_{i = 1}^{j - 1} F(p_i) + \sum_{p_k^2}^{p_k^2 \le n} \sum_{e}^{p_k^{e + 1} \le n} F(p_k^e) \times S(\frac{n}{p_k^e}, k + 1) + F(p_k^{e + 1})\nonumber</script><p>这样可以免去记忆化，直接递归计算。边界是 $n=1,\vee p_j&gt;n,S(n,j)=0$ 。</p><p>时间复杂度与 $\text{Part 1}$ 相同，也可以是 $\mathcal O(n^{1-\epsilon})$ 。</p>]]></content>
      
      
      <categories>
          
          <category> 学习笔记 </category>
          
          <category> OI </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 数论 </tag>
            
            <tag> 质数 </tag>
            
            <tag> 优化 </tag>
            
            <tag> 构造 </tag>
            
            <tag> 函数 </tag>
            
            <tag> 欧拉函数 </tag>
            
            <tag> 多项式 </tag>
            
            <tag> 莫比乌斯函数 </tag>
            
            <tag> 狄利克雷卷积 </tag>
            
            <tag> 狄利克雷函数 </tag>
            
            <tag> 线性筛 </tag>
            
            <tag> 杜教筛 </tag>
            
            <tag> 前缀函数 </tag>
            
            <tag> Min_25筛 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>反演</title>
      <link href="/Eternity/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/OI/inversion/"/>
      <url>/Eternity/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/OI/inversion/</url>
      
        <content type="html"><![CDATA[<p>“撕碎的时空下，宇宙终将反演，就如同没有人能够一直站在主峰上。”</p><span id="more"></span><h2 id="莫比乌斯反演"><a href="#莫比乌斯反演" class="headerlink" title="莫比乌斯反演"></a>莫比乌斯反演</h2><p>莫比乌斯函数 $\mu(n)$ 是常数函数 $I(n)$ 在狄利克雷卷积意义下的逆元，即满足 $\mu\ast I=\epsilon$ ，展开式是 $[n=1]=\sum_{d\mid n}\mu(d)$ 。</p><p>那么，对于 $p$ 是质数，则有 $0=\mu(1)+\mu(p)$ 。</p><p>以此类推，得到 $0=\mu(1)+\mu(p)+\mu(p^2)+…+\mu(p^k)$ 对 $k\ge 2$ 恒成立，从而得到 $\mu(1)=1,\mu(p)=-1$ ，且 $\forall k\ge 2,\mu(p^k)=0$ 。</p><p>那么，得出莫比乌斯函数的通常式：</p><script type="math/tex; mode=display">\mu(n)=\begin{cases}&1,n=1\\&0,\exists k_i\ge 2\\&-1,\forall k_i=1    \nonumber\end{cases}</script><p>其中 $n=\prod p_i^{k_i}$ 。$p_i$ 为 $n$ 的质因数。可以证明 $\mu(n)$ 为积性函数。</p><h3 id="前缀因数定理"><a href="#前缀因数定理" class="headerlink" title="前缀因数定理"></a>前缀因数定理</h3><p>有性质 $S(n)=\sum_{i\mid n}\mu(i)=[n=1],n&gt;0$ 。</p><hr><p>证明：</p><p>设 $n=p_1^{d_1}p_2^{d_2}\dots p_k^{d_k},k\ge 1$ ，并设 $d=p_1^{\beta_1}p_2^{\beta_2}\dots p_k^{\beta_k},0\le \beta_i\le d_i$ 。</p><p>可以得到 $S(n)=C_{k}^{0}(-1)^0+C_{k}^1(-1)^1+\dots C_{k}^k(-1)^k$ ，通过二项式定理得到：$S(n)=0,n&gt;0,n\ne 1$ 。</p><p>$\operatorname{Q.E.D}$</p><hr><p>也可以得到 $\mu\ast1=\epsilon$ 。</p><hr><h3 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h3><p>对于莫反，我们可以根据前缀因数定理推出另外一个更有用的式子：</p><p>$[\gcd(i,j)=1]=\sum\limits_{d\mid \gcd(i,j)}\mu(d)$</p><p>上述式子的正确性显然，因为 $\epsilon(\gcd(i,j))=[\gcd(i,j)=1]$ 。</p><p>莫比乌斯反演用于解决两个函数 $f,g$ 同时满足：</p><p>$g(n)=\sum_{d\mid n}f(d)$ 与 $f(n)=\sum_{d\mid n}\mu(d)g(\frac{n}{d})$ 。</p><p>也可以写成狄利克雷卷积的形式：</p><p>$f\ast I=g$ 与 $f=g\ast \mu$</p><p>而莫反的题就是构造这个 $f$ 和 $g$ 并求出相应解就可以了。</p><script type="math/tex; mode=display">\begin{aligned}f(n)&=\sum_{d\mid n}\mu(d)g(\frac{n}{d})\\&=\sum_{d\mid n}\mu(d)\sum_{i\mid\frac{n}{d}}f(i)\\&=\sum_{i\mid n}f(i)\sum_{d\mid\frac{n}{i}}\mu(d)\end{aligned}\nonumber</script><hr><p>同样，也可以是满足 $F(n)=\sum_{n\mid d}f(d)$ 和 $f(n)=\sum_{n\mid d}\mu(\frac{d}{n})F(d)$ 的两个函数，也可以证明这两个式子是互相推导的。</p><hr><h3 id="扩展"><a href="#扩展" class="headerlink" title="扩展"></a>扩展</h3><p>有 $\varphi\ast 1=id$</p><p>且这个式子两侧同时卷 $\mu$ 得到 $\varphi(n)=\sum\limits_{d\mid n}d\times\mu(\frac{n}{d})$</p><hr><h3 id="莫比乌斯变换"><a href="#莫比乌斯变换" class="headerlink" title="莫比乌斯变换"></a>莫比乌斯变换</h3><p>有式子 $f(n)=\sum_{d\mid n}g(d)$ 和 $g(n)=\sum_{d\mid n}\mu(d)f(\frac{n}{d})$</p><p>其中 $f(n),g(n)$ 为数论函数，且 $f(n)$ 称作 $g(n)$ 的莫比乌斯变换，而 $g(n)$ 称作 $f(n)$ 的莫比乌斯逆变换，或者莫比乌斯反演。</p><p>而 $g(n)$ 的莫比乌斯变换，就是将数论函数 $g(n)$ 与常数函数 $1$ 进行狄利克雷卷积。</p><p>而形式二，就是 $f(n)=\sum_{n\mid d}g(d)$ 与 $g(n)=\sum_{n\mid d}\mu(\frac{d}{n})f(d)$ 的互推。</p><hr><h3 id="例题"><a href="#例题" class="headerlink" title="例题"></a>例题</h3><h4 id="P1829"><a href="#P1829" class="headerlink" title="P1829"></a><a href="https://www.luogu.com.cn/problem/P1829">P1829</a></h4><p>显然，转 $\operatorname{lcm}$ 为 $\gcd$ 。</p><script type="math/tex; mode=display">\begin{aligned}\sum_{i=1}^{n}\sum_{j=1}^m\text{lcm}(i,j)&=\sum_{i=1}^n\sum_{j=1}^m\frac{ij}{\gcd(i,j)}\\&=\sum_{i=1}^n\sum_{j=1}^m\sum_{d\mid i,d\mid j,\gcd(\frac{i}{d},\frac{j}{d})=1}\frac{ij}{d}\\&=\sum_{d=1}^n\sum_{i=1}^{\lfloor\frac{n}{d}\rfloor\lfloor\frac{m}{d}\rfloor}[\gcd(i,j)=1]i\times j\end{aligned}\nonumber</script><p>我们记录  $\displaystyle S(n,m)=\sum_{i=1}^n\sum_{j=1}^m[\gcd(i,j)=1]iCdot j$ ，化简：</p><p>$\displaystyle S(n,m)=\sum_{i=1}^n\sum_{d\mid i}^n\sum_{d\mid j}^m\mu(d)\times i\times j$</p><p>设 $i=id,j=jd$ ，得到：</p><p>$\displaystyle \sum_{d=1}^n\mu(d)d^2\sum_{i=1}^{\lfloor\frac{n}{d}\rfloor}\sum_{j=1}^{\lfloor\frac{m}{d}\rfloor}i\times j$</p><p>前半段是关于 $d$ 的前缀和，后半段是范围内数对之和，记：</p><p>$\displaystyle g(n,m)=\sum_{i=1}^n\sum_{j=1}^mi\times j=\frac{n(n+1)}{2}\times\frac{m(m+1)}{2}$</p><p>则有：</p><p>$\displaystyle S(n,m)=\sum_{d=1}^n\mu(d)d^2g(\lfloor\frac{n}{d}\rfloor,\lfloor{\frac{m}{d}\rfloor})$</p><p>至此，数论分块求解 $S(n,m)$ 即可。</p><p>而答案就此得出：</p><p>$\displaystyle ans=\sum_{d=1}^nd\times S\left(\lfloor\frac{n}{d}\rfloor,\lfloor\frac{m}{d}\rfloor\right)$</p><p>时间复杂度 $\mathcal O(n+m)$ 。</p><hr><h4 id="P2252"><a href="#P2252" class="headerlink" title="P2252"></a><a href="https://www.luogu.com.cn/problem/P2522">P2252</a></h4><p>运用差分的性质，我们可以设 $S[i,j]$ 表示数 $0\le x\le i,0\le y\le j$ 中满足 $\gcd(x,y)=k$ 的个数，则有：</p><p>$ans=S[b,d]-S[a-1,d]-S[b,c-1]+S[a-1,c-1]$ </p><p>但是暴力的算法时间复杂度可以达到 $\mathcal O(cd\log k)$ ，这是完全不允许的。</p><p>所以我们选择构造一个 $F$ 和 $f$ 来进行莫反。</p><p>然后一波玄学推出：</p><p>$F(n)=\sum\limits_{x=1}^a\sum\limits_{y=1}^a[n|(x,y)]$</p><p>$f(n)=\sum\limits_{x=1}^a\sum\limits_{y=1}^b[(x,y)=n]$</p><p>所以得到有 $F(n)=\sum\limits_{n\mid d}f(d),f(n)=\sum\limits_{n\mid d}\mu(\frac{d}{n})F(d)$</p><p>然后稍微推一推，就可以得到一个更加通常的式子 $F(d)=\lfloor\frac{a}{d}\rfloor\lfloor\frac{b}{d}\rfloor$</p><p>所以我们对 $f(n)$ 的式子进行稍微变化：</p><script type="math/tex; mode=display">\begin{aligned}f(n)&=\sum_{n\mid d}\mu(\frac{d}{n})\lfloor\frac{a}{d}\rfloor\lfloor\frac{b}{d}\rfloor\\&=\sum_{d'}\mu(d')\lfloor\frac{a}{d'n}\rfloor\lfloor\frac{b}{d'n}\rfloor\\&=\sum_{d'}\mu(d')\lfloor\frac{a'}{d'}\rfloor\lfloor\frac{b'}{n'}\rfloor\end{aligned}\nonumber</script><p>其中 $d’=\frac{d}{n},a’=\frac{a}{n},b’=\frac{b}{n}$ ，所以这里会使用到数论分块。 </p><p>易知 $1\sim\lfloor\frac{n}{k}\rfloor$ 中 $d$ 的倍数有 $\lfloor\frac{n}{kd}\rfloor$ 个，故原式化为：</p><p>$\sum\limits_{d=1}^{\min(\lfloor\frac{n}{k}\rfloor,\lfloor\frac{m}{k}\rfloor)}\mu(d)\lfloor\frac{n}{kd}\rfloor\lfloor\frac{m}{kd}\rfloor$ </p><p>用数论分块求解即可。</p><p>时间复杂度 $\mathcal O(N+T\sqrt n)$ ，其中 $N$ 是预处理时间。</p><details>    <summary>AC Code</summary><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    x=<span class="number">0</span>;</span><br><span class="line">    <span class="type">char</span> ch=<span class="built_in">getchar</span>(),t=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(ch&lt;<span class="string">&#x27;0&#x27;</span>||ch&gt;<span class="string">&#x27;9&#x27;</span>) t|=ch==<span class="string">&#x27;-&#x27;</span>,ch=<span class="built_in">getchar</span>();</span><br><span class="line">    <span class="keyword">while</span>(ch&gt;=<span class="string">&#x27;0&#x27;</span>&amp;&amp;ch&lt;=<span class="string">&#x27;9&#x27;</span>) x=(x&lt;&lt;<span class="number">3</span>)+(x&lt;&lt;<span class="number">1</span>)+(ch^<span class="number">48</span>),ch=<span class="built_in">getchar</span>();</span><br><span class="line">    <span class="keyword">if</span>(t) x=-x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T,<span class="keyword">class</span> ...T1&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x,T1 &amp;...x1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">read</span>(x),<span class="built_in">read</span>(x1...);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">write</span><span class="params">(T x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(x&lt;<span class="number">0</span>) x=-x,<span class="built_in">putchar</span>(<span class="string">&#x27;-&#x27;</span>);</span><br><span class="line">    <span class="keyword">if</span>(x&gt;<span class="number">9</span>) <span class="built_in">write</span>(x/<span class="number">10</span>);</span><br><span class="line">    <span class="built_in">putchar</span>(x%<span class="number">10</span>+<span class="string">&#x27;0&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN=<span class="number">5e4</span>+<span class="number">1</span>;</span><br><span class="line"><span class="type">int</span> Pri[MAXN],Mu[MAXN],SumM[MAXN],Tot;</span><br><span class="line"><span class="type">bool</span> Is[MAXN];</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">Sieve</span><span class="params">(<span class="type">int</span> N)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Is[<span class="number">1</span>]=<span class="number">1</span>,Mu[<span class="number">1</span>]=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">2</span>;i&lt;=N;++i)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(!Is[i]) Pri[++Tot]=i,Mu[i]=<span class="number">-1</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">1</span>;j&lt;=Tot&amp;&amp;i*Pri[j]&lt;=N;++j)</span><br><span class="line">        &#123;</span><br><span class="line">            Is[i*Pri[j]]=<span class="number">1</span>;</span><br><span class="line">            <span class="keyword">if</span>(i%Pri[j]==<span class="number">0</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                Mu[i*Pri[j]]=<span class="number">0</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            Mu[i*Pri[j]]=-Mu[i];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=N;++i) SumM[i]=SumM[i<span class="number">-1</span>]+Mu[i];</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> Test,a,b,c,d,k;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">calc</span><span class="params">(<span class="type">int</span> n,<span class="type">int</span> m)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> res=<span class="number">0</span>;n/=k,m/=k;</span><br><span class="line">    <span class="type">int</span> tot=std::<span class="built_in">min</span>(n,m);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>,j;i&lt;=tot;i=j+<span class="number">1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        j=std::<span class="built_in">min</span>(n/(n/i),m/(m/i));</span><br><span class="line">        res+=(SumM[j]-SumM[i<span class="number">-1</span>])*(n/i)*(m/i);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// freopen(&quot;mubius.in&quot;,&quot;r&quot;,stdin);</span></span><br><span class="line">    <span class="comment">// freopen(&quot;mubius.out&quot;,&quot;w&quot;,stdout);</span></span><br><span class="line">    <span class="built_in">read</span>(Test);</span><br><span class="line">    <span class="built_in">Sieve</span>(MAXN<span class="number">-1</span>);</span><br><span class="line">    <span class="keyword">while</span>(Test--)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">read</span>(a,b,c,d,k);</span><br><span class="line">        <span class="built_in">write</span>(<span class="built_in">calc</span>(b,d)-<span class="built_in">calc</span>(a<span class="number">-1</span>,d)-<span class="built_in">calc</span>(b,c<span class="number">-1</span>)+<span class="built_in">calc</span>(a<span class="number">-1</span>,c<span class="number">-1</span>)),<span class="built_in">puts</span>(<span class="string">&quot;&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">2</span></span><br><span class="line"><span class="comment">2 5 1 5 1</span></span><br><span class="line"><span class="comment">1 5 1 5 2</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure></details><p>代码里有一些常数小优化。</p><p>因为 <code>c++</code> 里的除法会使常数变大，而对于问题中的 $\lfloor\frac{n}{kd}\rfloor$ 的 $k$ 是常数，所以我们可以先预处理 $\lfloor\frac{n}{d}\rfloor$ ，以免每一次计算的时候都要除一遍 $k$ 实测这样会从 $\text{9.13s}$ 优化到 $\text{4.15s}$ 。</p><hr><h4 id="P2398"><a href="#P2398" class="headerlink" title="P2398"></a><a href="https://www.luogu.com.cn/problem/P2398">P2398</a></h4><p>题意非常清晰，推推式子：</p><script type="math/tex; mode=display">\begin{align}ans\nonumber=&\nonumber\sum_{i=1}^n\sum_{j=1}^n\gcd(i,j)\\=&\nonumber\sum_{d=1}^nd\sum_{i=1}^{\frac{n}{d}}\sum_{j=1}^{\frac{n}{d}}[\gcd(i,j)=1]\\=&\nonumber\sum_{d=1}^nd\sum_{i=1}^{\frac{n}{d}}\sum_{j=1}^{\frac{n}{j}}\sum_{k\mid\gcd(i,j)}\mu(k)\\=&\nonumber\sum_{d=1}^nd\sum_{i=1}^{\frac{n}{d}}\sum_{j=1}^{\frac{n}{j}}\sum_{k\mid i\wedge k\mid j}\mu(k)\\=&\nonumber\sum_{d=1}^nd\sum_{k=1}^{\frac{n}{k}}\mu(k)\left(\frac{n}{kd}\right)^2\nonumber\end{align}</script><p>预处理出 $\mu$ 的前缀和，然后两次数论分块。</p><hr><h4 id="P4449"><a href="#P4449" class="headerlink" title="P4449"></a><a href="https://www.luogu.com.cn/problem/P4449">P4449</a></h4><p>与上一题差不多，但多了一个 $k$ 次方，依然选择推式子。（分数向下取整）</p><script type="math/tex; mode=display">ans=\sum_{q=1}^{n}q^k\sum_{d=1}^{\frac{n}{q}}\mu(d)\frac{n}{qd}\frac{m}{qd}\nonumber</script><p>然后得到：</p><script type="math/tex; mode=display">ans=\sum_{q=1}^{n}q^k\sum_{q\mid x}^{\frac{n}{q}}\mu(\frac{x}{q})\frac{n}{x}\frac{m}{x}\nonumber</script><p>交换顺序：</p><script type="math/tex; mode=display">ans=\sum_{x=1}^{n}\frac{n}{x}\frac{m}{x}\sum_{d\mid x}\mu(\frac{x}{q})q^k\nonumber</script><p>即可。</p><hr><h4 id="SPOJ-5971"><a href="#SPOJ-5971" class="headerlink" title="SPOJ 5971"></a><a href="https://www.luogu.com.cn/problem/SP5971">SPOJ 5971</a></h4><p><a href="https://www.luogu.com.cn/problem/P1891">双倍经验</a></p><p>首先，显然地：$\displaystyle \sum_{i=1}^n\operatorname{lcm}(i,n)=\sum_{i=1}^n\frac{in}{\gcd(i,n)}$ ，<del>然后我就想不到了</del>。</p><script type="math/tex; mode=display">\begin{aligned}f(n)&=\frac{1}{2}\times(\sum_{i=1}^{n-1}\frac{in}{\gcd(i,n)}\times 2)+n\\&=\frac{1}{2}\left(\sum_{i=1}^{n-1}\frac{in}{\gcd(i,n)}+\sum_{i=n-1}^{1}\frac{in}{\gcd(n-i,n)}\right)+n\\&=\frac{1}{2}\sum_{i=1}^{n-1}\frac{n^2}{\gcd(i,n)}+n\\&=\frac{1}{2}\sum_{i=1}^n\frac{n^2}{\gcd(i,n)}+\frac{n}{2}\\&=\frac{1}{2}\sum_{d\mid n}\left(\frac{n^2\times\varphi(\frac{n}{d})}{d}\right)+\frac{n}{2}\end{aligned}\nonumber</script><p>上述推导用到的有：</p><ul><li>$\gcd(i,n)=\gcd(n-i,n)$</li><li>$\gcd(i,n)=d$ 的个数有 $\displaystyle\varphi(\frac{n}{d})$ 个。</li></ul><p>对于上式，我们设一个 $\displaystyle d’=\frac{n}{d}$ ，简化式子：</p><p>$\displaystyle f(n)=\frac{1}{2}n\times\left(\sum_{d’\mid n}d’\times\varphi(d’)+1\right)$</p><p>设一个 $\displaystyle g(n)=\sum_{d\mid n}d\times\varphi(d)$ ，可以推出 $g(n)$ 是积性函数，则可以使用线性筛，询问 $\mathcal O(1)$ 。</p><p>接下来就考虑怎么筛了，直接拆可以拆出：</p><p>$\displaystyle g(p_j^{k})=\sum_{w=0}^kp_j^w\times\varphi(p_j^w)$ </p><p>又因为 $\varphi(p_j^w)=p_j^{w-1}(p_j-1)$ ，则有：</p><p>$\displaystyle g(p_j^k)=\sum_{w=0}^kp_j^{2w-1}Cdot(p_j-1)$</p><p>$g(p_j^{k+1})=g(p_j^k)+p_j^{2k+1}Cdot(p_j-1)$</p><p>令 $i=a\times p_j^w(\gcd(a,p_j)=1)$ ，则有：</p><p>$g(i\times p_j)=g(a)Cdot g(p_j^{w+1})$</p><p>$g(i)=g(a)Cdot g(p_j^w)$</p><p>因此得到线性筛的式子：</p><p>$g(iCdot p_j)=g(i)+\left(g(i)-g(\frac{i}{p_j})\right)\times p_j^2$</p><details>    <summary>AC Code</summary><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN=<span class="number">1e6</span>+<span class="number">1</span>;</span><br><span class="line"><span class="type">int</span> Pri[MAXN],Tot;</span><br><span class="line"><span class="type">bool</span> Is[MAXN];</span><br><span class="line"><span class="type">long</span> <span class="type">long</span> g[MAXN];</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">Sieve</span><span class="params">(<span class="type">int</span> N)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Is[<span class="number">1</span>]=<span class="number">1</span>,g[<span class="number">1</span>]=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">2</span>;i&lt;=N;++i)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(!Is[i]) Pri[++Tot]=i,g[i]=<span class="number">1ll</span>*i*(i<span class="number">-1</span>)+<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">1</span>;j&lt;=Tot&amp;&amp;i*Pri[j]&lt;=N;++j)</span><br><span class="line">        &#123;</span><br><span class="line">            Is[i*Pri[j]]=<span class="number">1</span>;</span><br><span class="line">            <span class="keyword">if</span>(i%Pri[j]==<span class="number">0</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                g[i*Pri[j]]=g[i]+(g[i]-g[i/Pri[j]])*Pri[j]*Pri[j];</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            g[i*Pri[j]]=g[i]*g[Pri[j]];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> Test,N;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;Test);</span><br><span class="line">    <span class="built_in">Sieve</span>(MAXN<span class="number">-1</span>);</span><br><span class="line">    <span class="keyword">while</span>(Test--)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;N);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%lld\n&quot;</span>,(g[N]+<span class="number">1</span>)*N/<span class="number">2</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">3</span></span><br><span class="line"><span class="comment">1</span></span><br><span class="line"><span class="comment">2</span></span><br><span class="line"><span class="comment">5</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure></details><hr><h2 id="欧拉反演"><a href="#欧拉反演" class="headerlink" title="欧拉反演"></a>欧拉反演</h2><p>欧拉函数 $\varphi$ 满足 $\varphi\ast I=id$ ，即 $n=\sum_{d\mid n}\varphi(d)$ ，且欧拉函数是积性函数。</p><p>所谓欧拉反演，就是在使用的时候把 $n$ 拆成 $\sum_{d|n}\phi(d)$ 。</p><p>因为有 $\mu\ast I=\epsilon,\varphi\ast I=id,id\ast \mu=\varphi$ ，所以莫比乌斯和欧拉是可以互相反演的。</p><h3 id="例题-1"><a href="#例题-1" class="headerlink" title="例题"></a>例题</h3><h4 id="P2398-1"><a href="#P2398-1" class="headerlink" title="P2398"></a>P2398</h4><p>同样可以用欧拉反演推出式子，省略过程（主要是懒得写了），直接给出结果：</p><p>$ans=\sum\limits_{d=1}^{n}\varphi(d)\left\lfloor\frac{n}{d}\right\rfloor^2$</p><hr>]]></content>
      
      
      <categories>
          
          <category> 学习笔记 </category>
          
          <category> OI </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 数论 </tag>
            
            <tag> 构造 </tag>
            
            <tag> 欧拉函数 </tag>
            
            <tag> 欧拉反演 </tag>
            
            <tag> 莫比乌斯函数 </tag>
            
            <tag> 莫比乌斯反演 </tag>
            
            <tag> 狄利克雷卷积 </tag>
            
            <tag> 狄利克雷函数 </tag>
            
            <tag> 差分约束 </tag>
            
            <tag> 数论分块 </tag>
            
            <tag> 莫比乌斯变换 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>P6217 简单数论题</title>
      <link href="/Eternity/%E9%A2%98%E8%A7%A3/p6217/"/>
      <url>/Eternity/%E9%A2%98%E8%A7%A3/p6217/</url>
      
        <content type="html"><![CDATA[<p>“十分<del>简单</del>复杂的数论题”</p><span id="more"></span><p>首先，对于所有 $\operatorname{lcm}$ 题，我们都选择用 $\gcd$ 来求。</p><p>有 $\operatorname{lcm}(a_i,x)=\frac{a_ix}{\gcd(a_i,x)}$ ，所以，把原来需要求的式子变成：</p><p>$ans=\frac{x\times\prod_{i=l}^{r}a_i}{\prod_{i=l}^{r}\gcd(a_i,x)}$</p><p>分子好求，直接求出前缀积 $Mul[i]$ 然后和 $x$ 相乘即可。</p><p>对于分母，因为有 $N\le 2\times 10^5$ ，所以暴力 $\text{biss}$ 。</p><p>我们可以从值域开始考虑，对于 $x\le 2\times 10^5$ ，最多有 $\mathcal O(\log x)$ 个质因数。</p><p>而对于：</p><p>$a_i=\prod p_k^{t_k},x=\prod p_k^{q_k}$ </p><p>则有：</p><p>$\gcd(a_i,x)=\prod p_k^{\min(t_k,q_k)}$ </p><p>同理就会有：</p><script type="math/tex; mode=display">\begin{align}\prod_{i=l}^{r}\gcd(a_i,x)    \nonumber&=\prod_{i=l}^{r}\prod_{k=1}^{len}p_{i,k}^{\min(t_{i,k},q_{i,k})}\\    \nonumber&=\prod_{k=1}^{len}p_{k}^{\sum_{i=l}^{r}\min(t_{i,k},q_{i,k})}\end{align}</script><p>所以，我们首先将所有的 $a_i$ 的质因子以及其幂因子存储到一个 $\operatorname{Hash}$ 表里，记录为其编号。然后对于每一次查询的 $x$ ，也这样子干，然后每查询到 $x$ 的一个质因子及其幂时，查询有多少个 $a_i$ 也存在这个质因子（或者其幂）。然后统计答案为 $pri[j]^{tot}$ ，$tot$ 表示满足条件的 $a_i$ 的个数，$pri[j]$ 表示当前质因子。</p><p>时间复杂度为 $\mathcal O(n\sqrt n\log n)$ ，但跑不满。后来发现这个算法常数似乎有点大，然后做了一些小优化，结果还是 $\text{T}$ 了一个点，可能是因为 $\operatorname{Hash}$ 和 <code>lower_bound</code> ， <code>upper_bound</code> 都用的 $\text{STL}$ ，所以吸氧过了。</p><details>    <summary>AC Code</summary><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> int long long</span></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN=<span class="number">2e5</span>+<span class="number">1</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> Mod=<span class="number">1e9</span>+<span class="number">7</span>;</span><br><span class="line"><span class="type">int</span> N,Q,Tot;</span><br><span class="line"><span class="type">int</span> val,Mul[MAXN],Pri[MAXN];</span><br><span class="line">std::vector&lt;<span class="type">int</span>&gt;Cnt[MAXN];</span><br><span class="line"><span class="type">bool</span> Is[MAXN];</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">Init</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">memset</span>(Is,<span class="number">1</span>,<span class="built_in">sizeof</span>(Is));</span><br><span class="line">    Is[<span class="number">1</span>]=<span class="number">0</span>;Mul[<span class="number">0</span>]=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">2</span>;i&lt;MAXN;++i)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(Is[i]) Pri[++Tot]=i;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">1</span>;j&lt;=Tot&amp;&amp;i*Pri[j]&lt;MAXN;++j)</span><br><span class="line">        &#123;</span><br><span class="line">            Is[i*Pri[j]]=<span class="number">0</span>;</span><br><span class="line">            <span class="keyword">if</span>(i%Pri[j]==<span class="number">0</span>) <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">qPow</span><span class="params">(<span class="type">int</span> a,<span class="type">int</span> b)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> res=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span>(b)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(b&amp;<span class="number">1</span>) res=res*a%Mod;</span><br><span class="line">        a=a*a%Mod;b&gt;&gt;=<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> res%Mod;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">signed</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// freopen(&quot;math.in&quot;,&quot;r&quot;,stdin);</span></span><br><span class="line">    <span class="comment">// freopen(&quot;math.out&quot;,&quot;w&quot;,stdout);</span></span><br><span class="line">    <span class="built_in">read</span>(N,Q);</span><br><span class="line">    <span class="built_in">Init</span>();</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>,cnt,tmp;i&lt;=N;++i)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">read</span>(val);</span><br><span class="line">        Mul[i]=Mul[i<span class="number">-1</span>]*val%Mod;</span><br><span class="line">        <span class="keyword">while</span>(val!=<span class="number">1</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">1</span>;j&lt;=Tot&amp;&amp;Pri[j]&lt;=val/Pri[j];++j)</span><br><span class="line">            &#123;</span><br><span class="line">                tmp=<span class="number">1</span>;</span><br><span class="line">                <span class="keyword">while</span>(val%Pri[j]==<span class="number">0</span>)</span><br><span class="line">                &#123;</span><br><span class="line">                    tmp*=Pri[j];val/=Pri[j];</span><br><span class="line">                    Cnt[tmp].<span class="built_in">push_back</span>(i);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(val!=<span class="number">1</span>) Cnt[val].<span class="built_in">push_back</span>(i),val=<span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>,l,r,x;i&lt;=Q;++i)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">read</span>(l,r,x);</span><br><span class="line">        <span class="type">int</span> res=<span class="number">1</span>,xx=x;</span><br><span class="line">        <span class="keyword">while</span>(x!=<span class="number">1</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">1</span>;j&lt;=Tot&amp;&amp;Pri[j]&lt;=x/Pri[j];++j)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="type">int</span> tmp=<span class="number">1</span>,tot=<span class="number">0</span>;</span><br><span class="line">                <span class="keyword">while</span>(x%Pri[j]==<span class="number">0</span>)</span><br><span class="line">                &#123;</span><br><span class="line">                    tmp*=Pri[j];x/=Pri[j];</span><br><span class="line">                    tot+=std::<span class="built_in">upper_bound</span>(Cnt[tmp].<span class="built_in">begin</span>(),Cnt[tmp].<span class="built_in">end</span>(),r)-std::<span class="built_in">lower_bound</span>(Cnt[tmp].<span class="built_in">begin</span>(),Cnt[tmp].<span class="built_in">end</span>(),l);</span><br><span class="line">                &#125;</span><br><span class="line">                res=res*<span class="built_in">qPow</span>(Pri[j],tot)%Mod;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(x!=<span class="number">1</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="type">int</span> tot=std::<span class="built_in">upper_bound</span>(Cnt[x].<span class="built_in">begin</span>(),Cnt[x].<span class="built_in">end</span>(),r)-std::<span class="built_in">lower_bound</span>(Cnt[x].<span class="built_in">begin</span>(),Cnt[x].<span class="built_in">end</span>(),l);</span><br><span class="line">                res=res*<span class="built_in">qPow</span>(x,tot)%Mod;x=<span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">write</span>(Mul[r]*<span class="built_in">qPow</span>(Mul[l<span class="number">-1</span>]*res%Mod,Mod<span class="number">-2</span>)%Mod*<span class="built_in">qPow</span>(xx,r-l+<span class="number">1</span>)%Mod),<span class="built_in">puts</span>(<span class="string">&quot;&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">5 5</span></span><br><span class="line"><span class="comment">12 8 9 14 21</span></span><br><span class="line"><span class="comment">1 5 2</span></span><br><span class="line"><span class="comment">1 3 3</span></span><br><span class="line"><span class="comment">3 5 7</span></span><br><span class="line"><span class="comment">1 5 6</span></span><br><span class="line"><span class="comment">2 3 7</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure></details>]]></content>
      
      
      <categories>
          
          <category> 题解 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 数论 </tag>
            
            <tag> 优化 </tag>
            
            <tag> RMQ </tag>
            
            <tag> 数据结构 </tag>
            
            <tag> 二分 </tag>
            
            <tag> 逆元 </tag>
            
            <tag> gcd </tag>
            
            <tag> lcm </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>同余 #2</title>
      <link href="/Eternity/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/OI/congruence-re/"/>
      <url>/Eternity/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/OI/congruence-re/</url>
      
        <content type="html"><![CDATA[<p>$\text{JK_Lover}$ 大帝亲自辅导。</p><span id="more"></span><h2 id="Exgcd"><a href="#Exgcd" class="headerlink" title="Exgcd"></a>Exgcd</h2><p>给定 $a,b$ ，求解不定方程 $ax+by=\gcd(a,b)$ 的整数解的算法。已知，当 $ax+by=c$ 有解时，当且仅当 $\gcd(a,b)|c$ 满足时。</p><p>我们通过 $bx’+(a\%b)y’=\gcd(b,a\%b)$ 来求解该方程，这个过程与求 $\gcd(a,b)$ 是类似的。而在 $b=0$ 的时候，明显有一组解为 $x=1,y=0$ 。那么，我们从 $bx’+(a\%b)y’=\gcd(b,a\%b)$ 的解 $x=x’,y=y’$ 来递归求解，将 $a\%b$ 展开为 $a-b\times \lfloor \frac{a}{b}\rfloor$ ，将该式带回原式，整理出 $a$ 和 $b$ 的系数，得到 $ay’+b(x’-\lfloor\frac{a}{b}\rfloor\times y’)=\gcd(b,a\%b)=\gcd(a,b)$ ，从而得到 $x=y’,y=x’-\lfloor\frac{a}{b}\rfloor\times y’$ 。</p><p>而对于一般解 $ax+by=c$ 的方程，有 $k=\frac{c}{\gcd(a,b)}$ ，则用 $\text{exgcd}$ 求出一组解之后再将 $x,y$ 扩大 $k$ 倍即可。</p><p>时间复杂度同 $\gcd(a,b)$ 为 $\mathcal O(\log \min(a,b))$ 。</p><hr><h2 id="逆元"><a href="#逆元" class="headerlink" title="逆元"></a>逆元</h2><p>如果有 $ax\equiv 1 \pmod m$ 成立，则 $a$ 是 $x$ 在模 $m$ 意义下的<strong>逆元</strong>。记作 $x^{-1}$ ，后也记作 $inv(x)$ 。</p><h3 id="模数为质数的求法"><a href="#模数为质数的求法" class="headerlink" title="模数为质数的求法"></a>模数为质数的求法</h3><p>有费马小定理：$x^{m-1}\equiv 1\pmod m$ ，而显然， $x^{m-2}\times x^{1}\equiv 1\pmod m$ ，那么， $x^{x-2}$ 就是 $x$ 在模 $m$ 意义下的逆元。在使用快速幂的前提下的时间复杂度为 $\mathcal O(\log m)$ 。</p><h3 id="线性递推式"><a href="#线性递推式" class="headerlink" title="线性递推式"></a>线性递推式</h3><p>首先有 $inv(1)=1$ ，对于 $x&gt;1$ 有 $\lfloor\frac{m}{x}\rfloor\times x+(m\%x)\equiv 0\pmod m$ ，然后得到式子 $(m\%x)\equiv m-\lfloor\frac{m}{x}\rfloor\times x\pmod m$ ，然后在式子两端同时乘上 $inv(x)\times inv(m\%x)$ 得到：</p><p>$inv(x)\equiv inv(m\%i)\times (m-\lfloor\frac{m}{i}\rfloor)\pmod m$ </p><p>这样就得出了逆元的线性递推式。这种方法只能用于 $m$ 是质数的情况，且限制情况较多。</p><p>此情况的时间复杂度是 $\mathcal O(n)$ 。</p><hr><h2 id="CRT"><a href="#CRT" class="headerlink" title="CRT"></a>CRT</h2><p>中国剩余定理（$\text{Chinese Remainder Theorem}$），用于求解满足：</p><script type="math/tex; mode=display">\left\{\begin{matrix}x \equiv a_1 \pmod {m_1} \\x \equiv a_2 \pmod {m_2} \\x \equiv a_3 \pmod {m_3} \\x \equiv a_4 \pmod {m_4} \\x \equiv a_5 \pmod {m_5} \\...... \\x \equiv a_k \pmod {m_k}\end{matrix}\right. \nonumber</script><p>其中 $m_1,m_2…m_k$ 两两互质（但不一定是质数），的最小的 $x$ 值。</p><p>设 $M=\prod m_i$ ，利用 $\text{exgcd}$ 求出 $\frac{M}{m_i}$ 的逆元，记为 $p_i$ ，求出一个数 $x_i=\frac{M}{m_i}\times p_i$ ，所以有 $x_i\times a_i\equiv 1\pmod{m_i}$ 且 $x_i\times a_i\equiv 0\pmod{m_j},i\ne j$ ，此时构造出的 $X_i=x_i\times a_i$ 满足了第 $i$ 个方程的限制，且不影响其他方程。那么合并方程解得到 $x=\sum x_i\times a_i\pmod M$ 即可。</p><p>$\text{CRT}$ 的时间复杂度为 $\mathcal O(n\log M)$ 。</p><hr><h2 id="EXCRT"><a href="#EXCRT" class="headerlink" title="EXCRT"></a>EXCRT</h2><p>扩展中国剩余定理，与 $\text{CRT}$ 求解一样的同余方程组，但 $m_1,m_2…m_k$ 不要求两两互质。</p><p>不断将两个同余方程合并为一个等价的同余方程：</p><p>对于 $x\equiv a_1\pmod{m_1},x\equiv a_2\pmod{m_2}$ ，将同余方程转化成不定方程，变成 $x=a_1+k_1\times m_1=a_2+k_2\times m_2$ ，得到 $k_2m_2-k_1m_1=a_1-a_2$ ，通过 $\text{Exgcd}$ 求得 $k_1,k_2$ ，然后代入求得 $x\equiv a_1+k_1m_1\pmod{\text{lcm}(m_1,m_2)}$ ，这就是合并的结果。最后得到一个方程时得到通解。</p><p>$\text{ExCrt}$ 的时间复杂度也是 $\mathcal O(n\log M)$ 。</p><h3 id="模板"><a href="#模板" class="headerlink" title="模板"></a>模板</h3><p><a href="https://www.luogu.com.cn/problem/P4777">P4777 【模板】扩展中国剩余定理（EXCRT）</a></p><details>    <summary>AC Code</summary><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line">ll N,px[MAXN],bx[MAXN];</span><br><span class="line"><span class="function"><span class="keyword">inline</span> ll <span class="title">qMul</span><span class="params">(ll a,ll b,ll p)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    ll res=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(b)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(b&amp;<span class="number">1</span>) res=(res+a)%p;</span><br><span class="line">        a=(a+a)%p;b&gt;&gt;=<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> ll <span class="title">qPow</span><span class="params">(ll a,ll b,ll p)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    ll res=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span>(b)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(b&amp;<span class="number">1</span>) res=<span class="built_in">qMul</span>(res,a,p);</span><br><span class="line">        a=<span class="built_in">qMul</span>(a,a,p);b&gt;&gt;=<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">ll <span class="title">Exgcd</span><span class="params">(ll a,ll b,ll &amp;x,ll &amp;y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(b==<span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        x=<span class="number">1</span>,y=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">return</span> a;</span><br><span class="line">    &#125;</span><br><span class="line">    ll gcd=<span class="built_in">Exgcd</span>(b,a%b,x,y);</span><br><span class="line">    ll z=x;x=y;y=z-a/b*x;</span><br><span class="line">    <span class="keyword">return</span> gcd;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">ll <span class="title">Excrt</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    ll x,y,k;</span><br><span class="line">    ll M=bx[<span class="number">1</span>],ans=px[<span class="number">1</span>];</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">2</span>;i&lt;=N;++i)</span><br><span class="line">    &#123;</span><br><span class="line">        ll a=M,b=bx[i],c=(px[i]-ans%b+b)%b;</span><br><span class="line">        ll Gcd=<span class="built_in">Exgcd</span>(a,b,x,y),Bg=b/Gcd;</span><br><span class="line">        <span class="keyword">if</span>(c%Gcd!=<span class="number">0</span>) <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">        x=<span class="built_in">qMul</span>(x,c/Gcd,Bg);</span><br><span class="line">        ans+=x*M;M*=Bg;ans=(ans%M+M)%M;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> (ans%M+M)%M;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// freopen(&quot;excrt.in&quot;,&quot;r&quot;,stdin);</span></span><br><span class="line">    <span class="comment">// freopen(&quot;excrt.out&quot;,&quot;w&quot;,stdout);</span></span><br><span class="line">    <span class="built_in">read</span>(N);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=N;++i) <span class="built_in">read</span>(bx[i],px[i]);</span><br><span class="line">    <span class="built_in">write</span>(<span class="built_in">Excrt</span>());</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">3</span></span><br><span class="line"><span class="comment">11 6</span></span><br><span class="line"><span class="comment">25 9</span></span><br><span class="line"><span class="comment">33 17</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure></details><hr><h3 id="例题"><a href="#例题" class="headerlink" title="例题"></a>例题</h3><p><a href="https://www.luogu.com.cn/problem/P4774">NOI2018D2T1</a></p><p>在这道题中 $m_i$ 是固定的。</p><p>对于每一次选用的剑，我们可以用 <code>multiset</code> 预处理出来。</p><p>对于每条龙的恢复力 $p_i$ ，我们在砍完之后需要让龙的血量为 $p_i$ 的负 $k$ 倍。则在每次攻击的时候，我们需要满足 $atk_i\times x\ge a_i,atk_i\times x\equiv a_i\pmod{p_i}$ 。</p><p>这道题有一个特性，要么满足 $p_i=1$ ，要么满足 $a_i\le p_i$ 。所以需要分情况讨论。</p><p>对于满足特性 $1$ 的情况：</p><p>对于 $atk_i\times x\ge a_i$ 且 $p_i=1$ 时，只需求出将每只龙的生命值打到非正数的次数，取最大值即可，即 $\max(\frac{a_i}{atk_i})$ ，容易处理。</p><p>对于满足 $a_i\le p_i$ ，我们用 $\text{ExCrt}$ 来解：</p><p>同余式是 $atk_i\times x\equiv a_i\pmod{p_i}$ ，化成单式得到 $x\equiv a_i\times atk_i^{-1}\pmod{p_i}$ ，根据同余的消去律，我们先同时除以 $\gcd(atk_i,a_i,p_i)$ ，此时，如果 $atk_i,p_i$ 不互质，则无解；否则，转化完之后直接套板子求就完事了。</p><p>对于大数据 <code>long long x long long</code> 的情况，则会爆 $1e18$ ，所以使用龟速乘优化模数以免出错。也可以使用 <code>long double</code> 来存储，实现 $\mathcal O(1)$ 快速乘，但出错率较大。</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> LoveLive;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> LoveLive <span class="title">Multi</span><span class="params">(LoveLive x,LoveLive y,LoveLive Mod)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    LoveLive tmp=(x*y-(LoveLive)((<span class="type">long</span> <span class="type">double</span>)x/mod*y+<span class="number">1.0e-8</span>)*Mod);</span><br><span class="line">    <span class="keyword">return</span> tmp&lt;<span class="number">0</span>?tmp+Mod:tmp;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>此定义 <code>typedef</code> 源于 $\text{JK_Lover}$ 大帝。</p><hr><h2 id="BSGS"><a href="#BSGS" class="headerlink" title="BSGS"></a>BSGS</h2><p>大步小步算法（$\text{Baby Step,Giant Step}$），用于求解离散对数问题，求解同余方程 $a^x\equiv b\pmod p$ ，的解 $x$ ，其中 $a,p$ 互质。</p><p>记有 $m=\sqrt p$ ，对于任意的 $x$ ，将 $x$ 写成 $x=im-j(0\le j&lt;m)$ ，则存在一个式子 $a^{i\times m}\equiv b\times a^j\pmod p$ ，则枚举 $j$ ，将 $b\times a^j$ 存到 $\text{hash}$ 表中，第二次枚举 $i$ ，在 $\text{hash}$ 表中查询与 $a^{i\times m}$ 相等的 $b\times a^j$ ，则一对 $i,j$ 确定一个解 $x$ 。如果求取最大或者最小解的话，则安排枚举顺序即可。</p><p>时间复杂度为 $\mathcal O(\sqrt p\times t)$ 。其中 $t$ 表示 $\text{hash}$ 表使用的时间。</p><p>对于最小解，我们首先使 $i$ 尽量小，然后使 $j$ 尽量大。因为有 $0\le j &lt;m$ ，所以 $j$ 对答案的影响没有 $i$ 大。所以我们首先枚举 $a^{im}\equiv ba^j\pmod p$ ，对应出 $h[i]=j$ ，然后从小到大枚举 $i$ 找到与最小的 $i$ 对应的 $j$ ，就是最小解。</p><p>而对于 $a,p$ 互质的使用，则在于将 $a^{im-j}\equiv b\pmod p$ 转化为 $a^{im}\equiv b\times a^j\pmod p$ 时，使用了 $a^j$ 的逆元。</p><p><a href="https://www.luogu.com.cn/problem/P3846">P3846 [TJOI2007] 可爱的质数/【模板】BSGS</a></p><details>    <summary>AC Code</summary><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">ll A,B,P;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> ll <span class="title">qPow</span><span class="params">(ll a,ll b,ll p)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    ll res=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span>(b)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(b&amp;<span class="number">1</span>) res=res*a%p;</span><br><span class="line">        a=a*a%p;b&gt;&gt;=<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">ll <span class="title">Bsgs</span><span class="params">(ll a,ll b,ll p)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    std::map&lt;ll,ll&gt;Hash;Hash.<span class="built_in">clear</span>();</span><br><span class="line">    b%=p;</span><br><span class="line">    ll t=std::<span class="built_in">sqrt</span>(p)+<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>(ll i=<span class="number">0</span>;i&lt;t;++i) Hash[<span class="function">b*<span class="title">qPow</span><span class="params">(a,i,p)</span>%p]</span>=i;</span><br><span class="line">    a=<span class="built_in">qPow</span>(a,t,p);</span><br><span class="line">    <span class="keyword">if</span>(!a) <span class="keyword">return</span> b==<span class="number">0</span>?<span class="number">1</span>:<span class="number">-1</span>;</span><br><span class="line">    <span class="keyword">for</span>(ll i=<span class="number">1</span>;i&lt;=t;++i)</span><br><span class="line">    &#123;</span><br><span class="line">        ll res=<span class="built_in">qPow</span>(a,i,p);</span><br><span class="line">        <span class="type">int</span> j=Hash.<span class="built_in">find</span>(res)==Hash.<span class="built_in">end</span>()?<span class="number">-1</span>:Hash[res];</span><br><span class="line">        <span class="keyword">if</span>(j&gt;=<span class="number">0</span>&amp;&amp;i*t-j&gt;=<span class="number">0</span>) <span class="keyword">return</span> i*t-j;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// freopen(&quot;bsgs.in&quot;,&quot;r&quot;,stdin);</span></span><br><span class="line">    <span class="comment">// freopen(&quot;bsgs.out&quot;,&quot;w&quot;,stdout);</span></span><br><span class="line">    <span class="built_in">read</span>(P,A,B);</span><br><span class="line">    ll ans=<span class="built_in">Bsgs</span>(A,B,P);</span><br><span class="line">    <span class="keyword">if</span>(ans==<span class="number">-1</span>) <span class="built_in">puts</span>(<span class="string">&quot;no solution&quot;</span>);</span><br><span class="line">    <span class="keyword">else</span> <span class="built_in">write</span>(ans);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></details><hr><h2 id="EXBSGS"><a href="#EXBSGS" class="headerlink" title="EXBSGS"></a>EXBSGS</h2><p>用于求解 $a,p$ 不一定互质的 $a^x\equiv b\pmod p$ 方程。</p><p>令 $d=\gcd(a,p)$ ，显然，在 $d=1$ 时，用 $\text{BSGS}$ 求解即可。</p><p>如果有 $d\not\mid b$ ，则有 $a^{x-1}\times\frac{a}{d}\equiv \frac{b}{d}\pmod {\frac{p}{d}}$ 重复该操作直到 $d=1$ ，得到 $a^{x-k}\times \frac{a}{\prod d}\equiv \frac{b}{\prod d}\pmod{\frac{p}{\prod d}}$ ，此时 $\gcd(a,\frac{p}{\prod d})=1$ ，转化成普通的 $\text{BSGS}$ 问题求解即可。</p><p>还需要判断 $x&lt;k$ 的情况是否有解。此时也是可能有解的，直接枚举$x$ 从 $0\sim k$ ，暴力判断 $a^{x-k}$ 是否同余 $b$ 即可。</p><p>$k$ 是 $\mathcal O(\log p)$ 级的，所以时间复杂度是 $\mathcal O(\sqrt p)$ 。 </p><p><a href="https://www.luogu.com.cn/problem/P4195">模板题</a>的<a href="https://www.luogu.com.cn/problem/SP3105">双倍经验</a></p><p>数据各有卡点，挺离谱的。</p><details>    <summary>AC Code</summary><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;ctime&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iomanip&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stack&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;map&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;ext/pb_ds/assoc_container.hpp&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;ext/pb_ds/tree_policy.hpp&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> gh() getchar()</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> re register</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> __gnu_pbds;</span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> ll;</span><br><span class="line">gp_hash_table&lt;ll,ll&gt;Hash;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    x=<span class="number">0</span>;</span><br><span class="line">    <span class="type">char</span> ch=<span class="built_in">gh</span>(),t=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(ch&lt;<span class="string">&#x27;0&#x27;</span>||ch&gt;<span class="string">&#x27;9&#x27;</span>) t|=ch==<span class="string">&#x27;-&#x27;</span>,ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">while</span>(ch&gt;=<span class="string">&#x27;0&#x27;</span>&amp;&amp;ch&lt;=<span class="string">&#x27;9&#x27;</span>) x=(x&lt;&lt;<span class="number">3</span>)+(x&lt;&lt;<span class="number">1</span>)+(ch^<span class="number">48</span>),ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">if</span>(t) x=-x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T,<span class="keyword">class</span> ...T1&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x,T1 &amp;...x1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">read</span>(x),<span class="built_in">read</span>(x1...);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">write</span><span class="params">(T x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(x&lt;<span class="number">0</span>) <span class="built_in">putchar</span>(<span class="string">&#x27;-&#x27;</span>),x=-x;</span><br><span class="line">    <span class="keyword">if</span>(x&gt;<span class="number">9</span>) <span class="built_in">write</span>(x/<span class="number">10</span>);</span><br><span class="line">    <span class="built_in">putchar</span>(x%<span class="number">10</span>+<span class="string">&#x27;0&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">checkMax</span><span class="params">(T &amp;x,T &amp;y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x&lt;y?x=y,<span class="number">1</span>:<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">checkMin</span><span class="params">(T &amp;x,T &amp;y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x&gt;y?x=y,<span class="number">1</span>:<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line">ll A,B,P;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> ll <span class="title">qPow</span><span class="params">(ll a,ll b,ll p)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    ll res=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span>(b)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(b&amp;<span class="number">1</span>) res=res*a%p;</span><br><span class="line">        a=a*a%p;b&gt;&gt;=<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">ll <span class="title">Gcd</span><span class="params">(ll a,ll b)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> b==<span class="number">0</span>?a:<span class="built_in">Gcd</span>(b,a%b);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Exgcd</span><span class="params">(ll a,ll b,ll &amp;x,ll &amp;y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(b==<span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        x=<span class="number">1</span>,y=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">return</span> ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">Exgcd</span>(b,a%b,x,y);</span><br><span class="line">    ll z=x;x=y;y=z-a/b*y;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> ll <span class="title">Inv</span><span class="params">(ll a,ll b)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    ll x,y;</span><br><span class="line">    <span class="built_in">Exgcd</span>(a,b,x,y);</span><br><span class="line">    <span class="keyword">return</span> (x%b+b)%b;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> ll <span class="title">Bsgs</span><span class="params">(ll a,ll b,ll p)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Hash.<span class="built_in">clear</span>();b%=p;</span><br><span class="line">    ll t=<span class="built_in">ceil</span>(std::<span class="built_in">sqrt</span>(p));</span><br><span class="line">    <span class="keyword">for</span>(ll i=<span class="number">1</span>;i&lt;=t;++i)</span><br><span class="line">    &#123;</span><br><span class="line">        b=b*a%p;Hash[b]=i;</span><br><span class="line">    &#125;</span><br><span class="line">    ll tmp=<span class="built_in">qPow</span>(a,t,p);b=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>(ll i=<span class="number">1</span>;i&lt;=t;++i)</span><br><span class="line">    &#123;</span><br><span class="line">        b=b*tmp%p;</span><br><span class="line">        <span class="keyword">if</span>(Hash[b]) <span class="keyword">return</span> (i*t-Hash[b]+p)%p;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> ll <span class="title">ExBsgs</span><span class="params">(ll a,ll b,ll p)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(b==<span class="number">1</span>||p==<span class="number">1</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    ll d=<span class="built_in">Gcd</span>(a,p),k=<span class="number">0</span>,Na=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span>(d&gt;<span class="number">1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(b%d!=<span class="number">0</span>) <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">        ++k;b/=d;p/=d;Na=Na*(a/d)%p;</span><br><span class="line">        <span class="keyword">if</span>(Na==b) <span class="keyword">return</span> k;</span><br><span class="line">        d=<span class="built_in">Gcd</span>(a,p);</span><br><span class="line">    &#125;</span><br><span class="line">    ll f=<span class="built_in">Bsgs</span>(a,b*<span class="built_in">Inv</span>(Na,p)%p,p);</span><br><span class="line">    <span class="keyword">if</span>(f==<span class="number">-1</span>) <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    <span class="keyword">return</span> f+k;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// freopen(&quot;exBSGS.in&quot;,&quot;r&quot;,stdin);</span></span><br><span class="line">    <span class="comment">// freopen(&quot;exBSGS.out&quot;,&quot;w&quot;,stdout);</span></span><br><span class="line">    <span class="built_in">read</span>(A,P,B);</span><br><span class="line">    <span class="keyword">while</span>(A||B||P)</span><br><span class="line">    &#123;</span><br><span class="line">        A%=P,B%=P;</span><br><span class="line">        ll ans=<span class="built_in">ExBsgs</span>(A,B,P);</span><br><span class="line">        <span class="keyword">if</span>(ans==<span class="number">-1</span>) <span class="built_in">puts</span>(<span class="string">&quot;No Solution&quot;</span>);</span><br><span class="line">        <span class="keyword">else</span> <span class="built_in">write</span>(ans),<span class="built_in">puts</span>(<span class="string">&quot;&quot;</span>);</span><br><span class="line">        <span class="built_in">read</span>(A,P,B);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">5 58 33</span></span><br><span class="line"><span class="comment">2 4 3</span></span><br><span class="line"><span class="comment">0 0 0</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure></details><hr><h2 id="原根"><a href="#原根" class="headerlink" title="原根"></a>原根</h2><p>定义一个 $g$ 满足 $g^1,g^2,g^3…g^{\phi(p)}$ 在模 $p$ 的意义下两两不相等，则 $g$ 是 $p$ 的<strong>原根</strong>。其中 $\phi(p)$ 表示与 $p$ 互质的数的个数。</p><p>对于一个质数 $p$ ，当 $g^i\not\equiv g^j\pmod p,i\ne j,i,j\in [0,p-1]$ 成立时， $g$ 是 $p$ 的原根。</p><h3 id="原根存在条件"><a href="#原根存在条件" class="headerlink" title="原根存在条件"></a>原根存在条件</h3><ul><li>奇质数一定存在原根；</li><li>如果 $g$ 是 $p$ 的原根，则 $g+p$ 或 $g$ 是 $p^2$ 的原根。</li><li>只有 $2,4,p^k,2\times p^k$ 的数存在原根，其中 $p$ 为奇质数，$k$ 为正整数。</li><li>若 $p$ 存在原根，则 $p$ 的原根个数为 $\phi(\phi(p))$ 个。</li></ul><h3 id="查找原根"><a href="#查找原根" class="headerlink" title="查找原根"></a>查找原根</h3><p>检验原根，则是枚举 $g$ 的质因数 $x$ ，并验证 $g^{\frac{\phi(p)}{x}}=1$ 是否成立，如果成立，则 $g$ 不是 $p$ 的原根。</p><p>因为有欧拉定理：$a^{\phi(p)}\equiv 1\pmod p$ ，所以如果上述式子提前成立，则证明其循环节不超过 $p-1$ ，则 $g$ 不是 $p$ 的原根。</p><p>经数学家证明，一个数如果存在原根，其最小原根是较小的，因此可以用枚举找原根。</p><hr><h2 id="阶"><a href="#阶" class="headerlink" title="阶"></a>阶</h2><p>对于两个数 $a,m\in\mathbb N_+$ ，有 $a\perp m$ （$a$ 与 $m$ 互质），使 $a^x\equiv 1\pmod m$ 成立的最小正整数 $x $ ，被称为 $a$ 模 $m$ 的<strong>阶</strong>，记作 $\operatorname{ord}_ma$ 。</p><h3 id="阶的性质"><a href="#阶的性质" class="headerlink" title="阶的性质"></a>阶的性质</h3><ol><li>$a^n\equiv 1\pmod m$ 的充要条件是 $\operatorname{ord}_ma\mid n$ 。</li><li>$\operatorname{ord}_ma\mid\varphi(m)$ 。</li><li>若 $a\equiv b\pmod m$ ，则 $\operatorname{ord}_ma=\operatorname{ord}_mb$ 。</li></ol><hr><h2 id="二次剩余-Cipolla"><a href="#二次剩余-Cipolla" class="headerlink" title="二次剩余 - Cipolla"></a>二次剩余 - Cipolla</h2><p>用于在模奇质数 $p$ 意义下开根号，即求方程 $x^2\equiv n\pmod p$ 的解 $x$ 。</p><h3 id="勒让德符号"><a href="#勒让德符号" class="headerlink" title="勒让德符号"></a>勒让德符号</h3><p>定义 $(\frac{n}{p})=n^{\frac{p-1}{2}}$ 称为<strong>勒让德符号</strong>。</p><p>根据<strong>欧拉准则</strong>：</p><ul><li>当 $(\frac{n}{p})\equiv 1\pmod p$ 时，$n$ 是 $p$ 的二次剩余，原方程有解；</li><li>当 $(\frac{n}{p})\equiv -1\pmod p$ 时， $n$ 不是 $p$ 二次剩余，原方程无解；</li><li>当 $(\frac{n}{p})\equiv 0\pmod p$ 时，$n\equiv 0\pmod p$ 。</li></ul><h3 id="求解二次剩余"><a href="#求解二次剩余" class="headerlink" title="求解二次剩余"></a>求解二次剩余</h3><p>对于 $n$ 是 $p$ 的二次剩余，我们随机值一个 $a$ ，使 $a^2-n$ 不为 $p$ 的二次剩余。（期望步数为 $2$ ）记一个 $\omega=\sqrt{a^2-n}$ ，类似于复数的定义，定义一个新数域 $z=x+y\times\omega(x,y\in\mathbb N)$ ，可以得到 $x\equiv \pm(a+\omega)^{\frac{p+1}{2}}\pmod p$ 为原方程的解。</p><hr><p>简单证明：（省略 $\pmod p$ 的书写）</p><p>由 $x\equiv \pm(a+\omega)^{\frac{p+1}{2}}$ 得到：$x^2\equiv(a+\omega)^p(a+\omega)$ ，由二项式定理展开得到：</p><p>$(a+\omega)^p\equiv\sum^p_{i=0}(^p_i)a^i\omega^{p-i}$ </p><p>然后根据 $\text{Lucas}$ 定理得到当且仅当 $i=\{0,p\}$ 时， $(^p_i)$ 模 $p$ 不为 $0$ 。从而得到：</p><p>$(a+\omega)^p\equiv a^p+\omega^p$ 。又有 $a^p\equiv a$ ，则 $\omega^p\equiv \omega\times(\omega^2)^{\frac{p-1}{2}}\equiv-\omega$ 。</p><p>则：</p><p>$x^2\equiv (a-\omega)(a+\omega)\equiv a^2-\omega^2\equiv n$ </p><p>证毕。</p><hr><p>所谓使用的 $\text{Lucas}$ 定理，则是由 $\binom{p}{i}=\frac{p^{\underline{i}}}{i!}$ ，而 $\binom{p}{i}$ 在模 $p$ 意义下当且仅当 $i=\{0,p\}$ 成立时不为 $0$ 。</p><h2 id="斐波那契数列循环"><a href="#斐波那契数列循环" class="headerlink" title="斐波那契数列循环"></a>斐波那契数列循环</h2><p>可以证明，在模 $p$ 意义下，斐波那契数列有循环节，且循环节长度上界是 $6p$ ，即在至多 $6p$ 的情况下，模 $p$ 的斐波那契会进入循环。</p><h3 id="生日悖论与指针扫描"><a href="#生日悖论与指针扫描" class="headerlink" title="生日悖论与指针扫描"></a>生日悖论与指针扫描</h3><p>随机取出两个 $pos$ 并检验以 $pos$ 为起始的两位是否出现过。由生日悖论可以得到期望下，只要 $\mathcal O(\sqrt p)$ 次即可得到一个循环节，但不一定最小。然后枚举因数验证。</p><h3 id="矩阵大步小步"><a href="#矩阵大步小步" class="headerlink" title="矩阵大步小步"></a>矩阵大步小步</h3><p>对矩阵进行 $\text{BSGS}$ ，令转移矩阵为 $A$ ，则有 $A^k=I$ ，由斐波那契定义得到 $A$ 一定存在逆。</p><h3 id="结论法"><a href="#结论法" class="headerlink" title="结论法"></a>结论法</h3><ul><li>当 $p$ 十分小的时候，可以直接开摆；</li><li>若 $p$ 为奇质数：<ul><li>若 $5$ 是模 $p$ 意义下的二次剩余，循环节长度一定是 $p - 1$ 的约数；</li><li>否则，循环节长度一定是 $2p + 2$ 的约数；</li></ul></li><li>否则， $p$ 是合数，也有结论，但不可用。</li></ul>]]></content>
      
      
      <categories>
          
          <category> 学习笔记 </category>
          
          <category> OI </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 数论 </tag>
            
            <tag> 质数 </tag>
            
            <tag> 同余 </tag>
            
            <tag> 中国剩余定理 </tag>
            
            <tag> 欧几里得算法 </tag>
            
            <tag> 同余方程 </tag>
            
            <tag> 扩展欧几里得算法 </tag>
            
            <tag> 大步小步算法 </tag>
            
            <tag> 扩展中国剩余定理 </tag>
            
            <tag> 扩展大步小步算法 </tag>
            
            <tag> 原根 </tag>
            
            <tag> gcd </tag>
            
            <tag> lcm </tag>
            
            <tag> 二次剩余 </tag>
            
            <tag> 斐波那契 </tag>
            
            <tag> 生日悖论 </tag>
            
            <tag> 双指针 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>多项式</title>
      <link href="/Eternity/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/OI/polynomial/"/>
      <url>/Eternity/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/OI/polynomial/</url>
      
        <content type="html"><![CDATA[<p>“虚妄与实冢的交错，逆塑快速变换的坤仑。”</p><span id="more"></span><h2 id="复数"><a href="#复数" class="headerlink" title="复数"></a>复数</h2><p>形如 $a+bi,i=\sqrt{-1}$ 的数，其中 $a$ 为该复数的实根， $b$ 为该复数的虚根。一个复数 $x=a+bi$ 可以表示为一个向量 $(a,b)$ 。这样的数称为<strong>复数</strong>（$\text{complex}$）。</p><h3 id="复数意义上的单位根"><a href="#复数意义上的单位根" class="headerlink" title="复数意义上的单位根"></a>复数意义上的单位根</h3><p>指的是坐标轴上的一个单位圆，被等分成 $n$ 份，有函数 $\omega_{k}^{n}$ 表示把这个单位圆等分成 $n$ 份取 $k$ 份，每一份大小为 $\frac{2\pi}{n}k$ ，被称为 $n$ 次单位根。</p><p>有性质：</p><ol><li>$\omega^{i}_n\ne\omega^j_n,\forall i\ne j$ ；</li><li>$\omega^k_n=\cos \frac{2k\pi}{n}+i\sin\frac{2k\pi}{n}$ ；</li><li>$\omega_n^0=\omega_n^n=1$ ；</li><li>$\omega^{2k}_{2n}=\omega^{k}_n$ ；</li><li>$\omega_n^{k+\frac{\pi}{2}}=-\omega_n^k$ ；</li><li>$\omega_n^i\times\omega_n^j=\omega_n^{i+j}$ ；</li><li>$\omega_n^k=-\omega_n^{-k}$ 。</li></ol><h2 id="多项式"><a href="#多项式" class="headerlink" title="多项式"></a>多项式</h2><h3 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h3><p>形如：</p><script type="math/tex; mode=display">A(x)=a_0+a_1x+a_2x^2+...a_nx^n \nonumber</script><p>的函数式。</p><h3 id="性质"><a href="#性质" class="headerlink" title="性质"></a>性质</h3><h4 id="Ⅰ"><a href="#Ⅰ" class="headerlink" title="Ⅰ"></a>Ⅰ</h4><p>用该多项式函数上任意 $n+1$ 个不同点，均可唯一一个 $n$ 个多项式。</p><p>这条性质也被称为是多项式的<strong>点表示法</strong>。</p><h3 id="宏定义"><a href="#宏定义" class="headerlink" title="宏定义"></a>宏定义</h3><h4 id="幂级数"><a href="#幂级数" class="headerlink" title="幂级数"></a>幂级数</h4><p>可列项相加的求和式称为<strong>级数</strong>，而对于和式 $\sum_{n=0}^{\infty}a_nx^n$ 中，每项均为非负整数次幂函数乘常数系数，这样的形式级数称为<strong>幂级数</strong>。</p><h4 id="多项式环"><a href="#多项式环" class="headerlink" title="多项式环"></a>多项式环</h4><p>在<strong>群论</strong>中有一个定义为<strong>环</strong>，而对于一般环 $R$ ，定义 $R$ 上的<strong>多项式环</strong>（$\text{polynomial ring}$）为 $R[x]$ 。</p><p>每个元素 $f$ 称为 $R$ 上的多项式，表示为：</p><p>$f=\langle f_0,f_1,f_2\dots f_n\rangle,(f_0,f_1,f_2,\dots,f_n\in R)$ </p><p>直接将多项式定义为系数序列，表示为：</p><p>$f(x)=f_0+f_1x+f_2x^2+\dots+f_nx^n$</p><p>这也是我们熟知的多项式定义，这里设 $x$ 是一个<strong>形式符号</strong>，一个对系数位置的标识符。</p><p>当然，这里的多项式也包括了无穷项的存在：</p><p>$f(x)=f_0+f_1x+f_2x^2+\dots$</p><p>则得到<strong>形式幂级数环</strong>（$\text{formal power series ring}$）$R[[x]]$ ，其中每一个元素 $f$ 被称为<strong>形式幂级数</strong>（$\text{formal power series}$），简称为幂级数。</p><h4 id="度"><a href="#度" class="headerlink" title="度"></a>度</h4><p>对于一个多项式 $f(x)$ ，其最高次项的次数被称为该多项式的度（$\text{Degree}$），也就是所说的次数，记作 $\deg f$ 。</p><hr><h3 id="运算"><a href="#运算" class="headerlink" title="运算"></a>运算</h3><h4 id="加减"><a href="#加减" class="headerlink" title="加减"></a>加减</h4><p>$f(x)\pm g(x)=\sum_{i=0}a_ix\pm b_i x$ 。</p><h4 id="乘法"><a href="#乘法" class="headerlink" title="乘法"></a>乘法</h4><p>首先定义多项式 $f(x),g(x)$ ：</p><p>$f(x)=a_0+a_1x+…+a_nx^n$</p><p>$g(x)=b_0+b_0x+…b_mx^m$</p><p>则有：</p><p>$Q(x)=f(x)\cdot g(x)=\sum\limits_{i=0}^n\sum\limits_{j=0}^{m}a_ib_jx^{i+j}=c_0+c_1x+…+c_{n+m}x^{n+m}$</p><p>多项式或是幂级数的乘法满足结合律，其加法也满足分配律。而如果 $R$ 为交换环或幺环，乘法则具有交换律和单位元。</p><p>而所谓的 $\text{FFT}$ 能够在 $\mathcal O(n2^n)$ 的时间内计算两个 $2^n$ 次多项式的乘积。</p><hr><h2 id="快速傅里叶变换"><a href="#快速傅里叶变换" class="headerlink" title="快速傅里叶变换"></a>快速傅里叶变换</h2><p>俗称为 $\text{FFT}$ ，用于处理多项式乘法。</p><p>在满足性质：</p><blockquote><p>用该多项式函数上任意 $n+1$ 个不同点，均可唯一一个 $n$ 个多项式。</p></blockquote><p>是使用 $\text{FFT}$ 的前提与条件。</p><hr><h3 id="例题"><a href="#例题" class="headerlink" title="例题"></a>例题</h3><p>求解 $C(x)=A(x)B(x)$ ，其中 $A(x)$ 为 $n$ 次式，$B(x)$ 为 $m$ 次式。</p><hr><p>首先，这个问题在现实中的计算时间应该是 $\mathcal O(nm)$ 的，这个不必赘述。而 $\text{FFT}$ 能将复杂度降低到 $\mathcal O(n\log n)$ 。</p><h4 id="正变换：系数表示法-gt-点表示法"><a href="#正变换：系数表示法-gt-点表示法" class="headerlink" title="正变换：系数表示法 -&gt; 点表示法"></a>正变换：系数表示法 -&gt; 点表示法</h4><p>利用点表示法，我们需要选择 $n+m+1$ 个点，表示为 $x_1,x_2…x_{n+m+1}$ ，因为有性质 $C(x_i)=A(x_i)B(x_i),\forall i\in A,B$ ，则我们求解 $n+m+1$ 个特殊点，然后通过点表示法转化回系数表示法。</p><p>有性质决定，我们选择的特殊点是<strong>复数的单位根</strong>。</p><p>有 $A(x)=a_0+a_1x+a_2x^2…+a_{n-1}x^{n-1}$ ，我们需要快速求出 $A(\omega_{k}^{n}),k\in[0,n-1]$ ，则是这道题的关键。</p><p>我们把 $A(x)$ 分开奇偶，表示为：</p><p>$A(x)=(a_0+a_2x^2+…a_{n-2}x^{n-2})+(a_1x+a_3x^{3}+…a_{n-1}x^{n-1})$</p><p>并将前者用 $A_1(x)$ 表示，后者用 $A_2(x)$ 来表示。</p><p>对于 $A_1(x)$ ，我们用 $x^2$ 换元 $x$ ，得到：</p><p>$A_1(x)=a_0+a_2x+a_4x^2+…+a_{n-2}x^{\frac{n}{2}-1}$</p><p>同样有：</p><p>$A_2(x)=a_1+a_3x+a_5x^2+…+a_{n-1}x^{\frac{n}{2}-1}$</p><p>带回原式则有：</p><p>$A(x)=A_1(x^2)+xA_2(x^2)$ </p><p> 带回 $\omega_k^n$ ，其中 $k\in [0,\frac{n}{2}-1]$ 。则有：</p><p>$A(\omega^k_n)=A_1(\omega_n^{2k})+\omega_n^kA_2(\omega_n^{2k})=A_1(\omega_{\frac{n}{2}}^k)+\omega_n^kA_2(\omega_{\frac{n}{2}}^k)$</p><p>同理得到：（$k+n$ 相当于是 $k$ ，因为 $n$ 就表示为一圈）</p><p>$A(\omega_n^{k+\frac{n}{2}})=A_1(\omega^{k}_{\frac{n}{2}})-\omega_n^kA_2(\omega_{\frac{n}{2}}^k)$</p><p>那么，对于一个 $n$ 次式的 $A(x)$ ，我们把其拆分为 $2$ 个 $\frac{n}{2}$ 的子多项式，从而求出 $A(x)$，那么最后直到拆分成 $0$ 次式，最后递归操作，时间复杂度为 $\mathcal O(n\log n)$ 。</p><h4 id="反变换：点表示法-gt-系数表示法"><a href="#反变换：点表示法-gt-系数表示法" class="headerlink" title="反变换：点表示法 -&gt; 系数表示法"></a>反变换：点表示法 -&gt; 系数表示法</h4><p>设现在我们已经求出了 $n+1$ 个点 $(\omega_n^k,A(w_n^k))$ ，我们设原多项式为：</p><p>$A(x)=c_0+c_1x+…c_{n-1}x^{n-1}$ </p><p>存在定理：$c_k=\sum\limits_{i=0}^{n-1}y_i(\omega_n^{-k})^i$ </p><p>转化未知数得到：$B(x)=y_0+y_1x+…y_{n-1}x^{n-1}$ ，则有 $c_k=B(\omega_n^{-k})$ 。（这个 $B(x)$ 是我们相乘之后得到的答案的点表示法）所以我们需要的是通过反变换求出 $B(\omega_n^0)\sim B(\omega_n^{-(n-1)})$ 即是答案。然后根据单位根的性质七，我们实际上就是需要求解 $B(\omega_n^0)\sim B(\omega_n^{n-1})$ 。</p><p>现在我们再次组织 $c_k$ ：</p><script type="math/tex; mode=display">\begin{align}c_k    \nonumber&=\sum\limits_{i=0}^{n-1}y_i(\omega_n^{-k})^i    \nonumber\\&=\sum_{i=0}^{n-1}(\sum_{j=0}^{n-1}a_j(\omega^i_n)^j)(\omega_n^{-k})^i    \nonumber\\&=\\sum_{j=0}^{n-1}a_j(\sum_{i=0}^{n-1}(\omega_n^{j-k})^i)    \nonumber\\&=na_k    \nonumber\end{align}</script><p>最后得到 $c_k=na_k$ ，从而得到 $a_k=\frac{c_k}{n}$ ，得到答案中的系数。</p><h4 id="迭代法的变迁"><a href="#迭代法的变迁" class="headerlink" title="迭代法的变迁"></a>迭代法的变迁</h4><p>实际上，我们不需要使用递归来实现多项式的正变换，而是可以使用递推的方式来解决。</p><p>有一个性质：对于系数 $i$ ，它在正变换的末尾（递归的结尾部分）的标号会将其二进制位取反：</p><p>例如：对于 $8$ 次式 $a_0,a_1,a_2,a_3,a_4,a_5,a_6,a_7,a_8$ ；</p><p>变换之后的系数顺序是 $a_0,a_4,a_2,a_6,a_1,a_5,a_3,a_7$ 。</p><p>用二进制表示为：</p><p>$000,001,010,011,100,101,110,111$ </p><p>和</p><p>$000,100,010,110,001,101,011,111$ </p><p>这样就浅显易懂了。从而，在实现时，我们可以预处理出当前系数会跳到的位置，然后从底端递推到原式以减少迭代消耗的时间。</p><p><a href="https://www.luogu.com.cn/problem/P3803">P3803 【模板】多项式乘法（FFT）</a></p><details>    <summary>AC Code</summary><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> ll;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN=<span class="number">3e6</span>+<span class="number">1</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">double</span> Pi=<span class="built_in">acos</span>(<span class="number">-1</span>);</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    x=<span class="number">0</span>;</span><br><span class="line">    <span class="type">char</span> ch=<span class="built_in">gh</span>(),t=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(ch&lt;<span class="string">&#x27;0&#x27;</span>||ch&gt;<span class="string">&#x27;9&#x27;</span>) t|=ch==<span class="string">&#x27;-&#x27;</span>,ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">while</span>(ch&gt;=<span class="string">&#x27;0&#x27;</span>&amp;&amp;ch&lt;=<span class="string">&#x27;9&#x27;</span>) x=(x&lt;&lt;<span class="number">3</span>)+(x&lt;&lt;<span class="number">1</span>)+(ch^<span class="number">48</span>),ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">if</span>(t) x=-x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T,<span class="keyword">class</span> ...T1&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x,T1 &amp;...x1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">read</span>(x),<span class="built_in">read</span>(x1...);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">write</span><span class="params">(T x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(x&lt;<span class="number">0</span>) <span class="built_in">putchar</span>(<span class="string">&#x27;-&#x27;</span>),x=-x;</span><br><span class="line">    <span class="keyword">if</span>(x&gt;<span class="number">9</span>) <span class="built_in">write</span>(x/<span class="number">10</span>);</span><br><span class="line">    <span class="built_in">putchar</span>(x%<span class="number">10</span>+<span class="string">&#x27;0&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> N,M;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Complex</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">double</span> x,y;</span><br><span class="line">    Complex <span class="keyword">operator</span>+(<span class="type">const</span> Complex&amp; t) <span class="type">const</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> &#123;x+t.x,y+t.y&#125;;</span><br><span class="line">    &#125;</span><br><span class="line">    Complex <span class="keyword">operator</span>-(<span class="type">const</span> Complex&amp; t) <span class="type">const</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> &#123;x-t.x,y-t.y&#125;;</span><br><span class="line">    &#125;</span><br><span class="line">    Complex <span class="keyword">operator</span>*(<span class="type">const</span> Complex&amp; t) <span class="type">const</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> &#123;x*t.x-y*t.y,x*t.y+y*t.x&#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;a[MAXN],b[MAXN];</span><br><span class="line"><span class="type">int</span> Rev[MAXN],Bit,Tot;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">Fft</span><span class="params">(Complex a[],<span class="type">int</span> inv)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;Tot;++i)</span><br><span class="line">        <span class="keyword">if</span>(i&lt;Rev[i]) std::<span class="built_in">swap</span>(a[i],a[Rev[i]]);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> mid=<span class="number">1</span>;mid&lt;Tot;mid&lt;&lt;=<span class="number">1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">auto</span> w_1=<span class="built_in">Complex</span>(&#123;std::<span class="built_in">cos</span>(Pi/mid),inv*std::<span class="built_in">sin</span>(Pi/mid)&#125;);</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;Tot;i+=mid*<span class="number">2</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">auto</span> w_k=<span class="built_in">Complex</span>(&#123;<span class="number">1</span>,<span class="number">0</span>&#125;);</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">0</span>;j&lt;mid;++j,w_k=w_k*w_1)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">auto</span> x=a[i+j],y=w_k*a[i+j+mid];</span><br><span class="line">                a[i+j]=x+y,a[i+j+mid]=x-y;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// freopen(&quot;fft.in&quot;,&quot;r&quot;,stdin);</span></span><br><span class="line">    <span class="comment">// freopen(&quot;fft.out&quot;,&quot;w&quot;,stdout);</span></span><br><span class="line">    <span class="built_in">read</span>(N,M);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;=N;++i) <span class="built_in">scanf</span>(<span class="string">&quot;%lf&quot;</span>,&amp;a[i].x);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;=M;++i) <span class="built_in">scanf</span>(<span class="string">&quot;%lf&quot;</span>,&amp;b[i].x);</span><br><span class="line">    <span class="keyword">while</span>((<span class="number">1</span>&lt;&lt;Bit)&lt;N+M+<span class="number">1</span>) ++Bit;</span><br><span class="line">    Tot=<span class="number">1</span>&lt;&lt;Bit;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;Tot;++i) Rev[i]=(Rev[i&gt;&gt;<span class="number">1</span>]&gt;&gt;<span class="number">1</span>)|((i&amp;<span class="number">1</span>)&lt;&lt;(Bit<span class="number">-1</span>));</span><br><span class="line">    <span class="built_in">Fft</span>(a,<span class="number">1</span>),<span class="built_in">Fft</span>(b,<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;Tot;++i) a[i]=a[i]*b[i];</span><br><span class="line">    <span class="built_in">Fft</span>(a,<span class="number">-1</span>);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;=N+M;++i) <span class="built_in">printf</span>(<span class="string">&quot;%d &quot;</span>,(<span class="type">int</span>)(a[i].x/Tot+<span class="number">0.5</span>));</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">1 2</span></span><br><span class="line"><span class="comment">1 2</span></span><br><span class="line"><span class="comment">1 2 1</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure></details><hr><h3 id="FFT-优化高精度乘法"><a href="#FFT-优化高精度乘法" class="headerlink" title="FFT 优化高精度乘法"></a>FFT 优化高精度乘法</h3><p>我们将一个高精度表示的数组转化为一个多项式：</p><p>$A=\overline{a_{n-1}a_{n-2}\dots a_0}=a_{n-1}\times 10^{n-1}+a_{n-2}\times 10^{n-2}+\dots a_0\times 10^0$ 。</p><p>那么，我们把 $10$ 看作是未知数 $x$ ，则 $a$ 就是需要求的系数。</p><p>这样做同样是有根据的，因为有 $C(x)=A(x)B(x)$ ，所以才会有 $C(10)=A(10)B(10)=AB$ 。</p><p>然后就可做了。</p><details>    <summary>AC Code</summary><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN=<span class="number">3e6</span>+<span class="number">1</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">double</span> Pi=<span class="built_in">acos</span>(<span class="number">-1</span>);</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    x=<span class="number">0</span>;</span><br><span class="line">    <span class="type">char</span> ch=<span class="built_in">gh</span>(),t=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(ch&lt;<span class="string">&#x27;0&#x27;</span>||ch&gt;<span class="string">&#x27;9&#x27;</span>) t|=ch==<span class="string">&#x27;-&#x27;</span>,ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">while</span>(ch&gt;=<span class="string">&#x27;0&#x27;</span>&amp;&amp;ch&lt;=<span class="string">&#x27;9&#x27;</span>) x=(x&lt;&lt;<span class="number">3</span>)+(x&lt;&lt;<span class="number">1</span>)+(ch^<span class="number">48</span>),ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">if</span>(t) x=-x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T,<span class="keyword">class</span> ...T1&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x,T1 &amp;...x1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">read</span>(x),<span class="built_in">read</span>(x1...);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">write</span><span class="params">(T x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(x&lt;<span class="number">0</span>) <span class="built_in">putchar</span>(<span class="string">&#x27;-&#x27;</span>),x=-x;</span><br><span class="line">    <span class="keyword">if</span>(x&gt;<span class="number">9</span>) <span class="built_in">write</span>(x/<span class="number">10</span>);</span><br><span class="line">    <span class="built_in">putchar</span>(x%<span class="number">10</span>+<span class="string">&#x27;0&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">checkMax</span><span class="params">(T &amp;x,T &amp;y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x&lt;y?x=y,<span class="number">1</span>:<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">checkMin</span><span class="params">(T &amp;x,T &amp;y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x&gt;y?x=y,<span class="number">1</span>:<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Cl</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">double</span> x,y;</span><br><span class="line">    Cl <span class="keyword">operator</span>+(<span class="type">const</span> Cl &amp;a) <span class="type">const</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> &#123;x+a.x,y+a.y&#125;;</span><br><span class="line">    &#125;</span><br><span class="line">    Cl <span class="keyword">operator</span>-(<span class="type">const</span> Cl &amp;a) <span class="type">const</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> &#123;x-a.x,y-a.y&#125;;</span><br><span class="line">    &#125;</span><br><span class="line">    Cl <span class="keyword">operator</span>*(<span class="type">const</span> Cl &amp;a) <span class="type">const</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> &#123;x*a.x-y*a.y,x*a.y+y*a.x&#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;a[MAXN],b[MAXN];</span><br><span class="line"><span class="type">char</span> str1[MAXN],str2[MAXN];</span><br><span class="line"><span class="type">int</span> res[MAXN],N,M;</span><br><span class="line"><span class="type">int</span> Rev[MAXN],Bit,Tot;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">Fft</span><span class="params">(Cl a[],<span class="type">int</span> inv)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;Tot;++i)</span><br><span class="line">        <span class="keyword">if</span>(i&lt;Rev[i]) std::<span class="built_in">swap</span>(a[i],a[Rev[i]]);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> mid=<span class="number">1</span>;mid&lt;Tot;mid&lt;&lt;=<span class="number">1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">auto</span> w1=<span class="built_in">Cl</span>(&#123;<span class="built_in">cos</span>(Pi/mid),inv*<span class="built_in">sin</span>(Pi/mid)&#125;);</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;Tot;i+=mid*<span class="number">2</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">auto</span> wk=<span class="built_in">Cl</span>(&#123;<span class="number">1</span>,<span class="number">0</span>&#125;);</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">0</span>;j&lt;mid;++j,wk=wk*w1)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">auto</span> x=a[i+j],y=wk*a[i+j+mid];</span><br><span class="line">                a[i+j]=x+y,a[i+j+mid]=x-y;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// freopen(&quot;.in&quot;,&quot;r&quot;,stdin);</span></span><br><span class="line">    <span class="comment">// freopen(&quot;.out&quot;,&quot;w&quot;,stdout);</span></span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%s%s&quot;</span>,str1,str2);</span><br><span class="line">    N=<span class="built_in">strlen</span>(str1)<span class="number">-1</span>,M=<span class="built_in">strlen</span>(str2)<span class="number">-1</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;=N;++i) a[i].x=str1[N-i]-<span class="string">&#x27;0&#x27;</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;=M;++i) b[i].x=str2[M-i]-<span class="string">&#x27;0&#x27;</span>;</span><br><span class="line">    <span class="keyword">while</span>((<span class="number">1</span>&lt;&lt;Bit)&lt;N+M+<span class="number">1</span>) ++Bit;</span><br><span class="line">    Tot=<span class="number">1</span>&lt;&lt;Bit;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;Tot;++i) Rev[i]=((Rev[i&gt;&gt;<span class="number">1</span>]&gt;&gt;<span class="number">1</span>))|((i&amp;<span class="number">1</span>)&lt;&lt;(Bit<span class="number">-1</span>));</span><br><span class="line">    <span class="built_in">Fft</span>(a,<span class="number">1</span>),<span class="built_in">Fft</span>(b,<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;Tot;++i) a[i]=a[i]*b[i];</span><br><span class="line">    <span class="built_in">Fft</span>(a,<span class="number">-1</span>);</span><br><span class="line">    <span class="type">int</span> k=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>,t=<span class="number">0</span>;i&lt;Tot||t;++i)</span><br><span class="line">    &#123;</span><br><span class="line">        t+=a[i].x/Tot+<span class="number">0.5</span>;</span><br><span class="line">        res[k++]=t%<span class="number">10</span>;</span><br><span class="line">        t/=<span class="number">10</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span>(k&gt;<span class="number">1</span>&amp;&amp;!res[k<span class="number">-1</span>]) --k;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=k<span class="number">-1</span>;i&gt;=<span class="number">0</span>;--i) <span class="built_in">write</span>(res[i]);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">114514 </span></span><br><span class="line"><span class="comment">1919810</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure></details><hr>]]></content>
      
      
      <categories>
          
          <category> 学习笔记 </category>
          
          <category> OI </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 构造 </tag>
            
            <tag> 生成函数 </tag>
            
            <tag> 多项式 </tag>
            
            <tag> 复数 </tag>
            
            <tag> 卷积 </tag>
            
            <tag> 快速傅里叶变换FFT </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>碗中有天地</title>
      <link href="/Eternity/%E7%9F%AD%E7%AF%87%E5%B0%8F%E8%AF%B4/%E6%97%AD%E6%97%A5%E4%B8%9C%E5%8D%87%E7%9A%84%E4%BC%A0%E8%AF%B4/heaven-and-earth-in-a-bowl/"/>
      <url>/Eternity/%E7%9F%AD%E7%AF%87%E5%B0%8F%E8%AF%B4/%E6%97%AD%E6%97%A5%E4%B8%9C%E5%8D%87%E7%9A%84%E4%BC%A0%E8%AF%B4/heaven-and-earth-in-a-bowl/</url>
      
        <content type="html"><![CDATA[<div class="hbe hbe-container" id="hexo-blog-encrypt" data-wpm="Oh, this is an invalid password. Check and try again, please." data-whm="OOPS, these decrypted content may changed, but you can still have a look.">  <script id="hbeData" type="hbeData" data-hmacdigest="50247e4994abb206ac53ca980f2a83860da6d025bb5cc62360618cbd700bc853">b2cba2151d0d2bd8ad8f075cfbfd57d53ef3116fcef7c29286a65c79b6924440fb63cbf8f6a9fd5d84a403851554e817b749da718d3340a0f34547fcc317d0cfb32096e6349477115f3fdbb24ab957fb3ce7bc885195f8511096b5822c937b239f52f4a0fd831e52f54a61c29ea90930fc07d8e53c6cbf40129f36ea1231668ac0e3fcd606276a21a8f58eaf065947a5</script>  <div class="hbe hbe-content">    <div class="hbe hbe-input hbe-input-xray">      <input class="hbe hbe-input-field hbe-input-field-xray" type="password" id="hbePass">      <label class="hbe hbe-input-label hbe-input-label-xray" for="hbePass">        <span class="hbe hbe-input-label-content hbe-input-label-content-xray">Eternalにはいくつかの秘密があります。</span>      </label>      <svg class="hbe hbe-graphic hbe-graphic-xray" width="300%" height="100%" viewBox="0 0 1200 60" preserveAspectRatio="none">        <path d="M0,56.5c0,0,298.666,0,399.333,0C448.336,56.5,513.994,46,597,46c77.327,0,135,10.5,200.999,10.5c95.996,0,402.001,0,402.001,0"></path>        <path d="M0,2.5c0,0,298.666,0,399.333,0C448.336,2.5,513.994,13,597,13c77.327,0,135-10.5,200.999-10.5c95.996,0,402.001,0,402.001,0"></path>      </svg>    </div>  </div></div><script data-pjax src="/Eternity/lib/hbe.js"></script><link href="/Eternity/css/hbe.style.css" rel="stylesheet" type="text/css">]]></content>
      
      
      <categories>
          
          <category> 短篇小说 </category>
          
          <category> 旭日东升的传说 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 治愈 </tag>
            
            <tag> 亲情 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>被绑架的梦</title>
      <link href="/Eternity/%E7%9F%AD%E7%AF%87%E5%B0%8F%E8%AF%B4/%E6%A2%A6%C2%B7%E5%87%8C/trapped-dream/"/>
      <url>/Eternity/%E7%9F%AD%E7%AF%87%E5%B0%8F%E8%AF%B4/%E6%A2%A6%C2%B7%E5%87%8C/trapped-dream/</url>
      
        <content type="html"><![CDATA[<div class="hbe hbe-container" id="hexo-blog-encrypt" data-wpm="Oh, this is an invalid password. Check and try again, please." data-whm="OOPS, these decrypted content may changed, but you can still have a look.">  <script id="hbeData" type="hbeData" data-hmacdigest="eab0755a2fc819c4a4a37803d6974c7f1429bb2dae60eb83b13a44b333947a23">b2cba2151d0d2bd8ad8f075cfbfd57d53ef3116fcef7c29286a65c79b6924440fb63cbf8f6a9fd5d84a403851554e817741d11c2bb2ae7a3a563947c73483bdd</script>  <div class="hbe hbe-content">    <div class="hbe hbe-input hbe-input-xray">      <input class="hbe hbe-input-field hbe-input-field-xray" type="password" id="hbePass">      <label class="hbe hbe-input-label hbe-input-label-xray" for="hbePass">        <span class="hbe hbe-input-label-content hbe-input-label-content-xray">Eternalにはいくつかの秘密があります。</span>      </label>      <svg class="hbe hbe-graphic hbe-graphic-xray" width="300%" height="100%" viewBox="0 0 1200 60" preserveAspectRatio="none">        <path d="M0,56.5c0,0,298.666,0,399.333,0C448.336,56.5,513.994,46,597,46c77.327,0,135,10.5,200.999,10.5c95.996,0,402.001,0,402.001,0"></path>        <path d="M0,2.5c0,0,298.666,0,399.333,0C448.336,2.5,513.994,13,597,13c77.327,0,135-10.5,200.999-10.5c95.996,0,402.001,0,402.001,0"></path>      </svg>    </div>  </div></div><script data-pjax src="/Eternity/lib/hbe.js"></script><link href="/Eternity/css/hbe.style.css" rel="stylesheet" type="text/css">]]></content>
      
      
      <categories>
          
          <category> 短篇小说 </category>
          
          <category> 梦·凌 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 校园 </tag>
            
            <tag> 青春 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>在你窗外闪耀的星星</title>
      <link href="/Eternity/%E9%A2%98%E8%A7%A3/stars-in-your-window/"/>
      <url>/Eternity/%E9%A2%98%E8%A7%A3/stars-in-your-window/</url>
      
        <content type="html"><![CDATA[<p>更想关注的，是无法得到的故事。</p><span id="more"></span><h2 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h2><h3 id="在你窗外闪耀的星星"><a href="#在你窗外闪耀的星星" class="headerlink" title="在你窗外闪耀的星星"></a>在你窗外闪耀的星星</h3><p>飞逝的的时光不会模糊我对你的记忆。难以相信从我第一次见到你以来已经过去了 3 年。我仍然还生动地记得，3 年前，在美丽的集美中学，从我看到你微笑着走出教室，你将头向后仰，柔和的晚霞照耀着你玫瑰色的脸颊。我明白，我已经沉醉于你了。之后，经过几个月的观察和窥探，你的优雅与智慧，你对待生活的态度和你对未来的愿望深切地在我心中留下了印象。你是迷人的阳光女孩，我总是梦想着与你分享余生。唉，实际上你远远超过了我最疯狂的梦想。我不知道如何桥起我与你之间的鸿沟。所以我没有任何计划，仅仅只是等待，等待一个适当的机会到来。直到现在，毕业的到来，我意识到我是个傻瓜，我应该创造机会并且抓住它而不只是等待。</p><p>这些日子里，我和我的朋友、室友、同学一个接一个地分开。我仍无法相信，在挥手之后，这些熟悉的面孔很快就会从我们的生活中消失，仅仅留下回忆。我明天就将离开学校。你已经计划远走高飞，追求你的未来，实现你的梦想。如果没有命运，也许我们不会再次相遇。所以今晚，我正在你的宿舍楼下徘徊，希望能偶然遇见你。但矛盾的是，你的美貌一定会使我心跳加速，我笨拙的舌头也许无法吐出一个字。我不记得我曾多少次经过你的宿舍楼，每次都希望看到你出现在阳台上或是窗台上。我不记得这个想法曾多少次在我的脑海中涌出：打电话叫她一起吃晚饭或是聊聊天。但每次，考虑到你的优秀和我的平凡，胆怯的优势超越勇气驱使我静静地离开。</p><p>毕业，意味着中学生活的终结。这些光荣与浪漫的时代结束。你可爱的微笑是我原来努力学习的动力，这单相思的爱情会被密封，作为一个我心灵深处的记忆。毕业，也意味着新生活的开始，一个到达光明未来的足迹。我真希望你在国外天天开心，一切顺利。同时，我将努力从幼稚中走出来，变得更加成熟。我的理想将是在现实中追求我的爱与幸福，我永远不会放弃。</p><p>再见了，我的公主！</p><p>如果有一天，在某个天涯海角，我们有机会相聚，即使是白发苍苍的男人和女人，在那个时候，我希望我们可以成为好朋友来自豪地分享这个记忆，重温年轻快乐的激情。如果这个机会永远没有到来，我希望我是天空中的星星，在你的窗外闪烁。远远地保佑着你，就像一个朋友，每天晚上陪伴在你左右，一同分享甜美的梦亦或是一同经历可怕的梦。</p><h3 id="Start-in-your-Window"><a href="#Start-in-your-Window" class="headerlink" title="Start in your Window"></a>Start in your Window</h3><p>Fleeting time does not blur my memory of you. Can it really be 4 years since I first saw you? I still remember, vividly, on the beautiful Zhuhai Campus, 4 years ago, from the moment I saw you smile, as you were walking out of the classroom and turned your head back, with the soft sunset glow shining on your rosy cheek, I knew, I knew that I was already drunk on you. Then, after several months’ observation and prying, your grace and your wisdom, your attitude to life and your aspiration for future were all strongly impressed on my memory. You were the glamorous and sunny girl whom I always dream of to share the rest of my life with. Alas, actually you were far beyond my wildest dreams and I had no idea about how to bridge that gulf between you and me. So I schemed nothing but to wait, to wait for an appropriate opportunity. Till now — the arrival of graduation, I realize I am such an idiot that one should create the opportunity and seize it instead of just waiting.</p><p>These days, having parted with friends, roommates and classmates one after another, I still cannot believe the fact that after waving hands, these familiar faces will soon vanish from our life and become no more than a memory. I will move out from school tomorrow. And you are planning to fly far far away, to pursue your future and fulfill your dreams. Perhaps we will not meet each other any more if without fate and luck. So tonight, I was wandering around your dormitory building hoping to meet you there by chance. But contradictorily, your appearance must quicken my heartbeat and my clumsy tongue might be not able to belch out a word. I cannot remember how many times I have passed your dormitory building both in Zhuhai and Guangzhou, and each time aspired to see you appear in the balcony or your silhouette that cast on the window. I cannot remember how many times this idea comes to my mind: call her out to have dinner or at least a conversation. But each time, thinking of your excellence and my commonness, the predominance of timidity over courage drove me leave silently.</p><p>Graduation, means the end of life in university, the end of these glorious, romantic years. Your lovely smile which is my original incentive to work hard and this unrequited love will be both sealed as a memory in the deep of my heart and my mind. Graduation, also means a start of new life, a footprint on the way to bright prospect. I truly hope you will be happy everyday abroad and everything goes well. Meanwhile, I will try to get out from puerility and become more sophisticated. To pursue my own love and happiness here in reality will be my ideal I never desert.</p><p>Farewell, my princess!</p><p>If someday, somewhere, we have a chance to gather, even as gray-haired man and woman, at that time, I hope we can be good friends to share this memory proudly to relight the youthful and joyful emotions. If this chance never comes, I wish I were the stars in the sky and twinkling in your window, to bless you far away, as friends, to accompany you every night, sharing the sweet dreams or going through the nightmares together.</p><h2 id="题解"><a href="#题解" class="headerlink" title="题解"></a>题解</h2>]]></content>
      
      
      <categories>
          
          <category> 题解 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 贪心 </tag>
            
            <tag> 数据结构 </tag>
            
            <tag> 线段树 </tag>
            
            <tag> 树状数组 </tag>
            
            <tag> 文学 </tag>
            
            <tag> 恋爱 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>夏记</title>
      <link href="/Eternity/%E7%9F%AD%E7%AF%87%E5%B0%8F%E8%AF%B4/%E6%97%AD%E6%97%A5%E4%B8%9C%E5%8D%87%E7%9A%84%E4%BC%A0%E8%AF%B4/summer-write/"/>
      <url>/Eternity/%E7%9F%AD%E7%AF%87%E5%B0%8F%E8%AF%B4/%E6%97%AD%E6%97%A5%E4%B8%9C%E5%8D%87%E7%9A%84%E4%BC%A0%E8%AF%B4/summer-write/</url>
      
        <content type="html"><![CDATA[<div class="hbe hbe-container" id="hexo-blog-encrypt" data-wpm="Oh, this is an invalid password. Check and try again, please." data-whm="OOPS, these decrypted content may changed, but you can still have a look.">  <script id="hbeData" type="hbeData" data-hmacdigest="93dc84f800bd48ac9d9cdbdcf578d13bcd7cc229c3611d14c6c79b5d875f0954">3883f73b0e13e7f84a32f06cda2fb1c8ed8bac78aea681ba0f3b27c409874987b08853185ad0f9e3b0d76a5c68a30cb75091ac5e6c1e54ff42dba2313fe8cc2c368252ae6aefe4176dfcc3b0a72d6c524269b9f26813c2479e59dd007da589fcb18e5f1fec927bbfdfaf3aee183f509a6631a33e8777d0ba8f628f91ad57c652757d079ae8960ff0531c347794b0d016536caa6ae09b9517e653b12336a5e1dc24432b80b21652ae858bcaee1b930383004b06dfedb27b175bc70af42e30be37797b69ebd303a14f24edab98a81514feb33b7b5fb0de889f7552989aa60c88ec1d18a084885670fce19362b48426d8b5597cb9a37842be3403a723b575841253d2ef1124985b66f2749c65bf8bbcad2b32e08f62526a9a32ad66c79f5f3ff1149f0a69a88105a63facec78d9d4ab2f5da657b148ea3a1bcc1839e2524ed3992e70a6c9c2e22d9d7a061410e9c7b507330c0c3ae138722606148cfc5260efba80dea7964aeab6246b99428d10878ab6536dd982331f41656539a8f7ff7e5f6b881b65022affe71c0b429c417590b81f4883956ec19f477ba0efac19e46940d4e4a322355b4a9e6ac4a998fbc27ae720dbf2e257e31d276bd53222156ee8d69f39303ac91f4fcd0f877d7a4d2cb21b572fe4359240e3165d7fb7d3592b8b4606ba8ffcf7cce048c858f6355fa297b620da54237bac6eddadfb6d8500e304bde9ff6d15f40b9f5e178c2676d354a9b63be4f763d8cccb8b664d2b157ac1cb6a63691df4bf200cf42f4857112838fc470b82064590bd472fe1362272051ed7c53e793cf79a62274f3bd93d4c288f64afa26b908f4ae6c043e9e7e0067501a3b405357173fc1addba2032780101a5861c3f8cc709c10afc335f0de80a9002b068744d718479103781be519e989d5ff3509e90defe276333f374e42e7b8f15427ed1ffa9980452465cffc2191e64c8ee19aabc5714598ed7a8d181a7867e71b2bf40ca95cc876e9aa24cc2a3b3cbc67a869befca842dc6d442b8470192b5a62da4fc302f4890cb7bef89acfd04868ec7120d31f2f425536dd4e939bc30e3297ece25f817108cc7853f324db5335051f1123e0896181371c20635da85464d5f3adfb818b85f214c9ddee2f61942cda710940f3453c1f1cf19304ba7790ae4fe359857143d49fa5dec326d92e1022ec51e5ad3e0d67d56979146b539fb4746bfc2b3ca26efe6692418e4cdb2dba10d639cabef800221b72dab66415ff0028f60d20eb023c6f5db7d618d2351d81841bf7857a307b9b8aad910dc0f89aa1d848a500bf3272a3544dc8a39ca2e356df981b54525230fb2934b08a08ec726f53ba279fa39fec7730e1c5a013e9191e79a125375d87e7e4c0a96ee0a502fa0cdd224592a19179edb97d4489c2ce8c4f605b5adc9470db2335d2bfe7db2ebc95b83aaf6476c2e368a35f5e4371e614166bf0b3ae0086f058e2c30d7f3a52415e97f62e99c1bb68a014255839633fd21f42aae1c341d08963b233dcd88f1c6b47a53bdf69f624b16aa44a1c9556eebb0c3a9ab5d0b951e85915753e58f29efb22b53242ea3930d16e168163d9bd07ac735815ff615ff52c2006bfc35a580002cf99d5962421a418ac6dce5eb6947c741020589d4362d07711d4efa9a3608ca5b1d3af87d5270944d50d5361adc040f3a2c72474469589aacbb374fd9ee5f0e1a9a54cb4dc96bae120524b1d7567b6be4786e80bd7a8ad485b30c7e91b6806ef67a34f4a55ea932d42c6c529fd3a4669f9cc7bf691c76921be2ac01b821b19080b10a8b6249d2a46bc7e811a5199ed9533d52af5b0eec72fcb3ebe35c7be5efbf2fe068800f1ce7a442dfb839c2aa2443f24f6e81cb64186698b338b7e9229f1201dc9ebddcd773d25fe33fca34de830390263a322fbb1494c339fc7f4e7bf7cfa1c1e5938a5ad4cae8c05815f0b9839dfffda532f38014cbb19ac61a84c8df83942d445b570205219b67c98cc6570373d04fb82e28ba30701a9a64e1ef034ba1a5ee4abedd72ecfb9dd311a7f8f0249b2680458e30dfad025aef30e15dae071b5a4bf93a9475a6ca209c4a4881660d7036cb6370463e2be79fa5e1698c1ca161a5a45d6d9dc263717aca73749f63102af0bb4c46886f724aa8a5223892541a758747c6a88df6bb2e87140a5624869cc4e629cd093f9e8078ebf46dba301e020f12b32f68c1aa424acf6233cf4b86d31097dcd4330b501f70387f2d8c50e1c082cfc0104456689a5e91b440874387832a218e60aec0e6dc92c93927cefbe7697e58c040e29858fdeb0dfe28d8342311a98dd5a6293e2d885216ab39827863e52029ad293ec9b9702675d7007b711ea4790b822e060d9c2646ad6514efa8b0d239762b834812b6a98d4d8674162f517beff02b972a7328c7979058eeba1f5e3d219d6898a9985220e687b86adcf883092b7cb08235ace29d417004e132758b52842023d99a450ee7815f6f028dcae9817c8fa9ca49125cee83d7fc2a4a3ade75eae9c7ed20bf298516ea187f21d8e3b6ffc8731a09ff9d9597506bdb3660689a5b5c705203b433f1a2333491bcf307df2f5c005e5a23209a5c1ab12ddea1d8229aab7be4b290ab64c84f5dd10c1d08eff9c13e51d44ebc6aabedab236160af594b7a9909d1d7320ed770573529d931c78aa492dbacc5374344febb2820b9aeb7631787fff0648bdd0fd04e21f00a7057c3aa416726d9585d0b89c1c9ad6f84c1138b1ac52d8f1660cab1f33ec029a9436fe4364828e19dfdc65ba8efe87ae70ca7f4c6479a971c2bb9963a03978b474dfe7500e8b7fda58843c90eb18d84603089b8f5fc75fa3fe3ac56981d82ec1dc2a20d5413b3cc9121324bffb850b9104b8500dd01de4f67188b1ac7e91fadac97fec43e0c6be723cadedb2d6096805b19e8e423476fc4893bd0500132320026d6a3b79d562374e04b82c31fa806db5c0d3e68b4393260d564b0528603671860b104454c49bd03668b0f5e56b229847b2d0d6edbc7ea9b12ad9e8353cc42436f99152ae600220dd98741f211d136e16633b5196ea333a30000b3cd6f87481b93f27aec9a8bc384fd4d081609736f30da544b944a380ec8eeb575fae08c7e725a5c6ea4b4510085c67ccff1cb895f0cbfb0c9d9299a8133f6fa16853e8947b2afa82261ed9df3499a2867507d55b62c6f2e352c032c5efca9d7d8d23888af9e5b6dada092fa0cd33003f50f398e6ae7892a1d89c6da3f2c128996346e2560264ca17f67e69f75dca2a9a2c6ed59bd8225662be9bba0a473a409ec93f21a30d380956d92923fdb1627e579d98f42c64dba9ac7ad79c7a0a6211b9e4e1812907dfedad6ff867758a7a970700a26f177d08400960d5050c7ff42522b694919c81ab54ad199865dfe17ab57bd6486fb22af8c3b629f8aa37219151274c443663b2178255b3f0c5c2a2a2b99a843904418e4810ee2ed983d8665bf975f8c61ad59e1fe3d8b1ab291cca2ea829e30edd1bc6b5c62877e8ef40c6625e1f405c05499d12dd849612d9668dfdd337d1b6caca5b6cad110e2f89b996e8ef77ebabc878e9ba41fb77ac52a92538b621e1a80c4cacdd3ecac31d7b0be91dc390064493abdaa774b990b5ac32a40a92a0c003e1490eadf9ec33405a60901efdaf2ca09bb1baed29ac036ff7192507474a02de80d91e4ad338197b23bc4d135dc858e1af2e9be18c597cd45386cb4d28ef8ecb06dcabb41ca49176e4756a82238a87c814d8e79276aa489e26e7f4fe0af1ee900b3905ed316a05a090ab36240095f38b41a01da019a8cb985aa792afbbe61a83e7b6efd101de0ac6bccc32b20c242804f946638f2903973f1be34d92f1e9a18320e6b56aaab8d48352a4036bd852dc3836d8e29a6961fa4a6e4e97e79cfaf3e1da66efcd9040239d19796a335f6ffd2db4ede03da47332973fb6496a030678cbbd5cd1e87ccd999d38c8884f0f80c174016565b58578325792aaabcbe855961544f7a250fcf4b2ccf264b13b964cce6d4d3852d08c1a325eb7cc5daae717a2e68143bb7fe791139b9d7f45beeae593d70e3e1a329b854f7f7ae0bd92ededf072714b51138c69ab5e0bd7b28feb85d5271ccc8c590ef51231b54d707637222fb7acbeabd7b4d3a70b689e19e133a8feff07f3c1572bd8d0765e249461b0e45c0b2a815692f407479a69ded9d7c6996465ec08761aaffb6e5a91e736af84f2a82e2a7d10458ea244d2eb84dca0b4a0e1e387ba434bdd5c75900fc3da7e2ed2062ed5b98f10b889d997006a156ca1a5543bc27d50b40f78a67876e205698ce8bf48b37ecc25bee45563ee7e6c47537a67968a6933845eeba09c85630a9931da2b2cafd11077ee98175251f4d3866badc20ae8d9455531cf4ac140251e2231fd6194176aec82a3924f995e8ca6de16384a802c4bb9fee65b6aa3656a15ccee647ce076935088c41a53553e6a1bb98b53d6b87a6b4f864adc519c7bf3b8f3a05069711a86fc06bcd2f6b512c769648c63a42aba799f1a5f5468226cbd212031db7f22d06174c98f58ec86442cf931fcf4c75ab884d31ebfa7bf2fda066c9c376e2a61babd7e388b38adf476a2d36116ecd5583faa1c17d0808143141719b02d7c4852992765ab81b56cedfd201e91822cb0d566f331355ce61de6266894e5c4810d299808f97d1000a30cc90dab5cc233b156d2d20be515b18e62e086810f47e3644bf2bf1023fa72ada5520c5bd7bf85ada225ba74adeb08fb33cc1a7e468c9fae01dad7280d341ef212a20bb00fa58a6420d4edeb92a1da1c023f965578854be56e92963ecce799abc15ca398a20d512f1fd70cdbbc9d4fd3916401506a9564ec969255d4391d2d0dcf26254b3fef6a40ac5d87ecd42b0fc14ea10caf4fad7c32a11e2df7d904b2b735017127eb73ce6194e4cbe7191529b14049c0a594f836d85b78ba5c670d57f20b68cf22f505053b43a63322e984c85ccb0aded4abd4c0c827ecfd3af74aa4cb514e1836c70d475b6eed07ac77f3db57f7b91415a5f9314af51df78243a8fbbd88e9a56507c74eb54742ce946f008a01f860b8926b1a29544fb439dc32e65e6e0860ba2bc0059ec296fbcab6e611971cfcf063c82b85dcea15a81539cc1ef805228e166465e26a9b7d09de36924eed956d02da173129904f06b22a03f31e80055f54a88efe30c9e359539467dd1ebdbd0c7846fc827f9ae651245237c3b7460279db9bb0bf6511307304f75b0b1626c6be5f968f38437918cf95e71d9d65cddda36d82e27b2a1b4042b35df577edf3e62d542ea386da6ef76067419318a7268ea49039e806e7ef4745464a263c9cb27d1057ab8ae1b75b5a2bc28fd84b566f17721322801525d8267e6ba8c79151aae9539c02d5a638ee45670b360929917bebfb0bcdb2e45f054f5519ea79d2ecdc333292682ba6dd87c44a91d19a6fb8c57bb1f1115a835fe26fa8f9690b4b9845a33606c49070dcfdd2e0aad47f1d5ef8b5b9edd6430532a8c39fb9f503ac92fa42b8b09f7c772b3eb13a481b6e28bff4a5e95f9f47be06ddf5e27f7a64800ba5731bcbb866b98edc1b7a399a177697282bfe1ce32783b272f04463b3adb7358560d362118bbfec3e52e641cdb01e49ba41b1dc19808c7391e5a6fd96d1cf25d62e1b7378fbe5ddefe8eb952c839f8070e4674f3f25d4ab752325013d8d2e23ffe7648930a020237fbd3230790e63de94a3af6f26662e5faefcfbb7fe12fba330ecd47bc72a0a00c2c3c6651d64a3db9b3360eb7d8bf814c256edb8ffbec79473a69269e068f74844bdae5c6afc17573fd3038595bcc4f607775cc6436bfe2099e07c4cdde037c2763f24056fc25418d2cc0e188f6e9a3d807dcd53f2275ad88e839102c8f03ab744e6cdc8a606f3444c940d6bc7f7091c2ec6feffc8e62202fe4833b5afacb069f8eb2918509f5e570b1ec3ef182120a18c51244b2e7638f91be4c498783a969dfd26a35a59bd45c1d525aba6a0ebfc8b5609a49cb2d967579a33013193f9b59503ef65fdc1cce0d14a68a629c84e3d29069f7e98d775d9fd339271b5358e3873395495cea4b9fbaea386e55693aa71824bcf94f00bdb6bebb1ad2b69c54145fe4a22a074426e85d909e477085aa6d204e875eb5df24e8e7eaf74e4dd173c6c2314c81e2ac25058b2fd16ac28716597706d0fe0abd4584c5a4b4a6f8361ac939e8f44baaca35cebad7e20d28cbcd3949d94b9440aa67e7e55e95dc377aee0611473e3b1533bf565ac6f293a8be96bd13d63e068801850785ff3abef92850ea66caa968bf8dec30a75e750e6f316d266a55aba5cc5af028f2d1185565f21a4b65d44a7fa874c9bb7003b63751185c8757ae9a0263df7db2d95f4e7a1ae7916621ef76286428cae25dfc98755fa2da0d2eaf599329d9ecfa2ad6a6644420665112096e6ad542644925600b33a5e37b7f83aa7e6f46ec65f99ca9a821d797496e8f596abf882e476e7370aef8c00b57b5831b76b52080ca624d2aa8e8e2ad8fac3afdf103389787fe6a3ac80d4296d6ab9aad7a295a2703eeee4c853223a5bba229d37d9705803c2fa090640a8dff6780169916393c51b5a60d030c7a85f6140c40917bb26492ffd2ef0e7759138a9a04fb2d86c8fd2b98042c052773ada0e7c7203b1ffb7ca4a165cb24b78cfcdddce69479bc82c4e9219e085c324e47a9d1602756f207171f0186de10c29420343e6e3768413a768e64ac5390618311e8bc46946d2643406ee013d90e55ffac81d126a9c0dc29f1c18849909201eb8f6ceb8bd45eea93c1bc0f488b17786d1ff9f1df028e1da09c65d4437ba2b27bfa5a6685b5ecd466667270696fb334d3e45b9b34f74ea9bda682e56dd7fe0ae10988727a69f59022e28a186bb9d6780b5b5f2e1605480cd6f1cf29aba20643b2cf5a33be615dd4b32142dd46cfe70998db1f946fe4ec3df13f6ac8eb89d2c269811190e9178b13ae19e9e2fd5e644fef988a320fec13443dad26e27b5d8a7f66f2a239cb92f0361c334c804c2b0f1040efa066550887c1ea0eec4261188da76c2688907bc289413d5777a1034c7ac076710ba4beaf1130fee00144d776c5217193b02bece56c9a6283282b1b6005e2cf165c367c723c4c4e950b8af17391e2b566e78b9adf30be1e91a1f9dfb5e499ab66cffd253e41526510b6184bbce7c8be48172e74f44f2cbd55e265230a61514929a1851c707a458fdf9c6a7e9dba6a77fc05c01fc86742d8810029dde4c806b62b3212eaaefd5f1a327b9e258cecd008b3257abe3507e90d6ad316ee4649e09dbcc67cd57cfdd06c65e77281c6f765e02dedd2df9d6ee4d8776653e37b30687de98330938ce2c4c3d144231c5eb27723d68121b35ae4461d97328c98349aac91335db34a6b0c56850fa6a6bbc067e205074c34949733ab45053c9923ada3d94c4dc8e5db449154136db5fd6fc6dcde0bc241fde309a8a445b8e2af2a2b11fbd2047e311c09ab85aededea473165ffadaf70008168c4b5224cbcb4318965e28bec4e63cf66fd7284f28d0f5ecad4ff4a3470d3b38fb589d045b8d5ddf9d0dc0b65fb530129e885d33a95c15f38fc68a061ad7e75961e120ee6aba0932e02fd098eb0b7f19293a224dd1c9ea445b3bbb9f53c898ee08e28ec6dbbf4ea72f155be9dd1d5359cd1ff5679a73c58f0d95771090dd91ab619e25cc216b17374514a8005389c8794b02f2be9e229c80416ce57871109bcdf638d673a540b00582aaf705ab4a938128f4e96bf941d55cbc57c7c5408900b5733d9793c42816aaa0d781fefb4440a689c23fc007e5ccc8f64e0f2e92a8e7c0eb1de5edcb78bf355eb21f3c682cde7112363771993e318835aa7bbbaf333a0ac13c6f6378f29e7b8fe71adac51d3505ed341cbbbf07e76eb54e5f18d10d8648639e5aae7267fef55fbc0e5c5d6965237ec8500f19afdd217df99cd3669c6c52efcc271885aff06ca5f5016f000c6aa3fecd85a7ef399261666b415786e759f1b9eb9002b0308817a78b856195b554d5ef69b0f3ff34a0d1c598800d22569b42753f3499c12f73982783662f5866daeebef7965389fca70c2c34fc8db0b4af6656799a3f3814923c87b0c3b4f09cc7316ba9738ff14d6bec6fe820ce6b515f67302505001bc5fdd7c80594858426d68dc3276c83349e1310785005ee91c4284dd67ace80316cf2880d8cc10ecd594b7b0f00f339a1a7955b82c3d79dd701609c2d8d57af3728bc151f5cd42788227ae065dadcb66d4ae99ff0a2900fe1c4fdf464cd2b63b95b1bfb2e2ea78e053f5acbd446ef4d25051f7b90dbf0a1ee86acf50d4949ff940317d0709682e8b1f654a9c2ff8e568fc4bf30012b63101e0ec72237499d50c8617148b93a595e582f2b96f26eaf40ed1258c482db432f8bd8e7a1a8c77dffbd19d46776a4e9848ee41c268823a823c64656f74e27e2ec1ff0e9827d9fc2820212eca50764fd72eaa5c1a3a81495c44f33b1fa99c05b82e8cb1c4d1274ffdd9d163a6bc641e4cbd07f1a086d10052470cabfa73560496293a3b74b2550f19d2152a62578f49b0d18de5014de9d782757674dac3c5d31fb8826a20698c3d31413dcdfe141f4fbb4e3b4cc42109c3c9956750ee131c9a60b29982dc674bfe825bd438785ae4b5a45d1ebbe8f51c1eb3f8c47d4b15c832a323c2f4e1451e02e1c76cc367c606765a5777ea8e7dfc7696e659bc2b69adb037098082fc50f59f81c13ddb3da0d2e234a0b2746f2a00b253864cd3eb05f03f93aaa2e0eecbfd68a0a390eda9a02584fd35debb0ae2d97631dfdac41b960f1069c145c65162ff3a5a7d626d8b27439eed7d3ef4e995e81e7edc4ba96adbe0cf9ffcd747c3c2e7de5c0df74b04748124068eb4ebd38de5dace7944f1e5760923022a731ee0e4adcd0a37a1d20b5d7e279340466132686a723c17d0e8ece49319f132b4845f0b16c94d88b19ea42bcd15dd0f3d293a21b25ef810e224f87b8f380c4f499debaf48cac684c5526023504f70fc9a8227ea7c4f81fc6cc76f68554f1561445a0419b3ba0aef3e4138a02833a5ddf2a9a7386bbc7abd290d4ded86360121ab64e137413942a0bf2552b8f0596ba1a1570ecea5e332fe45aa967324dc5d732625b7bf79ecec5fd1e7b5ca7dd4bfb453c434096c4bcfedfe120e9cece45d8883c472f568e85c8db2e615c1869f8b7ed2fbf3d4d090e5dffac4aae23f1142d5715ae46c343ac0ced110b848effcdff7b26a2dff03d2958f56206fc12619f2b90cbc9f3932c1e267dbe6a1854fd496a1a3e7487651ebf4e5068282fd41f3fc35fd067c16a892f9348ccd2e8f87ea0b125e42ef0b9778f332b804ceb88cf731a141d406edeb1c7b1017bbbfea542d2a00bb1cad6f7a3166e89dc35803f465372d720b69e7e69cbe104f9c4f0f260763942730b9a52d6</script>  <div class="hbe hbe-content">    <div class="hbe hbe-input hbe-input-xray">      <input class="hbe hbe-input-field hbe-input-field-xray" type="password" id="hbePass">      <label class="hbe hbe-input-label hbe-input-label-xray" for="hbePass">        <span class="hbe hbe-input-label-content hbe-input-label-content-xray">Eternalにはいくつかの秘密があります。</span>      </label>      <svg class="hbe hbe-graphic hbe-graphic-xray" width="300%" height="100%" viewBox="0 0 1200 60" preserveAspectRatio="none">        <path d="M0,56.5c0,0,298.666,0,399.333,0C448.336,56.5,513.994,46,597,46c77.327,0,135,10.5,200.999,10.5c95.996,0,402.001,0,402.001,0"></path>        <path d="M0,2.5c0,0,298.666,0,399.333,0C448.336,2.5,513.994,13,597,13c77.327,0,135-10.5,200.999-10.5c95.996,0,402.001,0,402.001,0"></path>      </svg>    </div>  </div></div><script data-pjax src="/Eternity/lib/hbe.js"></script><link href="/Eternity/css/hbe.style.css" rel="stylesheet" type="text/css">]]></content>
      
      
      <categories>
          
          <category> 短篇小说 </category>
          
          <category> 旭日东升的传说 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 恋爱 </tag>
            
            <tag> 校园 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>dp及其它优化</title>
      <link href="/Eternity/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/OI/dp-else/"/>
      <url>/Eternity/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/OI/dp-else/</url>
      
        <content type="html"><![CDATA[<p>“纵使天地渺远，空间永远不够。”<br>“即便今昔深邃，时间不可窥探。”</p><span id="more"></span><h2 id="概率期望-dp"><a href="#概率期望-dp" class="headerlink" title="概率期望 dp"></a>概率期望 dp</h2><h3 id="期望-x-概率-x-动态规划"><a href="#期望-x-概率-x-动态规划" class="headerlink" title="期望 x 概率 x 动态规划"></a>期望 x 概率 x 动态规划</h3><p>概率的定义：</p><p>对于事件 $A$ ，在进行了多次试验时候，其发生的次数与总实验次数之比 $\frac{N_A}{n}$ 会逐渐稳定在某一数值 $p$ 的附近，则 $p$ 被称为 $A$ 在该条件下发生的概率，记为 $P(A)=p$ 。</p><p>期望的定义：</p><p>对于一个事件 $A$ ，如果 $A$ 的结果有 $k$ 种，每一种结果的权值为 $a_i$ ，概率为 $p_i$ ，则 $A$ 事件的期望记为 $E(A)$ ，则有 $E(A)=\sum\limits_{i=1}^{k} a_ip_i$ 。</p><h3 id="概率-dp"><a href="#概率-dp" class="headerlink" title="概率 dp"></a>概率 dp</h3><p>采用顺推法，从初始状态（一般来说是 $dp_{0,0..0}$ ）到所有的限制，同一般的 DP 类似的，难点依然是对状态转移方程的刻画，只是这类题目经过了概率论知识的包装。</p><p><a href="https://www.luogu.com.cn/problem/CF148D">例题 CF148D Bag of Mice</a></p><p><a href="https://oi-wiki.org/dp/probability/#dp">参考资料</a></p><details>    <summary>AC Code</summary><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;ctime&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iomanip&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stack&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;map&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> gh() getchar()</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> re register</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> ll;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN=<span class="number">1e3</span>+<span class="number">1</span>;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    x=<span class="number">0</span>;</span><br><span class="line">    <span class="type">char</span> ch=<span class="built_in">gh</span>(),t=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(ch&lt;<span class="string">&#x27;0&#x27;</span>||ch&gt;<span class="string">&#x27;9&#x27;</span>) t|=ch==<span class="string">&#x27;-&#x27;</span>,ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">while</span>(ch&gt;=<span class="string">&#x27;0&#x27;</span>&amp;&amp;ch&lt;=<span class="string">&#x27;9&#x27;</span>) x=(x&lt;&lt;<span class="number">3</span>)+(x&lt;&lt;<span class="number">1</span>)+(ch^<span class="number">48</span>),ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">if</span>(t) x=-x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T,<span class="keyword">class</span> ...T1&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x,T1 &amp;...x1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">read</span>(x),<span class="built_in">read</span>(x1...);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">checkMax</span><span class="params">(T &amp;x,T &amp;y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x&lt;y?x=y,<span class="number">1</span>:<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">checkMin</span><span class="params">(T &amp;x,T &amp;y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x&gt;y?x=y,<span class="number">1</span>:<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> W,B;</span><br><span class="line"><span class="type">double</span> dp[MAXN][MAXN];</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// freopen(&quot;dp-pro.in&quot;,&quot;r&quot;,stdin);</span></span><br><span class="line">    <span class="comment">// freopen(&quot;dp-pro.out&quot;,&quot;w&quot;,stdout);</span></span><br><span class="line">    <span class="built_in">read</span>(W,B);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=W;++i) dp[i][<span class="number">0</span>]=<span class="number">1.0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=B;++i) dp[<span class="number">0</span>][i]=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=W;++i)</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">1</span>;j&lt;=B;++j)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="type">double</span> ix=i,jx=j;</span><br><span class="line">            dp[i][j]+=(<span class="type">double</span>)(ix/(ix+jx));</span><br><span class="line">            <span class="keyword">if</span>(j&gt;=<span class="number">3</span>) dp[i][j]+=<span class="built_in">double</span>(jx/(ix+jx))*<span class="built_in">double</span>((jx<span class="number">-1</span>)/(ix+jx<span class="number">-1</span>))</span><br><span class="line">                        *<span class="built_in">double</span>((jx<span class="number">-2</span>)/(ix+jx<span class="number">-2</span>))*dp[i][j<span class="number">-3</span>];</span><br><span class="line">            <span class="keyword">if</span>(i&gt;=<span class="number">1</span>&amp;&amp;j&gt;=<span class="number">2</span>) dp[i][j]+=<span class="built_in">double</span>(jx/(ix+jx))*dp[i<span class="number">-1</span>][j<span class="number">-2</span>]</span><br><span class="line">                        *<span class="built_in">double</span>((jx<span class="number">-1</span>)/(ix+jx<span class="number">-1</span>))*<span class="built_in">double</span>(ix/(ix+jx<span class="number">-2</span>));</span><br><span class="line">        &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%.9lf&quot;</span>,dp[W][B]);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">5 5</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure></details><hr><h3 id="期望-dp"><a href="#期望-dp" class="headerlink" title="期望 dp"></a>期望 dp</h3><blockquote><p>正难则反，这是亘古不变的真理。</p></blockquote><p>设有事件 $A$ ，则有 $dp[x]$ 表示在 $x$ 次实现之后 $A$ 满足某种条件 $T$ 的期望。一般而言，如果有 $dp[M]=1$ ，则采用逆序推理，否则有 $dp[0]=0$ ，然后顺序推理。</p><p>接下来 $4$ 道题，都是对期望 dp 的讲解。</p><hr><h3 id="例题"><a href="#例题" class="headerlink" title="例题"></a>例题</h3><h4 id="FAVDICE"><a href="#FAVDICE" class="headerlink" title="FAVDICE"></a><a href="https://www.luogu.com.cn/problem/SP1026">FAVDICE</a></h4><p>用 $dp[x]$ 表示当前已经投掷了 $x$ 面，投到 $n$ 面的期望次数。</p><p>对于 $dp[n]$ ，因为我们已经投掷了 $n$ 面了，所以不需要再投就可以满足条件，所以有 $dp[n]=0$ 。</p><details>    <summary>AC Code</summary><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;ctime&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iomanip&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stack&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;map&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> gh() getchar()</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> re register</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> ll;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    x=<span class="number">0</span>;</span><br><span class="line">    <span class="type">char</span> ch=<span class="built_in">gh</span>(),t=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(ch&lt;<span class="string">&#x27;0&#x27;</span>||ch&gt;<span class="string">&#x27;9&#x27;</span>) t|=ch==<span class="string">&#x27;-&#x27;</span>,ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">while</span>(ch&gt;=<span class="string">&#x27;0&#x27;</span>&amp;&amp;ch&lt;=<span class="string">&#x27;9&#x27;</span>) x=(x&lt;&lt;<span class="number">3</span>)+(x&lt;&lt;<span class="number">1</span>)+(ch^<span class="number">48</span>),ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">if</span>(t) x=-x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T,<span class="keyword">class</span> ...T1&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x,T1 &amp;...x1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">read</span>(x),<span class="built_in">read</span>(x1...);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">checkMax</span><span class="params">(T &amp;x,T &amp;y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x&lt;y?x=y,<span class="number">1</span>:<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">checkMin</span><span class="params">(T &amp;x,T &amp;y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x&gt;y?x=y,<span class="number">1</span>:<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> T,N;</span><br><span class="line"><span class="type">double</span> dp[<span class="number">1001</span>];</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// freopen(&quot;dp-probability.in&quot;,&quot;r&quot;,stdin);</span></span><br><span class="line">    <span class="comment">// freopen(&quot;dp-probability.out&quot;,&quot;w&quot;,stdout);</span></span><br><span class="line">    <span class="built_in">read</span>(T);</span><br><span class="line">    <span class="keyword">while</span>(T--)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">read</span>(N);</span><br><span class="line">        dp[N]=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=N<span class="number">-1</span>;i&gt;=<span class="number">0</span>;--i)</span><br><span class="line">            dp[i]=dp[i+<span class="number">1</span>]+<span class="number">1.0</span>*N/(N-i);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%.2lf\n&quot;</span>,dp[<span class="number">0</span>]); </span><br><span class="line">    &#125;   </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">2</span></span><br><span class="line"><span class="comment">1</span></span><br><span class="line"><span class="comment">12</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure></details><hr><h4 id="换教室"><a href="#换教室" class="headerlink" title="换教室"></a><a href="https://www.luogu.com.cn/problem/P1850">换教室</a></h4><p>能够被称为是期望 dp 的模板题，<del>虽然我没有这么觉得</del>。</p><p>因为 $v\le 300$ ，则保证了我们求出全源最短路的复杂度，使用 Floyd 的 $\mathcal O(n^3)$ 求出并在 $\mathcal O(1)$ 内查询。</p><p>然后其实就会变成一个标准的概率期望的动态规划问题：</p><script type="math/tex; mode=display">dp[i][j][0]=min\begin{cases} dp[i-1][j][0] + Dist[Now_{i-1}][Now_{i}]\\dp[i-1][j][1]+Dist[Now_{i-1}][Now_{i}]\times (1-p[i-1])+Dist[Oth_{i-1}][Now_{i}]\times p[i-1]\end{cases}</script><script type="math/tex; mode=display">dp[i][j][1]=min\begin{cases}dp[i-1][j-1][0]+Dist[Now_{i-1}][Now_{i}]\times(1-p[i])+Dist[Now_{i-1}][Oth_{i}]\times p[i]\\\\dp[i-1][j-1][1]\\+Dist[Oth_{i-1}][Oth_{i}]\times p[i-1]\times p[i]\\+Dist[Oth_{i-1}][Now_{i}]\times p[i-1]\times(1-p[i])\\+Dist[Now_{i-1}][Oth_{i}]\times (1-p[i-1])\times p[i]\\+Dist[Now_{i-1}][Now_{i}]\times (1-p[i-1])\times(1-p[i]) \end{cases}</script><p>这应该是我写过最复杂的式子了。</p><details>    <summary>AC Code</summary><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;ctime&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iomanip&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stack&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;map&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> gh() getchar()</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> re register</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> ll;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN=<span class="number">2e3</span>+<span class="number">1</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXM=<span class="number">2e3</span>+<span class="number">1</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXV=<span class="number">3e2</span>+<span class="number">1</span>;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    x=<span class="number">0</span>;</span><br><span class="line">    <span class="type">char</span> ch=<span class="built_in">gh</span>(),t=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(ch&lt;<span class="string">&#x27;0&#x27;</span>||ch&gt;<span class="string">&#x27;9&#x27;</span>) t|=ch==<span class="string">&#x27;-&#x27;</span>,ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">while</span>(ch&gt;=<span class="string">&#x27;0&#x27;</span>&amp;&amp;ch&lt;=<span class="string">&#x27;9&#x27;</span>) x=(x&lt;&lt;<span class="number">3</span>)+(x&lt;&lt;<span class="number">1</span>)+(ch^<span class="number">48</span>),ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">if</span>(t) x=-x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T,<span class="keyword">class</span> ...T1&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x,T1 &amp;...x1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">read</span>(x),<span class="built_in">read</span>(x1...);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">checkMax</span><span class="params">(T &amp;x,T &amp;y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x&lt;y?x=y,<span class="number">1</span>:<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">checkMin</span><span class="params">(T &amp;x,T &amp;y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x&gt;y?x=y,<span class="number">1</span>:<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> N,M,V,E;</span><br><span class="line"><span class="type">int</span> Now[MAXN],Oth[MAXN];</span><br><span class="line"><span class="type">double</span> p[MAXN],dp[MAXN][MAXM][<span class="number">3</span>];</span><br><span class="line"><span class="type">int</span> Dist[MAXV][MAXV];</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">Floyd</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> k=<span class="number">1</span>;k&lt;=V;++k)</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=V;++i)</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">1</span>;j&lt;=V;++j)</span><br><span class="line">                Dist[i][j]=<span class="built_in">min</span>(Dist[i][j],Dist[i][k]+Dist[k][j]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// freopen(&quot;dp-prob.in&quot;,&quot;r&quot;,stdin);</span></span><br><span class="line">    <span class="comment">// freopen(&quot;dp-prob.out&quot;,&quot;w&quot;,stdout);</span></span><br><span class="line">    <span class="built_in">memset</span>(Dist,<span class="number">0x3f</span>,<span class="built_in">sizeof</span>(Dist));</span><br><span class="line">    <span class="built_in">read</span>(N,M,V,E);</span><br><span class="line">    <span class="keyword">for</span>(re <span class="type">int</span> i=<span class="number">1</span>;i&lt;=N;++i) <span class="built_in">read</span>(Now[i]);</span><br><span class="line">    <span class="keyword">for</span>(re <span class="type">int</span> i=<span class="number">1</span>;i&lt;=N;++i) <span class="built_in">read</span>(Oth[i]);</span><br><span class="line">    <span class="keyword">for</span>(re <span class="type">int</span> i=<span class="number">1</span>;i&lt;=N;++i) <span class="built_in">scanf</span>(<span class="string">&quot;%lf&quot;</span>,&amp;p[i]);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>,u,v,w;i&lt;=E;++i)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">read</span>(u,v,w);</span><br><span class="line">        Dist[u][v]=Dist[v][u]=<span class="built_in">min</span>(Dist[u][v],w);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">Floyd</span>();</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=V;++i) Dist[i][i]=Dist[i][<span class="number">0</span>]=Dist[<span class="number">0</span>][i]=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=N;++i)</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">0</span>;j&lt;=M;++j)</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> k=<span class="number">0</span>;k&lt;=<span class="number">1</span>;++k)</span><br><span class="line">                dp[i][j][k]=<span class="number">1e9</span>;</span><br><span class="line">    dp[<span class="number">1</span>][<span class="number">0</span>][<span class="number">0</span>]=dp[<span class="number">0</span>][<span class="number">0</span>][<span class="number">0</span>]=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=N;++i)</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">0</span>;j&lt;=M;++j)</span><br><span class="line">        &#123;</span><br><span class="line">            dp[i][j][<span class="number">0</span>]=<span class="built_in">min</span>(dp[i][j][<span class="number">0</span>],<span class="built_in">min</span>(dp[i<span class="number">-1</span>][j][<span class="number">0</span>]+Dist[Now[i<span class="number">-1</span>]][Now[i]],dp[i<span class="number">-1</span>][j][<span class="number">1</span>]+Dist[Now[i<span class="number">-1</span>]][Now[i]]*(<span class="number">1.0</span>-p[i<span class="number">-1</span>])+Dist[Oth[i<span class="number">-1</span>]][Now[i]]*p[i<span class="number">-1</span>]));</span><br><span class="line">            <span class="keyword">if</span>(j&gt;<span class="number">0</span>) dp[i][j][<span class="number">1</span>]=<span class="built_in">min</span>(dp[i][j][<span class="number">1</span>],<span class="built_in">min</span>(dp[i<span class="number">-1</span>][j<span class="number">-1</span>][<span class="number">0</span>]+Dist[Now[i<span class="number">-1</span>]][Now[i]]*(<span class="number">1.0</span>-p[i])+Dist[Now[i<span class="number">-1</span>]][Oth[i]]*p[i],dp[i<span class="number">-1</span>][j<span class="number">-1</span>][<span class="number">1</span>]+Dist[Oth[i<span class="number">-1</span>]][Oth[i]]*p[i]*p[i<span class="number">-1</span>]+Dist[Oth[i<span class="number">-1</span>]][Now[i]]*p[i<span class="number">-1</span>]*(<span class="number">1.0</span>-p[i])+Dist[Now[i<span class="number">-1</span>]][Oth[i]]*(<span class="number">1.0</span>-p[i<span class="number">-1</span>])*p[i]+Dist[Now[i<span class="number">-1</span>]][Now[i]]*(<span class="number">1.0</span>-p[i<span class="number">-1</span>])*(<span class="number">1.0</span>-p[i])));</span><br><span class="line">        &#125;</span><br><span class="line">    <span class="type">double</span> ans=<span class="number">1e9</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;=M;++i) ans=<span class="built_in">min</span>(ans,<span class="built_in">min</span>(dp[N][i][<span class="number">0</span>],dp[N][i][<span class="number">1</span>]));</span><br><span class="line">    <span class="comment">/*for(int i=1;i&lt;=N;++i)</span></span><br><span class="line"><span class="comment">    &#123;</span></span><br><span class="line"><span class="comment">        for(int j=0;j&lt;=M;++j) printf(&quot;%.2lf &quot;,dp[i][j]);</span></span><br><span class="line"><span class="comment">        puts(&quot;&quot;);</span></span><br><span class="line"><span class="comment">    &#125;*/</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%.2lf&quot;</span>,ans);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">3 2 3 3</span></span><br><span class="line"><span class="comment">2 1 2</span></span><br><span class="line"><span class="comment">1 2 1</span></span><br><span class="line"><span class="comment">0.8 0.2 0.5 </span></span><br><span class="line"><span class="comment">1 2 5</span></span><br><span class="line"><span class="comment">1 3 3</span></span><br><span class="line"><span class="comment">2 3 1</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure></details><hr><h4 id="Tribles"><a href="#Tribles" class="headerlink" title="Tribles"></a><a href="https://www.luogu.com.cn/problem/UVA11021">Tribles</a></h4><p>有一个很贴切的事例：如果一个人被车创死的概率为 $p$ ，则两个人同时被车创死的概率就应该是 $p^2$ ，这是理所当然的。</p><p>所以，我们可以忽视条件 $k$ ，把 $k$ 只生物当做 $1$ 只来对待，然后转化成常规的概率 dp 即可。</p><p>对应有 $n$ 种情况，用 $dp[i]$ 表示第 $i$ 天死亡的概率，则有：</p><p>$dp[i]=\sum dp[i-1]^j\times p[j]$ ，其中 $p[j]$ 是这只生物变成 $j$ 只的概率。</p><p>而答案就是 $dp[M]^k$ 即可。</p><details>    <summary>AC Code</summary><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;ctime&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iomanip&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stack&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;map&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> gh() getchar()</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> re register</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> ll;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN=<span class="number">1e3</span>+<span class="number">1</span>;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    x=<span class="number">0</span>;</span><br><span class="line">    <span class="type">char</span> ch=<span class="built_in">gh</span>(),t=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(ch&lt;<span class="string">&#x27;0&#x27;</span>||ch&gt;<span class="string">&#x27;9&#x27;</span>) t|=ch==<span class="string">&#x27;-&#x27;</span>,ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">while</span>(ch&gt;=<span class="string">&#x27;0&#x27;</span>&amp;&amp;ch&lt;=<span class="string">&#x27;9&#x27;</span>) x=(x&lt;&lt;<span class="number">3</span>)+(x&lt;&lt;<span class="number">1</span>)+(ch^<span class="number">48</span>),ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">if</span>(t) x=-x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T,<span class="keyword">class</span> ...T1&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x,T1 &amp;...x1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">read</span>(x),<span class="built_in">read</span>(x1...);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">checkMax</span><span class="params">(T &amp;x,T &amp;y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x&lt;y?x=y,<span class="number">1</span>:<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">checkMin</span><span class="params">(T &amp;x,T &amp;y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x&gt;y?x=y,<span class="number">1</span>:<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> Test,N,K,M;</span><br><span class="line"><span class="type">double</span> p[MAXN],dp[MAXN];</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// freopen(&quot;dp-pro.in&quot;,&quot;r&quot;,stdin);</span></span><br><span class="line">    <span class="comment">// freopen(&quot;dp-pro.out&quot;,&quot;w&quot;,stdout);</span></span><br><span class="line">    <span class="built_in">read</span>(Test);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> Case=<span class="number">1</span>;Case&lt;=Test;++Case)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">memset</span>(dp,<span class="number">0</span>,<span class="built_in">sizeof</span>(dp));</span><br><span class="line">        <span class="built_in">memset</span>(p,<span class="number">0</span>,<span class="built_in">sizeof</span>(p));</span><br><span class="line">        <span class="built_in">read</span>(N,K,M);</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;N;++i) <span class="built_in">scanf</span>(<span class="string">&quot;%lf&quot;</span>,&amp;p[i]);</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=M;++i)</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">0</span>;j&lt;N;++j)</span><br><span class="line">                dp[i]+=p[j]*<span class="built_in">pow</span>(dp[i<span class="number">-1</span>],j);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;Case #%d: %.7lf\n&quot;</span>,Case,<span class="built_in">pow</span>(dp[M],K));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">4</span></span><br><span class="line"><span class="comment">3 1 1</span></span><br><span class="line"><span class="comment">0.33</span></span><br><span class="line"><span class="comment">0.34</span></span><br><span class="line"><span class="comment">0.33</span></span><br><span class="line"><span class="comment">3 1 2</span></span><br><span class="line"><span class="comment">0.33</span></span><br><span class="line"><span class="comment">0.34</span></span><br><span class="line"><span class="comment">0.33</span></span><br><span class="line"><span class="comment">3 1 2</span></span><br><span class="line"><span class="comment">0.5</span></span><br><span class="line"><span class="comment">0.0</span></span><br><span class="line"><span class="comment">0.5</span></span><br><span class="line"><span class="comment">4 2 2</span></span><br><span class="line"><span class="comment">0.5</span></span><br><span class="line"><span class="comment">0.0</span></span><br><span class="line"><span class="comment">0.0</span></span><br><span class="line"><span class="comment">0.5</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure></details><hr><h4 id="奖励关"><a href="#奖励关" class="headerlink" title="奖励关"></a>奖励关</h4><hr><h2 id="矩阵加速-dp"><a href="#矩阵加速-dp" class="headerlink" title="矩阵加速 dp"></a>矩阵加速 dp</h2><p>字面意思，使用矩阵快速幂来优化动态规划已达到时间复杂度的限制。</p><h3 id="例题-1"><a href="#例题-1" class="headerlink" title="例题"></a>例题</h3><h4 id="分块"><a href="#分块" class="headerlink" title="分块"></a><a href="https://www.luogu.com.cn/problem/P5343">分块</a></h4><p>对于 $60\% $ 的做法：考虑首先求出 $a$ 与 $b$ 的所有重复元素，然后进行背包：</p><p>$f[i]=\sum f[i-j],j\ \text{合法}$</p><p>这样的复杂度大概是 $\mathcal O(100n)$ ，勉强能过。</p><p>但是对于 $n\le 10^{18}$ ，那真是异想天开。</p><p>考虑加速。无论如何，有 $0\le x\le 100$ ，则 $f[i]$ 最多是从 $f[i-100]\sim f[i-1]$ 转移而来的，那么考虑一个 $1\times Len$ 的矩阵（$len$ 表示最多能够转移的个数），然后考虑 $01$ 矩阵。使得：</p><script type="math/tex; mode=display">\left[\begin{array}{l}dp[i-1]\\dp[i-2]\\dp[i-3]\\\cdot\cdot\cdot\\dp[i-Len+1]\\dp[i-Len]\end{array}\right]\rightarrow\left[\begin{array}{l}dp[i]\\dp[i]\\dp[i]\\\cdot\cdot\cdot\\dp[i-Len_2]\\dp[i-Len+1]\end{array}\right]</script><p>计算出转移矩阵应该是：</p><p><img src="https://s2.ax1x.com/2019/05/05/Ewtapd.png" alt="img"></p><p>即可。</p><p>答案矩阵的第 $1$ 行第 $1$ 列就是最终答案，时间复杂度 $\mathcal O(Len^3\log n)$</p><details>    <summary>AC Code</summary><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;ctime&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iomanip&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stack&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;map&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> gh() getchar()</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> re register</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> ll;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXL=<span class="number">101</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> Mod=<span class="number">1e9</span>+<span class="number">7</span>;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    x=<span class="number">0</span>;</span><br><span class="line">    <span class="type">char</span> ch=<span class="built_in">gh</span>(),t=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(ch&lt;<span class="string">&#x27;0&#x27;</span>||ch&gt;<span class="string">&#x27;9&#x27;</span>) t|=ch==<span class="string">&#x27;-&#x27;</span>,ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">while</span>(ch&gt;=<span class="string">&#x27;0&#x27;</span>&amp;&amp;ch&lt;=<span class="string">&#x27;9&#x27;</span>) x=(x&lt;&lt;<span class="number">3</span>)+(x&lt;&lt;<span class="number">1</span>)+(ch^<span class="number">48</span>),ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">if</span>(t) x=-x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T,<span class="keyword">class</span> ...T1&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x,T1 &amp;...x1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">read</span>(x),<span class="built_in">read</span>(x1...);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">checkMax</span><span class="params">(T &amp;x,T &amp;y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x&lt;y?x=y,<span class="number">1</span>:<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">checkMin</span><span class="params">(T &amp;x,T &amp;y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x&gt;y?x=y,<span class="number">1</span>:<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line">ll Length;</span><br><span class="line"><span class="type">int</span> N,M;</span><br><span class="line"><span class="type">int</span> Len,Num[MAXL],dp[MAXL];</span><br><span class="line"><span class="type">bool</span> a[MAXL],b[MAXL];</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Matrix</span></span><br><span class="line">&#123;</span><br><span class="line">    ll rix[MAXL][MAXL];</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">clear</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="built_in">memset</span>(rix,<span class="number">0</span>,<span class="built_in">sizeof</span>(rix));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">const</span> Matrix <span class="keyword">operator</span>*(Matrix b)<span class="type">const</span></span><br><span class="line">    &#123;</span><br><span class="line">        Matrix c;</span><br><span class="line">        c.<span class="built_in">clear</span>();</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=Len;++i)</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">1</span>;j&lt;=Len;++j)</span><br><span class="line">                <span class="keyword">for</span>(<span class="type">int</span> l=<span class="number">1</span>;l&lt;=Len;++l) </span><br><span class="line">                    c.rix[i][j]=(c.rix[i][j]+rix[i][l]*b.rix[l][j])%Mod;</span><br><span class="line">        <span class="keyword">return</span> c;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;Zero,Ans;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> Matrix <span class="title">qPow</span><span class="params">(Matrix s,ll b)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Matrix res;</span><br><span class="line">    res.<span class="built_in">clear</span>();</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=Len;++i) res.rix[i][i]=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span>(b)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(b&amp;<span class="number">1</span>) res=res*s;</span><br><span class="line">        s=s*s;</span><br><span class="line">        b&gt;&gt;=<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// freopen(&quot;dp-matrix.in&quot;,&quot;r&quot;,stdin);</span></span><br><span class="line">    <span class="comment">// freopen(&quot;dp-matrix.out&quot;,&quot;w&quot;,stdout);</span></span><br><span class="line">    <span class="built_in">read</span>(Length);</span><br><span class="line">    <span class="built_in">read</span>(N);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>,x;i&lt;=N;++i) <span class="built_in">read</span>(x),a[x]=<span class="number">1</span>;</span><br><span class="line">    <span class="built_in">read</span>(M);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>,x;i&lt;=M;++i) <span class="built_in">read</span>(x),b[x]=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=<span class="number">100</span>;++i) <span class="keyword">if</span>(a[i]&amp;b[i]) Zero.rix[<span class="number">1</span>][i]=<span class="number">1</span>,Len=i;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;Len;++i) Zero.rix[i+<span class="number">1</span>][i]=<span class="number">1</span>;</span><br><span class="line">    dp[<span class="number">0</span>]=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=Len;++i)</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">1</span>;j&lt;=i;++j)</span><br><span class="line">            <span class="keyword">if</span>(a[j]&amp;&amp;b[j]) dp[i]=(dp[i]+dp[i-j])%Mod;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=Len;++i) Ans.rix[i][<span class="number">1</span>]=dp[Len-i];</span><br><span class="line">    Ans=<span class="built_in">qPow</span>(Zero,Length-Len+<span class="number">1</span>)*Ans;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%lld&quot;</span>,Ans.rix[<span class="number">1</span>][<span class="number">1</span>]);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">19260817</span></span><br><span class="line"><span class="comment">7</span></span><br><span class="line"><span class="comment">8 9 6 3 7 2 1</span></span><br><span class="line"><span class="comment">7</span></span><br><span class="line"><span class="comment">4 5 2 9 7 8 3</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure></details><hr><h2 id="倍增-dp"><a href="#倍增-dp" class="headerlink" title="倍增 dp"></a>倍增 dp</h2><h3 id="例题-2"><a href="#例题-2" class="headerlink" title="例题"></a>例题</h3><h4 id="P1613-跑路"><a href="#P1613-跑路" class="headerlink" title="P1613 跑路"></a><a href="https://www.luogu.com.cn/problem/P1613">P1613 跑路</a></h4><p>这道题是最短路径和倍增思想的结合题。</p><p>首先说一下一个明显的错误： <strong>绝对不能直接求最短路</strong>。</p><p>原因很简单，题目中有说，有跑路器。</p><p>那么进一步思考，发现，任意 $2^k$ 的路径长度都可以在 $1$ 秒内走完，因此如果有 $u,v$ 两点间的最短距离为 $2^k$ 即可认为这两点之间有一条边（本题中边权全部为 $1$ ）。</p><p>接下来，思路就很简单了。令 $f_{i,j,k}$ 的意义为能否在 $2^i$ 时间内从点 $j$ 走到点 $k$ ，可以为 $1$ ，不可以为 $0$。进一步，由<strong>倍增</strong>的思想可以得到：若 $f_{i-1, v, k}$ 和 $f_{i-1, k, u}$ 同时为 $1$ ，则 $f_{i, v, u}$ 为 $1$ 。</p><p>在这些都预处理完成之后，在跑一个最短路，就正确了。</p><details>    <summary>AC Code</summary><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;ctime&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iomanip&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stack&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;map&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> gh() getchar()</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> underMax(x,y) ((x)&gt;(y)?(x):(y))</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> underMin(x,y) ((x)&lt;(y)?(x):(y))</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> LL;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN=<span class="number">101</span>;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">underRead</span><span class="params">(T &amp;x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    x=<span class="number">0</span>;</span><br><span class="line">    <span class="type">char</span> ch=<span class="built_in">gh</span>(),t=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(ch&lt;<span class="string">&#x27;0&#x27;</span>||ch&gt;<span class="string">&#x27;9&#x27;</span>) t|=ch==<span class="string">&#x27;-&#x27;</span>,ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">while</span>(ch&gt;=<span class="string">&#x27;0&#x27;</span>&amp;&amp;ch&lt;=<span class="string">&#x27;9&#x27;</span>) x=x*<span class="number">10</span>+(ch^<span class="number">48</span>),ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">if</span>(t) x=-x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">bool</span> G[MAXN][MAXN][MAXN];</span><br><span class="line"><span class="type">int</span> Dist[MAXN][MAXN],N,M,Qx,Qy;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="comment">//  freopen(&quot;run.in&quot;,&quot;r&quot;,stdin);</span></span><br><span class="line"><span class="comment">//  freopen(&quot;run.out&quot;,&quot;w&quot;,stdout);</span></span><br><span class="line">    <span class="built_in">underRead</span>(N),<span class="built_in">underRead</span>(M);</span><br><span class="line">    <span class="built_in">memset</span>(Dist,<span class="number">0x3f</span>,<span class="built_in">sizeof</span>(Dist));</span><br><span class="line">    <span class="built_in">memset</span>(G,<span class="number">0</span>,<span class="built_in">sizeof</span>(G));</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=M;++i)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">underRead</span>(Qx),<span class="built_in">underRead</span>(Qy);</span><br><span class="line">        Dist[Qx][Qy]=<span class="number">1</span>;G[Qx][Qy][<span class="number">0</span>]=<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> k=<span class="number">1</span>;k&lt;=<span class="number">64</span>;++k)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=N;++i)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">1</span>;j&lt;=N;++j)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">for</span>(<span class="type">int</span> l=<span class="number">1</span>;l&lt;=N;++l)</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="keyword">if</span>(G[i][j][k<span class="number">-1</span>]&amp;&amp;G[j][l][k<span class="number">-1</span>])</span><br><span class="line">                    &#123;</span><br><span class="line">                        G[i][l][k]=<span class="number">1</span>;</span><br><span class="line">                        Dist[i][l]=<span class="number">1</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> k=<span class="number">1</span>;k&lt;=N;++k)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=N;++i)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">1</span>;j&lt;=N;++j)</span><br><span class="line">            &#123;</span><br><span class="line">                Dist[i][j]=<span class="built_in">underMin</span>(Dist[i][j],Dist[i][k]+Dist[k][j]);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d&quot;</span>,Dist[<span class="number">1</span>][N]);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">4 4</span></span><br><span class="line"><span class="comment">1 1</span></span><br><span class="line"><span class="comment">1 2</span></span><br><span class="line"><span class="comment">2 3</span></span><br><span class="line"><span class="comment">3 4</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure></details><hr><h4 id="P1081-NOIP2012-提高组-开车旅行"><a href="#P1081-NOIP2012-提高组-开车旅行" class="headerlink" title="P1081 [NOIP2012 提高组] 开车旅行"></a><a href="https://www.luogu.com.cn/problem/P1081">P1081 [NOIP2012 提高组] 开车旅行</a></h4><hr><h2 id="数据结构优化-dp"><a href="#数据结构优化-dp" class="headerlink" title="数据结构优化 dp"></a>数据结构优化 dp</h2>]]></content>
      
      
      <categories>
          
          <category> 学习笔记 </category>
          
          <category> OI </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 数论 </tag>
            
            <tag> 期望 </tag>
            
            <tag> DP </tag>
            
            <tag> 组合数学 </tag>
            
            <tag> 线段树优化dp </tag>
            
            <tag> 期望dp </tag>
            
            <tag> 矩阵快速幂 </tag>
            
            <tag> 矩阵加速 </tag>
            
            <tag> 倍增dp </tag>
            
            <tag> 数据结构优化dp </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>P4315 月下“毛景树”</title>
      <link href="/Eternity/%E9%A2%98%E8%A7%A3/p4315/"/>
      <url>/Eternity/%E9%A2%98%E8%A7%A3/p4315/</url>
      
        <content type="html"><![CDATA[<p>两道毒瘤题的有机结合。</p><span id="more"></span><p>仔细阅读这道题，再回想自己做过的题，就会觉得有些微妙。</p><p><a href="https://www.luogu.com.cn/problem/P4315">原题指路</a></p><p>这道题实则是<a href="https://www.luogu.com.cn/problem/P4114">Query on the Tree I</a>和<a href="https://www.luogu.com.cn/problem/P1253">扶苏的问题</a>的结合。</p><p>理解为在树上进行扶苏那道题里的操作。（即双标记互相影响）</p><p>另外，<code>cover</code> 标记还挺容易被卡的，一定要注意自己定的初值是否会成为 <code>cover</code> 的对象，一般而言定个 <code>-0x7f7f7f7f</code> 或者 <code>-1145141919810</code> 都可以。</p><details>    <summary>AC Code</summary><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;ctime&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iomanip&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stack&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;map&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> gh() getchar()</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> re register</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ls p&lt;&lt;1</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> rs p&lt;&lt;1|1</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> ll;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN=<span class="number">1e5</span>+<span class="number">1</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> Null=<span class="number">-0x7f7f7f7f</span>;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    x=<span class="number">0</span>;</span><br><span class="line">    <span class="type">char</span> ch=<span class="built_in">gh</span>(),t=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(ch&lt;<span class="string">&#x27;0&#x27;</span>||ch&gt;<span class="string">&#x27;9&#x27;</span>) t|=ch==<span class="string">&#x27;-&#x27;</span>,ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">while</span>(ch&gt;=<span class="string">&#x27;0&#x27;</span>&amp;&amp;ch&lt;=<span class="string">&#x27;9&#x27;</span>) x=(x&lt;&lt;<span class="number">3</span>)+(x&lt;&lt;<span class="number">1</span>)+(ch^<span class="number">48</span>),ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">if</span>(t) x=-x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T,<span class="keyword">class</span> ...T1&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x,T1 &amp;...x1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">read</span>(x),<span class="built_in">read</span>(x1...);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">checkMax</span><span class="params">(T &amp;x,T &amp;y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x&lt;y?x=y,<span class="number">1</span>:<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">checkMin</span><span class="params">(T &amp;x,T &amp;y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x&gt;y?x=y,<span class="number">1</span>:<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> N,Pts[MAXN];</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">G</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> next,to,val;</span><br><span class="line">    <span class="built_in">G</span>(<span class="type">int</span> n=<span class="number">0</span>,<span class="type">int</span> t=<span class="number">0</span>,<span class="type">int</span> v=<span class="number">0</span>):<span class="built_in">next</span>(n),<span class="built_in">to</span>(t),<span class="built_in">val</span>(v)&#123;&#125;</span><br><span class="line">&#125;Edge[MAXN&lt;&lt;<span class="number">1</span>];</span><br><span class="line"><span class="type">int</span> Head[MAXN],Total,Idx[MAXN],Bck[MAXN];</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">addEdge</span><span class="params">(<span class="type">int</span> u,<span class="type">int</span> v,<span class="type">int</span> w)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Edge[++Total]=<span class="built_in">G</span>(Head[u],v,w);Head[u]=Total;</span><br><span class="line">    Edge[++Total]=<span class="built_in">G</span>(Head[v],u,w);Head[v]=Total;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> Fa[MAXN],Size[MAXN],Son[MAXN],Dep[MAXN];</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dfsTree</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> last)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Fa[x]=last,Size[x]=<span class="number">1</span>,Dep[x]=Dep[last]+<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> e=Head[x],v;e;e=Edge[e].next)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>((v=Edge[e].to)==last) <span class="keyword">continue</span>;</span><br><span class="line">        <span class="built_in">dfsTree</span>(v,x);</span><br><span class="line">        Pts[v]=Edge[e].val;</span><br><span class="line">        Size[x]+=Size[v];</span><br><span class="line">        <span class="keyword">if</span>(!Son[x]||Size[v]&gt;Size[Son[x]]) Son[x]=v;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> Top[MAXN],Dfn[MAXN],Val[MAXN],Cnt;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dfsSeg</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> topf)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Dfn[x]=++Cnt;</span><br><span class="line">    Val[Cnt]=Pts[x],Top[x]=topf;</span><br><span class="line">    <span class="keyword">if</span>(!Son[x]) <span class="keyword">return</span> ;</span><br><span class="line">    <span class="built_in">dfsSeg</span>(Son[x],topf);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> e=Head[x],v;e;e=Edge[e].next)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>((v=Edge[e].to)==Fa[x]||v==Son[x]) <span class="keyword">continue</span>;</span><br><span class="line">        <span class="built_in">dfsSeg</span>(v,v);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">SegmentTree</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> l,r,tagadd,tagcover,maxn;</span><br><span class="line">&#125;Tree[MAXN&lt;&lt;<span class="number">2</span>];</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">pushUp</span><span class="params">(<span class="type">int</span> p)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Tree[p].maxn=<span class="built_in">max</span>(Tree[ls].maxn,Tree[rs].maxn);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">pushDownCover</span><span class="params">(<span class="type">int</span> p)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(Tree[p].tagcover!=Null)</span><br><span class="line">    &#123;</span><br><span class="line">        Tree[ls].tagadd=Tree[rs].tagadd=<span class="number">0</span>;</span><br><span class="line">        Tree[ls].tagcover=Tree[rs].tagcover=Tree[p].tagcover;</span><br><span class="line">        Tree[ls].maxn=Tree[rs].maxn=Tree[p].tagcover;</span><br><span class="line">        Tree[p].tagcover=Null;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">pushDownAdd</span><span class="params">(<span class="type">int</span> p)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(Tree[p].tagadd)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">pushDownCover</span>(p);</span><br><span class="line">        Tree[ls].maxn+=Tree[p].tagadd;</span><br><span class="line">        Tree[rs].maxn+=Tree[p].tagadd;</span><br><span class="line">        Tree[ls].tagadd+=Tree[p].tagadd;</span><br><span class="line">        Tree[rs].tagadd+=Tree[p].tagadd;</span><br><span class="line">        Tree[p].tagadd=<span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">pushDown</span><span class="params">(<span class="type">int</span> p)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">pushDownCover</span>(p),<span class="built_in">pushDownAdd</span>(p);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">build</span><span class="params">(<span class="type">int</span> p,<span class="type">int</span> l,<span class="type">int</span> r)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Tree[p].l=l,Tree[p].r=r,Tree[p].tagcover=Null;</span><br><span class="line">    <span class="keyword">if</span>(l==r)</span><br><span class="line">    &#123;</span><br><span class="line">        Tree[p].maxn=Val[l];</span><br><span class="line">        <span class="keyword">return</span> ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> mid=(l+r)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">    <span class="built_in">build</span>(ls,l,mid),<span class="built_in">build</span>(rs,mid+<span class="number">1</span>,r);</span><br><span class="line">    <span class="built_in">pushUp</span>(p);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">modifyAdd</span><span class="params">(<span class="type">int</span> p,<span class="type">int</span> l,<span class="type">int</span> r,<span class="type">int</span> k)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(l&lt;=Tree[p].l&amp;&amp;Tree[p].r&lt;=r)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">pushDownCover</span>(p);</span><br><span class="line">        Tree[p].maxn+=k;</span><br><span class="line">        Tree[p].tagadd+=k;</span><br><span class="line">        <span class="keyword">return</span> ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">pushDown</span>(p);</span><br><span class="line">    <span class="type">int</span> mid=(Tree[p].l+Tree[p].r)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span>(l&lt;=mid) <span class="built_in">modifyAdd</span>(ls,l,r,k);</span><br><span class="line">    <span class="keyword">if</span>(mid&lt;r) <span class="built_in">modifyAdd</span>(rs,l,r,k);</span><br><span class="line">    <span class="built_in">pushUp</span>(p);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">modifyCover</span><span class="params">(<span class="type">int</span> p,<span class="type">int</span> l,<span class="type">int</span> r,<span class="type">int</span> k)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(l&lt;=Tree[p].l&amp;&amp;Tree[p].r&lt;=r)</span><br><span class="line">    &#123;</span><br><span class="line">        Tree[p].maxn=k;</span><br><span class="line">        Tree[p].tagadd=<span class="number">0</span>;</span><br><span class="line">        Tree[p].tagcover=k;</span><br><span class="line">        <span class="keyword">return</span> ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">pushDown</span>(p);</span><br><span class="line">    <span class="type">int</span> mid=(Tree[p].l+Tree[p].r)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span>(l&lt;=mid) <span class="built_in">modifyCover</span>(ls,l,r,k);</span><br><span class="line">    <span class="keyword">if</span>(mid&lt;r) <span class="built_in">modifyCover</span>(rs,l,r,k);</span><br><span class="line">    <span class="built_in">pushUp</span>(p);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">queryMax</span><span class="params">(<span class="type">int</span> p,<span class="type">int</span> l,<span class="type">int</span> r)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// printf(&quot;%d %d %d\n&quot;,Tree[p].l,Tree[p].r,Tree[p].maxn);</span></span><br><span class="line">    <span class="keyword">if</span>(l&lt;=Tree[p].l&amp;&amp;Tree[p].r&lt;=r) <span class="keyword">return</span> Tree[p].maxn;</span><br><span class="line">    <span class="built_in">pushDown</span>(p);</span><br><span class="line">    <span class="type">int</span> res=Null;</span><br><span class="line">    <span class="type">int</span> mid=(Tree[p].l+Tree[p].r)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span>(l&lt;=mid) res=<span class="built_in">max</span>(res,<span class="built_in">queryMax</span>(ls,l,r));</span><br><span class="line">    <span class="keyword">if</span>(mid&lt;r) res=<span class="built_in">max</span>(res,<span class="built_in">queryMax</span>(rs,l,r));</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">modifyPathCover</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> y,<span class="type">int</span> k)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">while</span>(Top[x]!=Top[y])</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(Dep[Top[x]]&lt;Dep[Top[y]]) <span class="built_in">swap</span>(x,y);</span><br><span class="line">        <span class="built_in">modifyCover</span>(<span class="number">1</span>,Dfn[Top[x]],Dfn[x],k);</span><br><span class="line">        x=Fa[Top[x]];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(x==y) <span class="keyword">return</span> ;</span><br><span class="line">    <span class="keyword">if</span>(Dep[x]&gt;Dep[y]) <span class="built_in">swap</span>(x,y);</span><br><span class="line">    <span class="built_in">modifyCover</span>(<span class="number">1</span>,Dfn[x]+<span class="number">1</span>,Dfn[y],k);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">modifyPathAdd</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> y,<span class="type">int</span> k)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">while</span>(Top[x]!=Top[y])</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(Dep[Top[x]]&lt;Dep[Top[y]]) <span class="built_in">swap</span>(x,y);</span><br><span class="line">        <span class="built_in">modifyAdd</span>(<span class="number">1</span>,Dfn[Top[x]],Dfn[x],k);</span><br><span class="line">        x=Fa[Top[x]];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(x==y) <span class="keyword">return</span> ;</span><br><span class="line">    <span class="keyword">if</span>(Dep[x]&gt;Dep[y]) <span class="built_in">swap</span>(x,y);</span><br><span class="line">    <span class="built_in">modifyAdd</span>(<span class="number">1</span>,Dfn[x]+<span class="number">1</span>,Dfn[y],k);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">queryPathMax</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> res=Null;</span><br><span class="line">    <span class="keyword">while</span>(Top[x]!=Top[y])</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(Dep[Top[x]]&lt;Dep[Top[y]]) <span class="built_in">swap</span>(x,y);</span><br><span class="line">        res=<span class="built_in">max</span>(res,<span class="built_in">queryMax</span>(<span class="number">1</span>,Dfn[Top[x]],Dfn[x]));</span><br><span class="line">        x=Fa[Top[x]];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(x==y) <span class="keyword">return</span> res;</span><br><span class="line">    <span class="keyword">if</span>(Dep[x]&gt;Dep[y]) <span class="built_in">swap</span>(x,y);</span><br><span class="line">    res=<span class="built_in">max</span>(res,<span class="built_in">queryMax</span>(<span class="number">1</span>,Dfn[x]+<span class="number">1</span>,Dfn[y]));</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">modifyPoint</span><span class="params">(<span class="type">int</span> u,<span class="type">int</span> k)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">modifyCover</span>(<span class="number">1</span>,Dfn[Idx[u]],Dfn[Idx[u]],k);</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">char</span> opt[<span class="number">10</span>];</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// freopen(&quot;tree-chain.in&quot;,&quot;r&quot;,stdin);</span></span><br><span class="line">    <span class="comment">// freopen(&quot;tree-chain.out&quot;,&quot;w&quot;,stdout);</span></span><br><span class="line">    <span class="built_in">read</span>(N);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">2</span>,u,v,w;i&lt;=N;++i)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">read</span>(u,v,w);</span><br><span class="line">        <span class="built_in">addEdge</span>(u,v,w);</span><br><span class="line">        Bck[i<span class="number">-1</span>]=u,Idx[i<span class="number">-1</span>]=v;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">dfsTree</span>(<span class="number">1</span>,<span class="number">0</span>);</span><br><span class="line">    <span class="built_in">dfsSeg</span>(<span class="number">1</span>,<span class="number">1</span>);</span><br><span class="line">    <span class="built_in">build</span>(<span class="number">1</span>,<span class="number">1</span>,N);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;N;++i)</span><br><span class="line">        Idx[i]=(Bck[i]==Fa[Idx[i]]?Idx[i]:Bck[i]);</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>,opt+<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">while</span>(opt[<span class="number">1</span>]!=<span class="string">&#x27;S&#x27;</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(opt[<span class="number">1</span>]==<span class="string">&#x27;A&#x27;</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="type">int</span> u,v,w;</span><br><span class="line">            <span class="built_in">read</span>(u,v,w);</span><br><span class="line">            <span class="built_in">modifyPathAdd</span>(u,v,w);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(opt[<span class="number">1</span>]==<span class="string">&#x27;M&#x27;</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="type">int</span> u,v;</span><br><span class="line">            <span class="built_in">read</span>(u,v);</span><br><span class="line">            <span class="keyword">if</span>(u==v) <span class="built_in">puts</span>(<span class="string">&quot;0&quot;</span>);</span><br><span class="line">            <span class="keyword">else</span> <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,<span class="built_in">queryPathMax</span>(u,v));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(opt[<span class="number">2</span>]==<span class="string">&#x27;h&#x27;</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="type">int</span> k,w;</span><br><span class="line">            <span class="built_in">read</span>(k,w);</span><br><span class="line">            <span class="built_in">modifyPoint</span>(k,w);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="type">int</span> u,v,w;</span><br><span class="line">            <span class="built_in">read</span>(u,v,w);</span><br><span class="line">            <span class="built_in">modifyPathCover</span>(u,v,w);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>,opt+<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/*for(int i=1;i&lt;=N;++i) printf(&quot;%d &quot;,Dfn[i]);</span></span><br><span class="line"><span class="comment">    puts(&quot;&quot;);</span></span><br><span class="line"><span class="comment">    for(int i=1;i&lt;=N;++i) printf(&quot;%d &quot;,Val[i]);*/</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">4</span></span><br><span class="line"><span class="comment">1 2 8</span></span><br><span class="line"><span class="comment">1 3 7</span></span><br><span class="line"><span class="comment">3 4 9</span></span><br><span class="line"><span class="comment">Max 2 4</span></span><br><span class="line"><span class="comment">Cover 2 4 5</span></span><br><span class="line"><span class="comment">Add 1 4 10</span></span><br><span class="line"><span class="comment">Change 1 16</span></span><br><span class="line"><span class="comment">Max 2 4</span></span><br><span class="line"><span class="comment">Stop</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure></details>]]></content>
      
      
      <categories>
          
          <category> 题解 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> dfs </tag>
            
            <tag> 数据结构 </tag>
            
            <tag> 线段树 </tag>
            
            <tag> 树型结构 </tag>
            
            <tag> Dfs序 </tag>
            
            <tag> LCA </tag>
            
            <tag> 树链剖分 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>分数规划</title>
      <link href="/Eternity/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/OI/fractional-programming/"/>
      <url>/Eternity/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/OI/fractional-programming/</url>
      
        <content type="html"><![CDATA[<p>“空即是色，色即是空。”</p><span id="more"></span><h2 id="用法"><a href="#用法" class="headerlink" title="用法"></a>用法</h2><p>分数规划求一个分式的极值。</p><p>给出 $a_i$ 和 $b_i$ ，求一组 $w_i\in\{0,1\}$ ，最大化/最小化：</p><script type="math/tex; mode=display">\frac{\sum\limits_{i=1}^n a_i\times w_i}{\sum\limits^n_{i=1}b_i\times w_i}    \nonumber</script><p>当然，毒瘤题中还会有一些特殊限制。</p><h2 id="求解"><a href="#求解" class="headerlink" title="求解"></a>求解</h2><h3 id="二分"><a href="#二分" class="headerlink" title="二分"></a>二分</h3><p>令当前答案为 $mid$ ，我们只需要使：（以最大值为例）</p><script type="math/tex; mode=display">\frac{\sum\limits_{i=1}^n a_i\times w_i}{\sum\limits^n_{i=1}b_i\times w_i}>mid\nonumber</script><p>然后推得：</p><script type="math/tex; mode=display">\sum_{i=1}^{n}w_i\times(a_i-mid\times b_i)>0\nonumber</script><p>即可。最小值类似。</p><h3 id="Dinkelbach-算法"><a href="#Dinkelbach-算法" class="headerlink" title="Dinkelbach 算法"></a>Dinkelbach 算法</h3><p>Dinkelbach 算法的大概思想是每次用上一轮的答案当做新的 $L$ 来输入，不断地迭代，直至答案收敛。说实话，这东西我看了有 $5$ 篇讲解也不是太懂，之后有时间再学学。</p><p>有点类似于构造函数，通过对已知答案的迭代来得出当前答案。并根据更优解移动答案以逼近最优解。</p><h2 id="例题"><a href="#例题" class="headerlink" title="例题"></a>例题</h2><h3 id="Talent-Show"><a href="#Talent-Show" class="headerlink" title="Talent Show"></a><a href="https://www.luogu.com.cn/problem/P4377">Talent Show</a></h3><p>求最大分数，且需要满足 $\sum w_i\times b_i\ge W$ 的条件。</p><p>其实在开始的时候，就会发现 $w_i\in\{0,1\}$ 十分熟悉，有些像…… $01$ 背包。</p><p>把 $b_i$ 作为 $i$ 物品的重量，将 $a_i-mid\times b_i$ 作为第 $i$ 个物品的价值，作为 dp 来转移，求出 $dp[n][W]$ 即可。</p><p>将大于 $W$ 的 $\sum w_i\times b_i$ 直接视作 $W$ 即可。因为我们并不考虑实际重量和，只关心是否能把背包装满。</p><details>    <summary>AC Code</summary><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;ctime&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iomanip&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stack&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;map&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> gh() getchar()</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> re register</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> ll;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN=<span class="number">301</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXW=<span class="number">1001</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">double</span> eps=<span class="number">1e-5</span>;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    x=<span class="number">0</span>;</span><br><span class="line">    <span class="type">char</span> ch=<span class="built_in">gh</span>(),t=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(ch&lt;<span class="string">&#x27;0&#x27;</span>||ch&gt;<span class="string">&#x27;9&#x27;</span>) t|=ch==<span class="string">&#x27;-&#x27;</span>,ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">while</span>(ch&gt;=<span class="string">&#x27;0&#x27;</span>&amp;&amp;ch&lt;=<span class="string">&#x27;9&#x27;</span>) x=(x&lt;&lt;<span class="number">3</span>)+(x&lt;&lt;<span class="number">1</span>)+(ch^<span class="number">48</span>),ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">if</span>(t) x=-x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T,<span class="keyword">class</span> ...T1&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x,T1 &amp;...x1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">read</span>(x),<span class="built_in">read</span>(x1...);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">checkMax</span><span class="params">(T &amp;x,T &amp;y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x&lt;y?x=y,<span class="number">1</span>:<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">checkMin</span><span class="params">(T &amp;x,T &amp;y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x&gt;y?x=y,<span class="number">1</span>:<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> a[MAXN],b[MAXN],W,N;</span><br><span class="line"><span class="type">double</span> dp[MAXW];</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">check</span><span class="params">(<span class="type">double</span> x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=W;++i) dp[i]=<span class="number">-1e9</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=N;++i)</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j=W;j&gt;=<span class="number">0</span>;--j)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="type">int</span> k=<span class="built_in">min</span>(W,j+b[i]);</span><br><span class="line">            dp[k]=<span class="built_in">max</span>(dp[k],dp[j]+a[i]-x*b[i]);</span><br><span class="line">        &#125;</span><br><span class="line">    <span class="keyword">return</span> dp[W]&gt;<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// freopen(&quot;frac-programming.in&quot;,&quot;r&quot;,stdin);</span></span><br><span class="line">    <span class="comment">// freopen(&quot;frac-programming.out&quot;,&quot;w&quot;,stdout);</span></span><br><span class="line">    <span class="built_in">read</span>(N,W);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=N;++i) <span class="built_in">read</span>(b[i],a[i]);</span><br><span class="line">    <span class="type">double</span> l=<span class="number">0</span>,r=<span class="number">1e9</span>;</span><br><span class="line">    <span class="keyword">while</span>(r-l&gt;eps)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">double</span> mid=(l+r)/<span class="number">2</span>;</span><br><span class="line">        <span class="keyword">if</span>(<span class="built_in">check</span>(mid)) l=mid;</span><br><span class="line">        <span class="keyword">else</span> r=mid;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%.0lf&quot;</span>,<span class="built_in">floor</span>(<span class="number">1000</span>*l));</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">3 15</span></span><br><span class="line"><span class="comment">20 21</span></span><br><span class="line"><span class="comment">10 11</span></span><br><span class="line"><span class="comment">30 31</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure></details>]]></content>
      
      
      <categories>
          
          <category> 学习笔记 </category>
          
          <category> OI </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 数论 </tag>
            
            <tag> DP </tag>
            
            <tag> 图论 </tag>
            
            <tag> 贪心 </tag>
            
            <tag> 二分 </tag>
            
            <tag> 构造 </tag>
            
            <tag> 生成树 </tag>
            
            <tag> 背包 </tag>
            
            <tag> 分析数学 </tag>
            
            <tag> 分数规划 </tag>
            
            <tag> 01分数规划 </tag>
            
            <tag> 网络流 </tag>
            
            <tag> 最优比例生成树 </tag>
            
            <tag> 最优比例环 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>《文学少女》——邂逅之后，才能明晓一切</title>
      <link href="/Eternity/%E8%AE%B0%E9%9A%8F%E5%BD%B1%E8%90%BD/book-girl/"/>
      <url>/Eternity/%E8%AE%B0%E9%9A%8F%E5%BD%B1%E8%90%BD/book-girl/</url>
      
        <content type="html"><![CDATA[<p>这首诗，献给七年前，作为学长的你；<br>这首诗，献给这一天，作为恋人的你；<br>这首诗，献给一月后，作为妻子的你。</p><span id="more"></span><blockquote><p>高中二年级的普通学生井上心叶，因为过去的阴影，对人抱着冷淡的态度。然而，因为某个契机，井上心叶知道了文学少女天野远子的秘密。得知秘密的他被远子以文艺社社长的身份强制要求加入社团，并且每天被逼写三题故事。</p><p>由于远子好管闲事的个性，心叶常常被卷入一些事件中，而后帮助事件顺利解决。在事件当中，两人结识了竹田千爱、姬仓麻贵、琴吹七濑等人。他人的故事和心叶自己的秘密相互交错。最终，文学少女解开了迷题，而心叶等人的命运，也一点点的脱离了轨迹……</p></blockquote><h2 id="正传"><a href="#正传" class="headerlink" title="正传"></a>正传</h2><h3 id="渴望死亡的小丑-x-竹田千爱"><a href="#渴望死亡的小丑-x-竹田千爱" class="headerlink" title="渴望死亡的小丑 x 竹田千爱"></a>渴望死亡的小丑 x 竹田千爱</h3><p>这是关于一个人偶女孩的故事。</p><blockquote><p>井上心叶怨恨所有人，也不喜欢自己。为了迎合这个世界，他必须伪装自己，逼自己展露笑容。他认为自己就像小丑，骨子里满怀悲伤的小丑。超级喜欢编故事的“文学少女”天野远子与向往平稳平凡爱情的井上心叶，再加上不懂人心孤独的“小丑”，交织出充满绝望与感动人心的故事！</p></blockquote><p>从刚开始阅读的时候，我有些觉得这套书似乎和某节能型人才有些相似。同属于校园侦探类型，不过这只是最浅层次的罢了。</p><p>《文学少女》带来的，更多是属于阅读者才有的乐趣。</p><p>以《人间失格》为版面的第一部，是完全压抑的一部，重在是普遍悬疑小说都存在的层层推进，最终得到答案。我没有阅读过原作（这套书里提及的任何一本我都没有阅读完整过），但是却依然会受益匪浅。故事真的就如小说中写的那样去发展，在真相似乎依然出现的时候，在故事似乎已经完全的时候，正确答案却并非如同真相一般。前文或有或无的线索被串联，交织，推理。得到了与真相恰恰相反的正确答案，这就是《文学少女》的魅力所在，即使似乎每一本所有的结构与套路都相同，但总会给人以焕然一新之感，毕竟每一本发生的故事的版面都是不同的。</p><p>最终，愁二学长是第一个“人间失格”，而竹田千爱同样是“人间失格”，所有人都在互相拯救，心叶也是一样的，从过去中挣脱，盼望着未来能够一帆风顺，却总不人意料。你是这样的，我也是这样的。如果想做的是和能做的事重合的话，那是多少概率的事呢？不用计算也知道吧。</p><p>说说竹田千爱，一个没有感情的少女，不知幸福，无懂悲伤，没有办法去评判感情，却又如同小丑一般，戴上面具，活得“开心”，但也能在目睹车祸时怔然坠地，也能悲伤地对着流人说出“我也想要流人的孩子”。人人都是小丑，人人都戴着面具，而总有一天会被摘下，直视自己。</p><blockquote><p>你知道为什么丘丘人戴着面具吗，因为它们恐惧着面具下的自己。</p><p>Cheem，你是小丑吗？</p></blockquote><p>都是这样，假装着自己的悲伤，因为会被同类人排斥，被嘲笑，被辱骂。这个世界就是这样的，例外是永恒的敌人，社会具有排异性，随波逐流看似是最坏的选择，但却是最明智的选择。</p><p>只不过聪明人都不满与此罢了。</p><h3 id="渴求真爱的幽灵-x-樱井流人"><a href="#渴求真爱的幽灵-x-樱井流人" class="headerlink" title="渴求真爱的幽灵 x 樱井流人"></a>渴求真爱的幽灵 x 樱井流人</h3><p>死去的人不会重生，所以才会明白活着。</p><blockquote><p>文艺社社长天野远子，自称是对故事喜爱到想要吃下去的“文学少女”，每天都跟学弟井上心叶待在一起。有一天，文艺社的“恋爱咨询信箱”里出现了一些纸片，上面写着“憎恨”、“幽灵”、还有一些谜题般的数字。远子一口咬定，这是对文艺社的挑战！就拉着心叶一起展开调查，而他们抓到的犯人，竟然是笑着说“我已经死了”的少女！</p></blockquote><p>这是与本作无大关联却又极大关联的一本。</p><p>以《呼啸山庄》为原本，本就已经预示着情节如狂风般呼啸。深爱着对方，却又残酷地对待，每一个人都对过去怀有抱歉，于是牺牲自己而挽回。却最终被正确答案玩弄于股掌。背负罪名，看着深爱的人在怀里死去，禁忌之爱也希望有所结果。是父女，也是恋人，是在污朽中挣扎的同伴，是在谴责中互相折磨的旅人。</p><p>山庄呼啸着，无人倾听。</p><p>之后的故事中，似乎有时无时地提及过黑崎与萤，更多是讲述麻贵和流人。让读者明白，身为名家的麻贵敢于为了一心所愿而背离众人，而花天曼地的流人也曾为一个女孩而专情。人存在着阴阳之面，只是没有找到应有的时机去表露罢了。</p><h3 id="沉陷过往的愚者-x-芥川一诗"><a href="#沉陷过往的愚者-x-芥川一诗" class="headerlink" title="沉陷过往的愚者 x 芥川一诗"></a>沉陷过往的愚者 x 芥川一诗</h3><p>过往的痛苦让人更加接受现实的残酷。</p><blockquote><p>“啊！这本书竟然有缺页！”某天远子发现从图书馆借来的书本，竟然有几页被人割掉了。身为喜爱故事到想要把它吃下去的“文学少女”，怎么可能对此不闻不问呢！被再度暴走的远子卷入黑色事件的心叶和同班同学芥川，一步一步被逼至极限的疯狂……是谁躲在黑暗的角落窥探？“文学少女”能够解放这个沉溺过往的灵魂吗？</p></blockquote><p>我挺喜欢一诗这人的，不仅仅因为他的声优是小野大辅，更在于他的性格，迟钝得让人愉悦，但又聪明得让人佩服，偷偷背负一切的人，选择用自己换取他人的幸福，这是无私，也是自私。不把自己的命当命的人，也是不值得尊敬的。</p><p>这么看来，一诗确实是那个“愚者”。</p><p>这一本中，以文化节为背景，化作《友情》，让心叶与一诗一同克服各自的过去。在坎前徘徊，而从另一侧伸出的一只手，最终才让困难圆满落幕。也正是这一册，才真正明白了远子对于心叶，不可或缺的作用。</p><blockquote><p>每个人都是愚者。</p></blockquote><p>曾经我的初中班主任在毕业那一天问过我们一个问题：“你有后悔的事么？”</p><p>这是一个没有答案的问题，确实后悔，但也无济于事，所以不再后悔；确实不后悔，但迟迟徘徊于心，纵然不忘，实属后悔。</p><p>我们被自己的过去玩弄，成为了过去手中的愚者，而那些对昨天发生的事不屑一顾的人，才算得上是真正的勇者。人生需要去后悔，才有了走马灯这样的东西。</p><p>当历程殆尽，你的脑中连一点回忆都没有留下，那真是太糟糕了。</p><blockquote><p>但愚者是必要的，如果一个人是纯粹的智者，那他的生活实属无味。</p></blockquote><p>如果在给我一次机会，就像《重启人生》一样，我依然愿意去当一个愚者，虽然不会“愚”得彻底，但也会去享受“傻人有傻福”的时刻。</p><h3 id="背负污名的天使-x-琴吹七濑"><a href="#背负污名的天使-x-琴吹七濑" class="headerlink" title="背负污名的天使 x 琴吹七濑"></a>背负污名的天使 x 琴吹七濑</h3><blockquote><p>文艺社社长天野远子，是对故事喜爱到想要把它吃下去的“文学少女”，可是不知道为什么，突然有一天她竟然发表了休社宣言！听到这一切后，心叶感到愕然的同时也察觉了自己心底的一丝寂寞。心叶决定放下心底的感觉，去过平和的生活，一边给音乐老师球谷帮忙，一边每天放学后与七濑一起留校……圣诞节将近的街道上，一位少女突然消失，拼命寻找她的七濑和心叶，面前出现了一位仿佛是心叶自身投影的“天使”……</p></blockquote><p>七濑是整本书我最喜欢的角色之一（从恋爱角度看），傲娇，呆萌，贤惠，可爱；简直是女朋友的不二之选，可惜是<del>败犬</del>，不过我就勉为其难拿下啦。</p><p>这是《文学少女》中三大禁忌之爱的第二对，也是第二对以悲伤结尾的恋情。一切都如同《歌剧魅影》中一样，化为泡影。</p><p>一方是从小的天才，被誉为“天使”的歌手；一边是平凡但追求梦想的学生。</p><blockquote><p>天使的歌声使人坠入地狱。</p></blockquote><p>球谷躲避着真正天使的嗓音，却始终放不下自己所爱的音乐，最终作为一个平凡的音乐老师收尾，而深爱着水户夕歌。然而，现实是滑稽的，天使也来到于此，并不断传授夕歌以天使的唱歌技巧。最终，迫于过去的罪恶，他杀害了自己心爱的人，堕入了地狱。他拥有与臣一样的痛苦，因为美丽的嗓音而被厚望，与梦想背道而驰。两个人都是歌剧里的魅影，两个人都是被魅影挟持的人质。</p><blockquote><p>没有人绝对正义，所以没有人绝对邪恶。</p></blockquote><p>在失去之后，才能得到的正确答案。无法挽回，所以才会选择承担，也正因如此，才能毫无顾忌地去接受过去。球谷才会去自首，臣也安然离开。留下名为“天使”的传说。</p><p>所谓“天使”，却背负着污名；所谓“魅影”，却承担着过去。</p><h3 id="绝望恸哭的信徒-x-朝仓美羽"><a href="#绝望恸哭的信徒-x-朝仓美羽" class="headerlink" title="绝望恸哭的信徒 x 朝仓美羽"></a>绝望恸哭的信徒 x 朝仓美羽</h3><p>这是最接近现实的一本。</p><blockquote><p>快要毕业的远子学姐和心叶似乎有些渐行渐远，为此感到寂寞的心叶并不承认心底的感觉。他继续跟七濑保持着交往，而他们的关系在一起去新年参拜之后，愈来愈近……此时，不知怎的，七濑突然住院！而前往探望的心叶，竟然跟他未曾淡忘的少女朝仓美羽重逢！那个代表了心叶心底最深秘密的少女，就这样重新出现在心叶的眼前……</p></blockquote><p>怎样才叫现实？我也说不明白。总归来讲，就更偏重于记叙文，讲述了一个彻头彻尾的故事，没有悬疑，不会推理。只是对过去的和解。（也就为什么剧场版会选择这一本来拍摄，虽然 $2010$ 的技术不太成熟就是了）</p><p>《银河铁道之夜》，一篇童话，不同人总是能看到不同的故事，也会发现其不算童话的一面。</p><blockquote><p>一个故事的阅读方法，绝对不只有一种。只要还有别的登场人物，就会有别的故事存在。</p></blockquote><p>自己想象的过去并不一定就是真正的过去，记忆也会存在造假的情况，因为无法接受而麻痹自己，看自己想看的事，听自己想听的话，想自己所想之梦。每个人都存在着自己的梦，所以才会存在现实的偏差。当多年的谎言最终被残忍拆穿，才最后明白，每个人都有每个人的苦衷，所以</p><blockquote><p>心叶，你一定不懂吧。</p></blockquote><p>说实话，美羽的形象还是把我吓了一跳，虽然我猜出估计不算是个好人，但没想到坏得如此彻底，还是有魅力所在。这本里面的心叶确实智商时时不在线，在回想起来其实还是能理解的，毕竟一个自己守护了这么多年的梦，就这样被梦的制造者打碎而践踏，谁也无法接受，都只能躲在自己的世界里逃避。</p><p>所有人都是这样，拥有自己梦的界限，即使有人有意无意走过了那条界限，自己最理性的那一面也会感性地告诉你无事发生，否则，除非意志的坚定，也只剩下绝望恸哭可以做了。</p><h3 id="怀抱花月的水妖-x-姬仓麻贵"><a href="#怀抱花月的水妖-x-姬仓麻贵" class="headerlink" title="怀抱花月的水妖 x 姬仓麻贵"></a>怀抱花月的水妖 x 姬仓麻贵</h3><p>真正可怕的是，真实的鬼，其实是人假扮的。</p><blockquote><p>“我被坏人抓走了，请立刻带着换洗衣服和作业来救我！”</p><p>天野远子学姐的求救让心叶的暑假只好在姬仓家的别墅里写着“点心”度过了。而此时此刻，发生在八十年前的悲剧之阴影却悄悄逼近了他们！</p><p>“千金小姐”、“学生”、“妖怪”等演员都已到齐，舞台也准备妥善，一切又开始倾向崩坏……究竟是什么造成了一切的回溯？而一手导出这事态的麻贵学姐又所愿为何？因自己的想象而心神不安的“文学少女”到底有什么“秘密”呢？</p><p>如梦似幻的夏季，逆转颠倒的时间，野村美月文学少女特别卷《文学少女(怀抱花月的水妖)》来袭！</p></blockquote><p>特别篇，放在终章之前，以倒叙的手法，讲述了过去的故事。</p><p>以《夜叉池》为范本，联立七十年的故事，探讨鬼之后，人的故事。</p><p>人的任务是抓鬼，守护属于自己的利益；鬼的任务是守护，守护自己坚守的使命。是么？</p><blockquote><p>知晓真相，并不意味着得出了正确答案。</p></blockquote><p><del>纱代真的可爱。</del></p><p>麻贵代表着的是新时代对旧时代的鄙夷，纱代代表着的是新时代对旧时代的执着。这其实也是当今社会探讨的一个重要问题——对于传统文化，是传承，还是摒弃？</p><p>洗脑的政治书上早就给出过答案了——创造性转化，创新性发展。</p><p>没有人能够忘记过去，正如同没有人可以两手空空前往未来。</p><h3 id="迈向神境的作家-x-井上心叶-amp-天野远子"><a href="#迈向神境的作家-x-井上心叶-amp-天野远子" class="headerlink" title="迈向神境的作家 x 井上心叶 &amp; 天野远子"></a>迈向神境的作家 x 井上心叶 &amp; 天野远子</h3><p>仅有独者，迈向神境。</p><blockquote><p>只要把这个吃下去，所有的悲伤痛苦都会像雪一样融化，再也不用憎恨、怀疑或是嫉妒。可以如同躺在神的怀抱一样安心地入眠。他说我可以留着自己吃，也可以给别人吃。</p><p>我把装在紫色心形罐子的奥列·路却埃睡眠药粉放进珠宝箱锁起来，偶尔才会拿出来，对着光线眺望。在晶莹透明的紫色玻璃之中轻轻摇晃的银粉，让我看得入迷了，我将它贴在火烫的脸颊上，用那凉爽的感觉抚慰心情。</p><p>只要有这个小罐子，我就能改变命运了。一定连那高耸遥远的天上之门都能进入吧。现在握在我掌中的，到底是谁的心脏呢？</p><p>是我？是那个人？还是小叶呢？</p></blockquote><hr><blockquote><p>“不写小说也没关系。我会一直陪伴在井上身边。”心叶因为七濑的这句话而得到解脱，却又被流人威胁说：“我或许会把琴吹小姐彻底毁掉喔！”一波未平一波又起中，远子学姐突然消失无踪，空荡荡的房间里只留下了被割破的制服——</p><p>心叶能寻回远子吗？逐渐显露的真相，会让他找出什么样的答案呢？</p><p>远子的祈祷、叶子的怨憎、流人的绝望──藏在这些情感底下的故事，如今就要揭开……</p><p>风起云涌的最后一卷终于登场！</p></blockquote><p>作家是会背叛读者的，就如同读者一样会背叛作家一样。而作家，是需要独自走过窄门的存在，这就是作为《窄门》给我的道理。</p><p>《窄门》的定义源于基督教。</p><blockquote><p>“你们要进窄门。因为引到灭亡，那门是宽的，路是大的，进去的人也多；引到永生，那门是窄的，路是小的，找着的人也少。” ————《圣经：新约马太福音》</p></blockquote><p>随波逐浪的大流是引向灭亡的，而中途退出自由浪荡的雨滴，才能获取永生。</p><p>无论所谓的“灭亡”和所谓的“永生”对于你我而言是什么，但总归知道，“永生”大于“灭亡”的道理吧。这也是为什么所有人都需要立下觉悟而越过窄门。</p><blockquote><p>总之非常有趣，很喜欢登场人物都背负着过去的设定。——小野大辅</p></blockquote><p>没有背负过去的人，一定不太完整。曾经有一次，我的其中一个 U 盘中了病毒（因为太菜而无法删除），后来我唯一的抉择就是格式化。虽然我直到现在都不太清楚我失去了什么，但是在格式化之后，里面写了一句话：</p><blockquote><p>The one who cannot escape from the past, who cannot run for the future.</p></blockquote><p>背负了过去的人看起来更加完整，他的未来也会更加充实。但记忆终究有限，人无法沉迷入过去，适当的舍弃是更好的选择。而舍弃，需要一定的觉悟。<font style="color:white">是吧？言若。</font></p><h2 id="外传"><a href="#外传" class="headerlink" title="外传"></a>外传</h2><h3 id="文学少女见习生-x-日阪菜乃"><a href="#文学少女见习生-x-日阪菜乃" class="headerlink" title="文学少女见习生 x 日阪菜乃"></a>文学少女见习生 x 日阪菜乃</h3><p>我想，如果在我的生活中，能够遇到像菜乃这样的女孩，一生都会满足吧。</p><blockquote><p>进入圣条学园就读的日坂菜乃认识了一位学长──文艺社社长井上心叶。菜乃受到心叶的吸引后选择加入了文艺社，但是心叶的心已经被一位“文学少女”占据了，菜乃为毫无希望的感情陷入低潮。但是，当她被卷入某桩事件而陷入困境时，心叶却对她说：“我发誓，不会再对你视若无睹，也不会再撇开视线。”</p></blockquote><p>以下，是摘自两年前的对菜乃的书评。</p><blockquote><p>日坂菜乃是一个开朗又勇敢的少女，也许是因为性格力量的强大，或是初恋时爱意的深切，菜乃在与心叶接触不久之后，就向他勇敢表达了爱意……虽然被拒绝，但即使初战告败，菜乃也没有丝毫放弃的意思，仍旧坚持不懈，与心叶在文艺社里共度了一天又一天，其间两人一同经历了各种离奇事件，菜乃也不断地向心叶表达自己的心意，精心编织彼此的关系。最终，两人在离别之际互表心意，菜乃在微笑中向自己的初恋告别。</p><p>日坂菜乃是一个令人同情的角色，她勇敢的迈出了自己的步伐，追逐爱情，却注定不能够拥有属于自己的美满结局。在整篇故事的发展过程中，菜乃将自己追求爱情的实现方法，寄托在成为“文学少女”之上，而为了成为文学少女，她需要努力去读自己无法理解的文学作品。</p><blockquote><p>死定了！我一点都看不懂啊！<br>我把开头反复读了五遍，虽然感觉得出是在表达什么大道理，但我简单的脑袋完全不理解那是什么意思。我在努力思考之中，变得越来越困。<br>不能这样下去，难得井上学长推荐书给我，我非得读到最后不可。<br>……<br>我一边“唔唔”沉吟，中途还去吃了晚餐和洗了澡以此转换心情，好不容易读完的时候天都亮了。<br>我的眼睛充血，身体还因为中途躺到床上用不自然的姿势读书而腰酸背痛，脑袋里席卷着意义不明的单字和语句。</p></blockquote><p>需要像“文学少女”一样，把书本当做美味的食物一样吃下去。</p><blockquote><p>我勉强吞下几乎哽住喉咙的纸团。<br>一点都不好吃，喉咙好干涩。<br>接着，我把剩下的半页撕碎放进嘴里。<br>“呜呜……咿咿……哽哽……呜……”<br>我哭着，哽咽着，不停不停地把碎纸送入口中。<br>……<br>《茵梦湖》吃到一半，就变成泪水的味道。</p></blockquote><p>……</p><p><strong>努力是不会背叛自己的，虽然梦想有时会背叛自己。</strong></p><p>日坂菜乃通过自己的努力，逐渐从原本只读读漫画，看看恐怖片的普通女孩，变成了能耐心品读文学著作，有模有样讲述文学故事的文学少女。她逐渐喜爱上了文学，通过阅读感受各种生活，和书中的角色交朋友，但越是读着饱含情愫的作品，越是能体悟到自己实现不了最初的愿望。</p><blockquote><p>如果我不再是见习生，而是成为真正的文学少女，我们就能再见面吗？<br>你会等我成长到那个时候吗？我可以继续跟着你吗？<br>即将脱口而出的问题又被我咽回去。<br>如果不是心叶学长主动给我承诺就没有意义了。</p></blockquote><p>日坂菜乃陷入的困境，在于自己所相信的方法并不能够实现既定的愿望，甚至无论做什么，都无法改变结局的走向。已有心仪之人的心叶不会给予她爱的承诺，而年级相异的两人也注定会因为毕业而分离。正因此，两人最后度过的时光愈是甜蜜，菜乃所体悟到的痛楚就越发深刻。</p><p>故事的最后，菜乃在心叶面前，仿照着能够实现愿望的传说，在树上绑着自己的缎带，然后大声重复着自己内心的喜爱。</p><blockquote><p>其实我知道，一定要在没人看到的时候绑缎带。<br>心叶学长刚刚想说的应该是这件事。<br>让人看见的话，愿望就不能实现。<br>可是，我的愿望从一开始就不能实现啊！<br>大家早就说了绝无可能啊！</p></blockquote><p>这是个充满悲伤气味的故事，但绝不是一个痛彻心扉的悲剧，日坂菜乃天真幻想，勇敢冒进的追求初恋，却爱而不得，但她最终能与自己和解，能够微笑着向自己的初恋告别，这个青涩甜苦的结局，正是我所许久不见的某种青春味道。</p><p>像是把青涩的橘子瓣，连同籽粒嚼碎，有一股伴着酸甜的苦味，窜上鼻尖，跌入心头。</p><p>相比起一些天马行空的幻想，喧闹热腾的喜剧，这部小说极富青春的味道，初恋时求爱的激情，青春期烦恼的苦闷……我们往日里青春的热情是否因为时间消磨殆尽，这也许不得而知，但我认为，本作的女主角——日坂菜乃还会继续读、继续笑、继续对爱的追求，即便再失败，失去些什么，她也不会就此驻足不前，因为她 就是这样一个散发着生活光辉的“文学少女”。</p></blockquote><p>见习生终将毕业，我们最后做的事，就是向过去的自己告别。这是无奈而无悔的抉择。只有疯子和傻子才会认为自己的时间会暂停。“爸爸的花儿落了，我也不是小孩子了”，是时候成长的，少年。总有一天，会有人站在我们曾经站过的位置，做着我们曾经做过的事，想着我们曾经幻想着的梦。但是，所有人都会成长的，无论何时。也许，在知晓了未来并不如曾说那样美好，不过黄粱一梦；真正的现实一片死沉，劳碌的生活会将人击垮……</p><p>但，总归走过来了吧。</p><h3 id="爱恋插画集"><a href="#爱恋插画集" class="headerlink" title="爱恋插画集"></a>爱恋插画集</h3><p>那么，角色的定义，究竟是什么呢？</p><p>那些正传中没有出现过的名字，在那个时候，究竟在干些什么呢？我很喜欢美月的写作手法，虽然曾经我并不是很喜欢去看第一人称写的小说，包括我自己写的时候也不会使用第一人称。但美月让我克服了这一点，甚至让我觉得第一人称的手法比第三人称更加高明（各有各的好处），特别是这种中途切换视角的第一人称，我秉承一个观点：</p><blockquote><p>一个故事的阅读方法，绝对不只有一种。只要还有别的登场人物，就会有别的故事存在。</p></blockquote><p>而同样的，美月也坚持了这一点。</p><p>普通人的生活终究是不同的，普通人之间也是。暗恋之中，暗恋的人与被暗恋的人的思想也是存在差异的。这也是人作为个体而存在的理由，作为一个独立思想的理由。</p><p>外传的存在，不仅让本传的故事更加精彩，更重要的，是让读者在本传阅读完之后没有怅然若失之感。让我们明白，那些人的故事并没有结束，他们也会像普通人一般地活着。</p><p>爱恋着的插画集，就如同插画一般，点缀着生活，爱恋着世界。</p><h2 id="后传"><a href="#后传" class="headerlink" title="后传"></a>后传</h2><h3 id="青涩作家"><a href="#青涩作家" class="headerlink" title="青涩作家"></a>青涩作家</h3><p>有点……难说。如果不是《追想画廊 二》把我拯救回来，我估计当晚就死在厕所里了。用一个晚上结束了战斗，然后在床上辗转反侧。</p><p>虽然似乎是一个很美满的结局，在《爱恋插画集》中，琴吹最终释怀了心叶，追随了臣。而在《迈向神境的作家》，也<del>正面</del>暗示了心叶与远子的未来。可在《见习生》的结局中，那个唐突出现，而最终释怀的日阪菜乃，却似乎没能得到好的结果。我能理解美月的心思，谁都会喜欢大团圆的结局。所以才会出现雀宫快斗，一个以菜乃为初恋的高中生作家，却最终爱上了远子。</p><p><del>美月怎么这么喜欢姐弟恋啊。（恼</del></p><p>整本《青涩作家》内，从头至尾都没有出现过心叶的名字，倒是一直在提及井上美羽，而远子的许多小细节也能证明她与心叶确实如读者所愿的恋爱，但总归看得难受。因为对于快斗这一个人，读者完全不熟悉，却和远子打得如此火热，有些许胃疼，说老实话。</p><p>当然，我也说过，结局是美满的，远子最终和心叶订婚（后来解释是因为心叶吃醋了），而快斗由青涩作家转变为成熟的青年，正视自己的问题，与菜乃重逢，一切都走向正轨。</p><p>只是可惜，正传里的所有人物，除了心叶，远子和菜乃全都销声匿迹了。</p><p>不过，美月至少还是明白读者想要看到的是什么。</p><h3 id="追想长廊"><a href="#追想长廊" class="headerlink" title="追想长廊"></a>追想长廊</h3><p>摘录了《文学少女》从撰写以来到最后所有的图册，在把总共十六本看完之后阅读会让人不禁有深深的回忆之感。看到一张图以及它的出册而回想起它曾经出现过的地方，也算是对这部作品一种尊敬与热爱吧。</p><p>说起一些小细节，我其实还是觉得初稿里偏分的远子更加好看，包括有几个角色的初稿我觉得都比定稿要好看一些，不过这只是个人喜好的问题吧，就如同我是琴吹党，而全网流传的琴吹的同人图却不上五张。</p><p>可惜，被誉为最轻的轻小说却在十余年之后如此埋没。</p><p>说起最后的两个特别篇，第一个特别篇算是留下一个悬念，总是吊着读者的胃口，不让心叶和远子见面，而从流人的话中也体会到了，这两人有多么的契合。<del>远叶大法好</del>。</p><p>而第二个特别篇，才算是美月对读者的一个回应，证明了，作家没有背叛读者。虽说到这个时候，菜乃与快斗又突然没有了讯息，但我们都知道会发生什么，就如同在本传第八部的结尾，我们也知道心叶最终去迎接的人是谁一样，一切都无从知晓，一切又充满暗示。作家总是这样，让读者又爱又恨，正因为没有人写出我想要的故事，才会存在同人一说吧。</p><p>总之，感谢你，野村美月，为我带来了一场文学的盛宴；也感谢姜总，发掘了如此美妙的世界。</p><hr><p>在此立下 $\text{Flag}$ ，我会抽空写下《文学少女》的同人文章（虽然不知道会是多久）。</p>]]></content>
      
      
      <categories>
          
          <category> 记随影落 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 轻小说 </tag>
            
            <tag> 野村美月 </tag>
            
            <tag> 文学 </tag>
            
            <tag> 恋爱 </tag>
            
            <tag> 冒险 </tag>
            
            <tag> 校园 </tag>
            
            <tag> 治愈 </tag>
            
            <tag> 致郁 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Q-Tree系列</title>
      <link href="/Eternity/%E9%A2%98%E8%A7%A3/qtree/"/>
      <url>/Eternity/%E9%A2%98%E8%A7%A3/qtree/</url>
      
        <content type="html"><![CDATA[<p>树型结构最好的练习题。</p><span id="more"></span><h2 id="Q-Tree-Ⅰ"><a href="#Q-Tree-Ⅰ" class="headerlink" title="Q-Tree Ⅰ"></a>Q-Tree Ⅰ</h2><p>树链剖分维护边权，线段树区间最大值。</p><p><a href="https://www.luogu.com.cn/problem/P4114">P4114</a>，<a href="https://www.luogu.com.cn/problem/SP375">SP375</a></p><p>你以为是双倍经验？其实是双倍<strong>经验</strong>。</p><p>洛谷里的题而言，就是一个普普通通的边权挂点。但是，在 $SPOJ$ 里，你会发现提交 <code>c++</code> 语言的提交都显示 <code>waiting</code> ，而那些 $AC$ 了的，都用的是 <code>c</code> 语言。</p><p><del>所以为了拿到这双倍经验我还去学了一下 c 语言的语法</del>。</p><p><code>c</code> 语言语法如下：</p><ol><li><code>c</code> 语言中没有 <code>iostream</code> 和 <code>algorithm</code> 的头文件；</li><li>以 <code>c-</code> 开头的头文件需要换成 <code>-h</code> 的头文件，如 <code>cstdio</code> 换成 <code>stdio.h</code> 等；</li><li>不能使用 <code>const</code> 以及 <code>struct</code> 和 <code>template</code> ；</li><li>所以类似于 <code>max</code> 和 <code>swap</code> 之类的函数需要手写。</li></ol><p>这是这道题需要注意的。</p><details>    <summary>AC Code for C++ ver</summary><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;ctime&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iomanip&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stack&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;map&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> gh() getchar()</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> re register</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> db double</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ls p&lt;&lt;1</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> rs p&lt;&lt;1|1</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> ll;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN=<span class="number">1e5</span>+<span class="number">1</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> INF=<span class="number">0x7f7f7f7f</span>;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    x=<span class="number">0</span>;</span><br><span class="line">    <span class="type">char</span> ch=<span class="built_in">gh</span>(),t=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(ch&lt;<span class="string">&#x27;0&#x27;</span>||ch&gt;<span class="string">&#x27;9&#x27;</span>) t|=ch==<span class="string">&#x27;-&#x27;</span>,ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">while</span>(ch&gt;=<span class="string">&#x27;0&#x27;</span>&amp;&amp;ch&lt;=<span class="string">&#x27;9&#x27;</span>) x=(x&lt;&lt;<span class="number">3</span>)+(x&lt;&lt;<span class="number">1</span>)+(ch^<span class="number">48</span>),ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">if</span>(t) x=-x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T,<span class="keyword">class</span> ...T1&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x,T1 &amp;...x1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">read</span>(x),<span class="built_in">read</span>(x1...);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">checkMax</span><span class="params">(T &amp;x,T &amp;y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x&lt;y?x=y,<span class="number">1</span>:<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">checkMin</span><span class="params">(T &amp;x,T &amp;y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x&gt;y?x=y,<span class="number">1</span>:<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> N;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Graph</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> next,to,val;</span><br><span class="line">    <span class="built_in">Graph</span>(<span class="type">int</span> n=<span class="number">0</span>,<span class="type">int</span> t=<span class="number">0</span>,<span class="type">int</span> v=<span class="number">0</span>):<span class="built_in">next</span>(n),<span class="built_in">to</span>(t),<span class="built_in">val</span>(v)&#123;&#125;</span><br><span class="line">&#125;Edge[MAXN&lt;&lt;<span class="number">1</span>];</span><br><span class="line"><span class="type">int</span> Head[MAXN],Total,Idx[MAXN],Bck[MAXN];</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">addEdge</span><span class="params">(<span class="type">int</span> u,<span class="type">int</span> v,<span class="type">int</span> w)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Edge[++Total]=<span class="built_in">Graph</span>(Head[u],v,w);Head[u]=Total;</span><br><span class="line">    Edge[++Total]=<span class="built_in">Graph</span>(Head[v],u,w);Head[v]=Total;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> Fa[MAXN],Son[MAXN],Size[MAXN],Dep[MAXN],Path[MAXN];</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dfsTree</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> last)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Fa[x]=last,Size[x]=<span class="number">1</span>,Dep[x]=Dep[last]+<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> e=Head[x],v;e;e=Edge[e].next)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>((v=Edge[e].to)==last) <span class="keyword">continue</span>;</span><br><span class="line">        Path[v]=Edge[e].val;</span><br><span class="line">        <span class="built_in">dfsTree</span>(v,x);</span><br><span class="line">        Size[x]+=Size[v];</span><br><span class="line">        <span class="keyword">if</span>(!Son[x]||Size[Son[x]]&lt;Size[v]) Son[x]=v;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> Top[MAXN],Dfn[MAXN],Val[MAXN],Cnt;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dfs_Seg</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> topf)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Dfn[x]=++Cnt;</span><br><span class="line">    Val[Cnt]=Path[x],Top[x]=topf;</span><br><span class="line">    <span class="keyword">if</span>(!Son[x]) <span class="keyword">return</span> ;</span><br><span class="line">    <span class="built_in">dfs_Seg</span>(Son[x],topf);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> e=Head[x],v;e;e=Edge[e].next)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>((v=Edge[e].to)==Fa[x]||v==Son[x]) <span class="keyword">continue</span>;</span><br><span class="line">        <span class="built_in">dfs_Seg</span>(v,v);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">SegmentTree</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> l,r,val;</span><br><span class="line">&#125;Tree[MAXN&lt;&lt;<span class="number">2</span>];</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">pushUp</span><span class="params">(<span class="type">int</span> p)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Tree[p].val=<span class="built_in">max</span>(Tree[ls].val,Tree[rs].val);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">build</span><span class="params">(<span class="type">int</span> p,<span class="type">int</span> l,<span class="type">int</span> r)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Tree[p].l=l,Tree[p].r=r;</span><br><span class="line">    <span class="keyword">if</span>(l==r)</span><br><span class="line">    &#123;</span><br><span class="line">        Tree[p].val=Val[l];</span><br><span class="line">        <span class="keyword">return</span> ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> mid=(l+r)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">    <span class="built_in">build</span>(ls,l,mid),<span class="built_in">build</span>(rs,mid+<span class="number">1</span>,r);</span><br><span class="line">    <span class="built_in">pushUp</span>(p);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">modify</span><span class="params">(<span class="type">int</span> p,<span class="type">int</span> d,<span class="type">int</span> k)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(d&lt;=Tree[p].l&amp;&amp;Tree[p].r&lt;=d)</span><br><span class="line">    &#123;</span><br><span class="line">        Tree[p].val=k;</span><br><span class="line">        <span class="keyword">return</span> ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> mid=(Tree[p].l+Tree[p].r)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span>(d&lt;=mid) <span class="built_in">modify</span>(ls,d,k);</span><br><span class="line">    <span class="keyword">if</span>(mid&lt;d) <span class="built_in">modify</span>(rs,d,k);</span><br><span class="line">    <span class="built_in">pushUp</span>(p);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">query</span><span class="params">(<span class="type">int</span> p,<span class="type">int</span> l,<span class="type">int</span> r)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(l&lt;=Tree[p].l&amp;&amp;Tree[p].r&lt;=r) <span class="keyword">return</span> Tree[p].val;</span><br><span class="line">    <span class="type">int</span> val=-INF;</span><br><span class="line">    <span class="type">int</span> mid=(Tree[p].l+Tree[p].r)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span>(l&lt;=mid) val=<span class="built_in">max</span>(val,<span class="built_in">query</span>(ls,l,r));</span><br><span class="line">    <span class="keyword">if</span>(mid&lt;r) val=<span class="built_in">max</span>(val,<span class="built_in">query</span>(rs,l,r));</span><br><span class="line">    <span class="keyword">return</span> val;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">queryPath</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> res=-INF;</span><br><span class="line">    <span class="keyword">while</span>(Top[x]!=Top[y])</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(Dep[Top[x]]&lt;Dep[Top[y]]) <span class="built_in">swap</span>(x,y);</span><br><span class="line">        res=<span class="built_in">max</span>(res,<span class="built_in">query</span>(<span class="number">1</span>,Dfn[Top[x]],Dfn[x]));</span><br><span class="line">        x=Fa[Top[x]];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(Dep[x]&gt;Dep[y]) <span class="built_in">swap</span>(x,y);</span><br><span class="line">    res=<span class="built_in">max</span>(res,<span class="built_in">query</span>(<span class="number">1</span>,Dfn[x]+<span class="number">1</span>,Dfn[y]));</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">char</span> Str[<span class="number">256</span>];</span><br><span class="line"><span class="type">int</span> x,y;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// freopen(&quot;tree-chain.in&quot;,&quot;r&quot;,stdin);</span></span><br><span class="line">    <span class="comment">// freopen(&quot;tree-chain.out&quot;,&quot;w&quot;,stdout);</span></span><br><span class="line">    <span class="built_in">read</span>(N);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">2</span>,u,v,w;i&lt;=N;++i)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">read</span>(u,v,w);</span><br><span class="line">        <span class="built_in">addEdge</span>(u,v,w);</span><br><span class="line">        Bck[i<span class="number">-1</span>]=u,Idx[i<span class="number">-1</span>]=v;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">dfsTree</span>(<span class="number">1</span>,<span class="number">0</span>);</span><br><span class="line">    <span class="built_in">dfs_Seg</span>(<span class="number">1</span>,<span class="number">1</span>);</span><br><span class="line">    <span class="built_in">build</span>(<span class="number">1</span>,<span class="number">1</span>,N);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;N;++i)</span><br><span class="line">        Idx[i]=(Bck[i]==Fa[Idx[i]]?Idx[i]:Bck[i]);</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>,Str+<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">while</span>(Str[<span class="number">1</span>]!=<span class="string">&#x27;D&#x27;</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">read</span>(x,y);</span><br><span class="line">        <span class="keyword">if</span>(Str[<span class="number">1</span>]==<span class="string">&#x27;Q&#x27;</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span>(x==y) <span class="built_in">puts</span>(<span class="string">&quot;0&quot;</span>);</span><br><span class="line">            <span class="keyword">else</span> <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,<span class="built_in">queryPath</span>(x,y));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="built_in">modify</span>(<span class="number">1</span>,Dfn[Idx[x]],y);</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>,Str+<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/*for(int i=1;i&lt;=N;++i) printf(&quot;%d &quot;,Dfn[i]);</span></span><br><span class="line"><span class="comment">    puts(&quot;&quot;);</span></span><br><span class="line"><span class="comment">    for(int i=1;i&lt;N;++i) printf(&quot;%d &quot;,Idx[i]);*/</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">3</span></span><br><span class="line"><span class="comment">1 2 1</span></span><br><span class="line"><span class="comment">2 3 2</span></span><br><span class="line"><span class="comment">QUERY 1 2</span></span><br><span class="line"><span class="comment">CHANGE 1 3</span></span><br><span class="line"><span class="comment">QUERY 1 2</span></span><br><span class="line"><span class="comment">DONE</span></span><br><span class="line"><span class="comment">6</span></span><br><span class="line"><span class="comment">1 2 3</span></span><br><span class="line"><span class="comment">1 3 1</span></span><br><span class="line"><span class="comment">3 4 2</span></span><br><span class="line"><span class="comment">3 5 5</span></span><br><span class="line"><span class="comment">5 6 4</span></span><br><span class="line"><span class="comment">QUERY 4 2</span></span><br><span class="line"><span class="comment">CHANGE 2 6</span></span><br><span class="line"><span class="comment">QUERY 1 6</span></span><br><span class="line"><span class="comment">QUERY 5 4</span></span><br><span class="line"><span class="comment">CHANGE 4 2</span></span><br><span class="line"><span class="comment">QUERY 4 6</span></span><br><span class="line"><span class="comment">QUERY 2 6 </span></span><br><span class="line"><span class="comment">DONE </span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure></details><hr><details>    <summary>AC Code for c ver.</summary><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;math.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> gh() getchar()</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> re register</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ls p&lt;&lt;1</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> rs p&lt;&lt;1|1</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MAXN 100001</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> INF 0x7f7f7f7f</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> ll;</span><br><span class="line"><span class="type">int</span> N,Test;</span><br><span class="line"><span class="type">int</span> Next[MAXN&lt;&lt;<span class="number">1</span>],To[MAXN&lt;&lt;<span class="number">1</span>],Wt[MAXN&lt;&lt;<span class="number">1</span>];</span><br><span class="line"><span class="type">int</span> Head[MAXN],Total,Idx[MAXN],Bck[MAXN];</span><br><span class="line"><span class="type">int</span> Fa[MAXN],Son[MAXN],Siz[MAXN],Dep[MAXN],Path[MAXN];</span><br><span class="line"><span class="type">int</span> Top[MAXN],Dfn[MAXN],Val[MAXN],Cnt;</span><br><span class="line"><span class="type">int</span> L[MAXN&lt;&lt;<span class="number">2</span>],R[MAXN&lt;&lt;<span class="number">2</span>],val[MAXN&lt;&lt;<span class="number">2</span>];</span><br><span class="line"><span class="type">int</span> x,y;</span><br><span class="line"><span class="type">char</span> Str[<span class="number">256</span>];</span><br><span class="line"><span class="type">int</span> <span class="title function_">max</span><span class="params">(<span class="type">int</span> a,<span class="type">int</span> b)</span>&#123; <span class="keyword">return</span> a&gt;b?a:b; &#125;</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> swap(A, B)   \</span></span><br><span class="line"><span class="meta">    &#123;                \</span></span><br><span class="line"><span class="meta">        int __T = A; \</span></span><br><span class="line"><span class="meta">        A = B;       \</span></span><br><span class="line"><span class="meta">        B = __T;     \</span></span><br><span class="line"><span class="meta">    &#125;</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">addEdge</span><span class="params">(<span class="type">int</span> u,<span class="type">int</span> v,<span class="type">int</span> w)</span></span><br><span class="line">&#123;</span><br><span class="line">    Next[++Total]=Head[u];</span><br><span class="line">    To[Total]=v;</span><br><span class="line">    Wt[Total]=w;</span><br><span class="line">    Head[u]=Total;</span><br><span class="line">    Next[++Total]=Head[v];</span><br><span class="line">    To[Total]=u;</span><br><span class="line">    Wt[Total]=w;</span><br><span class="line">    Head[v]=Total;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">void</span> <span class="title function_">dfsTree</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> last)</span></span><br><span class="line">&#123;</span><br><span class="line">    Fa[x]=last,Siz[x]=<span class="number">1</span>,Dep[x]=Dep[last]+<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> e=Head[x],v;e;e=Next[e])</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>((v=To[e])==last) <span class="keyword">continue</span>;</span><br><span class="line">        Path[v]=Wt[e];</span><br><span class="line">        dfsTree(v,x);</span><br><span class="line">        Siz[x]+=Siz[v];</span><br><span class="line">        <span class="keyword">if</span>(!Son[x]||Siz[Son[x]]&lt;Siz[v]) Son[x]=v;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">void</span> <span class="title function_">dfs_Seg</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> topf)</span></span><br><span class="line">&#123;</span><br><span class="line">    Dfn[x]=++Cnt;</span><br><span class="line">    Val[Cnt]=Path[x],Top[x]=topf;</span><br><span class="line">    <span class="keyword">if</span>(!Son[x]) <span class="keyword">return</span> ;</span><br><span class="line">    dfs_Seg(Son[x],topf);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> e=Head[x],v;e;e=Next[e])</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>((v=To[e])==Fa[x]||v==Son[x]) <span class="keyword">continue</span>;</span><br><span class="line">        dfs_Seg(v,v);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">void</span> <span class="title function_">pushUp</span><span class="params">(<span class="type">int</span> p)</span></span><br><span class="line">&#123;</span><br><span class="line">    val[p]=max(val[ls],val[rs]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">void</span> <span class="title function_">build</span><span class="params">(<span class="type">int</span> p,<span class="type">int</span> l,<span class="type">int</span> r)</span></span><br><span class="line">&#123;</span><br><span class="line">    L[p]=l,R[p]=r;</span><br><span class="line">    <span class="keyword">if</span>(l==r)</span><br><span class="line">    &#123;</span><br><span class="line">        val[p]=Val[l];</span><br><span class="line">        <span class="keyword">return</span> ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> mid=(l+r)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">    build(ls,l,mid),build(rs,mid+<span class="number">1</span>,r);</span><br><span class="line">    pushUp(p);</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">void</span> <span class="title function_">modify</span><span class="params">(<span class="type">int</span> p,<span class="type">int</span> d,<span class="type">int</span> k)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span>(d&lt;=L[p]&amp;&amp;R[p]&lt;=d)</span><br><span class="line">    &#123;</span><br><span class="line">        val[p]=k;</span><br><span class="line">        <span class="keyword">return</span> ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> mid=(L[p]+R[p])&gt;&gt;<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span>(d&lt;=mid) modify(ls,d,k);</span><br><span class="line">    <span class="keyword">if</span>(mid&lt;d) modify(rs,d,k);</span><br><span class="line">    pushUp(p);</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> <span class="title function_">query</span><span class="params">(<span class="type">int</span> p,<span class="type">int</span> l,<span class="type">int</span> r)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span>(l&lt;=L[p]&amp;&amp;R[p]&lt;=r) <span class="keyword">return</span> val[p];</span><br><span class="line">    <span class="type">int</span> res=-INF;</span><br><span class="line">    <span class="type">int</span> mid=(L[p]+R[p])&gt;&gt;<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span>(l&lt;=mid) res=max(res,query(ls,l,r));</span><br><span class="line">    <span class="keyword">if</span>(mid&lt;r) res=max(res,query(rs,l,r));</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> <span class="title function_">queryPath</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> y)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> res=-INF;</span><br><span class="line">    <span class="keyword">while</span>(Top[x]!=Top[y])</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(Dep[Top[x]]&lt;Dep[Top[y]]) swap(x,y);</span><br><span class="line">        res=max(res,query(<span class="number">1</span>,Dfn[Top[x]],Dfn[x]));</span><br><span class="line">        x=Fa[Top[x]];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(Dep[x]&gt;Dep[y]) swap(x,y);</span><br><span class="line">    res=max(res,query(<span class="number">1</span>,Dfn[x]+<span class="number">1</span>,Dfn[y]));</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">void</span> <span class="title function_">init</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    Cnt=Total=<span class="number">0</span>;</span><br><span class="line">    <span class="built_in">memset</span>(Head,<span class="number">0</span>,<span class="keyword">sizeof</span>(Head));</span><br><span class="line">    <span class="built_in">memset</span>(Son,<span class="number">0</span>,<span class="keyword">sizeof</span>(Son));</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// freopen(&quot;tree-chain.in&quot;,&quot;r&quot;,stdin);</span></span><br><span class="line">    <span class="comment">// freopen(&quot;tree-chain.out&quot;,&quot;w&quot;,stdout);</span></span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;Test);</span><br><span class="line">    <span class="keyword">while</span>(Test--)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;N);</span><br><span class="line">        init();</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">2</span>,u,v,w;i&lt;=N;++i)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">scanf</span>(<span class="string">&quot;%d%d%d&quot;</span>,&amp;u,&amp;v,&amp;w);</span><br><span class="line">            addEdge(u,v,w);</span><br><span class="line">            Bck[i<span class="number">-1</span>]=u,Idx[i<span class="number">-1</span>]=v;</span><br><span class="line">        &#125;</span><br><span class="line">        dfsTree(<span class="number">1</span>,<span class="number">0</span>);</span><br><span class="line">        dfs_Seg(<span class="number">1</span>,<span class="number">1</span>);</span><br><span class="line">        build(<span class="number">1</span>,<span class="number">1</span>,N);</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;N;++i)</span><br><span class="line">            Idx[i]=(Bck[i]==Fa[Idx[i]]?Idx[i]:Bck[i]);</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>,Str+<span class="number">1</span>);</span><br><span class="line">        <span class="keyword">while</span>(Str[<span class="number">1</span>]!=<span class="string">&#x27;D&#x27;</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>,&amp;x,&amp;y);</span><br><span class="line">            <span class="keyword">if</span>(Str[<span class="number">1</span>]==<span class="string">&#x27;Q&#x27;</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">if</span>(x==y) <span class="built_in">puts</span>(<span class="string">&quot;0&quot;</span>);</span><br><span class="line">                <span class="keyword">else</span> <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,queryPath(x,y));</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> modify(<span class="number">1</span>,Dfn[Idx[x]],y);</span><br><span class="line">            <span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>,Str+<span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">3</span></span><br><span class="line"><span class="comment">1 2 1</span></span><br><span class="line"><span class="comment">2 3 2</span></span><br><span class="line"><span class="comment">QUERY 1 2</span></span><br><span class="line"><span class="comment">CHANGE 1 3</span></span><br><span class="line"><span class="comment">QUERY 1 2</span></span><br><span class="line"><span class="comment">DONE</span></span><br><span class="line"><span class="comment">6</span></span><br><span class="line"><span class="comment">1 2 3</span></span><br><span class="line"><span class="comment">1 3 1</span></span><br><span class="line"><span class="comment">3 4 2</span></span><br><span class="line"><span class="comment">3 5 5</span></span><br><span class="line"><span class="comment">5 6 4</span></span><br><span class="line"><span class="comment">QUERY 4 2</span></span><br><span class="line"><span class="comment">CHANGE 2 6</span></span><br><span class="line"><span class="comment">QUERY 1 6</span></span><br><span class="line"><span class="comment">QUERY 5 4</span></span><br><span class="line"><span class="comment">CHANGE 4 2</span></span><br><span class="line"><span class="comment">QUERY 4 6</span></span><br><span class="line"><span class="comment">QUERY 2 6 </span></span><br><span class="line"><span class="comment">DONE </span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure></details><hr><h2 id="Q-Tree-Ⅱ"><a href="#Q-Tree-Ⅱ" class="headerlink" title="Q-Tree Ⅱ"></a>Q-Tree Ⅱ</h2><hr><h2 id="Q-Tree-Ⅲ"><a href="#Q-Tree-Ⅲ" class="headerlink" title="Q-Tree Ⅲ"></a>Q-Tree Ⅲ</h2><p>和 <a href="https://www.luogu.com.cn/problem/P4092">P4092 [HEOI2016/TJOI2016]树</a> 有些相似。但是这道题可以反转操作。</p><p>逛了一圈题解，结果发现没几个人写的是线段树，甚至还有写 $\text{Link-Cut Tree}$ 的，全是巨佬。</p><p>$\text{stO 神犇 Orz}$</p><p>所以我也写的是树剖维护 <code>std::set</code> ，将每一条链里黑颜色的结点全部存到其链顶，每次取最近的。所以修改操作就一个 <code>insert</code> 一个 <code>erase</code> 就完事儿了。</p><p>然后查询，直接暴力跳即可。</p><details>    <summary>AC Code</summary><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;ctime&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iomanip&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stack&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;map&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;set&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> gh() getchar()</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> re register</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> ll;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN=<span class="number">1e5</span>+<span class="number">1</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> INF=<span class="number">0x3f3f3f3f</span>;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    x=<span class="number">0</span>;</span><br><span class="line">    <span class="type">char</span> ch=<span class="built_in">gh</span>(),t=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(ch&lt;<span class="string">&#x27;0&#x27;</span>||ch&gt;<span class="string">&#x27;9&#x27;</span>) t|=ch==<span class="string">&#x27;-&#x27;</span>,ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">while</span>(ch&gt;=<span class="string">&#x27;0&#x27;</span>&amp;&amp;ch&lt;=<span class="string">&#x27;9&#x27;</span>) x=(x&lt;&lt;<span class="number">3</span>)+(x&lt;&lt;<span class="number">1</span>)+(ch^<span class="number">48</span>),ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">if</span>(t) x=-x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T,<span class="keyword">class</span> ...T1&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x,T1 &amp;...x1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">read</span>(x),<span class="built_in">read</span>(x1...);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">write</span><span class="params">(T x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(x&lt;<span class="number">0</span>) <span class="built_in">putchar</span>(<span class="string">&#x27;-&#x27;</span>),x=-x;</span><br><span class="line">    <span class="keyword">if</span>(x&gt;<span class="number">9</span>) <span class="built_in">write</span>(x/<span class="number">10</span>);</span><br><span class="line">    <span class="built_in">putchar</span>(x%<span class="number">10</span>+<span class="string">&#x27;0&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">checkMax</span><span class="params">(T &amp;x,T &amp;y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x&lt;y?x=y,<span class="number">1</span>:<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">checkMin</span><span class="params">(T &amp;x,T &amp;y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x&gt;y?x=y,<span class="number">1</span>:<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> N,Q;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">TC</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> next,to;</span><br><span class="line">&#125;Edge[MAXN&lt;&lt;<span class="number">1</span>];</span><br><span class="line"><span class="type">int</span> Head[MAXN],Total;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">addEdge</span><span class="params">(<span class="type">int</span> u,<span class="type">int</span> v)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Edge[++Total]=(TC)&#123;Head[u],v&#125;;Head[u]=Total;</span><br><span class="line">    Edge[++Total]=(TC)&#123;Head[v],u&#125;;Head[v]=Total;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> Fa[MAXN],Dep[MAXN],Size[MAXN],Son[MAXN];</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dfsTree</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> last)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Fa[x]=last,Dep[x]=Dep[last]+<span class="number">1</span>,Size[x]=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> e=Head[x],v;e;e=Edge[e].next)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>((v=Edge[e].to)==last) <span class="keyword">continue</span>;</span><br><span class="line">        <span class="built_in">dfsTree</span>(v,x);</span><br><span class="line">        Size[x]+=Size[v];</span><br><span class="line">        <span class="keyword">if</span>(!Son[x]||Size[v]&gt;Size[Son[x]]) Son[x]=v;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> Top[MAXN],Dfn[MAXN],Bck[MAXN],Cnt;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dfsSeg</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> topf)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Top[x]=topf,Dfn[++Cnt]=x;Bck[x]=Cnt;</span><br><span class="line">    <span class="keyword">if</span>(!Son[x]) <span class="keyword">return</span> ;</span><br><span class="line">    <span class="built_in">dfsSeg</span>(Son[x],topf);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> e=Head[x],v;e;e=Edge[e].next)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>((v=Edge[e].to)==Fa[x]||v==Son[x]) <span class="keyword">continue</span>;</span><br><span class="line">        <span class="built_in">dfsSeg</span>(v,v);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">bool</span> Col[MAXN];</span><br><span class="line"><span class="type">int</span> opt,Qx;</span><br><span class="line">std::set&lt;<span class="type">int</span>&gt;St[MAXN];</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// freopen(&quot;tree-chain.in&quot;,&quot;r&quot;,stdin);</span></span><br><span class="line">    <span class="comment">// freopen(&quot;tree-chain.out&quot;,&quot;w&quot;,stdout);</span></span><br><span class="line">    <span class="built_in">read</span>(N,Q);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">2</span>,u,v;i&lt;=N;++i)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">read</span>(u,v);<span class="built_in">addEdge</span>(u,v);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">dfsTree</span>(<span class="number">1</span>,<span class="number">0</span>),<span class="built_in">dfsSeg</span>(<span class="number">1</span>,<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">while</span>(Q--)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">read</span>(opt,Qx);</span><br><span class="line">        <span class="keyword">if</span>(opt==<span class="number">1</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="type">int</span> res=INF;</span><br><span class="line">            <span class="keyword">while</span>(Qx)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="type">int</span> k=*St[Top[Qx]].<span class="built_in">begin</span>();</span><br><span class="line">                <span class="keyword">if</span>(St[Top[Qx]].<span class="built_in">size</span>())</span><br><span class="line">                    <span class="keyword">if</span>(Dep[Dfn[k]]&lt;=Dep[Qx]) res=Dfn[k];</span><br><span class="line">                Qx=Fa[Top[Qx]];</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="built_in">write</span>(res==INF?<span class="number">-1</span>:res),<span class="built_in">puts</span>(<span class="string">&quot;&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            Col[Qx]^=<span class="number">1</span>;</span><br><span class="line">            <span class="keyword">if</span>(Col[Qx]) St[Top[Qx]].<span class="built_in">insert</span>(Bck[Qx]);</span><br><span class="line">            <span class="keyword">else</span> St[Top[Qx]].<span class="built_in">erase</span>(Bck[Qx]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">9 8</span></span><br><span class="line"><span class="comment">1 2</span></span><br><span class="line"><span class="comment">1 3</span></span><br><span class="line"><span class="comment">2 4</span></span><br><span class="line"><span class="comment">2 9</span></span><br><span class="line"><span class="comment">5 9</span></span><br><span class="line"><span class="comment">7 9</span></span><br><span class="line"><span class="comment">8 9</span></span><br><span class="line"><span class="comment">6 8</span></span><br><span class="line"><span class="comment">1 3</span></span><br><span class="line"><span class="comment">0 8</span></span><br><span class="line"><span class="comment">1 6</span></span><br><span class="line"><span class="comment">1 7</span></span><br><span class="line"><span class="comment">0 2</span></span><br><span class="line"><span class="comment">1 9</span></span><br><span class="line"><span class="comment">0 2</span></span><br><span class="line"><span class="comment">1 9 </span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure></details><hr>]]></content>
      
      
      <categories>
          
          <category> 题解 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 优化 </tag>
            
            <tag> RMQ </tag>
            
            <tag> String </tag>
            
            <tag> 图论 </tag>
            
            <tag> 搜索 </tag>
            
            <tag> dfs </tag>
            
            <tag> 平衡树 </tag>
            
            <tag> 数据结构 </tag>
            
            <tag> 二分 </tag>
            
            <tag> 线段树 </tag>
            
            <tag> 树状数组 </tag>
            
            <tag> 树型结构 </tag>
            
            <tag> Dfs序 </tag>
            
            <tag> LCA </tag>
            
            <tag> 树链剖分 </tag>
            
            <tag> Splay </tag>
            
            <tag> STL </tag>
            
            <tag> 分治 </tag>
            
            <tag> 单调栈 </tag>
            
            <tag> 递归 </tag>
            
            <tag> 差分约束 </tag>
            
            <tag> 倍增 </tag>
            
            <tag> Link-Cut Tree </tag>
            
            <tag> 动态树 </tag>
            
            <tag> set </tag>
            
            <tag> 树上差分 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>E.N.D</title>
      <link href="/Eternity/Until-The-End/my-senior-high-school-life/"/>
      <url>/Eternity/Until-The-End/my-senior-high-school-life/</url>
      
        <content type="html"><![CDATA[<div class="hbe hbe-container" id="hexo-blog-encrypt" data-wpm="Oh, this is an invalid password. Check and try again, please." data-whm="OOPS, these decrypted content may changed, but you can still have a look.">  <script id="hbeData" type="hbeData" data-hmacdigest="e3c70d29a2047a9533a75abaf7134313114fe54cd3da193ddce92741848cf8e5">67a1534bda8b9fab0136ec08af9f8eb10e034c41a34e3d859e558bda8798431be1e3783a2e5fc5d52bfe124d90b7bb318f658b751ffcad7cbecdb7c0064d8b791dccd633d385c8dc4974347ae8de8ba47d2fc5e84d63020ab047bb5205147aaf667554f57f1c7f6cdc8db153870f5795e40122cf9e2902816a5f1c95d4499a81e6066162340db78ae727b5ff740094c7691752130505b87f2d04dd6472dc6149427a119678ea96bc52206e09a34d36690d8b9d36c42d744f45cf9762916410407e3e2a850b43a1e408c2eef125b85561ad8baa24b4cca14bc6a51a68f089de3cc7cc6b849172f5cc6d40150bb4f96fe356309c798d2ee966d9de1e381f776bda7d6dd7de86114d42281ca34d3723a8040b6d320dcb1baaa6cfb1ab1aa9c365fe257fa8bc83ea82bd533ddbc9c60d097a5ee8f41a29af0055e0d4a6b4132ed0ef26b491c9e1b75bf538a5a9a08c75b43b39d20d9670f5dd13286cbe1a6973264dfe0925fd1400f5a2bbfa7ef040ca8d654255b07ca9e01fd0ee95bf01125b83c4d9b2e5b31a6881ffdad19a53e7426fdcc10112d05be8b2bb1b92e74a5d61fce18f3d7c5dad192778e1680ede571f8b609f4cf79fd92b09054348fd65fb5baefb6cadf1e7ac55a86fcb35054f61fe0ae7ba92c6837ec26e199da3f922b54c78913db8a7d3413bc4e722dedbc405e47be7fa02afed335437df32a5c2c699a7b77e42f6d294735a8803d5369327dda3700f52050a2ff1550a951db0ff4da15f407055907a48688fab0c05c2045279aadbe759317175f980fbaf2a61b139e3b7d12e0b95b2dfcd0d598f42f14305b6a97505433d98753665d39eda91f0b825791c9954594a8756f7f536890826c84e9cca2f52f315ee42db69a96e2ffbfe515fab5a4b9078d2a0fa7ec480fec31246042e88c03b9c4a26e07cf4ff917790b30d7fc88b875f5225ba4565f9422a1b3ad7c4f3727cbc9ed24c2d71afe3c6b6c424bf633ecdfb61ad5a39b93a6bbe4650ca4fa40758eb47ed0ab05af913059c291bf915831d38cfb1fbb3b904ee49a9fbf470c0d33e27e55923b0386446fc84563a3993358f4098caa30a360e5e1dc2c63e9276c6f55034e7c843625bff08239696e480d77debb7872c02d0c0ecf868a279ddf148d0877a66b2100a6237ab6e2b578699c4f7d51d550d1a4ed41ef41858b607c31c33254cd965d5075e4509d54dc107cf9d7233c3e39d10c0cdf0ba2724719e8ad0b01a942b40e994dd9e81752755c6a950a1e7fc4c394070a0d6b001bab7ab56b0daca1ddd6c86785c7bb79df19653c80cb3c38dc7cdb5e21845cfa0d041fecd12f652a7b94a53c5cd311a2ae82860064195f38dcc1cec3fde8abb1d4596af6c62f40f48e4eb349e889c0ef2213191139813a21a3b448fc506652a3e30ae24831a1f2a57d9062a95ce3a263dcdcf160493c65b7e1cc277d9fb2a785624e549198e0b313d3cf309c922bd9c014205b328214d9adcbe32ad339a45fc4880ae88d4d1bbdc67a4b30833c7f7037f908b2d6382262b57b02b7cef70723fd366c62a5fe150bb20c3059df207dd154d0016f65fbfbd58095d1e46fe7417aa155dbcb1d23cbecce43ed23885dc0c9a0211afedce6def60d5560d7c01e36c1c57561f2197225a813646701c2c7e2a915f0ec3dcf735b86d5e74b02238f09bd55cd3d9c44103379df833bfeb20e25199a09a6f1c769b4346f9e5ca0e8b971d69c4c7bc61eafce4940996ac4d8d109da571d8391a6676cda7dfb492b8a884586d81166c26f22a70168d931c01b4670f34eb18ddf1881bd083a3c76a261dd1f65423b276de826f9702f280a8bb5a39128f5c6af189a6ebea15ae61e88c6b105418a44e7f13e05a0188a9fa31e06497174e6c2eade04a</script>  <div class="hbe hbe-content">    <div class="hbe hbe-input hbe-input-xray">      <input class="hbe hbe-input-field hbe-input-field-xray" type="password" id="hbePass">      <label class="hbe hbe-input-label hbe-input-label-xray" for="hbePass">        <span class="hbe hbe-input-label-content hbe-input-label-content-xray">Eternalにはいくつかの秘密があります。</span>      </label>      <svg class="hbe hbe-graphic hbe-graphic-xray" width="300%" height="100%" viewBox="0 0 1200 60" preserveAspectRatio="none">        <path d="M0,56.5c0,0,298.666,0,399.333,0C448.336,56.5,513.994,46,597,46c77.327,0,135,10.5,200.999,10.5c95.996,0,402.001,0,402.001,0"></path>        <path d="M0,2.5c0,0,298.666,0,399.333,0C448.336,2.5,513.994,13,597,13c77.327,0,135-10.5,200.999-10.5c95.996,0,402.001,0,402.001,0"></path>      </svg>    </div>  </div></div><script data-pjax src="/Eternity/lib/hbe.js"></script><link href="/Eternity/css/hbe.style.css" rel="stylesheet" type="text/css">]]></content>
      
      
      <categories>
          
          <category> Until The End </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>树链剖分&amp;树上差分</title>
      <link href="/Eternity/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/OI/tree-chain-segmentation/"/>
      <url>/Eternity/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/OI/tree-chain-segmentation/</url>
      
        <content type="html"><![CDATA[<p>“枷锁层深纵横，末路穷途糜烂。”</p><span id="more"></span><h1 id="树链剖分"><a href="#树链剖分" class="headerlink" title="树链剖分"></a>树链剖分</h1><p>实质：将一棵树剖分成若干条链，并使用数据结构去优化维护，以达到 $\mathcal O(\log n)$ 的时间复杂度。是一些数据结构或者算法在树上的推广。</p><h2 id="常用方法"><a href="#常用方法" class="headerlink" title="常用方法"></a>常用方法</h2><h3 id="轻重链剖分-启发式剖分"><a href="#轻重链剖分-启发式剖分" class="headerlink" title="轻重链剖分/启发式剖分"></a>轻重链剖分/启发式剖分</h3><p>给出定义：将树分成<strong>轻边</strong>和<strong>重边</strong>，对于一个节点 $u$ 有函数 $size[u]$ 表示以 $u$ 为根节点的子树节点个数。那么有一个节点 $u$ 有 $\forall v,c(u,v)\in E$ ，而 $size[v]=\max\{size[u.son]\}$ ，则 $c(u,v)$ 为重边，而 $c(u,u.son),u.son\ne v$ 为轻边。</p><p>有下列性质：</p><ul><li>$c’(u,v)$ 为轻边，则有 $size[v]\le \frac{size[u]}{2}$ ；</li><li>从 $root$ 到任意一点的路径上，不超过 $\mathcal O(\log n)$ 条轻边数和重链数。</li></ul><p>另外：</p><ul><li>重儿子：与父节点以重边相连的节点，也是子树节点最多的节点。</li><li>重边：定义如上。</li><li>重链：全部由重边构成的路径（一个节点也是一条重链）。</li><li>轻儿子：一个节点除重儿子外的所有子节点。</li><li>轻边：一个节点到其轻儿子的边。</li></ul><p><img src="https://oi-wiki.org/graph/images/hld.png" alt="img"></p><p>有一个性质：</p><p>一棵树的重心一定在这棵树的重链（由根结点及其重儿子组成的链）上。</p><p>对于一个大小为 $n$ 的树与任意一个树中结点 $c$，称 $c$ 是该树的<strong>重心</strong>当且仅当在树中删去 $c$ 及与它关联的边后，分裂出的所有子树的大小均<strong>不超过</strong> $\lfloor \frac{n}{2} \rfloor$（其中 $\lfloor x \rfloor$ 是下取整函数）。对于包含至少一个结点的树，它的重心只可能有 $1$ 或 $2$ 个。</p><h3 id="节点信息"><a href="#节点信息" class="headerlink" title="节点信息"></a>节点信息</h3><p>$fa[x]$ 表示 $x$ 的父节点。</p><p>$dep[x]$ 表示 $x$ 的深度。</p><p>$size[x]$ 表示以 $x$ 为根的子树的节点数。</p><p>$son[x]$ 表示 $x$ 的重儿子。</p><p>$top[x]$ 表示 $x$ 所在重链的顶部节点编号。</p><p>$seg[x]$ 表示 $x$ 在线段树中的编号（如果以线段树维护）。</p><p>$rev[x]$ 表示线段树中编号为 $x$ 的节点在原树中对应的节点编号。</p><h2 id="操作"><a href="#操作" class="headerlink" title="操作"></a>操作</h2><h3 id="初始化"><a href="#初始化" class="headerlink" title="初始化"></a>初始化</h3><p>首先一遍 <code>dfs(int x,int last)</code> 处理出 $fa[],dep[],size[],son[]$ 等信息，类似于树型 dp 。</p><p>然后第二遍 <code>dfs(int x,int last)</code> 处理出 $seg[],top[],rev[]$ 等信息。</p><p>第一遍 $dfs$ ：</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">dfsTree</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> last,<span class="type">int</span> depth)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Pt[x].size=<span class="number">1</span>,Pt[x].fa=last;</span><br><span class="line">    Pt[x].dep=depth;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> e=Head[x],v;e;e=Edge[e].next)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>((v=Edge[e].to)==last) <span class="keyword">continue</span>;</span><br><span class="line">        <span class="built_in">dfsTree</span>(v,x,depth+<span class="number">1</span>);</span><br><span class="line">        Pt[x].size+=Pt[v].size;</span><br><span class="line">        <span class="keyword">if</span>(Pt[v].size&gt;Pt[Pt[x].son].size) Pt[x].son=v;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>第二遍 $dfs$ ：</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">dfsDfn</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> topf)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Dfn[x]=++Cnt;<span class="comment">//树的dfs序，也就是映射到线段树内的编号</span></span><br><span class="line">    Wgt[Cnt]=val[x];<span class="comment">//是排序之后对应的值，也就是映射到线段树内树的点权值</span></span><br><span class="line">    Pt[x].top=topf;</span><br><span class="line">    <span class="keyword">if</span>(!Pt[x].son) <span class="keyword">return</span> ;</span><br><span class="line">    <span class="built_in">dfsDfn</span>(Pt[x].son,topf);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> e=Head[x],v;e;e=Edge[e].next)</span><br><span class="line">    &#123;</span><br><span class="line">        v=Edge[e].to;</span><br><span class="line">        <span class="keyword">if</span>(v==Pt[x].fa||v==Pt[x].son) <span class="keyword">continue</span>;</span><br><span class="line">        <span class="built_in">dfsDfn</span>(v,v);<span class="comment">//每一个轻儿子都有一条从自己开始的重链</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="映射"><a href="#映射" class="headerlink" title="映射"></a>映射</h3><p><strong>映射</strong>指的是将整个树链映射到所对应的数据结构内，可以是 BIT 或者 Segment Tree 甚至是 Splay 等平衡树，视题目而定。</p><p><a href="https://violeteternal.github.io/Eternity/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/OI/segment-tree/">线段树不太详解</a></p><p>接下来就是常规的线段树操作：</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">SegmentTree</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> val,size,tag,l,r;</span><br><span class="line">&#125;Tree[MAXN&lt;&lt;<span class="number">2</span>];</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">pushUp</span><span class="params">(<span class="type">int</span> p)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Tree[p].val=(Tree[p&lt;&lt;<span class="number">1</span>].val+Tree[p&lt;&lt;<span class="number">1</span>|<span class="number">1</span>].val)%Mod;</span><br><span class="line">&#125;<span class="comment">//向上传递</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">pushDown</span><span class="params">(<span class="type">int</span> p)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(Tree[p].tag)</span><br><span class="line">    &#123;</span><br><span class="line">        Tree[p&lt;&lt;<span class="number">1</span>].val=(Tree[p&lt;&lt;<span class="number">1</span>].val+Tree[p].tag*Tree[p&lt;&lt;<span class="number">1</span>].size)%Mod;</span><br><span class="line">        Tree[p&lt;&lt;<span class="number">1</span>|<span class="number">1</span>].val=(Tree[p&lt;&lt;<span class="number">1</span>|<span class="number">1</span>].val+Tree[p].tag*Tree[p&lt;&lt;<span class="number">1</span>|<span class="number">1</span>].size)%Mod;</span><br><span class="line">        Tree[p&lt;&lt;<span class="number">1</span>].tag=(Tree[p&lt;&lt;<span class="number">1</span>].tag+Tree[p].tag)%Mod;</span><br><span class="line">        Tree[p&lt;&lt;<span class="number">1</span>|<span class="number">1</span>].tag=(Tree[p&lt;&lt;<span class="number">1</span>|<span class="number">1</span>].tag+Tree[p].tag)%Mod;</span><br><span class="line">        Tree[p].tag=<span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="comment">//向下传递</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">build</span><span class="params">(<span class="type">int</span> p,<span class="type">int</span> l,<span class="type">int</span> r)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Tree[p].l=l,Tree[p].r=r,Tree[p].size=r-l+<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span>(l==r)</span><br><span class="line">    &#123;</span><br><span class="line">        Tree[p].val=Wgt[l]%Mod;</span><br><span class="line">        <span class="keyword">return</span> ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> mid=(l+r)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">    <span class="built_in">build</span>(p&lt;&lt;<span class="number">1</span>,l,mid),<span class="built_in">build</span>(p&lt;&lt;<span class="number">1</span>|<span class="number">1</span>,mid+<span class="number">1</span>,r);</span><br><span class="line">    <span class="built_in">pushUp</span>(p);</span><br><span class="line">&#125;<span class="comment">//建树</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">modifyAdd</span><span class="params">(<span class="type">int</span> p,<span class="type">int</span> l,<span class="type">int</span> r,<span class="type">int</span> d)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(l&lt;=Tree[p].l&amp;&amp;Tree[p].r&lt;=r)</span><br><span class="line">    &#123;</span><br><span class="line">        Tree[p].val+=d*Tree[p].size;</span><br><span class="line">        Tree[p].tag+=d;</span><br><span class="line">        <span class="keyword">return</span> ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">pushDown</span>(p);</span><br><span class="line">    <span class="type">int</span> mid=(Tree[p].l+Tree[p].r)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span>(l&lt;=mid) <span class="built_in">modifyAdd</span>(p&lt;&lt;<span class="number">1</span>,l,r,d);</span><br><span class="line">    <span class="keyword">if</span>(mid&lt;r) <span class="built_in">modifyAdd</span>(p&lt;&lt;<span class="number">1</span>|<span class="number">1</span>,l,r,d);</span><br><span class="line">    <span class="built_in">pushUp</span>(p);</span><br><span class="line">&#125;<span class="comment">//区间修改</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">queryAdd</span><span class="params">(<span class="type">int</span> p,<span class="type">int</span> l,<span class="type">int</span> r)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(l&lt;=Tree[p].l&amp;&amp;Tree[p].r&lt;=r) <span class="keyword">return</span> Tree[p].val;</span><br><span class="line">    <span class="type">int</span> mid=(Tree[p].l+Tree[p].r)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">    <span class="type">int</span> sum=<span class="number">0</span>;</span><br><span class="line">    <span class="built_in">pushDown</span>(p);</span><br><span class="line">    <span class="keyword">if</span>(l&lt;=mid) sum=(sum+<span class="built_in">queryAdd</span>(p&lt;&lt;<span class="number">1</span>,l,r))%Mod;</span><br><span class="line">    <span class="keyword">if</span>(mid&lt;r) sum=(sum+<span class="built_in">queryAdd</span>(p&lt;&lt;<span class="number">1</span>|<span class="number">1</span>,l,r))%Mod;</span><br><span class="line">    <span class="keyword">return</span> sum;</span><br><span class="line">&#125;<span class="comment">//区间查询</span></span><br></pre></td></tr></table></figure><h3 id="树链操作"><a href="#树链操作" class="headerlink" title="树链操作"></a>树链操作</h3><p>如果你观察仔细，会发现一个非常神奇的特点：</p><p>在最后求出来的 $dfs$ 序内（也就是线段树的顺序），满足：</p><ul><li>任意一条重链内的节点编号连续；</li><li>任意一棵子树内的节点编号连续。</li></ul><p><del>岂不美哉</del>。</p><h4 id="路径查询与修改"><a href="#路径查询与修改" class="headerlink" title="路径查询与修改"></a>路径查询与修改</h4><p>因为任意重链内节点编号连续，那么对于路径 $(x,y)$ ，我们的首要任务是把 $x$ 和 $y$ 跳到同一条链中。（然后你会发现最后他们跳到了 $lca(x,y)$ 的链上）然后每跳一次，就把跳过的那条链修改。</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">modifyTreeAdd</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> y,<span class="type">int</span> dz)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">while</span>(Pt[x].top!=Pt[y].top)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(Pt[Pt[x].top].dep&lt;Pt[Pt[y].top].dep) <span class="built_in">swap</span>(x,y);</span><br><span class="line">        <span class="built_in">modifyAdd</span>(<span class="number">1</span>,Dfn[Pt[x].top],Dfn[x],dz);</span><br><span class="line">        x=Pt[Pt[x].top].fa;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(Pt[x].dep&gt;Pt[y].dep) <span class="built_in">swap</span>(x,y);</span><br><span class="line">    <span class="built_in">modifyAdd</span>(<span class="number">1</span>,Dfn[x],Dfn[y],dz);</span><br><span class="line">&#125;<span class="comment">//路径修改</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">queryTreeAdd</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> res=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(Pt[x].top!=Pt[y].top)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(Pt[Pt[x].top].dep&lt;Pt[Pt[y].top].dep) <span class="built_in">swap</span>(x,y);</span><br><span class="line">        res=(res+<span class="built_in">queryAdd</span>(<span class="number">1</span>,Dfn[Pt[x].top],Dfn[x]))%Mod;</span><br><span class="line">        x=Pt[Pt[x].top].fa;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(Pt[x].dep&gt;Pt[y].dep) <span class="built_in">swap</span>(x,y);</span><br><span class="line">    res=(res+<span class="built_in">queryAdd</span>(<span class="number">1</span>,Dfn[x],Dfn[y]))%Mod;</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;<span class="comment">//路经查询</span></span><br></pre></td></tr></table></figure><h4 id="子树查询与修改"><a href="#子树查询与修改" class="headerlink" title="子树查询与修改"></a>子树查询与修改</h4><p>既然子树节点也是连续的，那就更没什么说头了，直接一步解决即可。</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">modifyAdd</span>(<span class="number">1</span>,Dfn[x],Dfn[x]+Pt[x].size<span class="number">-1</span>,z%Mod);</span><br><span class="line"><span class="comment">//子树修改</span></span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,<span class="built_in">queryAdd</span>(<span class="number">1</span>,Dfn[x],Dfn[x]+Pt[x].size<span class="number">-1</span>));</span><br><span class="line"><span class="comment">//子树查询</span></span><br></pre></td></tr></table></figure><h2 id="例题"><a href="#例题" class="headerlink" title="例题"></a>例题</h2><h3 id="模板题"><a href="#模板题" class="headerlink" title="模板题"></a>模板题</h3><p>路径修改，路径查询，子树修改，子树查询。</p><details>    <summary>AC Code</summary><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;ctime&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iomanip&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stack&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;map&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> gh() getchar()</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> re register</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> db double</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> ll;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN=<span class="number">1e5</span>+<span class="number">1</span>;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    x=<span class="number">0</span>;</span><br><span class="line">    <span class="type">char</span> ch=<span class="built_in">gh</span>(),t=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(ch&lt;<span class="string">&#x27;0&#x27;</span>||ch&gt;<span class="string">&#x27;9&#x27;</span>) t|=ch==<span class="string">&#x27;-&#x27;</span>,ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">while</span>(ch&gt;=<span class="string">&#x27;0&#x27;</span>&amp;&amp;ch&lt;=<span class="string">&#x27;9&#x27;</span>) x=(x&lt;&lt;<span class="number">3</span>)+(x&lt;&lt;<span class="number">1</span>)+(ch^<span class="number">48</span>),ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">if</span>(t) x=-x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T,<span class="keyword">class</span> ...T1&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x,T1 &amp;...x1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">read</span>(x),<span class="built_in">read</span>(x1...);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">checkMax</span><span class="params">(T &amp;x,T &amp;y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x&lt;y?x=y,<span class="number">1</span>:<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">checkMin</span><span class="params">(T &amp;x,T &amp;y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x&gt;y?x=y,<span class="number">1</span>:<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> N,M,Root,Mod,val[MAXN];</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Graph</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> next,to;</span><br><span class="line">    <span class="built_in">Graph</span>(<span class="type">int</span> n=<span class="number">0</span>,<span class="type">int</span> t=<span class="number">0</span>):<span class="built_in">next</span>(n),<span class="built_in">to</span>(t)&#123;&#125;</span><br><span class="line">&#125;Edge[MAXN&lt;&lt;<span class="number">1</span>];</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Point</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> fa,dep,size,son,top;</span><br><span class="line">&#125;Pt[MAXN];</span><br><span class="line"><span class="type">int</span> Head[MAXN],Total;</span><br><span class="line"><span class="type">int</span> Dfn[MAXN&lt;&lt;<span class="number">2</span>],Cnt,Wgt[MAXN&lt;&lt;<span class="number">2</span>];</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">addEdge</span><span class="params">(<span class="type">int</span> u,<span class="type">int</span> v)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Edge[++Total]=<span class="built_in">Graph</span>(Head[u],v);Head[u]=Total;</span><br><span class="line">    Edge[++Total]=<span class="built_in">Graph</span>(Head[v],u);Head[v]=Total;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dfsTree</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> last,<span class="type">int</span> depth)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Pt[x].size=<span class="number">1</span>,Pt[x].fa=last;</span><br><span class="line">    Pt[x].dep=depth;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> e=Head[x],v;e;e=Edge[e].next)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>((v=Edge[e].to)==last) <span class="keyword">continue</span>;</span><br><span class="line">        <span class="built_in">dfsTree</span>(v,x,depth+<span class="number">1</span>);</span><br><span class="line">        Pt[x].size+=Pt[v].size;</span><br><span class="line">        <span class="keyword">if</span>(Pt[v].size&gt;Pt[Pt[x].son].size) Pt[x].son=v;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dfsDfn</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> topf)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Dfn[x]=++Cnt;</span><br><span class="line">    Wgt[Cnt]=val[x];</span><br><span class="line">    Pt[x].top=topf;</span><br><span class="line">    <span class="keyword">if</span>(!Pt[x].son) <span class="keyword">return</span> ;</span><br><span class="line">    <span class="built_in">dfsDfn</span>(Pt[x].son,topf);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> e=Head[x],v;e;e=Edge[e].next)</span><br><span class="line">    &#123;</span><br><span class="line">        v=Edge[e].to;</span><br><span class="line">        <span class="keyword">if</span>(v==Pt[x].fa||v==Pt[x].son) <span class="keyword">continue</span>;</span><br><span class="line">        <span class="built_in">dfsDfn</span>(v,v);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">SegmentTree</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> val,size,tag,l,r;</span><br><span class="line">&#125;Tree[MAXN&lt;&lt;<span class="number">2</span>];</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">pushUp</span><span class="params">(<span class="type">int</span> p)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Tree[p].val=(Tree[p&lt;&lt;<span class="number">1</span>].val+Tree[p&lt;&lt;<span class="number">1</span>|<span class="number">1</span>].val)%Mod;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">pushDown</span><span class="params">(<span class="type">int</span> p)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(Tree[p].tag)</span><br><span class="line">    &#123;</span><br><span class="line">        Tree[p&lt;&lt;<span class="number">1</span>].val=(Tree[p&lt;&lt;<span class="number">1</span>].val+Tree[p].tag*Tree[p&lt;&lt;<span class="number">1</span>].size)%Mod;</span><br><span class="line">        Tree[p&lt;&lt;<span class="number">1</span>|<span class="number">1</span>].val=(Tree[p&lt;&lt;<span class="number">1</span>|<span class="number">1</span>].val+Tree[p].tag*Tree[p&lt;&lt;<span class="number">1</span>|<span class="number">1</span>].size)%Mod;</span><br><span class="line">        Tree[p&lt;&lt;<span class="number">1</span>].tag=(Tree[p&lt;&lt;<span class="number">1</span>].tag+Tree[p].tag)%Mod;</span><br><span class="line">        Tree[p&lt;&lt;<span class="number">1</span>|<span class="number">1</span>].tag=(Tree[p&lt;&lt;<span class="number">1</span>|<span class="number">1</span>].tag+Tree[p].tag)%Mod;</span><br><span class="line">        Tree[p].tag=<span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">build</span><span class="params">(<span class="type">int</span> p,<span class="type">int</span> l,<span class="type">int</span> r)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Tree[p].l=l,Tree[p].r=r,Tree[p].size=r-l+<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span>(l==r)</span><br><span class="line">    &#123;</span><br><span class="line">        Tree[p].val=Wgt[l]%Mod;</span><br><span class="line">        <span class="keyword">return</span> ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> mid=(l+r)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">    <span class="built_in">build</span>(p&lt;&lt;<span class="number">1</span>,l,mid),<span class="built_in">build</span>(p&lt;&lt;<span class="number">1</span>|<span class="number">1</span>,mid+<span class="number">1</span>,r);</span><br><span class="line">    <span class="built_in">pushUp</span>(p);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">modifyAdd</span><span class="params">(<span class="type">int</span> p,<span class="type">int</span> l,<span class="type">int</span> r,<span class="type">int</span> d)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(l&lt;=Tree[p].l&amp;&amp;Tree[p].r&lt;=r)</span><br><span class="line">    &#123;</span><br><span class="line">        Tree[p].val+=d*Tree[p].size;</span><br><span class="line">        Tree[p].tag+=d;</span><br><span class="line">        <span class="keyword">return</span> ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">pushDown</span>(p);</span><br><span class="line">    <span class="type">int</span> mid=(Tree[p].l+Tree[p].r)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span>(l&lt;=mid) <span class="built_in">modifyAdd</span>(p&lt;&lt;<span class="number">1</span>,l,r,d);</span><br><span class="line">    <span class="keyword">if</span>(mid&lt;r) <span class="built_in">modifyAdd</span>(p&lt;&lt;<span class="number">1</span>|<span class="number">1</span>,l,r,d);</span><br><span class="line">    <span class="built_in">pushUp</span>(p);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">queryAdd</span><span class="params">(<span class="type">int</span> p,<span class="type">int</span> l,<span class="type">int</span> r)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(l&lt;=Tree[p].l&amp;&amp;Tree[p].r&lt;=r) <span class="keyword">return</span> Tree[p].val;</span><br><span class="line">    <span class="type">int</span> mid=(Tree[p].l+Tree[p].r)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">    <span class="type">int</span> sum=<span class="number">0</span>;</span><br><span class="line">    <span class="built_in">pushDown</span>(p);</span><br><span class="line">    <span class="keyword">if</span>(l&lt;=mid) sum=(sum+<span class="built_in">queryAdd</span>(p&lt;&lt;<span class="number">1</span>,l,r))%Mod;</span><br><span class="line">    <span class="keyword">if</span>(mid&lt;r) sum=(sum+<span class="built_in">queryAdd</span>(p&lt;&lt;<span class="number">1</span>|<span class="number">1</span>,l,r))%Mod;</span><br><span class="line">    <span class="keyword">return</span> sum;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">modifyTreeAdd</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> y,<span class="type">int</span> dz)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">while</span>(Pt[x].top!=Pt[y].top)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(Pt[Pt[x].top].dep&lt;Pt[Pt[y].top].dep) <span class="built_in">swap</span>(x,y);</span><br><span class="line">        <span class="built_in">modifyAdd</span>(<span class="number">1</span>,Dfn[Pt[x].top],Dfn[x],dz);</span><br><span class="line">        x=Pt[Pt[x].top].fa;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(Pt[x].dep&gt;Pt[y].dep) <span class="built_in">swap</span>(x,y);</span><br><span class="line">    <span class="built_in">modifyAdd</span>(<span class="number">1</span>,Dfn[x],Dfn[y],dz);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">queryTreeAdd</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> res=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(Pt[x].top!=Pt[y].top)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(Pt[Pt[x].top].dep&lt;Pt[Pt[y].top].dep) <span class="built_in">swap</span>(x,y);</span><br><span class="line">        res=(res+<span class="built_in">queryAdd</span>(<span class="number">1</span>,Dfn[Pt[x].top],Dfn[x]))%Mod;</span><br><span class="line">        x=Pt[Pt[x].top].fa;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(Pt[x].dep&gt;Pt[y].dep) <span class="built_in">swap</span>(x,y);</span><br><span class="line">    res=(res+<span class="built_in">queryAdd</span>(<span class="number">1</span>,Dfn[x],Dfn[y]))%Mod;</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// freopen(&quot;tree-chain.in&quot;,&quot;r&quot;,stdin);</span></span><br><span class="line">    <span class="comment">// freopen(&quot;tree-chain.out&quot;,&quot;w&quot;,stdout);</span></span><br><span class="line">    <span class="built_in">read</span>(N,M,Root,Mod);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=N;++i) <span class="built_in">read</span>(val[i]);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">2</span>,u,v;i&lt;=N;++i)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">read</span>(u,v);</span><br><span class="line">        <span class="built_in">addEdge</span>(u,v);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">dfsTree</span>(Root,<span class="number">0</span>,<span class="number">1</span>);</span><br><span class="line">    <span class="built_in">dfsDfn</span>(Root,Root);</span><br><span class="line">    <span class="built_in">build</span>(<span class="number">1</span>,<span class="number">1</span>,N);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>,opt,x,y,z;i&lt;=M;++i)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">read</span>(opt);</span><br><span class="line">        <span class="keyword">if</span>(opt==<span class="number">1</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">read</span>(x,y,z);</span><br><span class="line">            <span class="built_in">modifyTreeAdd</span>(x,y,z%Mod);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(opt==<span class="number">2</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">read</span>(x,y);</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,<span class="built_in">queryTreeAdd</span>(x,y));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(opt==<span class="number">3</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">read</span>(x,z);</span><br><span class="line">            <span class="built_in">modifyAdd</span>(<span class="number">1</span>,Dfn[x],Dfn[x]+Pt[x].size<span class="number">-1</span>,z%Mod);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">read</span>(x);</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,<span class="built_in">queryAdd</span>(<span class="number">1</span>,Dfn[x],Dfn[x]+Pt[x].size<span class="number">-1</span>));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">5 5 2 24</span></span><br><span class="line"><span class="comment">7 3 7 8 0 </span></span><br><span class="line"><span class="comment">1 2</span></span><br><span class="line"><span class="comment">1 5</span></span><br><span class="line"><span class="comment">3 1</span></span><br><span class="line"><span class="comment">4 1</span></span><br><span class="line"><span class="comment">3 4 2</span></span><br><span class="line"><span class="comment">3 2 2</span></span><br><span class="line"><span class="comment">4 5</span></span><br><span class="line"><span class="comment">1 5 1 3</span></span><br><span class="line"><span class="comment">2 1 3</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">8 10 2 448348</span></span><br><span class="line"><span class="comment">458 718 447 857 633 264 238 944 </span></span><br><span class="line"><span class="comment">1 2</span></span><br><span class="line"><span class="comment">2 3</span></span><br><span class="line"><span class="comment">3 4</span></span><br><span class="line"><span class="comment">6 2</span></span><br><span class="line"><span class="comment">1 5</span></span><br><span class="line"><span class="comment">5 7</span></span><br><span class="line"><span class="comment">8 6</span></span><br><span class="line"><span class="comment">3 7 611</span></span><br><span class="line"><span class="comment">4 6</span></span><br><span class="line"><span class="comment">3 1 267</span></span><br><span class="line"><span class="comment">3 2 111</span></span><br><span class="line"><span class="comment">1 6 3 153</span></span><br><span class="line"><span class="comment">3 7 673</span></span><br><span class="line"><span class="comment">4 8</span></span><br><span class="line"><span class="comment">2 6 1</span></span><br><span class="line"><span class="comment">4 7</span></span><br><span class="line"><span class="comment">3 4 228</span></span><br><span class="line"><span class="comment">*/</span>    </span><br></pre></td></tr></table></figure></details><hr><h3 id="最近公共祖先"><a href="#最近公共祖先" class="headerlink" title="最近公共祖先"></a>最近公共祖先</h3><p>裸裸的树剖，甚至不需要数据结构维护。</p><p>对于一组询问 $(x,y)$ 首先将两个点跳到同一条重链上，然后输出深度小的点即可。</p><p>另外，还是不建议用结构体来存储节点，读者可以比对一下这道题和上一道题的代码量，就会发现其实还是单数组的更好读和修改一些（个人意见）。</p><details>    <summary>AC Code</summary><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;ctime&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iomanip&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stack&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;map&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> gh() getchar()</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> re register</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> db double</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> ll;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN=<span class="number">5e5</span>+<span class="number">1</span>;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    x=<span class="number">0</span>;</span><br><span class="line">    <span class="type">char</span> ch=<span class="built_in">gh</span>(),t=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(ch&lt;<span class="string">&#x27;0&#x27;</span>||ch&gt;<span class="string">&#x27;9&#x27;</span>) t|=ch==<span class="string">&#x27;-&#x27;</span>,ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">while</span>(ch&gt;=<span class="string">&#x27;0&#x27;</span>&amp;&amp;ch&lt;=<span class="string">&#x27;9&#x27;</span>) x=(x&lt;&lt;<span class="number">3</span>)+(x&lt;&lt;<span class="number">1</span>)+(ch^<span class="number">48</span>),ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">if</span>(t) x=-x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T,<span class="keyword">class</span> ...T1&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x,T1 &amp;...x1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">read</span>(x),<span class="built_in">read</span>(x1...);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">checkMax</span><span class="params">(T &amp;x,T &amp;y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x&lt;y?x=y,<span class="number">1</span>:<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">checkMin</span><span class="params">(T &amp;x,T &amp;y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x&gt;y?x=y,<span class="number">1</span>:<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> N,M,Root;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Graph</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> next,to;</span><br><span class="line">    <span class="built_in">Graph</span>(<span class="type">int</span> n=<span class="number">0</span>,<span class="type">int</span> t=<span class="number">0</span>):<span class="built_in">next</span>(n),<span class="built_in">to</span>(t)&#123;&#125;</span><br><span class="line">&#125;Edge[MAXN&lt;&lt;<span class="number">1</span>];</span><br><span class="line"><span class="type">int</span> Head[MAXN],Total;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">addEdge</span><span class="params">(<span class="type">int</span> u,<span class="type">int</span> v)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Edge[++Total]=<span class="built_in">Graph</span>(Head[u],v);Head[u]=Total;</span><br><span class="line">    Edge[++Total]=<span class="built_in">Graph</span>(Head[v],u);Head[v]=Total;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> Size[MAXN],Dep[MAXN],Top[MAXN],Fa[MAXN],Son[MAXN];</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dfsTree</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> last,<span class="type">int</span> dep)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Fa[x]=last,Size[x]=<span class="number">1</span>,Dep[x]=dep;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> e=Head[x],v;e;e=Edge[e].next)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>((v=Edge[e].to)==last) <span class="keyword">continue</span>;</span><br><span class="line">        <span class="built_in">dfsTree</span>(v,x,dep+<span class="number">1</span>);</span><br><span class="line">        Size[x]+=Size[v];</span><br><span class="line">        <span class="keyword">if</span>(!Son[x]||Size[Son[x]]&lt;Size[v]) Son[x]=v;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dfsDfn</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> topf)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Top[x]=topf;</span><br><span class="line">    <span class="keyword">if</span>(!Son[x]) <span class="keyword">return</span> ;</span><br><span class="line">    <span class="built_in">dfsDfn</span>(Son[x],topf);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> e=Head[x],v;e;e=Edge[e].next)</span><br><span class="line">    &#123;</span><br><span class="line">        v=Edge[e].to;</span><br><span class="line">        <span class="keyword">if</span>(v==Fa[x]||v==Son[x]) <span class="keyword">continue</span>;</span><br><span class="line">        <span class="built_in">dfsDfn</span>(v,v);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">lca</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">while</span>(Top[x]!=Top[y])</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(Dep[Top[x]]&lt;Dep[Top[y]]) <span class="built_in">swap</span>(x,y);</span><br><span class="line">        x=Fa[Top[x]];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(Dep[x]&gt;Dep[y]) <span class="built_in">swap</span>(x,y);</span><br><span class="line">    <span class="keyword">return</span> x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// freopen(&quot;tree-chain.in&quot;,&quot;r&quot;,stdin);</span></span><br><span class="line">    <span class="comment">// freopen(&quot;tree-chain.out&quot;,&quot;w&quot;,stdout);</span></span><br><span class="line">    <span class="built_in">read</span>(N,M,Root);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">2</span>,u,v;i&lt;=N;++i)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">read</span>(u,v);</span><br><span class="line">        <span class="built_in">addEdge</span>(u,v);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">dfsTree</span>(Root,<span class="number">0</span>,<span class="number">1</span>);</span><br><span class="line">    <span class="built_in">dfsDfn</span>(Root,Root);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>,x,y;i&lt;=M;++i)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">read</span>(x,y);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,<span class="built_in">lca</span>(x,y));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">5 5 4</span></span><br><span class="line"><span class="comment">3 1</span></span><br><span class="line"><span class="comment">2 4</span></span><br><span class="line"><span class="comment">5 1</span></span><br><span class="line"><span class="comment">1 4</span></span><br><span class="line"><span class="comment">2 4</span></span><br><span class="line"><span class="comment">3 2</span></span><br><span class="line"><span class="comment">3 5</span></span><br><span class="line"><span class="comment">1 2</span></span><br><span class="line"><span class="comment">4 5</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure></details><hr><h3 id="P3128"><a href="#P3128" class="headerlink" title="P3128"></a><a href="https://www.luogu.com.cn/problem/P3128">P3128</a></h3><p>维护区间和，然后单点查找即可。</p><details>    <summary>AC Code</summary><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;ctime&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iomanip&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stack&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;map&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> gh() getchar()</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> re register</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> db double</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> ll;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN=<span class="number">5e4</span>+<span class="number">1</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXK=<span class="number">1e5</span>+<span class="number">1</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> INF=<span class="number">0x7f7f7f7f</span>;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    x=<span class="number">0</span>;</span><br><span class="line">    <span class="type">char</span> ch=<span class="built_in">gh</span>(),t=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(ch&lt;<span class="string">&#x27;0&#x27;</span>||ch&gt;<span class="string">&#x27;9&#x27;</span>) t|=ch==<span class="string">&#x27;-&#x27;</span>,ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">while</span>(ch&gt;=<span class="string">&#x27;0&#x27;</span>&amp;&amp;ch&lt;=<span class="string">&#x27;9&#x27;</span>) x=(x&lt;&lt;<span class="number">3</span>)+(x&lt;&lt;<span class="number">1</span>)+(ch^<span class="number">48</span>),ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">if</span>(t) x=-x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T,<span class="keyword">class</span> ...T1&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x,T1 &amp;...x1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">read</span>(x),<span class="built_in">read</span>(x1...);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">checkMax</span><span class="params">(T &amp;x,T &amp;y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x&lt;y?x=y,<span class="number">1</span>:<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">checkMin</span><span class="params">(T &amp;x,T &amp;y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x&gt;y?x=y,<span class="number">1</span>:<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> N,K;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Graph</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> next,to;</span><br><span class="line">    <span class="built_in">Graph</span>(<span class="type">int</span> n=<span class="number">0</span>,<span class="type">int</span> t=<span class="number">0</span>):<span class="built_in">next</span>(n),<span class="built_in">to</span>(t)&#123;&#125;</span><br><span class="line">&#125;Edge[MAXN&lt;&lt;<span class="number">1</span>];</span><br><span class="line"><span class="type">int</span> Head[MAXN],Total;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">addEdge</span><span class="params">(<span class="type">int</span> u,<span class="type">int</span> v)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Edge[++Total]=<span class="built_in">Graph</span>(Head[u],v);Head[u]=Total;</span><br><span class="line">    Edge[++Total]=<span class="built_in">Graph</span>(Head[v],u);Head[v]=Total;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> Dep[MAXN],Son[MAXN],Fa[MAXN],Size[MAXN];</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dfsTree</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> last)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Dep[x]=Dep[last]+<span class="number">1</span>;Size[x]=<span class="number">1</span>;Fa[x]=last;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> e=Head[x],v;e;e=Edge[e].next)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>((v=Edge[e].to)==last) <span class="keyword">continue</span>;</span><br><span class="line">        <span class="built_in">dfsTree</span>(v,x);</span><br><span class="line">        Size[x]+=Size[v];</span><br><span class="line">        <span class="keyword">if</span>(Size[v]&gt;Size[Son[x]]||!Son[x]) Son[x]=v;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> Dfn[MAXN],Top[MAXN],Cnt;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dfsDfn</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> topf)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Dfn[x]=++Cnt;</span><br><span class="line">    Top[x]=topf;</span><br><span class="line">    <span class="keyword">if</span>(!Son[x]) <span class="keyword">return</span> ;</span><br><span class="line">    <span class="built_in">dfsDfn</span>(Son[x],topf);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> e=Head[x],v;e;e=Edge[e].next)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>((v=Edge[e].to)==Fa[x]||v==Son[x]) <span class="keyword">continue</span>;</span><br><span class="line">        <span class="built_in">dfsDfn</span>(v,v);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">SegmentTree</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> l,r,val,tag;</span><br><span class="line">&#125;Tree[MAXN&lt;&lt;<span class="number">2</span>];</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">pushUp</span><span class="params">(<span class="type">int</span> p)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Tree[p].val=Tree[p&lt;&lt;<span class="number">1</span>].val+Tree[p&lt;&lt;<span class="number">1</span>|<span class="number">1</span>].val;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">pushDown</span><span class="params">(<span class="type">int</span> p)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(Tree[p].tag)</span><br><span class="line">    &#123;</span><br><span class="line">        Tree[p&lt;&lt;<span class="number">1</span>].val+=(Tree[p&lt;&lt;<span class="number">1</span>].r-Tree[p&lt;&lt;<span class="number">1</span>].l+<span class="number">1</span>)*Tree[p].tag;</span><br><span class="line">        Tree[p&lt;&lt;<span class="number">1</span>|<span class="number">1</span>].val+=(Tree[p&lt;&lt;<span class="number">1</span>|<span class="number">1</span>].r-Tree[p&lt;&lt;<span class="number">1</span>|<span class="number">1</span>].l+<span class="number">1</span>)*Tree[p].tag;</span><br><span class="line">        Tree[p&lt;&lt;<span class="number">1</span>].tag+=Tree[p].tag;</span><br><span class="line">        Tree[p&lt;&lt;<span class="number">1</span>|<span class="number">1</span>].tag+=Tree[p].tag;</span><br><span class="line">        Tree[p].tag=<span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">build</span><span class="params">(<span class="type">int</span> p,<span class="type">int</span> l,<span class="type">int</span> r)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Tree[p].l=l,Tree[p].r=r;</span><br><span class="line">    <span class="keyword">if</span>(l==r)</span><br><span class="line">    &#123;</span><br><span class="line">        Tree[p].val=Tree[p].tag=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">return</span> ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> mid=(l+r)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">    <span class="built_in">build</span>(p&lt;&lt;<span class="number">1</span>,l,mid),<span class="built_in">build</span>(p&lt;&lt;<span class="number">1</span>|<span class="number">1</span>,mid+<span class="number">1</span>,r);</span><br><span class="line">    <span class="built_in">pushUp</span>(p);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">modify</span><span class="params">(<span class="type">int</span> p,<span class="type">int</span> l,<span class="type">int</span> r,<span class="type">int</span> d)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(l&lt;=Tree[p].l&amp;&amp;Tree[p].r&lt;=r)</span><br><span class="line">    &#123;</span><br><span class="line">        Tree[p].val+=(Tree[p].r-Tree[p].l+<span class="number">1</span>)*d;</span><br><span class="line">        Tree[p].tag+=d;</span><br><span class="line">        <span class="keyword">return</span> ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">pushDown</span>(p);</span><br><span class="line">    <span class="type">int</span> mid=(Tree[p].l+Tree[p].r)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span>(l&lt;=mid) <span class="built_in">modify</span>(p&lt;&lt;<span class="number">1</span>,l,r,d);</span><br><span class="line">    <span class="keyword">if</span>(mid&lt;r) <span class="built_in">modify</span>(p&lt;&lt;<span class="number">1</span>|<span class="number">1</span>,l,r,d);</span><br><span class="line">    <span class="built_in">pushUp</span>(p);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">query</span><span class="params">(<span class="type">int</span> p,<span class="type">int</span> l,<span class="type">int</span> r)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(l&lt;=Tree[p].l&amp;&amp;Tree[p].r&lt;=r) <span class="keyword">return</span> Tree[p].val;</span><br><span class="line">    <span class="type">int</span> val=<span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> mid=(Tree[p].l+Tree[p].r)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">    <span class="built_in">pushDown</span>(p);</span><br><span class="line">    <span class="keyword">if</span>(l&lt;=mid) val+=<span class="built_in">query</span>(p&lt;&lt;<span class="number">1</span>,l,r);</span><br><span class="line">    <span class="keyword">if</span>(mid&lt;r) val+=<span class="built_in">query</span>(p&lt;&lt;<span class="number">1</span>|<span class="number">1</span>,l,r);</span><br><span class="line">    <span class="keyword">return</span> val;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">modifyPath</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> y,<span class="type">int</span> d)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">while</span>(Top[x]!=Top[y])</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(Dep[Top[x]]&lt;Dep[Top[y]]) <span class="built_in">swap</span>(x,y);</span><br><span class="line">        <span class="built_in">modify</span>(<span class="number">1</span>,Dfn[Top[x]],Dfn[x],d);</span><br><span class="line">        x=Fa[Top[x]];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(Dep[x]&gt;Dep[y]) <span class="built_in">swap</span>(x,y);</span><br><span class="line">    <span class="built_in">modify</span>(<span class="number">1</span>,Dfn[x],Dfn[y],d);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// freopen(&quot;tree-chain.in&quot;,&quot;r&quot;,stdin);</span></span><br><span class="line">    <span class="comment">// freopen(&quot;tree-chain.out&quot;,&quot;w&quot;,stdout);</span></span><br><span class="line">    <span class="built_in">read</span>(N,K);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">2</span>,u,v;i&lt;=N;++i)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">read</span>(u,v);</span><br><span class="line">        <span class="built_in">addEdge</span>(u,v);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">dfsTree</span>(<span class="number">1</span>,<span class="number">0</span>);</span><br><span class="line">    <span class="built_in">dfsDfn</span>(<span class="number">1</span>,<span class="number">1</span>);</span><br><span class="line">    <span class="built_in">build</span>(<span class="number">1</span>,<span class="number">1</span>,N);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>,x,y;i&lt;=K;++i)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">read</span>(x,y);</span><br><span class="line">        <span class="built_in">modifyPath</span>(x,y,<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> ans=-INF;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=N;++i) ans=<span class="built_in">max</span>(ans,<span class="built_in">query</span>(<span class="number">1</span>,Dfn[i],Dfn[i]));</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d&quot;</span>,ans);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">5 10</span></span><br><span class="line"><span class="comment">3 4</span></span><br><span class="line"><span class="comment">1 5</span></span><br><span class="line"><span class="comment">4 2</span></span><br><span class="line"><span class="comment">5 4</span></span><br><span class="line"><span class="comment">5 4</span></span><br><span class="line"><span class="comment">5 4</span></span><br><span class="line"><span class="comment">3 5</span></span><br><span class="line"><span class="comment">4 3</span></span><br><span class="line"><span class="comment">4 3</span></span><br><span class="line"><span class="comment">1 3</span></span><br><span class="line"><span class="comment">3 5</span></span><br><span class="line"><span class="comment">5 4</span></span><br><span class="line"><span class="comment">1 5</span></span><br><span class="line"><span class="comment">3 4</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure></details><hr><h3 id="P3258"><a href="#P3258" class="headerlink" title="P3258"></a><a href="https://www.luogu.com.cn/problem/P3258">P3258</a></h3><p>与上一题类似，可以说是双倍经验。</p><details>    <summary>AC Code</summary><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;ctime&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iomanip&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stack&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;map&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> gh() getchar()</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> re register</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> db double</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> ll;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN=<span class="number">3e5</span>+<span class="number">1</span>;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    x=<span class="number">0</span>;</span><br><span class="line">    <span class="type">char</span> ch=<span class="built_in">gh</span>(),t=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(ch&lt;<span class="string">&#x27;0&#x27;</span>||ch&gt;<span class="string">&#x27;9&#x27;</span>) t|=ch==<span class="string">&#x27;-&#x27;</span>,ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">while</span>(ch&gt;=<span class="string">&#x27;0&#x27;</span>&amp;&amp;ch&lt;=<span class="string">&#x27;9&#x27;</span>) x=(x&lt;&lt;<span class="number">3</span>)+(x&lt;&lt;<span class="number">1</span>)+(ch^<span class="number">48</span>),ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">if</span>(t) x=-x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T,<span class="keyword">class</span> ...T1&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x,T1 &amp;...x1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">read</span>(x),<span class="built_in">read</span>(x1...);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">checkMax</span><span class="params">(T &amp;x,T &amp;y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x&lt;y?x=y,<span class="number">1</span>:<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">checkMin</span><span class="params">(T &amp;x,T &amp;y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x&gt;y?x=y,<span class="number">1</span>:<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> N,Turn[MAXN];</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Graph</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> next,to;</span><br><span class="line">    <span class="built_in">Graph</span>(<span class="type">int</span> n=<span class="number">0</span>,<span class="type">int</span> t=<span class="number">0</span>):<span class="built_in">next</span>(n),<span class="built_in">to</span>(t)&#123;&#125;</span><br><span class="line">&#125;Edge[MAXN&lt;&lt;<span class="number">1</span>];</span><br><span class="line"><span class="type">int</span> Head[MAXN],Total;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">addEdge</span><span class="params">(<span class="type">int</span> u,<span class="type">int</span> v)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Edge[++Total]=<span class="built_in">Graph</span>(Head[u],v);Head[u]=Total;</span><br><span class="line">    Edge[++Total]=<span class="built_in">Graph</span>(Head[v],u);Head[v]=Total;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> Fa[MAXN],Son[MAXN],Dep[MAXN],Size[MAXN];</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dfsTree</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> last)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Fa[x]=last,Dep[x]=Dep[last]+<span class="number">1</span>,Size[x]=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> e=Head[x],v;e;e=Edge[e].next)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>((v=Edge[e].to)==last) <span class="keyword">continue</span>;</span><br><span class="line">        <span class="built_in">dfsTree</span>(v,x);</span><br><span class="line">        Size[x]+=Size[v];</span><br><span class="line">        <span class="keyword">if</span>(!Son[x]||Size[v]&gt;Size[Son[x]]) Son[x]=v;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> Top[MAXN],Dfn[MAXN],Cnt;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dfsDfn</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> topf)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Dfn[x]=++Cnt;</span><br><span class="line">    Top[x]=topf;</span><br><span class="line">    <span class="keyword">if</span>(!Son[x]) <span class="keyword">return</span> ;</span><br><span class="line">    <span class="built_in">dfsDfn</span>(Son[x],topf);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> e=Head[x],v;e;e=Edge[e].next)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>((v=Edge[e].to)==Fa[x]||v==Son[x]) <span class="keyword">continue</span>;</span><br><span class="line">        <span class="built_in">dfsDfn</span>(v,v);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">SegmentTree</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> l,r,val,tag,size;</span><br><span class="line">&#125;Tree[MAXN&lt;&lt;<span class="number">2</span>];</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">pushUp</span><span class="params">(<span class="type">int</span> p)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Tree[p].val=Tree[p&lt;&lt;<span class="number">1</span>].val+Tree[p&lt;&lt;<span class="number">1</span>|<span class="number">1</span>].val;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">pushDown</span><span class="params">(<span class="type">int</span> p)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(Tree[p].tag)</span><br><span class="line">    &#123;</span><br><span class="line">        Tree[p&lt;&lt;<span class="number">1</span>].val+=Tree[p&lt;&lt;<span class="number">1</span>].size*Tree[p].tag;</span><br><span class="line">        Tree[p&lt;&lt;<span class="number">1</span>|<span class="number">1</span>].val+=Tree[p&lt;&lt;<span class="number">1</span>|<span class="number">1</span>].size*Tree[p].tag;</span><br><span class="line">        Tree[p&lt;&lt;<span class="number">1</span>].tag+=Tree[p].tag;</span><br><span class="line">        Tree[p&lt;&lt;<span class="number">1</span>|<span class="number">1</span>].tag+=Tree[p].tag;</span><br><span class="line">        Tree[p].tag=<span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">build</span><span class="params">(<span class="type">int</span> p,<span class="type">int</span> l,<span class="type">int</span> r)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Tree[p].l=l,Tree[p].r=r,Tree[p].size=r-l+<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span>(l==r)</span><br><span class="line">    &#123;</span><br><span class="line">        Tree[p].val=Tree[p].tag=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">return</span> ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> mid=(l+r)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">    <span class="built_in">build</span>(p&lt;&lt;<span class="number">1</span>,l,mid),<span class="built_in">build</span>(p&lt;&lt;<span class="number">1</span>|<span class="number">1</span>,mid+<span class="number">1</span>,r);</span><br><span class="line">    <span class="built_in">pushUp</span>(p);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">modify</span><span class="params">(<span class="type">int</span> p,<span class="type">int</span> l,<span class="type">int</span> r,<span class="type">int</span> d)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(l&lt;=Tree[p].l&amp;&amp;Tree[p].r&lt;=r)</span><br><span class="line">    &#123;</span><br><span class="line">        Tree[p].val+=d*Tree[p].size;</span><br><span class="line">        Tree[p].tag+=d;</span><br><span class="line">        <span class="keyword">return</span> ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">pushDown</span>(p);</span><br><span class="line">    <span class="type">int</span> mid=(Tree[p].l+Tree[p].r)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span>(l&lt;=mid) <span class="built_in">modify</span>(p&lt;&lt;<span class="number">1</span>,l,r,d);</span><br><span class="line">    <span class="keyword">if</span>(mid&lt;r) <span class="built_in">modify</span>(p&lt;&lt;<span class="number">1</span>|<span class="number">1</span>,l,r,d);</span><br><span class="line">    <span class="built_in">pushUp</span>(p); </span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">query</span><span class="params">(<span class="type">int</span> p,<span class="type">int</span> l,<span class="type">int</span> r)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(l&lt;=Tree[p].l&amp;&amp;Tree[p].r&lt;=r) <span class="keyword">return</span> Tree[p].val;</span><br><span class="line">    <span class="built_in">pushDown</span>(p);</span><br><span class="line">    <span class="type">int</span> mid=(Tree[p].l+Tree[p].r)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">    <span class="type">int</span> val=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span>(l&lt;=mid) val+=<span class="built_in">query</span>(p&lt;&lt;<span class="number">1</span>,l,r);</span><br><span class="line">    <span class="keyword">if</span>(mid&lt;r) val+=<span class="built_in">query</span>(p&lt;&lt;<span class="number">1</span>|<span class="number">1</span>,l,r);</span><br><span class="line">    <span class="keyword">return</span> val;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">modifyPath</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> y,<span class="type">int</span> d)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">while</span>(Top[x]!=Top[y])</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(Dep[Top[x]]&lt;Dep[Top[y]]) <span class="built_in">swap</span>(x,y);</span><br><span class="line">        <span class="built_in">modify</span>(<span class="number">1</span>,Dfn[Top[x]],Dfn[x],d);</span><br><span class="line">        x=Fa[Top[x]];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(Dep[x]&gt;Dep[y]) <span class="built_in">swap</span>(x,y);</span><br><span class="line">    <span class="built_in">modify</span>(<span class="number">1</span>,Dfn[x],Dfn[y],d);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// freopen(&quot;tc.in&quot;,&quot;r&quot;,stdin);</span></span><br><span class="line">    <span class="comment">// freopen(&quot;tc.out&quot;,&quot;w&quot;,stdout);</span></span><br><span class="line">    <span class="built_in">read</span>(N);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=N;++i) <span class="built_in">read</span>(Turn[i]);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">2</span>,u,v;i&lt;=N;++i)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">read</span>(u,v);</span><br><span class="line">        <span class="built_in">addEdge</span>(u,v);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">dfsTree</span>(Turn[<span class="number">1</span>],<span class="number">0</span>);</span><br><span class="line">    <span class="built_in">dfsDfn</span>(Turn[<span class="number">1</span>],Turn[<span class="number">1</span>]);</span><br><span class="line">    <span class="built_in">build</span>(<span class="number">1</span>,<span class="number">1</span>,N);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=N<span class="number">-1</span>;++i)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">modifyPath</span>(Turn[i+<span class="number">1</span>],Turn[i+<span class="number">1</span>],<span class="number">-1</span>);</span><br><span class="line">        <span class="built_in">modifyPath</span>(Turn[i],Turn[i+<span class="number">1</span>],<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=N;++i)</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,<span class="built_in">query</span>(<span class="number">1</span>,Dfn[i],Dfn[i]));</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">5</span></span><br><span class="line"><span class="comment">1 4 5 3 2</span></span><br><span class="line"><span class="comment">1 2</span></span><br><span class="line"><span class="comment">2 4</span></span><br><span class="line"><span class="comment">2 3</span></span><br><span class="line"><span class="comment">4 5</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure></details><hr><h3 id="边权挂点"><a href="#边权挂点" class="headerlink" title="边权挂点"></a>边权挂点</h3><p>我们知道，树剖的实质是维护点权的，但是，树剖也可以进行一系列操作使其能够维护边权。俗称<strong>边权挂点</strong>。</p><p>我们把题目的树视作有根树，每一个节点都只存在至多 $1$ 个父亲。那么，我们将原来维护 $u$ 节点的 $dfn[u]$ 指向 $c(fa[u],u)$ 的权值。通俗地讲，维护该点与其父节点的边。</p><p>但是，维护边权时有许多需要注意的。在我们已经跳到了同一重链中，以边权和为例，对于 $lca(x,y)$ 而言，维护的是 $c(fa[lca(x,y)],lca(x,y))$ 的权值，但事实上，我们在求解 $\sum\limits^{e\in path(x,y)}_{e}e(u,v)$ 时，不会去求 $lca(x,y)$ 与其父节点的边权。那么，我们在 $dfn[x]$ 的地方 $+1$ 使其跳过 $lca(x,y)$ 即可。</p><p>但是，这并不是普遍情况，真正需要 <code>+1</code> 还是需要 <code>-1</code> 要视题目而定，所以为什么树剖的边权题非常难调，调得人想趋势。</p><p>给出一道比较模板的<a href="https://www.luogu.com.cn/problem/P2420">边权挂点题</a></p><details>    <summary>AC Code</summary><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;ctime&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iomanip&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stack&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;map&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> gh() getchar()</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> re register</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> db double</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> ll;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN=<span class="number">2e5</span>+<span class="number">1</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXM=<span class="number">2e5</span>+<span class="number">1</span>;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    x=<span class="number">0</span>;</span><br><span class="line">    <span class="type">char</span> ch=<span class="built_in">gh</span>(),t=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(ch&lt;<span class="string">&#x27;0&#x27;</span>||ch&gt;<span class="string">&#x27;9&#x27;</span>) t|=ch==<span class="string">&#x27;-&#x27;</span>,ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">while</span>(ch&gt;=<span class="string">&#x27;0&#x27;</span>&amp;&amp;ch&lt;=<span class="string">&#x27;9&#x27;</span>) x=(x&lt;&lt;<span class="number">3</span>)+(x&lt;&lt;<span class="number">1</span>)+(ch^<span class="number">48</span>),ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">if</span>(t) x=-x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T,<span class="keyword">class</span> ...T1&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x,T1 &amp;...x1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">read</span>(x),<span class="built_in">read</span>(x1...);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">checkMax</span><span class="params">(T &amp;x,T &amp;y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x&lt;y?x=y,<span class="number">1</span>:<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">checkMin</span><span class="params">(T &amp;x,T &amp;y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x&gt;y?x=y,<span class="number">1</span>:<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> N,M;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Graph</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> next,to;</span><br><span class="line">    ll val;</span><br><span class="line">    <span class="built_in">Graph</span>(<span class="type">int</span> n=<span class="number">0</span>,<span class="type">int</span> t=<span class="number">0</span>,ll v=<span class="number">0</span>):<span class="built_in">next</span>(n),<span class="built_in">to</span>(t),<span class="built_in">val</span>(v)&#123;&#125;</span><br><span class="line">&#125;Edge[MAXM&lt;&lt;<span class="number">1</span>];</span><br><span class="line"><span class="type">int</span> Head[MAXN],Total,Xor[MAXN];</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">addEdge</span><span class="params">(<span class="type">int</span> u,<span class="type">int</span> v,ll w)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Edge[++Total]=<span class="built_in">Graph</span>(Head[u],v,w);Head[u]=Total;</span><br><span class="line">    Edge[++Total]=<span class="built_in">Graph</span>(Head[v],u,w);Head[v]=Total;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> Dep[MAXN],Son[MAXN],Fa[MAXN],Size[MAXN],Top[MAXN];</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dfsTree</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> last,<span class="type">int</span> dep)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Fa[x]=last,Dep[x]=dep,Size[x]=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> e=Head[x],v;e;e=Edge[e].next)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>((v=Edge[e].to)==last) <span class="keyword">continue</span>;</span><br><span class="line">        Xor[v]=Edge[e].val;</span><br><span class="line">        <span class="built_in">dfsTree</span>(v,x,dep+<span class="number">1</span>);</span><br><span class="line">        Size[x]+=Size[v];</span><br><span class="line">        <span class="keyword">if</span>(!Son[x]||Size[v]&gt;Size[Son[x]]) Son[x]=v;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> Dfn[MAXN],Val[MAXN],Cnt;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dfsDfn</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> topf)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Dfn[x]=++Cnt;</span><br><span class="line">    Val[Cnt]=Xor[x];Top[x]=topf;</span><br><span class="line">    <span class="keyword">if</span>(!Son[x]) <span class="keyword">return</span> ;</span><br><span class="line">    <span class="built_in">dfsDfn</span>(Son[x],topf);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> e=Head[x],v;e;e=Edge[e].next)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>((v=Edge[e].to)==Fa[x]||Edge[e].to==Son[x]) <span class="keyword">continue</span>;</span><br><span class="line">        <span class="built_in">dfsDfn</span>(v,v);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">SegmentTree</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> l,r,val;</span><br><span class="line">&#125;Tree[MAXN&lt;&lt;<span class="number">1</span>];</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">pushUp</span><span class="params">(<span class="type">int</span> p)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Tree[p].val=Tree[p&lt;&lt;<span class="number">1</span>].val^Tree[p&lt;&lt;<span class="number">1</span>|<span class="number">1</span>].val;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">build</span><span class="params">(<span class="type">int</span> p,<span class="type">int</span> l,<span class="type">int</span> r)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Tree[p].l=l,Tree[p].r=r;</span><br><span class="line">    <span class="keyword">if</span>(l==r)</span><br><span class="line">    &#123;</span><br><span class="line">        Tree[p].val=Val[l];</span><br><span class="line">        <span class="keyword">return</span> ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> mid=(l+r)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">    <span class="built_in">build</span>(p&lt;&lt;<span class="number">1</span>,l,mid),<span class="built_in">build</span>(p&lt;&lt;<span class="number">1</span>|<span class="number">1</span>,mid+<span class="number">1</span>,r);</span><br><span class="line">    <span class="built_in">pushUp</span>(p);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">queryXor</span><span class="params">(<span class="type">int</span> p,<span class="type">int</span> l,<span class="type">int</span> r)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(l&lt;=Tree[p].l&amp;&amp;Tree[p].r&lt;=r) <span class="keyword">return</span> Tree[p].val;</span><br><span class="line">    <span class="type">int</span> mid=(Tree[p].l+Tree[p].r)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">    <span class="type">int</span> val=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span>(l&lt;=mid) val^=<span class="built_in">queryXor</span>(p&lt;&lt;<span class="number">1</span>,l,r);</span><br><span class="line">    <span class="keyword">if</span>(mid&lt;r) val^=<span class="built_in">queryXor</span>(p&lt;&lt;<span class="number">1</span>|<span class="number">1</span>,l,r);</span><br><span class="line">    <span class="keyword">return</span> val;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">queryPath</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(x==y) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> ans=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(Top[x]!=Top[y])</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(Dep[Top[x]]&lt;Dep[Top[y]]) <span class="built_in">swap</span>(x,y);</span><br><span class="line">        ans^=<span class="built_in">queryXor</span>(<span class="number">1</span>,Dfn[Top[x]],Dfn[x]);</span><br><span class="line">        x=Fa[Top[x]];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(Dep[x]&gt;Dep[y]) <span class="built_in">swap</span>(x,y);</span><br><span class="line">    ans^=<span class="built_in">queryXor</span>(<span class="number">1</span>,Dfn[x]+<span class="number">1</span>,Dfn[y]);</span><br><span class="line">    <span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// freopen(&quot;tree-chain.in&quot;,&quot;r&quot;,stdin);</span></span><br><span class="line">    <span class="comment">// freopen(&quot;tree-chain.out&quot;,&quot;w&quot;,stdout);</span></span><br><span class="line">    <span class="built_in">read</span>(N);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">2</span>,u,v,w;i&lt;=N;++i)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">read</span>(u,v,w);</span><br><span class="line">        <span class="built_in">addEdge</span>(u,v,w);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">dfsTree</span>(<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>);</span><br><span class="line">    <span class="built_in">dfsDfn</span>(<span class="number">1</span>,<span class="number">1</span>);</span><br><span class="line">    <span class="built_in">build</span>(<span class="number">1</span>,<span class="number">1</span>,N);</span><br><span class="line">    <span class="built_in">read</span>(M);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>,x,y;i&lt;=M;++i)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">read</span>(x,y);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,<span class="built_in">queryPath</span>(x,y));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/*for(int i=1;i&lt;=N;++i) printf(&quot;%d &quot;,Dfn[i]);</span></span><br><span class="line"><span class="comment">    puts(&quot;&quot;);</span></span><br><span class="line"><span class="comment">    for(int i=1;i&lt;=N;++i) printf(&quot;%d &quot;,Val[i]);*/</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">5</span></span><br><span class="line"><span class="comment">1 4 9644</span></span><br><span class="line"><span class="comment">2 5 15004</span></span><br><span class="line"><span class="comment">3 1 14635</span></span><br><span class="line"><span class="comment">5 3 9684</span></span><br><span class="line"><span class="comment">3</span></span><br><span class="line"><span class="comment">2 4</span></span><br><span class="line"><span class="comment">5 4</span></span><br><span class="line"><span class="comment">1 1</span></span><br><span class="line"><span class="comment">*/</span>    </span><br></pre></td></tr></table></figure></details><hr><h3 id="树上-k-级祖先"><a href="#树上-k-级祖先" class="headerlink" title="树上 k 级祖先"></a>树上 k 级祖先</h3><p>然后发现这道题的长链剖分还没有重链剖分跑得快。</p><p>先说常用的重链剖分的写法：</p><p>因为点 $u$ 的祖先一定在它所属的链之上，而链的 $\text{dfn}$ 序是相连的，所以我们依然可以选择跳链。这样的做法摊下来只有 $\text{3.12s}$ ，跑进了前五。</p><details>    <summary>AC Code</summary><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    x=<span class="number">0</span>;</span><br><span class="line">    <span class="type">char</span> ch=<span class="built_in">getchar</span>(),t=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(ch&lt;<span class="string">&#x27;0&#x27;</span>||ch&gt;<span class="string">&#x27;9&#x27;</span>) t|=ch==<span class="string">&#x27;-&#x27;</span>,ch=<span class="built_in">getchar</span>();</span><br><span class="line">    <span class="keyword">while</span>(ch&gt;=<span class="string">&#x27;0&#x27;</span>&amp;&amp;ch&lt;=<span class="string">&#x27;9&#x27;</span>) x=(x&lt;&lt;<span class="number">3</span>)+(x&lt;&lt;<span class="number">1</span>)+(ch^<span class="number">48</span>),ch=<span class="built_in">getchar</span>();</span><br><span class="line">    <span class="keyword">if</span>(t) x=-x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T,<span class="keyword">class</span> ...T1&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x,T1 &amp;...x1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">read</span>(x),<span class="built_in">read</span>(x1...);</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN=<span class="number">5e5</span>+<span class="number">10</span>;</span><br><span class="line"><span class="type">int</span> N,Q,Root;</span><br><span class="line"><span class="type">long</span> <span class="type">long</span> ans;</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ui unsigned int</span></span><br><span class="line">ui Seed,lastans;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> ui <span class="title">get</span><span class="params">(ui x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">x^=x&lt;&lt;<span class="number">13</span>;</span><br><span class="line">x^=x&gt;&gt;<span class="number">17</span>;</span><br><span class="line">x^=x&lt;&lt;<span class="number">5</span>;</span><br><span class="line"><span class="keyword">return</span> Seed=x; </span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">LTC</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> next,to;</span><br><span class="line">&#125;Edge[MAXN&lt;&lt;<span class="number">1</span>];</span><br><span class="line"><span class="type">int</span> Head[MAXN],Total;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">addEdge</span><span class="params">(<span class="type">int</span> u,<span class="type">int</span> v)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Edge[++Total]=(LTC)&#123;Head[u],v&#125;;Head[u]=Total;</span><br><span class="line">    Edge[++Total]=(LTC)&#123;Head[v],u&#125;;Head[v]=Total;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> Siz[MAXN],Dep[MAXN],Fa[MAXN],Son[MAXN];</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dfsTree</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> last)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Siz[x]=<span class="number">1</span>,Dep[x]=Dep[last]+<span class="number">1</span>,Fa[x]=last;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> e=Head[x],v;e;e=Edge[e].next)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>((v=Edge[e].to)==last) <span class="keyword">continue</span>;</span><br><span class="line">        <span class="built_in">dfsTree</span>(v,x);</span><br><span class="line">        Siz[x]+=Siz[v];</span><br><span class="line">        <span class="keyword">if</span>(!Son[x]||Siz[v]&gt;Siz[Son[x]]) Son[x]=v;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> Top[MAXN],Dfn[MAXN],Bck[MAXN],Cnt;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dfsChain</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> topf)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Dfn[x]=++Cnt,Top[x]=topf;</span><br><span class="line">    Bck[Cnt]=x;</span><br><span class="line">    <span class="keyword">if</span>(!Son[x]) <span class="keyword">return</span> ;</span><br><span class="line">    <span class="built_in">dfsChain</span>(Son[x],topf);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> e=Head[x],v;e;e=Edge[e].next)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>((v=Edge[e].to)==Fa[x]||v==Son[x]) <span class="keyword">continue</span>;</span><br><span class="line">        <span class="built_in">dfsChain</span>(v,v);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">kthLca</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> k)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">while</span>(k&gt;=Dfn[x]-Dfn[Top[x]]+<span class="number">1</span>&amp;&amp;x!=Root)</span><br><span class="line">    &#123;</span><br><span class="line">        k-=(Dfn[x]-Dfn[Top[x]]+<span class="number">1</span>);</span><br><span class="line">        x=Fa[Top[x]];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> Bck[Dfn[x]-k];</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">read</span>(N,Q,Seed);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>,fa;i&lt;=N;++i)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">read</span>(fa);</span><br><span class="line">        <span class="keyword">if</span>(!fa) Root=i;</span><br><span class="line">        <span class="keyword">else</span> <span class="built_in">addEdge</span>(fa,i);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">dfsTree</span>(Root,<span class="number">0</span>);</span><br><span class="line">    <span class="built_in">dfsChain</span>(Root,Root);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=Q;++i)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> Qx=(<span class="built_in">get</span>(Seed)^lastans)%N+<span class="number">1</span>;</span><br><span class="line">        <span class="type">int</span> Qk=(<span class="built_in">get</span>(Seed)^lastans)%Dep[Qx];</span><br><span class="line">        ans^=<span class="number">1ll</span>*i*(<span class="number">1ll</span>*(lastans=<span class="built_in">kthLca</span>(Qx,Qk)));</span><br><span class="line">        <span class="comment">// printf(&quot;%d %d %d\n&quot;,Qx,Qk,lastans);</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%lld&quot;</span>,ans);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">6 3 7</span></span><br><span class="line"><span class="comment">5 5 2 2 0 3</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure></details><hr><p>而对于长链剖分，规定长儿子为其儿子深度最大的点。然后剖，跳即可。贺完了也没理太清楚，之后学 $\text{dp}$ 优化的时候再学一下。</p><p>长链剖分的时间是 $\text{5.45s}$ 。</p><details>    <summary>AC Code</summary><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN=<span class="number">5e5</span>+<span class="number">10</span>;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    x=<span class="number">0</span>;</span><br><span class="line">    <span class="type">char</span> ch=<span class="built_in">getchar</span>(),t=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(ch&lt;<span class="string">&#x27;0&#x27;</span>||ch&gt;<span class="string">&#x27;9&#x27;</span>) t|=ch==<span class="string">&#x27;-&#x27;</span>,ch=<span class="built_in">getchar</span>();</span><br><span class="line">    <span class="keyword">while</span>(ch&gt;=<span class="string">&#x27;0&#x27;</span>&amp;&amp;ch&lt;=<span class="string">&#x27;9&#x27;</span>) x=(x&lt;&lt;<span class="number">3</span>)+(x&lt;&lt;<span class="number">1</span>)+(ch^<span class="number">48</span>),ch=<span class="built_in">getchar</span>();</span><br><span class="line">    <span class="keyword">if</span>(t) x=-x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T,<span class="keyword">class</span> ...T1&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x,T1 &amp;...x1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">read</span>(x),<span class="built_in">read</span>(x1...);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">write</span><span class="params">(T x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(x&lt;<span class="number">0</span>) <span class="built_in">putchar</span>(<span class="string">&#x27;-&#x27;</span>),x=-x;</span><br><span class="line">    <span class="keyword">if</span>(x&gt;<span class="number">9</span>) <span class="built_in">write</span>(x/<span class="number">10</span>);</span><br><span class="line">    <span class="built_in">putchar</span>(x%<span class="number">10</span>+<span class="string">&#x27;0&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">checkMax</span><span class="params">(T x,T y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x&gt;y?<span class="number">1</span>:<span class="number">0</span>,x=y;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> N,Q,Root=<span class="number">1</span>;</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ui unsigned int</span></span><br><span class="line">ui Seed;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> ui <span class="title">get</span><span class="params">(ui x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">x^=x&lt;&lt;<span class="number">13</span>;</span><br><span class="line">x^=x&gt;&gt;<span class="number">17</span>;</span><br><span class="line">x^=x&lt;&lt;<span class="number">5</span>;</span><br><span class="line"><span class="keyword">return</span> Seed=x; </span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">LTC</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> next,to;</span><br><span class="line">&#125;Edge[MAXN&lt;&lt;<span class="number">1</span>];</span><br><span class="line"><span class="type">int</span> Head[MAXN],Total;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">addEdge</span><span class="params">(<span class="type">int</span> u,<span class="type">int</span> v)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Edge[++Total]=(LTC)&#123;Head[u],v&#125;;Head[u]=Total;</span><br><span class="line">    <span class="comment">// Edge[++Total]=(LTC)&#123;Head[v],u&#125;;Head[v]=Total;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> Fa[MAXN][<span class="number">21</span>];</span><br><span class="line"><span class="type">int</span> Son[MAXN],Top[MAXN];</span><br><span class="line"><span class="type">int</span> Hig[MAXN],Dep[MAXN],Dfn[MAXN],Bck[MAXN],Up[MAXN];</span><br><span class="line"><span class="type">int</span> Log[MAXN],Cnt;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dfsTree</span><span class="params">(<span class="type">int</span> x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=<span class="number">20</span>;++i) Fa[x][i]=Fa[Fa[x][i<span class="number">-1</span>]][i<span class="number">-1</span>];</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> e=Head[x],v;e;e=Edge[e].next)</span><br><span class="line">    &#123;</span><br><span class="line">        v=Edge[e].to;</span><br><span class="line">        Dep[v]=Hig[v]=Dep[x]+<span class="number">1</span>;</span><br><span class="line">        <span class="built_in">dfsTree</span>(v);</span><br><span class="line">        Hig[x]=std::<span class="built_in">max</span>(Hig[x],Hig[v]);</span><br><span class="line">        <span class="keyword">if</span>(Hig[v]&gt;Hig[Son[x]]) Son[x]=v;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dfsChain</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> topf)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Dfn[x]=++Cnt;Bck[Cnt]=x;</span><br><span class="line">    Up[Cnt]=topf;</span><br><span class="line">    <span class="keyword">if</span>(Son[x])</span><br><span class="line">    &#123;</span><br><span class="line">        Top[Son[x]]=Top[x];</span><br><span class="line">        <span class="built_in">dfsChain</span>(Son[x],Fa[topf][<span class="number">0</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> e=Head[x],v;e;e=Edge[e].next)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>((v=Edge[e].to)==Son[x]) <span class="keyword">continue</span>;</span><br><span class="line">        Top[v]=v;</span><br><span class="line">        <span class="built_in">dfsChain</span>(v,v);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">lcaKth</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> k)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(!k) <span class="keyword">return</span> x;</span><br><span class="line">    x=Fa[x][Log[k]],k-=(<span class="number">1</span>&lt;&lt;Log[k]);</span><br><span class="line">    k-=Dep[x]-Dep[Top[x]],x=Top[x];</span><br><span class="line">    <span class="keyword">if</span>(k&gt;=<span class="number">0</span>) <span class="keyword">return</span> Up[Dfn[x]+k];</span><br><span class="line">    <span class="keyword">return</span> Bck[Dfn[x]-k];</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">read</span>(N,Q,Seed);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>,fa;i&lt;=N;++i)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">read</span>(fa);</span><br><span class="line">        <span class="keyword">if</span>(!fa) Root=i;</span><br><span class="line">        <span class="keyword">else</span> <span class="built_in">addEdge</span>(fa,i);</span><br><span class="line">        Fa[i][<span class="number">0</span>]=fa;</span><br><span class="line">    &#125;</span><br><span class="line">    Log[<span class="number">0</span>]=<span class="number">-1</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=N;++i) Log[i]=Log[i&gt;&gt;<span class="number">1</span>]+<span class="number">1</span>;</span><br><span class="line">    Dep[Root]=<span class="number">1</span>;<span class="built_in">dfsTree</span>(Root);</span><br><span class="line">    Top[Root]=Root;<span class="built_in">dfsChain</span>(Root,Root);</span><br><span class="line">    <span class="type">long</span> <span class="type">long</span> ans=<span class="number">0</span>,lastans=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=Q;++i)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> Qx=(<span class="built_in">get</span>(Seed)^lastans)%N+<span class="number">1</span>;</span><br><span class="line">        <span class="type">int</span> Qk=(<span class="built_in">get</span>(Seed)^lastans)%Dep[Qx];</span><br><span class="line">        ans^=<span class="number">1ll</span>*i*<span class="number">1ll</span>*(lastans=<span class="built_in">lcaKth</span>(Qx,Qk));</span><br><span class="line">        <span class="comment">// printf(&quot;%d %d %d\n&quot;,Qx,Qk,lastans);</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">write</span>(ans);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">6 3 7</span></span><br><span class="line"><span class="comment">5 5 2 2 0 3</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure></details><hr><h3 id="换根树剖"><a href="#换根树剖" class="headerlink" title="换根树剖"></a><a href="https://www.cnblogs.com/wyh323/articles/exhld.html">换根树剖</a></h3><p>分类讨论即可。</p><p>没写，贺了。</p><hr><h1 id="树上差分"><a href="#树上差分" class="headerlink" title="树上差分"></a>树上差分</h1><p>实质：在树上进行差分约束。</p><h2 id="差分"><a href="#差分" class="headerlink" title="差分"></a>差分</h2><p>差分的思想，其实是前缀的逆运算。设原数列为 $a$ ，则定义前缀和 $sum[i]=\sum_{j=1}^{i}a_j$ ，而差分数组 $diff[i]=a_i-a_{i-1}$ 。</p><p>我们可以看一个例子：</p><p>$a=\{1,3,2,8,4,6\}$</p><p>则有：</p><p>$sum=\{1,4,6,14,18,24\}$</p><p>$diff=\{1,2,-1,6,-4,2\}$</p><p>然后我们来处理差分数组的前缀和得到：</p><p>$diff_{sum}=\{1,3,2,8,4,6\}$</p><p>并处理前缀数组的差分：</p><p>$sum_{diff}=\{1,3,2,8,4,6\}$</p><p>那么，结论显然，前缀和与差分约束是逆运算，且前缀的差分和差分的前缀都是原数列。</p><h2 id="树上差分-1"><a href="#树上差分-1" class="headerlink" title="树上差分"></a>树上差分</h2><p>树上差分用于解决询问某个点或者某条边被经过的次数，则树上差分就会派上用场。且和树链剖分一样可以解决对树上路径的操作与询问。</p><p>在树状数组钟我们也提及过，使用差分约束，可以从修改区间优化到修改结点。这个思路也同样用到树上差分，利用差分的性质，对路径上的重要结点进行修改以避免暴力区间修改。在最后，使用 $dfs$ 遍历求出该树的 $dfs$ 序之后求出 $diff$ 的前缀和即可。</p><p>前汁芝士只有 $\text{LCA}$ ，当然，也可以联动树链剖分一起理解。</p><p>另外，差分修改操作的时间复杂度是 $\mathcal O(1)$ 的。</p><h3 id="点差分"><a href="#点差分" class="headerlink" title="点差分"></a>点差分</h3><p>给一个操作，将 $(u,v)$ 之间的路径点权值加上 $w$ ，令 $o=lca(u,v),p=fa(o)$ ，那么，操作如下：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">diff[u]+=w,diff[v]+=w,diff[o]-=w,diff[p]-=w;</span><br></pre></td></tr></table></figure><p>每一个点的最后的点权就是以该点为根的子树的 $diff$ 和。读者可以自行去模拟几个例子。</p><h3 id="边差分"><a href="#边差分" class="headerlink" title="边差分"></a>边差分</h3><p>与树链剖分的边权挂点思路一样，每一个点 $i$ 所表示的边权是 $(fa[i],i)$ 这条边的边权。</p><p>那么，同样，我们将 $(u,v)$ 之间的边权值加上 $w$ ，令 $o=lca(u,v)$ ，则有：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">diff[u]+=w,diff[v]+=w,diff[o]-=2*w;</span><br></pre></td></tr></table></figure><p> 那么……没什么好讲的了。</p><p>树上差分能做的题和树链剖分是差不多的，只是看哪一个写起来方便简单。</p><h2 id="例题-1"><a href="#例题-1" class="headerlink" title="例题"></a>例题</h2><h3 id="P1083"><a href="#P1083" class="headerlink" title="P1083"></a>P1083</h3><p><a href="https://www.luogu.com.cn/problem/P1083">P1083 [NOIP2012 提高组] 借教室</a></p><p>这道题跟树没关系，单纯的差分约束而已。</p><p>我们选择二分 $m$ ，然后暴力加取 $1\sim mid$ 的差分，然后每一次检验暴力查询每一天是否合法，总的时间复杂度为 $\mathcal O(n\log m)$ 。</p><details>    <summary>AC Code</summary><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;ctime&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iomanip&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stack&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;map&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> gh() getchar()</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> re register</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> ll;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN=<span class="number">1e6</span>+<span class="number">5</span>;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    x=<span class="number">0</span>;</span><br><span class="line">    <span class="type">char</span> ch=<span class="built_in">gh</span>(),t=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(ch&lt;<span class="string">&#x27;0&#x27;</span>||ch&gt;<span class="string">&#x27;9&#x27;</span>) t|=ch==<span class="string">&#x27;-&#x27;</span>,ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">while</span>(ch&gt;=<span class="string">&#x27;0&#x27;</span>&amp;&amp;ch&lt;=<span class="string">&#x27;9&#x27;</span>) x=(x&lt;&lt;<span class="number">3</span>)+(x&lt;&lt;<span class="number">1</span>)+(ch^<span class="number">48</span>),ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">if</span>(t) x=-x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T,<span class="keyword">class</span> ...T1&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x,T1 &amp;...x1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">read</span>(x),<span class="built_in">read</span>(x1...);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">write</span><span class="params">(T x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(x&lt;<span class="number">0</span>) <span class="built_in">putchar</span>(<span class="string">&#x27;-&#x27;</span>),x=-x;</span><br><span class="line">    <span class="keyword">if</span>(x&gt;<span class="number">9</span>) <span class="built_in">write</span>(x/<span class="number">10</span>);</span><br><span class="line">    <span class="built_in">putchar</span>(x%<span class="number">10</span>+<span class="string">&#x27;0&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">checkMax</span><span class="params">(T &amp;x,T &amp;y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x&lt;y?x=y,<span class="number">1</span>:<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">checkMin</span><span class="params">(T &amp;x,T &amp;y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x&gt;y?x=y,<span class="number">1</span>:<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line">ll N,M,Rest[MAXN],L[MAXN],R[MAXN],S[MAXN],Diff[MAXN],Sum[MAXN];</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">check</span><span class="params">(<span class="type">int</span> x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">memset</span>(Sum,<span class="number">0</span>,<span class="built_in">sizeof</span>(Sum));</span><br><span class="line">    <span class="built_in">memset</span>(Diff,<span class="number">0</span>,<span class="built_in">sizeof</span>(Diff));</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=x;++i) Diff[L[i]]+=S[i];</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=x;++i) Diff[R[i]+<span class="number">1</span>]-=S[i];</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=N;++i)</span><br><span class="line">    &#123;</span><br><span class="line">        Sum[i]=Sum[i<span class="number">-1</span>]+Diff[i];</span><br><span class="line">        <span class="keyword">if</span>(Sum[i]&gt;Rest[i]) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// freopen(&quot;diff-con.in&quot;,&quot;r&quot;,stdin);</span></span><br><span class="line">    <span class="comment">// freopen(&quot;diff-con.out&quot;,&quot;w&quot;,stdout);</span></span><br><span class="line">    <span class="built_in">read</span>(N,M);</span><br><span class="line">    <span class="keyword">for</span>(re <span class="type">int</span> i=<span class="number">1</span>;i&lt;=N;++i) <span class="built_in">read</span>(Rest[i]);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=M;++i) <span class="built_in">read</span>(S[i],L[i],R[i]);</span><br><span class="line">    <span class="keyword">if</span>(<span class="built_in">check</span>(M)) <span class="built_in">putchar</span>(<span class="string">&#x27;0&#x27;</span>);</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> l=<span class="number">0</span>,r=M;</span><br><span class="line">        <span class="keyword">while</span>(l&lt;r)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="type">int</span> mid=(l+r)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">            <span class="keyword">if</span>(<span class="built_in">check</span>(mid)) l=mid+<span class="number">1</span>;</span><br><span class="line">            <span class="keyword">else</span> r=mid;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">&quot;-1&quot;</span>),<span class="built_in">write</span>(l);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">4 3 </span></span><br><span class="line"><span class="comment">2 5 4 3 </span></span><br><span class="line"><span class="comment">2 1 3 </span></span><br><span class="line"><span class="comment">3 2 4 </span></span><br><span class="line"><span class="comment">4 2 4</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure></details><hr><h3 id="P5542"><a href="#P5542" class="headerlink" title="P5542"></a><a href="https://www.luogu.com.cn/problem/P5542">P5542</a></h3><p>二维差分。</p><p>前缀和公式：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">s[i][j]=s[i-1][j]+s[i][j-1]-s[i-1][j-1]+a[i][j]</span><br></pre></td></tr></table></figure><p>对于差分公式，需要视题目而定，有些题需要考虑边界，而有些不会。对于这道题则是：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dif[x1+1][y1+1]++,dif[x1+1][y2+1]--,dif[x2+1][y1+1]--,dif[x2+1][y2+1]++;</span><br></pre></td></tr></table></figure><details>    <summary>AC Code</summary><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;ctime&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iomanip&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stack&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;map&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> gh() getchar()</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> re register</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> ll;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXS=<span class="number">1001</span>;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    x=<span class="number">0</span>;</span><br><span class="line">    <span class="type">char</span> ch=<span class="built_in">gh</span>(),t=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(ch&lt;<span class="string">&#x27;0&#x27;</span>||ch&gt;<span class="string">&#x27;9&#x27;</span>) t|=ch==<span class="string">&#x27;-&#x27;</span>,ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">while</span>(ch&gt;=<span class="string">&#x27;0&#x27;</span>&amp;&amp;ch&lt;=<span class="string">&#x27;9&#x27;</span>) x=(x&lt;&lt;<span class="number">3</span>)+(x&lt;&lt;<span class="number">1</span>)+(ch^<span class="number">48</span>),ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">if</span>(t) x=-x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T,<span class="keyword">class</span> ...T1&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x,T1 &amp;...x1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">read</span>(x),<span class="built_in">read</span>(x1...);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">write</span><span class="params">(T x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(x&lt;<span class="number">0</span>) <span class="built_in">putchar</span>(<span class="string">&#x27;-&#x27;</span>),x=-x;</span><br><span class="line">    <span class="keyword">if</span>(x&gt;<span class="number">9</span>) <span class="built_in">write</span>(x/<span class="number">10</span>);</span><br><span class="line">    <span class="built_in">putchar</span>(x%<span class="number">10</span>+<span class="string">&#x27;0&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">checkMax</span><span class="params">(T &amp;x,T &amp;y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x&lt;y?x=y,<span class="number">1</span>:<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">checkMin</span><span class="params">(T &amp;x,T &amp;y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x&gt;y?x=y,<span class="number">1</span>:<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> N,K,ans;</span><br><span class="line"><span class="type">int</span> Dif[MAXS][MAXS];</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// freopen(&quot;2-diff.in&quot;,&quot;r&quot;,stdin);</span></span><br><span class="line">    <span class="comment">// freopen(&quot;2-diff.out&quot;,&quot;w&quot;,stdout);</span></span><br><span class="line">    <span class="built_in">read</span>(N,K);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>,x1,x2,y1,y2;i&lt;=N;++i)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">read</span>(x1,y1,x2,y2);</span><br><span class="line">        ++Dif[x1+<span class="number">1</span>][y1+<span class="number">1</span>];++Dif[x2+<span class="number">1</span>][y2+<span class="number">1</span>];--Dif[x1+<span class="number">1</span>][y2+<span class="number">1</span>];--Dif[x2+<span class="number">1</span>][y1+<span class="number">1</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=<span class="number">1000</span>;++i)</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">1</span>;j&lt;=<span class="number">1000</span>;++j)</span><br><span class="line">        &#123;</span><br><span class="line">            Dif[i][j]=Dif[i][j]+Dif[i][j<span class="number">-1</span>]+Dif[i<span class="number">-1</span>][j]-Dif[i<span class="number">-1</span>][j<span class="number">-1</span>];</span><br><span class="line">            <span class="keyword">if</span>(Dif[i][j]==K) ++ans;</span><br><span class="line">        &#125;</span><br><span class="line">    <span class="built_in">write</span>(ans)<span class="comment">/*,puts(&quot;&quot;)*/</span>;</span><br><span class="line">    <span class="comment">/*for(int i=1;i&lt;=10;++i)</span></span><br><span class="line"><span class="comment">    &#123;</span></span><br><span class="line"><span class="comment">        for(int j=1;j&lt;=10;++j) write(Dif[i][j]),putchar(&#x27; &#x27;);</span></span><br><span class="line"><span class="comment">        puts(&quot;&quot;);</span></span><br><span class="line"><span class="comment">    &#125;*/</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">3 2</span></span><br><span class="line"><span class="comment">1 1 5 5</span></span><br><span class="line"><span class="comment">4 4 7 6</span></span><br><span class="line"><span class="comment">3 3 8 7</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure></details><hr><h3 id="P3128-1"><a href="#P3128-1" class="headerlink" title="P3128"></a>P3128</h3><p><a href="https://www.luogu.com.cn/problem/P3128">P3128 [USACO15DEC]Max Flow P</a></p><p>这道题同样可以使用树链剖分做，但现在我们试着用树上差分做。</p><p>这是一道常规的点差分模板题，直接修改加 $1$ 和减 $1$ 就可以了。不过我的 $\text{LCA}$ 还是用了树剖。但时间还是纯树剖不能想的。</p><details>    <summary>AC Code</summary><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;ctime&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iomanip&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stack&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;map&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> gh() getchar()</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> re register</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> ll;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN=<span class="number">5e4</span>+<span class="number">1</span>;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    x=<span class="number">0</span>;</span><br><span class="line">    <span class="type">char</span> ch=<span class="built_in">gh</span>(),t=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(ch&lt;<span class="string">&#x27;0&#x27;</span>||ch&gt;<span class="string">&#x27;9&#x27;</span>) t|=ch==<span class="string">&#x27;-&#x27;</span>,ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">while</span>(ch&gt;=<span class="string">&#x27;0&#x27;</span>&amp;&amp;ch&lt;=<span class="string">&#x27;9&#x27;</span>) x=(x&lt;&lt;<span class="number">3</span>)+(x&lt;&lt;<span class="number">1</span>)+(ch^<span class="number">48</span>),ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">if</span>(t) x=-x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T,<span class="keyword">class</span> ...T1&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x,T1 &amp;...x1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">read</span>(x),<span class="built_in">read</span>(x1...);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">write</span><span class="params">(T x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(x&lt;<span class="number">0</span>) <span class="built_in">putchar</span>(<span class="string">&#x27;-&#x27;</span>),x=-x;</span><br><span class="line">    <span class="keyword">if</span>(x&gt;<span class="number">9</span>) <span class="built_in">write</span>(x/<span class="number">10</span>);</span><br><span class="line">    <span class="built_in">putchar</span>(x%<span class="number">10</span>+<span class="string">&#x27;0&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">checkMax</span><span class="params">(T &amp;x,T &amp;y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x&lt;y?x=y,<span class="number">1</span>:<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">checkMin</span><span class="params">(T &amp;x,T &amp;y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x&gt;y?x=y,<span class="number">1</span>:<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> N,K,ans;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">DT</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> next,to;</span><br><span class="line">&#125;Edge[MAXN&lt;&lt;<span class="number">1</span>];</span><br><span class="line"><span class="type">int</span> Head[MAXN],Total;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">addEdge</span><span class="params">(<span class="type">int</span> u,<span class="type">int</span> v)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Edge[++Total]=(DT)&#123;Head[u],v&#125;;Head[u]=Total;</span><br><span class="line">    Edge[++Total]=(DT)&#123;Head[v],u&#125;;Head[v]=Total;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> Diff[MAXN],Son[MAXN],Fa[MAXN],Dep[MAXN],Size[MAXN];</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dpTree</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> last)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Dep[x]=Dep[last]+<span class="number">1</span>,Fa[x]=last,Size[x]=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> e=Head[x],v;e;e=Edge[e].next)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>((v=Edge[e].to)==last) <span class="keyword">continue</span>;</span><br><span class="line">        <span class="built_in">dpTree</span>(v,x);</span><br><span class="line">        Size[x]+=Size[v];</span><br><span class="line">        <span class="keyword">if</span>(!Son[x]||Size[v]&gt;Size[Son[x]]) Son[x]=v;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> Dfn[MAXN],Top[MAXN],Cnt;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dpChain</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> topf)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Dfn[x]=++Cnt,Top[x]=topf;</span><br><span class="line">    <span class="keyword">if</span>(!Son[x]) <span class="keyword">return</span> ;</span><br><span class="line">    <span class="built_in">dpChain</span>(Son[x],topf);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> e=Head[x],v;e;e=Edge[e].next)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>((v=Edge[e].to)==Fa[x]||v==Son[x]) <span class="keyword">continue</span>;</span><br><span class="line">        <span class="built_in">dpChain</span>(v,v);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">lca</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">while</span>(Top[x]!=Top[y])</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(Dep[Top[x]]&lt;Dep[Top[y]]) std::<span class="built_in">swap</span>(x,y);</span><br><span class="line">        x=Fa[Top[x]];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(Dep[x]&gt;Dep[y]) std::<span class="built_in">swap</span>(x,y);</span><br><span class="line">    <span class="keyword">return</span> x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// freopen(&quot;diff-tree.in&quot;,&quot;r&quot;,stdin);</span></span><br><span class="line">    <span class="comment">// freopen(&quot;diff-tree.out&quot;,&quot;w&quot;,stdout);</span></span><br><span class="line">    <span class="built_in">read</span>(N,K);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">2</span>,u,v;i&lt;=N;++i)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">read</span>(u,v);<span class="built_in">addEdge</span>(u,v);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">dpTree</span>(<span class="number">1</span>,<span class="number">0</span>),<span class="built_in">dpChain</span>(<span class="number">1</span>,<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>,x,y;i&lt;=K;++i)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">read</span>(x,y);</span><br><span class="line">        <span class="type">int</span> Lca=<span class="built_in">lca</span>(x,y);</span><br><span class="line">        ++Diff[Dfn[x]],++Diff[Dfn[y]],--Diff[Dfn[Lca]],--Diff[Dfn[Fa[Lca]]];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=N;++i) Diff[i]+=Diff[i<span class="number">-1</span>];</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=N;++i) ans=std::<span class="built_in">max</span>(ans,Diff[Dfn[i]+Size[i]<span class="number">-1</span>]-Diff[Dfn[i]<span class="number">-1</span>]);</span><br><span class="line">    <span class="built_in">write</span>(ans);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">5 10</span></span><br><span class="line"><span class="comment">3 4</span></span><br><span class="line"><span class="comment">1 5</span></span><br><span class="line"><span class="comment">4 2</span></span><br><span class="line"><span class="comment">5 4</span></span><br><span class="line"><span class="comment">5 4</span></span><br><span class="line"><span class="comment">5 4</span></span><br><span class="line"><span class="comment">3 5</span></span><br><span class="line"><span class="comment">4 3</span></span><br><span class="line"><span class="comment">4 3</span></span><br><span class="line"><span class="comment">1 3</span></span><br><span class="line"><span class="comment">3 5</span></span><br><span class="line"><span class="comment">5 4</span></span><br><span class="line"><span class="comment">1 5</span></span><br><span class="line"><span class="comment">3 4</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure></details><hr><h3 id="P2680"><a href="#P2680" class="headerlink" title="P2680"></a><a href="https://www.luogu.com.cn/problem/P2680">P2680</a></h3><p>这是一道较为进阶的树上差分。我们要求此时所有运输的时间最大值最小。这样就会想到去二分时间，然后用 $\mathcal O(m)$ 的时间去判断减去一条边之后是否能达到给出的时间。</p><p>然后就是查找 $\text{LCA}$ ，我还是选择了树剖，似乎这道题的倍增会被卡，<del>不过幸好我不会</del>。（有生以来树剖的预处理居然写炸了）</p><details>    <summary>AC Code</summary><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> ll;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN=<span class="number">3e5</span>+<span class="number">1</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> INF=<span class="number">0x3f3f3f3f</span>;</span><br><span class="line"><span class="type">int</span> N,M,Pte[MAXN];</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">TC</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> next,to,val;</span><br><span class="line">&#125;Edge[MAXN&lt;&lt;<span class="number">1</span>];</span><br><span class="line"><span class="type">int</span> Head[MAXN],Total;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">addEdge</span><span class="params">(<span class="type">int</span> u,<span class="type">int</span> v,<span class="type">int</span> w)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Edge[++Total]=(TC)&#123;Head[u],v,w&#125;;Head[u]=Total;</span><br><span class="line">    Edge[++Total]=(TC)&#123;Head[v],u,w&#125;;Head[v]=Total;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> Fa[MAXN],Dep[MAXN],Size[MAXN],Son[MAXN],Dist[MAXN];</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dpTree</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> last)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Dep[x]=Dep[last]+<span class="number">1</span>,Fa[x]=last,Size[x]=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> e=Head[x],v;e;e=Edge[e].next)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>((v=Edge[e].to)==last) <span class="keyword">continue</span>;</span><br><span class="line">        Dist[v]=Dist[x]+Edge[e].val;</span><br><span class="line">        <span class="built_in">dpTree</span>(v,x);</span><br><span class="line">        Size[x]+=Size[v];</span><br><span class="line">        <span class="keyword">if</span>(!Son[x]||Size[v]&gt;Size[Son[x]]) Son[x]=v;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> Top[MAXN];</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dpChain</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> topf)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Top[x]=topf;</span><br><span class="line">    <span class="keyword">if</span>(!Son[x]) <span class="keyword">return</span> ;</span><br><span class="line">    <span class="built_in">dpChain</span>(Son[x],topf);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> e=Head[x],v;e;e=Edge[e].next)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>((v=Edge[e].to)==Fa[x]||v==Son[x]) <span class="keyword">continue</span>;</span><br><span class="line">        <span class="built_in">dpChain</span>(v,v);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">getLca</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">while</span>(Top[x]!=Top[y])</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(Dep[Top[x]]&lt;Dep[Top[y]]) std::<span class="built_in">swap</span>(x,y);</span><br><span class="line">        x=Fa[Top[x]];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(Dep[x]&gt;Dep[y]) std::<span class="built_in">swap</span>(x,y);</span><br><span class="line">    <span class="keyword">return</span> x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> Diff[MAXN],PathW;</span><br><span class="line"><span class="type">int</span> X[MAXN],Y[MAXN],Dis[MAXN],Lca[MAXN];</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">getSum</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> last)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> e=Head[x],v;e;e=Edge[e].next)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>((v=Edge[e].to)==last) <span class="keyword">continue</span>;</span><br><span class="line">        <span class="built_in">getSum</span>(v,x);</span><br><span class="line">        Diff[x]+=Diff[v];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">check</span><span class="params">(<span class="type">int</span> x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">/*printf(&quot;%d\n&quot;,x);*/</span></span><br><span class="line">    <span class="built_in">memset</span>(Diff,<span class="number">0</span>,<span class="built_in">sizeof</span>(Diff));</span><br><span class="line">    <span class="type">int</span> cnt=<span class="number">0</span>,Max=-INF;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=M;++i)</span><br><span class="line">        <span class="keyword">if</span>(Dis[i]&gt;x)</span><br><span class="line">        &#123;</span><br><span class="line">            ++Diff[X[i]],++Diff[Y[i]],Diff[Lca[i]]-=<span class="number">2</span>;</span><br><span class="line">            Max=std::<span class="built_in">max</span>(Max,Dis[i]-x);++cnt;</span><br><span class="line">        &#125;</span><br><span class="line">    <span class="keyword">if</span>(cnt==<span class="number">0</span>) <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    <span class="built_in">getSum</span>(<span class="number">1</span>,<span class="number">0</span>);</span><br><span class="line">    <span class="comment">/*for(int i=1;i&lt;=N;++i) printf(&quot;%d &quot;,Diff[i]);</span></span><br><span class="line"><span class="comment">    printf(&quot;\n%d\n&quot;,cnt);*/</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">2</span>;i&lt;=N;++i) <span class="keyword">if</span>(Diff[i]==cnt&amp;&amp;Dist[i]-Dist[Fa[i]]&gt;=Max) <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// freopen(&quot;tree-chain-diff.in&quot;,&quot;r&quot;,stdin);</span></span><br><span class="line">    <span class="comment">// freopen(&quot;tree-chain-diff.out&quot;,&quot;w&quot;,stdout);</span></span><br><span class="line">    <span class="built_in">read</span>(N,M);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">2</span>,u,v,w;i&lt;=N;++i)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">read</span>(u,v,w);<span class="built_in">addEdge</span>(u,v,w);</span><br><span class="line">        PathW+=w;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">dpTree</span>(<span class="number">1</span>,<span class="number">0</span>),<span class="built_in">dpChain</span>(<span class="number">1</span>,<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>,x,y;i&lt;=M;++i)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">read</span>(X[i],Y[i]);Lca[i]=<span class="built_in">getLca</span>(X[i],Y[i]);</span><br><span class="line">        Dis[i]=Dist[X[i]]+Dist[Y[i]]-(Dist[Lca[i]]*<span class="number">2</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> l=<span class="number">0</span>,r=PathW,ans;</span><br><span class="line">    <span class="keyword">while</span>(l&lt;=r)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> mid=(l+r)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span>(<span class="built_in">check</span>(mid)) r=mid<span class="number">-1</span>,ans=mid;</span><br><span class="line">        <span class="keyword">else</span> l=mid+<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">write</span>(ans);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">6 3 </span></span><br><span class="line"><span class="comment">1 2 3 </span></span><br><span class="line"><span class="comment">1 6 4 </span></span><br><span class="line"><span class="comment">3 1 7 </span></span><br><span class="line"><span class="comment">4 3 6 </span></span><br><span class="line"><span class="comment">3 5 5 </span></span><br><span class="line"><span class="comment">3 6 </span></span><br><span class="line"><span class="comment">2 5 </span></span><br><span class="line"><span class="comment">4 5</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure></details>]]></content>
      
      
      <categories>
          
          <category> 学习笔记 </category>
          
          <category> OI </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 图论 </tag>
            
            <tag> 搜索 </tag>
            
            <tag> 数据结构 </tag>
            
            <tag> 二分 </tag>
            
            <tag> 线段树 </tag>
            
            <tag> 树状数组 </tag>
            
            <tag> 建图 </tag>
            
            <tag> 树型结构 </tag>
            
            <tag> Dfs序 </tag>
            
            <tag> LCA </tag>
            
            <tag> 树链剖分 </tag>
            
            <tag> Splay </tag>
            
            <tag> 二叉搜索树 </tag>
            
            <tag> 差分约束 </tag>
            
            <tag> 树上差分 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>2022.07.04练习题</title>
      <link href="/Eternity/%E6%A8%A1%E6%8B%9F%E8%B5%9B-%E6%AF%94%E8%B5%9B/20220704/"/>
      <url>/Eternity/%E6%A8%A1%E6%8B%9F%E8%B5%9B-%E6%AF%94%E8%B5%9B/20220704/</url>
      
        <content type="html"><![CDATA[<div class="hbe hbe-container" id="hexo-blog-encrypt" data-wpm="Oh, this is an invalid password. Check and try again, please." data-whm="OOPS, these decrypted content may changed, but you can still have a look.">  <script id="hbeData" type="hbeData" data-hmacdigest="ff1f45489e9ba452e4d5809281dfdec53c4dffbda9140adc1a878909a206efdc">b2cba2151d0d2bd8ad8f075cfbfd57d51a4d98b470a70e21007a9dd5433658bed914b7e93b6ca8bb0902c1ef2e4a250e9489215dc60b4036b2a0fe969f6bd93b224dbcdeb621de5db1a50f486a0dcbe9dea0972b81076dfb6a1602ff2bdb4bc3f83fbabe2cd8b7fe891658cec49bf173d782e7fed042edb5a98f4f18cb0b914ac219a9eb1615cf7b2f0a5fbc4c0574d5a790cf7855306b276404f5f923afbfb42c46e0e971c6954d6754717bdef5864063342d316d861ac644474b9ecdba1a1199d35e41387d740074b72bc76ddae0cd4367e0488e989e142e96808c860fcb546444039a2c16c284d8be0e0eedd6e6dda2ad4af496d794811946926042310ab7d1f8abd9462de7417041350a194acd9277d9b8850006b589be3cab66dd1774fdd7891ecb9380003213778084a8f99cbc9d0d6ad1e5183e088356bdfe99a2a44ff390d72a68b6e9c62d19a85c2e4daf43ed3832664c3827f3778b0b9a801edf3bb3859f4fd1f04ebcb52f1ddde6d00bf702679892f26e75c56065635e7edb66ad417e1f8f041a41ee720349f5e4b71b18d1312e74bae4f696db630fb383cc486bebbad64512be1514af1d6a15635e71833fdfe2a401e140bd0be8e3d3dd2304b62369b98deb99e52e3edaa5891a719e5aebac46c254b054436d5ce344a0d4ce910dce3479656b14dd90e5f0337a523d51ff562115d9fb03d20ad6ba522169f6e8afb9a8462695a81999baa5e3494afb7c52bcc7dc3193292ec6b32feab00aa5595d498d5fed28769af11345e8bb5d89fe4000cb4e0a4fad74897bf5428ee1baf236d2b3e525df546add4afb30eacebed30dd72d96e1e30405bf832b0cfecd927667022d4f1bde84e5d26e641df937a37fa595d6484613ebcc100d9073d5961c1ab5f372e3363955aa03171f235f0b402f73a8211c5ec14b292304cdbd240b2fea599614eeb1931a44e2c2dbe13337c2f25fc458b7db6b24f31432ffd7bc2c1b127d0df22ce21d204a016c514f71b75c953a632463e65a0f9910d745d5af5796aba1e32b3ad7551ec9f06007127708eca555c3e02358998591128e08fad8e498b4822caaef4b99529feed33d1a8184c5da4babaa5d8c0deeb28c83fdd7956a2a424ae18e5f14776933e9364e06ca7d7646fead79a8ff2c7b558fc33f6600bf69aadd9d45a3ba0d48af9e073f9dad9ae8fbf2710163d023b0952a08cb87ccfb2e8446096f5f0ce4fc8a1057df554432305c328bfcce38a5bf380370f6068bb2f307326c8fd0282080eca6551ddbf7997a8ea7fec569ecffb4e79f0690ff5400a56297b828de0411e5e7bb2635b98e7b8b7eb2d9bcffb5e90f198c9a19a03ea1f6c5b1c5bc5b825b13f5e8680ff351d6da338136ea66720b6410f9bb9f10cc6be2b7e8291080940f410aea3ae2ccd828b97f2f787ab98623a80ad15aa52b9b593a9c290052fb0d5f8c7b8e9d4428025aa0df6aea815a1d976dde697c87e1dcbac624581b9aca6be444cacd9366e48551dd63a19c65025605e19824aef1023ffdb4698a0edb8a08231861d59f56406af6edea2af11791367e70b89b594f6970e5e019be441518f51e795bb4d9e8c786f7e281db96dae3d96dd74cbcb31f29e1025cfef73234a9dd6cd5c8b1439b1a3292edfcd05d89b4e5322cefd8d57eb7eccc24ddf4f5f18bb4da2343bc4cd49e1aacd3d34f9f4f563d04a3b7462ec22b1c4be2ba736f31f48c8c4955472413995c3fe236d1ca797a9d2ce1aba8ec3c0587f35252054639ebc9eb4bab64c57bebea8afc3ba37fb99f727e9d818ec21b91f07318419b4f53031331359bd9c7c99f7a507ce6d444f854eea8c7379d9554ea9cc7b7230eb26b066a60ad72feea2bf4bc6729552d13a73c4e91b26a8f945bbf95c03e59106a96a1055c810f865eeb748284e62a8527793d8409068a4d9e0693adb22fda5526ecdcb1d7567a30b3060d947a2e7a42cc3ccd597b1572697be7fb19c7ace7471d2760f301fa2d61ae50155f8f7290680f421455001d6d2f3d5eed96575fdd971bfdf2c64edb4d42b221b0dbc928a15369f6cd2cfe8546812cf591af2451f1f0758c575fda7635ae0348573bf3979c27d05201494a3f2fd851e1268c0f51e26856e7797deef021fafd2147be49964d84b13a686873b5f80084132d0db99ff34acaf60fc6bb5181ee8393299da2b30b321f3dcd1b67b122ed6ca81459b90ec8390fe960bcc2b6882480677000cb0ad919d4cf4f53e2196f8d488205e1de6017856ea5b1d297a058fdbd04ffbce440ee7c9e131953d37ce1545339e40e557b78c5a94b9eef7a4b3fc6adf48aeed2042291e1195c7ba86d0826ec0a02551bcfeeabaf5951706a1a0108b31977c0f81be65bb5234e7ed5b6a3aab8367aa4114e8f84d20ffb39309cf63d2012a91f1a5a917548d21af6d3ff2523daf6a5d0dedd8f1e16d65406e38a0fba1a80166c23a1bf5cd7d3c8f7becf89642cc4f693c3064ca3bd04a4ca297e2a71b2b0bdadbe85bd3624e6c9524cd434c87c0e78f177067c80c6b00edde4fd219700840d8c4238fec2536b7072d37ad1a194af5359a086fd4801a8a976292e52c26094dc81e55d47c9b1806116e8e0d9797dbb23020f2c920f5273f360394d83a27e1ccc530a0c265ad00791046003032cb0b48babaff0f97fa9142cbb2ee7779609b52fe2f1286dc2ed7ffbae2684863151da8992e0d4e8b75ec6164b90638afdee481b39bbd25813b93959802764c139ff71805f5d3bd2d6622dbba4e45d5a821585185d8c9091094388c4a512a765e4181b6a7780927cb2a89f0ade74665f5c6ecc43c806a4220a8b57890879695c0d6b972e906870be3e383c180fe1bdd6712b9659bdb2c0e38f5144327d71a73891a833a1b30ccb3420ca39e639b0680e2e2ffeabeb842a9115d08730f7392e9555e8d764457617c4b5ea75f3249f6c6b333bd271d4464ca49d58bba78ad52cbffe649054ba9ac78d3e00692aeb880598f0ee167cbb4ab07f570c8185d7c6c01ab080e33a324490da91c6b36bd1c3ed68f6f96674c344f75128f374a3265cc7eea405cd133e8eea15974c529f844e029c9fc5540a73f2cb3ab38fb15434e3f6e1b809906a01e304afed8992cfd2044ab4ff1bc9bb8bd5924a2e4aa9ae3ba3aff0fc215131de33328dbcbe7dadb912eb63a45b64b301d7ef9e5eb74fe202193fa7bbb54357689f6bf84429fbad7369b006211f25921e1e7ee3ab8c95b472b18098c1febb8ea9368ea2fc914d2c3ff8ef400e5409ef63c55d892c56256fdb4513409f48b4d00a4a4f6be8586781e26e78bea1d335352a74f4b4926e36ec0d34360cf02578b66d66d0ec823b47c7c8b27b76a19a9a84c373b48e2e7c2fd4d4489ce289a0c6c7c03575186ac2e2d19eb6248131a48c2541e5e4091121dd6706e18e08fec834ffbd8bee516f3fced6e33195001f7843f0be977d722fc57d1f3c6d7ae8f9115a8738afa5975906bfe234e8b9f52482b4b8eaa565d9c37c292999bad2ee3c2508cb48d1849c1a139067086ccb158be583627d10aecd4eab429b9c0e97f25a4ba4c98c7729f89b78a13255b2d2a72cb03f92f68d01855d7404a9ed7dade1d123b31100da062ad05bb0e9a22147634ed0447e06b977d35678ff1c2c26db94a2e7d94e60023b6abd9434c6531ebd51278135833300e86b821cc2b5485e3c5373995b6539cda9f0b6432d99e8f70bc76c274ac080fb21060b4931a9d04750c50e5390a836901a6c00fa7aada1c012ce0275d666e3556833d0bad8fab914ae4d7455c7b8726f81cd0ecd28a732c8168e50f0918f9029dbcddd715a9daef1d02dd35333d1a1666c137d3713478a3bc28345fa12dacb6657b447018896e067d2872c3159f8a17a3ad49cbfce171768ed5a043d75810fd4ef40835d8fcd205ecd8476b0ad2aa9a5c2cf2e0d46b77cccec794a2220d2d24377976cc98b75fc48928ed520420182c9576458cc0e180af943fd19b045944e420c5416f1eae62c93f695b0dac8c8116314012c59a8bdd0b365f78102f07f469b0f86fc7da6ce137752e630a43f12a9be7e8b96f908303a1cd9b193ba9ef970fcc7dddecc1cd88ab5a327676c3e561576c9e4c6d0a99cdeb2fcab5e781900dc3168e1f56cb5a609bcdb7f1b4565ab8ddf76f5b4a71e56325999afec07039aae6006ec6998fbdd6f5dbf28bf9eb3d9d381184ca9f07fee1a5d8d78cfe1c45933912749de9943a3d9a984c9e80ea7a50dfb9b15dac01e09ba06ab594d163466415a3dec981e8ae94c1e59cf9edf6be418c6fc915fb52b52158239a3424330add700b2ee13555122e8a734f5c782504fcae078ec4ab330b80ad98faa9dfc56eddecadf64057efc1aef5f62e640b6dd880be0b25c0305528028f77a39e6aa03f018b55f5a75bde1370b056b9339f1866898046648edbbf6516324e48b39e3010f7f819305c05f6958598a2762c216f71269c635b7ea98a2452d9f55897fc24bc0793b14bb2641675e364435e1fe9253b864a96d2bef41faf6d6c13b2887d7924cfb250ba21746ffe1c79115c74b4689543ffb295d2bd46da7c7a7186e10a868310372358ed7a36ad6c8c928cc8c5f4fb45c28b62917052a0ed63ee82481f58c381f80266ba8d021b0296fce395b4579f97e0bdd0ebb4278d6ae3ec6d1663e57e648d4d596cf181058eedfd25e5ea67ab0a94fb43cf8631c40f8595121d52e949a124af8a56bd55c1cd4675d100ff8c77dd28d36f31600107346b0883233b63eaaa4dbdccfcfca67d9e6da755080df58cb2e270e15c9d9e4ec6de516d2a7984f561fe09af0bdafe23baa2f619aeeb752bad01ba53335ba88013024e5b16072668b09740ee4f28a3f5ba17988bb4247a089ebd705c340acbc76acaa36d247486aaa7ea4eb19b029ca7b6c29715467d3b1d79193ce15dfb914b1a8daa1ac169d623fba65c6e228b94bae14da48e137e1603066811ef20046dedee3aceb3a85cfbd55f33ebf51d51f745a3a96269446fd4e55b0665ba8eb91609fff73cc6c4232050b10a310fb7155a6bf12a9fb56add9e9fc5602ab5a82e05c43097e07e3eda0f50412cd98552c3591559178ef44a894f1302a036ff06e18a67277e5f882686acbc92049456c500da41cc5140b70c1894dd79e5daed1b2f04754de8081d6c0006aa1f8891d4b68cb6a4171e08486f26a14614d3f4f010aae7103b71d9c83dc7fba4a1403f036efef53a968e51878d1dc20d8ad3388071bb4dfaa81506d966115819c93388e076ab7f0085bcefa48e59296e49604521fa4914ae100f8cc9e4e932263be73101adda1d9235ff274ab81bb719c5709090f70b639e567088edaf01d99e794ac6187bebbd1d87d6351c4d02b4bb614fc9ddcf078ff7fad0e37b19cf17262309bb29033cbf21455fadb46f7eb6cb3f649d1b8326d4ce2545f3a59c2445c0ab2761b09ad2454a7fa82e5a5bfadd25432977a8ae42cdeefab7d5473c2db30546d83f7865766931f3bc905dd46796cdc19e6dbf0f89322cceb25117ceb4f56e7a4b4dccb9921e4ba0d212105fd3d00a178dcae657bfbf75d7f2068487e3624624b556038d48200888a7e402855e54741fbca36a2b6acca70b0490eee1a96cecd671ec21ccbe279321c04cf4b908004538aa745c816c84d5224d0544085042f83eefa0ac7badd9b2f6468ea948f7226dda0741953fa5205c37e929b79276092e6654d0006c784dae306982678b307e392a425e392afe84dd8b821756a3126af62166b112382c4ecec62595492ad62381490bc08059809429a1e817376c8e419f834e68b0c20e98c5b2cf6855d6a7ae6b6ce0a6fc017fe30c495aa4d2b7ddc1a1075ddf42f0d839d2e09efed616ecefbc19fc395e0458f20068a9a099e1b1222d8fab1e4cf4e086b0955f0757e8cf585ed154bfe491348ea7b60f1cd800a2f564e1276f731d20027fb1db2882bfaded7403d2602dafad3849d5b3277c9c6104043befbcf788984d76ed7a428b6f5fd04309d170af40ad3634334c57fe24e70a1f01dab3a1af2defcf4c3bf59bfceb3059b2d6f06b6a85176a79fe542568f7ddb35a72d00d5209f175de69f62718c7e758f502137b72dfb9d5bf4adf4f7b6e85a399fe217c71c09564084b7ed9f055dfbdba65580fe88271a52b0a0aaab2cee1188aa5a1fcdc16375c31fc85f0481c6501c058ba781a7d2067c552ad80e1fd30d5acfbc5a0abc1ef8f2be54f779de7eedfe85494a1feef6431771ed92cfc5f7d9ab64c5c2f2ab9ed7b3d33afd6ab8efab7b55a1715471ce7eef44d2222428f9546c2145e38a6f091586034de1041c0a65bb72cf8c0aa37bed459f339aaa8ce8882dd1f10d8b517eab492d081b74ea6ce911cfdbdbc3005bf4a7bccacc1f4f4c8c697eccc17da8ff2e2125f335a65a2bbc57e2e18124760f7ba67c4a8debd41bef8cf42c6491b555add6d2c02b1be31306a7ba8541f0ca7249a387112819d88c1ff1daa51a412e02e05f21e1bca9c24d228443b4be4443e204220586be23d3f079d96140237f28752cebfe821da58b43f73e8704bfa1f04fa3bd145fcad73428967a792489a2b1a69a0aa3444735a195a2e1e1890f121947895545c71b6cb3334df5b6db9185e53c88ba17ff50adb96b8121dd52b15081cad1d1e1406830e885bd06dc42fac71783bf2de8aa6bcb7b21f028726cd972bcab5a4e3d1da5c43e68f41139b937b039a6a3c053255fa81f50c87e5f215b11a65403ac85bc0d90ffe380a7fc7d95010f5ed6397c6d8f261ea8cd08d750486cf0cf6a0a76ef302c2b30d7e5f78b0fcee6a6cd1b329fd5f179d420dadb1052585ca0a1db63bdc5e9a2d93ef5640a5da880a38f5bb346a6a2633ec0b78f801c8d3316800da08c6d9d890579de1d9fb1b1371f69aa3ca65bc6b65454016ae58021b1f5f40356f7b929d7789b4ba0c980be2e3a8ec2317a757176946fb73f7c89f53ae1d299720d755b2814708270a95dbecd84d4058ab11477d0a15e6f27eef236e6bb4d9a5cb239ebd215fe08f3b8a6a8266ec41d8a1705cabb316f044dd935cc397d1f00f76041b87be721033f537403d0282d63fa17ef0c5d3f41cb20cff04189444f5f34b9d39ea4250fdee536b24ad18cfe74c2db16d7061718f9afdc93c4b795807acedaee57802d45e0cc5fd96e58c6af1f6166a2831c20b8eddeab048139714c06127e070a1d9f64750796d9be25e98c36f16cfa60cdd2f391b4cd83f8ae3c68a291075c60bd24119226c3ecec40d0a5c8826509f7ba51a0147f2dc7409da669ec639b8d3f8efdd041e7083a43dbc36f15f3eca9048affe78de5962f74e2e506e8937530ad895dce9bece3c3103aadd9f0c9f57f23853df2fde980a3c3c27992f60a6f76f02a83633c0b40d2bb6fa160e10a92309fd6debf7cc48339e23b99b333f7177836d4cfb93aead48f3d224ea3c6ad1ec177028fd6e582adbdfea87805569f1cf968756c311f4cd568f1177b3d3c54b1f96c9d8dc2aca1687c791b857e2b2abad261a7f286eb0811a3f3aee224e4b6399bfc44c4b5a449de08469181c01ac13dcc566e4c9161af600514c8c5f1b2093cccd047ea8bdbb4261a1c01ce74473d6a1459db59ff587e52436266f761b27a7186cbce4db5239272225c62a2c8e63de6289eb4270157c93b27463bd32c4f05da03f981ca22e23385c23427e29845b140f1227ca338d7d08bfaaf569f180b20fb47bc3b57f9719a985fce5e5f8009654d35343bb05ef513a13bcfed244d0efb3a25cda0b081243695a792454e8a447cd135a95e85674e5bef050a15d6ec623db04b7ce9d668d95fb1996701489f68ffeb797ca943a15ead170cdd47f29f2ba41c9666369695c767b864c31e35b83084b48f2a94a788ae70e19b599485f927bad1a981248fe310c7bb9c9c56f8816b6837dcf07fed2e04d9a403cbb2162a6c6cbbaf424c1d1b37f1e929c7779b7190a00ad6dacfe341dafa7c202e7718a260cf3eeeddae588cc2cfbc6aab0515f39fd04874f2782e756890cb04e309d88fa05e7d0a803367b43cf5b8b92d583d8b717a5a2d1a0cc713cb53968182ae12ea1163c9ad5f33be17a956c445f5008e8b9e47c14b3712e29c9e58b917a7dd7224a1ed0a4bf4b1c3fa11556af1c96d330c7c36fb6d680a486942df4a44d792d188c7e83ab60ab754d4db5c90302dc12e05f78d05913848193d3ae49f219069803fde6124015a6dc945ae1d63c803f8852fce7eaf9b22b33e5252114e04d8a3c94faf6acd40db9ea6a28f28399e5387db6945e8ec93147d80e052b45ffe80825a759483e8bbbeba4d0b818589cbeb7cb23d183ff65f8a2768acdc5aa9005252eafb2a692d711e3561953a6944b236cbe326e3eb359272462122bbb62b8a0143ac2c2a99430d76edcdbafb03f6a0392a396263bbcb73321aa95b80af153e11ffb25dda89962cd6bdea05ebd3f26f98186f8f414c8d84261c4cebd3a200387d4467e7e4770e16d8b27a953d7a48d8ebcd1114cc031b28c564f4f56f9fe7095966012647881e10367dfbe19a23172e8cfed251d129cd831f91d5bf1d2e7155bc72b0d4633295a67570a289756ab9d9d2749116860525559304837d3597cdad0a3603d134bf84f3db8fbb3a069f2a8e1a6c6fadbc6a37d915229913d269afb655424db63179a2d073d6cc5d379a7b595a7ff630bc691c7000f0ada08551e643963621ab17d0b0d2eebe67465e8e74ec0956a8ea421bff025448ae851ee956d6bb9fe0d963b45ee1ac92e179616c463aa6128a6623c19ef4a60237ab7357175d4fde9762638ffe7b7e544a7cf288273c33013cf11f5c3fcd3bff9c4a22c43daf2796f763a2a24b79980bd78ae6a631a0fa0012e8205e01c55319e04392ebe9c018f90f69b0f6529df2cff0435f4583499db1b9eecd1166a296f425e3d4eb6e205c3d435ea3b61a97f4de03a45512825da3fd8932150dddd90c5d1987782f15555605af8d4ad9098aba22bc87e52fb5423ed0f1b2b699f74af02fdd2328c67b9ca8858e283673ca7ae75b726adc763260d70061b8ad70a738fae45f69a528f24739dc87dd6d136f57ac599e6ad7099123c9915448440daf9c375cec718bff7bd7fd9d4febf13b218e51c0518c2cc7e222299339c935b9fb290a20fb914b96d9e667acef99bc0093a4667cb6a4a2c6c419d0b28da73b725c22f461aa4fd68dfde3459068b4134421a3a1d257d7ca2906772743554b22a90963326fcfbfd72f505d1c5e50d7a77fe356b244d131dac9602433c419396be6deaa6edb11dea17df788cce7807ea9fcaa490e9e0f448ecbf39740cfa5f78ad41e55822377bcc668aa558898d70b0ecb7b13bbdc566a720c4cfd84da1894479148fe5cfc0e2dd2493431ae3bfa0af24a2f555a9571f5022eccc68c9acbc43a9ef142ed1d1788da8240d52eee882faba120b61e269b63ee350b9205ede6a9a45e26e420ef6f047558c400c868102ed3bd938c215e12d0b6b46cc4eba0923bdb9de1321530fa3ab822ff68de0cb2557c969fa64c129a31c4feb8709cb806cd31b642bbec928b7b59fff5801b2a43944c36a86bb1ca9ececfb8896332d8bceee014e64a44e778d8961a7d02680d3f64f58f81e1043a998f23f91216dd5f3b394dd76de9dd177d935c00c63adafaea1fb120d7f459cb539b727a54ae057e59550da25de2fb08ad6a47d88e828fe4747be2ee96e898d42639582f55fec1d92089cc30ee931a5f698a00e9f81851c0d5d9bb1928b5b8a5e78cb3bd93f386ad297a1cc8169d3571ffbbe1568c94f81237f57a74b92b4254360ece32574df1fee5158e0942cd916ff9b3fb26cf718d49938f5de6b0ffec3fb48a3917270a984bbfee84ef879137e669074327e1cefdcbac8512f78142ef290cf291b1628c70364b4d94263723106a4efdb40b8f933f5e8b3571cdc1f9efa87f0c4bdd2d2e1a6eb6f0819cbecf0de212ae0d76e9be8264564c4f152db53ff68327e2206ad4cb65dfefc63e856f27abc68db74c40418bdd429e3ed57440ef047e430a4ac3266a38ba5afff16acfc846ba70e62a4f8de3fabd298975a8840570dd28924d042b1e90233da701fac2fb616037677cf53f0d0ffe83d96432170f2cd1072929ede44fc949e29bead39013261980c6c533d60ca42b3426de6679b239503e3e0e6d1503f4590a8ead1a8c86fa4f0522cb2b112446398e78e03279fbd3f457127d491190fa3aaaa096e421e7ffffbe1ca9ab453b952c75ce30fc0c9ad6b4d371f7bc6dc29ed7d3c160ef64bdbaf9db35619f71ac0ed50ac44069ebfc158f0277378184685cc558c043adb20ea0896cc02a7d62f0747d4f0ace3863c284e2e79b6cedaf732cf28ce6467dd4a816d7b2e21b402732885a57d9e7cb24b417b3a7b1d5c3f25bd4b6bfd3f112ebb06e1f090a392aea857ab88f58d5d372e8fc4fed9469c2a1d59d219657c3a802a2ebd74e6e5948579d4d07331d7751bf07ab0ff13517eca9b7493dd7ddbac7d55cb3fbec24ea0396622828d22addd260f1379b5a5d7417b7051f04cef40af3f5937829ea532a52e9e85ae9bf73058bd20d9d4dacfd323227a1ffbdc0ebe19d444c5b67879118852bb94942cf98f3e2bbf127d0909e930deff2c1898bb87aba4c601e17c469b66271e9beb5f00179937e26d9c80b0b683378ebcea6ee6b2b7e93fc79e6e465e9e259fd804ed929f44875af3f24faf618fa297c794b818577461300590d51a7667ffde156ae2933d0f0047b75b8732bbe6e888a7ee7102a000866627693a31b120767d24a5eb753011dac23a46a98cccac7454bb5c52688801b6a4bc5aa96413332616fef33509cf6cd1fdeef5934092dc9a1e6a66b8bfb07182c9141381c8c6f3f95cfb6e7ed0e25dbad9d0814ecc624d01d5442fdb3535117ce77ac94bf82030fde6c97c933de6c7a4445062093f0626857a6b70221f97d2080c98a5b8603060f26ba1f8ad1d021d11573b110f4c59923661491de252dfb0e38cb6ed0a247f947904f1b593b4d0c75ff5f70c7380f0ea8787950d18ed558fda41c7d9ee55c18d4814fc4fb6c0ff7f570857ea622cb5c463656cdac37ccec3970ec37e1d66fce1d356a94e2ca7a921ca225f012ab2f4b7e035c48724178a291e91e9202b9fe9ab359fbad216828886b04182acd084965f8c998ca05a843b477802e3127a1cd178bc26b8075451a0cc00db07f364fb265d06e10db8c6dcdfac01bcbf8e611c36add8c55fbc32dbf4b26acb6a41ab23b38cc2dc3e0629df00cdbd14627b9b14ef5163298f60093cb6d37e6f6a75d84ef23282155b879b49078d241b60c59f61673c2739a2c22705384d7105b9805ddfe78150826c434d92cfccba5b7265723ef47d2caf5fc1612a4be347a6cacc2beb523e5866abc02a18c0c456efae727bed41f413c2926980f1ec7919c66f017e26a3466be290a09d783ddba05e0afa4ae9f1ea914d6a305c33127605f5fe0d09012bbf9c29a9a5ff7739570d48a74ad1c2d4cdf9c76a02ce7a261b17d3c6ba3cd4fa23765d8927b527864bad4c3d446190a6dd2c193f1bb00623bcc95b8adf1c5ebc7418e561e77c5269d4f648561ca9ad3c8ddda041e1226de0f22e3b0fcf940d3990ad3c97dde7f9681f4409d5a7b5a4dd227a95c5583829158581976baf3303554159e5dc503ed5110bc4fb311fb28c528ba8cb283b1c70f379161db463f3c0935b2adf143a2b19548a11be894d24c930bfa4eba45957e2c6980f545d154afb2bdf838b05fc23eacb5ee10a1d1eeabb5e6965ef453f403f56c8ccd2d4cdce8a30aa0fc957187b20a337047cf640be2e1f108684c4e625f22519a716e952166c505e072932ceec084907e04586fc2c5579f83c740eab0161e6d58cccb0930dd24400d006cb50d7bf38a08543d9753208a3fdda5d16b25a6f3526eb53546abb97f90ed35cae825036d2f4a7f1da718d5e5bfe3fb9c001661af5becddfd001355ba853815e8016473ff505d515ff38f37c6741d502a77872e57aabc288048f8927755a488b0954e2e691e40886ebf43a2ce7eec7fb3103dd84cf0bdf95478d54d6886b082c2f52c13ca775bbb797c907b9d6124fdc2066cd746cdf5b50fcdc41c7f588d3ef9f1de4c3052915d58c782ed888527572fa1dec3b525e67fe0af60a2f64d3ad489f252a8007a9a723a206220a92dbd9621d7f9c7b510a21a4d87e6f2f6648a3e3d9e1e2dc2b3e460d458f6e492e34a9b6f7b754dc5e976097264ea8221b1cc4c3021d11040d4ba6a32477f9c23f61f0e7e5d867ebcfa4763e93aac56b846f3ba7686f71f76b93dd76804c820c9203a4998c522fb7d1ba0068dc4366126a05014f231fc87b8a417e4def52baf0be969f2e1086f0cf771796e3588ebec1de04bc6c50a837454946cbe738dc5a520b077f8e8ead660573e2a55fcd14ad965bb5fafc0e940f147d90bc806738232772ebbb8abe2bf3eb88eb2823565596abfed679da5cff8fd6ea297898b4b9742ee54bbbb224219200aff070d8fe9c98b8658751d2a02b333704c8c93aff8daec136ab6e0a4f851d398e01c9da64d4c6bdfa6df8abf2c318c10ecd041a2407a9282d57330103f262ae1181eb162ee2a3724612f5d243daf0a70e6d6ec097293f3ff85c35fbae90534c09f9ed0ba5bf2004af3e6ecba3b9cb5151ef20f5b422094a284bb414850d3c6b9a409d802e0576b15caf7632b11698ad644d775d5e4209f5f4f9cac88cd81bb0c4937dc533acbed9a43798f1609da32de2168f97d86686e4ec77ec4f6d3491d104b00c201f6c4112ab1c5efdba439cc2912a012dbbf52a15f4c29f4526294a09fe2e07623acc80ee04cfa3d40b645929d547542e9646df2413fbd3ec45d389887d9e22a7a2702dbebe4c603ff7b26b3e989c7b7cc311bc4643a904853b4ec5e444583387ec8321ee374e83eb7f8d9a1cf9ddddc3e8d2cb684ae79203674e6aa32800a0c3a4c032b9f9bd3bbe4cf07edc245bb02f80e08b1b00f1dd6afb9ef1c70c99cb5eb45575eb06ff93c8d53211942eed14413aaceb882bf12d207036a432daf6f1be65be281a829926b29666fbe196588e809910c27b356f3ec5551f34016cd259ab6f13602a18f12a566fdd2d92fc54806ef3660be8de522c66eede969ffbc5a111223869cab1f18a42e7bd6fe29a4db236cf5f65afd05fb914df768058b52e1d606b9c5933296aed81626f559a4747430dd2018b20493b42ae18e8e7406209dc02e56ddf3ca455cd012c3f3109488e0dc5ac05e87abc54af0bea7b42284983afa3eccf6c8031d2c2f7d1a81e063f50f9decc1d6fbc048309fcb234dc2621add66aab8723d5f0732f87da1e085fcaab2b51e01033a1188f3e952cd1b9b0d04d3d2e60912185571fa899fadbf8d2619674f5ae593c454991343d70802565ee9e0a6d76c91c513c38ef57ee8c7672e733e6ab86511e13ee4fc0ac065d24faa55d09a6a248f33d790b7ed23def7b89a6df65b045d1d7b295a6256f5c91fee0e603e7c6f50d75137f3b233cbafc7592e2d3aef1a4426921b63afb937584b66201a2c5ac95b40d947b478b27f3ab8228b378ecfd978ea40078f755853a986ec2d77c4fa8c4c76bfc6bd13d9dc036d73d8ebdba701e50eb0d271a159b2c2e593d45d8604e4061a3660d1780205dbc8f18dcccbe8414ed699efad22e3372b270f73f6235cd4a2df1c0e3ed5e7b143481519a206f6d561ec25b2946f888633e8a60b7bfabeda71f7337721deefdddcc652d9f50bfb5ea0cdcee2d04b7cc3b7d7c4983543a76b88f6f0a3c4653fa8a99b0db071d63718d670f45db7eb4da28e22091cf0610deb7a1192fdfd8e5c037eec51f82502851823bd8cf84bf9d51073923a329780274b91a0f09e9b9cda78af12f56a1dbfb740b8806397fe255ab963d63da91268144407fb9cca36ea4396eabb0dfc1c1fc001530951f2877936b84d5a20c4b6451a7df4d184bcc12d26fef58326b69c86273d4ae7b8eca643946dfe88d8dd3c3820f955c532ed466f68a8633010757d11ff9ad19799be1965b4a15f0d19a4f30ae2abb71f826b2008c09b7b91e842b70b55b9f473a93ecc687ff74c3ad30ca54148977aa2a2aa6823177bf4be065aa81e81b0a033f7b03e513f3cf560965f5cd5a45a30552dd2c03842f57d83e964bdfdb3f161fa2e3c1f07e14d41e114ca6ebcc4bb0517542cfcfa2b4a1f6b27d8b92b568b7cadc9d176db370b5427428c390f9d0154c84591f49635db12ed81123f26d30dddc2a1cebdd28d8a76ffa4aa0674c56a85407e9f0ae8e82de080cf8d562d2778d15bad91633724cc53b952f63978b5e2c5350fdf79de823d023f2548b8527e89fda2c4a22826aedf332c22d3d6288cbc80fb900bd19168f685a436619e158d74308658b66edd6200cdd5fdce77fa4a64dd501e755f99f33fea9ff1ede0b9d5e258a6bd48d46398839d9be6ff91549b6ab0aa165078d11920ac1390a0db9328e619494cf3d8f4b3dd4f29d3cdb0386c386a67feeaffe33cc35e472286469959e8a9426a7b916f5e77a217fa3acfad1ad5b18100ccda099069e3ff82266b3eb896df44fcf1bd261653ba13fa2f2f72646688ad0ff1c17c26b862f431fc3d6d2d672010f4e696b831bf528a4fd7bf7aeb2a5e5a40482af4775b5966aaa7112521c083196ac619ad5f2e46ec38c8ef2a1818cfc162bb0310f218a233ac9319083511072e5af58c4cab0f87003cb26119c989cdc295d280f4af61d199a354a6ce3a28bc41eaececb7c45a3b993143c3f66bf9ab7ee2d0c8bdff0951b42b6f1d48b72915631db51d53d397f145708f3b3f099f02ff883650d5b418a33ca0b43fb8ee54b86484625c21e710eb943650a4c5ce4766c7c5e7d03c6a861bdc3abf816527fdc7bdbfbde9035cd2e4901c01ee5013d48acf655647b758147b5b317e0ad15d7c65ce52f2edc30069b47bfab6a4905e9b5f20a5033bb63495c558107772f915edb33defcf961b047517eb08bf6d62869c0ab1a091edb8f94f8c2f8bb19b994ede83926b1b6fd8ad7f947f5c4c2aa060a105ed26456bc92f116d7c1475f74bf68e66b554b5b64025bd0f3bd4b2d3f7b44504c658274242651214e6968d3f8bf2a63c65c14bea4983cbb29ee41adbd65f31de92c09d436375e9ecd823f3d290d5d7b6e8aa5a3275dd50e02ff7fde1805336d288624d4bae8bed1c9d191479762744879431ce58c2f9883a91f2c085e9aa464101453100fcb6c271d350b11b2645fb652d22b29f7640765ac17d16c1c1e06123c53aa70ec9734ea3847bf9be23a24a5bb3e2ba302f216b8dd0f14daab83cfded693400bf18dd1fc21a5711ceee842c90431317e4e48e526aa9a502910727d92cd37bdd653f3260a97bb5ef546cb101e951229970e33c1663d51be906711672d80b5df133761c0aab38c4f900561c51e95dfdb8d6a03f3ce42bb85f3afbf35ba407a1df4da602faab952e31bc64aab61db8c8d2f995826fe7e28bd25df0126cf1a81f2049a8b8e6e6d7a2fca3cf610eb8f8468933273115149e1f1431a3450292c0581d5250ddfcd1c8328c747fb7eb3df2cf109bff58d1e044c548ea64a9595892080b0f7813f9e2ecd2bd79fbb5cd2846f26ceb0aa856a0f7c3e582dac58991852e1ffb56ce02c48d37f6c9ec17156eeb4f7060bd868d8750135d6035d833d04b56d059f199d570f7a71396b11fab2441c0645e3e9db4cc42c56e05e6c1750097c83fecb8bcc88a5c2f15d38bc5017d2c1994aa5144d0f9d9dc1368e18488325d513a8e5acd6747c6a256d0ac35b5dd8bfbb8fb604a4924ce83b50be3d445706565f14a5c64cb3d4c530c398cf65041a0a7da540d22d95e92171b98c9afafd3ba7ffcdce5aa37bc1f77f887f939859d6bdd7e1a52a9a92c9c27b9998e53788c05c194ee40292d27fa57ba99f492be96412172c515fae7ae27db54f7e20c004ec266577e6642bb7eb8147723696b63ee402fa3c3163e3480610cc3dcd76748db9e74ee69bd6ed7d4069fd84608be761c2b097a0f23461f795f13bddc1a8368208185c494e2323b8d6685a76140b9164d50abf017aacb76e69cff813364a7bffc9eed3abdc6be0e5b38a01acecc4f34576e4a70cee704e09c3e103b5a73f505500becbc17bb9655b7c38113b0c2ad250ae17d9b844f9bf8b05ba5223a040e2e64376a217642516e6efb06f49c37f96cdb6ed1ba3b035bae416ddcdd413581fb369ff374e20111a9e339d8a3df2002b2a0fc3f3847c1d7ce47499e97a1f4867f7638c502bf41f3c594af65001c17ca628025bb9549507be1d406810261b1740b4b2bc8d26b837fe522b72ec01d8a72412cac98b91562e47681eb2d9945b5f249e5072f64ab9ed744a3963b7ad064ba74703deeadc91adda52a3b0ac04aac7d77f4fde2f15806a009cdc2662f9ebb5f771e30ca4d0e5969dd4eaa7880ddc07dc17c9f36c061a1ee18b82d37e274300cd16a8ed82f17c05c2f718b34b1ed30f0b49ecf3f9f5fea9c2a28a067bdaa8c81c0472368e655530e195891ed88cbc8864b3148483761d0536332d7a9f74291c9edf420c357b13a7c4655fd127dc59d0a235c1771649c1307f1d32b7a026c43e68732693fa3f680b3e2c39c569a825080bb9e2ed62c3aeb31f1f7cb4cd33bd67610188e86f905dcccf2479988fbb412816de1ec93532cc74534deacfce274190e4ed94969b6101f917e4de8f8b8ee60e45184dc2549dbccfe91ea27d121f20b4efd343b6614c85209226c6db7e5baf0b0f1cf5a3bc643ee79d90251347eaa34462667145ef0171cd4a593adfbaff8ed01a7393751878b92dc04847709a06fcbbb4be3fc7c4b3ec76af34c319b82c30bffe98a551c51717cc6098cc45a93e42b61a934a69dbc001520b7db4918b92a460fbcd506f31be628a17cb3a7bc3f2b389714e553a84c85c7e75a50f341477dfbbf77f2248fbbfa2bb258ac2a64815817e5f080de504edab0ba3c39d0f3b18d8e34fbd90aebfa4ed1df95a5f0e825c651a09ae785fdf1222e8d738939e1d751a4088cdaff4bf08901cc04ab6195e1bfa5ed4a1052fede21115363fbc8acea59e532635d4b4a4928524f4582ba48095677788a2afb79c1ae5c63bd2a59adc16656c947b66a1b91c06487dfac36d728ecbdebd3f2954f38fd1e9e21e5fcb73f4519a6a74846fc75f43ea7330d6d6b7cac1b7910ffee613b0d05108084e7a124560bde0f9864018a2717ab5e1ab618fa8624d540031e6e7b40085bdb80e65865fcbc66fcec471619df4e4240241f6e5127028e3054b715873424699772543789c264de2a896df3f42cf827ebe392e827d05bedeb4baac31f8807729d6e9d33613b802abb6e89b06451b5e7e05a42fa7613224f182ed47c39ac02795b1565eac5dab831866264a4f552c1310a9a18da3eb8bdb6ac48d12af9b262e4a504c61c0cf2e24a15b9416f34587e310cd74720d2550a170f2a426c6e8ebbb5ce03050b0ff6d911296130082b495c7ddb447e18321dff511d8e35d899345bf19e40397d33fe58ec9c6a8f9fe1563e943af3143febd0da67ce8ec9762fddbc407aa604ee2fc1779e02441871b558a0005828827700d164c11c91105c3ca061a1af2d0b9b8c2d82f9055b26785ee04118423bea3780a470bd603e9171700b7e51206d098ebc417dd6a7118d69b7f9c20757f6c7eb4fded95b58c19769b48302bd193cd739650d134d44eb0a96e74c528fa6d12d008768e400d1e67d0a950c5c394c74cbf0bfaed3095e5b0e1e8f5986e6deae4140311caa41304a8d15cb33e8a56aa11daaa4b0925c27b43e551934285333bfb4637433fd5e9225254df9bd394b9c917778d4cf03d576d3fb4a4c4d3de36b4ed172e3e998580dfee091e5ad4abb00a9b6783f680d4819a2cf991437b2c7ffdb5fc247ed1a4bf376be92b418f3703d1034888d42f16218688f6e0390418c04451f5b3332383e21a3d783bca51eac774fae0c5060b6df67d6ea047b944292448a6c67343e5c816e0005f1b3f11020d707753eca22cf1eae34f631d2718f641bcaa775758c809c8f04de5d206a1d3ef4b9190022da0ca860ee86ebba98452c23e6a6c724db7adb05c9c96d412580a680d5e33da48fd785c6e88ed4c9b5fd7e6bf1cbf1505b6c30ed372caf036108f457753f3d2b0dc326ae92cffadd37cdc922178b85f4194e3c7ff419abe0d99e606a82034e86746a9c04065618ed625ca62466cc003270a17f6ac2a14b5505cf26ef78884fc85c06799aee087a41daf2d72208bf81dd0a0a00259aa3427064b05f5f48aa0c37ed9dacf69e51ac998a782b0c91b346b5365585ceb0a826a8119fd49f3be17b51cdb6f93de638a5777fef95da4c0d73d1f187792272fb88943f32cc11963f7ae4f768b864bb55326be49ac1221c7ba05a8592aeb51285e1dea275d56a231ee02e4b9a33b8c1eea3b1ff38c4e80724fa4550b891fad8c7b9cd185acfc72d1325f55095e20dece00b0f7d505fc3433493b1b2c68c3ac85a6966ddd29d76a3ec1e0e2a581061c7c0154c8c2e4d3195d1c9f8dc9374fecf52cf1157ad57342092a45b6d035c45b30f345a3e9e409f9711753e91776a08718c652b7873c7b8d994ebeee2a12e8db9721f77b038434d204a9f087fedef3bdbfcd267059c0239c99ddff25d5772a7eee3b19918e724dfe194c879771ebabb4db8aea84ef49ccdbc122216827866474c132c573f27eb13023c48cd7ab1582af2375245280ce8bb3eff94cae9f9f110c9e66db48309e0a3fbe63d37dc018d842e64370bc9a1b3697108385e30853bb92085e33b57efac21d9b66bf560fde171b2e0153ec471fd09ac85e57f43c74bfc0975ee232f7e4c8833d555c978c65d5d1fccc2486dd1ef80291558b70aea9c31f1da9d3870f6f7d844e2329f38a410fdd387acbedb247bb0a0d1923f62e5eaab70dca8ea5491c55993be6b1477faee9d591ff1d4b301f29c33982110c7e0869a282c77862e3ff09fa45c5284082b48ce93c2564d6cedc05015e7a99c1a2085ae863c5e42786b8dceb66d009cf680dbf30aa179cab4f504dad137bc6efa829d9d3c5305048fa6f9b20f0a812c891614802944049356c0efadd1b7ec1fea3f88017c6afc9ead6a477e18f194fc068f5b92c955a5fbe4b1416206aa69195eae33a80d391506d44e1b736ffb682366df365f3193d61aa6e53c87ffba7bd05a560053baf90e6d1708ba7ed64b461e7590bc7b83b74f43168bfa3139cf0970a5363c1584bb72f66af4dc55db91119ce7dd7179dc348322de18d6537f085eddaad33b7dd0fc589645ae6b9157e4543f982a1628c99a6645b8af51007bcb99ac98d28cff17d4153592ebb38a97e14529a4e6fe92758d767fcefc10ba1e3122e7a693fcde2c2601468c0d83e1fb6648e840a8998c35826794a5a333b17458afe2e666f0d9c7cd37cd9446152f7fc2d692bf8e0c248d74207e82dab2be8291bb535c97cec4e61bd52e25424efb2b16e9581cd76215be5dc6144ad7be871f43a2098febf2725e95c627e9b93b9bd7dc0dded20a0e54824f5c20bc9db547fc7b52b8308650914227d3e1531a50af49a32f0b258a88f3128fe80a72a8e180dff92a43240ebf00c50e27669f204e359f52f8d92231b63d319340f04c58f8543b9be3b75831f8c06c2f0222687470dde46b69192846cc29c50b1b613812d19e1f0899a07f1266c47610c1f56c6bec41b907aa00cc01358b7a9abe38b1ce74b42c9db2402392e46e0ad805d00ccebb93d54db21b479967145f6ee24f6d195326d93a1d56dae975fe096204feb2e15cd710c566f382725f0ae16a3aa56cb5d0b41f24784eec291a925c4a49fa0e91b2bacc58f3395355de10fcef0bc59a649a9ef5f61d00b6433519984e2b635f9c151018fa40e42b53c8085e4f6ea81f4e91219d179406e52452b8d82f22ee303c5287a98b0312381c976208cc17c3b6ce90e49d674ec90360f5d28fff6b1c5342687fa8961656c2f65372bf853b195f1d0019829635ccb3a31442da5fc1e94055e5221066acab8643a6e07472c1f76f8827dcf608d3210c4bb23312b15934557201e49712dee952c580d9ec0e8911b3170367eead6d8455710835b89fdcde4a5d39d2cb2c39a69fe1b8db73420c3c2a74093fda5e6ae6d855cc02eea60cbce28d1e78765d755d64c9648b3e46b6bdd018372cde9fed8e05257ca029b7838e7919dee99dbaf83bb2f5edb6c478c234c755a73851fdee2fb783d3ce04c4a8a5d24774facd27cf63fa2ae2412e241264ae59b3e1c1de4fa32716fcaa115a34a5c25c3a3357144a1a592f827f4f467a6a216c67331914678e6374a3560f640f3d7732fd6b12e200d07045c6c2465a1a60cb3be017e1c752e9193cb31d278bdd80f6f92dc28313793437741bed40d868580c9bad9406b7e023cfcab31a7c64dc5149062c7af3ddb1ab9f9d2ed42f7a7bbec3dc66da74d054c093e146c0325360a487ea7c847a30545d95e2f6f22c6ff0bd3494a6cbc0299fd829b57249054055aee91f167302a16db139a8c765b0df273d27a2be30aec5ba49f02cd6a9e2bbb006710a31cbe21ee027d22c77650fc148720280060ba19519fff0473753cfaaec4ff93dd666cc2f9edaa8c7431014035919f52916a5f6008339a248f760424a7f3121adc8f363de9f6f2a991b9094d5630b41cafada09dd3bfa754b3f2bb45037b2fdc8adf01a50483f48ce61de53de2b94b7cc8cffe4b379e31272b64f09e73c280ca06b8121c4187573bdabe983dd3a760e525dec2218b3bc8a7c3af2c5f0cf9e8a1c589b28c0879e6fa87ec52528d9a4da6fbd4f33cd7aeaae34a0a1fa0d7b518bfaaf8b49708032ddd892b9c912f27dd2403896f5f09cc2f16c5b51ea9475c6f6f500e742bcebfe05f114905b2751e3f6f0c9c4eeba7b30c31d369ea4548cae05f7258d23fa4a215078d482ed67148525d9ba4d4863d860aa2099908330ea243a3d53b4a1b83ce8de953fa9c7622afe3c1577b5a685be4c2940d5599495411cce7d07816599b21ccfcccc1ba272dc92a8f2bca6a7fd9966fc8403406fcef3391c64d6e99d6d8ce03566b2c57582c1aa2655701a344686cfb9c0153cbb434c73d9ad9b40d8b32f0944ea6f6233cddbfe3e34320532540b60a6ae840020717f9d0cd3e13b9110182d65284459b2c8ad7b8c49e9604cd405000c5e7f7ae99cf7475661cbb1e56727608b0679309e536d4e115cde2b0b071041d6fc8f1ab9269a542c792872d2bcdf7477621c5c269f40a3126295e37dde5c08218f44d927a08d4f340d4be546f4a42fd4b31d717142eb3e21f59916129e6b4bdc5bd0d6c9bb77ad022d811226c7c061057d6fb8c90acb86dd146d3d65a4437fe6cbeeabdb2ee88a1f8f12709ed513f7337e87b5686966a7c9f0ef403e82bf9f6701a3c4acfb3d2046cfa9c6552b4d79bb8b947466b45336ea59eaacefa017f2b0e4ce139ca97d851fd3e1c126492ac216c816640d6c72e3bb867eebb4c68d40f7aac6911278d0aff9ee53aca1ffa09be5c3e9e948393c5a45e0d5a3020f144efaab7d62a2ed00ea35c995462acabbfa50e73b5da74decb5d9971d1f120cc301aa2c74898e0421aee5ad7c162f367abd4c39c772beea4c4aa3dafc86b1f03d4f13a52f9727c05ecdba0648b53ef11462f81266add08bd95a337e9b03f497be00f52e212f64d16769491a7b53a2699b2faf6f0487fac92fa97ce734fb702ead6bd7ad57315555f4d744a8d306aca390df24e44d9314a7b817b146e7f0cc900f0a9779ec193cb2fc06abf0561f12e6217048104097a82d31f26d82a065b600062fe1f661359e8664de47f3cf3587ecbd14e3c1b6e44ddfd66389babd3a4926876fd5c01b97b188d2a50aebe01a766771d3ce716db57c8ccdeafcc5c4e14b31808b77b7c8e441126cb6dc00b6b5020ea6ffee5a76ecfc4acc93e5733f67b29b47a95438b50d506cd031cd5f91e089eb46db5088d62e75fa474691116e6acdf46f8ab3ed6792ed53d3ecbdff5692af5192112d1a563c131f15503599758bc301deeb85de6825dad238eb755e60f532971cbdeb9e9f6f74fafb22e1876554341a22d80ede21d2fe3585fa90a60222614c33c28959ede327c8c9c33e57d141022f09ac1a24aec6dc8312ade353f2a74d5a789c3fdb45bd7678fb1e16a3137a8b20d674c360b86371f3cb2dc72fcc17f009fa6a363c6bc6f26855f9addbeb089bfc6350858928c57f55f1915db3dd1e4b9dc1dca13686a77a94358b5871187f8b6900d2b622f4f0660ecb48cadf681535dfe67cc3b1aa8e312aeb80c7d05d95020be0900fbe3ca6b8d2bc673c7a47f90128dc2f180d794d46c568c270b66c753a6afbd2121b9e2df570edbba267074d4b9ccb07d0882afd8781f0ff4635417ccfcedecfba437766587ec042f6de89df51957049ee6658e00779f7598a85dfba4dd7fda21391157da3a3d2ee38a7e4d7b6dcee6d71b1218c2ffb7fba311c201f8660d8f22599c487260eae0591cdf8d01e1c7fa1af18d71729e1dd475cfaebb9b0605748124943ba3d6dfc5c7a6b97064ab9d3ff9c1cdb55ca7043e04dee1857c484c5c5bf95ee9497535fcb58099d9dae3eb6e7311f24fc0bdc1320df27cc2927091b65c34ca315693e222b88fbfe5408de43a66632523459d55011924a184d1ff2c9bd2549e44c10400e1b3653b7b3fae9452bac76a50f75c2d295e1ef0efc2a0ec9099a057c850bfaccd8fa604fe33d7fc91c0d69eaf9ac289235a41347db58ac6aff60573ac525d302978bca881031604af4fdf82fd207ac1ab47ba21049fb305ea84077d7c86992f49386dc6064ee2d49dd9f84b13afe4095481099d105dcd690351cf44790099ec0a68bab4d6bdb8c97b34838f2f8ddd955f19083712fdaada6fb45611d7d0cf2eacbb85d80e6be3bb005f9e0b3c2eca1c796c5f5722f46c5d5a45a9c5fffe5b26e1ef519b667ba1777402b0777a5182c3f32183ed2ad9fb3ec1c1c880bcf4854e36fa82fda3b9f67a39930d3413704a44dda3c0c58430d2677bdb7e267a862f9951e282ba2dcddc8b780907685e4761f243b72bd7ae6db7fc0b3ca18be66047cd293103363bb0c0d828e0e35f89a30a4a05f6354ad98f45e90977918202749e90f06362bb1fc07efb15e7ea767405daea6b9942dc57543cbbf287137f12fc3b2606115085f7a50020c5889e9a8be4fd75266bfc8e4aba0dd638391f70a8f7f053b5e4096d85dc017745ba1bf67b079b1dd7dbd34dd3a326e78e7305f6088578a73c90c5015c5ff15dd79f88a4d440b5aa0440cf69a1b8716d5c06f8a543101c5ee146c52e871156583ab8d85e5edc9d61db6b5af4834dcce558c15917130765f15045f39995d0cf2cf70b9124152c3460e2adc43cd5a8de2d3b9930966dcdd18b8c79afdc8091ff317f466bc846261d76fc2b91ed2604ed622275c0f34a87a5058d1c775d846278ce52bfea58856c1d6dc4abd1dfd8ff8a79e16c94a054a690a4671ff85a5a9d5f5f6a3ee4996610bb22bc43067f216d1baea6da38cfd3b22967d1ccb629f7d25dbf201594ac6359d88c7b30400e679dd0c416da60aafd5b0717d06fcd05a9d2277d41a8ee1c4a1b335e405f0b21a01944c92c278c6a67f8818aaaebc01398cf41be40b95ed7be9f6a0661e96309953423418b5b5d30d41a04e4721c75e3811ac056a6cdd15214420a3fd5116bf41ec1b068497530063ae6e4da78d9b76ec356ec1f71558de2bd561d72549377c7eaddffb18e45bebeee454f26be7ec0a5c17a8be1285ea8ec82d0ed5f6aa758edaab3c7cf6024d684f5fbd0dba79bb8c1c7a8df6f8378ee4d7e8370e83440ce08d24c453262fca7dd7dab589a531ed8ff6100d044e6a322caa297b7cc228fcbd2c517fe63a038badcc734489dcc78f26e4b6ad153db19891ee14ea3a686ba1e0bff11fec484b62991fc0dd564f3e4bcd313919379a8866becddbb47ab1d9d8279654b7fa0e059e0bc7522882f550423089e67fe1b5e221c0ec19d24488ec581dd5827c1d4f4bab6c4fe291edfa69cc9fd3c7539132312e9a9a892ca2f8c7b1080229ee96afb37d1aa361525082fd09a41f5883851cbb266992cdc383d8c8ccdf0d8245772d2d8d197b08612e6736bf3eab7aecff9a6dc2146afb96886213d89cd4789516704f635d583c8d2a887ebac675ca5573324771e19384daec268afeef14f8e69f45dc30caf8ceac91e713e2b9eed3b2608b44023322593cd0323c341af1bf86048a89b657178b01233492371b030348d78118226f76c26df805cb70884e018d207b7c48b41a3ec71f82be71510a5819b2258c849bddbbfe17817a3594e44d0cc894ebe48b1d737b30f584d79c271f5abf3327d09216fe3ca45c8d5183af239f955b995a2305973e090890daa407d3f1c64d898c65c41ab7fc234a6f36c19a9aed9d2159de2b16d888fc59b470be80c25ebaf4f9bedce513a4b0cdddc62051d149e4c30239edafe04549b7ae873e820324c9b787a7794e70ebe1692dd9f984d91ee962706f1cfff46d9d83f91615ced995d55caaae0991fb60d335c94b89e9a688ec7869968dae4a1429816c318019cd561a0f4e61eba1b2821497d05d25ed109c7ca226e1baa13f29be110210233c0f00935f5df35dbadc6924cf43cf9398fd88c743bd205c96618bb47f38ec1b8136de44c065c8b96a72eec632437371dc322bd563e11e66f0e582ad78a364bea5747c8eeda7a50df336567dc963835eee211d4dc21fa2f5322c4972da1db7b52a269c5894c80f9e58f27e45c51bc987049d03d8976e4e22d608c178dcd7555ee11647dfe8723885632c82898a1db987429dacfc5542ede4c76e6b4598a1104b8e41e2a9751b4141400b776ce088cd75231f3c2220ed19e736522a25b49e70a98688f2e4b6b99bc46a1b948789009d784d4cc983c344e2e56ec9f3fd7c5337bc1ba63e0f66da0272b73b6bfe70739f185556b2f7840bb110e1fbc2cc227fde19e80839d78e59f34c464334311a2286600d11311946d4629a35b4a74d2f2b2de70cbf374c36e2467dc36b29a90e066fa4dc1eeb6d58ee6474ccea6b07c4c4dbb8ee4379621bce798c3077836428a22814cbafc86029402333b4d39fa63031aedf6f7b9d230f8bc10251c1986d7d143860af329b7b2da15171a1a09ac75c0d63488605fb0641bc16bdc78fef6d4ebe55efe75fd72082df3eb090565a7596bb10b5bfeb0c5053e5d92b9326d76239ee961737575a620042ad04891d09ea91693949dfc5fac0848e235bd92b0b9070b3e0140f0c4bfed8f540e04220199628dd8f1728952e079629bd7d21fdf1aa4f0a12061ac36921f072a7d3e3c7cc7fe4d6e7fa484dc97473f723e04217ed9ad0b15499c7db76d8f23f623d7dbd137373959ea9ff87dacc498604a9b096c168a38aa20ccf64a7bcc4eea507e122ca82b1a4cedf23235fa61cff297ffb2bbd9e9261debe33d39f2146a546b54b075c7f37edc69c67329fd34d2c5889025eb1f10b2a6735b3f2010ab7d4f95c91f1cfbade830cfc0690bdf7fa24c376db159930dd1be77993242af2372d1437f9390958acc90e69f9f15e583522465fb484191d6681a52c7a0ed8906c6c021e6436f835bb9da554e9f73171233502cd0a10cef1283af74aad964595036be972676ecb9e73dd699266d3923fae982abaa1be0610f88f0604f7a6069815672fd9ee7fb52019c3e73edb52d7bf439a69eed2483431cbe8f944d03b4fa2089feb3b69dd788852ed9d8bcc6900b7a792a1722cba2c543b08d952f08775c7abe42da1684efd35a89512406a66989198dd6105a4b8507184c4b2a690a0955ebfb6865f97610994cc170a46efa49ea97cfd76425275e20863a720f02c7552a660608f36eb18df4fc451f3ad6da588c19434921a47d7fe9caf26f6fd8923c084e142fb5ce23fa18e149c843b890e564e85e1c593dab7e2fad9b22d849e2256a72e4219a715225c9d9949898a8324017c14b7d03b382ca3fa883b6c28348982b3227facfcfb9e517bb857ef01f5916e53df087e64dfad0f15c32d4f7d02e8758e14adc088c2ea280a80b59590a227839bc5b951db003e5932927f7cf27f7e7ddb027c49e88766fbf65def8bad4977d61cb3591ac7f776120cc539f927a0de06cab1295325b5ee849bec564a0520542c5517debfc4ee8219cf674d72c636461edd6c6bf6749bc439386c451fe3e63affc46570b066e9ac4cc344cd6b1bbf9164fd34bf6eaee46d8e1167fe444e053dc4ea2839d9c9ada3ebd4c92c42bffb7ec5471e9dabd56d7d4af19883fb677f0cbd3a1dd19c87faab2a9ac3e1ab4f1a0c9e3d13be26bfb7ada91429be40856f900d0a6da28b32c31d351f6e9b9edb47a817ff6172c929010ad018b4424c0cd115e32a77928db0cf798fa7fc1b0407cc7357c2397a3db3434643e6ec07b3efbfcede3cc989a69129388c1daf117b692465325f597d22e38c80cb8dfe34f2609b67e1e11d44750e01f3671c18a3e4fe8b25569da1944d94a2cf5ea1bbca876d6b3a87076482e2a91ea9a589396431b73e9092e2078626c78eb498729cff0ede1c310c0a417d33bf049259174d7246f7d775d18d8d117eaae918372bf89d8a82f451c63139032422db66427c4d05583ea462d232425ebd9b31cc60c8cd38749f3d35bc9dc448f20a0a45dea449397b124f9ed6b16e748d1e7439ae1d334759661e4fb65e273edbb34942ea9f7faa66a4be81bb24669f22117bbc853b8a72ace66e3241570e0bd5de64b0fd8c59b0106333f373e43e3ef95f1b9ab837de5296bef9d0b4ea7bbcb0c8a653e07f9faaba19052749a25ca219338e41045e1367c2ed5886f0d5611268bdcfb3e127f0f5590469057ffb21d3c5511ad001ac39e65fec88663014bd61aecffc457dcb98beb9213bf8461d1c68a05e1067b0c1ab5d26bbef3b88fe8959fa78cfbe5eb19d792931ed1eb559ee16bfc7270d34236325ed2d075c61517919d93433c16cb4d1d8495be096e1e5c80ba1cba3afbac727c72a686810154cbcbd5225e3cc227a73e90b93d832d3ffa5f87cc13873853ac040c60a50fdc1907fe3c8badeb723201300df131c9da9ae0d8ee8d8e79864979408aa1ac4174a09155b1d904f92244662716e72488a3d692234cb64ea83d51de056e495e575f9c5bc5cacf321d01f65f4a2f0f08ee67dc426259c8e1ffc115224629b4ab592abde5042a3cae9931220292aba7f713fe22093350334c4e13c343fc13acd859d0e90f1cb905300726ce8b6ff2836ab65089c96020e85a7a26e9b078bf3863a480d30e56565357902fd6ac041ebdd6aaa6141d19eaead8f5292c4ec60d254fa2c2aea68a1f3da40990e5b7871923dd6e863db6ba7bdf808e18a7ba4a28b7bc727574aeb8284975fcc4ec66584064d61b958a9a1262e68f0a1c06d12b6b13b7e9c62ea299abd878c924ad4f570050dd98448f2227e6ab0a61c4350ae1ea2261281d85a8aaf0e234c876cb1d9a442cfea099aa0ebbee1f963c4e4bc6e76f868ea7340bc8349ab23cced0d4d96ec21e94e211f7d697ceee73bd19c735146a6c37be041b71ee48683963c83e22119b19fd80c9ed3dfbbd2362ceaa91198b29479c9853b54d257ba15015899c24cf82e78598dde5b52455f2d15b9c481cd916958ab06e4a218c9697e3cdec578fb64488e9e40c78769922d36706e14fc85ecd89d03defa260adb366b9cc441b3a61e8c69c74bbc38aed758a0e69b4b8fd432705b33fa0b804b211df12859ea2eef7a6eb3f4a2dfac27777e25ea36f9cf9976acb12474ba6e886dd44c75676abfb82d1e3a59623488cd4a46221b2e27ba7a074e219617cb7a4346cf85317ea8165b1c957cff184e9fc74d1668ddb2be69c239756d7caf42a8996232d0aaaf6ab250f5629c1f0566ee9c4427a3d4a96c729726c62d1ab1c807c60fa303fc847ed6beedf99455fbf483cda7f8636f297635a8857784a03f346d63a30ccf1ae507e698db12a2bd76f355cedeb90f6180bba01ee098d45fadbc1544bb45e6ef3d86057ab6409eedc43d9ce353e00d26b93d847122568b42e0f22ac0855b8e97fc70c57301cc046a2f0983a7920eb3c4c43e45af91005b01a029456b7a53627d6c7e15851ee1c048cb642d1ae6ef7f30c02b5550c3581818383352fb322db03c31aa53790501cfde496b59c5362ad78f5b72f0cfb82afd821c16d6e1b1d65a5659837880f5aa6c9e97a8f0c234cded2c2ea456c8bf0d4308e07f2d533cb341cae201c7a3f81ac247e9d7de37cab2a87baafd97010a1e9ad25ffdfee5e81c25d4760f79384842aaf80c0f3862dfbe2c8d0e72f8fb15fee0b20ce7235050ae57b930f0530510868c34c6255652c0b2fafdd0141b31668a7bd42028e84f5f670ec51e9cac2d977a1d73241af52949fb9f4fcb16b9dccf9536d92544c56236729c873ab679450ee345f2a5e4b7c8c059ed0a20cfc86c5fe495e82e5656ee07d553fc17226ce429adce3e383cab9fb6e6aeefdec91a12259d2756a32904420926febee300d336273b0ae253fc5bb9cc829c037a6352f569486e122fa72663803ec73bbf48cd2e5f6c953c492a78acd79e00f8692797526e2b61b5bcca64836ee7cf461184afd7ffff62ea906607eae9f52720eac839ca67522c0fea3a559d189d6b50eec0f43e18e853dbd6b54ce0bab41bdced22cee003a0517da44626cdd3da3439d498f9fa3321df915cecdb4666cfa8215ec0926534d68840a94823de602d95e6f1005a029ae5058efc05bc8d9702fb7d95ff56539b204f53c6e183f17b54473fe966ef402f569ca7907945f30f781a4e78b3b82d3f83aeb1e67cc665d97d1457aa9113b15da388b9322ef335fdace99096079c57b86cb05bf2e0641b7b7b2902a8434b4383806311321ec58fa01860dae8b09e8bededf8231e345f135b8ac8c232673ad0d20a76d0812cc11e0131aa0bb1a43054f61ee6d3a81d38609edd8c1d8bcd2706c4cefb146d501ebbcc1a77ee21be011a3f9636d388f812c43f9dc1b85d299e313e608ef0e4f862719acd5dab10390fce5e8bcc02e59b8792db4528acb95f0802a5487c7c0d562a877762e514edc1e8f9a40a84f3bafc66a4a0b37bfe4bdcd48a8fcbee90bf49d9cc9cba3f5527f54963f3d06927779baf52942b7579db560597b0093151ea54808186f8b211fe66e220a54e94a436edf386f067b5c65165be42aac6f7ba4e1f30b25b335058474c7c3f2f186ea4463c366aaf817987f5d67e2897eb4595fbd72f3d7214d394d8a6bd262f2472daceaf839dd6a6f74843359cc565b06cc74ae3c146dcd11a5ec70d4235cc922fad2eb9d2aa9bf7ed5263122e89f087bfa1cebc51be560a8fe89986eebe4147d68a734b840031177d88d7e94d98af51bda7c0d48fdbaa35ae59521482c3898eafc8dcb9d8c70d388f58907258170252926743f5bb7b17d17a117cd566597404595bbde51cf54c59ca575acb739d9bc13a63da50cdb5df58c157fa8526504f2ff72a0d232f9d82a346af215c517f322a9ff5620308e11f96a3de62daaad730684cf41b4ed0494b27111a786dc97359445618c55ba04e31032a9311abd7aa706a55a487c542ab88eb648d750455c066039b9ed0704e9cc3fcdc9eff74db1bcd3045cf5daea6854da2899e7a12066df6c1b114d519abdd0769a032b3d48dcecf9af81956c4f4ebe7694e8323d7e40847113b6d0759681ffb6985838fb9a1759e45417a47095ee07d875631d481062a7294526cd5375de580d54d7671b7d3b0b5553c1d399a637e0988b186db9dcb12612dd1bef8b7aa537b7c4033a03dbe5305a4f9250d11f0e458ca4acc3d9f4a5d2bec162139e355dc7d56e84488667e0dd1a33172ad4a4ca8490b15345bf7d5795ac369ca74b2374d075fe425e4793283a2cf0e744f21fa3d36d682137296dda004ebe2ec7e65e3dcad11e34fddae04f5ee86aaa8359560707cb5921cdaead6fc551fdb69d42c8b17358c93b132b482fdaab2efba8e7ebec1e6509a44a343c3b7502b592768862257348b4978206dd2d579d61701e93cbe70022f9a8c9bf9d065ea20fd9fcc4f219fc55e22d21894659858b90737b217ccd026d85c8febc4dfc8a12580b490354ff95a8711c1266f9f9755b2d65afbedd4afad2635ce8432ca52cf3988a527a9bff45b4d4aed83a1ae6a7dfa56ffc44d8ac51c20e61b62fd72e58f7205351d824cd2eccfc28e1e3dd0bb08e46c15d0dfb9eb0bddac2eb74b21b75487d0c691cdba0ed3147e11653fd39161dc0981d4e1ac3b211143dbd29d636547f066241386817b6ccb771dda56e9098697cb3ea672e09f7c4917f0caa01bb20b475f256632ad3bd82112020699dbeeaec8e088c8e1342f1e5a68752216b9e3b8ce3ebfe5bbd6cfc87704ba3715c4e95ba143be5c8703f575218c17f62c4821291ae13685cb8f884af229f263be4dc2b82f8b1dd3a7afa3c5e90f19c5bbdd2b1538a6a209ded9f2fea8a8dde62784cfa8919ecc6477a8f415bfe4461a306d138efbe1c8454197ccb2013ae4104062f326347bbf51f77177f7cb89097caf20f1bcf6c51ed4e3dd7bc5f83cd126d0d77edbb5b5c8bc68a6cc799d0e1588aa6fb2617780b1088dc779dbde25bf9d1161a00afa44ea5430245c6476e0d915e259d4eb6fe9c3dee1b4fa7696af0636dc1c145f92363dbf230b53040e216e715c5118ce662259c9ded4631645fdeec531f1923ec806446fc7ac2f8cf996e305ce0402a3ee1fffb1e7afd00af8bdb083c71cff7cd032af7e6e73bccc226765fb76d0e3001a383bff916d046a92279d49fc668aa0934de8bf9f1e939875b3c3a63ec0fd1470d8a900f0fd4b341221c2a674d96af1933f42de645f79673b004566f86096eb5231572ab58715dc7f0003d49257a9cf946457956c36b4fc8f754b8830d8aaa3085b3c0e265774404e655eec3cbfcfe8ed6979e6e7fb1459c435b64d832c31e09701fdf3f322e9e4577a04b75835c129fdf6de9071dfbc6fe20e7650513811c2695005f7ee8e9a8feff6e88c2cf84c2633e979aedb16221115b575b67bc67b397baf0d46c227b1a57de414122aaf5b7d58c3bb92f492ca44f80bd4d814ee9fe4c7ca91e8ccecce16fb6dc0de3ee501dae8a97b0f6baa53b35df506d2865b6c44c9bf0d3e0c5eebece2ec7c341f2f03b369ee548cbc0864d5b32cf3a0bacc7524dde8844f46a112f2f465b15733dc960da4aaaa03a7ba97f3d4ce6b8968072e27f745b83ad08b5adf9c6a12b38edf4a53f7b726c8b557d8b85e286a024a813b4324d4a32b45979a8fa6d446768067698b1646a4223a593fdf1509d34e456806c936c2c0709c20737ea0fc51429e9036c3c428c9ac3f6f0e4e311d6f58fe7d223e4c1647694151708247226cd6d34a13e21b691f3147ef46aec4a505d59587994960a58143eb41bcd0c83bb704f4fd5545a83092e5595f16790368f56945e2bf4652203b0f5297e4eba69ef11762621ce5ebdeed1dacdc617e00bab05c3a11a85310e8200a27d438ea878d61419b52a676d84c53ceac47d4561b344cfed7392922a2f61d93b1b36650879d04189eaf72ae4e634155753790309a1397357e8345707284d7d1be9cddf93501343b0812df774586000118468f38b3582fdc20bf342b5455f14c6a0e0c68f43ad5b0836ca1194d0b728755dedd23ca291db460930b7b321c8cad382d29095a4fc251ff257d206cb42ab2ff3c063a0ad6f6d978b45c83d6a79c61a2061cf93bfdb771613e43229aa2b3f6e926feb12d4381c8e0d2b2703df83011198fb0f9fffe70b5372c052a2de9cf7418460f0dbbb1a948dce797b01207cea0a10db9a1d06c148275c1d3577e0b6c96fcd55f2c646b395cbe1ac67a24b0b9f204e65af1dbbeddf14429df9596801ee1c49d891e86f7f91df4013c4c212f10930739cf3ae4dfd8c8122902144c0122357e6e1bcf201c8bc93592b742594a0a0bcf64fab491113a3f243e85448316cd0878f3aed45fb9c9d539b01ae41a74d171e094f38bd89141d161bc92a293dbbdb077087a54d2b90ede02f09578b2978971c636bfb9025390ff278dfdfbcefbd4a52e05c15875193ea95103f30465189ba28b05da12f73991abcd1e614e6e2f074cab936bb0066dd0a6c439006bedc3b57d15ba971226b999d516c9830ce33908a01da2a7572a78b9a4ee99509298d4c16c8621459ae43247b8ac736531ab5c2d433533fc6e6715edeb90e4b6dbc81be8486e6bebabec4e909a4c7aafe6a4060616ad1d4e672631d17aa753f9a8f596cebbbcefc77d4b5c4d4cb4d5f48b7a72838a1f2c74b97745a70930e3b1236c1c25918b8ca1df53da4d10d58161f0662d5bb16b74323938387ad6ad4d9843aeda96fe3b6a9e5ab10ec8e3b2bb368ab66aa21cec995042653116cb6fc8e6f79f4cce389e13f8a5578860669984f869d67d4366a8a68cd7e884659b7514ed34c287afd566ee2042b85a68f8c2ec9d7696300c29d706e7ed49dad807bf96fe145668bf8f9a97b8a600a88285c746a0b0d43761163309553f71561540f40557fad8fdf2473a8f8f72cd200338d9dd5cc5c24acfff46631475485c51a88a00accab49101ac5419f82a87529a9d63a627bbc129acdd4c3b390b272d836c592a84c29bcde43a517ebb886990d70f7822aa5821e2c74cb130c39861bdc6865cd314546096cca9ad058c4fb988e25b831a6a3e963fde8fb873ce0af6e8191082ababae95736c376551c6047f2d457d9fd1d69635afd759741a1e674b78d54a7c1679ed71bd8587f8f4bc445e3fdb21de7e433801d912204de54e06bb130ca8deb65019d28c2507f438e96f0d1a0561a649a9ebd89ff421a452902c72d5dd3f14026c96adcf7ed64e1d7149fa545bede9d599bc8893debfce32995c4980bf4497a53065d8dd734422257820727ed9eaeab17681a1603d935ea8ce0e5d51c89455dcd5d7fc5eedeca5d199409167c864972bc9ff7cb376cbaf1fba4ee0575a20d7ec66b3d94e869fe6af5ed0f4c45e8284e17f444d86659207d712dc4a97b57fac0085e5b7d550bc3a4f35ca2d056a96ef33177cf8c066851e91f3940e874e712efa42a46c9b7bf67486c669b61855d18e639abfce47225cf874ec06248a514924e22fd34cf54072b1b762374bf94885b47dcb0b77e10d378d16f65ecd83320a45dd22fb726a7560a5cf6eb2f075f6733fefd47e3ec10fd4798342e548f36f352ed6b62aeab7443c3787f0d7651568c744db6a05f47ba572d2ecbbd0b86b3521590c5ddff9aad22b123872cfa5f3d0aa20258b354d91029be8045b698ee843706a32cd0f36b02a5f19f1b57e77be8f2c0a3b06dc3fb491f3e086d4f38793d58baea1affb703d41d1cba2e03bdd9384b46ba83aa3f21c45bee8b40e68164887d41868e46fb0c5d8c082306d767fc7451403402541b71a3e2ddeaff1740cf40ceae50018901d8845df593b259fc7e6681126fc7ae5aadd1446d50a880a6850a6489793aeaee7911ee9d24e53dcab4409f49970e28c8d193ae4f842ffe40004e017742ddb327cf6856e5b4940033c794261e69c25a90fd2b85ba9e0ab2effc72917bccd6e41bfdac00ffc090abde4036a370094054f76115208050a641408a5bb3032d6f313afe4ee74005bbc82a57faa839f724633fc4fbd3b88d3d0fcfc1f9fbc1ac6a324f2d8e957c45d569d64d045440b6335c4a53085e6b806b5541cf2f1d45e42971e783a48abd56067b5fffc7c8a7a59d0fc1378e0b6515846239ae73ba8b89e094f6817cc4737968411677c111c1fd95d1589603bb7c4c0b3719d872b23782f03c2b0f11b6c2bc0ee34d214e79145b7502bcd0ed1e6e2c281d72f091e43ab0f066fcbe00b07fdfe1d9f437e8c7581698ffa47fd12c9b40a26e58e0d9516bf45d60a8770ed31fb6438d354dcfa78f5da98485fc59d7a695a3dd8a440658346b25cd489dec753d038d73920d3efd21c88bef62f38f28cb5a73934b5e9729817f8bc747322a13aeae000b02434ee20b127b9211f6afde64ec3dc067dc0c89bf74d23c82691661cf5bd9382bd3928633ca442c391249dd3693c570b55305c58eda5e166e8f001558605e908dc1dfd985c23789bfbbc19238738511f875da772b9d4d5b3b8586016c93854e69e9732e9bff5c8e913d7ac4feca3c6f57d16cd77a17a41fa096b4cb9847e2ef3d690c240d19b5ae8dde841c0f06c31577a50ac157604976d2482b2478f6980921369872052c4957e00ac48fc3de52fb0388bb5c254ceb822784650c97f9db639468714f48a7f071976340634f719c65b87b0f7fc62244ed08abaef1ccb0d8f23bb763fb5e779baf04ca6cc18f97cb50ab0d2ccc3e7212bd858f4f9399f4dc917fb9e4f3c8c518f36f0465826c0e4db329ddf863850dd319a0d55353d44ef37b9a6b765920dd836a2da8e80ec3c7c05709ce6b393e6f824f08efb631bdfcf2b6cf80f813aa71e46faf13b11e8d0c8da082a93cf3232506367452cb6c886462a09ed90b433d72bd88b0d169a966a93a8199bda4130f2b339413425905768b9298f2e9449ba2a93c013935f5e99f3dc5c082e6ea5d8134373dbc139c908f337fa9c2661f3bded690fd3da5287a86d277ccf788a9f489e7274375043860984451e56aee1ef5feddbe2c7dc33550f121cd3ef9f424e503413b26cf7cfdaa83425b43b0c53e653f113e3c920d4fc67e24a9986f620f4d75b3561b40e100efc15d48690829f78e4ac43e8ebac04df984d6b1a9c0ffd0ed410118ea3f7b2507634f0ce3d253d9d7165631c0235850114d2f327b741f043796a4ac64561b2f07fae40e67fd4b2b14275d2231e649d9710276f748bd7c75fa7c6db54b749a077f40a1c8ed8bc4bb94f8fafa22d0bed293dcdef5948212b9857d3ca2e498f38087f2c9ad680f7cf4f590fe1454730bab7edf5ebf464e4698fd4a2b25b14ad1bd614717cf76657afaef4e19dd12d789481064c41e0f00b28385f7de39c39cc93e879f202e187afe8548771ea4a81c5ef57c4cfb0c6e895a6f3e3d053866276844d259ebfc335a41600750558baef1aa417131be5ecbc455ed82735fa2b2dbe3451ff760817d942162e489d54871e1446fd79d977396c8ccc986e3d051d6a1560433798b411db715a1ee5701f53efd52ec4973ff6980b515c6ce537169b9f6615850031f144becec775e2735fc1e5ed27439e0f93d36ee4f9e031423b2291b4b89659406a78b4bcf99fb68982a1174750f009e578f0e49afae798a7f37c5d6730d0f7030c2d6d64fc0c453b89be535baac5494351a3164656895a1d1abe1665dee6c4f26770dfbef9cd346f942dfd71040eec20bbf6bf30cd868e350f2101c877bb606d6b126ae92618fa3f3ee18d53b7ca107d0e2d131a92a3595c30b8e2b5bc7d1ad3551eb75dde7887ec0d1b67ef94f6e07cb2a17b5fb0fca6d66181978014323564444fff9523d7b94510d6326fef5a4f0d2c789eeba1109335c8530b674fdc2d20cc88ee76c9175e2c01bd7432d6c934699093c6be4dc4c439f27871163fc2edda91a0a86fb9e264e5e3fb8567f3688bbfd9eb04a0829f55046ba078e52f742ad0529764787f8c788f58a1d5cda98fc38185bc19270c1317b3d9217e07c4c14ff0a208349ceecb4607244865652efd52f135619300a5674d7c70ac9b0dba9018f4f24cd3cff24394b5ceba23ebbd38779b84f656cf6903863be593bf2982952bede5fe0987c4365aa32da39b669db5338abc53665d040d3ab244fc930395d018895914b95c6a7dacb9522cc5988de4551c6826665f119671ff0fb457e0bc02e7cdf433c72b25db810226ae6eb1fa88655776acfa7470924f917c408ecb72a4264b8bad37db331ed7cdb18f1bd008b363d1f9a4625992e51777ba79450d19accff93ecd70bf28644b42f5f457984665d2d0d1d883285590bec697c42e79f7a98728f01b68b25d24c0adf7903a10b319bab9060d942730aaad96318e1d509efeb886d1bbe60ff3e02980aa0311723ba0f4723c6451f935e77da122603095ddb98373815605b82a8ffb6aa673b45e06769cb379d6ee5f956e9f2f4f05155b9cd40eb6dff33ead85da545b9775b3ebe04b982b4a514dd9769e8dbc49ab94e38d3d98a1fff34a5e6d96af98b577b38d2ae159cdeb76b749753ce33a47b9d6b8edf11d1c3ef792df370c532aa68f778225e0e283df5ff0b4dc4f6b81c6808296b6edb754254747152e65df85ab47e5c4e835c20285b1bc05249c4bc2344716e44d2c384c11b4f0da58e216ad4d50c322b8ea79b53e715085eb972529220672ae61b620d3359014d4ed0d1d70056ceb157acf42c607c473446fe5396f457476eb6744bdb72b1a6b3f3f544af78c2820248a02b34232343ee4521ab166cca81559881332721a33f371f0e2e20835e5ad74a4677020b4b51a8e1c3fcea1043e418c8987c643f116f28e6a899110729653f132428bf13cc4f56d8a1828730719449a10294ec5b1cff0a3088ff9bf7747d6e53f852ada1ee5f6ba13f3a2d509aa73771b8bfa499086083a51b5b332009be424d74255661e453d8a40690da527e889d2ad302d9b401acfaf47a273788ab132407cf4d8240723c639a4c6c2efda34777f1ebc960c315ca49b5b12f267a3913bdb48b6be7ecc2ee0e98eec14c5b4229c563b8eeda5ece186605f42c67dc46eee96786ada6852d6b1b7d704e3759b310058e1dca010dc6a73b116eefead173be12aadd9d15bf0e5b557fbe161b5088ea67e4181abe18f568f46fbf184b8e44e38b1400aaf4787b9ae78a8b110618fa2a7ae0983cf3bd722493d74c00f1580d4f7bcd8ce4acf79e61ea2c873e67f093e039a4b3d1026aafa858839abcf750ec3afb9dfbda6adcfe4f33e86a4a08c966f9713441b6b3a73957c0b9de70f85f2d4aada3d0fd509ddfde713a26cde4e306ab83181c1f60c09e092dc1a0c82ebec3b5992a52e3d26fb6fbcf0e23a86cd133a97f852a4d2e24aa0114abeb21fadee635205170277cb8cd4c42b320364ea41fe25f018742564face1bd7282e96c707bab436ca7c70dd4479a901f74e44255d142e0e56d8ddf280d8868e89e5508f29969d33b12061c940d2748df10c0616985b8adcdfb98fe36daa7aa40c84ae79f84f0d78e0559e171a6f4e32a37a5d7e3bc68f5dbfa83723c2736c7e7353bd0ecf0aa1c4e0c2497e477a2d79d4a9fe4b726cd43a7c790030af816e99ac1aeb12aed10d8d89e768452f1717d6198c9706ebb5b16d73be94905f6fbdab88369eb2c07fab4594e0f33639c09fa3008a4e4b3fb5c0769e6c2b7b8fbce2511914a8feebbcb1ddca25edc2494b4b292de172d0fb9703b09e141d2fb9e25b121388bcb50fbdc0ed5dd7750fcdd126b01c9c32890cf8425e5f3754e19d2a9d42f86cfba73dd46f38d0f29559bf36ec14e08a5bb406bc0906d98006171dff240c53332f0fff93a8655cd6aad4bb1cb88f4e98fefc375ab6bb571229a77e0e94d56adf028189d3a6a741558d1a258982573c12b4369e4b02d2fe5ba89a1152fd46a47e6894b0260bbb71e40d2186c36f0c0b13d949789f1f42357cdf9dc47fc29bb2422fda46f833f33e7459f07825be51e6ff678e555ba136db32719492694a2776e638c76d61f8ee3ba2103acf5a947f55aecfe928d3e2dafe5f714b25a87837bb59600d7a36817ad2fd052a3d57f34aa1462d6a3e799d271065af440e0e19ab60ef04b64802ef56319ee581f6baaeb4d6e6ba6b11c063f639138a37d81dab297815118e9e1173a1113c892a8501fbde60b7fe6bd0dfe2413173f4b82ed5cbc2636b83f3a25cf8ed3e241d6eca4587fdcc6faf0eee8fc27886fa0221cad219bab941e7647891fb6c4879457c53d800ecb797801960f38fe80b81b844fe07e1d7e30e60ad4e1fdf79c2a92e7aca870d286bdc588fa3dd54f86e3f5e9d2fe4db0637b073fad4d94c3d73aaeeed88cfd0d60d5a14e1d8755a3d2b496e158d2fe116c4067ffa9a347088ac5578fa72ddb28b9603a7a91bbcef4c8dcfdeffb4d1fd048d19df573d7a6a5ca4fb92afef91cde7b91f213af5a3694d3ece1019ff61343464173f12d2c8d38c721651c0f2ad2129806bcffab39c17dd6db78aa8593d6d1b2ac7dcded8aa7fb5f5b005882c8ea401dd6c2d98851ab8757053b19b5ac90d646077b9dd25e77dab1d134698931450b3e68ce50c9179ec7c65963f51211e91af45d1821a70b8ee089af05c849cc4b71231c4cf70b6f32535d2f4b47c9209fecc11dceeb98f18bfb71c27fdbcd8f267516f3ef6b9aad4d7212af086246320427ec46270b0e007174d9446a6d0e5bc8fcdd1f769a22d26f83097f3ee07eef393e84cc4a7e32fb3beaf48615856f5e59e8c554c347a0fbcc5808c74dc8ab8a34bc454d2b174d9f784cbb87e525981826d125fa9b69b9b9d0a9907d0347a94760b874daa5bc9cb78d362814199dac152de50b441e8a067399a3a16b7b907d251100be3025c338d1344eba95563c3ba5e840186f9bf0e81d5d9a07b1cb686cedd20b1994d60fe2dcbb9e063a865f21c9efa540c95285fa41dc69ac5511a128882ef5cdac218d98c49188ce1ea37164004c25a04c8947508dc5fdadbf67ab227ef9bdf5ee74609eff4288dd801bc1240594b640a55fb0aad51e7d94e9b681a4a8cf8c456c271a848c990dffebc3a88895dbdd1b57e29ed2ddc68a3689f4db9d24a0031d6655cbfbbecbeb5253b87a1f55673a5611ca6d203200f4e6b79e2687689e34dc62ffe8aea674400fb996561942fe5c4b9809b9a8dae2f4f6f54e68df165a2a60a51087d33f2fcdebfe5ef6dfd44ae6a229673f1754992673995f92b67244d74c6134076c430a1cb8f9d49f7c555960a91246c6920f007a99009e227f54002f279752ef0938813dd3533ffa87a216d46bbc68a9d801745ef04d9d42095ca5d34e05858641b9947ccdbacb6f900f362a061190f0ef3e281f1e786dd33c661ac6bd42551b143d44bfba5fea4afe3d32ec76c2bd6f36f261b743b495954d56a8e04725aea29675ce4440034a6f0079353ff24017bd9937bdb4899d6931c067967e97aa4eee99ad69ffac302d079f619b177e434bc998566545809b6f4e831b9ec3462726d28b6305fdce39447636348ec7a979577595dc1177b03a2da1006ee2f00f7f34217d91674dd2efe2d735559f69be9884ccac11c742b7246c06228ca4f1007a6cfaf1e88c4546338393e2ed9d3072827d5c1c86ac6be241892bd392116b79b5dd4f2662efa47894c235501c65295eb0264a7f39625178d2bc3108543621f3372319db24bd130077f34d88429aec858e564320e191851ffb23d476c707e3a4dab679fc724c32422a77fffa41f89152cf7e121fb135f67abead06da2fa949a1083fe159ffd14beba81930385c7e45da9c6a01f9b1b68858381841e462391852b15063d4c81f32f430203d4e4ea956dfa214d98276b77346a3ac7e0307e6671cf80caeab88fea5d1d5ffeaddf2629a04e6d11a23fd790ef8620005f9204027309c278d5c2cc444903a1941874fb3e73cfd0d38bcadd22eef7adb83d01c6aad9dfa06d151a73690cb9eb801e02494ee82309b878cee5fb1498908f306a01f0998a7113735728df6ad4ab4e7a73f53e4f5296f0455fd11d94504201a24b75cdf21beab90b85602cd6878c21790a4c8976f44f78e8d7a0b50a2f6142be387df2f503671344232cda281fe3b170a0b332f737ff27628448af20c6b442e04db3c92d55359bd6f6a478d925cc665f4c8499e7f92a806c922916b8470190aa97dd65fe30702e2430baa20085c4f374b6dffbdaa6bc2fd41889034a318aa6c29e8810261d587f7b3db1d86e0ac6afa4767e558845d88785c3e8e3d904d911ee573507baccf0efee703d5d43c7ad3df46e80e46c98a9efd8181fcba9b75ec249fe4fc0d7e84d74c408555045943a7b3e125dcf88544023e583430a1f5ecb18f78c201564d4fa27b92c6263d999f10cf09780c69b5cdee447b33f8771423b69c5cc53cabbf3bd631f68d2d1104e79cbb2746ffc5c7a298a387eb7605647b25d2a96441d5b926b6e37dbe42df523128d5f1501253aeed0f75ed26f76c1e24880bca3c1ab7f1fb12db28e9e092e22f5ef0ef4e19c104b09a2c61da52f19b033d471757e78984e7348561b9af67458d61ca058dee5f6b21809b9c655010705bf7072ab71a6addb99bb058502b86be0d77d8764091fda71af7490eaa1ebc4ab5cb96862a3b469a6115caf680815a4a4f67b289a8bd0ee2bffd72b8a1c10e2acb88e8dacda67eb07daa6a73e3379c0e6127772e97eb0a440cee23177c894ac83a32b56c48c8533f433d5153aa12db83f4c7e3dc1b0d173e709598e081715a2973a7d770c50024da38c06a7c1e78326792ee7354f944e0990a4b549c1359140ce14b32a632534f45f34b9f3233a0407cbb74b7e74560d661ede28632d6651ed49e9f5a2b81cc19e41ded046f46b902c4e2ffa42606217a0fb733058e18ad8073c0a85c5ab4d073d2d2c021395c3d39fb99c6bd5735967c6e1464cd69742ef063d8cf75e8c131d528c330fe40956f37c9d324e79d76db24143873e3fa0e823fd2ada1666fda284560dc8fc9a31997031fe582f9d153a549d612a8ce265de6e6d0f9251e8c7174309b43c47dd1806962c8d60d8e0de702236be83cbba9f61cdee2296929eceb5c2fd1c113f02ecb24bd43057ed3b748aa7aede36d1b38407b3e6e3dafe26b5a648e46013465f64aeda32682e707caac76c73356e763d142e39c23bf10557066e9124a041949d7085e02c26382e0158a8c46fdfe5a27ba9b9412efbe7af07378f62d5409acaa40fc956834af496ddf3a41f30c1f5bbe64bc01ca4eebc0b82ce08046632cd7fbd3aa03d82fdc41f313f55e8ba06c0036f31ec6e5409b4043cb7dafbdb7b7e9997f145fd583265c3d5f5128d61320bd94bcc67e44f61032c871c595c5f4ab08f9b656d24b2a7c63d6091dd8e49ebae2c4b54574164f5dd1b3b2e06dd0d87dff222f96fc70959de9920a8535edb3bd0bd247944e874bc043716d2c3d08645d89b66796727d34cc89097e4f40b3b44d41679dd536d3dbdcd6068ec18a72f40f38e7bd451c7c049d6912b0352a41d3dea838394a0b1f05151f50df619e27f290cf68e9a86fbf6099fae9cfd889246953bfb5324a7614fe8f4b05c3ac8f0e2ecb95341de09d8e2adefe00b8375521315f78df3ce58ddb39c695fb960328a3bb8144652eff33921a217cebe2a4fdc31fd53de0e83c71c1c98d339fd4e47bb2a8321fe63f944fa3dc55e03870829bdb93528f9bca4f199cf27d3a7fdde52d39e336c829ccd8039e7e50d5756bed7933294956239f5e45f0165af83028d050f08501594f0ab5bc9030d45fc82d6f61f32b27ba278cc9b304e1ce0b234654f4eb2db65703f74f28b386ce0f9a007297bb984f439f5c3bbab0c61020708b807866ee63275d3498f522398fbd442e8d842168fc8b13cca3e1659130bf771d580428e1e0aadc269d1f03a5f77c7881564772e90e271d4b4d41b3418fc304e87f3735c58b1377f3aff6dfdf9883b1bca160570b96ff754d4ba23d3ea7f04d3a61de678c9362819b7eb104c898943274fae41fd99133c06527794eb16eed0894a097e658df574da4ca347cf86198c4bc18465534d740f7bfedd479a96fab18d64322736a6a3e7d95c54fb0a44e6dd4254b3bc1440384eae5b142eebb80b6b8fb826e7bbb7bac13671c837d477a9d158f451e63c35fa0c5459dc1bb5fbd36dbfc3c7738981c67de75f1a3aceba0a2cc7997f260b7379538a668d2c88f3e47b23a95ed11054054389bb75eac1b5f842d44ff0e82a54afb380bc00d0786de72fd380e9c73be88f0490464f746e483fa1d95a1ba8cf2159adb6ef9f82a5e06e0375d0b72820e501d80d40bd3ef40ed1b54511830f646d5bfdf0b345e302a1f4b88c696f88b15e13577f7aea7381e22c30c884a263b34c49e028ff5635e316b6cc9b6b9f0247acbec727beb9ffadec009d06dd9707af10aafd4b0cbaef3d06292283abb833de2e8a9be77999358d31b05797e757e25a06778b57aaae6a91b4a7680b9500e24fc19721c1c8aa50614e98b5cdd5ed57e3f84611ba6a60ef9b26c15280f9286ad5810d4482a4bdabec41184f4f25a94392676f057477eb98b1434fd8aa23f6b257a4013d9c9ff25cff87f52e6d44bc5546c07da24728cb30569ea374b1d1331e3a6f9b7dd85f6bd3a01686152823e1ade82601dcae870727eb0cd30e5e2d89f17602b6cf528016c472f6fe5b9d2565123c16243bda5fa9b89c58477d19ad9438358d06ef499fc577bc058e80fe6860b1014ef6c3ff9aff2a2980456030bd119d601e2029240daa37bc795f0fdc88700493d27fddd42124127d62a29a55e18c4fb555db676a285cbfeb0257711e2434970b29b54a8a79e63108bdcbaaf6d248f67d635a376a38d3d735cbc1067125d04a9f54e0aa95e91fd03202e16b784eb7afacb32ce0d108b112426967f56e71cbd87039094573113da3ed1e64f36daa474d58e688487056521161747dc22b60fde626397249cdfdaff6b23c89e8cd30097dc4acf43219a6f3ddb103b9c7667de36e103bd65ac3f95eb16998aec29de0f724bbfcabc062e18a43c6a308cb5551750a81b08cac69bb5cfe44ac7b9c180c245b4f98e868617f61cf0027f7026aae87c7eb7423d00a2fe4c47ea708ce93e42310efcba25cdf8d4e3a897f7aca19a0c842b4a0d85ea52c071f2fb846c0e3486984766b9281305e09ef9aae4bee6e8bc8abb2b941cad574f8781bae36efad33ea8c4dfd7dc1132a0a1446ac75039a9596cf65a520157532d46eff1b9b1b8cbf2bc3522a3ec98f1ff18ac2bf9efab897f7b07bef0f5630a7efd07de872cfacfbe1ed3e2a5ee8cb131fdddf61b6275e1acdca0b313589021679a9b8ccee90e7fa6f1712692c44f11fe00407618f3d3bc2c2908c634325319b2e71807d78d2676251bb2fc3ac6817f0432ced4fe1855b7e0c31fbfd04de9c7741f3f2427fa45c18052adf3973969892d5da6c168a5f49240f8c1e67e9ebdad8c4f982c41d0006062648ff2d23a8504c0c12d251b047ecaf6abc102bb05eec8952809f85f612f9b7165fd291a271b3dd16737618ab5dde1c854b798422d232d0af6bd5cc855f052b8ed5126c13704e8ba9c3811be001cc2b252c346633621a572290128d31df675d0f3a71e461d92535a24f470b956b898adb5778d090a0219c7db2e79aa31b589cb1c7db933579a4389c93f6ec186356deca4efebe98a8dcf3ea549758e282f06f01284d550818b1b935f9f2e7a831c69034d422a78c7d580cc0e7d10de297b2fd1e56e335f0caf9c7a14df824114a48c0553b01c6291e85916026cee7a948bd011206a9e3c9729abb87823b1e21d9f41861e3cbdc9098f09e0d0702826b73fda7854879c1dd49550c4f29ce58a4bba438953fc6eabbcf2012444c3c8cb88f2684be1fef67dbc5d2238ff1f94233f870996b521c991b703bcca57fda7d39d0facdc32953b30c2fd68eacdaa307845036891933be26c5ff9110301be14e5827b66fbcf38d829cc95e370798bc95dcc2019713f8abd111835acf73ec5ef2209d566b3db7f94b1a75cdb1cf91150402b8aef70cef35b7948289d36c13fe307184d91136ce1d40f8d180ff098183911caa10ae3ae6d96a516368797945b2fb32cee8d8e3e3d6d9fa11f56da4b832c69419ac8e36026b52552fdcf59cfdef517d54ba3c0053e851f06f0ca74aa28f8561beb32aef5a23a41c19128d57d771c43cf02c90b9a0afef5657b7de8373737bbe752e3ce0c9e8a3711555ba54e8d0f377ab58a6b66c2c7a82b925fd48a88e69cac0d9f91a6cbe4653ea70e3f99d958292a29292ccd4b9ef61330cb128fc844f0aa5e37ad07283b4f5c08380cb1ec7d3a05f5c65e2070b9b100d7ee35a914f0d9d1cf2af1e48f4d6136805eaa4f2c19bdd4c151182e2f893ed5d598319a9a95eda7286875752e20fe2811961a6552a0be3bbf981dadaf32aea3e4594a62f9401088b2ab5afe543dd4c6bf3ffa27601e2e61ed58dc6454d0f48eb350478b9b3fd6b33886d6822e1b451f9aa1e695128c0f783cfaa065880a8fe728575dd623362ff67b558e815931cc5f71b1ab7f0f59724ce8caf9d333649070567985f703672e7390eaa04452e356e75113953b0409457b9e9cf18482c8e9f04d44c28b53e96a6ef54d42ab28a52461b317affabb9b39c4475ea0d02b8c0c45ba99ed57712ee6abd5760d37d1c4909753e7bee00caf4de9bcde27be5d7e1b78a26b9a64e7ec669e96b8ba000dd3e46c31b687483a9a00229e0d016e1ce31430e1950819c2a2acf5c61406199459cecb1f4602c9812d95b77e6b9fe29297097bf11842ac3b9534fbb7e3a89b4e009d61d13126065ef6509961007bad46dfec996cdda2630281da968e57643039c086ca2c1746a2c0cd8f312d671394b6dc2da61472e9e2933810878badb028b3598ea2fa9f5b6dd0b926a965356d9c58c5a7cce583a845dd8b6c2dbc77570335ead7eca386b9360cc2c9f49b20c1cfd6fd6b0e1c43412cf86830fca8cf6ffd080375dbdba077cfd03a8fa4cde51eec4893b8f8a68167e9f04779b5cf7c8c520694b141fcefbea83a3d75b8e08a4d70e5f60897553cc9211c04a78147ddaa32a71aba44ceb0c790ef6009d16366b31071e585fd186ae017a780f7d64a52b0bfa9d393f42f166692c40323d4b56aeda77b8d5d364a7ae150a6e6f0e3cd771021c6e1e8872b6018a73904baf5691a7f2a705f3f5ce37fe9a8b1717b4af80180f9e22b593101152f16a777c7150d34a6b28aaa782be7b9b2954eaf611ff549f72508fbd823c18569214732c1b7a063ec44c5a0ae9e7a1a0f35af8ef4b2feb10113f249063ad12599edcdc68380d3c6c4fcef6602838b4d62742d94e2c56f36d2b8d987199d917f97978fedcc624335c711eef1b15505ea864644f0011287e2f263e6542f84d5f965c1fc93094757afb7178d0daa2f605a685fa0fc3323b5bfe2b3230678d0eb4f24e798d3beba3562970ce1a7406c9a3dda227a4a882940a12da628d22de01ed2422319a8f3285b8168330a90e941822754241884ca3e034e7b9201479f24762d727565172001a723d978e06aa58e6dccbfa42e9b72d7b52333fc92118ba19a2f30274874092a010943cc731ec4aa3dd278063432e600ca6f2f0d6c8d78e62cfde049de9892c8976f719c99fb3eed56e98aba08011eb</script>  <div class="hbe hbe-content">    <div class="hbe hbe-input hbe-input-xray">      <input class="hbe hbe-input-field hbe-input-field-xray" type="password" id="hbePass">      <label class="hbe hbe-input-label hbe-input-label-xray" for="hbePass">        <span class="hbe hbe-input-label-content hbe-input-label-content-xray">Eternalにはいくつかの秘密があります。</span>      </label>      <svg class="hbe hbe-graphic hbe-graphic-xray" width="300%" height="100%" viewBox="0 0 1200 60" preserveAspectRatio="none">        <path d="M0,56.5c0,0,298.666,0,399.333,0C448.336,56.5,513.994,46,597,46c77.327,0,135,10.5,200.999,10.5c95.996,0,402.001,0,402.001,0"></path>        <path d="M0,2.5c0,0,298.666,0,399.333,0C448.336,2.5,513.994,13,597,13c77.327,0,135-10.5,200.999-10.5c95.996,0,402.001,0,402.001,0"></path>      </svg>    </div>  </div></div><script data-pjax src="/Eternity/lib/hbe.js"></script><link href="/Eternity/css/hbe.style.css" rel="stylesheet" type="text/css">]]></content>
      
      
      <categories>
          
          <category> 模拟赛/比赛 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> DP </tag>
            
            <tag> 优化 </tag>
            
            <tag> 图论 </tag>
            
            <tag> 搜索 </tag>
            
            <tag> 数据结构 </tag>
            
            <tag> 状压dp </tag>
            
            <tag> 状态压缩 </tag>
            
            <tag> 线段树 </tag>
            
            <tag> 组合数学 </tag>
            
            <tag> 树型结构 </tag>
            
            <tag> LCA </tag>
            
            <tag> 模拟 </tag>
            
            <tag> 背包 </tag>
            
            <tag> 树型dp </tag>
            
            <tag> 树链剖分 </tag>
            
            <tag> 分析数学 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>P3829 [SHOI2012]信用卡凸包</title>
      <link href="/Eternity/%E9%A2%98%E8%A7%A3/p3829/"/>
      <url>/Eternity/%E9%A2%98%E8%A7%A3/p3829/</url>
      
        <content type="html"><![CDATA[<p>凸包练习题</p><span id="more"></span><p>凸包模板 + 初中几何知识。</p><p>难在将中点坐标转化成四角坐标。</p><p>注意：信用卡有 $N$ 个，所以点的坐标也就有 $4N$ 个，所以数组空间要开 $4$ 倍大小。</p><details>    <summary>AC Code</summary><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;ctime&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iomanip&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stack&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;map&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> gh() getchar()</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> re register</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> db double</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> ll;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN=<span class="number">4e4</span>+<span class="number">1</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> dx[]=&#123;<span class="number">0</span>,<span class="number">1</span>,<span class="number">-1</span>,<span class="number">1</span>,<span class="number">-1</span>&#125;;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> dy[]=&#123;<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">-1</span>,<span class="number">-1</span>&#125;;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    x=<span class="number">0</span>;</span><br><span class="line">    <span class="type">char</span> ch=<span class="built_in">gh</span>(),t=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(ch&lt;<span class="string">&#x27;0&#x27;</span>||ch&gt;<span class="string">&#x27;9&#x27;</span>) t|=ch==<span class="string">&#x27;-&#x27;</span>,ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">while</span>(ch&gt;=<span class="string">&#x27;0&#x27;</span>&amp;&amp;ch&lt;=<span class="string">&#x27;9&#x27;</span>) x=(x&lt;&lt;<span class="number">3</span>)+(x&lt;&lt;<span class="number">1</span>)+(ch^<span class="number">48</span>),ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">if</span>(t) x=-x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T,<span class="keyword">class</span> ...T1&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x,T1 &amp;...x1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">read</span>(x),<span class="built_in">read</span>(x1...);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">checkMax</span><span class="params">(T &amp;x,T &amp;y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x&lt;y?x=y,<span class="number">1</span>:<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">checkMin</span><span class="params">(T &amp;x,T &amp;y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x&gt;y?x=y,<span class="number">1</span>:<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> N,cnt;</span><br><span class="line"><span class="type">double</span> len,wid,rth;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Point</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">double</span> x,y;</span><br><span class="line">    Point <span class="keyword">operator</span>-(<span class="type">const</span> Point &amp;a)<span class="type">const</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> &#123;x-a.x,y-a.y&#125;;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">Point</span>(<span class="type">double</span> x=<span class="number">0</span>,<span class="type">double</span> y=<span class="number">0</span>):<span class="built_in">x</span>(x),<span class="built_in">y</span>(y)&#123;&#125;</span><br><span class="line">&#125;Pt[MAXN],centre[MAXN];</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">double</span> <span class="title">cross</span><span class="params">(Point a,Point b)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> a.x*b.y-a.y*b.x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">double</span> <span class="title">area</span><span class="params">(Point a,Point b,Point c)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">cross</span>(b-a,c-a);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> Point <span class="title">rotate</span><span class="params">(Point a,<span class="type">double</span> alph)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;a.x*<span class="built_in">cos</span>(alph)+a.y*<span class="built_in">sin</span>(alph),-a.x*<span class="built_in">sin</span>(alph)+a.y*<span class="built_in">cos</span>(alph)&#125;;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">double</span> theta[MAXN];</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">init</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=N;++i)</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> k=<span class="number">1</span>;k&lt;=<span class="number">4</span>;++k)</span><br><span class="line">        &#123;</span><br><span class="line">            Point dis=<span class="built_in">rotate</span>(&#123;dx[k]*len,dy[k]*wid&#125;,-theta[i]);</span><br><span class="line">            Pt[++cnt]=<span class="built_in">Point</span>(centre[i].x+dis.x,centre[i].y+dis.y);</span><br><span class="line">        &#125;</span><br><span class="line">    <span class="comment">// for(int i=1;i&lt;=cnt;++i) printf(&quot;%.2lf %.2lf\n&quot;,Pt[i].x,Pt[i].y);</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> stk[MAXN&lt;&lt;<span class="number">1</span>],top;</span><br><span class="line"><span class="type">bool</span> used[MAXN];</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">cmp</span><span class="params">(Point a,Point b)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(a.x==b.x) <span class="keyword">return</span> a.y&lt;b.y;</span><br><span class="line">    <span class="keyword">return</span> a.x&lt;b.x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">double</span> <span class="title">getDist</span><span class="params">(Point a,Point b)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> std::<span class="built_in">sqrt</span>((a.x-b.x)*(a.x-b.x)+(a.y-b.y)*(a.y-b.y));</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">andrew</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    std::<span class="built_in">sort</span>(Pt+<span class="number">1</span>,Pt+<span class="number">1</span>+cnt,cmp);</span><br><span class="line">    top=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=cnt;++i)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">while</span>(top&gt;=<span class="number">2</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="type">double</span> res=<span class="built_in">area</span>(Pt[stk[top<span class="number">-1</span>]],Pt[stk[top]],Pt[i]);</span><br><span class="line">            <span class="keyword">if</span>(res&lt;<span class="number">0</span>) used[stk[top--]]=<span class="number">0</span>;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span>(res==<span class="number">0</span>) --top;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        stk[++top]=i;</span><br><span class="line">        used[i]=<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    used[<span class="number">1</span>]=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=cnt;i&gt;=<span class="number">1</span>;--i)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(used[i]) <span class="keyword">continue</span>;</span><br><span class="line">        <span class="keyword">while</span>(top&gt;=<span class="number">2</span>&amp;&amp;<span class="built_in">area</span>(Pt[stk[top<span class="number">-1</span>]],Pt[stk[top]],Pt[i])&lt;<span class="number">0</span>) --top;</span><br><span class="line">        stk[++top]=i;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">double</span> res=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">2</span>;i&lt;=top;++i) res+=<span class="built_in">getDist</span>(Pt[stk[i<span class="number">-1</span>]],Pt[stk[i]]);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%.2lf&quot;</span>,res+(<span class="number">2</span>*rth*<span class="built_in">acos</span>(<span class="number">-1</span>)));</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// freopen(&quot;geo.in&quot;,&quot;r&quot;,stdin);</span></span><br><span class="line">    <span class="comment">// freopen(&quot;geo.out&quot;,&quot;w&quot;,stdout);</span></span><br><span class="line">    <span class="built_in">read</span>(N);</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%lf%lf%lf&quot;</span>,&amp;wid,&amp;len,&amp;rth);</span><br><span class="line">    wid=(wid<span class="number">-2</span>*rth)/<span class="number">2</span>;</span><br><span class="line">    len=(len<span class="number">-2</span>*rth)/<span class="number">2</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=N;++i) <span class="built_in">scanf</span>(<span class="string">&quot;%lf%lf%lf&quot;</span>,&amp;centre[i].x,&amp;centre[i].y,&amp;theta[i]);</span><br><span class="line">    <span class="built_in">init</span>();</span><br><span class="line">    <span class="built_in">andrew</span>();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">2</span></span><br><span class="line"><span class="comment">6.0 2.0 0.0</span></span><br><span class="line"><span class="comment">0.0 0.0 0.0</span></span><br><span class="line"><span class="comment">2.0 -2.0 1.5707963268</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure></details>]]></content>
      
      
      <categories>
          
          <category> 题解 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 几何 </tag>
            
            <tag> 计算几何 </tag>
            
            <tag> 凸包 </tag>
            
            <tag> 叉积 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>网络流</title>
      <link href="/Eternity/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/OI/network-flow/"/>
      <url>/Eternity/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/OI/network-flow/</url>
      
        <content type="html"><![CDATA[<p>“互联网就像影子，侵蚀着这个世界的边边角角。”</p><span id="more"></span><h2 id="网络"><a href="#网络" class="headerlink" title="网络"></a>网络</h2><p>网络流是网络中的流，网络是一张<strong>有向图</strong>，表示为 $G=(V,E)$ ，对于每一条边 $(u,v)$ ，存在一个权值 $c(u,v)$ 表示容量 (capacity) ，当 $(u,v)\notin E$ ，则有 $c(u,v)=0$ ，注意，不保证 $c(u,v)=c(v,u)$ 。每一个网络有两个特殊点，一个是<strong>源点 (Source) </strong> $s\in V$ ，一个是<strong>汇点(Sink) </strong> $t\in V,(s\neq t)$ 。</p><h2 id="流"><a href="#流" class="headerlink" title="流"></a>流</h2><p>一个实数函数满足 $f(u,v),(u\in V,v\in E)$ ，且有：</p><ol><li>容量限制 $f(u,v)\leq c(u,v)$ ；</li><li>流守恒性 $\sum^{i\in V,i\neq s}_{i}f(s,i)=\sum^{j\in V,j\neq t}_{j}f(j,t)$ ，即从源点流出的流量等于汇点流入的流量。</li><li>如果考虑反向边，则有第三性质：斜对称性 $f(u,v)=-f(v,u)$ 。</li></ol><p>$f$ 是 $G$ 的流函数， $f(u,v)$ 被称为 $(u,v)\in E$ 的流量，而 $f’(u,v)=c(u,v)-f(u,v)$ 称为边的<strong>剩余流量</strong>。则 $\sum_{(s,v)\in E}f(s,v)$ 为从源点出发的流量和。</p><h2 id="最大流"><a href="#最大流" class="headerlink" title="最大流"></a>最大流</h2><p>可以把网络流看作水库出水，而<strong>源点</strong>则是水库，<strong>汇点</strong>就是你家。源点的“量”是无限的，中途的任何一个点不存储任意一点流量也不会产生任何一点流量，所以源点出发的所有流量必定流入汇点。而经过每一条边的<strong>最大流量</strong>，即是 $c(x,y)$ </p><p>最大流的算法，就是在满足流过边 $c$ 的流量满足 $\leq c(x,y)$ 的情况下，汇点的流量最大的问题。</p><h3 id="残余网络"><a href="#残余网络" class="headerlink" title="残余网络"></a>残余网络</h3><p>首先我们介绍一下一条边的剩余容量 $c_f(u,v)$（Residual Capacity），它表示的是这条边的容量与流量之差，即 $c_f(u,v)=c(u,v)-f(u,v)$ 。</p><p>对于流函数 $f$ ，残量网络 $G_f$（Residual Network）是网络 $G$ 中所有结点 <strong>和剩余容量大于 0</strong> 的边构成的子图。形式化的定义，即 $G_f=(V_f=V,E_f=\{(u,v)\in E,c_f(u,v)&gt;0\})$ 。</p><p>注意，剩余容量大于 0 的边可能不在原图 $G$ 中（根据容量、剩余容量的定义以及流函数的斜对称性得到）。可以理解为，残量网络中包括了那些还剩了流量空间的边构成的图，也包括虚边（即反向边）。</p><hr><p>以下是二月份初学时做下的笔记。</p><hr><p>我们设 $f(x,y)$ 为边 $(x,y)$ 的实际容量。</p><ul><li>饱和弧： $f(x,y)=c(x,y)$ ，流量为该边的容量</li><li>非饱和弧： $f(x,y)&lt;c(x,y)$ ，实际流量小于容量</li><li>零流弧： $f(x,y)=0$ ，该边未流过流量。</li><li>非零流弧： $f(x,y)&gt;0$ ，当前流量不为 $0$ 。</li></ul><p><strong>残余网络</strong>：设有容量网络 $G(V,E)$ 及其上的网络流 $f$ ， $G$ 关于 $f$ 的残留网络即为 $G(V’,E’)$ ，其中 $G’$ 的顶点集 $V’$ 和 $G$ 的顶点集 $V$ 相同，即 $V’=V$ ，对于 $G$ 中任何一条弧 $(u,v)$ ，如果 $f(u,v)&lt;c(u,v)$ ，那么在 $G’$ 中有一条弧  $(u,v)\in E’$  ，其容量为 $c’(u,v)=c(u,v)-f(u,v)$ ，如果 $f(u,v)&gt;0$ ，则在 $G’$ 中有一条弧 $(v,u)\in E’$ ，其容量为 $c’(v,u)=f(u,v)$ 。</p><p>从残留网络的定义来看，原容量网络中的每条弧在残留网络中都化为一条或者两条弧。在残留网络中，从源点到汇点的任意一条简单路径都对应一条增光路，路径上每条弧容量的最小值即为能够一次增广的最大流量。</p><hr><h3 id="增广路"><a href="#增广路" class="headerlink" title="增广路"></a>增广路</h3><p><strong>增广路</strong>是一条从源点到汇点的路径，满足所有边的剩余容量都大于 $0$ ，则该路是网络 $G$ 的一条增广路（Augmenting Path）。也可以定义为：残余网络 $G_f$ 中，存在一条从源点到汇点的路径被称为增广路。</p><hr><p>以下是二月份自学时做的笔记。</p><hr><ol><li>增广路是一条链。（链是网络中的一个顶点序列，这个序列中前后两个顶点有弧相连）</li><li>链上的前向弧都是非饱和弧，链上的后向弧都是非零弧。（前向弧即输入的边，后向弧即建立的反边）</li><li>链的起点是源点，终点是汇点。</li></ol><p>增广路是一个<strong>边的集合</strong>，从 $S$ 至 $T$ 的一条路径。增广路的<strong>最大流量</strong>表示该路径经过的边中流量最小的边的流量，即：</p><blockquote><p>一条增广路  $i$ 的边集是 $E_i$ ，最大流量是 $c$ ，则 $\forall r\in E,c_r\leq c$ </p></blockquote><p>用<a href="https://2745518585.github.io/post/maximum-flow-Dinic/">赵悦岑巨佬</a>的话来讲，增广路指的就是一条从源点到汇点，且经过的边最小容量不为 $0$ 的路径。而我们寻找增广路之后，就会将所有经过的边的容量减去增广路的流量。但是，这种算法并不保险。所以我们对于每一条存在的 $c(x,y)$ ，都建立其后向弧满足 $c(y,x)=0$ 使得我们在后续寻找增广路时可以“反悔”，使其不因之前的错误增广路而影响。</p><p>我们对于每一条边都增加一条容量为 $0$ 反向边，找到增广路后经过的边流量要减去此增广路的流量，其反向边的流量还要加上此增广路的流量。所有反向边组成的图就是<strong>残留网络</strong>。</p><hr><h3 id="反向边"><a href="#反向边" class="headerlink" title="反向边"></a>反向边</h3><p>增广时需要建造反向边，这是通理，虽然我也没有想明白其正确性。总之，增广的时候，由于贪心原则，其并非全局最优解，而减去之后会导致最优解无法到达，我们要让子程序进行反悔。那么，我们每次增广的时候，就要建造一个反向边满足 $c(v,u)=f(u,v)$ ，即<strong>反向边的容量是正向边的流量</strong>。我无法解释为什么，反正它确实对了。</p><p>对于建反向边的技巧，邻接矩阵就是 $table[x,y]=table[y,x]$ 。而链式前向星更常用，我们也不需要在增广时才加入反向边，我们可以预处理出反向边，而在用的时候直接将 $id\operatorname{xor}1$ 即可。这个不必太多解释。但是，初始值需要有 <code>Total=-1</code> 或者 <code>Total=1</code> ，如果边从 $1$ 开始，则会错位。</p><h3 id="Edmonds-Karp-动能算法"><a href="#Edmonds-Karp-动能算法" class="headerlink" title="Edmonds-Karp 动能算法"></a>Edmonds-Karp 动能算法</h3><p>圈内人称 EK 算法。</p><p>算法只有一句话，用 bfs 找增广路，然后对其进行增广即可。</p><ul><li>找：从源点开始 bfs ，直到碰到汇点，然后进行增广（每一条路），注意流量合法。</li><li>增广：重走找到的增广路，然后减去这条路能够达到的最大流量，然后把答案加上最小流量即可。</li></ul><p>时间复杂度 $\mathcal O(nm^2)$ ，不太效率。但是好想和好记。</p><details>    <summary>EK</summary><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;ctime&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iomanip&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stack&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;map&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> gh() getchar()</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> re register</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> db double</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> ll;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN=<span class="number">201</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXM=<span class="number">5001</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> INF=<span class="number">0x7f7f7f7f</span>;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    x=<span class="number">0</span>;</span><br><span class="line">    <span class="type">char</span> ch=<span class="built_in">gh</span>(),t=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(ch&lt;<span class="string">&#x27;0&#x27;</span>||ch&gt;<span class="string">&#x27;9&#x27;</span>) t|=ch==<span class="string">&#x27;-&#x27;</span>,ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">while</span>(ch&gt;=<span class="string">&#x27;0&#x27;</span>&amp;&amp;ch&lt;=<span class="string">&#x27;9&#x27;</span>) x=(x&lt;&lt;<span class="number">3</span>)+(x&lt;&lt;<span class="number">1</span>)+(ch^<span class="number">48</span>),ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">if</span>(t) x=-x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T,<span class="keyword">class</span> ...T1&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x,T1 &amp;...x1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">read</span>(x),<span class="built_in">read</span>(x1...);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">checkMax</span><span class="params">(T &amp;x,T &amp;y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x&lt;y?x=y,<span class="number">1</span>:<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">checkMin</span><span class="params">(T &amp;x,T &amp;y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x&gt;y?x=y,<span class="number">1</span>:<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> N,M,S,T;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Edge</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> from,to,cap,flow;</span><br><span class="line">    <span class="built_in">Edge</span>(<span class="type">int</span> u,<span class="type">int</span> v,<span class="type">int</span> c,<span class="type">int</span> f):<span class="built_in">from</span>(u),<span class="built_in">to</span>(v),<span class="built_in">cap</span>(c),<span class="built_in">flow</span>(f)&#123;&#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">namespace</span> EdmondsKarp</span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> Total;</span><br><span class="line">    vector&lt;Edge&gt;Edges;</span><br><span class="line">    vector&lt;<span class="type">int</span>&gt;G[MAXN];</span><br><span class="line">    <span class="type">int</span> fl[MAXN],id[MAXN];</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">init</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=N;++i) G[i].<span class="built_in">clear</span>();</span><br><span class="line">        Edges.<span class="built_in">clear</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">addEdge</span><span class="params">(<span class="type">int</span> u,<span class="type">int</span> v,<span class="type">int</span> c)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        Edges.<span class="built_in">push_back</span>(<span class="built_in">Edge</span>(u,v,c,<span class="number">0</span>));</span><br><span class="line">        Edges.<span class="built_in">push_back</span>(<span class="built_in">Edge</span>(v,u,<span class="number">0</span>,<span class="number">0</span>));</span><br><span class="line">        Total=Edges.<span class="built_in">size</span>();</span><br><span class="line">        G[u].<span class="built_in">push_back</span>(Total<span class="number">-2</span>);</span><br><span class="line">        G[v].<span class="built_in">push_back</span>(Total<span class="number">-1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> ll <span class="title">maxFlow</span><span class="params">(<span class="type">int</span> s,<span class="type">int</span> t)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        ll flow=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(;;)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">memset</span>(fl,<span class="number">0</span>,<span class="built_in">sizeof</span>(fl));</span><br><span class="line">            queue&lt;<span class="type">int</span>&gt;Q;</span><br><span class="line">            Q.<span class="built_in">push</span>(s);</span><br><span class="line">            fl[s]=INF;</span><br><span class="line">            <span class="keyword">while</span>(!Q.<span class="built_in">empty</span>())</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="type">int</span> u=Q.<span class="built_in">front</span>();Q.<span class="built_in">pop</span>();</span><br><span class="line">                <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;G[u].<span class="built_in">size</span>();++i)</span><br><span class="line">                &#123;</span><br><span class="line">                    Edge&amp; e=Edges[G[u][i]];</span><br><span class="line">                    <span class="keyword">if</span>(!fl[e.to]&amp;&amp;e.cap&gt;e.flow)</span><br><span class="line">                    &#123;</span><br><span class="line">                        id[e.to]=G[u][i];</span><br><span class="line">                        fl[e.to]=<span class="built_in">min</span>(fl[u],e.cap-e.flow);</span><br><span class="line">                        Q.<span class="built_in">push</span>(e.to);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span>(fl[t]) <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(!fl[t]) <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> u=t;u!=s;u=Edges[id[u]].from)</span><br><span class="line">            &#123;</span><br><span class="line">                Edges[id[u]].flow+=fl[t];</span><br><span class="line">                Edges[id[u]^<span class="number">1</span>].flow-=fl[t];</span><br><span class="line">            &#125;</span><br><span class="line">            flow+=fl[t];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> flow;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> EdmondsKarp;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// freopen(&quot;ek.in&quot;,&quot;r&quot;,stdin);</span></span><br><span class="line">    <span class="comment">// freopen(&quot;ek.out&quot;,&quot;w&quot;,stdout);</span></span><br><span class="line">    <span class="built_in">read</span>(N,M,S,T);</span><br><span class="line">    EdmondsKarp::<span class="built_in">init</span>();</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>,u,v,c;i&lt;=M;++i)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">read</span>(u,v,c);</span><br><span class="line">        EdmondsKarp::<span class="built_in">addEdge</span>(u,v,c);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%lld&quot;</span>,EdmondsKarp::<span class="built_in">maxFlow</span>(S,T));</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">4 5 4 3</span></span><br><span class="line"><span class="comment">4 2 30</span></span><br><span class="line"><span class="comment">4 3 20</span></span><br><span class="line"><span class="comment">2 3 20</span></span><br><span class="line"><span class="comment">2 1 30</span></span><br><span class="line"><span class="comment">1 3 40</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure></details><hr><h3 id="Dinic"><a href="#Dinic" class="headerlink" title="Dinic"></a>Dinic</h3><p>在学习完 EK 之后，我才真正开始理解 Dinic 的本质。</p><p>思路同 EK ，但是在增广之前，使用 bfs 进行分层（将图进行分层处理，建图的常见技巧之一），源点的层数满足 $dep[s]=0$ ，其他点的层数取决于其与源点的距离。</p><p>分层之后，有两个优化：</p><ol><li>同时进行多路增广，且在断层时（即找不到增广路的时候）直接中断增广，进行时间优化；</li><li>增广路一定最短。</li></ol><p>我们用 dfs 来找增广路。</p><p>对层数加 $1$ 的点进行增广（从而确保增广路最短，原理同最短路，因为同层的点只会经过一个）。</p><p>Dinic 的优化：</p><ol><li>多路增广：每找到一条增广路之后，从残余流量再次增广；从而在一次 dfs 中找出多条增广路，提高算法效率。</li><li>当前弧优化：可以推出（<del>或者直接背下</del>），一条边如果已经是一条增广路的边（被增广过），那么这条边不可能被增广第二次。所以，对所有边进行标记，不必要再走已经被增广过的边。</li></ol><p>在运用了上述两个优化之后，时间复杂度可以达到 $\mathcal O(n^2m)$ ，在稠密图上比 EK 更胜一筹。就和 SPFA 一样，这个上界一般而言很难到达，且在二分图最大匹配问题上，Dinic 算法的复杂度能达到 $\mathcal O(m\sqrt n)$ ，不过不在我今天讲的范围内，所以只是提一嘴。</p><hr><p>以下讲解不太明晰（个人意见），酌情观看。</p><hr><ul><li><p>每次多路增广： $u$  点通过一条边，向  $v$  输出流量以后，  $v$  会尝试到达汇点（到达汇点才真正增广），然后  $v$  返回实际增广量。这时，<strong>如果 u 还有没用完的供给，就继续尝试输出到其它边。</strong></p><p>但是要警惕绕远路、甚至绕回的情况，不加管制的话极易发生。怎么管？</p></li><li><p>源点<strong>顺着残量网络</strong>想要到达其它点，需要经过一些边对吧？<strong>按照经过的边数（即源点出发以后的距离）把图分层，即用 bfs 分层。</strong> 每次尝试给予时，<strong>只考虑给予自己下一层的点</strong>，就可以防止混乱。</p></li><li><p>综合上面两条。每回合也是从源点出发，<strong>先按照当前残量网络分一次层</strong>，随后多路增广，尽可能增加流量。增广过程中，会加入一些反向边，这些反向边逆着层次图，本回合并不会走。所以还需要进入下一回合。一直到 $ bfs $ 分层时搜不到汇点（即残量网络断了）为止。</p></li></ul><p>$Dinic$  首先  $bfs$  对网络进行分层，构成一张分层图。然后进行  $dfs$  寻找当前的最大流。直到  $bfs$  无法达到汇点，则整个算法停止。</p><h4 id="Dinic-的当前弧优化"><a href="#Dinic-的当前弧优化" class="headerlink" title="Dinic 的当前弧优化"></a>Dinic 的当前弧优化</h4><p>$dfs$  过程中我们会一直流直到把一条边流完再转到下一条边，如果一条边有容量但是却没有增广路，说明这条边的下一个点已经没有更多容量了，我们就可以把连接的这个点的高度标记为  $0$ ，下一次就不会再搜索到这个点了。</p><p>不过  $Dinic$  还是很慢，甚至比  $EK$  还慢，这时候我们就需要拯救  $Dinic$  的当前弧优化。上面说到， $dfs$  过程中会一直流直到把一条边流完再转到下一条边，当搜索到一条边的时候说明这条边之前的所有边都已经没有增广路了，我们就可以直接将 $t$ 指向这条边，这样下一次就不会再次搜索已经没有流量的边了。</p><hr><details>    <summary>查看代码</summary><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;ctime&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iomanip&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stack&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;map&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> gh() getchar()</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> underMax(x,y) ((x)&gt;(y)?(x):(y))</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> underMin(x,y) ((x)&lt;(y)?(x):(y))</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> ll;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN=<span class="number">1e4</span>+<span class="number">1</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXM=<span class="number">1e4</span>+<span class="number">1</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> INF=<span class="number">0x7f7f7f7f</span>;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">underRead</span><span class="params">(T &amp;x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    x=<span class="number">0</span>;</span><br><span class="line">    <span class="type">char</span> ch=<span class="built_in">gh</span>(),t=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(ch&lt;<span class="string">&#x27;0&#x27;</span>||ch&gt;<span class="string">&#x27;9&#x27;</span>) t|=ch==<span class="string">&#x27;-&#x27;</span>,ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">while</span>(ch&gt;=<span class="string">&#x27;0&#x27;</span>&amp;&amp;ch&lt;=<span class="string">&#x27;9&#x27;</span>) x=(x&lt;&lt;<span class="number">3</span>)+(x&lt;&lt;<span class="number">1</span>)+(ch^<span class="number">48</span>),ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">if</span>(t) x=-x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> n,m,s,t,u,v;</span><br><span class="line">ll r;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">edge</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> next,to;</span><br><span class="line">    ll val;</span><br><span class="line">    <span class="built_in">edge</span>(<span class="type">int</span> n=<span class="number">0</span>,<span class="type">int</span> t=<span class="number">0</span>,ll v=<span class="number">0</span>):<span class="built_in">next</span>(n),<span class="built_in">to</span>(t),<span class="built_in">val</span>(v)&#123;&#125;</span><br><span class="line">&#125;Edge[MAXM];</span><br><span class="line"><span class="type">int</span> First[MAXN],Total=<span class="number">1</span>,t0[MAXN];</span><br><span class="line">ll f[MAXN];</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Que</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> u,r;</span><br><span class="line">    <span class="built_in">Que</span>(<span class="type">int</span> u=<span class="number">0</span>,<span class="type">int</span> r=<span class="number">0</span>):<span class="built_in">u</span>(u),<span class="built_in">r</span>(r)&#123;&#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">underAdd</span><span class="params">(<span class="type">int</span> u,<span class="type">int</span> v,ll r)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Edge[++Total]=(edge)&#123;First[u],v,r&#125;,First[u]=Total;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">underBfs</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    queue&lt;<span class="type">int</span>&gt;Q;</span><br><span class="line">    Q.<span class="built_in">push</span>(s);</span><br><span class="line">    <span class="built_in">memset</span>(f,<span class="number">0</span>,<span class="built_in">sizeof</span>(f));</span><br><span class="line">    f[s]=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span>(!Q.<span class="built_in">empty</span>())</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> u=Q.<span class="built_in">front</span>();Q.<span class="built_in">pop</span>();</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> e=First[u];e;e=Edge[e].next)</span><br><span class="line">            <span class="keyword">if</span>(!f[Edge[e].to]&amp;&amp;Edge[e].val)</span><br><span class="line">            &#123;</span><br><span class="line">                f[Edge[e].to]=f[u]+<span class="number">1</span>;</span><br><span class="line">                Q.<span class="built_in">push</span>(Edge[e].to);</span><br><span class="line">            &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> f[t]!=<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">ll <span class="title">underDfs</span><span class="params">(<span class="type">int</span> x,ll r)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(x==t) <span class="keyword">return</span> r;</span><br><span class="line">    ll S=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> e=t0[x];e;e=Edge[e].next)</span><br><span class="line">    &#123;</span><br><span class="line">        t0[x]=e;</span><br><span class="line">        <span class="keyword">if</span>(f[Edge[e].to]==f[x]+<span class="number">1</span>&amp;&amp;Edge[e].val)</span><br><span class="line">        &#123;</span><br><span class="line">            ll k=<span class="built_in">underDfs</span>(Edge[e].to,<span class="built_in">underMin</span>(r,Edge[e].val));</span><br><span class="line">            <span class="keyword">if</span>(k)</span><br><span class="line">            &#123;</span><br><span class="line">                Edge[e].val-=k;</span><br><span class="line">                Edge[e^<span class="number">1</span>].val+=k;</span><br><span class="line">                r-=k,S+=k;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> f[Edge[e].to]=<span class="number">0</span>;</span><br><span class="line">            <span class="keyword">if</span>(!r) <span class="keyword">return</span> S;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> S;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// freopen(&quot;maxinum-flow.in&quot;,&quot;r&quot;,stdin);</span></span><br><span class="line">    <span class="comment">// freopen(&quot;maxinum-flow.out&quot;,&quot;w&quot;,stdout);</span></span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d%d%d%d&quot;</span>,&amp;n,&amp;m,&amp;s,&amp;t);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=m;++i)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d%d%lld&quot;</span>,&amp;u,&amp;v,&amp;r);</span><br><span class="line">        <span class="built_in">underAdd</span>(u,v,r),<span class="built_in">underAdd</span>(v,u,<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    ll R=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(<span class="built_in">underBfs</span>())</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;++i) t0[i]=First[i];</span><br><span class="line">        R+=<span class="built_in">underDfs</span>(s,INF);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%lld&quot;</span>,R);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">4 5 4 3</span></span><br><span class="line"><span class="comment">4 2 30</span></span><br><span class="line"><span class="comment">4 3 20</span></span><br><span class="line"><span class="comment">2 3 20</span></span><br><span class="line"><span class="comment">2 1 30</span></span><br><span class="line"><span class="comment">1 3 40</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure></details><hr><h4 id="Dinic-New-Version"><a href="#Dinic-New-Version" class="headerlink" title="Dinic New Version"></a>Dinic New Version</h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;ctime&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iomanip&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stack&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;map&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> gh() getchar()</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> re register</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> db double</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> ll;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN=<span class="number">1e4</span>+<span class="number">1</span>,MAXM=<span class="number">1e4</span>+<span class="number">1</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> INF=<span class="number">0x7f7f7f7f</span>;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    x=<span class="number">0</span>;</span><br><span class="line">    <span class="type">char</span> ch=<span class="built_in">gh</span>(),t=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(ch&lt;<span class="string">&#x27;0&#x27;</span>||ch&gt;<span class="string">&#x27;9&#x27;</span>) t|=ch==<span class="string">&#x27;-&#x27;</span>,ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">while</span>(ch&gt;=<span class="string">&#x27;0&#x27;</span>&amp;&amp;ch&lt;=<span class="string">&#x27;9&#x27;</span>) x=(x&lt;&lt;<span class="number">3</span>)+(x&lt;&lt;<span class="number">1</span>)+(ch^<span class="number">48</span>),ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">if</span>(t) x=-x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T,<span class="keyword">class</span> ...T1&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x,T1 &amp;...x1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">read</span>(x),<span class="built_in">read</span>(x1...);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">checkMax</span><span class="params">(T &amp;x,T &amp;y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x&lt;y?x=y,<span class="number">1</span>:<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">checkMin</span><span class="params">(T &amp;x,T &amp;y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x&gt;y?x=y,<span class="number">1</span>:<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> N,M,S,T;</span><br><span class="line"><span class="keyword">namespace</span> Netflow</span><br><span class="line">&#123;</span><br><span class="line">    ll rest,fl[MAXN];</span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">Edges</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> next,to;</span><br><span class="line">        ll val;</span><br><span class="line">        <span class="built_in">Edges</span>(<span class="type">int</span> n=<span class="number">0</span>,<span class="type">int</span> t=<span class="number">0</span>,ll v=<span class="number">0</span>):<span class="built_in">next</span>(n),<span class="built_in">to</span>(t),<span class="built_in">val</span>(v)&#123;&#125;</span><br><span class="line">    &#125;Edge[MAXM&lt;&lt;<span class="number">1</span>];</span><br><span class="line">    <span class="type">int</span> Head[MAXN],Total=<span class="number">1</span>;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">addEdge</span><span class="params">(<span class="type">int</span> u,<span class="type">int</span> v,ll r)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        Edge[++Total]=<span class="built_in">Edges</span>(Head[u],v,r);Head[u]=Total;</span><br><span class="line">        Edge[++Total]=<span class="built_in">Edges</span>(Head[v],u,<span class="number">0</span>);Head[v]=Total;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">bfs</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        queue&lt;<span class="type">int</span>&gt;Q;</span><br><span class="line">        <span class="built_in">memset</span>(fl,<span class="number">0</span>,<span class="built_in">sizeof</span>(fl));</span><br><span class="line">        fl[S]=<span class="number">1</span>;</span><br><span class="line">        Q.<span class="built_in">push</span>(S);</span><br><span class="line">        <span class="keyword">while</span>(!Q.<span class="built_in">empty</span>())</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="type">int</span> u=Q.<span class="built_in">front</span>();Q.<span class="built_in">pop</span>();</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> e=Head[u];e;e=Edge[e].next)</span><br><span class="line">                <span class="keyword">if</span>(!fl[Edge[e].to]&amp;&amp;Edge[e].val)</span><br><span class="line">                &#123;</span><br><span class="line">                    fl[Edge[e].to]=fl[u]+<span class="number">1</span>;</span><br><span class="line">                    Q.<span class="built_in">push</span>(Edge[e].to);</span><br><span class="line">                &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> fl[T]!=<span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> newTail[MAXN];</span><br><span class="line">    <span class="function">ll <span class="title">dfs</span><span class="params">(<span class="type">int</span> x,ll r)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(x==T) <span class="keyword">return</span> r;</span><br><span class="line">        ll s=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> e=newTail[x];e;e=Edge[e].next)</span><br><span class="line">        &#123;</span><br><span class="line">            newTail[x]=e;</span><br><span class="line">            <span class="keyword">if</span>(fl[Edge[e].to]==fl[x]+<span class="number">1</span>&amp;&amp;Edge[e].val)</span><br><span class="line">            &#123;</span><br><span class="line">                ll k=<span class="built_in">dfs</span>(Edge[e].to,<span class="built_in">min</span>(r,Edge[e].val));</span><br><span class="line">                <span class="keyword">if</span>(k)</span><br><span class="line">                &#123;</span><br><span class="line">                    Edge[e].val-=k;</span><br><span class="line">                    Edge[e^<span class="number">1</span>].val+=k;</span><br><span class="line">                    r-=k,s+=k;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">else</span> fl[Edge[e].to]=<span class="number">0</span>;</span><br><span class="line">                <span class="keyword">if</span>(!r) <span class="keyword">return</span> s;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> s;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">init</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="built_in">read</span>(N,M,S,T);</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>,u,v;i&lt;=M;++i)</span><br><span class="line">        &#123;</span><br><span class="line">            ll r;</span><br><span class="line">            <span class="built_in">read</span>(u,v,r);</span><br><span class="line">            <span class="built_in">addEdge</span>(u,v,r);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">dinic</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        ll maxFlow=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span>(<span class="built_in">bfs</span>())</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=N;++i) newTail[i]=Head[i];</span><br><span class="line">            maxFlow+=<span class="built_in">dfs</span>(S,INF);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%lld&quot;</span>,maxFlow);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> Netflow;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// freopen(&quot;dinic.in&quot;,&quot;r&quot;,stdin);</span></span><br><span class="line">    <span class="comment">// freopen(&quot;dinic.out&quot;,&quot;w&quot;,stdout);</span></span><br><span class="line">    Netflow::<span class="built_in">init</span>();</span><br><span class="line">    Netflow::<span class="built_in">dinic</span>();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">4 5 4 3</span></span><br><span class="line"><span class="comment">4 2 30</span></span><br><span class="line"><span class="comment">4 3 20</span></span><br><span class="line"><span class="comment">2 3 20</span></span><br><span class="line"><span class="comment">2 1 30</span></span><br><span class="line"><span class="comment">1 3 40</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><hr><h3 id="MPM"><a href="#MPM" class="headerlink" title="MPM"></a>MPM</h3><p>有两种实现方法，一种是基于堆的优先队列，时间复杂度 $\mathcal O(n^3\log n)$ ；一种是使用 $bfs$ 的解法，时间复杂度 $\mathcal O(n^3)$ 。其中寻找增广路的时间用了 $\mathcal O(n^2)$ ，而在寻找的过程中，考虑顶点而非边的容量。</p><p>在分层网络 $L$ 中引入定义点的函数 $p[v]$ 表示点 $v$ 传入残量和传出残量的最小值，满足：</p><script type="math/tex; mode=display">p_{in}(v)=\sum_{(u,v)\in L}(c(u,v)-f(u,v))\\p_{out}(v)=\sum_{(v,u)\in L}(c(v,u)-f(v,u))\\p(v)=\min(p_{in}(v),p_{out}(v))    \nonumber</script><p>$r$ 为<strong>参考节点</strong>当且仅当 $p(r)=\min p(v)$ 。这是 MPM 特有的定义。</p><p>对于 MPM 的其他内容，读者可以自行查阅。也没什么太大必要学（不要刀我），更重要的是 Dinic。</p><h3 id="ISAP"><a href="#ISAP" class="headerlink" title="ISAP"></a>ISAP</h3><p>与 Dinic 不同的是，我们跑反图，即从 $t$ 向 $s$ 推进。增广的时候，选择比当前点层数少 $1$ 的点来增广。每一次也不需要重跑 $bfs$ 来重新分层，而是一边增广，一边重分层。</p><blockquote><p> 其实吧，SAP（Shortest Augument Path，最短增广路）就是 EK 算法。</p></blockquote><p>在结束对 $i$ 点增广之后，我们遍历残量网络中 $i$ 的出边，找出其层最小的出点 $j$ ，令 $d_i=d_j+1$ ，若 $i$ 无出边，则有 $d_i=n$ 。如果 $d_s\ge n$ 则图不存在增广路。</p><h4 id="ISAP-的当前弧优化-x-ISAP-的-GAP-优化"><a href="#ISAP-的当前弧优化-x-ISAP-的-GAP-优化" class="headerlink" title="ISAP 的当前弧优化 x ISAP 的 GAP 优化"></a>ISAP 的当前弧优化 x ISAP 的 GAP 优化</h4><p>当前弧优化不必多说。</p><p>记录层数为 $i$ 的点的数量，并在更新层数时更新 $num$ 数组，如果存在 $num_x=0$ ，则图断层，不存在增广路，将 $d_s=n$ ，终止算法。该优化称为 GAP 优化。</p><p>加上两个优化的 $ISAP$ 基本上可以吊打除了 $HLPP$ 以外的所有算法。</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;ctime&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iomanip&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stack&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;map&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> gh() getchar()</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> re register</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> db double</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> ll;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN=<span class="number">201</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXM=<span class="number">5001</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> INF=<span class="number">0x7f7f7f7f</span>;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    x=<span class="number">0</span>;</span><br><span class="line">    <span class="type">char</span> ch=<span class="built_in">gh</span>(),t=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(ch&lt;<span class="string">&#x27;0&#x27;</span>||ch&gt;<span class="string">&#x27;9&#x27;</span>) t|=ch==<span class="string">&#x27;-&#x27;</span>,ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">while</span>(ch&gt;=<span class="string">&#x27;0&#x27;</span>&amp;&amp;ch&lt;=<span class="string">&#x27;9&#x27;</span>) x=(x&lt;&lt;<span class="number">3</span>)+(x&lt;&lt;<span class="number">1</span>)+(ch^<span class="number">48</span>),ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">if</span>(t) x=-x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T,<span class="keyword">class</span> ...T1&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x,T1 &amp;...x1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">read</span>(x),<span class="built_in">read</span>(x1...);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">checkMax</span><span class="params">(T &amp;x,T &amp;y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x&lt;y?x=y,<span class="number">1</span>:<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">checkMin</span><span class="params">(T &amp;x,T &amp;y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x&gt;y?x=y,<span class="number">1</span>:<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> N,M,S,T;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Graph</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> next,to;</span><br><span class="line">    ll val;</span><br><span class="line">    <span class="built_in">Graph</span>(<span class="type">int</span> n=<span class="number">0</span>,<span class="type">int</span> t=<span class="number">0</span>,ll v=<span class="number">0</span>):<span class="built_in">next</span>(n),<span class="built_in">to</span>(t),<span class="built_in">val</span>(v)&#123;&#125;</span><br><span class="line">&#125;Edge[MAXM&lt;&lt;<span class="number">1</span>];</span><br><span class="line"><span class="type">int</span> Head[MAXN],Cur[MAXN],Total=<span class="number">1</span>;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">addEdge</span><span class="params">(<span class="type">int</span> u,<span class="type">int</span> v,ll w)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Edge[++Total]=<span class="built_in">Graph</span>(Head[u],v,w);Head[u]=Total;</span><br><span class="line">    Edge[++Total]=<span class="built_in">Graph</span>(Head[v],u,<span class="number">0</span>);Head[v]=Total;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> Dep[MAXN],Num[MAXN];</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">Bfs</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">memset</span>(Dep,<span class="number">-1</span>,<span class="built_in">sizeof</span>(Dep));</span><br><span class="line">    <span class="built_in">memset</span>(Num,<span class="number">0</span>,<span class="built_in">sizeof</span>(Num));</span><br><span class="line">    Dep[T]=<span class="number">0</span>;Num[<span class="number">0</span>]=<span class="number">1</span>;</span><br><span class="line">    queue&lt;<span class="type">int</span>&gt;Q;</span><br><span class="line">    Q.<span class="built_in">push</span>(T);</span><br><span class="line">    <span class="keyword">while</span>(!Q.<span class="built_in">empty</span>())</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> u=Q.<span class="built_in">front</span>();Q.<span class="built_in">pop</span>();</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> e=Head[u];e;e=Edge[e].next)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="type">int</span> v=Edge[e].to;</span><br><span class="line">            <span class="keyword">if</span>(Dep[v]!=<span class="number">-1</span>) <span class="keyword">continue</span>;</span><br><span class="line">            Q.<span class="built_in">push</span>(v);</span><br><span class="line">            Dep[v]=Dep[u]+<span class="number">1</span>;</span><br><span class="line">            ++Num[Dep[v]];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ;</span><br><span class="line">&#125;</span><br><span class="line">ll MaxFlow;</span><br><span class="line"><span class="function">ll <span class="title">Dfs</span><span class="params">(<span class="type">int</span> u,ll inf)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(u==T)</span><br><span class="line">    &#123;</span><br><span class="line">        MaxFlow+=inf;</span><br><span class="line">        <span class="keyword">return</span> inf;</span><br><span class="line">    &#125;</span><br><span class="line">    ll flow=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> e=Cur[u];e;e=Edge[e].next)</span><br><span class="line">    &#123;</span><br><span class="line">        Cur[u]=e;</span><br><span class="line">        <span class="type">int</span> v=Edge[e].to;</span><br><span class="line">        <span class="keyword">if</span>(Edge[e].val&amp;&amp;Dep[v]+<span class="number">1</span>==Dep[u])</span><br><span class="line">        &#123;</span><br><span class="line">            ll k=<span class="built_in">Dfs</span>(v,<span class="built_in">min</span>(Edge[e].val,inf-flow));</span><br><span class="line">            <span class="keyword">if</span>(k)</span><br><span class="line">            &#123;</span><br><span class="line">                Edge[e].val-=k;</span><br><span class="line">                Edge[e^<span class="number">1</span>].val+=k;</span><br><span class="line">                flow+=k;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(flow==inf) <span class="keyword">return</span> flow;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    --Num[Dep[u]];</span><br><span class="line">    <span class="keyword">if</span>(Num[Dep[u]]==<span class="number">0</span>) Dep[S]=N+<span class="number">1</span>;</span><br><span class="line">    ++Dep[u];</span><br><span class="line">    ++Num[Dep[u]];</span><br><span class="line">    <span class="keyword">return</span> flow;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> ll <span class="title">ISAP</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    MaxFlow=<span class="number">0</span>;</span><br><span class="line">    <span class="built_in">Bfs</span>();</span><br><span class="line">    <span class="keyword">while</span>(Dep[S]&lt;N)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">memcpy</span>(Cur,Head,<span class="built_in">sizeof</span>(Head));</span><br><span class="line">        <span class="built_in">Dfs</span>(S,INF);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> MaxFlow;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// freopen(&quot;isap.in&quot;,&quot;r&quot;,stdin);</span></span><br><span class="line">    <span class="comment">// freopen(&quot;isap.out&quot;,&quot;w&quot;,stdout);</span></span><br><span class="line">    <span class="built_in">read</span>(N,M,S,T);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>,u,v;i&lt;=M;++i)</span><br><span class="line">    &#123;</span><br><span class="line">        ll w;</span><br><span class="line">        <span class="built_in">read</span>(u,v,w);</span><br><span class="line">        <span class="built_in">addEdge</span>(u,v,w);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%lld&quot;</span>,<span class="built_in">ISAP</span>());</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">4 5 4 3</span></span><br><span class="line"><span class="comment">4 2 30</span></span><br><span class="line"><span class="comment">4 3 20</span></span><br><span class="line"><span class="comment">2 3 20</span></span><br><span class="line"><span class="comment">2 1 30</span></span><br><span class="line"><span class="comment">1 3 40</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><hr><h3 id="预流推进"><a href="#预流推进" class="headerlink" title="预流推进"></a>预流推进</h3><p>我们可以稍微回想一下网络流的形象化定义：</p><blockquote><p>可以把网络流看作水库出水，而<strong>源点</strong>则是水库，<strong>汇点</strong>就是你家。源点的“量”是无限的，中途的任何一个点不存储任意一点流量也不会产生任何一点流量，所以源点出发的所有流量必定流入汇点。</p></blockquote><p>那么，我们在处理网络流的时候，也可以看做不停从源点倒水，然后能流就流直到流完为止，最后看汇点有多少流量。听着就跟个大模拟一样。</p><p>这就是所谓<strong>预流推进</strong>的本质：</p><ul><li>在求解过程中忽略流守恒性，并每次对一个节点更新消息，以求解最大流。</li></ul><p>但是，如果真去模拟的话，你会发现最后的时间复杂度甚至没有过不了网络最大流模板题，更不要说预流推进的模板题了。这就要引出最大流的最后一个算法：</p><p><strong>最高标号预流推进算法</strong></p><p>$Highest\ Label\ Preflow\ Push$</p><h3 id="HLPP"><a href="#HLPP" class="headerlink" title="HLPP"></a>HLPP</h3><p>其实还有一个通用的预流推进算法（称为 Push-Relabel ），但考虑在预流推进这个东西本来就冷门，我也不想学了。</p><blockquote><p>网络流，网络流，学到秃头。</p></blockquote><p>引出一些定义：</p><h4 id="流函数"><a href="#流函数" class="headerlink" title="流函数"></a>流函数</h4><p>同样是 $f$ 函数，但是不一定保持流守恒性；在预流推进里，我们允许入流大于出流。并将超过的那部分称为 $u(u\in V-\{S,T\})$ 结点的<strong>超额流</strong>，记作 $e(u)$ ，满足：</p><script type="math/tex; mode=display">e(u)=\sum_{(x,u)\in E}f(x,u)-\sum_{(u,y)\in E}f(u,y)    \nonumber</script><p>若 $e(u)&gt;0$ ，则称为 $u$ <strong>溢出</strong>，当然，溢出结点不会包括源点和汇点。</p><h4 id="高度函数"><a href="#高度函数" class="headerlink" title="高度函数"></a>高度函数</h4><p>预流推进维护每个结点的高度 $h(u)$ ，并规定溢出的结点 $u$ 如果要推送超额流，只能向满足 $h(u)&gt;h(v)$ 的 $v$ 结点推送；如果 $u$ 没有相邻的高度小于 $u$ 的结点，就修改 $u$ 的高度，称为<strong>重贴标签</strong>。</p><p>实际上，预流推进维护一个映射 $h:V\to \mathbf N$ ：</p><ul><li>$h(s)=|V|,h(t)=0$ ；</li><li>$\forall (u,v)\in E,h(u)\le h(v)+1$ 。</li></ul><p>则 $h$ 函数是残量网络 $G_f=(V_f,E_f)$ 的高度函数。有性质：</p><blockquote><p>设 $G_f$ 中的高度函数为 $h$ ，则如果有 $\forall u,v\in V,h(u)&gt;h(v)+1$ ，则 $(u,v)$ 不是 $G_f$ 的边。</p></blockquote><p>预流推进只会在满足 $h(u)=h(v)+1$ 的边执行推送。</p><h4 id="推送-Push"><a href="#推送-Push" class="headerlink" title="推送(Push)"></a>推送(Push)</h4><p>在 $u$ 溢出时，且存在 $v$ 满足 $(u,v)\in E_f,c(u,v)-f(u,v)&gt;0,h(u)=h(v)+1$ 时执行。</p><p>将 $u$ 的超额流从 $u$ 推送到 $v$ 去，只考虑超额流和 $c(u,v)-f(u,v)$ 的最小值，无需考虑 $v$ 的溢出情况。</p><p>如果 $(u,v)$ 在推送完之后满流，则将 $(u,v)$ 从残量网络中删除。</p><h4 id="重贴标签-Relabel"><a href="#重贴标签-Relabel" class="headerlink" title="重贴标签(Relabel)"></a>重贴标签(Relabel)</h4><p>在 $u$ 溢出时，且任意 $v$ 满足 $\forall (u,v)\in E_f,h(u)\le h(v)$ 时执行。</p><p>执行时，将 $h(u)$ 更新为 $\min_{(u,v)\in E_f}h(v)+1$ 即可。</p><h4 id="初始化"><a href="#初始化" class="headerlink" title="初始化"></a>初始化</h4><p>初始化流函数，超额流函数和高度函数：</p><script type="math/tex; mode=display">\begin{align}&\forall (u,v)\in E,f(u,v)=\begin{cases}c(u,v)&,u=s    \nonumber\\0&,u\ne s\end{cases}    \nonumber\\&\forall u\in V,h(u)=\begin{cases}|V|&,u=s    \nonumber\\0&,u\ne s\end{cases}\\&\forall u\in V,e(u)=\sum_{(x,u)\in E}f(x,u)-\sum_{(u,y)\in E}f(u,y)    \nonumber\end{align}</script><p>这样的初始化使 $(s,u)\in E$ 都可以满流，并使 $h(s)$ 抬高，满足 $(s,u)\notin E_f$ 。</p><p>因为 $h(s)&gt;h(v)$ ，且 $(s,v)$ 满流，则 $(s,v)$ 没有必要留在残量网络中；</p><p>上述操作还将 $e(s)$ 初始化为 $\sum_{(s,v)\in E}f(s,v)$ 的相反数。</p><h4 id="HLPP-的实质"><a href="#HLPP-的实质" class="headerlink" title="HLPP 的实质"></a>HLPP 的实质</h4><p>有一个不为人知，但众所皆知的网络流算法——$\text{PP}$ 算法，是唯一一个会在模板题上超时的算法。它就是<strong>推进</strong>算法，用一个队列储存待维护的点（起始为源点），然后对于每一个当前点，把它有的流量尽可能地推往与之相连的点，然后将相连的点也加入队列。</p><p>但是，如果存在两个点可以互相推送，则会死循环。这也是为什么 $\text{PP}$ 是一个不成功的算法。所以才会出现 $\text{HLPP}$ ，类似于 $\text{Dinic}$ 构建一个高度函数 $h_i$ 。</p><p>著名<del>毒瘤</del>科学家 $\text{Tarjan}$ 和他的同事 $\text{Goldberg}$ 在 $1986$ 年提出了最高标号预留推进算法，将 $\text{PP}$ 中的队列替换为<strong>优先队列</strong>，每一次都流高度最高的，可以理解为先将高处的点的水移到低处，那么给低处节点推流时可以顺便带走。后来，另外两名科学家 $\text{Cheriyan}$ 和 $\text{Maheshwari}$ 证明了 $\text{HLPP}$ 的复杂度：</p><p>$\mathcal O(n^2\sqrt m)$ 。</p><p>每一次扫描整个图，只要存在结点 $u$ 能够执行 <code>push</code> 或 <code>relabel</code> 操作，就执行。下图是暴力推进的示意图：颜色深度代表结点高度，绿色边代表满足 $h_u=h_v+1$ 的边 $(u,v)$ 。</p><p><img src="https://oi-wiki.org/graph/flow/images/2149.gif" alt="img"></p><p>结果：</p><p><img src="https://oi-wiki.org/graph/flow/images/2150.png" alt="img"></p><blockquote><p>图片来自 $\text{OI-Wiki}$ 。</p></blockquote><hr><h4 id="HLPP-的实现及优化"><a href="#HLPP-的实现及优化" class="headerlink" title="HLPP 的实现及优化"></a>HLPP 的实现及优化</h4><p>$\text{HLPP}$ 的算法过程包括：</p><ol><li>初始化（基于预流推进）；</li><li>选出溢出结点中高度最高的结点 $u$ ，推送 $u$ ；</li><li>如果 $u$ 仍然溢出，重贴标签 $u$ ，并执行步骤 $2$ ；</li><li>没有溢出，算法结束。</li></ol><p>所涉及的三个操作上文都有讲过，读者请自行查阅。</p><p>$\text{HLPP}$ 的复杂度是较稳定的 $\mathcal O(n^2\sqrt m)$ ，卡得比较紧，且常数极大。在随机数据上甚至可能连 $\text{Dinic}$ 都跑不过，所以需要许许多多的优化。</p><h5 id="BFS-优化"><a href="#BFS-优化" class="headerlink" title="BFS 优化"></a>BFS 优化</h5><p>优化初始化高度，将 $h_u$ 赋为 $u$ 到 $T$ 的最短距离，使 $h_S=|V|$ 。并在使用 $\text{BFS}$ 时检查图的连通性，排除无解的情况。</p><h5 id="GAP-优化"><a href="#GAP-优化" class="headerlink" title="GAP 优化"></a>GAP 优化</h5><p>如果在某一刻存在 $h_u=T$ 的结点个数为 $0$ ，则对于 $h_u&gt;T$ 的结点就永远无法推送超额流到 $T$ ，只能流回 $S$ 。所以直接改变高度到至少 $|V|+1$ ，以尽快推送回源点，减少重贴标签操作的复杂度。</p><h5 id="最终实现"><a href="#最终实现" class="headerlink" title="最终实现"></a>最终实现</h5><p><a href="https://www.luogu.com.cn/problem/P4722">预流推进</a></p><details>    <summary>AC Code</summary><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;ctime&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iomanip&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stack&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;map&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> gh() getchar()</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> re register</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> ll;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN=<span class="number">1e3</span>+<span class="number">2e2</span>+<span class="number">1</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXM=<span class="number">1e5</span>+<span class="number">2e4</span>+<span class="number">1</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> INF=<span class="number">0x3f3f3f3f</span>;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    x=<span class="number">0</span>;</span><br><span class="line">    <span class="type">char</span> ch=<span class="built_in">gh</span>(),t=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(ch&lt;<span class="string">&#x27;0&#x27;</span>||ch&gt;<span class="string">&#x27;9&#x27;</span>) t|=ch==<span class="string">&#x27;-&#x27;</span>,ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">while</span>(ch&gt;=<span class="string">&#x27;0&#x27;</span>&amp;&amp;ch&lt;=<span class="string">&#x27;9&#x27;</span>) x=(x&lt;&lt;<span class="number">3</span>)+(x&lt;&lt;<span class="number">1</span>)+(ch^<span class="number">48</span>),ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">if</span>(t) x=-x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T,<span class="keyword">class</span> ...T1&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x,T1 &amp;...x1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">read</span>(x),<span class="built_in">read</span>(x1...);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">checkMax</span><span class="params">(T &amp;x,T &amp;y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x&lt;y?x=y,<span class="number">1</span>:<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">checkMin</span><span class="params">(T &amp;x,T &amp;y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x&gt;y?x=y,<span class="number">1</span>:<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> N,M,S,T;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Net</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> next,to,val;</span><br><span class="line">    <span class="built_in">Net</span>(<span class="type">int</span> n=<span class="number">0</span>,<span class="type">int</span> t=<span class="number">0</span>,<span class="type">int</span> v=<span class="number">0</span>):</span><br><span class="line">        <span class="built_in">next</span>(n),<span class="built_in">to</span>(t),<span class="built_in">val</span>(v)&#123;&#125;</span><br><span class="line">&#125;Edge[MAXM&lt;&lt;<span class="number">1</span>];</span><br><span class="line"><span class="type">int</span> Head[MAXN],Cur[MAXN],Total=<span class="number">1</span>;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">addEdge</span><span class="params">(<span class="type">int</span> u,<span class="type">int</span> v,<span class="type">int</span> w)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Edge[++Total]=<span class="built_in">Net</span>(Head[u],v,w);Head[u]=Total;</span><br><span class="line">    Edge[++Total]=<span class="built_in">Net</span>(Head[v],u,<span class="number">0</span>);Head[v]=Total;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> Ht[MAXN+<span class="number">1</span>],Ex[MAXN+<span class="number">1</span>],Gap[MAXN+<span class="number">1</span>];</span><br><span class="line">stack&lt;<span class="type">int</span>&gt;B[MAXN];</span><br><span class="line"><span class="type">int</span> Level=<span class="number">0</span>;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">Push</span><span class="params">(<span class="type">int</span> x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">bool</span> Init=x==S;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> e=Head[x];e;e=Edge[e].next)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">const</span> <span class="type">int</span> &amp;v=Edge[e].to,&amp;w=Edge[e].val;</span><br><span class="line">        <span class="keyword">if</span>(!w||(!Init)&amp;&amp;Ht[x]!=Ht[v]+<span class="number">1</span>) <span class="keyword">continue</span>;</span><br><span class="line">        <span class="type">int</span> k=Init?w:<span class="built_in">min</span>(w,Ex[x]);</span><br><span class="line">        <span class="keyword">if</span>(v!=S&amp;&amp;v!=T&amp;&amp;!Ex[v])</span><br><span class="line">            B[Ht[v]].<span class="built_in">push</span>(v),<span class="built_in">checkMax</span>(Level,Ht[v]);</span><br><span class="line">        Ex[x]-=k,Ex[v]+=k,Edge[e].val-=k,Edge[e^<span class="number">1</span>].val+=k;</span><br><span class="line">        <span class="keyword">if</span>(!Ex[x]) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">Relabel</span><span class="params">(<span class="type">int</span> x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Ht[x]=INF;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> e=Head[x];e;e=Edge[e].next)</span><br><span class="line">        <span class="keyword">if</span>(Edge[e].val) <span class="built_in">checkMin</span>(Ht[x],Ht[Edge[e].to]);</span><br><span class="line">    <span class="keyword">if</span>(++Ht[x]&lt;N)</span><br><span class="line">    &#123;</span><br><span class="line">        B[Ht[x]].<span class="built_in">push</span>(x);</span><br><span class="line">        <span class="built_in">checkMax</span>(Level,Ht[x]);</span><br><span class="line">        ++Gap[Ht[x]];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">Bfs</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">memset</span>(Ht,<span class="number">0x3f</span>,<span class="built_in">sizeof</span>(Ht));</span><br><span class="line">    queue&lt;<span class="type">int</span>&gt;Q;</span><br><span class="line">    Q.<span class="built_in">push</span>(T),Ht[T]=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(!Q.<span class="built_in">empty</span>())</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> u=Q.<span class="built_in">front</span>();Q.<span class="built_in">pop</span>();</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> e=Head[u];e;e=Edge[e].next)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="type">const</span> <span class="type">int</span> &amp;v=Edge[e].to;</span><br><span class="line">            <span class="keyword">if</span>(Edge[e^<span class="number">1</span>].val&amp;&amp;Ht[v]&gt;Ht[u]+<span class="number">1</span>)</span><br><span class="line">                Ht[v]=Ht[u]+<span class="number">1</span>,Q.<span class="built_in">push</span>(v);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> Ht[S]!=INF;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">Select</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">while</span>(B[Level].<span class="built_in">empty</span>()&amp;&amp;Level&gt;=<span class="number">0</span>) --Level;</span><br><span class="line">    <span class="keyword">return</span> Level==<span class="number">-1</span>?<span class="number">0</span>:B[Level].<span class="built_in">top</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">Hlpp</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(!<span class="built_in">Bfs</span>()) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    <span class="built_in">memset</span>(Gap,<span class="number">0</span>,<span class="built_in">sizeof</span>(Gap));</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=N;++i)</span><br><span class="line">        <span class="keyword">if</span>(Ht[i]!=INF) ++Gap[Ht[i]];</span><br><span class="line">    Ht[S]=N;</span><br><span class="line">    <span class="built_in">Push</span>(S);</span><br><span class="line">    <span class="type">int</span> u;</span><br><span class="line">    <span class="keyword">while</span>((u=<span class="built_in">Select</span>()))</span><br><span class="line">    &#123;</span><br><span class="line">        B[Level].<span class="built_in">pop</span>();</span><br><span class="line">        <span class="keyword">if</span>(<span class="built_in">Push</span>(u))</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span>(!--Gap[Ht[u]])</span><br><span class="line">                <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=N;++i)</span><br><span class="line">                    <span class="keyword">if</span>(i!=S&amp;&amp;i!=T&amp;&amp;Ht[i]&gt;Ht[u]&amp;&amp;Ht[i]&lt;N+<span class="number">1</span>)</span><br><span class="line">                        Ht[i]=N+<span class="number">1</span>;</span><br><span class="line">            <span class="built_in">Relabel</span>(u);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> Ex[T];</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// freopen(&quot;Hlpp.in&quot;,&quot;r&quot;,stdin);</span></span><br><span class="line">    <span class="comment">// freopen(&quot;Hlpp.out&quot;,&quot;w&quot;,stdout);</span></span><br><span class="line">    <span class="built_in">read</span>(N,M,S,T);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>,u,v,w;i&lt;=M;++i)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">read</span>(u,v,w);</span><br><span class="line">        <span class="built_in">addEdge</span>(u,v,w);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d&quot;</span>,<span class="built_in">Hlpp</span>());</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">10 16 1 2</span></span><br><span class="line"><span class="comment">1 3 2</span></span><br><span class="line"><span class="comment">1 4 2</span></span><br><span class="line"><span class="comment">5 2 2</span></span><br><span class="line"><span class="comment">6 2 2</span></span><br><span class="line"><span class="comment">3 5 1</span></span><br><span class="line"><span class="comment">3 6 1</span></span><br><span class="line"><span class="comment">4 5 1</span></span><br><span class="line"><span class="comment">4 6 1</span></span><br><span class="line"><span class="comment">1 7 2147483647</span></span><br><span class="line"><span class="comment">9 2 2147483647</span></span><br><span class="line"><span class="comment">7 8 2147483647</span></span><br><span class="line"><span class="comment">10 9 2147483647</span></span><br><span class="line"><span class="comment">8 5 2</span></span><br><span class="line"><span class="comment">8 6 2</span></span><br><span class="line"><span class="comment">3 10 2</span></span><br><span class="line"><span class="comment">4 10 2</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure></details><hr><h3 id="多源汇最大流"><a href="#多源汇最大流" class="headerlink" title="多源汇最大流"></a>多源汇最大流</h3><p>很简单，建立一个超级源点 $S$ 链接所有的源点 $s’$ ，容量为 $inf$ ；建立一个超级汇点链接所有的汇点 $t’$ ，容量为 $inf$ 。然后处理增广路（跑模板）。</p><p>可能是因为太简单了吧，我没有找到模板题，就和普通的网络最大流少了一步而已。</p><hr><h2 id="最小割"><a href="#最小割" class="headerlink" title="最小割"></a>最小割</h2><h3 id="割"><a href="#割" class="headerlink" title="割"></a>割</h3><p>割是一种划分，将 $V$ 划分成两个集合 $S,T$ 满足 $S\cup T=V,S\cap T=\varnothing$ 。且有 $s\in S,t\in T$ 。</p><hr><h3 id="割的容量-x-最小割"><a href="#割的容量-x-最小割" class="headerlink" title="割的容量 x 最小割"></a>割的容量 x 最小割</h3><p>对于割 $(S,T)$ 有容量 $c(S,T)$ 表示 $c(S,T)=\sum_{u\in S,v\in T}c(u,v)$ ，即从 $S$ 到 $T$ 的边的容量之和。且有 $c(s,t)=c(S,T)$ 。</p><p>而最小割就是求一个集合划分使 $c(S,T)$ 最小。</p><hr><h3 id="最大流最小割定理"><a href="#最大流最小割定理" class="headerlink" title="最大流最小割定理"></a>最大流最小割定理</h3><p>$f(s,t)_{\max}=c(s,t)_{\min}$</p><p>对于任意一个可行流 $f(s,t)$ 的割 $(S,T)$ ，则有：</p><script type="math/tex; mode=display">f(s,t)=S出边的总流量-S入边的总流量\leq S出边的总流量=c(s,t)</script><p>那么，令 $f$ 是最大流，则其残余网络中不会存在 $(s,t)$ 的增广路，那么 $S$ 的出边是满流，入边是零流，则：</p><script type="math/tex; mode=display">f(s,t)=S出边的总流量-S入边的总流量=S出边的总流量=c(s,t)</script><p>而此时的 $f(s,t)$ 实际上是流函数 $f$ 的 $f(s,t)_{\max}$ 。</p><hr><h3 id="求割边数量"><a href="#求割边数量" class="headerlink" title="求割边数量"></a>求割边数量</h3><p>即在满足最小割的前提下，最小化割边的数量（即删除的边的数量）。首先跑最大流求出最小割，然后将没有满流的边容量改成 $inf$ ，并将满流了的边的容量改为 $1$ ，重新跑一遍最小割，求出来的即是最小割边数。如果没有最小割，则直接将所有边的容量都设为 $1$ 并跑最小割。</p><hr><h3 id="全局最小割-x-Stoer-Wagner-算法"><a href="#全局最小割-x-Stoer-Wagner-算法" class="headerlink" title="全局最小割 x Stoer-Wagner 算法"></a>全局最小割 x Stoer-Wagner 算法</h3><p>你可以把它理解为无源汇最小割，其最小割的重定义为：</p><blockquote><p>去掉其中一些边能使一张网络不再连通的边集称为该网络的割。</p><p>其最小割定义为方案中边集和最小的一种方案。</p></blockquote><p>使用 $Stoer-Wagner$ 算法来解决这个问题。（因为无源汇，所以你暴力建源汇点跑 $N^2$ 次即使是 $ISAP$ 也是行不通的）</p><p>时间复杂度 $\mathcal O(|V||E|+|V|^2\log |V|)$ 近似于 $\mathcal O(V^3)$ 。</p><p>存在一个结论：</p><blockquote><p>图中有任意两点 $u,v$ ，存在 $G$ 的任意一个割 $C$ ，要么 $u$ 和 $v$ 连通，在同意连通块；要么 $C$ 是一个 $u-v$ 割。</p></blockquote><p>Stoer-Wagner 算法在 1995 年由 Mechthild Stoer 与 Frank Wagner 提出，是一种通过<strong>递归</strong>的方式来解决<strong>无向正权图</strong>上的全局最小割问题的算法。</p><p>流程：</p><ol><li>任意指定两点 $s,t$ 作为源汇点并求出 $C(s-t)$ ，记作 $cut\ of\ phase$ ，更新答案；</li><li><strong>合并</strong>点 $s,t$ ，如果 $|V|&gt;1$ ，重复操作一；</li><li>答案保证 $ans=\min\{cut\ of\ phase\}$ 。</li></ol><p>合并：</p><blockquote><p>删除边 $c(s,t)$ ，并对于 $G/\{s,t\}$ 中的 $k$ ，删除 $c(t,k)$ ，并将边权 $val(t,k)$ 加到 $val(s,k)$ 中。</p></blockquote><h4 id="算法的正确性"><a href="#算法的正确性" class="headerlink" title="算法的正确性"></a>算法的正确性</h4><p>如果 $s,t$ 在同一连通块中，则 $(k,s)\in C_{\min}$ 与 $(k,t)\in C_{\min}$ 互为充分必要条件。否则，因为 $s,t$ 连通， $k,t$ 连通，导致 $s,k$ 连通，此时 $C=C_{\min}/s$ ，将比 $C_{\min}$ 更优，反之亦然。所以 $s,t$ 可以看做同一点。</p><p>操作一考虑了 $s,t$ 不连通的情况，而 $s,t$ 解决了剩下的情况。根据操作的递归性，操作执行 $|V|-1$ 次后必然结束。</p><h4 id="求取-S-T-最小割"><a href="#求取-S-T-最小割" class="headerlink" title="求取 S-T 最小割"></a>求取 S-T 最小割</h4><p>如果我都写出来了，说明就不能跑最大流啊。</p><p>当前状态下的图表示为 $G’=(V’,E’)$ ，构造一个集合记为 $A$ ，初始有 $A=\varnothing$ 。</p><p>定义权值函数为 $w(A,i)=\sum_{j\in A}val(i,j)$ ，特殊地， $val(i,j)=0,(i,j)\notin E’$ 。</p><p>遍历 $V’$ 中的所有点，若有 $i\notin A$ ，将 $w(A,i)$ 中最大的节点加入 $A$ 直到 $|A|=|V’|$ 。</p><p>所有点加入 $A$ 的顺序必然是固定的，有 $ord(i)$ 表示第 $i$ 个加入 $A$ 的点，有 $t=ord(|V’|)$ ； $pos(v)$ 表示 $v$ 被加入 $A$ 后 $|A|$ 的大小，即 $v$ 被加入的顺序。</p><p>对于任意点 $s$ ，则 $c(s-t)=w(t)$ 。</p><p><a href="https://oi-wiki.org/graph/stoer-wagner/#_6">正确性证明</a></p><p>似乎这个算法的绝大部分代码使用的都是邻接矩阵。（至少我没有发现链式前向星和邻接表的写法）似乎可以联系 Prim 算法来理解，不过 Prim 我也没学过，所以不考虑。</p><p>写法参考 OI-Wiki 。</p><details>    <summary>AC Code</summary><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;ctime&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iomanip&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stack&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;map&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> gh() getchar()</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> re register</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> ll;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN=<span class="number">601</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> INF=<span class="number">0x7f7f7f7f</span>;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    x=<span class="number">0</span>;</span><br><span class="line">    <span class="type">char</span> ch=<span class="built_in">gh</span>(),t=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(ch&lt;<span class="string">&#x27;0&#x27;</span>||ch&gt;<span class="string">&#x27;9&#x27;</span>) t|=ch==<span class="string">&#x27;-&#x27;</span>,ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">while</span>(ch&gt;=<span class="string">&#x27;0&#x27;</span>&amp;&amp;ch&lt;=<span class="string">&#x27;9&#x27;</span>) x=(x&lt;&lt;<span class="number">3</span>)+(x&lt;&lt;<span class="number">1</span>)+(ch^<span class="number">48</span>),ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">if</span>(t) x=-x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T,<span class="keyword">class</span> ...T1&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x,T1 &amp;...x1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">read</span>(x),<span class="built_in">read</span>(x1...);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">checkMax</span><span class="params">(T &amp;x,T &amp;y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x&lt;y?x=y,<span class="number">1</span>:<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">checkMin</span><span class="params">(T &amp;x,T &amp;y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x&gt;y?x=y,<span class="number">1</span>:<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> Fa[MAXN],Size[MAXN],Edge[MAXN][MAXN];</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">Find</span><span class="params">(<span class="type">int</span> x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(x==Fa[x]) <span class="keyword">return</span> x;</span><br><span class="line">    <span class="keyword">return</span> Fa[x]=<span class="built_in">Find</span>(Fa[x]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> Dist[MAXN],Vis[MAXN],Bin[MAXN];</span><br><span class="line"><span class="comment">//Bin记录该点是否被合并过</span></span><br><span class="line"><span class="comment">//Vis记录本次查询中是否已经被搜到过</span></span><br><span class="line"><span class="comment">//Dist记录当前最大权值（具体什么权值我也不太清楚）</span></span><br><span class="line"><span class="type">int</span> N,M;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">contract</span><span class="params">(<span class="type">int</span> &amp;s,<span class="type">int</span> &amp;t)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">memset</span>(Dist,<span class="number">0</span>,<span class="built_in">sizeof</span>(Dist));</span><br><span class="line">    <span class="built_in">memset</span>(Vis,<span class="number">0</span>,<span class="built_in">sizeof</span>(Vis));</span><br><span class="line">    <span class="type">int</span> k,minCut,maxCut;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=N;++i)</span><br><span class="line">    &#123;</span><br><span class="line">        k=maxCut=<span class="number">-1</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">1</span>;j&lt;=N;++j)</span><br><span class="line">            <span class="keyword">if</span>(!Bin[j]&amp;&amp;!Vis[j]&amp;&amp;Dist[j]&gt;maxCut)</span><br><span class="line">            &#123;</span><br><span class="line">                k=j;</span><br><span class="line">                maxCut=Dist[j];</span><br><span class="line">            &#125;</span><br><span class="line">        <span class="keyword">if</span>(k==<span class="number">-1</span>) <span class="keyword">return</span> minCut;</span><br><span class="line">        s=t,t=k;</span><br><span class="line">        minCut=maxCut;</span><br><span class="line">        Vis[k]=<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">1</span>;j&lt;=N;++j)</span><br><span class="line">            <span class="keyword">if</span>(!Bin[j]&amp;&amp;!Vis[j]) Dist[j]+=Edge[k][j];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> minCut;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">Stoer_Wagner</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> i,minCut,s,t,res;</span><br><span class="line">    <span class="keyword">for</span>(i=<span class="number">1</span>,minCut=INF;i&lt;N;++i)</span><br><span class="line">    &#123;</span><br><span class="line">        res=<span class="built_in">contract</span>(s,t);</span><br><span class="line">        Bin[t]=<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span>(minCut&gt;res) minCut=res;</span><br><span class="line">        <span class="keyword">if</span>(minCut==<span class="number">0</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">1</span>;j&lt;=N;++j)</span><br><span class="line">            <span class="keyword">if</span>(!Bin[j]) Edge[s][j]=(Edge[j][s]+=Edge[j][t]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> minCut;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// freopen(&quot;sto.in&quot;,&quot;r&quot;,stdin);</span></span><br><span class="line">    <span class="comment">// freopen(&quot;sto.out&quot;,&quot;w&quot;,stdout);</span></span><br><span class="line">    <span class="built_in">read</span>(N,M);</span><br><span class="line">    <span class="keyword">if</span>(M&lt;N<span class="number">-1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;0&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=N;++i) Fa[i]=i,Size[i]=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>,u,v,w;i&lt;=M;++i)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">read</span>(u,v,w);</span><br><span class="line">        <span class="type">int</span> uf=<span class="built_in">Find</span>(u),vf=<span class="built_in">Find</span>(v);</span><br><span class="line">        <span class="keyword">if</span>(uf!=vf)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span>(Size[uf]&gt;Size[vf]) <span class="built_in">swap</span>(uf,vf);</span><br><span class="line">            Fa[uf]=vf,Size[vf]+=Size[uf];</span><br><span class="line">        &#125;</span><br><span class="line">        Edge[u][v]+=w,Edge[v][u]+=w;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> rf=<span class="built_in">Find</span>(<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">if</span>(Size[rf]!=N)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;0&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d&quot;</span>,<span class="built_in">Stoer_Wagner</span>());</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">4 6</span></span><br><span class="line"><span class="comment">1 2 5</span></span><br><span class="line"><span class="comment">1 3 1</span></span><br><span class="line"><span class="comment">2 4 1</span></span><br><span class="line"><span class="comment">3 4 2</span></span><br><span class="line"><span class="comment">2 3 1</span></span><br><span class="line"><span class="comment">1 4 2</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure></details><hr><h3 id="最大权闭合图"><a href="#最大权闭合图" class="headerlink" title="最大权闭合图"></a>最大权闭合图</h3><p>在一个网络（图） $G=(V,E)$ 中的一个子图满足该子图中的任意点的任意一条边都不会引申到该图之外的任意节点。而最大权闭合子图就是满足上述条件，点权和最大的子图。</p><p>一般而言，这种定义都针对于有向图，如果是无向图，那么这张图唯一一个闭合图就是它本身，否则该图不连通。</p><p>那么如何求解最大权闭合图。</p><p>当然是使用网络流。（否则也不会写在这儿）</p><p>首先给出结论和做法：</p><ol><li>建立一个超级源点 $S$ 和一个超级汇点 $T$ ；</li><li>对于 $\forall x\in V,pt[x]\ge 0$ ，链接 $(S,x,pt[x])$ ；</li><li>对于 $\forall x\in V,pt[x]&lt;0$ ，链接 $(x,T,-pt[x])$ 。</li><li>对于 $\forall c(u,v)\in E$ ，链接 $(u,v,inf)$ 。</li><li>最大权闭合图的权值等于正权点点权和减去从 $S$ 到 $T$ 的最大流。</li></ol><p>从 $S$ 而出的是最大可获得权值（正权值和），向 $T$ 而出的是最大损失权值（负权值和）。</p><p>尽量多从 $S$ 获得的同时，避免向 $T$ 丢失。</p><blockquote><p>如果选定一个点进入最大权闭合图，则这个点的所有后继点都必须被选择。</p></blockquote><p>否则有悖定义。</p><p>对于我们建出来的这个图，得到的最小割必定是<strong>简单割</strong>，（即划分出来的其中一个集合有且仅有源点或者汇点）否则不是该图的最小割。</p><p>那么，从 $S$ 流出的流量则是得到的，流向 $T$ 的则是损失的。所以 $flow[S]-flow[T]$ 即是最大权。</p><p>所谓 $flow[S]$ ，就是 $\displaystyle \sum\limits_{x}^{x\in V} pt[x],pt[x]\ge 0$ 。</p><p>但如何求出 $flow[T]$ ，就是关键所在。因为对于一个点 $x$ 的后继损失不会超过该点的权值。那不妨我一开始就把所有的正权点都给选了（满足从 $S$ 流出的最多），让他们往后代流，大不了被负权子孙点损失完，而那些没有被损失完的，就是我们统计下来的结果。</p><p>最后得出结论：$flow[T]$ 就是从 $S$ 到 $T$ 的最大流（最小割）。</p><p>值得注意的一点：<strong>最大权闭合图与最小割一一对应</strong>。</p><p>令 $sum_+$ 为正点权和，$choose_+$ 为不选的正点权和，$choose_-$ 为选择的负点权和，则有：</p><p>$c(S,T)=choose_++|choose_-|$</p><p>$val_{max}=sum_+-(choose_++|choose_-|)=sum_+-c(S,T)$ </p><p>$sum_+$ 是定值，所以最大权闭合子图和最小割一一对应，而最小割又与最大流一一对应。所以上文的结论也就显而易见了。</p><hr><p><a href="https://www.luogu.com.cn/problem/P4174">最大权闭合图</a>的<a href="https://www.luogu.com.cn/problem/CF1082G">双倍经验</a></p><p>求一个子图的边权和减去点权和。</p><blockquote><p>那么，从 $S$ 流出的流量则是得到的，流向 $T$ 的则是损失的。所以 $flow[S]-flow[T]$ 即是最大权。</p></blockquote><p>有这句话的定义，我们可以知道建图的大概方向：</p><ol><li>对于每一条边 $e$ ，链接 $(S,e)$ ，容量为边权；</li><li>对于每一个点 $v$ ，链接 $(v,T)$ ，容量为点权；</li><li>对于每一条边 $e(u,v)$ ，链接 $(e,u),(e,v)$ ，容量都是 $inf$ 。</li></ol><p>答案是 $\displaystyle\sum_{e}e_w-Dinic()$ 。</p><p>点数：$|V|=N+M+2$</p><p>边数：$|E|=2(N+3M)$</p><details>    <summary>AC Code</summary><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;ctime&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iomanip&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stack&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;map&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> gh() getchar()</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> re register</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> ll;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN=<span class="number">5e3</span>+<span class="number">10</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXM=<span class="number">5e4</span>+<span class="number">10</span>;</span><br><span class="line"><span class="type">const</span> ll INF=<span class="number">1145141919810</span>;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    x=<span class="number">0</span>;</span><br><span class="line">    <span class="type">char</span> ch=<span class="built_in">gh</span>(),t=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(ch&lt;<span class="string">&#x27;0&#x27;</span>||ch&gt;<span class="string">&#x27;9&#x27;</span>) t|=ch==<span class="string">&#x27;-&#x27;</span>,ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">while</span>(ch&gt;=<span class="string">&#x27;0&#x27;</span>&amp;&amp;ch&lt;=<span class="string">&#x27;9&#x27;</span>) x=(x&lt;&lt;<span class="number">3</span>)+(x&lt;&lt;<span class="number">1</span>)+(ch^<span class="number">48</span>),ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">if</span>(t) x=-x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T,<span class="keyword">class</span> ...T1&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x,T1 &amp;...x1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">read</span>(x),<span class="built_in">read</span>(x1...);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">write</span><span class="params">(T x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(x&lt;<span class="number">0</span>) <span class="built_in">putchar</span>(<span class="string">&#x27;-&#x27;</span>),x=-x;</span><br><span class="line">    <span class="keyword">if</span>(x&gt;<span class="number">9</span>) <span class="built_in">write</span>(x/<span class="number">10</span>);</span><br><span class="line">    <span class="built_in">putchar</span>(x%<span class="number">10</span>+<span class="string">&#x27;0&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">checkMax</span><span class="params">(T &amp;x,T &amp;y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x&lt;y?x=y,<span class="number">1</span>:<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">checkMin</span><span class="params">(T &amp;x,T &amp;y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x&gt;y?x=y,<span class="number">1</span>:<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> N,M,S,T;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Net</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> next,to;ll val;</span><br><span class="line">&#125;Edge[<span class="number">2</span>*MAXN+<span class="number">6</span>*MAXM];</span><br><span class="line"><span class="type">int</span> Head[MAXN+MAXM],Cur[MAXN+MAXM],Total=<span class="number">1</span>;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">addEdge</span><span class="params">(<span class="type">int</span> u,<span class="type">int</span> v,ll w)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Edge[++Total]=(Net)&#123;Head[u],v,w&#125;;Head[u]=Total;</span><br><span class="line">    Edge[++Total]=(Net)&#123;Head[v],u,<span class="number">0</span>&#125;;Head[v]=Total;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> Fl[MAXN+MAXM];</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">Bfs</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">memset</span>(Fl,<span class="number">-1</span>,<span class="built_in">sizeof</span>(Fl));</span><br><span class="line">    Fl[S]=<span class="number">0</span>,Cur[S]=Head[S];</span><br><span class="line">    std::queue&lt;<span class="type">int</span>&gt;Q;</span><br><span class="line">    Q.<span class="built_in">push</span>(S);</span><br><span class="line">    <span class="keyword">while</span>(!Q.<span class="built_in">empty</span>())</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> u=Q.<span class="built_in">front</span>();Q.<span class="built_in">pop</span>();</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> e=Head[u],v;e;e=Edge[e].next)</span><br><span class="line">        &#123;</span><br><span class="line">            v=Edge[e].to;</span><br><span class="line">            <span class="keyword">if</span>(Fl[v]==<span class="number">-1</span>&amp;&amp;Edge[e].val)</span><br><span class="line">            &#123;</span><br><span class="line">                Fl[v]=Fl[u]+<span class="number">1</span>;Cur[v]=Head[v];</span><br><span class="line">                <span class="keyword">if</span>(v==T) <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">                Q.<span class="built_in">push</span>(v);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">ll <span class="title">Dfs</span><span class="params">(<span class="type">int</span> x,ll inf)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(x==T) <span class="keyword">return</span> inf;</span><br><span class="line">    ll flow=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> e=Cur[x],v;e&amp;&amp;flow&lt;inf;e=Edge[e].next)</span><br><span class="line">    &#123;</span><br><span class="line">        v=Edge[e].to,Cur[x]=e;</span><br><span class="line">        <span class="keyword">if</span>(Fl[v]==Fl[x]+<span class="number">1</span>&amp;&amp;Edge[e].val)</span><br><span class="line">        &#123;</span><br><span class="line">            ll k=<span class="built_in">Dfs</span>(v,std::<span class="built_in">min</span>(Edge[e].val,inf-flow));</span><br><span class="line">            <span class="keyword">if</span>(!k) Fl[v]=<span class="number">-1</span>;</span><br><span class="line">            Edge[e].val-=k,Edge[e^<span class="number">1</span>].val+=k,flow+=k;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> flow;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> ll <span class="title">Dinic</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    ll r=<span class="number">0</span>,flow;</span><br><span class="line">    <span class="keyword">while</span>(<span class="built_in">Bfs</span>()) <span class="keyword">while</span>(flow=<span class="built_in">Dfs</span>(S,INF)) r+=flow;</span><br><span class="line">    <span class="keyword">return</span> r;</span><br><span class="line">&#125;</span><br><span class="line">ll sum;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// freopen(&quot;mincut.in&quot;,&quot;r&quot;,stdin);</span></span><br><span class="line">    <span class="comment">// freopen(&quot;mincut.out&quot;,&quot;w&quot;,stdout);</span></span><br><span class="line">    <span class="built_in">read</span>(N,M);</span><br><span class="line">    S=<span class="number">0</span>,T=N+M+<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=N;++i)</span><br><span class="line">    &#123;</span><br><span class="line">        ll w;<span class="built_in">read</span>(w);</span><br><span class="line">        <span class="built_in">addEdge</span>(i+M,T,w);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>,u,v;i&lt;=M;++i)</span><br><span class="line">    &#123;</span><br><span class="line">        ll w;<span class="built_in">read</span>(u,v,w);sum+=w;</span><br><span class="line">        <span class="built_in">addEdge</span>(i,u+M,INF);</span><br><span class="line">        <span class="built_in">addEdge</span>(i,v+M,INF);</span><br><span class="line">        <span class="built_in">addEdge</span>(S,i,w);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">write</span>(sum-<span class="built_in">Dinic</span>());</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">4 5</span></span><br><span class="line"><span class="comment">1 5 2 2</span></span><br><span class="line"><span class="comment">1 3 4</span></span><br><span class="line"><span class="comment">1 4 4</span></span><br><span class="line"><span class="comment">3 4 5</span></span><br><span class="line"><span class="comment">3 2 2</span></span><br><span class="line"><span class="comment">4 2 2</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure></details><hr><h3 id="最大密度子图"><a href="#最大密度子图" class="headerlink" title="最大密度子图"></a>最大密度子图</h3><p>对于一个图 $G=(V,E)$ ，选出其一个子边集 $E’\subseteq E$ ，在求出一个子点集 $V’\subseteq V,\forall u,v\in V’,(u,v)\in E’$ ，即 $E’$ 集合中所有的边的两端点都必须在 $V’$ 中。对于一个子图 $G’=(V’,E’)$ 满足 $\frac{\mid E’|}{|V’|}$ 最大，则 $G’$ 是 $G$ 的最大密度子图。</p><p>这让人不禁想到了<a href="https://violeteternal.github.io/Eternity/OI/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/fractional-programming/">01 规划</a> ，所以也就采用二分求解。但是判断函数需要联系到最小割去。</p><p>再次回忆一次 $01$ 规划的思路。</p><p>令 $\frac{|E’|}{|V’|}=g$ ，则有 $|E’|=g|V’|$ ，那么如果要让该式子最大，则有 $\frac{|E’|}{|V’|}&gt;g$ ，同理就有 $|E’|-g|V’|&gt;0$ ，那么问题就可以转化为求出 $|E’|-g|V’|$ 的最大值，或者求 $g|V’|-|E’|$ 的最小值。</p><p>有一种方法是把求最大密度子图转化为最大权闭合图来做。但这样时间复杂度较高。</p><p>点数： $|V|+|E|$ ，边数 $3|E|+|V|$ 。</p><p>从最大密度子图的定义来看，它是满足了闭合图的性质的。而由边定点，对于边 $e=c(u,v)$ ，我们可以看做有一个点 $e$ ，有边 $u$ 和边 $v$ 与其相连。</p><p>建图：</p><ol><li>从超级源点 $S$ 到所有边点 $e$ 链接一条容量为 $1$ 的边；</li><li>从已知点 $e_a$ 到已知点 $e_b$ 链接一条容量为 $inf$ 的边；</li><li>从所有边点 $e$ 到超级汇点 $T$ 链接一条容量为 $g$ 的边。（$g$ 是当前二分抉择）</li></ol><p>然后跑最小割以求最大权闭合子图，求出的最大权就是 $|E’|-g|V’|$ 的最大值。</p><h4 id="性质法"><a href="#性质法" class="headerlink" title="性质法"></a>性质法</h4><p>已知算式 $|E’|-g|V’|$ 与 $g|V’|-|E’|$ 一一对应，且当 $|E’|-g|V’|$ 最大时，$g|V’|-|E’|$ 正好取得最小值，我们可以从这一方面入手。</p><blockquote><p>选择的点集为 $|V’|$ 的话，则点集内所有的边都被选择的情况，是对于当前点集最优的情况。</p></blockquote><p>该性质显然，无需证明。</p><p>我们定义一个反点集 $\overline{V’}=V-V’$ ，即所有没有选择的点的集合，并定义一个函数 $deg[v]$ 表示 $v$ 的度数。（即有多少条边以 $v$ 为端点）</p><p>有：</p><script type="math/tex; mode=display">g|V'|-|E'|=\sum_{v\in V'}g-(\frac{\sum_{v\in V'}dep[v]-C(V',\overline{V'})}{2})</script><p>设集合内部所有点的度数之和是 $sum$ ，那么，处于集合内部的边一定被计算了 $2$ 次，因为该边的两个端点均在集合内。而处于集合 $V’$ 与集合 $\overline{V’}$ 之间的割边只被计算了一次，而这样的割边的数量就是该割的容量 $C(V’,\overline{V’})$ ，因为原图的所有边的容量在流网络中都设置成了 $1$ 。</p><p>变换形式，得到一个较好处理的式子：</p><script type="math/tex; mode=display">\text{原式}=\frac{1}{2}(\sum_{v\in V'}(2g-dep[v])+C(V',\overline{V'}))</script><p>在每一次抉择时， $2g-dep[v]$ 的值是相等的，所以影响整个式子的唯一点就是这张图的最小割。</p><p>再说说怎么建图：（讲的不是太明白）</p><ol><li>从每一个点往超级汇点 $T$ 链接一条容量为 $2g-deg[v]+Q$ 的边；</li><li>从超级源点 $S$ 向每一个点链接一条容量为 $Q$ 的边。</li><li>取出原图，将所有原边的容量修改为 $1$ 。</li></ol><p>这里的 $Q$ 是一个常数，一个偏移量，一个满足 $2g-dep[v]$ 是正数的任意值，一般可以取到 $|E|$ ，即原图的边数。（$Q$ 存在的原因是容量不能为负）</p><p>我们已知，割的容量 $C(S,T)$ 表达式可以有三种：</p><ol><li>$s\rightarrow \overline{V’}$</li><li>$V’\rightarrow t$</li><li>$V’\rightarrow \overline{V’}$</li></ol><p>其中 $V’=S-s$ 。</p><p>以 $c_{(u,v)}$ 的一个 $\{0,1\}$ 函数表示 $u,v$ 之间是否连接，则有</p><script type="math/tex; mode=display">C(S,T)=\sum_{v\in V'}Q+\sum_{u\in V'}(2g-dep[u]+Q)+\sum_{u\in V'}\sum_{v\in\overline{V'}}c_{(u,v)}</script><p>因为有：</p><blockquote><p>$dep[u]$ 表示的是以 $u$ 点为端点的边数；</p><p>而 $\sum_{v\in\overline{V’}}c_{(u,v)}$ 表示的是点 $u$ 到达集合 $V’$ 外部 $\overline{V’}$ 的边数；</p><p>相减得到点 $u$ 到达集合内部的边数 $\sum_{u\in V’}c_{(u,v)}$</p></blockquote><p>再次化简：</p><script type="math/tex; mode=display">\begin{align}C(S,T)&=\sum_{v\in V'}Q+\sum_{u\in V'}(Q+2g-dep[u]+\sum_{v\in V'}c_{(u,v)})    \nonumber&\\&=\sum_{v\in\overline{V'}}Q+\sum_{u\in V'}(Q+2g-\sum_{v\in V'}c_{(u,v)})    \nonumber&\\&=\sum_{v\in V'}Q+\sum_{v\in\overline{V'}}Q+\sum_{u\in V'}2g-\sum_{u\in V'}\sum_{v\in V'}c_{(u,v)}    \nonumber&\\&=nQ+2g|V'|-2|E'|    \nonumber&\end{align}</script><p>最后得到一个肥肠简单的式子：</p><script type="math/tex; mode=display">C(S,T)=nQ+2(g|V'|-|E'|)</script><p>显然地，$nQ$ 是针对全局的定值，而 $\min\{g|V’|-|E’|\}$ 就是整道题的答案，也就有：</p><script type="math/tex; mode=display">\min\{g|V'|-|E'|\}=\frac{1}{2}\min\{C(S,T)-nQ\}</script><p>总结全题：</p><p>点数：$|V|$ ，边数：$2|V|+|E|$ 。时间复杂度在于 $\mathcal O(\log (l,r)\times \mathcal O(maxFlow))$ ，取决于二分的值域以及跑最小割（最大流）的算法。</p><p>后来发现，二分的值域可以取 $[\frac{1}{n},m]$ ，不过取 $[0,m]$ 也不会有太大影响。</p><p><strong>需要注意的是：上述所有方法都是限于无权点无权边最大密度子图问题，如果有权点或者有权边则需另加讨论。</strong></p><p><a href="https://www.luogu.com.cn/problem/UVA1389">模板题指路</a></p><details>    <summary>AC Code</summary><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;ctime&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iomanip&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stack&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;map&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> gh() getchar()</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> re register</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> ll;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN=<span class="number">201</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXM=<span class="number">5e3</span>+<span class="number">1</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> INF=<span class="number">1e9</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">double</span> eps=<span class="number">1e-8</span>;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    x=<span class="number">0</span>;</span><br><span class="line">    <span class="type">char</span> ch=<span class="built_in">gh</span>(),t=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(ch&lt;<span class="string">&#x27;0&#x27;</span>||ch&gt;<span class="string">&#x27;9&#x27;</span>) t|=ch==<span class="string">&#x27;-&#x27;</span>,ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">while</span>(ch&gt;=<span class="string">&#x27;0&#x27;</span>&amp;&amp;ch&lt;=<span class="string">&#x27;9&#x27;</span>) x=(x&lt;&lt;<span class="number">3</span>)+(x&lt;&lt;<span class="number">1</span>)+(ch^<span class="number">48</span>),ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">if</span>(t) x=-x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T,<span class="keyword">class</span> ...T1&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x,T1 &amp;...x1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">read</span>(x),<span class="built_in">read</span>(x1...);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">checkMax</span><span class="params">(T &amp;x,T &amp;y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x&lt;y?x=y,<span class="number">1</span>:<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">checkMin</span><span class="params">(T &amp;x,T &amp;y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x&gt;y?x=y,<span class="number">1</span>:<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> N,M,S,T;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">G</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> next,to;</span><br><span class="line">    <span class="type">double</span> val;</span><br><span class="line">    <span class="built_in">G</span>(<span class="type">int</span> n=<span class="number">0</span>,<span class="type">int</span> t=<span class="number">0</span>,<span class="type">double</span> v=<span class="number">0</span>):<span class="built_in">next</span>(n),<span class="built_in">to</span>(t),<span class="built_in">val</span>(v)&#123;&#125;</span><br><span class="line">&#125;Edge[MAXM&lt;&lt;<span class="number">1</span>];</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Eg</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> u,v;</span><br><span class="line">&#125;Edges[MAXM&lt;&lt;<span class="number">1</span>];</span><br><span class="line"><span class="type">int</span> Head[MAXN],Total=<span class="number">1</span>;</span><br><span class="line"><span class="type">int</span> Deg[MAXN],ans,Cur[MAXN];</span><br><span class="line"><span class="type">bool</span> St[MAXN];</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">addEdge</span><span class="params">(<span class="type">int</span> u,<span class="type">int</span> v,<span class="type">double</span> w1,<span class="type">double</span> w2)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Edge[++Total]=<span class="built_in">G</span>(Head[u],v,w1);Head[u]=Total;</span><br><span class="line">    Edge[++Total]=<span class="built_in">G</span>(Head[v],u,w2);Head[v]=Total;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">build</span><span class="params">(<span class="type">double</span> g)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">memset</span>(Head,<span class="number">0</span>,<span class="built_in">sizeof</span>(Head));</span><br><span class="line">    Total=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=M;++i) <span class="built_in">addEdge</span>(Edges[i].u,Edges[i].v,<span class="number">1</span>,<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=N;++i)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">addEdge</span>(S,i,M,<span class="number">0</span>);</span><br><span class="line">        <span class="built_in">addEdge</span>(i,T,M+g*<span class="number">2</span>-Deg[i],<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> Fl[MAXN];</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">Bfs</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">memset</span>(Fl,<span class="number">-1</span>,<span class="built_in">sizeof</span>(Fl));</span><br><span class="line">    Fl[S]=<span class="number">0</span>,Cur[S]=Head[S];</span><br><span class="line">    queue&lt;<span class="type">int</span>&gt;Q;</span><br><span class="line">    Q.<span class="built_in">push</span>(S);</span><br><span class="line">    <span class="keyword">while</span>(!Q.<span class="built_in">empty</span>())</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> u=Q.<span class="built_in">front</span>();Q.<span class="built_in">pop</span>();</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> e=Head[u],v;e;e=Edge[e].next)</span><br><span class="line">        &#123;</span><br><span class="line">            v=Edge[e].to;</span><br><span class="line">            <span class="keyword">if</span>(Fl[v]==<span class="number">-1</span>&amp;&amp;Edge[e].val&gt;<span class="number">0</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                Fl[v]=Fl[u]+<span class="number">1</span>;</span><br><span class="line">                Cur[v]=Head[v];</span><br><span class="line">                <span class="keyword">if</span>(v==T) <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">                Q.<span class="built_in">push</span>(v);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">double</span> <span class="title">Dfs</span><span class="params">(<span class="type">int</span> x,<span class="type">double</span> inf)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(x==T) <span class="keyword">return</span> inf;</span><br><span class="line">    <span class="type">double</span> flow=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> e=Cur[x];e&amp;&amp;flow&lt;inf;e=Edge[e].next)</span><br><span class="line">    &#123;</span><br><span class="line">        Cur[x]=e;</span><br><span class="line">        <span class="type">int</span> v=Edge[e].to;</span><br><span class="line">        <span class="keyword">if</span>(Fl[v]==Fl[x]+<span class="number">1</span>&amp;&amp;Edge[e].val&gt;<span class="number">0</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="type">double</span> k=<span class="built_in">Dfs</span>(v,<span class="built_in">min</span>(Edge[e].val,inf-flow));</span><br><span class="line">            <span class="keyword">if</span>(k&lt;=<span class="number">0</span>) Fl[v]=<span class="number">-1</span>;</span><br><span class="line">            Edge[e].val-=k,Edge[e^<span class="number">1</span>].val+=k,flow+=k;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> flow;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">double</span> <span class="title">Dinic</span><span class="params">(<span class="type">double</span> g)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">build</span>(g);</span><br><span class="line">    <span class="type">double</span> r=<span class="number">0</span>,flow;</span><br><span class="line">    <span class="keyword">while</span>(<span class="built_in">Bfs</span>()) <span class="keyword">while</span>(flow=<span class="built_in">Dfs</span>(S,INF)) r+=flow;</span><br><span class="line">    <span class="keyword">return</span> r;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Search</span><span class="params">(<span class="type">int</span> x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    St[x]=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span>(x!=S) ++ans;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> e=Head[x];e;e=Edge[e].next)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> v=Edge[e].to;</span><br><span class="line">        <span class="keyword">if</span>(!St[v]&amp;&amp;Edge[e].val&gt;<span class="number">0</span>) <span class="built_in">Search</span>(v);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// freopen(&quot;minCut.in&quot;,&quot;r&quot;,stdin);</span></span><br><span class="line">    <span class="comment">// freopen(&quot;minCut.out&quot;,&quot;w&quot;,stdout);</span></span><br><span class="line">    <span class="keyword">while</span>((<span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>,&amp;N,&amp;M))!=EOF)</span><br><span class="line">    &#123;</span><br><span class="line">        S=<span class="number">0</span>,T=N+<span class="number">1</span>;</span><br><span class="line">        <span class="built_in">memset</span>(Deg,<span class="number">0</span>,<span class="built_in">sizeof</span>(Deg));</span><br><span class="line">        <span class="built_in">memset</span>(St,<span class="number">0</span>,<span class="built_in">sizeof</span>(St));</span><br><span class="line">        ans=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>,u,v;i&lt;=M;++i)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">read</span>(u,v);</span><br><span class="line">            ++Deg[u],++Deg[v];</span><br><span class="line">            Edges[i]=&#123;u,v&#125;;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">double</span> l=<span class="number">0</span>,r=M;</span><br><span class="line">        <span class="keyword">while</span>(r-l&gt;eps)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="type">double</span> mid=(l+r)/<span class="number">2</span>;</span><br><span class="line">            <span class="type">double</span> k=<span class="built_in">Dinic</span>(mid);</span><br><span class="line">            <span class="keyword">if</span>(M*N-k&gt;<span class="number">0</span>) l=mid;</span><br><span class="line">            <span class="keyword">else</span> r=mid;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">Dinic</span>(l);</span><br><span class="line">        <span class="built_in">Search</span>(S);</span><br><span class="line">        <span class="keyword">if</span>(!ans) <span class="built_in">printf</span>(<span class="string">&quot;1\n1\n&quot;</span>);</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;    </span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,ans);</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=N;++i)</span><br><span class="line">                <span class="keyword">if</span>(St[i]) <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,i);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">5 6</span></span><br><span class="line"><span class="comment">1 5</span></span><br><span class="line"><span class="comment">5 4</span></span><br><span class="line"><span class="comment">4 2</span></span><br><span class="line"><span class="comment">2 5</span></span><br><span class="line"><span class="comment">1 2</span></span><br><span class="line"><span class="comment">3 1</span></span><br><span class="line"><span class="comment">4 0</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure></details><hr><h3 id="最小权点覆盖集"><a href="#最小权点覆盖集" class="headerlink" title="最小权点覆盖集"></a>最小权点覆盖集</h3><p>点覆盖集 $A$ 是一个集合，满足图上所有边的至少一个端点都在集合内，所有点覆盖集中，总点权值最小的集合就是<strong>最小权点覆盖集</strong>。</p><p>求解是一个 NP 完全问题。即没有多项式时间复杂度的做法，有且仅有枚举暴力的实现。但在一个二分图里，有一种特殊的最小权点覆盖集。</p><h3 id="最大权独立集"><a href="#最大权独立集" class="headerlink" title="最大权独立集"></a>最大权独立集</h3><p>对于一般的最大权独立集而言，指的是：</p><p>在一个图 $G$ 中选取一个点集 $A$ ，使 $A$ 中任意两点不相连，其中 $|A|$ 最大的集合称为 $G$ 的<strong>最大权独立集</strong>。</p><hr><h2 id="网络最大流解决二分匹配问题"><a href="#网络最大流解决二分匹配问题" class="headerlink" title="网络最大流解决二分匹配问题"></a>网络最大流解决二分匹配问题</h2><h3 id="二分图匹配"><a href="#二分图匹配" class="headerlink" title="二分图匹配"></a>二分图匹配</h3><p>另作讲解。</p><h3 id="二分图最大匹配（匈牙利算法）"><a href="#二分图最大匹配（匈牙利算法）" class="headerlink" title="二分图最大匹配（匈牙利算法）"></a>二分图最大匹配（匈牙利算法）</h3><p>之后的二分图再另做讲解。</p><h3 id="二分图最大匹配（网络流算法）"><a href="#二分图最大匹配（网络流算法）" class="headerlink" title="二分图最大匹配（网络流算法）"></a>二分图最大匹配（网络流算法）</h3><p>构造网络流模型：</p><ol><li>建立一个超级源点 $S$ 与 $n$ 中所有结点链接一条容量为 $1$ 的边，表示一个结点只能被用 $1$ 次；</li><li>建立一个超级汇点 $T$ 与 $m$ 中所有结点链接一条容量为 $1$ 的边，表示一个结点只能匹配 $1$ 次。</li><li>对于原图，链接 $n$ 中的 $u$ 与 $m$ 中的 $v$ ，容量为 $1$ 。</li></ol><p>求出该图的最大流即是该二分图的最大匹配。</p><details>    <summary>AC Code</summary><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;ctime&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iomanip&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stack&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;map&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> gh() getchar()</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> re register</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> ll;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXP=<span class="number">2001</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXE=<span class="number">1e5</span>+<span class="number">1</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> INF=<span class="number">0x7f7f7f7f</span>;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    x=<span class="number">0</span>;</span><br><span class="line">    <span class="type">char</span> ch=<span class="built_in">gh</span>(),t=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(ch&lt;<span class="string">&#x27;0&#x27;</span>||ch&gt;<span class="string">&#x27;9&#x27;</span>) t|=ch==<span class="string">&#x27;-&#x27;</span>,ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">while</span>(ch&gt;=<span class="string">&#x27;0&#x27;</span>&amp;&amp;ch&lt;=<span class="string">&#x27;9&#x27;</span>) x=(x&lt;&lt;<span class="number">3</span>)+(x&lt;&lt;<span class="number">1</span>)+(ch^<span class="number">48</span>),ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">if</span>(t) x=-x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T,<span class="keyword">class</span> ...T1&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x,T1 &amp;...x1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">read</span>(x),<span class="built_in">read</span>(x1...);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">checkMax</span><span class="params">(T &amp;x,T &amp;y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x&lt;y?x=y,<span class="number">1</span>:<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">checkMin</span><span class="params">(T &amp;x,T &amp;y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x&gt;y?x=y,<span class="number">1</span>:<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> N,M,E,S,T;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">G</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> next,to,val;</span><br><span class="line">    <span class="built_in">G</span>(<span class="type">int</span> n=<span class="number">0</span>,<span class="type">int</span> t=<span class="number">0</span>,<span class="type">int</span> v=<span class="number">0</span>):<span class="built_in">next</span>(n),<span class="built_in">to</span>(t),<span class="built_in">val</span>(v)&#123;&#125;</span><br><span class="line">&#125;Edge[MAXE&lt;&lt;<span class="number">1</span>];</span><br><span class="line"><span class="type">int</span> Head[MAXP],Cur[MAXP],Total=<span class="number">1</span>;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">addEdge</span><span class="params">(<span class="type">int</span> u,<span class="type">int</span> v,<span class="type">int</span> w)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Edge[++Total]=<span class="built_in">G</span>(Head[u],v,w);Head[u]=Total;</span><br><span class="line">    Edge[++Total]=<span class="built_in">G</span>(Head[v],u,<span class="number">0</span>);Head[v]=Total;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> Fl[MAXP];</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">Bfs</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">memset</span>(Fl,<span class="number">-1</span>,<span class="built_in">sizeof</span>(Fl));</span><br><span class="line">    Fl[S]=<span class="number">0</span>,Cur[S]=Head[S];</span><br><span class="line">    queue&lt;<span class="type">int</span>&gt;Q;</span><br><span class="line">    Q.<span class="built_in">push</span>(S);</span><br><span class="line">    <span class="keyword">while</span>(!Q.<span class="built_in">empty</span>())</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> u=Q.<span class="built_in">front</span>();Q.<span class="built_in">pop</span>();</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> e=Head[u],v;e;e=Edge[e].next)</span><br><span class="line">        &#123;</span><br><span class="line">            v=Edge[e].to;</span><br><span class="line">            <span class="keyword">if</span>(Fl[v]==<span class="number">-1</span>&amp;&amp;Edge[e].val)</span><br><span class="line">            &#123;</span><br><span class="line">                Fl[v]=Fl[u]+<span class="number">1</span>;</span><br><span class="line">                Cur[v]=Head[v];</span><br><span class="line">                <span class="keyword">if</span>(v==T) <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">                Q.<span class="built_in">push</span>(v);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">Dfs</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> inf)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(x==T) <span class="keyword">return</span> inf;</span><br><span class="line">    <span class="type">int</span> flow=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> e=Cur[x],v;e&amp;&amp;flow&lt;inf;e=Edge[e].next)</span><br><span class="line">    &#123;</span><br><span class="line">        Cur[x]=e;</span><br><span class="line">        v=Edge[e].to;</span><br><span class="line">        <span class="keyword">if</span>(Fl[v]==Fl[x]+<span class="number">1</span>&amp;&amp;Edge[e].val)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="type">int</span> k=<span class="built_in">Dfs</span>(v,<span class="built_in">min</span>(Edge[e].val,inf-flow));</span><br><span class="line">            <span class="keyword">if</span>(!k) Fl[v]=<span class="number">-1</span>;</span><br><span class="line">            Edge[e].val-=k,Edge[e^<span class="number">1</span>].val+=k,flow+=k;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> flow;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">Dinic</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> r=<span class="number">0</span>,flow;</span><br><span class="line">    <span class="keyword">while</span>(<span class="built_in">Bfs</span>()) <span class="keyword">while</span>(flow=<span class="built_in">Dfs</span>(S,INF)) r+=flow;</span><br><span class="line">    <span class="keyword">return</span> r;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// freopen(&quot;Dinic.in&quot;,&quot;r&quot;,stdin);</span></span><br><span class="line">    <span class="comment">// freopen(&quot;Dinic.out&quot;,&quot;w&quot;,stdout);</span></span><br><span class="line">    <span class="built_in">read</span>(N,M,E);</span><br><span class="line">    S=<span class="number">0</span>,T=N+M+<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>,u,v;i&lt;=E;++i)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">read</span>(u,v);</span><br><span class="line">        <span class="built_in">addEdge</span>(u,M+v,<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=N;++i) <span class="built_in">addEdge</span>(S,i,<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=M;++i) <span class="built_in">addEdge</span>(i+M,T,<span class="number">1</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d&quot;</span>,<span class="built_in">Dinic</span>());</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">4 2 7</span></span><br><span class="line"><span class="comment">3 1</span></span><br><span class="line"><span class="comment">1 2</span></span><br><span class="line"><span class="comment">3 2</span></span><br><span class="line"><span class="comment">1 1</span></span><br><span class="line"><span class="comment">4 2</span></span><br><span class="line"><span class="comment">4 1</span></span><br><span class="line"><span class="comment">1 1</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure></details><hr><h3 id="网络流解决二分匹配"><a href="#网络流解决二分匹配" class="headerlink" title="网络流解决二分匹配"></a>网络流解决二分匹配</h3><p>以<a href="https://www.luogu.com.cn/problem/P2756">飞行员配对方案问题</a>为例，最重要的是建出网络模型，然后照板子跑就好了。建出一个 $S$ 源点和一个 $T$ 汇点，然后链接 $S$ 和所有外籍飞行员，链接 $T$ 和所有英国飞行员，然后将所有能够匹配的外籍飞行员和英国飞行员链接，容量皆为 $1$ 。最后检验一些建构出的网络的可行流和原问题的可行方案是否对应，如果是，说明建图成功，跑模板。</p><details>    <summary>AC Code</summary><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;ctime&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iomanip&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stack&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;map&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> gh() getchar()</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> re register</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> db double</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> ll;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN=<span class="number">101</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> INF=<span class="number">0x7f7f7f7f</span>;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    x=<span class="number">0</span>;</span><br><span class="line">    <span class="type">char</span> ch=<span class="built_in">gh</span>(),t=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(ch&lt;<span class="string">&#x27;0&#x27;</span>||ch&gt;<span class="string">&#x27;9&#x27;</span>) t|=ch==<span class="string">&#x27;-&#x27;</span>,ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">while</span>(ch&gt;=<span class="string">&#x27;0&#x27;</span>&amp;&amp;ch&lt;=<span class="string">&#x27;9&#x27;</span>) x=(x&lt;&lt;<span class="number">3</span>)+(x&lt;&lt;<span class="number">1</span>)+(ch^<span class="number">48</span>),ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">if</span>(t) x=-x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T,<span class="keyword">class</span> ...T1&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x,T1 &amp;...x1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">read</span>(x),<span class="built_in">read</span>(x1...);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">checkMax</span><span class="params">(T &amp;x,T &amp;y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x&lt;y?x=y,<span class="number">1</span>:<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">checkMin</span><span class="params">(T &amp;x,T &amp;y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x&gt;y?x=y,<span class="number">1</span>:<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> N,M,S,T;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Graph</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> next,to,val;</span><br><span class="line">    <span class="built_in">Graph</span>(<span class="type">int</span> n=<span class="number">0</span>,<span class="type">int</span> t=<span class="number">0</span>,<span class="type">int</span> v=<span class="number">0</span>):<span class="built_in">next</span>(n),<span class="built_in">to</span>(t),<span class="built_in">val</span>(v)&#123;&#125;</span><br><span class="line">&#125;Edge[MAXN*MAXN];</span><br><span class="line"><span class="type">int</span> Head[MAXN],Total=<span class="number">1</span>,newTail[MAXN],Fl[MAXN];</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">addEdge</span><span class="params">(<span class="type">int</span> u,<span class="type">int</span> v,<span class="type">int</span> w)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Edge[++Total]=<span class="built_in">Graph</span>(Head[u],v,w);Head[u]=Total;</span><br><span class="line">    Edge[++Total]=<span class="built_in">Graph</span>(Head[v],u,<span class="number">0</span>);Head[v]=Total;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">Bfs</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    queue&lt;<span class="type">int</span>&gt;Q;</span><br><span class="line">    <span class="built_in">memset</span>(Fl,<span class="number">0</span>,<span class="built_in">sizeof</span>(Fl));</span><br><span class="line">    Fl[S]=<span class="number">1</span>;</span><br><span class="line">    Q.<span class="built_in">push</span>(S);</span><br><span class="line">    <span class="keyword">while</span>(!Q.<span class="built_in">empty</span>())</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> u=Q.<span class="built_in">front</span>();Q.<span class="built_in">pop</span>();</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> e=Head[u];e;e=Edge[e].next)</span><br><span class="line">            <span class="keyword">if</span>(!Fl[Edge[e].to]&amp;&amp;Edge[e].val)</span><br><span class="line">            &#123;</span><br><span class="line">                Fl[Edge[e].to]=Fl[u]+<span class="number">1</span>;</span><br><span class="line">                Q.<span class="built_in">push</span>(Edge[e].to);</span><br><span class="line">            &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> Fl[T]!=<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">Dfs</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> inf)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(x==T) <span class="keyword">return</span> inf;</span><br><span class="line">    <span class="type">int</span> s=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> e=newTail[x];e;e=Edge[e].next)</span><br><span class="line">    &#123;</span><br><span class="line">        newTail[x]=e;</span><br><span class="line">        <span class="keyword">if</span>(Fl[Edge[e].to]==Fl[x]+<span class="number">1</span>&amp;&amp;Edge[e].val)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="type">int</span> k=<span class="built_in">Dfs</span>(Edge[e].to,<span class="built_in">min</span>(inf-s,Edge[e].val));</span><br><span class="line">            <span class="keyword">if</span>(k)</span><br><span class="line">            &#123;</span><br><span class="line">                Edge[e].val-=k;</span><br><span class="line">                Edge[e^<span class="number">1</span>].val+=k;</span><br><span class="line">                s+=k;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(s&lt;inf) Fl[x]=<span class="number">-1</span>;</span><br><span class="line">    <span class="keyword">return</span> s;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">Dinic</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> maxFlow=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(<span class="built_in">Bfs</span>())</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;=N+<span class="number">1</span>;++i) newTail[i]=Head[i];</span><br><span class="line">        maxFlow+=<span class="built_in">Dfs</span>(S,INF);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(maxFlow==<span class="number">0</span>) <span class="built_in">printf</span>(<span class="string">&quot;No Solution!&quot;</span>);</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,maxFlow);</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">2</span>;i&lt;=Total;i+=<span class="number">2</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span>(Edge[i].to!=S&amp;&amp;Edge[i^<span class="number">1</span>].to!=S)</span><br><span class="line">                <span class="keyword">if</span>(Edge[i].to!=T&amp;&amp;Edge[i^<span class="number">1</span>].to!=T)</span><br><span class="line">                    <span class="keyword">if</span>(Edge[i^<span class="number">1</span>].val!=<span class="number">0</span>)</span><br><span class="line">                        <span class="built_in">printf</span>(<span class="string">&quot;%d %d\n&quot;</span>,Edge[i^<span class="number">1</span>].to,Edge[i].to);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// freopen(&quot;dinic.in&quot;,&quot;r&quot;,stdin);</span></span><br><span class="line">    <span class="comment">// freopen(&quot;dinic.out&quot;,&quot;w&quot;,stdout);</span></span><br><span class="line">    <span class="built_in">read</span>(M,N);</span><br><span class="line">    <span class="type">int</span> u,v;</span><br><span class="line">    T=N+<span class="number">1</span>;</span><br><span class="line">    <span class="built_in">read</span>(u,v);</span><br><span class="line">    <span class="keyword">while</span>(u!=<span class="number">-1</span>&amp;&amp;v!=<span class="number">-1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">addEdge</span>(u,v,<span class="number">1</span>);</span><br><span class="line">        <span class="built_in">read</span>(u,v);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=M;++i) <span class="built_in">addEdge</span>(S,i,<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=M+<span class="number">1</span>;i&lt;=N;++i) <span class="built_in">addEdge</span>(i,T,<span class="number">1</span>);</span><br><span class="line">    <span class="built_in">Dinic</span>();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">5 10</span></span><br><span class="line"><span class="comment">1 7</span></span><br><span class="line"><span class="comment">1 8</span></span><br><span class="line"><span class="comment">2 6</span></span><br><span class="line"><span class="comment">2 9</span></span><br><span class="line"><span class="comment">2 10</span></span><br><span class="line"><span class="comment">3 7</span></span><br><span class="line"><span class="comment">3 8</span></span><br><span class="line"><span class="comment">4 7</span></span><br><span class="line"><span class="comment">4 8</span></span><br><span class="line"><span class="comment">5 10</span></span><br><span class="line"><span class="comment">-1 -1</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure></details><hr><h3 id="最小割求解最小权点覆盖集"><a href="#最小割求解最小权点覆盖集" class="headerlink" title="最小割求解最小权点覆盖集"></a>最小割求解最小权点覆盖集</h3><p>有性质：</p><blockquote><p>在二分图中，有一个特殊的性质：当所有点权都是 $1$ 时，有最大匹配数等于最小权点覆盖集；最大权独立集等于点数减去最小权点覆盖集。</p></blockquote><p>在二分图中，最小权点覆盖集解决了这一类问题：</p><p>在二分图中，对于每条边，两个端点至少选一个，求所选取的点的最小权值和。</p><p>对应方法：</p><ol><li>二分图染色，使每一条边的端点颜色不同；</li><li>建立超级源点 $S$ 与所有颜色为 $a$ 的边链接一条容量为该点权值的边；</li><li>建立超级汇点 $T$ 与所有颜色为 $b$ 的边链接一条容量为该点权值的边。</li><li>对于二分图中原有的边，改为从 $u$ 到 $v$ 的容量为 $inf$ 的边。</li></ol><p>求取构造网络的最大流（最小割），结果则是最小点权和。 （这个结论我暂时还没有理解，但是挺好背，所以先背比较好）</p><h3 id="最小割求解最大点权独立集"><a href="#最小割求解最大点权独立集" class="headerlink" title="最小割求解最大点权独立集"></a>最小割求解最大点权独立集</h3><p>因为有：</p><blockquote><p>最大权独立集等于所有点的总权值减去最小权点覆盖。</p></blockquote><p>所以这两个问题其实是相通的，只是输出的答案略微不同罢了。</p><p><a href="https://www.luogu.com.cn/problem/P2774">最大点权独立集模板题</a>的<a href="https://www.luogu.com.cn/problem/P4474">双倍经验</a>。</p><p>因为不能够选相邻的点，则我们将所有点分为两类使每一类不存在相邻。</p><p>建图：</p><ol><li>对于所有 $a$ 类点，链接 $(S,a,pt[a])$ ；</li><li>对于所有 $b$ 类点，链接 $(b,T,pt[b])$ ；</li><li>对于相邻的点 $u,v$ ，链接 $(u,v,inf)$ 。</li></ol><p>如上述方法一致。</p><details>    <summary>AC Code</summary><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;ctime&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iomanip&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stack&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;map&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> gh() getchar()</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> re register</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> ll;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN=<span class="number">101</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXP=<span class="number">2e4</span>+<span class="number">1</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXE=<span class="number">2e6</span>+<span class="number">1</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> INF=<span class="number">0x3f3f3f3f</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> Dx[]=&#123;<span class="number">0</span>,<span class="number">1</span>,<span class="number">-1</span>,<span class="number">0</span>,<span class="number">0</span>&#125;;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> Dy[]=&#123;<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">-1</span>,<span class="number">1</span>&#125;;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    x=<span class="number">0</span>;</span><br><span class="line">    <span class="type">char</span> ch=<span class="built_in">gh</span>(),t=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(ch&lt;<span class="string">&#x27;0&#x27;</span>||ch&gt;<span class="string">&#x27;9&#x27;</span>) t|=ch==<span class="string">&#x27;-&#x27;</span>,ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">while</span>(ch&gt;=<span class="string">&#x27;0&#x27;</span>&amp;&amp;ch&lt;=<span class="string">&#x27;9&#x27;</span>) x=(x&lt;&lt;<span class="number">3</span>)+(x&lt;&lt;<span class="number">1</span>)+(ch^<span class="number">48</span>),ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">if</span>(t) x=-x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T,<span class="keyword">class</span> ...T1&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x,T1 &amp;...x1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">read</span>(x),<span class="built_in">read</span>(x1...);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">checkMax</span><span class="params">(T &amp;x,T &amp;y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x&lt;y?x=y,<span class="number">1</span>:<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">checkMin</span><span class="params">(T &amp;x,T &amp;y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x&gt;y?x=y,<span class="number">1</span>:<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> N,M,S,T;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">G</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> next,to,val;</span><br><span class="line">    <span class="built_in">G</span>(<span class="type">int</span> n=<span class="number">0</span>,<span class="type">int</span> t=<span class="number">0</span>,<span class="type">int</span> v=<span class="number">0</span>):<span class="built_in">next</span>(n),<span class="built_in">to</span>(t),<span class="built_in">val</span>(v)&#123;&#125;</span><br><span class="line">&#125;Edge[MAXE&lt;&lt;<span class="number">1</span>];</span><br><span class="line"><span class="type">int</span> Head[MAXP],Cur[MAXP],Total=<span class="number">1</span>;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">addEdge</span><span class="params">(<span class="type">int</span> u,<span class="type">int</span> v,<span class="type">int</span> w)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Edge[++Total]=<span class="built_in">G</span>(Head[u],v,w);Head[u]=Total;</span><br><span class="line">    Edge[++Total]=<span class="built_in">G</span>(Head[v],u,<span class="number">0</span>);Head[v]=Total;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> Fl[MAXP];</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">Bfs</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">memset</span>(Fl,<span class="number">-1</span>,<span class="built_in">sizeof</span>(Fl));</span><br><span class="line">    Fl[S]=<span class="number">0</span>,Cur[S]=Head[S];</span><br><span class="line">    queue&lt;<span class="type">int</span>&gt;Q;</span><br><span class="line">    Q.<span class="built_in">push</span>(S);</span><br><span class="line">    <span class="keyword">while</span>(!Q.<span class="built_in">empty</span>())</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> u=Q.<span class="built_in">front</span>();Q.<span class="built_in">pop</span>();</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> e=Head[u];e;e=Edge[e].next)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="type">int</span> v=Edge[e].to;</span><br><span class="line">            <span class="keyword">if</span>(Fl[v]==<span class="number">-1</span>&amp;&amp;Edge[e].val)</span><br><span class="line">            &#123;</span><br><span class="line">                Fl[v]=Fl[u]+<span class="number">1</span>;Cur[v]=Head[v];</span><br><span class="line">                <span class="keyword">if</span>(v==T) <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">                Q.<span class="built_in">push</span>(v);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">Dfs</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> inf)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(x==T) <span class="keyword">return</span> inf;</span><br><span class="line">    <span class="type">int</span> flow=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> e=Cur[x];e&amp;&amp;flow&lt;inf;e=Edge[e].next)</span><br><span class="line">    &#123;</span><br><span class="line">        Cur[x]=e;</span><br><span class="line">        <span class="type">int</span> v=Edge[e].to;</span><br><span class="line">        <span class="keyword">if</span>(Fl[v]==Fl[x]+<span class="number">1</span>&amp;&amp;Edge[e].val)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="type">int</span> k=<span class="built_in">Dfs</span>(v,<span class="built_in">min</span>(Edge[e].val,inf-flow));</span><br><span class="line">            <span class="keyword">if</span>(!k) Fl[v]=<span class="number">-1</span>;</span><br><span class="line">            Edge[e].val-=k,Edge[e^<span class="number">1</span>].val+=k,flow+=k;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> flow;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">Dinic</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> r=<span class="number">0</span>,flow;</span><br><span class="line">    <span class="keyword">while</span>(<span class="built_in">Bfs</span>()) <span class="keyword">while</span>(flow=<span class="built_in">Dfs</span>(S,INF)) r+=flow;</span><br><span class="line">    <span class="keyword">return</span> r;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">bool</span> Color[MAXN][MAXN];</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// freopen(&quot;netflow.in&quot;,&quot;r&quot;,stdin);</span></span><br><span class="line">    <span class="comment">// freopen(&quot;netflow.out&quot;,&quot;w&quot;,stdout);</span></span><br><span class="line">    <span class="built_in">read</span>(N,M);</span><br><span class="line">    S=<span class="number">0</span>,T=N*M+<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=N;++i)</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">1</span>;j&lt;=M;++j)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span>(((i&amp;<span class="number">1</span>)&amp;&amp;(j&amp;<span class="number">1</span>))||((!(i&amp;<span class="number">1</span>))&amp;&amp;(!(j&amp;<span class="number">1</span>))))</span><br><span class="line">                Color[i][j]=<span class="number">1</span>;</span><br><span class="line">            <span class="keyword">else</span> Color[i][j]=<span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    <span class="comment">/*for(int i=1;i&lt;=N;++i)&#123;</span></span><br><span class="line"><span class="comment">        for(int j=1;j&lt;=M;++j) cout&lt;&lt;Color[i][j]&lt;&lt;&quot; &quot;;</span></span><br><span class="line"><span class="comment">        puts(&quot;&quot;);</span></span><br><span class="line"><span class="comment">    &#125;*/</span></span><br><span class="line">    ll Cnt=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=N;++i)</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">1</span>,x;j&lt;=M;++j)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">read</span>(x);</span><br><span class="line">            Cnt+=x;</span><br><span class="line">            <span class="keyword">if</span>(Color[i][j]) <span class="built_in">addEdge</span>(M*(i<span class="number">-1</span>)+j,T,x);</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">            &#123;</span><br><span class="line">                <span class="built_in">addEdge</span>(S,M*(i<span class="number">-1</span>)+j,x);</span><br><span class="line">                <span class="keyword">for</span>(<span class="type">int</span> k=<span class="number">1</span>;k&lt;=<span class="number">4</span>;++k)</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="type">int</span> Nx=i+Dx[k],Ny=j+Dy[k];</span><br><span class="line">                    <span class="keyword">if</span>(Nx&lt;<span class="number">1</span>||Ny&lt;<span class="number">1</span>||Nx&gt;N||Ny&gt;M) <span class="keyword">continue</span>;</span><br><span class="line">                    <span class="built_in">addEdge</span>(M*(i<span class="number">-1</span>)+j,M*(Nx<span class="number">-1</span>)+Ny,INF);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d&quot;</span>,Cnt-<span class="built_in">Dinic</span>());</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">3 3</span></span><br><span class="line"><span class="comment">1 2 3</span></span><br><span class="line"><span class="comment">3 2 3</span></span><br><span class="line"><span class="comment">2 3 1 </span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure></details><hr><h2 id="上下界网络流"><a href="#上下界网络流" class="headerlink" title="上下界网络流"></a>上下界网络流</h2><p>字面意思，对于每一条边的可行流，存在最小流 $min(c(u,v))$ 和最大流 $max(c(u,v))$ ，该边在满足最大流的所有性质的前提下，必须满足 $min(c(u,v))\le f(c(u,v))\le max(c(u,v))$ 。这是上下界可行流。</p><p>上下界流分为<strong>有源汇</strong>和<strong>无源汇</strong>两种情况。</p><hr><h3 id="无源汇上下界可行流"><a href="#无源汇上下界可行流" class="headerlink" title="无源汇上下界可行流"></a>无源汇上下界可行流</h3><p><del>我居然先理解的是有源汇</del>。</p><p>所谓可行流，就是满足容量限制，流守恒性，斜对称性的流。而对于拥有上下界的网络，其限制严格许多。</p><p>首先，下界必须流满，所以我们可以在建边时直接将容量建为 $upper(x)-lower(x)$ ，但是又考虑到每条边的下界并不一定相等，所以，我们需要额外找出位置来平衡流量：</p><p><strong>建立虚拟源点和虚拟汇点。</strong></p><p>令虚拟源点为 $vS$ ，虚拟汇点为 $vT$ ，对于点 $x$ 流入的流量为 $in_x$ ，流出的流量为 $out_x$ 。出入的流量差记为 $dif[x],dif[x]=in_x-out_x$ 。则有：</p><ol><li>$in_x&gt;out_x$ ，多流入了流量由 $vS$ 补足，连边 $(vS,x,dif[x])$ 。</li><li>$in_x=out_x$ ，流量平衡，不连边（连出来也是一条容量为 $0$ 的边）。</li><li>$in_x&lt;out_x$ ，多流出的流量流入 $vT$ ，连边 $(x,vT,-dif[x])$ 。</li></ol><p>这样其实就变成了一个常规的有源汇网络，然后跑最大流即可（毕竟最大流也是一种特殊的可行流）。如果跑得出来，那么除了 $vS$ 和 $vT$ 之外的所有点的容量应当是守恒的，则说明原图存在可行流。</p><p><a href="https://loj.ac/p/115">模板无源汇上下界可行流</a></p><details>    <summary>AC Code</summary><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;ctime&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iomanip&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stack&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;map&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> gh() getchar()</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> re register</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> db double</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> ll;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN=<span class="number">501</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXM=<span class="number">2e5</span>+<span class="number">1</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> INF=<span class="number">0x7f7f7f7f</span>;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    x=<span class="number">0</span>;</span><br><span class="line">    <span class="type">char</span> ch=<span class="built_in">gh</span>(),t=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(ch&lt;<span class="string">&#x27;0&#x27;</span>||ch&gt;<span class="string">&#x27;9&#x27;</span>) t|=ch==<span class="string">&#x27;-&#x27;</span>,ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">while</span>(ch&gt;=<span class="string">&#x27;0&#x27;</span>&amp;&amp;ch&lt;=<span class="string">&#x27;9&#x27;</span>) x=(x&lt;&lt;<span class="number">3</span>)+(x&lt;&lt;<span class="number">1</span>)+(ch^<span class="number">48</span>),ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">if</span>(t) x=-x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T,<span class="keyword">class</span> ...T1&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x,T1 &amp;...x1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">read</span>(x),<span class="built_in">read</span>(x1...);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">checkMax</span><span class="params">(T &amp;x,T &amp;y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x&lt;y?x=y,<span class="number">1</span>:<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">checkMin</span><span class="params">(T &amp;x,T &amp;y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x&gt;y?x=y,<span class="number">1</span>:<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> N,M,vS,vT;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Graph</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> next,to,val;</span><br><span class="line">    <span class="built_in">Graph</span>(<span class="type">int</span> n=<span class="number">0</span>,<span class="type">int</span> t=<span class="number">0</span>,<span class="type">int</span> v=<span class="number">0</span>):<span class="built_in">next</span>(n),<span class="built_in">to</span>(t),<span class="built_in">val</span>(v)&#123;&#125;</span><br><span class="line">&#125;Edge[MAXM&lt;&lt;<span class="number">1</span>];</span><br><span class="line"><span class="type">int</span> Head[MAXN],Cur[MAXN],Lo[MAXM&lt;&lt;<span class="number">1</span>],Total=<span class="number">1</span>;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">addEdge</span><span class="params">(<span class="type">int</span> u,<span class="type">int</span> v,<span class="type">int</span> lo,<span class="type">int</span> up)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Edge[++Total]=<span class="built_in">Graph</span>(Head[u],v,up-lo);Lo[Total]=lo;Head[u]=Total;</span><br><span class="line">    Edge[++Total]=<span class="built_in">Graph</span>(Head[v],u,<span class="number">0</span>);Head[v]=Total;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> Fl[MAXN],Dif[MAXN];</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">Bfs</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">memset</span>(Fl,<span class="number">-1</span>,<span class="built_in">sizeof</span>(Fl));</span><br><span class="line">    Fl[vS]=<span class="number">0</span>,Cur[vS]=Head[vS];</span><br><span class="line">    queue&lt;<span class="type">int</span>&gt;Q;</span><br><span class="line">    Q.<span class="built_in">push</span>(vS);</span><br><span class="line">    <span class="keyword">while</span>(!Q.<span class="built_in">empty</span>())</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> u=Q.<span class="built_in">front</span>();Q.<span class="built_in">pop</span>();</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> e=Head[u];e;e=Edge[e].next)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="type">int</span> v=Edge[e].to;</span><br><span class="line">            <span class="keyword">if</span>(Fl[v]==<span class="number">-1</span>&amp;&amp;Edge[e].val)</span><br><span class="line">            &#123;</span><br><span class="line">                Fl[v]=Fl[u]+<span class="number">1</span>;</span><br><span class="line">                Cur[v]=Head[v];</span><br><span class="line">                <span class="keyword">if</span>(v==vT) <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">                Q.<span class="built_in">push</span>(v);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">Dfs</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> inf)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(x==vT) <span class="keyword">return</span> inf;</span><br><span class="line">    <span class="type">int</span> flow=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> e=Cur[x];e&amp;&amp;flow&lt;inf;e=Edge[e].next)</span><br><span class="line">    &#123;</span><br><span class="line">        Cur[x]=e;</span><br><span class="line">        <span class="type">int</span> v=Edge[e].to;</span><br><span class="line">        <span class="keyword">if</span>(Fl[v]==Fl[x]+<span class="number">1</span>&amp;&amp;Edge[e].val)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="type">int</span> k=<span class="built_in">Dfs</span>(v,<span class="built_in">min</span>(Edge[e].val,inf-flow));</span><br><span class="line">            <span class="keyword">if</span>(!k) Fl[v]=<span class="number">-1</span>;</span><br><span class="line">            Edge[e].val-=k,Edge[e^<span class="number">1</span>].val+=k,flow+=k;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> flow;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">Dinic</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> r=<span class="number">0</span>,flow;</span><br><span class="line">    <span class="keyword">while</span>(<span class="built_in">Bfs</span>()) <span class="keyword">while</span>(flow=<span class="built_in">Dfs</span>(vS,INF)) r+=flow;</span><br><span class="line">    <span class="keyword">return</span> r;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// freopen(&quot;unset-flow.in&quot;,&quot;r&quot;,stdin);</span></span><br><span class="line">    <span class="comment">// freopen(&quot;unset-flow.out&quot;,&quot;w&quot;,stdout);</span></span><br><span class="line">    <span class="built_in">read</span>(N,M);</span><br><span class="line">    vS=<span class="number">0</span>,vT=N+<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>,u,v,lo,up;i&lt;=M;++i)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">read</span>(u,v,lo,up);</span><br><span class="line">        <span class="built_in">addEdge</span>(u,v,lo,up);</span><br><span class="line">        Dif[u]-=lo,Dif[v]+=lo;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> Tot=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=N;++i)</span><br><span class="line">        <span class="keyword">if</span>(Dif[i]&gt;<span class="number">0</span>) <span class="built_in">addEdge</span>(vS,i,<span class="number">0</span>,Dif[i]),Tot+=Dif[i];</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(Dif[i]&lt;<span class="number">0</span>) <span class="built_in">addEdge</span>(i,vT,<span class="number">0</span>,-Dif[i]);</span><br><span class="line">    <span class="keyword">if</span>(<span class="built_in">Dinic</span>()!=Tot) <span class="built_in">printf</span>(<span class="string">&quot;NO&quot;</span>);</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">&quot;YES&quot;</span>);</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> e=<span class="number">2</span>;e&lt;=M*<span class="number">2</span>;e+=<span class="number">2</span>)</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,Edge[e^<span class="number">1</span>].val+Lo[e]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// for(int e=1;e&lt;=M*2;++e) printf(&quot;%d &quot;,Lo[e]);</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">4 6</span></span><br><span class="line"><span class="comment">1 2 1 3</span></span><br><span class="line"><span class="comment">2 3 1 3</span></span><br><span class="line"><span class="comment">3 4 1 3</span></span><br><span class="line"><span class="comment">4 1 1 3</span></span><br><span class="line"><span class="comment">1 3 1 3</span></span><br><span class="line"><span class="comment">4 2 1 3</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure></details><hr><h3 id="有源汇上下界可行流"><a href="#有源汇上下界可行流" class="headerlink" title="有源汇上下界可行流"></a>有源汇上下界可行流</h3><p>有给定的源点和汇点，求该网络的可行流。</p><p>凡事讲究一个推进，所以我们选择将有源汇的问题转化为无源汇的问题。首先，对于有源汇的问题而言，其与无源汇问题最大的不同就在于其 $S$ 源点的流量与 $T$ 汇点的流量一定不同。那么，我们就需要使其相同：</p><p>连接一条从 $T$ 到 $S$ 上界为 $inf$ 下界为 $0$ 的边。这样就会使流量守恒定律一样满足于源汇点了。</p><h3 id="有源汇上下界最小-最大流"><a href="#有源汇上下界最小-最大流" class="headerlink" title="有源汇上下界最小/最大流"></a>有源汇上下界最小/最大流</h3><h4 id="最大流-1"><a href="#最大流-1" class="headerlink" title="最大流"></a>最大流</h4><p>首先跑出一条可行流，对于虚拟源点 $vS$ 到虚拟汇点 $vT$ 的边已经流满，但是通过定义：最大流 $=$ 可行流 $+$ 向上浮动的流量。所以我们要在残余网络中尽量跑满上限。</p><p>而我们需要在原图的源汇路径上重找增广路，可以得到结论是向上浮动的流量就是真实源点 $S$ 到真实汇点 $T$ 的最大流。</p><p><strong>注意：跑最后一次最大流时需要把边 $(T,S,inf)$ 删掉</strong>。</p><p><a href="https://loj.ac/p/116">模板有源汇上下界最大流</a></p><details>    <summary>AC Code</summary><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;ctime&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iomanip&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stack&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;map&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> gh() getchar()</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> re register</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> db double</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> ll;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN=<span class="number">501</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXM=<span class="number">2e4</span>+<span class="number">1</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> INF=<span class="number">0x7f7f7f7f</span>;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    x=<span class="number">0</span>;</span><br><span class="line">    <span class="type">char</span> ch=<span class="built_in">gh</span>(),t=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(ch&lt;<span class="string">&#x27;0&#x27;</span>||ch&gt;<span class="string">&#x27;9&#x27;</span>) t|=ch==<span class="string">&#x27;-&#x27;</span>,ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">while</span>(ch&gt;=<span class="string">&#x27;0&#x27;</span>&amp;&amp;ch&lt;=<span class="string">&#x27;9&#x27;</span>) x=(x&lt;&lt;<span class="number">3</span>)+(x&lt;&lt;<span class="number">1</span>)+(ch^<span class="number">48</span>),ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">if</span>(t) x=-x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T,<span class="keyword">class</span> ...T1&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x,T1 &amp;...x1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">read</span>(x),<span class="built_in">read</span>(x1...);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">checkMax</span><span class="params">(T &amp;x,T &amp;y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x&lt;y?x=y,<span class="number">1</span>:<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">checkMin</span><span class="params">(T &amp;x,T &amp;y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x&gt;y?x=y,<span class="number">1</span>:<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> N,M,S,T,Sv,Tv;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Graph</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> next,to,val;</span><br><span class="line">    <span class="built_in">Graph</span>(<span class="type">int</span> n=<span class="number">0</span>,<span class="type">int</span> t=<span class="number">0</span>,<span class="type">int</span> v=<span class="number">0</span>):<span class="built_in">next</span>(n),<span class="built_in">to</span>(t),<span class="built_in">val</span>(v)&#123;&#125;</span><br><span class="line">&#125;Edge[MAXM&lt;&lt;<span class="number">1</span>];</span><br><span class="line"><span class="type">int</span> Head[MAXN],Cur[MAXN],Total=<span class="number">1</span>;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">addEdge</span><span class="params">(<span class="type">int</span> u,<span class="type">int</span> v,<span class="type">int</span> w)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Edge[++Total]=<span class="built_in">Graph</span>(Head[u],v,w);Head[u]=Total;</span><br><span class="line">    Edge[++Total]=<span class="built_in">Graph</span>(Head[v],u,<span class="number">0</span>);Head[v]=Total;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> A[MAXN],Fl[MAXN];</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">Bfs</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">memset</span>(Fl,<span class="number">-1</span>,<span class="built_in">sizeof</span>(Fl));</span><br><span class="line">    Fl[Sv]=<span class="number">0</span>,Cur[Sv]=Head[Sv];</span><br><span class="line">    queue&lt;<span class="type">int</span>&gt;Q;</span><br><span class="line">    Q.<span class="built_in">push</span>(Sv);</span><br><span class="line">    <span class="keyword">while</span>(!Q.<span class="built_in">empty</span>())</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> x=Q.<span class="built_in">front</span>();Q.<span class="built_in">pop</span>();</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> e=Head[x];e;e=Edge[e].next)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="type">int</span> v=Edge[e].to;</span><br><span class="line">            <span class="keyword">if</span>(Fl[v]==<span class="number">-1</span>&amp;&amp;Edge[e].val)</span><br><span class="line">            &#123;</span><br><span class="line">                Fl[v]=Fl[x]+<span class="number">1</span>;</span><br><span class="line">                Cur[v]=Head[v];</span><br><span class="line">                <span class="keyword">if</span>(v==Tv) <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">                Q.<span class="built_in">push</span>(v);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">Dfs</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> inf)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(x==Tv) <span class="keyword">return</span> inf;</span><br><span class="line">    <span class="type">int</span> flow=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> e=Cur[x];e&amp;&amp;flow&lt;inf;e=Edge[e].next)</span><br><span class="line">    &#123;</span><br><span class="line">        Cur[x]=e;</span><br><span class="line">        <span class="type">int</span> v=Edge[e].to;</span><br><span class="line">        <span class="keyword">if</span>(Fl[v]==Fl[x]+<span class="number">1</span>&amp;&amp;Edge[e].val)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="type">int</span> k=<span class="built_in">Dfs</span>(v,<span class="built_in">min</span>(Edge[e].val,inf-flow));</span><br><span class="line">            <span class="keyword">if</span>(!k) Fl[v]=<span class="number">-1</span>;</span><br><span class="line">            Edge[e].val-=k,Edge[e^<span class="number">1</span>].val+=k,flow+=k;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> flow;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">Dinic</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> r=<span class="number">0</span>,flow;</span><br><span class="line">    <span class="keyword">while</span>(<span class="built_in">Bfs</span>()) <span class="keyword">while</span>(flow=<span class="built_in">Dfs</span>(Sv,INF)) r+=flow;</span><br><span class="line">    <span class="keyword">return</span> r;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// freopen(&quot;maxflow.in&quot;,&quot;r&quot;,stdin);</span></span><br><span class="line">    <span class="comment">// freopen(&quot;maxflow.out&quot;,&quot;w&quot;,stdout);</span></span><br><span class="line">    <span class="built_in">read</span>(N,M,S,T);</span><br><span class="line">    Sv=<span class="number">0</span>,Tv=N+<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>,u,v,w,c;i&lt;=M;++i)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">read</span>(u,v,w,c);</span><br><span class="line">        <span class="built_in">addEdge</span>(u,v,c-w);</span><br><span class="line">        A[u]-=w,A[v]+=w;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> Tot=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=N;++i)</span><br><span class="line">        <span class="keyword">if</span>(A[i]&gt;<span class="number">0</span>) <span class="built_in">addEdge</span>(Sv,i,A[i]),Tot+=A[i];</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(A[i]&lt;<span class="number">0</span>) <span class="built_in">addEdge</span>(i,Tv,-A[i]);</span><br><span class="line">    <span class="built_in">addEdge</span>(T,S,INF);</span><br><span class="line">    <span class="keyword">if</span>(<span class="built_in">Dinic</span>()&lt;Tot) <span class="built_in">puts</span>(<span class="string">&quot;please go home to sleep&quot;</span>);</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> res=Edge[Total].val;</span><br><span class="line">        Sv=S,Tv=T;</span><br><span class="line">        Edge[Total].val=Edge[Total<span class="number">-1</span>].val=<span class="number">0</span>;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,res+<span class="built_in">Dinic</span>());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">10 15 9 10</span></span><br><span class="line"><span class="comment">9 1 17 18</span></span><br><span class="line"><span class="comment">9 2 12 13</span></span><br><span class="line"><span class="comment">9 3 11 12</span></span><br><span class="line"><span class="comment">1 5 3 4</span></span><br><span class="line"><span class="comment">1 6 6 7</span></span><br><span class="line"><span class="comment">1 7 7 8</span></span><br><span class="line"><span class="comment">2 5 9 10</span></span><br><span class="line"><span class="comment">2 6 2 3</span></span><br><span class="line"><span class="comment">2 7 0 1</span></span><br><span class="line"><span class="comment">3 5 3 4</span></span><br><span class="line"><span class="comment">3 6 1 2</span></span><br><span class="line"><span class="comment">3 7 6 7</span></span><br><span class="line"><span class="comment">5 10 16 17</span></span><br><span class="line"><span class="comment">6 10 10 11</span></span><br><span class="line"><span class="comment">7 10 14 15</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure></details><hr><h4 id="最小流"><a href="#最小流" class="headerlink" title="最小流"></a>最小流</h4><p>从代码的角度来讲，最小流代码与最大流代码只有 $2$ 处不同。</p><blockquote><p> 把上下界最大流比作是“榨干”，那上下界最小流就是把残余网络“退钱”。——yxc</p></blockquote><p>所以，最后从 $T$ 向 $S$ 跑一遍最大流，再把第一次跑的最大流减去跑的第二次最大流就是原图的最小流了。</p><p><strong>也要删去最后一条边！！</strong></p><p><a href="https://loj.ac/p/117">模板有源汇上下界最小流</a></p><details>    <summary>AC Code</summary><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;ctime&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iomanip&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stack&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;map&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> gh() getchar()</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> re register</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> db double</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> ll;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN=<span class="number">1e5</span>+<span class="number">1</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXM=<span class="number">3e5</span>+<span class="number">1</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> INF=<span class="number">0x7f7f7f7f</span>;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    x=<span class="number">0</span>;</span><br><span class="line">    <span class="type">char</span> ch=<span class="built_in">gh</span>(),t=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(ch&lt;<span class="string">&#x27;0&#x27;</span>||ch&gt;<span class="string">&#x27;9&#x27;</span>) t|=ch==<span class="string">&#x27;-&#x27;</span>,ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">while</span>(ch&gt;=<span class="string">&#x27;0&#x27;</span>&amp;&amp;ch&lt;=<span class="string">&#x27;9&#x27;</span>) x=(x&lt;&lt;<span class="number">3</span>)+(x&lt;&lt;<span class="number">1</span>)+(ch^<span class="number">48</span>),ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">if</span>(t) x=-x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T,<span class="keyword">class</span> ...T1&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x,T1 &amp;...x1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">read</span>(x),<span class="built_in">read</span>(x1...);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">checkMax</span><span class="params">(T &amp;x,T &amp;y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x&lt;y?x=y,<span class="number">1</span>:<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">checkMin</span><span class="params">(T &amp;x,T &amp;y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x&gt;y?x=y,<span class="number">1</span>:<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> N,M,S,T,vS,vT;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Graph</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> next,to,val;</span><br><span class="line">    <span class="built_in">Graph</span>(<span class="type">int</span> n=<span class="number">0</span>,<span class="type">int</span> t=<span class="number">0</span>,<span class="type">int</span> v=<span class="number">0</span>):<span class="built_in">next</span>(n),<span class="built_in">to</span>(t),<span class="built_in">val</span>(v)&#123;&#125;</span><br><span class="line">&#125;Edge[MAXM&lt;&lt;<span class="number">1</span>];</span><br><span class="line"><span class="type">int</span> Head[MAXN],Cur[MAXN],Total=<span class="number">1</span>;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">addEdge</span><span class="params">(<span class="type">int</span> u,<span class="type">int</span> v,<span class="type">int</span> w)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Edge[++Total]=<span class="built_in">Graph</span>(Head[u],v,w);Head[u]=Total;</span><br><span class="line">    Edge[++Total]=<span class="built_in">Graph</span>(Head[v],u,<span class="number">0</span>);Head[v]=Total;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> Fl[MAXN],A[MAXN];</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">Bfs</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">memset</span>(Fl,<span class="number">-1</span>,<span class="built_in">sizeof</span>(Fl));</span><br><span class="line">    Fl[vS]=<span class="number">0</span>,Cur[vS]=Head[vS];</span><br><span class="line">    queue&lt;<span class="type">int</span>&gt;Q;</span><br><span class="line">    Q.<span class="built_in">push</span>(vS);</span><br><span class="line">    <span class="keyword">while</span>(!Q.<span class="built_in">empty</span>())</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> u=Q.<span class="built_in">front</span>();Q.<span class="built_in">pop</span>();</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> e=Head[u];e;e=Edge[e].next)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="type">int</span> v=Edge[e].to;</span><br><span class="line">            <span class="keyword">if</span>(Fl[v]==<span class="number">-1</span>&amp;&amp;Edge[e].val)</span><br><span class="line">            &#123;</span><br><span class="line">                Fl[v]=Fl[u]+<span class="number">1</span>;</span><br><span class="line">                Cur[v]=Head[v];</span><br><span class="line">                <span class="keyword">if</span>(v==vT) <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">                Q.<span class="built_in">push</span>(v);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">Dfs</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> inf)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(x==vT) <span class="keyword">return</span> inf;</span><br><span class="line">    <span class="type">int</span> flow=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> e=Cur[x];e&amp;&amp;flow&lt;inf;e=Edge[e].next)</span><br><span class="line">    &#123;</span><br><span class="line">        Cur[x]=e;</span><br><span class="line">        <span class="type">int</span> v=Edge[e].to;</span><br><span class="line">        <span class="keyword">if</span>(Fl[v]==Fl[x]+<span class="number">1</span>&amp;&amp;Edge[e].val)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="type">int</span> k=<span class="built_in">Dfs</span>(v,<span class="built_in">min</span>(Edge[e].val,inf-flow));</span><br><span class="line">            <span class="keyword">if</span>(!k) Fl[v]=<span class="number">-1</span>;</span><br><span class="line">            Edge[e].val-=k,Edge[e^<span class="number">1</span>].val+=k,flow+=k;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> flow;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">Dinic</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> r=<span class="number">0</span>,flow;</span><br><span class="line">    <span class="keyword">while</span>(<span class="built_in">Bfs</span>()) <span class="keyword">while</span>(flow=<span class="built_in">Dfs</span>(vS,INF)) r+=flow;</span><br><span class="line">    <span class="keyword">return</span> r;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// freopen(&quot;minflow.in&quot;,&quot;r&quot;,stdin);</span></span><br><span class="line">    <span class="comment">// freopen(&quot;minflow.out&quot;,&quot;w&quot;,stdout);</span></span><br><span class="line">    <span class="built_in">read</span>(N,M,S,T);</span><br><span class="line">    vS=<span class="number">0</span>,vT=N+<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>,u,v,up,lo;i&lt;=M;++i)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">read</span>(u,v,lo,up);</span><br><span class="line">        <span class="built_in">addEdge</span>(u,v,up-lo);</span><br><span class="line">        A[u]-=lo,A[v]+=lo;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> Tot=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=N;++i)</span><br><span class="line">        <span class="keyword">if</span>(A[i]&gt;<span class="number">0</span>) <span class="built_in">addEdge</span>(vS,i,A[i]),Tot+=A[i];</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(A[i]&lt;<span class="number">0</span>) <span class="built_in">addEdge</span>(i,vT,-A[i]);</span><br><span class="line">    <span class="built_in">addEdge</span>(T,S,INF);</span><br><span class="line">    <span class="keyword">if</span>(<span class="built_in">Dinic</span>()&lt;Tot) <span class="built_in">printf</span>(<span class="string">&quot;please go home to sleep&quot;</span>);</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> res=Edge[Total].val;</span><br><span class="line">        vS=T,vT=S;<span class="comment">//不同点1</span></span><br><span class="line">        Edge[Total].val=Edge[Total<span class="number">-1</span>].val=<span class="number">0</span>;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d&quot;</span>,res-<span class="built_in">Dinic</span>());<span class="comment">//不同点2</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">7 12 6 7</span></span><br><span class="line"><span class="comment">6 1 0 2147483647</span></span><br><span class="line"><span class="comment">1 7 0 2147483647</span></span><br><span class="line"><span class="comment">6 2 0 2147483647</span></span><br><span class="line"><span class="comment">2 7 0 2147483647</span></span><br><span class="line"><span class="comment">6 3 0 2147483647</span></span><br><span class="line"><span class="comment">3 7 0 2147483647</span></span><br><span class="line"><span class="comment">6 4 0 2147483647</span></span><br><span class="line"><span class="comment">4 7 0 2147483647</span></span><br><span class="line"><span class="comment">6 5 0 2147483647</span></span><br><span class="line"><span class="comment">5 7 0 2147483647</span></span><br><span class="line"><span class="comment">5 1 1 2147483647</span></span><br><span class="line"><span class="comment">3 4 1 2147483647</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure></details><hr><h2 id="费用流"><a href="#费用流" class="headerlink" title="费用流"></a>费用流</h2><h3 id="最小费用最大流"><a href="#最小费用最大流" class="headerlink" title="最小费用最大流"></a>最小费用最大流</h3><p>不同于最大流的普通网络，对于每一条边，除了源初的 $c(u,v)$ 表示容量限制以外，还存在一个单位流量的费用表示 $w(u,v)$ 。即流过 $1$ 个单位流量所花费的费用。</p><p>则有当边 $(u,v)$ 流过 $f(u,v)$ 的流量时，就需要支付 $f(u,v)\times w(u,v)$ 的费用。</p><p>$w$ 函数依然满足<strong>斜对称性</strong>，即有 $w(u,v)=-w(v,u)$ 。</p><p>在一个网络中花费最小的最大流称为<strong>最小费用最大流</strong>。一般是在最大化 $\sum\limits_{(s,v)\in E}f(s,v)$ 的前提下最小化 $\sum\limits_{(u,v)\in E}f(u,v)\times w(u,v)$ 。</p><hr><h3 id="SSP-算法"><a href="#SSP-算法" class="headerlink" title="SSP 算法"></a>SSP 算法</h3><p>$\text{Successive Shortest Path}$ 算法是基于贪心的算法，每次寻找单位费用最小的增广路进行增广以满足当前费用最小，直到图不存在增广路。</p><p><strong>SSP 算法不能求解负圈</strong>，如果存在单位费用为负的圈（即负圈），则需要先使用<strong>消圈算法</strong>消除图上的负圈。</p><p>SSP 的算法时间复杂度取决于求最短路的时间复杂度和寻找增广路的时间复杂度，设网络的最大流为 $f$ ，寻找增广路的时间复杂度为 $\mathcal O(nm)$ ，则上界的时间复杂度为 $\mathcal O(nmf)$ 。而事实上，该算法是<strong>伪多项式时间</strong>的。（关于值域的多项式）</p><p>对于 $\text{SSP}$ 的实现，只需将 $\text{EK,Dinic}$ 寻找增广路的算法替换为使用最短路算法寻找单位费用最小的增广路即可。（$\text{EK}$ 我就不写了）</p><p>注意费用流的建边操作满足：</p><p>对于有向边 $(u,v,w,c)$ ，其中 $w$ 为流量， $c$ 为费用；则其反边则为 $(v,u,0,-c)$ 。</p><details>    <summary>AC Code Dinic ver.</summary><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;ctime&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iomanip&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stack&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;map&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> gh() getchar()</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> re register</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> ll;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN=<span class="number">5e3</span>+<span class="number">1</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXM=<span class="number">1e5</span>+<span class="number">1</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> INF=<span class="number">0x3f3f3f3f</span>;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    x=<span class="number">0</span>;</span><br><span class="line">    <span class="type">char</span> ch=<span class="built_in">gh</span>(),t=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(ch&lt;<span class="string">&#x27;0&#x27;</span>||ch&gt;<span class="string">&#x27;9&#x27;</span>) t|=ch==<span class="string">&#x27;-&#x27;</span>,ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">while</span>(ch&gt;=<span class="string">&#x27;0&#x27;</span>&amp;&amp;ch&lt;=<span class="string">&#x27;9&#x27;</span>) x=(x&lt;&lt;<span class="number">3</span>)+(x&lt;&lt;<span class="number">1</span>)+(ch^<span class="number">48</span>),ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">if</span>(t) x=-x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T,<span class="keyword">class</span> ...T1&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x,T1 &amp;...x1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">read</span>(x),<span class="built_in">read</span>(x1...);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">checkMax</span><span class="params">(T &amp;x,T &amp;y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x&lt;y?x=y,<span class="number">1</span>:<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">checkMin</span><span class="params">(T &amp;x,T &amp;y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x&gt;y?x=y,<span class="number">1</span>:<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> N,M,S,T;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Net</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> next,to,val,cost;</span><br><span class="line">    <span class="built_in">Net</span>(<span class="type">int</span> n=<span class="number">0</span>,<span class="type">int</span> t=<span class="number">0</span>,<span class="type">int</span> v=<span class="number">0</span>,<span class="type">int</span> c=<span class="number">0</span>):</span><br><span class="line">        <span class="built_in">next</span>(n),<span class="built_in">to</span>(t),<span class="built_in">val</span>(v),<span class="built_in">cost</span>(c)&#123;&#125;</span><br><span class="line">&#125;Edge[MAXM&lt;&lt;<span class="number">1</span>];</span><br><span class="line"><span class="type">int</span> Head[MAXN],Cur[MAXN],Total=<span class="number">1</span>;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">addEdge</span><span class="params">(<span class="type">int</span> u,<span class="type">int</span> v,<span class="type">int</span> w,<span class="type">int</span> c)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Edge[++Total]=<span class="built_in">Net</span>(Head[u],v,w,c);Head[u]=Total;</span><br><span class="line">    Edge[++Total]=<span class="built_in">Net</span>(Head[v],u,<span class="number">0</span>,-c);Head[v]=Total;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> Dist[MAXN],ret;</span><br><span class="line"><span class="type">bool</span> Vis[MAXN];</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">Spfa</span><span class="params">(<span class="type">int</span> s,<span class="type">int</span> t)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">memset</span>(Dist,<span class="number">0x3f</span>,<span class="built_in">sizeof</span>(Dist));</span><br><span class="line">    <span class="built_in">memcpy</span>(Cur,Head,<span class="built_in">sizeof</span>(Head));</span><br><span class="line">    queue&lt;<span class="type">int</span>&gt;Q;</span><br><span class="line">    Q.<span class="built_in">push</span>(s),Dist[s]=<span class="number">0</span>,Vis[s]=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span>(!Q.<span class="built_in">empty</span>())</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> u=Q.<span class="built_in">front</span>();Q.<span class="built_in">pop</span>();</span><br><span class="line">        Vis[u]=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> e=Head[u];e;e=Edge[e].next)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="type">int</span> v=Edge[e].to;</span><br><span class="line">            <span class="keyword">if</span>(Edge[e].val&amp;&amp;Dist[v]&gt;Dist[u]+Edge[e].cost)</span><br><span class="line">            &#123;</span><br><span class="line">                Dist[v]=Dist[u]+Edge[e].cost;</span><br><span class="line">                <span class="keyword">if</span>(!Vis[v]) Q.<span class="built_in">push</span>(v),Vis[v]=<span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> Dist[t]!=INF;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">Dfs</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> inf)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(x==T) <span class="keyword">return</span> inf;</span><br><span class="line">    Vis[x]=<span class="number">1</span>;</span><br><span class="line">    <span class="type">int</span> flow=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> e=Cur[x];e&amp;&amp;flow&lt;inf;e=Edge[e].next)</span><br><span class="line">    &#123;</span><br><span class="line">        Cur[x]=e;</span><br><span class="line">        <span class="type">int</span> v=Edge[e].to;</span><br><span class="line">        <span class="keyword">if</span>(!Vis[v]&amp;&amp;Edge[e].val&amp;&amp;Dist[v]==Dist[x]+Edge[e].cost)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="type">int</span> k=<span class="built_in">Dfs</span>(v,<span class="built_in">min</span>(Edge[e].val,inf-flow));</span><br><span class="line">            <span class="keyword">if</span>(k)</span><br><span class="line">            &#123;</span><br><span class="line">                ret+=k*Edge[e].cost;</span><br><span class="line">                Edge[e].val-=k,Edge[e^<span class="number">1</span>].val+=k,flow+=k;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    Vis[x]=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">return</span> flow;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">Dinic</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> res=<span class="number">0</span>,flow;</span><br><span class="line">    <span class="keyword">while</span>(<span class="built_in">Spfa</span>(S,T)) <span class="keyword">while</span>(flow=<span class="built_in">Dfs</span>(S,INF)) res+=flow;</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// freopen(&quot;mincost-maxflow.in&quot;,&quot;r&quot;,stdin);</span></span><br><span class="line">    <span class="comment">// freopen(&quot;mincost-maxflow.out&quot;,&quot;w&quot;,stdout);</span></span><br><span class="line">    <span class="built_in">read</span>(N,M,S,T);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>,u,v,w,c;i&lt;=M;++i) </span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">read</span>(u,v,w,c);</span><br><span class="line">        <span class="built_in">addEdge</span>(u,v,w,c);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> ans=<span class="built_in">Dinic</span>();</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d %d&quot;</span>,ans,ret);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">4 5 4 3</span></span><br><span class="line"><span class="comment">4 2 30 2</span></span><br><span class="line"><span class="comment">4 3 20 3</span></span><br><span class="line"><span class="comment">2 3 20 1</span></span><br><span class="line"><span class="comment">2 1 30 9</span></span><br><span class="line"><span class="comment">1 3 40 5</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure></details><hr><h3 id="Primal-Dual-原始对偶算法"><a href="#Primal-Dual-原始对偶算法" class="headerlink" title="Primal-Dual 原始对偶算法"></a>Primal-Dual 原始对偶算法</h3><p>这个算法似乎和 <a href="https://oi-wiki.org/graph/shortest-path/#johnson">$\text{Johnson}$ 全源最短路</a> 有些许类似。（看到这句话我还去学了一下 $\text{Johnson}$ 全源最短路算法）</p><p>因为费用流的时间复杂度受限于其求最短路的时间，而最快的算法 $\text{Dijkstra}$ 却无法使用（因为存在负费用），那么，我们为每一个点设置一个<strong>势能</strong>使所有的费用都变成非负值，这点类似于 $\text{Johnson}$ 算法，从而使费用流的计算可以应用 $\text{Dijkstra}$ 算法。</p><p>与 $\text{Johnson}$ 相似，首先跑一次最短路，求出源点到任意点的最短距离，即该点的初始势能 $h_i$ 。然后将边 $(u,v,c)$ 处理成 $(u,v,w+h_u-h_v)$ 即可。</p><p>与常规的最短路问题不同的是，每次增广后图的形态会发生变化，这种情况下各点的势能需要更新。</p><p>令增广之后 $S$ 到 $i$ 点的最短距离为 $d_i’$ （边权重置之后），然后将 $h_i$ 加上 $d_i’$ 即可。这样可以使图上所有边的边权均为非负。</p><p>对于原有的边，增广之前有 $d_i’+(c(i,j)+h_i-h_j)-d_j’\ge 0$ ，因此 $c(i,j)+(d_i’+h_i)-(d_j’+h_j)\ge 0$ ，即用 $h_i+d_i’$ 作为新势能并不会使 $(i,j)$ 的边权变为负。</p><p>对于该算法求增广路，可以用一个结构体 $p[v]=\{u,e\}$ 表示这一条增广路走到 $v$ 时的起点是 $u$ ，边的编号是 $e$ ，然后就可以用一个逆推来移除增广路。</p><p>可以对比一下两种方法的时间：</p><div class="table-container"><table><thead><tr><th>算法</th><th style="text-align:center">朴素</th><th style="text-align:center">$\text{O}_2$</th></tr></thead><tbody><tr><td>$\text{SSP}$</td><td style="text-align:center">$\text{1.40s}$</td><td style="text-align:center">$\text{1.10s}$</td></tr><tr><td>$\text{Primal-Dual}$</td><td style="text-align:center">$\text{2.25s}$</td><td style="text-align:center">$\text{507ms}$</td></tr></tbody></table></div><details>    <summary>AC Code</summary><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;ctime&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iomanip&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stack&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;map&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> gh() getchar()</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> re register</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> ll;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN=<span class="number">5e3</span>+<span class="number">1</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXM=<span class="number">5e4</span>+<span class="number">1</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> INF=<span class="number">0x3f3f3f3f</span>;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    x=<span class="number">0</span>;</span><br><span class="line">    <span class="type">char</span> ch=<span class="built_in">gh</span>(),t=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(ch&lt;<span class="string">&#x27;0&#x27;</span>||ch&gt;<span class="string">&#x27;9&#x27;</span>) t|=ch==<span class="string">&#x27;-&#x27;</span>,ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">while</span>(ch&gt;=<span class="string">&#x27;0&#x27;</span>&amp;&amp;ch&lt;=<span class="string">&#x27;9&#x27;</span>) x=(x&lt;&lt;<span class="number">3</span>)+(x&lt;&lt;<span class="number">1</span>)+(ch^<span class="number">48</span>),ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">if</span>(t) x=-x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T,<span class="keyword">class</span> ...T1&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x,T1 &amp;...x1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">read</span>(x),<span class="built_in">read</span>(x1...);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">checkMax</span><span class="params">(T &amp;x,T &amp;y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x&lt;y?x=y,<span class="number">1</span>:<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">checkMin</span><span class="params">(T &amp;x,T &amp;y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x&gt;y?x=y,<span class="number">1</span>:<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> N,M,S,T;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Net</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> next,to,val,cost;</span><br><span class="line">    <span class="built_in">Net</span>(<span class="type">int</span> n=<span class="number">0</span>,<span class="type">int</span> t=<span class="number">0</span>,<span class="type">int</span> v=<span class="number">0</span>,<span class="type">int</span> c=<span class="number">0</span>):</span><br><span class="line">        <span class="built_in">next</span>(n),<span class="built_in">to</span>(t),<span class="built_in">val</span>(v),<span class="built_in">cost</span>(c)&#123;&#125;</span><br><span class="line">&#125;Edge[MAXM&lt;&lt;<span class="number">1</span>];</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Que</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> now,d;</span><br><span class="line">    <span class="built_in">Que</span>(<span class="type">int</span> n=<span class="number">0</span>,<span class="type">int</span> d=<span class="number">0</span>):<span class="built_in">now</span>(n),<span class="built_in">d</span>(d)&#123;&#125;</span><br><span class="line">    <span class="type">bool</span> <span class="keyword">operator</span>&lt;(<span class="type">const</span> Que&amp; a)<span class="type">const</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> d&gt;a.d;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Node</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> v,e;</span><br><span class="line">    <span class="built_in">Node</span>(<span class="type">int</span> v=<span class="number">0</span>,<span class="type">int</span> e=<span class="number">0</span>):<span class="built_in">v</span>(v),<span class="built_in">e</span>(e)&#123;&#125;</span><br><span class="line">&#125;P[MAXN];</span><br><span class="line"><span class="type">int</span> Head[MAXN],Cur[MAXN],Total=<span class="number">1</span>;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">addEdge</span><span class="params">(<span class="type">int</span> u,<span class="type">int</span> v,<span class="type">int</span> w,<span class="type">int</span> c)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Edge[++Total]=<span class="built_in">Net</span>(Head[u],v,w,c);Head[u]=Total;</span><br><span class="line">    Edge[++Total]=<span class="built_in">Net</span>(Head[v],u,<span class="number">0</span>,-c);Head[v]=Total;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> Dist[MAXN],H[MAXN],MaxF,MinC;</span><br><span class="line"><span class="type">bool</span> Vis[MAXN];</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">Dijkstra</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    priority_queue&lt;Que&gt;Q;</span><br><span class="line">    <span class="built_in">memset</span>(Dist,<span class="number">0x3f</span>,<span class="built_in">sizeof</span>(Dist));</span><br><span class="line">    <span class="built_in">memset</span>(Vis,<span class="number">0</span>,<span class="built_in">sizeof</span>(Vis));</span><br><span class="line">    Dist[S]=<span class="number">0</span>;Q.<span class="built_in">push</span>(<span class="built_in">Que</span>(S,<span class="number">0</span>));</span><br><span class="line">    <span class="keyword">while</span>(!Q.<span class="built_in">empty</span>())</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> u=Q.<span class="built_in">top</span>().now;Q.<span class="built_in">pop</span>();</span><br><span class="line">        <span class="keyword">if</span>(Vis[u]) <span class="keyword">continue</span>;</span><br><span class="line">        Vis[u]=<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> e=Head[u];e;e=Edge[e].next)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="type">int</span> v=Edge[e].to,Nc=Edge[e].cost+H[u]-H[v];</span><br><span class="line">            <span class="keyword">if</span>(Edge[e].val&amp;&amp;Dist[v]&gt;Dist[u]+Nc)</span><br><span class="line">            &#123;</span><br><span class="line">                Dist[v]=Dist[u]+Nc;</span><br><span class="line">                P[v]=<span class="built_in">Node</span>(u,e);</span><br><span class="line">                <span class="keyword">if</span>(!Vis[v]) Q.<span class="built_in">push</span>(<span class="built_in">Que</span>(v,Dist[v]));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> Dist[T]!=INF;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">Spfa</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    queue&lt;<span class="type">int</span>&gt;Q;</span><br><span class="line">    <span class="built_in">memset</span>(H,<span class="number">0x3f</span>,<span class="built_in">sizeof</span>(H));</span><br><span class="line">    H[S]=<span class="number">0</span>,Vis[S]=<span class="number">1</span>;</span><br><span class="line">    Q.<span class="built_in">push</span>(S);</span><br><span class="line">    <span class="keyword">while</span>(!Q.<span class="built_in">empty</span>())</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> u=Q.<span class="built_in">front</span>();Q.<span class="built_in">pop</span>();</span><br><span class="line">        Vis[u]=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> e=Head[u];e;e=Edge[e].next)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="type">int</span> v=Edge[e].to;</span><br><span class="line">            <span class="keyword">if</span>(Edge[e].val&amp;&amp;H[v]&gt;H[u]+Edge[e].cost)</span><br><span class="line">            &#123;</span><br><span class="line">                H[v]=H[u]+Edge[e].cost;</span><br><span class="line">                <span class="keyword">if</span>(!Vis[v])</span><br><span class="line">                &#123;</span><br><span class="line">                    Vis[v]=<span class="number">1</span>;</span><br><span class="line">                    Q.<span class="built_in">push</span>(v);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// freopen(&quot;primal-dual.in&quot;,&quot;r&quot;,stdin);</span></span><br><span class="line">    <span class="comment">// freopen(&quot;primal-dual.out&quot;,&quot;w&quot;,stdout);</span></span><br><span class="line">    <span class="built_in">read</span>(N,M,S,T);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>,u,v,w,c;i&lt;=M;++i)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">read</span>(u,v,w,c);</span><br><span class="line">        <span class="built_in">addEdge</span>(u,v,w,c);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">Spfa</span>();</span><br><span class="line">    <span class="keyword">while</span>(<span class="built_in">Dijkstra</span>())</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> MinF=INF;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=N;++i) H[i]+=Dist[i];</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=T;i!=S;i=P[i].v) <span class="built_in">checkMin</span>(MinF,Edge[P[i].e].val);</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=T;i!=S;i=P[i].v)</span><br><span class="line">        &#123;</span><br><span class="line">            Edge[P[i].e].val-=MinF;</span><br><span class="line">            Edge[P[i].e^<span class="number">1</span>].val+=MinF;</span><br><span class="line">        &#125;</span><br><span class="line">        MaxF+=MinF;</span><br><span class="line">        MinC+=MinF*H[T];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d %d&quot;</span>,MaxF,MinC);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">4 5 4 3</span></span><br><span class="line"><span class="comment">4 2 30 2</span></span><br><span class="line"><span class="comment">4 3 20 3</span></span><br><span class="line"><span class="comment">2 3 20 1</span></span><br><span class="line"><span class="comment">2 1 30 9</span></span><br><span class="line"><span class="comment">1 3 40 5</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure></details><hr><h3 id="最大费用最大流"><a href="#最大费用最大流" class="headerlink" title="最大费用最大流"></a>最大费用最大流</h3><p>其实这个东西也很简单，对于原来的费用网络，我们在构造网络的时候把每一条边的费用都取为 $-c$ ，然后跑一遍最小费用最大流，这个时候的费用是一个极小的负数，也就是原来费用网络中的最大费用最大流的答案的相反数，输出 $-ret$ 即可。</p><hr><h3 id="有源汇上下界最小费用可行流"><a href="#有源汇上下界最小费用可行流" class="headerlink" title="有源汇上下界最小费用可行流"></a>有源汇上下界最小费用可行流</h3><p><del>应该是套娃极限了。</del></p><p>其模型基于<strong>最小费用最大流</strong>和<strong>有源汇上下界可行流</strong>。所以将上下界网络转换为通常网络，然后套上费用流的模型即可。</p><blockquote><p>先建一个有源汇上下界最大流的图，边权加上费用，然后加上所有的下界和对应费用的乘积之和，为了让有源汇上下界最大流的图中虚点间的边满流，就选用最小费用最大流，直接跑最小费用最大流即可，如果没有满流那就无解，最后答案是求出来的最小费用最大流的费用和与先前已经计算的下界和对应费用乘积之和。</p><p>摘自 $\text{Csdn}$ 博客。</p></blockquote><p>对于一条边，我们需要存储 $(u,c,l,r,c)$ ，表示起点，终点，下界，上界和费用。</p><p>与上下界网络流一样，建立虚拟源汇点 $vS,vT$ ，然后就可以开始建图了：</p><ol><li>对于边 $(u,v,l,r,c)$ ，链接 $(u,v)$ ，容量为 $r-l$ ，费用为 $c$ ；</li><li>记录 $A[i]$ 表示流量差，根据 $A[i]$ 的不同链边。通俗地讲，$A[i]$ 表示流入下界和与流出下界和的差。<ol><li>若 $A[i]&gt;0$ ，则链接 $(vS,i)$ ，容量为 $A[i]$ ，费用为 $0$ ；</li><li>若 $A[i]&lt;0$ ，则链接 $(i,vT)$ ，容量为 $-A[i]$ ，费用为 $0$ 。</li></ol></li><li>链接 $(T,S)$ ，容量为 $inf$ ，费用为 $0$ 。</li></ol><p>第三步很好理解，把有源汇转化为无源汇。</p><p>然后记录答案为 $ret=\operatorname{SSP}(vS,vT)$ ，当然，只要是最小费用最大流的算法都可以。</p><p>最后答案就是 $\displaystyle ret+\sum lower(e)\times e_c$ 。</p><p>即求出的费用加上原图中边下界与边费用的积。</p><p><strong>注意：这里的流不一定是最大流。</strong></p><hr><h4 id="P4553"><a href="#P4553" class="headerlink" title="P4553"></a><a href="https://www.luogu.com.cn/problem/P4553">P4553</a></h4><p>跑了一圈发现基本上都没几个写 $\operatorname{SSP-Dinic}$ 的，要么是 $\operatorname{SSP-EK}$ ，要么直接暴力推流。总之，说说建图：</p><ol><li>拆点，将每个国家拆为出入两点，链接 $(in_e,out_e)$ ，容量 $[v_e,v_e]$ ，固定容量；</li><li>建立虚拟结点 $Ex$ ，链接 $(vS,Ex)$ ，容量为 $[m,m]$ ，并链接 $(Ex,e)$ ，容量为 $[0,inf]$ ；</li><li>链接 $(out_e,vT)$ ，容量 $[0,inf]$ 。</li><li>对于道路，链接 $(i,j)$ ，容量 $[0,inf]$ ，费用为机票费用。</li></ol><p>然后，这道题也可以不用上下界（其实上下界本身的解题思路就是化上下界为通常）。下面就是常规费用流 $\operatorname{SSP-Dinic}$ 写法。</p><details>    <summary>AC Code</summary><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;ctime&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iomanip&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stack&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;map&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> gh() getchar()</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> re register</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> ll;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN=<span class="number">5e2</span>+<span class="number">10</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXM=<span class="number">5e5</span>+<span class="number">10</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> INF=<span class="number">0x3f3f3f3f</span>;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    x=<span class="number">0</span>;</span><br><span class="line">    <span class="type">char</span> ch=<span class="built_in">gh</span>(),t=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(ch&lt;<span class="string">&#x27;0&#x27;</span>||ch&gt;<span class="string">&#x27;9&#x27;</span>) t|=ch==<span class="string">&#x27;-&#x27;</span>,ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">while</span>(ch&gt;=<span class="string">&#x27;0&#x27;</span>&amp;&amp;ch&lt;=<span class="string">&#x27;9&#x27;</span>) x=(x&lt;&lt;<span class="number">3</span>)+(x&lt;&lt;<span class="number">1</span>)+(ch^<span class="number">48</span>),ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">if</span>(t) x=-x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T,<span class="keyword">class</span> ...T1&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x,T1 &amp;...x1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">read</span>(x),<span class="built_in">read</span>(x1...);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">write</span><span class="params">(T x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(x&lt;<span class="number">0</span>) <span class="built_in">putchar</span>(<span class="string">&#x27;-&#x27;</span>),x=-x;</span><br><span class="line">    <span class="keyword">if</span>(x&gt;<span class="number">9</span>) <span class="built_in">write</span>(x/<span class="number">10</span>);</span><br><span class="line">    <span class="built_in">putchar</span>(x%<span class="number">10</span>+<span class="string">&#x27;0&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">checkMax</span><span class="params">(T &amp;x,T &amp;y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x&lt;y?x=y,<span class="number">1</span>:<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">checkMin</span><span class="params">(T &amp;x,T &amp;y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x&gt;y?x=y,<span class="number">1</span>:<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> N,M,S,T,Ex;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Net</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> next,to,val,cost;</span><br><span class="line">&#125;Edge[MAXM&lt;&lt;<span class="number">1</span>];</span><br><span class="line"><span class="type">int</span> Head[MAXN],Cur[MAXN],Total=<span class="number">1</span>;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">addEdge</span><span class="params">(<span class="type">int</span> u,<span class="type">int</span> v,<span class="type">int</span> w,<span class="type">int</span> c)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Edge[++Total]=(Net)&#123;Head[u],v,w,c&#125;;Head[u]=Total;</span><br><span class="line">    Edge[++Total]=(Net)&#123;Head[v],u,<span class="number">0</span>,-c&#125;;Head[v]=Total;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> Dist[MAXN],ret;</span><br><span class="line"><span class="type">bool</span> Vis[MAXN];</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">Spfa</span><span class="params">(<span class="type">int</span> s,<span class="type">int</span> t)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">memset</span>(Dist,<span class="number">0x3f</span>,<span class="built_in">sizeof</span>(Dist));</span><br><span class="line">    <span class="built_in">memset</span>(Vis,<span class="number">0</span>,<span class="built_in">sizeof</span>(Vis));</span><br><span class="line">    Dist[s]=<span class="number">0</span>;</span><br><span class="line">    std::queue&lt;<span class="type">int</span>&gt;Q;</span><br><span class="line">    Q.<span class="built_in">push</span>(s);</span><br><span class="line">    <span class="keyword">while</span>(!Q.<span class="built_in">empty</span>())</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> u=Q.<span class="built_in">front</span>();Q.<span class="built_in">pop</span>();</span><br><span class="line">        Vis[u]=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> e=Head[u],v;e;e=Edge[e].next)</span><br><span class="line">        &#123;</span><br><span class="line">            v=Edge[e].to;</span><br><span class="line">            <span class="keyword">if</span>(Dist[v]&gt;Dist[u]+Edge[e].cost&amp;&amp;Edge[e].val)</span><br><span class="line">            &#123;</span><br><span class="line">                Dist[v]=Dist[u]+Edge[e].cost;</span><br><span class="line">                <span class="keyword">if</span>(!Vis[v]) Vis[v]=<span class="number">1</span>,Q.<span class="built_in">push</span>(v);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> Dist[t]!=INF;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">Dfs</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> inf)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(x==T) <span class="keyword">return</span> inf;</span><br><span class="line">    <span class="type">int</span> flow=<span class="number">0</span>;Vis[x]=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> e=Cur[x],v;e&amp;&amp;flow&lt;inf;e=Edge[e].next)</span><br><span class="line">    &#123;</span><br><span class="line">        Cur[x]=e,v=Edge[e].to;</span><br><span class="line">        <span class="keyword">if</span>(!Vis[v]&amp;&amp;Dist[v]==Dist[x]+Edge[e].cost&amp;&amp;Edge[e].val)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="type">int</span> k=<span class="built_in">Dfs</span>(v,std::<span class="built_in">min</span>(Edge[e].val,inf-flow));</span><br><span class="line">            <span class="keyword">if</span>(k)</span><br><span class="line">            &#123;</span><br><span class="line">                Edge[e].val-=k,Edge[e^<span class="number">1</span>].val+=k,flow+=k;</span><br><span class="line">                ret+=k*Edge[e].cost;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    Vis[x]=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">return</span> flow;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">Dinic</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> r=<span class="number">0</span>,flow;</span><br><span class="line">    <span class="keyword">while</span>(<span class="built_in">Spfa</span>(S,T))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">memcpy</span>(Cur,Head,<span class="built_in">sizeof</span>(Head));</span><br><span class="line">        <span class="keyword">while</span>(flow=<span class="built_in">Dfs</span>(S,INF)) r+=flow;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> r;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> V[MAXN];</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// freopen(&quot;upper-lower-st-mincost-netflow.in&quot;,&quot;r&quot;,stdin);</span></span><br><span class="line">    <span class="comment">// freopen(&quot;upper-lower-st-mincost-netflow.out&quot;,&quot;w&quot;,stdout);</span></span><br><span class="line">    <span class="built_in">read</span>(N,M);</span><br><span class="line">    S=<span class="number">0</span>,T=N+N+<span class="number">1</span>,Ex=T+<span class="number">1</span>;</span><br><span class="line">    <span class="built_in">addEdge</span>(S,Ex,M,<span class="number">0</span>);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=N;++i)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">read</span>(V[i]);</span><br><span class="line">        <span class="built_in">addEdge</span>(i+N,T,V[i],<span class="number">0</span>);</span><br><span class="line">        <span class="built_in">addEdge</span>(Ex,i+N,INF,<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=N;++i)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">addEdge</span>(S,i,V[i],<span class="number">0</span>);</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j=i+<span class="number">1</span>,v;j&lt;=N;++j)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">read</span>(v);</span><br><span class="line">            <span class="keyword">if</span>(v==<span class="number">-1</span>) <span class="keyword">continue</span>;</span><br><span class="line">            <span class="built_in">addEdge</span>(i,j+N,INF,v);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">Dinic</span>();</span><br><span class="line">    <span class="built_in">write</span>(ret);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">6 3</span></span><br><span class="line"><span class="comment">2 1 3 1 2 1</span></span><br><span class="line"><span class="comment">2 6 8 5 0</span></span><br><span class="line"><span class="comment">8 2 4 1</span></span><br><span class="line"><span class="comment">6 1 0</span></span><br><span class="line"><span class="comment">4 -1</span></span><br><span class="line"><span class="comment">4</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure></details><h4 id="P4043"><a href="#P4043" class="headerlink" title="P4043"></a><a href="https://www.luogu.com.cn/problem/P4043">P4043</a></h4><p>真的诶，翻遍全网居然没有写 $\operatorname{SSP-Dinic}$ 的？（<del>贺都找不到地方</del>）</p><p>然后就贺了一个 $\operatorname{MCMF}$ 的板子然后瞎改成了 $\operatorname{SSP-Dinic}$ 。</p><p>所谓的 $\operatorname{MCMF}$ 算法，就是<strong>暴力推流</strong>，也就是费用流的 $\operatorname{SSP-EK}$ 算法。在 $\operatorname{Spfa}$ 上无异，但是会记录一个数组 $Pre[v]$ 表示是通过编号为 $Pre[v]$ 的边转移到的 $v$ ，并用 $Incf[u]$ 记录当前增广路的流量，然后用一个逆推从 $T\sim S$ 计算答案。</p><p>这里给出 $\operatorname{MCMF}$ 的函数：</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">Mcmf</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> minCost=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(<span class="built_in">Spfa</span>())</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> x=T;</span><br><span class="line">        minCost+=Dist[x]*Incf[x];</span><br><span class="line">        <span class="keyword">while</span>(x!=S)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="type">int</span> e=Pre[x];</span><br><span class="line">            Edge[e].val-=Incf[T],Edge[e^<span class="number">1</span>].val+=Incf[T];</span><br><span class="line">            x=Edge[e^<span class="number">1</span>].to;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    ret+=minCost;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>然后就是名正言顺的 $\operatorname{SSP-Dinic}$ 的上下界费用流写法。（甚至以 $\text{86ms}$ 冲进了最优解）其实与上下界网络流无异，就是将 <code>Bfs()</code> 换成 <code>Spfa()</code> 即可，难点依然在建图：</p><ol><li>对于剧情 $i$ 能够到达 $u$ ，链接 $(i,u)$ ，容量为 $[1,inf]$ ，费用为 $v$ 。</li><li>因为除了 $1$ 号剧情，其它所有剧情都应该能够直接结束，所以链接 $(i,T)$ ，这里的 $T$ 是真实汇点，容量为 $[0,inf]$ ，费用为 $0$ ；</li><li>对于流量不守恒的点，根据 $A[i]$ 的正负，链接虚拟源点或者虚拟汇点，容量为 $\mid A[i]\mid$ ，费用为 $0$ 。</li><li>链接 $(T,S)$ ，都是真实的。容量为 $[0,inf]$ ，费用为 $0$ 。</li></ol><p>因为这里只是求取可行流，所以跑一遍即可。</p><details>    <summary>AC Code</summary><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;ctime&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iomanip&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stack&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;map&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> gh() getchar()</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> re register</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> ll;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN=<span class="number">1e3</span>+<span class="number">10</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXM=<span class="number">1e6</span>+<span class="number">10</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> INF=<span class="number">0x3f3f3f3f</span>;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    x=<span class="number">0</span>;</span><br><span class="line">    <span class="type">char</span> ch=<span class="built_in">gh</span>(),t=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(ch&lt;<span class="string">&#x27;0&#x27;</span>||ch&gt;<span class="string">&#x27;9&#x27;</span>) t|=ch==<span class="string">&#x27;-&#x27;</span>,ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">while</span>(ch&gt;=<span class="string">&#x27;0&#x27;</span>&amp;&amp;ch&lt;=<span class="string">&#x27;9&#x27;</span>) x=(x&lt;&lt;<span class="number">3</span>)+(x&lt;&lt;<span class="number">1</span>)+(ch^<span class="number">48</span>),ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">if</span>(t) x=-x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T,<span class="keyword">class</span> ...T1&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x,T1 &amp;...x1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">read</span>(x),<span class="built_in">read</span>(x1...);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">write</span><span class="params">(T x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(x&lt;<span class="number">0</span>) <span class="built_in">putchar</span>(<span class="string">&#x27;-&#x27;</span>),x=-x;</span><br><span class="line">    <span class="keyword">if</span>(x&gt;<span class="number">9</span>) <span class="built_in">write</span>(x/<span class="number">10</span>);</span><br><span class="line">    <span class="built_in">putchar</span>(x%<span class="number">10</span>+<span class="string">&#x27;0&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">checkMax</span><span class="params">(T &amp;x,T &amp;y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x&lt;y?x=y,<span class="number">1</span>:<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">checkMin</span><span class="params">(T &amp;x,T &amp;y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x&gt;y?x=y,<span class="number">1</span>:<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> N,M,S,T,ret;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Net</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> next,to,val,cost;</span><br><span class="line">&#125;Edge[MAXM&lt;&lt;<span class="number">1</span>];</span><br><span class="line"><span class="type">int</span> Head[MAXN],Cur[MAXN],Total=<span class="number">1</span>;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">addEdge</span><span class="params">(<span class="type">int</span> u,<span class="type">int</span> v,<span class="type">int</span> w,<span class="type">int</span> c)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Edge[++Total]=(Net)&#123;Head[u],v,w,c&#125;;Head[u]=Total;</span><br><span class="line">    Edge[++Total]=(Net)&#123;Head[v],u,<span class="number">0</span>,-c&#125;;Head[v]=Total;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> Dist[MAXN],A[MAXN];</span><br><span class="line"><span class="type">bool</span> Vis[MAXN];</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">Spfa</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    std::queue&lt;<span class="type">int</span>&gt;Q;</span><br><span class="line">    <span class="built_in">memset</span>(Dist,<span class="number">0x3f</span>,<span class="built_in">sizeof</span>(Dist));</span><br><span class="line">    <span class="built_in">memset</span>(Vis,<span class="number">0</span>,<span class="built_in">sizeof</span>(Vis));</span><br><span class="line">    Q.<span class="built_in">push</span>(S);</span><br><span class="line">    Dist[S]=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(!Q.<span class="built_in">empty</span>())</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> u=Q.<span class="built_in">front</span>();Q.<span class="built_in">pop</span>();</span><br><span class="line">        Vis[u]=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> e=Head[u];e;e=Edge[e].next)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="type">int</span> v=Edge[e].to;</span><br><span class="line">            <span class="keyword">if</span>(Dist[v]&gt;Dist[u]+Edge[e].cost&amp;&amp;Edge[e].val)</span><br><span class="line">            &#123;</span><br><span class="line">                Dist[v]=Dist[u]+Edge[e].cost;</span><br><span class="line">                <span class="keyword">if</span>(!Vis[v]) Vis[v]=<span class="number">1</span>,Q.<span class="built_in">push</span>(v);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> Dist[T]!=INF;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">Dfs</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> inf)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(x==T) <span class="keyword">return</span> inf;</span><br><span class="line">    <span class="type">int</span> flow=<span class="number">0</span>;Vis[x]=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> e=Cur[x],v;e&amp;&amp;flow&lt;inf;e=Edge[e].next)</span><br><span class="line">    &#123;</span><br><span class="line">        v=Edge[e].to,Cur[x]=e;</span><br><span class="line">        <span class="keyword">if</span>(!Vis[v]&amp;&amp;Edge[e].val&amp;&amp;Dist[v]==Dist[x]+Edge[e].cost)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="type">int</span> k=<span class="built_in">Dfs</span>(v,std::<span class="built_in">min</span>(Edge[e].val,inf-flow));</span><br><span class="line">            <span class="keyword">if</span>(k)</span><br><span class="line">            &#123;</span><br><span class="line">                ret+=k*Edge[e].cost;</span><br><span class="line">                Edge[e].val-=k,Edge[e^<span class="number">1</span>].val+=k,flow+=k;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    Vis[x]=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">return</span> flow;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">Dinic</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> r=<span class="number">0</span>,flow;</span><br><span class="line">    <span class="keyword">while</span>(<span class="built_in">Spfa</span>())</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">memcpy</span>(Cur,Head,<span class="built_in">sizeof</span>(Head));</span><br><span class="line">        <span class="keyword">while</span>(flow=<span class="built_in">Dfs</span>(S,INF)) r+=flow;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> r;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// freopen(&quot;netflow.in&quot;,&quot;r&quot;,stdin);</span></span><br><span class="line">    <span class="comment">// freopen(&quot;netflow.out&quot;,&quot;w&quot;,stdout);</span></span><br><span class="line">    <span class="built_in">read</span>(N);</span><br><span class="line">    <span class="type">int</span> rS=<span class="number">1</span>,rT=N+<span class="number">1</span>,vS=N+<span class="number">2</span>,vT=N+<span class="number">3</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>,k;i&lt;=N;++i)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">read</span>(k);</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">1</span>,u,v;j&lt;=k;++j)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">read</span>(u,v);</span><br><span class="line">            ++A[u],--A[i];</span><br><span class="line">            ret+=v;<span class="built_in">addEdge</span>(i,u,INF<span class="number">-1</span>,v);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">2</span>;i&lt;=N;++i) <span class="built_in">addEdge</span>(i,rT,INF,<span class="number">0</span>);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=N;++i)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(A[i]&gt;<span class="number">0</span>) <span class="built_in">addEdge</span>(vS,i,A[i],<span class="number">0</span>);</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(A[i]&lt;<span class="number">0</span>) <span class="built_in">addEdge</span>(i,vT,-A[i],<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">addEdge</span>(rT,rS,INF,<span class="number">0</span>);</span><br><span class="line">    S=vS,T=vT;</span><br><span class="line">    <span class="built_in">Dinic</span>();</span><br><span class="line">    <span class="built_in">write</span>(ret);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">6</span></span><br><span class="line"><span class="comment">2 2 1 3 2</span></span><br><span class="line"><span class="comment">2 4 3 5 4</span></span><br><span class="line"><span class="comment">2 5 5 6 6</span></span><br><span class="line"><span class="comment">0</span></span><br><span class="line"><span class="comment">0</span></span><br><span class="line"><span class="comment">0</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure></details><hr><h2 id="网络流的实际应用（构造网络）"><a href="#网络流的实际应用（构造网络）" class="headerlink" title="网络流的实际应用（构造网络）"></a>网络流的实际应用（构造网络）</h2><p>如果一道题能够使用网络流来做（一般指最大流和最小割），那这道题的代码非常格式化：</p><ol><li>建图，构造出原网络；</li><li>增广，并计算出答案。</li></ol><p>结束。就这么简单……么？</p><p>网络流的板子在于其第 $2$ 步，正因如此，难点在于如何建图。</p><hr><h3 id="一道难题-Tree"><a href="#一道难题-Tree" class="headerlink" title="一道难题 Tree"></a><a href="https://www.luogu.com.cn/problem/P3931">一道难题 Tree</a></h3><p>其实可以用树型 dp 来解，但我们今天不谈 dp 。</p><p>我们发现，如果使叶节点和根节点分离，最小的代价就是从根节点到叶节点的路径的最小边的代价。这与一条增广路是类似的，那么，我们可以把这道题转换成另外一个模型。</p><p>对于原图的根节点，则是网络的超级汇点 $S$ ，每一个叶节点都是一个汇点 $T’$ ，最后求源点到汇点的最大流。就是一个模板的多源汇最大流了，然后我们链接一个超级汇点 $T$ ，链接所有叶子汇点，求从超级源点到超级汇点的最大流。</p><p>但是，这道题的边是双向边，在开始的时候我们并不知道谁是起点谁是终点，所以我们跑一遍 $dfs$ 处理出叶节点并连边，并将双向边处理成单向边。</p><details>    <summary>AC Code</summary><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;ctime&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iomanip&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stack&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;map&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> gh() getchar()</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> re register</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> ll;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN=<span class="number">2e5</span>+<span class="number">1</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXM=<span class="number">5e5</span>+<span class="number">1</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> INF=<span class="number">0x7f7f7f7f</span>;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    x=<span class="number">0</span>;</span><br><span class="line">    <span class="type">char</span> ch=<span class="built_in">gh</span>(),t=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(ch&lt;<span class="string">&#x27;0&#x27;</span>||ch&gt;<span class="string">&#x27;9&#x27;</span>) t|=ch==<span class="string">&#x27;-&#x27;</span>,ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">while</span>(ch&gt;=<span class="string">&#x27;0&#x27;</span>&amp;&amp;ch&lt;=<span class="string">&#x27;9&#x27;</span>) x=(x&lt;&lt;<span class="number">3</span>)+(x&lt;&lt;<span class="number">1</span>)+(ch^<span class="number">48</span>),ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">if</span>(t) x=-x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T,<span class="keyword">class</span> ...T1&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x,T1 &amp;...x1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">read</span>(x),<span class="built_in">read</span>(x1...);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">checkMax</span><span class="params">(T &amp;x,T &amp;y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x&lt;y?x=y,<span class="number">1</span>:<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">checkMin</span><span class="params">(T &amp;x,T &amp;y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x&gt;y?x=y,<span class="number">1</span>:<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> N,S,T;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Net</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> next,to,val;</span><br><span class="line">    <span class="built_in">Net</span>(<span class="type">int</span> n=<span class="number">0</span>,<span class="type">int</span> t=<span class="number">0</span>,<span class="type">int</span> v=<span class="number">0</span>):<span class="built_in">next</span>(n),<span class="built_in">to</span>(t),<span class="built_in">val</span>(v)&#123;&#125;</span><br><span class="line">&#125;Edge[MAXM&lt;&lt;<span class="number">1</span>];</span><br><span class="line"><span class="type">int</span> Head[MAXN],Cur[MAXN],Total=<span class="number">1</span>;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">addEdge</span><span class="params">(<span class="type">int</span> u,<span class="type">int</span> v,<span class="type">int</span> w)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Edge[++Total]=<span class="built_in">Net</span>(Head[u],v,w);Head[u]=Total;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> Fl[MAXN];</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">Bfs</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">memset</span>(Fl,<span class="number">-1</span>,<span class="built_in">sizeof</span>(Fl));</span><br><span class="line">    Fl[S]=<span class="number">0</span>,Cur[S]=Head[S];</span><br><span class="line">    queue&lt;<span class="type">int</span>&gt;Q;</span><br><span class="line">    Q.<span class="built_in">push</span>(S);</span><br><span class="line">    <span class="keyword">while</span>(!Q.<span class="built_in">empty</span>())</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> u=Q.<span class="built_in">front</span>();Q.<span class="built_in">pop</span>();</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> e=Head[u];e;e=Edge[e].next)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="type">int</span> v=Edge[e].to;</span><br><span class="line">            <span class="keyword">if</span>(Fl[v]==<span class="number">-1</span>&amp;&amp;Edge[e].val)</span><br><span class="line">            &#123;</span><br><span class="line">                Fl[v]=Fl[u]+<span class="number">1</span>;</span><br><span class="line">                Cur[v]=Head[v];</span><br><span class="line">                <span class="keyword">if</span>(v==T) <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">                Q.<span class="built_in">push</span>(v);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">Dfs</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> inf)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(x==T) <span class="keyword">return</span> inf;</span><br><span class="line">    <span class="type">int</span> flow=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> e=Cur[x];e&amp;&amp;flow&lt;inf;e=Edge[e].next)</span><br><span class="line">    &#123;</span><br><span class="line">        Cur[x]=e;</span><br><span class="line">        <span class="type">int</span> v=Edge[e].to;</span><br><span class="line">        <span class="keyword">if</span>(Fl[v]==Fl[x]+<span class="number">1</span>&amp;&amp;Edge[e].val)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="type">int</span> k=<span class="built_in">Dfs</span>(v,<span class="built_in">min</span>(Edge[e].val,inf-flow));</span><br><span class="line">            <span class="keyword">if</span>(!k) Fl[v]=<span class="number">-1</span>;</span><br><span class="line">            Edge[e].val-=k,Edge[e^<span class="number">1</span>].val+=k,flow+=k;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> flow;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">Dinic</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> r=<span class="number">0</span>,flow;</span><br><span class="line">    <span class="keyword">while</span>(<span class="built_in">Bfs</span>()) <span class="keyword">while</span>(flow=<span class="built_in">Dfs</span>(S,INF)) r+=flow;</span><br><span class="line">    <span class="keyword">return</span> r;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dpTree</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> last)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">bool</span> flag=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> e=Head[x],v;e;e=Edge[e].next)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>((v=Edge[e].to)==last) <span class="keyword">continue</span>;</span><br><span class="line">        <span class="built_in">dpTree</span>(v,x);</span><br><span class="line">        flag=<span class="number">1</span>;</span><br><span class="line">        Edge[e^<span class="number">1</span>].val=<span class="number">0</span>;<span class="comment">//处理双向边</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(!flag)<span class="comment">//链接超级汇点</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">addEdge</span>(x,T,INF);</span><br><span class="line">        <span class="built_in">addEdge</span>(T,x,<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// freopen(&quot;mxaflow.in&quot;,&quot;r&quot;,stdin);</span></span><br><span class="line">    <span class="comment">// freopen(&quot;maxflow.out&quot;,&quot;w&quot;,stdout);</span></span><br><span class="line">    <span class="built_in">read</span>(N,S);</span><br><span class="line">    T=N+<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">2</span>,u,v,w;i&lt;=N;++i)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">read</span>(u,v,w);</span><br><span class="line">        <span class="built_in">addEdge</span>(u,v,w);</span><br><span class="line">        <span class="built_in">addEdge</span>(v,u,w);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">dpTree</span>(S,<span class="number">-1</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d&quot;</span>,<span class="built_in">Dinic</span>());</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">4 1</span></span><br><span class="line"><span class="comment">1 2 1 </span></span><br><span class="line"><span class="comment">1 3 1</span></span><br><span class="line"><span class="comment">1 4 1</span></span><br><span class="line"><span class="comment">*/</span>    </span><br></pre></td></tr></table></figure></details><hr><h3 id="蜥蜴"><a href="#蜥蜴" class="headerlink" title="蜥蜴"></a><a href="https://www.luogu.com.cn/problem/P2472">蜥蜴</a></h3><p>将平面二维图建立成网络。可以发现，能够流入的网络应该是 $inf$ 的，而能够流出的流量就是该点的高度（权值）。这里会用到一种叫<strong>拆点</strong>的技巧——顾名思义，将原来的 $u $ 结点拆成 $u_{in}$ 和 $u_{out}$ 两个结点， $u_{in}$ 用来链接原来指向 $u$ 的边， $u_{out}$ 用来链接原来从 $u$ 出发的边。而链接 $u_{in}$ 和 $u_{out}$ 以保证经过 $u$ 之后只能有 $h[u]$ 只蜥蜴。</p><p>建图：</p><ol><li>对于 $h[u]\ne 0$ 的结点，链接 $(u_{in},u_{out},h[u])$ ；</li><li>对于 $D(|u(x_1,y_1)|-|v(x_2,y_2|)\le d$ ，链接 $(u_{out},v_{in},inf)$ ；</li><li>对于 $s[u]=L$ ，即存在蜥蜴，链接 $(S,u_{in},inf)$ ；</li><li>对于 $D(|u(x_1,y_1)|-|OUTSIDE|)$ ，即达到边界，链接 $(u_{out},T,inf)$ 。</li></ol><p>为什么所有容量都可以设成 $inf$ ？因为能够通过 $u$ 点的流，必然会经过 $(u_{in},u_{out})$ 的边，则其最多的流量必然会是 $h[u]$ ，而避免胡乱赋值导致容量变小，不如全部赋为 $inf$ 。</p><details>    <summary>AC Code</summary><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;ctime&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iomanip&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stack&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;map&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> gh() getchar()</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> re register</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> ll;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXR=<span class="number">21</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXP=<span class="number">1e3</span>+<span class="number">1</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXE=<span class="number">2e4</span>+<span class="number">1</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> INF=<span class="number">0x7f7f7f7f</span>;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    x=<span class="number">0</span>;</span><br><span class="line">    <span class="type">char</span> ch=<span class="built_in">gh</span>(),t=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(ch&lt;<span class="string">&#x27;0&#x27;</span>||ch&gt;<span class="string">&#x27;9&#x27;</span>) t|=ch==<span class="string">&#x27;-&#x27;</span>,ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">while</span>(ch&gt;=<span class="string">&#x27;0&#x27;</span>&amp;&amp;ch&lt;=<span class="string">&#x27;9&#x27;</span>) x=(x&lt;&lt;<span class="number">3</span>)+(x&lt;&lt;<span class="number">1</span>)+(ch^<span class="number">48</span>),ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">if</span>(t) x=-x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T,<span class="keyword">class</span> ...T1&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x,T1 &amp;...x1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">read</span>(x),<span class="built_in">read</span>(x1...);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">checkMax</span><span class="params">(T &amp;x,T &amp;y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x&lt;y?x=y,<span class="number">1</span>:<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">checkMin</span><span class="params">(T &amp;x,T &amp;y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x&gt;y?x=y,<span class="number">1</span>:<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> R,C,D,Dth,S,T,Tot;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">G</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> next,to,val;</span><br><span class="line">    <span class="built_in">G</span>(<span class="type">int</span> n=<span class="number">0</span>,<span class="type">int</span> t=<span class="number">0</span>,<span class="type">int</span> v=<span class="number">0</span>):<span class="built_in">next</span>(n),<span class="built_in">to</span>(t),<span class="built_in">val</span>(v)&#123;&#125;</span><br><span class="line">&#125;Edge[MAXE&lt;&lt;<span class="number">1</span>];</span><br><span class="line"><span class="type">int</span> Head[MAXP],Cur[MAXP],Total=<span class="number">1</span>;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">addEdge</span><span class="params">(<span class="type">int</span> u,<span class="type">int</span> v,<span class="type">int</span> w)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Edge[++Total]=<span class="built_in">G</span>(Head[u],v,w);Head[u]=Total;</span><br><span class="line">    Edge[++Total]=<span class="built_in">G</span>(Head[v],u,<span class="number">0</span>);Head[v]=Total;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> Fl[MAXP];</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">Bfs</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">memset</span>(Fl,<span class="number">-1</span>,<span class="built_in">sizeof</span>(Fl));</span><br><span class="line">    Fl[S]=<span class="number">0</span>,Cur[S]=Head[S];</span><br><span class="line">    queue&lt;<span class="type">int</span>&gt;Q;</span><br><span class="line">    Q.<span class="built_in">push</span>(S);</span><br><span class="line">    <span class="keyword">while</span>(!Q.<span class="built_in">empty</span>())</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> u=Q.<span class="built_in">front</span>();Q.<span class="built_in">pop</span>();</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> e=Head[u];e;e=Edge[e].next)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="type">int</span> v=Edge[e].to;</span><br><span class="line">            <span class="keyword">if</span>(Fl[v]==<span class="number">-1</span>&amp;&amp;Edge[e].val)</span><br><span class="line">            &#123;</span><br><span class="line">                Fl[v]=Fl[u]+<span class="number">1</span>;Cur[v]=Head[v];</span><br><span class="line">                <span class="keyword">if</span>(v==T) <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">                Q.<span class="built_in">push</span>(v);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">Dfs</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> inf)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(x==T) <span class="keyword">return</span> inf;</span><br><span class="line">    <span class="type">int</span> flow=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> e=Cur[x];e&amp;&amp;flow&lt;inf;e=Edge[e].next)</span><br><span class="line">    &#123;</span><br><span class="line">        Cur[x]=e;</span><br><span class="line">        <span class="type">int</span> v=Edge[e].to;</span><br><span class="line">        <span class="keyword">if</span>(Fl[v]==Fl[x]+<span class="number">1</span>&amp;&amp;Edge[e].val)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="type">int</span> k=<span class="built_in">Dfs</span>(v,<span class="built_in">min</span>(Edge[e].val,inf-flow));</span><br><span class="line">            <span class="keyword">if</span>(!k) Fl[v]=<span class="number">-1</span>;</span><br><span class="line">            Edge[e].val-=k,Edge[e^<span class="number">1</span>].val+=k,flow+=k;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> flow;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">Dinic</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> r=<span class="number">0</span>,flow;</span><br><span class="line">    <span class="keyword">while</span>(<span class="built_in">Bfs</span>()) <span class="keyword">while</span>(flow=<span class="built_in">Dfs</span>(S,INF)) r+=flow;</span><br><span class="line">    <span class="keyword">return</span> r;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">char</span> opt[MAXR];</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">Dist</span><span class="params">(<span class="type">int</span> x1,<span class="type">int</span> y1,<span class="type">int</span> x2,<span class="type">int</span> y2)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (x1-x2)*(x1-x2)+(y1-y2)*(y1-y2);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">In</span><span class="params">(<span class="type">int</span> i,<span class="type">int</span> j)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> C*(i<span class="number">-1</span>)+j;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">Out</span><span class="params">(<span class="type">int</span> i,<span class="type">int</span> j)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> C*(i<span class="number">-1</span>)+j+R*C;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// freopen(&quot;maxflow.in&quot;,&quot;r&quot;,stdin);</span></span><br><span class="line">    <span class="comment">// freopen(&quot;maxflow.out&quot;,&quot;w&quot;,stdout);</span></span><br><span class="line">    <span class="built_in">read</span>(R,C,D);</span><br><span class="line">    Dth=D*D;</span><br><span class="line">    S=<span class="number">0</span>,T=<span class="number">2</span>*R*C+<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=R;++i)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>,opt+<span class="number">1</span>);</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">1</span>;j&lt;=C;++j)</span><br><span class="line">            <span class="keyword">if</span>(opt[j]!=<span class="string">&#x27;0&#x27;</span>) <span class="built_in">addEdge</span>(<span class="built_in">In</span>(i,j),<span class="built_in">Out</span>(i,j),opt[j]-<span class="string">&#x27;0&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=R;++i)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>,opt+<span class="number">1</span>);</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">1</span>;j&lt;=C;++j)</span><br><span class="line">            <span class="keyword">if</span>(opt[j]==<span class="string">&#x27;L&#x27;</span>) <span class="built_in">addEdge</span>(S,<span class="built_in">In</span>(i,j),<span class="number">1</span>),++Tot;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=R;++i)</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">1</span>;j&lt;=C;++j)</span><br><span class="line">            <span class="keyword">if</span>(i-D&lt;<span class="number">1</span>||j-D&lt;<span class="number">1</span>||i+D&gt;R||j+D&gt;C) <span class="built_in">addEdge</span>(<span class="built_in">Out</span>(i,j),T,INF);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=R;++i)</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">1</span>;j&lt;=C;++j)</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> k=<span class="number">1</span>;k&lt;=R;++k)</span><br><span class="line">                <span class="keyword">for</span>(<span class="type">int</span> l=<span class="number">1</span>;l&lt;=C;++l)</span><br><span class="line">                    <span class="keyword">if</span>(<span class="built_in">Dist</span>(i,j,k,l)&lt;=Dth)</span><br><span class="line">                        <span class="built_in">addEdge</span>(<span class="built_in">Out</span>(i,j),<span class="built_in">In</span>(k,l),INF);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d&quot;</span>,Tot-<span class="built_in">Dinic</span>());</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">5 8 2</span></span><br><span class="line"><span class="comment">00000000</span></span><br><span class="line"><span class="comment">02000000</span></span><br><span class="line"><span class="comment">00321100</span></span><br><span class="line"><span class="comment">02000000</span></span><br><span class="line"><span class="comment">00000000</span></span><br><span class="line"><span class="comment">........</span></span><br><span class="line"><span class="comment">........</span></span><br><span class="line"><span class="comment">..LLLL..</span></span><br><span class="line"><span class="comment">........</span></span><br><span class="line"><span class="comment">........</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure></details><hr><h3 id="假期的宿舍"><a href="#假期的宿舍" class="headerlink" title="假期的宿舍"></a><a href="https://www.luogu.com.cn/problem/P2055">假期的宿舍</a></h3><p>有点像二分图匹配，所以考虑最大流。</p><p>把学生看作是结点 $1\sim n$ ，床看作是结点 $n+1\sim 2n$ ，建图：</p><ol><li>如果该学生留校（包括看望的学生），链接 $S$ 与该学生；</li><li>如果该学生有床，链接该学生的床和 $T$ 。</li><li>链接每一位本校学生和自己的床。</li><li>如果 $u$ 和 $v$ 认识，链接学生 $u$ 的人和学生 $v$ 的床。</li><li>容量都是 $1$ 。</li></ol><p>跑一遍 $\text{Dinic}$ 就好了。</p><details>    <summary>AC Code</summary><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;ctime&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iomanip&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stack&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;map&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> gh() getchar()</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> re register</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> ll;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXP=<span class="number">1e3</span>+<span class="number">1</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXE=<span class="number">2e4</span>+<span class="number">1</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> INF=<span class="number">0x3f3f3f3f</span>;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    x=<span class="number">0</span>;</span><br><span class="line">    <span class="type">char</span> ch=<span class="built_in">gh</span>(),t=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(ch&lt;<span class="string">&#x27;0&#x27;</span>||ch&gt;<span class="string">&#x27;9&#x27;</span>) t|=ch==<span class="string">&#x27;-&#x27;</span>,ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">while</span>(ch&gt;=<span class="string">&#x27;0&#x27;</span>&amp;&amp;ch&lt;=<span class="string">&#x27;9&#x27;</span>) x=(x&lt;&lt;<span class="number">3</span>)+(x&lt;&lt;<span class="number">1</span>)+(ch^<span class="number">48</span>),ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">if</span>(t) x=-x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T,<span class="keyword">class</span> ...T1&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x,T1 &amp;...x1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">read</span>(x),<span class="built_in">read</span>(x1...);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">checkMax</span><span class="params">(T &amp;x,T &amp;y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x&lt;y?x=y,<span class="number">1</span>:<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">checkMin</span><span class="params">(T &amp;x,T &amp;y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x&gt;y?x=y,<span class="number">1</span>:<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> N,M,S,T;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Net</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> next,to,val;</span><br><span class="line">    <span class="built_in">Net</span>(<span class="type">int</span> n=<span class="number">0</span>,<span class="type">int</span> t=<span class="number">0</span>,<span class="type">int</span> v=<span class="number">0</span>):<span class="built_in">next</span>(n),<span class="built_in">to</span>(t),<span class="built_in">val</span>(v)&#123;&#125;</span><br><span class="line">&#125;Edge[MAXE&lt;&lt;<span class="number">1</span>];</span><br><span class="line"><span class="type">int</span> Head[MAXP],Cur[MAXP],Total=<span class="number">1</span>;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">addEdge</span><span class="params">(<span class="type">int</span> u,<span class="type">int</span> v,<span class="type">int</span> w)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Edge[++Total]=<span class="built_in">Net</span>(Head[u],v,w);Head[u]=Total;</span><br><span class="line">    Edge[++Total]=<span class="built_in">Net</span>(Head[v],u,<span class="number">0</span>);Head[v]=Total;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> Fl[MAXP];</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">Bfs</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">memset</span>(Fl,<span class="number">-1</span>,<span class="built_in">sizeof</span>(Fl));</span><br><span class="line">    Fl[S]=<span class="number">0</span>,Cur[S]=Head[S];</span><br><span class="line">    queue&lt;<span class="type">int</span>&gt;Q;</span><br><span class="line">    Q.<span class="built_in">push</span>(S);</span><br><span class="line">    <span class="keyword">while</span>(!Q.<span class="built_in">empty</span>())</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> u=Q.<span class="built_in">front</span>();Q.<span class="built_in">pop</span>();</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> e=Head[u],v;e;e=Edge[e].next)</span><br><span class="line">        &#123;</span><br><span class="line">            v=Edge[e].to;</span><br><span class="line">            <span class="keyword">if</span>(Fl[v]==<span class="number">-1</span>&amp;&amp;Edge[e].val)</span><br><span class="line">            &#123;</span><br><span class="line">                Fl[v]=Fl[u]+<span class="number">1</span>;</span><br><span class="line">                Cur[v]=Head[v];</span><br><span class="line">                <span class="keyword">if</span>(v==T) <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">                Q.<span class="built_in">push</span>(v);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">Dfs</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> inf)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(x==T) <span class="keyword">return</span> inf;</span><br><span class="line">    <span class="type">int</span> flow=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> e=Cur[x],v;e&amp;&amp;flow&lt;inf;e=Edge[e].next)</span><br><span class="line">    &#123;</span><br><span class="line">        Cur[x]=e;v=Edge[e].to;</span><br><span class="line">        <span class="keyword">if</span>(Fl[v]==Fl[x]+<span class="number">1</span>&amp;&amp;Edge[e].val)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="type">int</span> k=<span class="built_in">Dfs</span>(v,<span class="built_in">min</span>(Edge[e].val,inf-flow));</span><br><span class="line">            <span class="keyword">if</span>(!k) Fl[v]=<span class="number">-1</span>;</span><br><span class="line">            Edge[e].val-=k,Edge[e^<span class="number">1</span>].val+=k,flow+=k;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> flow;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">Dinic</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> r=<span class="number">0</span>,flow;</span><br><span class="line">    <span class="keyword">while</span>(<span class="built_in">Bfs</span>()) <span class="keyword">while</span>(flow=<span class="built_in">Dfs</span>(S,INF)) r+=flow;</span><br><span class="line">    <span class="keyword">return</span> r;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> Test,Cnt;</span><br><span class="line"><span class="type">bool</span> In[MAXP];</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">Solve</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">memset</span>(In,<span class="number">0</span>,<span class="built_in">sizeof</span>(In));Cnt=<span class="number">0</span>;</span><br><span class="line">    <span class="built_in">memset</span>(Head,<span class="number">0</span>,<span class="built_in">sizeof</span>(Head));Total=<span class="number">1</span>;</span><br><span class="line">    <span class="built_in">read</span>(N);</span><br><span class="line">    S=<span class="number">0</span>,T=N+N+<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=N;++i)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">read</span>(In[i]);</span><br><span class="line">        <span class="keyword">if</span>(In[i]) <span class="built_in">addEdge</span>(i+N,T,<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>,x;i&lt;=N;++i)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">read</span>(x);</span><br><span class="line">        <span class="keyword">if</span>((!x&amp;&amp;In[i])||(!In[i])) <span class="built_in">addEdge</span>(S,i,<span class="number">1</span>),++Cnt;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=N;++i)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(In[i]) <span class="built_in">addEdge</span>(i,i+N,<span class="number">1</span>);</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">1</span>,x;j&lt;=N;++j)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">read</span>(x);</span><br><span class="line">            <span class="keyword">if</span>(x) <span class="built_in">addEdge</span>(i,j+N,<span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(<span class="built_in">Dinic</span>()&gt;=Cnt) <span class="built_in">printf</span>(<span class="string">&quot;^_^\n&quot;</span>);</span><br><span class="line">    <span class="keyword">else</span> <span class="built_in">printf</span>(<span class="string">&quot;T_T\n&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// freopen(&quot;maxflow.in&quot;,&quot;r&quot;,stdin);</span></span><br><span class="line">    <span class="comment">// freopen(&quot;maxflow.out&quot;,&quot;w&quot;,stdout);</span></span><br><span class="line">    <span class="built_in">read</span>(Test);</span><br><span class="line">    <span class="keyword">while</span>(Test--) <span class="built_in">Solve</span>();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">1</span></span><br><span class="line"><span class="comment">3</span></span><br><span class="line"><span class="comment">1 1 0</span></span><br><span class="line"><span class="comment">0 1 0</span></span><br><span class="line"><span class="comment">0 1 1</span></span><br><span class="line"><span class="comment">1 0 0</span></span><br><span class="line"><span class="comment">1 0 0</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure></details><hr><h2 id="网络流-24-题"><a href="#网络流-24-题" class="headerlink" title="网络流 24 题"></a>网络流 24 题</h2><p>这里只给出指路和标程。</p><p><a href="https://www.luogu.com.cn/problem/list?tag=332&amp;page=1">指路</a></p><h3 id="飞行员配对方案问题"><a href="#飞行员配对方案问题" class="headerlink" title="飞行员配对方案问题"></a>飞行员配对方案问题</h3><p>可以当做是网络流 24 题建图之旅的开始。</p><details>    <summary>AC Code</summary><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;ctime&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iomanip&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stack&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;map&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> gh() getchar()</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> re register</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> db double</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> ll;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN=<span class="number">201</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXM=<span class="number">5001</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> INF=<span class="number">0x7f7f7f7f</span>;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    x=<span class="number">0</span>;</span><br><span class="line">    <span class="type">char</span> ch=<span class="built_in">gh</span>(),t=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(ch&lt;<span class="string">&#x27;0&#x27;</span>||ch&gt;<span class="string">&#x27;9&#x27;</span>) t|=ch==<span class="string">&#x27;-&#x27;</span>,ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">while</span>(ch&gt;=<span class="string">&#x27;0&#x27;</span>&amp;&amp;ch&lt;=<span class="string">&#x27;9&#x27;</span>) x=(x&lt;&lt;<span class="number">3</span>)+(x&lt;&lt;<span class="number">1</span>)+(ch^<span class="number">48</span>),ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">if</span>(t) x=-x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T,<span class="keyword">class</span> ...T1&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x,T1 &amp;...x1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">read</span>(x),<span class="built_in">read</span>(x1...);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">checkMax</span><span class="params">(T &amp;x,T &amp;y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x&lt;y?x=y,<span class="number">1</span>:<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">checkMin</span><span class="params">(T &amp;x,T &amp;y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x&gt;y?x=y,<span class="number">1</span>:<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> N,M,S,T;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Edge</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> from,to,cap,flow;</span><br><span class="line">    <span class="built_in">Edge</span>(<span class="type">int</span> u,<span class="type">int</span> v,<span class="type">int</span> c,<span class="type">int</span> f):<span class="built_in">from</span>(u),<span class="built_in">to</span>(v),<span class="built_in">cap</span>(c),<span class="built_in">flow</span>(f)&#123;&#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">namespace</span> EdmondsKarp</span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> Total;</span><br><span class="line">    vector&lt;Edge&gt;Edges;</span><br><span class="line">    vector&lt;<span class="type">int</span>&gt;G[MAXN];</span><br><span class="line">    <span class="type">int</span> fl[MAXN],id[MAXN];</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">init</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=N;++i) G[i].<span class="built_in">clear</span>();</span><br><span class="line">        Edges.<span class="built_in">clear</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">addEdge</span><span class="params">(<span class="type">int</span> u,<span class="type">int</span> v,<span class="type">int</span> c)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        Edges.<span class="built_in">push_back</span>(<span class="built_in">Edge</span>(u,v,c,<span class="number">0</span>));</span><br><span class="line">        Edges.<span class="built_in">push_back</span>(<span class="built_in">Edge</span>(v,u,<span class="number">0</span>,<span class="number">0</span>));</span><br><span class="line">        Total=Edges.<span class="built_in">size</span>();</span><br><span class="line">        G[u].<span class="built_in">push_back</span>(Total<span class="number">-2</span>);</span><br><span class="line">        G[v].<span class="built_in">push_back</span>(Total<span class="number">-1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> ll <span class="title">maxFlow</span><span class="params">(<span class="type">int</span> s,<span class="type">int</span> t)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        ll flow=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(;;)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">memset</span>(fl,<span class="number">0</span>,<span class="built_in">sizeof</span>(fl));</span><br><span class="line">            queue&lt;<span class="type">int</span>&gt;Q;</span><br><span class="line">            Q.<span class="built_in">push</span>(s);</span><br><span class="line">            fl[s]=INF;</span><br><span class="line">            <span class="keyword">while</span>(!Q.<span class="built_in">empty</span>())</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="type">int</span> u=Q.<span class="built_in">front</span>();Q.<span class="built_in">pop</span>();</span><br><span class="line">                <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;G[u].<span class="built_in">size</span>();++i)</span><br><span class="line">                &#123;</span><br><span class="line">                    Edge&amp; e=Edges[G[u][i]];</span><br><span class="line">                    <span class="keyword">if</span>(!fl[e.to]&amp;&amp;e.cap&gt;e.flow)</span><br><span class="line">                    &#123;</span><br><span class="line">                        id[e.to]=G[u][i];</span><br><span class="line">                        fl[e.to]=<span class="built_in">min</span>(fl[u],e.cap-e.flow);</span><br><span class="line">                        Q.<span class="built_in">push</span>(e.to);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span>(fl[t]) <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(!fl[t]) <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> u=t;u!=s;u=Edges[id[u]].from)</span><br><span class="line">            &#123;</span><br><span class="line">                Edges[id[u]].flow+=fl[t];</span><br><span class="line">                Edges[id[u]^<span class="number">1</span>].flow-=fl[t];</span><br><span class="line">            &#125;</span><br><span class="line">            flow+=fl[t];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> flow;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> EdmondsKarp;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// freopen(&quot;ek.in&quot;,&quot;r&quot;,stdin);</span></span><br><span class="line">    <span class="comment">// freopen(&quot;ek.out&quot;,&quot;w&quot;,stdout);</span></span><br><span class="line">    <span class="built_in">read</span>(M,N);</span><br><span class="line">    S=<span class="number">0</span>,T=N+<span class="number">1</span>;</span><br><span class="line">    EdmondsKarp::<span class="built_in">init</span>();</span><br><span class="line">    <span class="type">int</span> u,v;</span><br><span class="line">    <span class="built_in">read</span>(u,v);</span><br><span class="line">    <span class="keyword">while</span>(u!=<span class="number">-1</span>&amp;&amp;v!=<span class="number">-1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        EdmondsKarp::<span class="built_in">addEdge</span>(u,v,<span class="number">1</span>);</span><br><span class="line">        <span class="built_in">read</span>(u,v);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=M;++i) EdmondsKarp::<span class="built_in">addEdge</span>(S,i,<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=M+<span class="number">1</span>;i&lt;=N;++i) EdmondsKarp::<span class="built_in">addEdge</span>(i,T,<span class="number">1</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%lld\n&quot;</span>,EdmondsKarp::<span class="built_in">maxFlow</span>(S,T));</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;Total;i+=<span class="number">2</span>)</span><br><span class="line">        <span class="keyword">if</span>(Edges[i].to!=S&amp;&amp;Edges[i].from!=S)</span><br><span class="line">            <span class="keyword">if</span>(Edges[i].to!=T&amp;&amp;Edges[i].from!=T)</span><br><span class="line">                <span class="keyword">if</span>(Edges[i].flow!=<span class="number">0</span>)</span><br><span class="line">                    <span class="built_in">printf</span>(<span class="string">&quot;%d %d\n&quot;</span>,Edges[i].from,Edges[i].to);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">5 10</span></span><br><span class="line"><span class="comment">1 7</span></span><br><span class="line"><span class="comment">1 8</span></span><br><span class="line"><span class="comment">2 6</span></span><br><span class="line"><span class="comment">2 9</span></span><br><span class="line"><span class="comment">2 10</span></span><br><span class="line"><span class="comment">3 7</span></span><br><span class="line"><span class="comment">3 8</span></span><br><span class="line"><span class="comment">4 7</span></span><br><span class="line"><span class="comment">4 8</span></span><br><span class="line"><span class="comment">5 10</span></span><br><span class="line"><span class="comment">-1 -1</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure></details><hr><h3 id="太空飞行计划问题"><a href="#太空飞行计划问题" class="headerlink" title="太空飞行计划问题"></a>太空飞行计划问题</h3><p>总之，建图还是很玄学，对于有事件 $A$ 和事件 $B$ ，则建图：</p><ol><li>链接 $S$ 和事件 $A_i$ ，容量为 $W_{A_i}$ ；</li><li>链接事件 $B_i$ 和 $T$ ，容量为 $W_{B_i}$ ；</li><li>链接存在关系的 $A_i$ 和 $B_j$ ，容量为 $inf$ 。</li></ol><p>似乎大多数的题都是这样做的，且如果正向的最大流并不是答案的话，可以试着求出 $Sum-maxFlow$ ，也就是求出最小割。（总结出来不能算套路的套路）</p><p>而对于输出方案，也挺玄学的。</p><p>这里主要说说 $\text{Dinic}$ ，可以判断高度函数 $Fl[x]$ ，也可以判断反边的残留网络容量……总之，挺玄学的。</p><details>    <summary>AC Code</summary><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;ctime&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iomanip&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stack&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;map&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> gh() getchar()</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> re register</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> ll;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN=<span class="number">1001</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXM=<span class="number">1001</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> INF=<span class="number">0x3f3f3f3f</span>;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    x=<span class="number">0</span>;</span><br><span class="line">    <span class="type">char</span> ch=<span class="built_in">gh</span>(),t=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(ch&lt;<span class="string">&#x27;0&#x27;</span>||ch&gt;<span class="string">&#x27;9&#x27;</span>) t|=ch==<span class="string">&#x27;-&#x27;</span>,ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">while</span>(ch&gt;=<span class="string">&#x27;0&#x27;</span>&amp;&amp;ch&lt;=<span class="string">&#x27;9&#x27;</span>) x=(x&lt;&lt;<span class="number">3</span>)+(x&lt;&lt;<span class="number">1</span>)+(ch^<span class="number">48</span>),ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">if</span>(t) x=-x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T,<span class="keyword">class</span> ...T1&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x,T1 &amp;...x1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">read</span>(x),<span class="built_in">read</span>(x1...);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">write</span><span class="params">(T x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(x&lt;<span class="number">0</span>) <span class="built_in">putchar</span>(<span class="string">&#x27;-&#x27;</span>),x=-x;</span><br><span class="line">    <span class="keyword">if</span>(x&gt;<span class="number">9</span>) <span class="built_in">write</span>(x/<span class="number">10</span>);</span><br><span class="line">    <span class="built_in">putchar</span>(x%<span class="number">10</span>+<span class="string">&#x27;0&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">checkMax</span><span class="params">(T &amp;x,T &amp;y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x&lt;y?x=y,<span class="number">1</span>:<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">checkMin</span><span class="params">(T &amp;x,T &amp;y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x&gt;y?x=y,<span class="number">1</span>:<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> N,M,S,T;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Net</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> next,to,val;</span><br><span class="line">&#125;Edge[MAXM&lt;&lt;<span class="number">2</span>];</span><br><span class="line"><span class="type">int</span> Head[MAXN],Cur[MAXN],Total=<span class="number">1</span>;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">addEdge</span><span class="params">(<span class="type">int</span> u,<span class="type">int</span> v,<span class="type">int</span> w)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Edge[++Total]=(Net)&#123;Head[u],v,w&#125;;Head[u]=Total;</span><br><span class="line">    Edge[++Total]=(Net)&#123;Head[v],u,<span class="number">0</span>&#125;;Head[v]=Total;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> Fl[MAXN],SumW;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">Bfs</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">memset</span>(Fl,<span class="number">-1</span>,<span class="built_in">sizeof</span>(Fl));</span><br><span class="line">    Fl[S]=<span class="number">0</span>,Cur[S]=Head[S];</span><br><span class="line">    std::queue&lt;<span class="type">int</span>&gt;Q;</span><br><span class="line">    Q.<span class="built_in">push</span>(S);</span><br><span class="line">    <span class="keyword">while</span>(!Q.<span class="built_in">empty</span>())</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> u=Q.<span class="built_in">front</span>();Q.<span class="built_in">pop</span>();</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> e=Head[u],v;e;e=Edge[e].next)</span><br><span class="line">        &#123;</span><br><span class="line">            v=Edge[e].to;</span><br><span class="line">            <span class="keyword">if</span>(Fl[v]==<span class="number">-1</span>&amp;&amp;Edge[e].val)</span><br><span class="line">            &#123;</span><br><span class="line">                Fl[v]=Fl[u]+<span class="number">1</span>,Cur[v]=Head[v];</span><br><span class="line">                <span class="keyword">if</span>(v==T) <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">                Q.<span class="built_in">push</span>(v);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">Dfs</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> inf)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(x==T) <span class="keyword">return</span> inf;</span><br><span class="line">    <span class="type">int</span> flow=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> e=Cur[x],v;e&amp;&amp;flow&lt;inf;e=Edge[e].next)</span><br><span class="line">    &#123;</span><br><span class="line">        v=Edge[e].to,Cur[x]=e;</span><br><span class="line">        <span class="keyword">if</span>(Fl[v]==Fl[x]+<span class="number">1</span>&amp;&amp;Edge[e].val)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="type">int</span> k=<span class="built_in">Dfs</span>(v,std::<span class="built_in">min</span>(Edge[e].val,inf-flow));</span><br><span class="line">            <span class="keyword">if</span>(!k) Fl[v]=<span class="number">-1</span>;</span><br><span class="line">            Edge[e].val-=k,Edge[e^<span class="number">1</span>].val+=k,flow+=k;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> flow;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">Dinic</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> r=<span class="number">0</span>,flow;</span><br><span class="line">    <span class="keyword">while</span>(<span class="built_in">Bfs</span>()) <span class="keyword">while</span>(flow=<span class="built_in">Dfs</span>(S,INF)) r+=flow;</span><br><span class="line">    <span class="keyword">return</span> r;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// freopen(&quot;netflow.in&quot;,&quot;r&quot;,stdin);</span></span><br><span class="line">    <span class="comment">// freopen(&quot;netflow.out&quot;,&quot;w&quot;,stdout);</span></span><br><span class="line">    <span class="built_in">read</span>(N,M);</span><br><span class="line">    S=<span class="number">0</span>,T=N+M+<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>,W;i&lt;=N;++i)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">read</span>(W);<span class="built_in">addEdge</span>(S,i,W);SumW+=W;</span><br><span class="line">        <span class="type">char</span> tools[<span class="number">10000</span>];</span><br><span class="line">        <span class="built_in">memset</span>(tools,<span class="number">0</span>,<span class="keyword">sizeof</span> tools);</span><br><span class="line">        std::cin.<span class="built_in">getline</span>(tools,<span class="number">10000</span>);</span><br><span class="line">        <span class="type">int</span> ulen=<span class="number">0</span>,tool;</span><br><span class="line">        <span class="keyword">while</span>(<span class="built_in">sscanf</span>(tools+ulen,<span class="string">&quot;%d&quot;</span>,&amp;tool)==<span class="number">1</span>)<span class="comment">//之前已经用scanf读完了赞助商同意支付该实验的费用</span></span><br><span class="line">        &#123;<span class="comment">//tool是该实验所需仪器的其中一个      </span></span><br><span class="line">            <span class="comment">//这一行，你可以将读进来的编号进行储存、处理，如连边。</span></span><br><span class="line">            <span class="built_in">addEdge</span>(i,tool+N,INF);</span><br><span class="line">            <span class="keyword">if</span>(tool==<span class="number">0</span>) </span><br><span class="line">                ulen++;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">while</span>(tool)</span><br><span class="line">                &#123;</span><br><span class="line">                    tool/=<span class="number">10</span>;</span><br><span class="line">                    ulen++;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            ulen++;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>,W;i&lt;=M;++i)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">read</span>(W);<span class="built_in">addEdge</span>(i+N,T,W);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> ans=SumW-<span class="built_in">Dinic</span>();</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> e=<span class="number">1</span>;e&lt;=N;++e)</span><br><span class="line">        <span class="keyword">if</span>(Fl[e]!=<span class="number">-1</span>) <span class="built_in">write</span>(e),<span class="built_in">putchar</span>(<span class="string">&#x27; &#x27;</span>);</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;&quot;</span>);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> e=N+<span class="number">1</span>;e&lt;=N+M;++e)</span><br><span class="line">        <span class="keyword">if</span>(Fl[e]!=<span class="number">-1</span>) <span class="built_in">write</span>(e-N),<span class="built_in">putchar</span>(<span class="string">&#x27; &#x27;</span>);</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;&quot;</span>);</span><br><span class="line">    <span class="built_in">write</span>(ans);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">2 3</span></span><br><span class="line"><span class="comment">10 1 2</span></span><br><span class="line"><span class="comment">25 2 3</span></span><br><span class="line"><span class="comment">5 6 7</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure></details><hr><h3 id="试题库问题"><a href="#试题库问题" class="headerlink" title="试题库问题"></a>试题库问题</h3><p>本人第一次自主建图成功，大贺大贺。</p><details>    <summary>AC Code</summary><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;ctime&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iomanip&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stack&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;map&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> gh() getchar()</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> re register</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> ll;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXK=<span class="number">21</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN=<span class="number">1e4</span>+<span class="number">1</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXM=<span class="number">2e5</span>+<span class="number">1</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> INF=<span class="number">0x7f7f7f7f</span>;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    x=<span class="number">0</span>;</span><br><span class="line">    <span class="type">char</span> ch=<span class="built_in">gh</span>(),t=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(ch&lt;<span class="string">&#x27;0&#x27;</span>||ch&gt;<span class="string">&#x27;9&#x27;</span>) t|=ch==<span class="string">&#x27;-&#x27;</span>,ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">while</span>(ch&gt;=<span class="string">&#x27;0&#x27;</span>&amp;&amp;ch&lt;=<span class="string">&#x27;9&#x27;</span>) x=(x&lt;&lt;<span class="number">3</span>)+(x&lt;&lt;<span class="number">1</span>)+(ch^<span class="number">48</span>),ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">if</span>(t) x=-x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T,<span class="keyword">class</span> ...T1&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x,T1 &amp;...x1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">read</span>(x),<span class="built_in">read</span>(x1...);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">checkMax</span><span class="params">(T &amp;x,T &amp;y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x&lt;y?x=y,<span class="number">1</span>:<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">checkMin</span><span class="params">(T &amp;x,T &amp;y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x&gt;y?x=y,<span class="number">1</span>:<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> N,K,S,T,M;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Net</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> next,to,val;</span><br><span class="line">    <span class="built_in">Net</span>(<span class="type">int</span> n=<span class="number">0</span>,<span class="type">int</span> t=<span class="number">0</span>,<span class="type">int</span> v=<span class="number">0</span>):<span class="built_in">next</span>(n),<span class="built_in">to</span>(t),<span class="built_in">val</span>(v)&#123;&#125;</span><br><span class="line">&#125;Edge[MAXM&lt;&lt;<span class="number">1</span>];</span><br><span class="line"><span class="type">int</span> Head[MAXN],Cur[MAXN],Total=<span class="number">1</span>;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">addEdge</span><span class="params">(<span class="type">int</span> u,<span class="type">int</span> v,<span class="type">int</span> w)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Edge[++Total]=<span class="built_in">Net</span>(Head[u],v,w);Head[u]=Total;</span><br><span class="line">    Edge[++Total]=<span class="built_in">Net</span>(Head[v],u,<span class="number">0</span>);Head[v]=Total;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> Fl[MAXN],Ans[MAXK][MAXN],Cnt[MAXN];</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">Bfs</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">memset</span>(Fl,<span class="number">-1</span>,<span class="built_in">sizeof</span>(Fl));</span><br><span class="line">    Fl[S]=<span class="number">0</span>,Cur[S]=Head[S];</span><br><span class="line">    queue&lt;<span class="type">int</span>&gt;Q;</span><br><span class="line">    Q.<span class="built_in">push</span>(S);</span><br><span class="line">    <span class="keyword">while</span>(!Q.<span class="built_in">empty</span>())</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> u=Q.<span class="built_in">front</span>();Q.<span class="built_in">pop</span>();</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> e=Head[u];e;e=Edge[e].next)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="type">int</span> v=Edge[e].to;</span><br><span class="line">            <span class="keyword">if</span>(Fl[v]==<span class="number">-1</span>&amp;&amp;Edge[e].val)</span><br><span class="line">            &#123;</span><br><span class="line">                Fl[v]=Fl[u]+<span class="number">1</span>;</span><br><span class="line">                Cur[v]=Head[v];</span><br><span class="line">                <span class="keyword">if</span>(v==T) <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">                Q.<span class="built_in">push</span>(v);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">Dfs</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> inf)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(x==T) <span class="keyword">return</span> inf;</span><br><span class="line">    <span class="type">int</span> flow=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> e=Cur[x];e&amp;&amp;flow&lt;inf;e=Edge[e].next)</span><br><span class="line">    &#123;</span><br><span class="line">        Cur[x]=e;</span><br><span class="line">        <span class="type">int</span> v=Edge[e].to;</span><br><span class="line">        <span class="keyword">if</span>(Fl[v]==Fl[x]+<span class="number">1</span>&amp;&amp;Edge[e].val)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="type">int</span> k=<span class="built_in">Dfs</span>(v,<span class="built_in">min</span>(Edge[e].val,inf-flow));</span><br><span class="line">            <span class="keyword">if</span>(!k) Fl[v]=<span class="number">-1</span>;</span><br><span class="line">            Edge[e].val-=k,Edge[e^<span class="number">1</span>].val+=k,flow+=k;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> flow;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">Dinic</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> r=<span class="number">0</span>,flow;</span><br><span class="line">    <span class="keyword">while</span>(<span class="built_in">Bfs</span>()) <span class="keyword">while</span>(flow=<span class="built_in">Dfs</span>(S,INF)) r+=flow;</span><br><span class="line">    <span class="keyword">return</span> r;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// freopen(&quot;maxflow.in&quot;,&quot;r&quot;,stdin);</span></span><br><span class="line">    <span class="comment">// freopen(&quot;maxflow.out&quot;,&quot;w&quot;,stdout);</span></span><br><span class="line">    <span class="built_in">read</span>(K,N);</span><br><span class="line">    S=<span class="number">0</span>,T=N+K+<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>,ksum;i&lt;=K;++i)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">read</span>(ksum);</span><br><span class="line">        <span class="built_in">addEdge</span>(S,i,ksum);</span><br><span class="line">        M+=ksum;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>,kopt,ver;i&lt;=N;++i)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">read</span>(kopt);</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">1</span>;j&lt;=kopt;++j)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">read</span>(ver);</span><br><span class="line">            <span class="built_in">addEdge</span>(ver,i+K,<span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">addEdge</span>(i+K,T,<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(<span class="built_in">Dinic</span>()&lt;M) <span class="built_in">printf</span>(<span class="string">&quot;No Solution!&quot;</span>);</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">2</span>;i&lt;=Total;i+=<span class="number">2</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="type">int</span> from=Edge[i^<span class="number">1</span>].to,to=Edge[i].to;</span><br><span class="line">            <span class="keyword">if</span>(<span class="number">1</span>&lt;=from&amp;&amp;from&lt;=K)</span><br><span class="line">                <span class="keyword">if</span>(K+<span class="number">1</span>&lt;=to&amp;&amp;to&lt;=N+K)</span><br><span class="line">                    <span class="keyword">if</span>(Edge[i^<span class="number">1</span>].val)</span><br><span class="line">                        Ans[from][++Cnt[from]]=to-K;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=K;++i)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">sort</span>(Ans[i]+<span class="number">1</span>,Ans[i]+<span class="number">1</span>+Cnt[i]);</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;%d: &quot;</span>,i);</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">1</span>;j&lt;=Cnt[i];++j) <span class="built_in">printf</span>(<span class="string">&quot;%d &quot;</span>,Ans[i][j]);</span><br><span class="line">            <span class="built_in">puts</span>(<span class="string">&quot;&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">3 15</span></span><br><span class="line"><span class="comment">3 3 4</span></span><br><span class="line"><span class="comment">2 1 2</span></span><br><span class="line"><span class="comment">1 3</span></span><br><span class="line"><span class="comment">1 3</span></span><br><span class="line"><span class="comment">1 3</span></span><br><span class="line"><span class="comment">1 3</span></span><br><span class="line"><span class="comment">3 1 2 3</span></span><br><span class="line"><span class="comment">2 2 3</span></span><br><span class="line"><span class="comment">2 1 3</span></span><br><span class="line"><span class="comment">1 2</span></span><br><span class="line"><span class="comment">1 2</span></span><br><span class="line"><span class="comment">2 1 2</span></span><br><span class="line"><span class="comment">2 1 3</span></span><br><span class="line"><span class="comment">2 1 2</span></span><br><span class="line"><span class="comment">1 1</span></span><br><span class="line"><span class="comment">3 1 2 3</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure></details><hr><h3 id="方格取数问题"><a href="#方格取数问题" class="headerlink" title="方格取数问题"></a>方格取数问题</h3><p>最大权独立集模板题，求最小割。</p><details>    <summary>AC Code</summary><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;ctime&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iomanip&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stack&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;map&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> gh() getchar()</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> re register</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> ll;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN=<span class="number">101</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXP=<span class="number">2e4</span>+<span class="number">1</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXE=<span class="number">2e6</span>+<span class="number">1</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> INF=<span class="number">0x3f3f3f3f</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> Dx[]=&#123;<span class="number">0</span>,<span class="number">1</span>,<span class="number">-1</span>,<span class="number">0</span>,<span class="number">0</span>&#125;;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> Dy[]=&#123;<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">-1</span>,<span class="number">1</span>&#125;;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    x=<span class="number">0</span>;</span><br><span class="line">    <span class="type">char</span> ch=<span class="built_in">gh</span>(),t=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(ch&lt;<span class="string">&#x27;0&#x27;</span>||ch&gt;<span class="string">&#x27;9&#x27;</span>) t|=ch==<span class="string">&#x27;-&#x27;</span>,ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">while</span>(ch&gt;=<span class="string">&#x27;0&#x27;</span>&amp;&amp;ch&lt;=<span class="string">&#x27;9&#x27;</span>) x=(x&lt;&lt;<span class="number">3</span>)+(x&lt;&lt;<span class="number">1</span>)+(ch^<span class="number">48</span>),ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">if</span>(t) x=-x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T,<span class="keyword">class</span> ...T1&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x,T1 &amp;...x1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">read</span>(x),<span class="built_in">read</span>(x1...);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">checkMax</span><span class="params">(T &amp;x,T &amp;y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x&lt;y?x=y,<span class="number">1</span>:<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">checkMin</span><span class="params">(T &amp;x,T &amp;y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x&gt;y?x=y,<span class="number">1</span>:<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> N,M,S,T;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">G</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> next,to,val;</span><br><span class="line">    <span class="built_in">G</span>(<span class="type">int</span> n=<span class="number">0</span>,<span class="type">int</span> t=<span class="number">0</span>,<span class="type">int</span> v=<span class="number">0</span>):<span class="built_in">next</span>(n),<span class="built_in">to</span>(t),<span class="built_in">val</span>(v)&#123;&#125;</span><br><span class="line">&#125;Edge[MAXE&lt;&lt;<span class="number">1</span>];</span><br><span class="line"><span class="type">int</span> Head[MAXP],Cur[MAXP],Total=<span class="number">1</span>;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">addEdge</span><span class="params">(<span class="type">int</span> u,<span class="type">int</span> v,<span class="type">int</span> w)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Edge[++Total]=<span class="built_in">G</span>(Head[u],v,w);Head[u]=Total;</span><br><span class="line">    Edge[++Total]=<span class="built_in">G</span>(Head[v],u,<span class="number">0</span>);Head[v]=Total;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> Fl[MAXP];</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">Bfs</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">memset</span>(Fl,<span class="number">-1</span>,<span class="built_in">sizeof</span>(Fl));</span><br><span class="line">    Fl[S]=<span class="number">0</span>,Cur[S]=Head[S];</span><br><span class="line">    queue&lt;<span class="type">int</span>&gt;Q;</span><br><span class="line">    Q.<span class="built_in">push</span>(S);</span><br><span class="line">    <span class="keyword">while</span>(!Q.<span class="built_in">empty</span>())</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> u=Q.<span class="built_in">front</span>();Q.<span class="built_in">pop</span>();</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> e=Head[u];e;e=Edge[e].next)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="type">int</span> v=Edge[e].to;</span><br><span class="line">            <span class="keyword">if</span>(Fl[v]==<span class="number">-1</span>&amp;&amp;Edge[e].val)</span><br><span class="line">            &#123;</span><br><span class="line">                Fl[v]=Fl[u]+<span class="number">1</span>;Cur[v]=Head[v];</span><br><span class="line">                <span class="keyword">if</span>(v==T) <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">                Q.<span class="built_in">push</span>(v);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">Dfs</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> inf)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(x==T) <span class="keyword">return</span> inf;</span><br><span class="line">    <span class="type">int</span> flow=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> e=Cur[x];e&amp;&amp;flow&lt;inf;e=Edge[e].next)</span><br><span class="line">    &#123;</span><br><span class="line">        Cur[x]=e;</span><br><span class="line">        <span class="type">int</span> v=Edge[e].to;</span><br><span class="line">        <span class="keyword">if</span>(Fl[v]==Fl[x]+<span class="number">1</span>&amp;&amp;Edge[e].val)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="type">int</span> k=<span class="built_in">Dfs</span>(v,<span class="built_in">min</span>(Edge[e].val,inf-flow));</span><br><span class="line">            <span class="keyword">if</span>(!k) Fl[v]=<span class="number">-1</span>;</span><br><span class="line">            Edge[e].val-=k,Edge[e^<span class="number">1</span>].val+=k,flow+=k;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> flow;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">Dinic</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> r=<span class="number">0</span>,flow;</span><br><span class="line">    <span class="keyword">while</span>(<span class="built_in">Bfs</span>()) <span class="keyword">while</span>(flow=<span class="built_in">Dfs</span>(S,INF)) r+=flow;</span><br><span class="line">    <span class="keyword">return</span> r;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">bool</span> Color[MAXN][MAXN];</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// freopen(&quot;netflow.in&quot;,&quot;r&quot;,stdin);</span></span><br><span class="line">    <span class="comment">// freopen(&quot;netflow.out&quot;,&quot;w&quot;,stdout);</span></span><br><span class="line">    <span class="built_in">read</span>(N,M);</span><br><span class="line">    S=<span class="number">0</span>,T=N*M+<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=N;++i)</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">1</span>;j&lt;=M;++j)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span>(((i&amp;<span class="number">1</span>)&amp;&amp;(j&amp;<span class="number">1</span>))||((!(i&amp;<span class="number">1</span>))&amp;&amp;(!(j&amp;<span class="number">1</span>))))</span><br><span class="line">                Color[i][j]=<span class="number">1</span>;</span><br><span class="line">            <span class="keyword">else</span> Color[i][j]=<span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    <span class="comment">/*for(int i=1;i&lt;=N;++i)&#123;</span></span><br><span class="line"><span class="comment">        for(int j=1;j&lt;=M;++j) cout&lt;&lt;Color[i][j]&lt;&lt;&quot; &quot;;</span></span><br><span class="line"><span class="comment">        puts(&quot;&quot;);</span></span><br><span class="line"><span class="comment">    &#125;*/</span></span><br><span class="line">    ll Cnt=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=N;++i)</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">1</span>,x;j&lt;=M;++j)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">read</span>(x);</span><br><span class="line">            Cnt+=x;</span><br><span class="line">            <span class="keyword">if</span>(Color[i][j]) <span class="built_in">addEdge</span>(M*(i<span class="number">-1</span>)+j,T,x);</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">            &#123;</span><br><span class="line">                <span class="built_in">addEdge</span>(S,M*(i<span class="number">-1</span>)+j,x);</span><br><span class="line">                <span class="keyword">for</span>(<span class="type">int</span> k=<span class="number">1</span>;k&lt;=<span class="number">4</span>;++k)</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="type">int</span> Nx=i+Dx[k],Ny=j+Dy[k];</span><br><span class="line">                    <span class="keyword">if</span>(Nx&lt;<span class="number">1</span>||Ny&lt;<span class="number">1</span>||Nx&gt;N||Ny&gt;M) <span class="keyword">continue</span>;</span><br><span class="line">                    <span class="built_in">addEdge</span>(M*(i<span class="number">-1</span>)+j,M*(Nx<span class="number">-1</span>)+Ny,INF);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d&quot;</span>,Cnt-<span class="built_in">Dinic</span>());</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">3 3</span></span><br><span class="line"><span class="comment">1 2 3</span></span><br><span class="line"><span class="comment">3 2 3</span></span><br><span class="line"><span class="comment">2 3 1 </span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure></details><hr><h3 id="圆桌问题"><a href="#圆桌问题" class="headerlink" title="圆桌问题"></a>圆桌问题</h3><p>较基础，可以作为练习。</p><details>    <summary>AC Code</summary><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;ctime&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iomanip&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stack&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;map&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> gh() getchar()</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> re register</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> db double</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> ll;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN=<span class="number">5001</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXM=<span class="number">1e6</span>+<span class="number">1</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> INF=<span class="number">0x7f7f7f7f</span>;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    x=<span class="number">0</span>;</span><br><span class="line">    <span class="type">char</span> ch=<span class="built_in">gh</span>(),t=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(ch&lt;<span class="string">&#x27;0&#x27;</span>||ch&gt;<span class="string">&#x27;9&#x27;</span>) t|=ch==<span class="string">&#x27;-&#x27;</span>,ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">while</span>(ch&gt;=<span class="string">&#x27;0&#x27;</span>&amp;&amp;ch&lt;=<span class="string">&#x27;9&#x27;</span>) x=(x&lt;&lt;<span class="number">3</span>)+(x&lt;&lt;<span class="number">1</span>)+(ch^<span class="number">48</span>),ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">if</span>(t) x=-x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T,<span class="keyword">class</span> ...T1&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x,T1 &amp;...x1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">read</span>(x),<span class="built_in">read</span>(x1...);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">checkMax</span><span class="params">(T &amp;x,T &amp;y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x&lt;y?x=y,<span class="number">1</span>:<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">checkMin</span><span class="params">(T &amp;x,T &amp;y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x&gt;y?x=y,<span class="number">1</span>:<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> N,M,S,T;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Graph</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> next,to,val;</span><br><span class="line">    <span class="built_in">Graph</span>(<span class="type">int</span> n=<span class="number">0</span>,<span class="type">int</span> t=<span class="number">0</span>,<span class="type">int</span> v=<span class="number">0</span>):<span class="built_in">next</span>(n),<span class="built_in">to</span>(t),<span class="built_in">val</span>(v)&#123;&#125;</span><br><span class="line">&#125;Edge[MAXM&lt;&lt;<span class="number">1</span>];</span><br><span class="line"><span class="type">int</span> Head[MAXN],NewT[MAXN],Total=<span class="number">1</span>;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">addEdge</span><span class="params">(<span class="type">int</span> u,<span class="type">int</span> v,<span class="type">int</span> w)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Edge[++Total]=<span class="built_in">Graph</span>(Head[u],v,w);Head[u]=Total;</span><br><span class="line">    Edge[++Total]=<span class="built_in">Graph</span>(Head[v],u,<span class="number">0</span>);Head[v]=Total;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> Fl[MAXN],Tot;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">Bfs</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    queue&lt;<span class="type">int</span>&gt;Q;</span><br><span class="line">    <span class="built_in">memset</span>(Fl,<span class="number">-1</span>,<span class="built_in">sizeof</span>(Fl));</span><br><span class="line">    Q.<span class="built_in">push</span>(S);</span><br><span class="line">    NewT[S]=Head[S],Fl[S]=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(!Q.<span class="built_in">empty</span>())</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> u=Q.<span class="built_in">front</span>();Q.<span class="built_in">pop</span>();</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> e=Head[u];e;e=Edge[e].next)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="type">int</span> v=Edge[e].to;</span><br><span class="line">            <span class="keyword">if</span>(Fl[v]==<span class="number">-1</span>&amp;&amp;Edge[e].val)</span><br><span class="line">            &#123;</span><br><span class="line">                Fl[v]=Fl[u]+<span class="number">1</span>;</span><br><span class="line">                NewT[v]=Head[v];</span><br><span class="line">                <span class="keyword">if</span>(v==T) <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">                Q.<span class="built_in">push</span>(v);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">Dfs</span><span class="params">(<span class="type">int</span> u,<span class="type">int</span> inf)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(u==T) <span class="keyword">return</span> inf;</span><br><span class="line">    <span class="type">int</span> flow=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> e=NewT[u];e&amp;&amp;flow&lt;inf;e=Edge[e].next)</span><br><span class="line">    &#123;</span><br><span class="line">        NewT[u]=e;</span><br><span class="line">        <span class="type">int</span> v=Edge[e].to;</span><br><span class="line">        <span class="keyword">if</span>(Fl[v]==Fl[u]+<span class="number">1</span>&amp;&amp;Edge[e].val)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="type">int</span> k=<span class="built_in">Dfs</span>(v,<span class="built_in">min</span>(Edge[e].val,inf-flow));</span><br><span class="line">            <span class="keyword">if</span>(!k) Fl[v]=<span class="number">-1</span>;</span><br><span class="line">            Edge[e].val-=k,Edge[e^<span class="number">1</span>].val+=k;</span><br><span class="line">            flow+=k;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> flow; </span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">Dinic</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> r=<span class="number">0</span>,flow;</span><br><span class="line">    <span class="keyword">while</span>(<span class="built_in">Bfs</span>()) <span class="keyword">while</span>(flow=<span class="built_in">Dfs</span>(S,INF)) r+=flow;</span><br><span class="line">    <span class="keyword">return</span> r;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// freopen(&quot;netflow.in&quot;,&quot;r&quot;,stdin);</span></span><br><span class="line">    <span class="comment">// freopen(&quot;netflow.out&quot;,&quot;w&quot;,stdout);</span></span><br><span class="line">    <span class="built_in">read</span>(M,N);</span><br><span class="line">    S=<span class="number">0</span>,T=N+M+<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>,c;i&lt;=M;++i)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">read</span>(c);</span><br><span class="line">        <span class="built_in">addEdge</span>(S,i,c);</span><br><span class="line">        Tot+=c;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>,c;i&lt;=N;++i)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">read</span>(c);</span><br><span class="line">        <span class="built_in">addEdge</span>(i+M,T,c);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=M;++i)</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">1</span>;j&lt;=N;++j)</span><br><span class="line">            <span class="built_in">addEdge</span>(i,M+j,<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">if</span>(<span class="built_in">Dinic</span>()!=Tot) <span class="built_in">puts</span>(<span class="string">&quot;0&quot;</span>);</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">&quot;1&quot;</span>);</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=M;++i)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> j=Head[i];j;j=Edge[j].next)</span><br><span class="line">                <span class="keyword">if</span>(Edge[j].to&gt;M&amp;&amp;Edge[j].to&lt;=N+M)</span><br><span class="line">                    <span class="keyword">if</span>(!Edge[j].val) <span class="built_in">printf</span>(<span class="string">&quot;%d &quot;</span>,Edge[j].to-M);</span><br><span class="line">            <span class="built_in">puts</span>(<span class="string">&quot;&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">4 5</span></span><br><span class="line"><span class="comment">4 5 3 5</span></span><br><span class="line"><span class="comment">3 5 2 6 4</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure></details><hr><h3 id="汽车加油行驶问题"><a href="#汽车加油行驶问题" class="headerlink" title="汽车加油行驶问题"></a>汽车加油行驶问题</h3><details>    <summary>AC Code Older ver.</summary><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;ctime&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iomanip&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stack&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;map&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> gh() getchar()</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> underMax(x,y) ((x)&gt;(y)?(x):(y))</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> underMin(x,y) ((x)&lt;(y)?(x):(y))</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> LL;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> dx[]=&#123;<span class="number">0</span>,<span class="number">1</span>,<span class="number">-1</span>,<span class="number">0</span>,<span class="number">0</span>&#125;;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> dy[]=&#123;<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">-1</span>&#125;;</span><br><span class="line"><span class="type">const</span> LL INF=<span class="number">0x7f7f7f7f</span>;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">underRead</span><span class="params">(T &amp;x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    x=<span class="number">0</span>;</span><br><span class="line">    <span class="type">char</span> ch=<span class="built_in">gh</span>(),t=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(ch&lt;<span class="string">&#x27;0&#x27;</span>||ch&gt;<span class="string">&#x27;9&#x27;</span>) t|=ch==<span class="string">&#x27;-&#x27;</span>,ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">while</span>(ch&gt;=<span class="string">&#x27;0&#x27;</span>&amp;&amp;ch&lt;=<span class="string">&#x27;9&#x27;</span>) x=x*<span class="number">10</span>+(ch^<span class="number">48</span>),ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">if</span>(t) x=-x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Node</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> x,y,k;</span><br><span class="line">    <span class="built_in">Node</span>(<span class="type">int</span> _x=<span class="number">0</span>,<span class="type">int</span> _y=<span class="number">0</span>,<span class="type">int</span> _k=<span class="number">0</span>):<span class="built_in">x</span>(_x),<span class="built_in">y</span>(_y),<span class="built_in">k</span>(_k)&#123;&#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="type">int</span> N,K;</span><br><span class="line">LL A,B,C,Map[<span class="number">101</span>][<span class="number">101</span>],Dist[<span class="number">101</span>][<span class="number">101</span>][<span class="number">11</span>],Init[<span class="number">101</span>][<span class="number">101</span>][<span class="number">11</span>];</span><br><span class="line"><span class="type">bool</span> Vis[<span class="number">101</span>][<span class="number">101</span>];</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="comment">//  freopen(&quot;car.in&quot;,&quot;r&quot;,stdin);</span></span><br><span class="line"><span class="comment">//  freopen(&quot;car.out&quot;,&quot;w&quot;,stdout);</span></span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d%d%lld%lld%lld&quot;</span>,&amp;N,&amp;K,&amp;A,&amp;B,&amp;C);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=N;++i)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">1</span>;j&lt;=N;++j)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">scanf</span>(<span class="string">&quot;%lld&quot;</span>,&amp;Map[i][j]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">memset</span>(Dist,<span class="number">0x7f7f7f7f</span>,<span class="built_in">sizeof</span>(Dist));</span><br><span class="line">    Dist[<span class="number">1</span>][<span class="number">1</span>][K]=<span class="number">0</span>;</span><br><span class="line">    Init[<span class="number">1</span>][<span class="number">1</span>][K]=<span class="number">1</span>;</span><br><span class="line">    queue&lt;Node&gt;Q;</span><br><span class="line">    Q.<span class="built_in">push</span>(<span class="built_in">Node</span>(<span class="number">1</span>,<span class="number">1</span>,K));</span><br><span class="line">    <span class="keyword">while</span>(!Q.<span class="built_in">empty</span>())</span><br><span class="line">    &#123;</span><br><span class="line">        Node u=Q.<span class="built_in">front</span>();Q.<span class="built_in">pop</span>();</span><br><span class="line">        Init[u.x][u.y][u.k]=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">if</span>(Map[u.x][u.y]&amp;&amp;u.k!=K)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span>(Dist[u.x][u.y][K]&gt;Dist[u.x][u.y][u.k]+A)</span><br><span class="line">            &#123;</span><br><span class="line">                Dist[u.x][u.y][K]=Dist[u.x][u.y][u.k]+A;</span><br><span class="line">                <span class="keyword">if</span>(!Init[u.x][u.y][K])</span><br><span class="line">                &#123;</span><br><span class="line">                    Init[u.x][u.y][K]=<span class="number">1</span>,Q.<span class="built_in">push</span>(<span class="built_in">Node</span>(u.x,u.y,K));</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span>(Dist[u.x][u.y][K]&gt;Dist[u.x][u.y][u.k]+A+C)</span><br><span class="line">            &#123;</span><br><span class="line">                Dist[u.x][u.y][K]=Dist[u.x][u.y][u.k]+A+C;</span><br><span class="line">                <span class="keyword">if</span>(!Init[u.x][u.y][K])</span><br><span class="line">                &#123;</span><br><span class="line">                    Init[u.x][u.y][K]=<span class="number">1</span>,Q.<span class="built_in">push</span>(<span class="built_in">Node</span>(u.x,u.y,K));</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(u.k&gt;<span class="number">0</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> o=<span class="number">1</span>;o&lt;=<span class="number">4</span>;++o)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="type">int</span> nx=u.x+dx[o],ny=u.y+dy[o];</span><br><span class="line">                <span class="keyword">if</span>(nx&lt;<span class="number">1</span>||nx&gt;N||ny&lt;<span class="number">1</span>||ny&gt;N) <span class="keyword">continue</span>;</span><br><span class="line">                LL len=<span class="number">0</span>;</span><br><span class="line">                <span class="keyword">if</span>(nx&lt;u.x||ny&lt;u.y) len=B;</span><br><span class="line">                <span class="keyword">if</span>(Dist[nx][ny][u.k<span class="number">-1</span>]&gt;Dist[u.x][u.y][u.k]+len)</span><br><span class="line">                &#123;</span><br><span class="line">                    Dist[nx][ny][u.k<span class="number">-1</span>]=Dist[u.x][u.y][u.k]+len;</span><br><span class="line">                    <span class="keyword">if</span>(!Init[nx][ny][u.k<span class="number">-1</span>])</span><br><span class="line">                    &#123;</span><br><span class="line">                        Init[nx][ny][u.k<span class="number">-1</span>]=<span class="number">1</span>,Q.<span class="built_in">push</span>(<span class="built_in">Node</span>(nx,ny,u.k<span class="number">-1</span>));</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    LL Ans=INF;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;=K;++i) Ans=<span class="built_in">underMin</span>(Ans,Dist[N][N][i]);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%lld&quot;</span>,Ans);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">9 3 2 3 6</span></span><br><span class="line"><span class="comment">0 0 0 0 1 0 0 0 0</span></span><br><span class="line"><span class="comment">0 0 0 1 0 1 1 0 0</span></span><br><span class="line"><span class="comment">1 0 1 0 0 0 0 1 0</span></span><br><span class="line"><span class="comment">0 0 0 0 0 1 0 0 1</span></span><br><span class="line"><span class="comment">1 0 0 1 0 0 1 0 0</span></span><br><span class="line"><span class="comment">0 1 0 0 0 0 0 1 0</span></span><br><span class="line"><span class="comment">0 0 0 0 1 0 0 0 1</span></span><br><span class="line"><span class="comment">1 0 0 1 0 0 0 1 0</span></span><br><span class="line"><span class="comment">0 1 0 0 0 0 0 0 0</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure></details><hr><h3 id="分配问题"><a href="#分配问题" class="headerlink" title="分配问题"></a>分配问题</h3><p>还是说说建图：</p><ol><li>链接 $S$ 和第 $i$ 个人，容量为 $1$ ，费用为 $0$ ；</li><li>链接 $T$ 和第 $j$ 项工作，容量为 $1$ ，费用为 $0 $ ；</li><li>链接第 $i$ 个人和第 $j$ 项工作，容量为 $1$ ，费用为 $C_{i,j}$ 。</li></ol><p>然后跑一边 $\text{SSP}$ 求出了第一个答案。</p><p>而第二个答案求的应该是最大费用最大流，懒人方法（不改 $\text{Spfa}$ ）再建一个图，费用是第一个图的反费用，跑一边最小费用最大流之后输出费用相反数即可。但记得要把空间开大一点（也不要开得太大）。</p><details>    <summary>AC Code</summary><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;ctime&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iomanip&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stack&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;map&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> gh() getchar()</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> re register</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> ll;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN=<span class="number">8001</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> INF=<span class="number">0x3f3f3f3f</span>;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    x=<span class="number">0</span>;</span><br><span class="line">    <span class="type">char</span> ch=<span class="built_in">gh</span>(),t=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(ch&lt;<span class="string">&#x27;0&#x27;</span>||ch&gt;<span class="string">&#x27;9&#x27;</span>) t|=ch==<span class="string">&#x27;-&#x27;</span>,ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">while</span>(ch&gt;=<span class="string">&#x27;0&#x27;</span>&amp;&amp;ch&lt;=<span class="string">&#x27;9&#x27;</span>) x=(x&lt;&lt;<span class="number">3</span>)+(x&lt;&lt;<span class="number">1</span>)+(ch^<span class="number">48</span>),ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">if</span>(t) x=-x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T,<span class="keyword">class</span> ...T1&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x,T1 &amp;...x1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">read</span>(x),<span class="built_in">read</span>(x1...);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">write</span><span class="params">(T x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(x&lt;<span class="number">0</span>) <span class="built_in">putchar</span>(<span class="string">&#x27;-&#x27;</span>),x=-x;</span><br><span class="line">    <span class="keyword">if</span>(x&gt;<span class="number">9</span>) <span class="built_in">write</span>(x/<span class="number">10</span>);</span><br><span class="line">    <span class="built_in">putchar</span>(x%<span class="number">10</span>+<span class="string">&#x27;0&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">checkMax</span><span class="params">(T &amp;x,T &amp;y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x&lt;y?x=y,<span class="number">1</span>:<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">checkMin</span><span class="params">(T &amp;x,T &amp;y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x&gt;y?x=y,<span class="number">1</span>:<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> N,S,T;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Net</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> next,to,val,cost;</span><br><span class="line">&#125;Edge[MAXN&lt;&lt;<span class="number">1</span>];</span><br><span class="line"><span class="type">int</span> Head[MAXN],Cur[MAXN],Total=<span class="number">1</span>;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">addEdge</span><span class="params">(<span class="type">int</span> u,<span class="type">int</span> v,<span class="type">int</span> w,<span class="type">int</span> c)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Edge[++Total]=(Net)&#123;Head[u],v,w,c&#125;;Head[u]=Total;</span><br><span class="line">    Edge[++Total]=(Net)&#123;Head[v],u,<span class="number">0</span>,-c&#125;;Head[v]=Total;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> Dist[MAXN],ret;</span><br><span class="line"><span class="type">bool</span> Vis[MAXN];</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">Spfa</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">memset</span>(Vis,<span class="number">0</span>,<span class="built_in">sizeof</span>(Vis));</span><br><span class="line">    <span class="built_in">memset</span>(Dist,<span class="number">0x3f</span>,<span class="built_in">sizeof</span>(Dist));</span><br><span class="line">    <span class="built_in">memcpy</span>(Cur,Head,<span class="built_in">sizeof</span>(Head));</span><br><span class="line">    Dist[S]=<span class="number">0</span>,Vis[S]=<span class="number">1</span>;</span><br><span class="line">    std::queue&lt;<span class="type">int</span>&gt;Q;</span><br><span class="line">    Q.<span class="built_in">push</span>(S);</span><br><span class="line">    <span class="keyword">while</span>(!Q.<span class="built_in">empty</span>())</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> u=Q.<span class="built_in">front</span>();Q.<span class="built_in">pop</span>();</span><br><span class="line">        Vis[u]=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> e=Head[u],v;e;e=Edge[e].next)</span><br><span class="line">        &#123;</span><br><span class="line">            v=Edge[e].to;</span><br><span class="line">            <span class="keyword">if</span>(Dist[v]&gt;Dist[u]+Edge[e].cost&amp;&amp;Edge[e].val)</span><br><span class="line">            &#123;</span><br><span class="line">                Dist[v]=Dist[u]+Edge[e].cost;</span><br><span class="line">                <span class="keyword">if</span>(!Vis[v]) Vis[v]=<span class="number">1</span>,Q.<span class="built_in">push</span>(v);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> Dist[T]!=INF;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">Dfs</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> inf)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(x==T) <span class="keyword">return</span> inf;</span><br><span class="line">    Vis[x]=<span class="number">1</span>;</span><br><span class="line">    <span class="type">int</span> flow=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> e=Cur[x],v;e&amp;&amp;flow&lt;inf;e=Edge[e].next)</span><br><span class="line">    &#123;</span><br><span class="line">        v=Edge[e].to,Cur[x]=e;</span><br><span class="line">        <span class="keyword">if</span>(!Vis[v]&amp;&amp;Dist[v]==Dist[x]+Edge[e].cost&amp;&amp;Edge[e].val)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="type">int</span> k=<span class="built_in">Dfs</span>(v,std::<span class="built_in">min</span>(Edge[e].val,inf-flow));</span><br><span class="line">            <span class="keyword">if</span>(k)</span><br><span class="line">            &#123;</span><br><span class="line">                ret+=k*Edge[e].cost;</span><br><span class="line">                Edge[e].val-=k,Edge[e^<span class="number">1</span>].val+=k,flow+=k;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    Vis[x]=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">return</span> flow;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">Dinic_SSP</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> r=<span class="number">0</span>,flow;</span><br><span class="line">    <span class="keyword">while</span>(<span class="built_in">Spfa</span>()) <span class="keyword">while</span>(flow=<span class="built_in">Dfs</span>(S,INF)) r+=flow;</span><br><span class="line">    <span class="keyword">return</span> r;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// freopen(&quot;maxflow-mincost.in&quot;,&quot;r&quot;,stdin);</span></span><br><span class="line">    <span class="comment">// freopen(&quot;maxflow-mincost.out&quot;,&quot;w&quot;,stdout);</span></span><br><span class="line">    <span class="built_in">read</span>(N);</span><br><span class="line">    <span class="keyword">for</span>(re <span class="type">int</span> i=<span class="number">1</span>;i&lt;=N;++i)</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">1</span>,x;j&lt;=N;++j)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">read</span>(x);</span><br><span class="line">            <span class="built_in">addEdge</span>(i,j+N,<span class="number">1</span>,x);</span><br><span class="line">            <span class="built_in">addEdge</span>(i+N+N+N,j+N+N+N+N,<span class="number">1</span>,-x);</span><br><span class="line">        &#125;</span><br><span class="line">    S=<span class="number">0</span>,T=N+N+<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=N;++i) <span class="built_in">addEdge</span>(S,i,<span class="number">1</span>,<span class="number">0</span>),<span class="built_in">addEdge</span>(i+N,T,<span class="number">1</span>,<span class="number">0</span>);</span><br><span class="line">    <span class="built_in">Dinic_SSP</span>();</span><br><span class="line">    <span class="built_in">write</span>(ret),<span class="built_in">puts</span>(<span class="string">&quot;&quot;</span>);</span><br><span class="line">    S=N+N+N,T=N+N+N+N+N+<span class="number">1</span>;ret=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=N;++i) <span class="built_in">addEdge</span>(S,i+N+N+N,<span class="number">1</span>,<span class="number">0</span>),<span class="built_in">addEdge</span>(i+N+N+N+N,T,<span class="number">1</span>,<span class="number">0</span>);</span><br><span class="line">    <span class="built_in">Dinic_SSP</span>();</span><br><span class="line">    <span class="built_in">write</span>(-ret);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">5</span></span><br><span class="line"><span class="comment">2 2 2 1 2</span></span><br><span class="line"><span class="comment">2 3 1 2 4</span></span><br><span class="line"><span class="comment">2 0 1 1 1</span></span><br><span class="line"><span class="comment">2 3 4 3 3</span></span><br><span class="line"><span class="comment">3 2 1 2 1</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure></details><hr><h3 id="运输问题"><a href="#运输问题" class="headerlink" title="运输问题"></a>运输问题</h3><p>有上一道题的经验，就好想多了：</p><ol><li>链接 $S$ 和仓库 $i$ ，容量与费用为 $(a_i,0)$ ；</li><li>链接商店 $j$ 和 $T$ ，容量与费用为 $(b_j,0)$ ；</li><li>链接对应仓库与商店，容量与费用为 $(inf,C_{i,j})$ 。</li></ol><p>因为要求 $\text{mincost-maxflow}$ 和 $\text{maxcost-maxflow}$ 两个问题，依然建两个图之后跑 $\text{SSP}$ 即可。</p><details>    <summary>AC Code</summary><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;ctime&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iomanip&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stack&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;map&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> gh() getchar()</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> re register</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> ll;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN=<span class="number">10001</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXM=<span class="number">20001</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> INF=<span class="number">0x3f3f3f3f</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> Q=<span class="number">5000</span>;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    x=<span class="number">0</span>;</span><br><span class="line">    <span class="type">char</span> ch=<span class="built_in">gh</span>(),t=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(ch&lt;<span class="string">&#x27;0&#x27;</span>||ch&gt;<span class="string">&#x27;9&#x27;</span>) t|=ch==<span class="string">&#x27;-&#x27;</span>,ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">while</span>(ch&gt;=<span class="string">&#x27;0&#x27;</span>&amp;&amp;ch&lt;=<span class="string">&#x27;9&#x27;</span>) x=(x&lt;&lt;<span class="number">3</span>)+(x&lt;&lt;<span class="number">1</span>)+(ch^<span class="number">48</span>),ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">if</span>(t) x=-x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T,<span class="keyword">class</span> ...T1&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x,T1 &amp;...x1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">read</span>(x),<span class="built_in">read</span>(x1...);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">write</span><span class="params">(T x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(x&lt;<span class="number">0</span>) <span class="built_in">putchar</span>(<span class="string">&#x27;-&#x27;</span>),x=-x;</span><br><span class="line">    <span class="keyword">if</span>(x&gt;<span class="number">9</span>) <span class="built_in">write</span>(x/<span class="number">10</span>);</span><br><span class="line">    <span class="built_in">putchar</span>(x%<span class="number">10</span>+<span class="string">&#x27;0&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">checkMax</span><span class="params">(T &amp;x,T &amp;y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x&lt;y?x=y,<span class="number">1</span>:<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">checkMin</span><span class="params">(T &amp;x,T &amp;y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x&gt;y?x=y,<span class="number">1</span>:<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> N,M,S,T,S_b,T_b;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Net</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> next,to,val,cost;</span><br><span class="line">&#125;Edge[MAXM&lt;&lt;<span class="number">1</span>];</span><br><span class="line"><span class="type">int</span> Head[MAXN],Cur[MAXN],Total=<span class="number">1</span>;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">addEdge</span><span class="params">(<span class="type">int</span> u,<span class="type">int</span> v,<span class="type">int</span> w,<span class="type">int</span> c)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Edge[++Total]=(Net)&#123;Head[u],v,w,c&#125;;Head[u]=Total;</span><br><span class="line">    Edge[++Total]=(Net)&#123;Head[v],u,<span class="number">0</span>,-c&#125;;Head[v]=Total;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> Dist[MAXN],ret;</span><br><span class="line"><span class="type">bool</span> Vis[MAXN];</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">Spfa</span><span class="params">(<span class="type">int</span> s,<span class="type">int</span> t)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">memset</span>(Dist,<span class="number">0x3f</span>,<span class="built_in">sizeof</span>(Dist));</span><br><span class="line">    <span class="built_in">memset</span>(Vis,<span class="number">0</span>,<span class="built_in">sizeof</span>(Vis));</span><br><span class="line">    <span class="built_in">memcpy</span>(Cur,Head,<span class="built_in">sizeof</span>(Head));</span><br><span class="line">    Dist[s]=<span class="number">0</span>,Vis[s]=<span class="number">1</span>;</span><br><span class="line">    std::queue&lt;<span class="type">int</span>&gt;Q;</span><br><span class="line">    Q.<span class="built_in">push</span>(s);</span><br><span class="line">    <span class="keyword">while</span>(!Q.<span class="built_in">empty</span>())</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> u=Q.<span class="built_in">front</span>();Q.<span class="built_in">pop</span>();</span><br><span class="line">        Vis[u]=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> e=Head[u],v;e;e=Edge[e].next)</span><br><span class="line">        &#123;</span><br><span class="line">            v=Edge[e].to;</span><br><span class="line">            <span class="keyword">if</span>(Dist[v]&gt;Dist[u]+Edge[e].cost&amp;&amp;Edge[e].val)</span><br><span class="line">            &#123;</span><br><span class="line">                Dist[v]=Dist[u]+Edge[e].cost;</span><br><span class="line">                <span class="keyword">if</span>(!Vis[v]) Vis[v]=<span class="number">1</span>,Q.<span class="built_in">push</span>(v);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> Dist[t]!=INF;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">Dfs</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> inf,<span class="type">int</span> t)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(x==t) <span class="keyword">return</span> inf;</span><br><span class="line">    Vis[x]=<span class="number">1</span>;</span><br><span class="line">    <span class="type">int</span> flow=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> e=Cur[x],v;e&amp;&amp;flow&lt;inf;e=Edge[e].next)</span><br><span class="line">    &#123;</span><br><span class="line">        v=Edge[e].to,Cur[x]=e;</span><br><span class="line">        <span class="keyword">if</span>(!Vis[v]&amp;&amp;Dist[v]==Dist[x]+Edge[e].cost&amp;&amp;Edge[e].val)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="type">int</span> k=<span class="built_in">Dfs</span>(v,std::<span class="built_in">min</span>(Edge[e].val,inf-flow),t);</span><br><span class="line">            <span class="keyword">if</span>(k)</span><br><span class="line">            &#123;</span><br><span class="line">                ret+=k*Edge[e].cost;</span><br><span class="line">                Edge[e].val-=k,Edge[e^<span class="number">1</span>].val+=k,flow+=k;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    Vis[x]=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">return</span> flow;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">SSP</span><span class="params">(<span class="type">int</span> s,<span class="type">int</span> t)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> r=<span class="number">0</span>,flow;</span><br><span class="line">    <span class="keyword">while</span>(<span class="built_in">Spfa</span>(s,t)) <span class="keyword">while</span>(flow=<span class="built_in">Dfs</span>(s,INF,t)) r+=flow;</span><br><span class="line">    <span class="keyword">return</span> r;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// freopen(&quot;mcmf.in&quot;,&quot;r&quot;,stdin);</span></span><br><span class="line">    <span class="comment">// freopen(&quot;mcmf.out&quot;,&quot;w&quot;,stdout);</span></span><br><span class="line">    <span class="built_in">read</span>(N,M);</span><br><span class="line">    S=<span class="number">0</span>,T=N+M+<span class="number">1</span>;</span><br><span class="line">    S_b=Q,T_b=N+M+Q+<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>,x;i&lt;=N;++i) <span class="built_in">read</span>(x),<span class="built_in">addEdge</span>(S,i,x,<span class="number">0</span>),<span class="built_in">addEdge</span>(S_b,i+Q,x,<span class="number">0</span>);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>,x;i&lt;=M;++i) <span class="built_in">read</span>(x),<span class="built_in">addEdge</span>(i+N,T,x,<span class="number">0</span>),<span class="built_in">addEdge</span>(i+N+Q,T_b,x,<span class="number">0</span>);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=N;++i)</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">1</span>,x;j&lt;=M;++j)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">read</span>(x);<span class="built_in">addEdge</span>(i,j+N,INF,x);<span class="built_in">addEdge</span>(i+Q,j+N+Q,INF,-x);</span><br><span class="line">        &#125;</span><br><span class="line">    <span class="built_in">SSP</span>(S,T);</span><br><span class="line">    <span class="built_in">write</span>(ret),<span class="built_in">puts</span>(<span class="string">&quot;&quot;</span>);</span><br><span class="line">    ret=<span class="number">0</span>;</span><br><span class="line">    <span class="built_in">SSP</span>(S_b,T_b);</span><br><span class="line">    <span class="built_in">write</span>(-ret);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">2 3</span></span><br><span class="line"><span class="comment">220 280</span></span><br><span class="line"><span class="comment">170 120 210</span></span><br><span class="line"><span class="comment">77 39 105</span></span><br><span class="line"><span class="comment">150 186 122</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure></details><hr><h3 id="负载平衡问题"><a href="#负载平衡问题" class="headerlink" title="负载平衡问题"></a>负载平衡问题</h3><details>    <summary>AC Code 贪心算法</summary><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;ctime&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iomanip&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stack&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;map&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> gh() getchar()</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> underMax(x,y) ((x)&gt;(y)?(x):(y))</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> underMin(x,y) ((x)&lt;(y)?(x):(y))</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> LL;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">underRead</span><span class="params">(T &amp;x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    x=<span class="number">0</span>;</span><br><span class="line">    <span class="type">char</span> ch=<span class="built_in">gh</span>(),t=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(ch&lt;<span class="string">&#x27;0&#x27;</span>||ch&gt;<span class="string">&#x27;9&#x27;</span>) t|=ch==<span class="string">&#x27;-&#x27;</span>,ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">while</span>(ch&gt;=<span class="string">&#x27;0&#x27;</span>&amp;&amp;ch&lt;=<span class="string">&#x27;9&#x27;</span>) x=x*<span class="number">10</span>+(ch^<span class="number">48</span>),ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">if</span>(t) x=-x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> N,Tot=<span class="number">0</span>,Num[<span class="number">10001</span>],Back[<span class="number">10001</span>];</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">underAbs</span><span class="params">(<span class="type">int</span> x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (x&gt;<span class="number">0</span>?x:-x);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="comment">//  freopen(&quot;net.in&quot;,&quot;r&quot;,stdin);</span></span><br><span class="line"><span class="comment">//  freopen(&quot;net.out&quot;,&quot;w&quot;,stdout);</span></span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;N);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=N;++i)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;Num[i]);</span><br><span class="line">        Tot+=Num[i];</span><br><span class="line">    &#125;</span><br><span class="line">    Tot/=N;</span><br><span class="line">    <span class="type">int</span> Ans=<span class="number">1e9</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=N;++i)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> w=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">1</span>;j&lt;=N;++j)</span><br><span class="line">        &#123;</span><br><span class="line">            Back[j]=Num[j];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">1</span>;j&lt;=N<span class="number">-1</span>;++j)</span><br><span class="line">        &#123;</span><br><span class="line">            w+=<span class="built_in">underAbs</span>(Back[(i+j)%N+<span class="number">1</span>]-Tot);</span><br><span class="line">            Back[(i+j+<span class="number">1</span>)%N+<span class="number">1</span>]+=Back[(i+j)%N+<span class="number">1</span>]-Tot;</span><br><span class="line">            Back[(i+j)%N+<span class="number">1</span>]=Tot;</span><br><span class="line">        &#125;</span><br><span class="line">        Ans=<span class="built_in">underMin</span>(Ans,w);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d&quot;</span>,Ans);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">5</span></span><br><span class="line"><span class="comment">17 9 14 16 4</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure></details><details>    <summary>AC Code Netflow</summary><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;ctime&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iomanip&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stack&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;map&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> gh() getchar()</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> re register</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> ll;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN=<span class="number">5e3</span>+<span class="number">1</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXM=<span class="number">1e5</span>+<span class="number">1</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> INF=<span class="number">0x3f3f3f3f</span>;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    x=<span class="number">0</span>;</span><br><span class="line">    <span class="type">char</span> ch=<span class="built_in">gh</span>(),t=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(ch&lt;<span class="string">&#x27;0&#x27;</span>||ch&gt;<span class="string">&#x27;9&#x27;</span>) t|=ch==<span class="string">&#x27;-&#x27;</span>,ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">while</span>(ch&gt;=<span class="string">&#x27;0&#x27;</span>&amp;&amp;ch&lt;=<span class="string">&#x27;9&#x27;</span>) x=(x&lt;&lt;<span class="number">3</span>)+(x&lt;&lt;<span class="number">1</span>)+(ch^<span class="number">48</span>),ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">if</span>(t) x=-x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T,<span class="keyword">class</span> ...T1&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x,T1 &amp;...x1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">read</span>(x),<span class="built_in">read</span>(x1...);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">checkMax</span><span class="params">(T &amp;x,T &amp;y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x&lt;y?x=y,<span class="number">1</span>:<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">checkMin</span><span class="params">(T &amp;x,T &amp;y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x&gt;y?x=y,<span class="number">1</span>:<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> N,M,S,T;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Net</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> next,to,val,cost;</span><br><span class="line">    <span class="built_in">Net</span>(<span class="type">int</span> n=<span class="number">0</span>,<span class="type">int</span> t=<span class="number">0</span>,<span class="type">int</span> v=<span class="number">0</span>,<span class="type">int</span> c=<span class="number">0</span>):</span><br><span class="line">        <span class="built_in">next</span>(n),<span class="built_in">to</span>(t),<span class="built_in">val</span>(v),<span class="built_in">cost</span>(c)&#123;&#125;</span><br><span class="line">&#125;Edge[MAXM&lt;&lt;<span class="number">1</span>];</span><br><span class="line"><span class="type">int</span> Head[MAXN],Cur[MAXN],Total=<span class="number">1</span>;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">addEdge</span><span class="params">(<span class="type">int</span> u,<span class="type">int</span> v,<span class="type">int</span> w,<span class="type">int</span> c)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Edge[++Total]=<span class="built_in">Net</span>(Head[u],v,w,c);Head[u]=Total;</span><br><span class="line">    Edge[++Total]=<span class="built_in">Net</span>(Head[v],u,<span class="number">0</span>,-c);Head[v]=Total;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> Dist[MAXN],ret;</span><br><span class="line"><span class="type">bool</span> Vis[MAXN];</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">Spfa</span><span class="params">(<span class="type">int</span> s,<span class="type">int</span> t)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">memset</span>(Dist,<span class="number">0x3f</span>,<span class="built_in">sizeof</span>(Dist));</span><br><span class="line">    <span class="built_in">memcpy</span>(Cur,Head,<span class="built_in">sizeof</span>(Head));</span><br><span class="line">    queue&lt;<span class="type">int</span>&gt;Q;</span><br><span class="line">    Q.<span class="built_in">push</span>(s),Dist[s]=<span class="number">0</span>,Vis[s]=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span>(!Q.<span class="built_in">empty</span>())</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> u=Q.<span class="built_in">front</span>();Q.<span class="built_in">pop</span>();</span><br><span class="line">        Vis[u]=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> e=Head[u];e;e=Edge[e].next)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="type">int</span> v=Edge[e].to;</span><br><span class="line">            <span class="keyword">if</span>(Edge[e].val&amp;&amp;Dist[v]&gt;Dist[u]+Edge[e].cost)</span><br><span class="line">            &#123;</span><br><span class="line">                Dist[v]=Dist[u]+Edge[e].cost;</span><br><span class="line">                <span class="keyword">if</span>(!Vis[v]) Q.<span class="built_in">push</span>(v),Vis[v]=<span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> Dist[t]!=INF;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">Dfs</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> inf)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(x==T) <span class="keyword">return</span> inf;</span><br><span class="line">    Vis[x]=<span class="number">1</span>;</span><br><span class="line">    <span class="type">int</span> flow=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> e=Cur[x];e&amp;&amp;flow&lt;inf;e=Edge[e].next)</span><br><span class="line">    &#123;</span><br><span class="line">        Cur[x]=e;</span><br><span class="line">        <span class="type">int</span> v=Edge[e].to;</span><br><span class="line">        <span class="keyword">if</span>(!Vis[v]&amp;&amp;Edge[e].val&amp;&amp;Dist[v]==Dist[x]+Edge[e].cost)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="type">int</span> k=<span class="built_in">Dfs</span>(v,<span class="built_in">min</span>(Edge[e].val,inf-flow));</span><br><span class="line">            <span class="keyword">if</span>(k)</span><br><span class="line">            &#123;</span><br><span class="line">                ret+=k*Edge[e].cost;</span><br><span class="line">                Edge[e].val-=k,Edge[e^<span class="number">1</span>].val+=k,flow+=k;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    Vis[x]=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">return</span> flow;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">Dinic</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> res=<span class="number">0</span>,flow;</span><br><span class="line">    <span class="keyword">while</span>(<span class="built_in">Spfa</span>(S,T)) <span class="keyword">while</span>(flow=<span class="built_in">Dfs</span>(S,INF)) res+=flow;</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> Val[MAXN],SumV;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// freopen(&quot;mincost-maxflow.in&quot;,&quot;r&quot;,stdin);</span></span><br><span class="line">    <span class="comment">// freopen(&quot;mincost-maxflow.out&quot;,&quot;w&quot;,stdout);</span></span><br><span class="line">    <span class="built_in">read</span>(N);</span><br><span class="line">    S=<span class="number">0</span>,T=N+N+<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=N;++i) <span class="built_in">read</span>(Val[i]),SumV+=Val[i];</span><br><span class="line">    SumV/=N;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=N;++i) Val[i]-=SumV;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=N;++i)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(Val[i]&gt;<span class="number">0</span>) <span class="built_in">addEdge</span>(S,i,Val[i],<span class="number">0</span>);</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(Val[i]&lt;<span class="number">0</span>) <span class="built_in">addEdge</span>(i,T,-Val[i],<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=N;++i)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(i!=<span class="number">1</span>) <span class="built_in">addEdge</span>(i,i<span class="number">-1</span>,INF,<span class="number">1</span>);</span><br><span class="line">        <span class="keyword">if</span>(i!=N) <span class="built_in">addEdge</span>(i,i+<span class="number">1</span>,INF,<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">addEdge</span>(<span class="number">1</span>,N,INF,<span class="number">1</span>),<span class="built_in">addEdge</span>(N,<span class="number">1</span>,INF,<span class="number">1</span>);</span><br><span class="line">    <span class="type">int</span> ans=<span class="built_in">Dinic</span>();</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d&quot;</span>,ret);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">5</span></span><br><span class="line"><span class="comment">17 9 14 16 4</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure></details><hr>]]></content>
      
      
      <categories>
          
          <category> 学习笔记 </category>
          
          <category> OI </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 图论 </tag>
            
            <tag> 建图 </tag>
            
            <tag> 构造 </tag>
            
            <tag> 网络流 </tag>
            
            <tag> 最大流 </tag>
            
            <tag> Dinic </tag>
            
            <tag> 流 </tag>
            
            <tag> 增广路 </tag>
            
            <tag> 网络 </tag>
            
            <tag> 最小费用最大流 </tag>
            
            <tag> 最小割 </tag>
            
            <tag> 网络流24题 </tag>
            
            <tag> 上下界网络流 </tag>
            
            <tag> ISAP </tag>
            
            <tag> 预流推进 </tag>
            
            <tag> MPM </tag>
            
            <tag> EK </tag>
            
            <tag> HLPP </tag>
            
            <tag> 二分图 </tag>
            
            <tag> 二分匹配 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>计算几何</title>
      <link href="/Eternity/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/OI/computational-geometry/"/>
      <url>/Eternity/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/OI/computational-geometry/</url>
      
        <content type="html"><![CDATA[<p>“平面的向量交错生长，织成，忧伤的网。——《膜你抄》”</p><span id="more"></span><h2 id="浮点数-x-定点数"><a href="#浮点数-x-定点数" class="headerlink" title="浮点数 x 定点数"></a>浮点数 x 定点数</h2><p><a href="https://zhuanlan.zhihu.com/p/338588296">定点数详解</a>。</p><p><a href="https://zhuanlan.zhihu.com/p/339949186">浮点数详解</a>。</p><p>总而言之，浮点数表示为：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">V=(-1)^S*M*R^E</span><br></pre></td></tr></table></figure><p>其中各个变量的含义如下：</p><ul><li>S：符号位，取值 $0$ 或 $1$，决定一个数字的符号，$0$ 表示正，$1$ 表示负</li><li>M：尾数，用小数表示，例如前面所看到的 $8.345 \times 10^0$，$8.345$ 就是尾数</li><li>R：基数，表示十进制数 $R$ 就是 $10$，表示二进制数 $R$ 就是 $2$</li><li>E：指数，用整数表示，例如前面看到的 $10^{-1}$，$-1$ 即是指数</li></ul><h3 id="精度处理"><a href="#精度处理" class="headerlink" title="精度处理"></a>精度处理</h3><p>一般来说，计算机中存储一个数采用的是二进制，一个 $n$ 位整数将被表示为：</p><p>$x = \sum_{i = 0}^{n - 1} v_i \times 2^{i}$ </p><p>如果是小数，上述公式仍然适用，只是将 $i$ 的范围由 $\mathbb{N}$ 扩大至 $\mathbb{Z}$，但由于 $2$ 的幂与 $10$ 的幂不同，一些 $10$ 进制下的有限小数会变成无限小数，而计算机能够存储的东西是有限的，因此得到的浮点数只是一个近似值。<strong>因此，在做有关浮点数的操作时，一定要考虑精度问题。</strong></p><h3 id="处理浮点数的精度问题"><a href="#处理浮点数的精度问题" class="headerlink" title="处理浮点数的精度问题"></a>处理浮点数的精度问题</h3><p>定义精度，<code>EPS</code> 指希腊字母 $\epsilon$：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">const</span> <span class="type">double</span> EPS = <span class="number">1e-4</span>;</span><br></pre></td></tr></table></figure><p>比较大小，求一个数的正负时要考虑在精度范围内认为两个数相等：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">sign</span><span class="params">(<span class="type">double</span> x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(std::<span class="built_in">fabs</span>(x)&lt;EPS) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span>(x&lt;<span class="number">0</span>) <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">comp</span><span class="params">(<span class="type">double</span> x,<span class="type">double</span> y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(std::<span class="built_in">fabs</span>(x-y)&lt;EPS) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span>(x&lt;y) <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="向量"><a href="#向量" class="headerlink" title="向量"></a>向量</h2><h3 id="表示"><a href="#表示" class="headerlink" title="表示"></a>表示</h3><p>一般而言，将一个向量表示成一个坐标，如 $t=\left(^3_2\right)$ ，则表示一个向量的起点为 $(0,0)$ ，终点是 $(3,2)$ 。如图：</p><p><img src="https://cdn.luogu.com.cn/upload/image_hosting/rgh3mje3.png" alt="img"></p><h3 id="加减法则"><a href="#加减法则" class="headerlink" title="加减法则"></a>加减法则</h3><p>直接加减即可，对于向量 $a=\left(^{x_1}_{y_1}\right),b=\left(^{x_2}_{y_2}\right)$ 有：</p><p>$\vec a\pm \vec b=(x_1\pm x_2,y_1\pm y_2)$</p><h3 id="乘除法则"><a href="#乘除法则" class="headerlink" title="乘除法则"></a>乘除法则</h3><h4 id="数乘"><a href="#数乘" class="headerlink" title="数乘"></a>数乘</h4><p>指的是一个实数（标量）乘上一个向量，即将该向量延长该实数倍即可。</p><h4 id="点乘"><a href="#点乘" class="headerlink" title="点乘"></a>点乘</h4><p>$\vec a\cdot\vec b=|\vec a||\vec b|\cos \theta$ 。</p><p>$(x_1,y_1)\cdot(x_2,y_2)=x_1x_2+y_1y_2$</p><p>几何意义：$\vec a$ 在 $\vec b$ 上的投影长度与 $\vec b$ 的长度的积。</p><h4 id="叉乘"><a href="#叉乘" class="headerlink" title="叉乘"></a>叉乘</h4><p><strong>不满足交换律，满足结合律。</strong></p><p>$|\vec a\times\vec b|=|\vec a||\vec b|\sin\theta$</p><p>$\vec a\times\vec b=-(\vec b\times\vec a)$</p><p>坐标表示：$(x_1,y_1)\times(x_2,y_2)=x_1y_2-x_2y_1$</p><p>几何意义：$\vec{a}$ 与 $\vec{b}$ 形成的平行四边形的有向面积（$\theta$ 带符号），$\vec{a}$ 逆时针转到 $\vec{b}$ 为正。</p><h3 id="代码实现-风格指导Rusun"><a href="#代码实现-风格指导Rusun" class="headerlink" title="代码实现(风格指导Rusun)"></a>代码实现(风格指导Rusun)</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//重载运算符实现</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Vector</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">double</span> x,y;<span class="comment">//用坐标表示向量</span></span><br><span class="line">    Vector <span class="keyword">operator</span>+(Vector a)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> (Vector)&#123;x+a.x,y+a.y&#125;;</span><br><span class="line">&#125;<span class="comment">//加法</span></span><br><span class="line">    Vector <span class="keyword">operator</span>-(<span class="type">const</span> Vector &amp;a)<span class="type">const</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> (Vector)&#123;x-a.x,y-a.y&#125;</span><br><span class="line">    &#125;<span class="comment">//减法，那2个const和那个&amp;都是卡常用的。</span></span><br><span class="line">    Vector <span class="keyword">operator</span>*(<span class="type">const</span> <span class="type">double</span> &amp;a)<span class="type">const</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">return</span> (Vector)&#123;x*a,y*a&#125;;</span><br><span class="line">    &#125;<span class="comment">//数乘</span></span><br><span class="line">    Vector <span class="keyword">operator</span>/(<span class="type">const</span> <span class="type">double</span> &amp;a)<span class="type">const</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span>(Vector)&#123;x/a,y/a&#125;;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">double</span> <span class="keyword">operator</span>^(<span class="type">const</span> Vector &amp;a)<span class="type">const</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> x*a.x+y*a.y;</span><br><span class="line">&#125;<span class="comment">//点乘</span></span><br><span class="line">    <span class="type">double</span> <span class="keyword">operator</span>&amp;(<span class="type">const</span> Vector &amp;a)<span class="type">const</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> x*a.y-a.x*y;</span><br><span class="line">    &#125;<span class="comment">//叉乘</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="代码实现-风格指导PigAunt"><a href="#代码实现-风格指导PigAunt" class="headerlink" title="代码实现(风格指导PigAunt)"></a>代码实现(风格指导PigAunt)</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//用函数实现</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Point</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">double</span> x,y;</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    省略加减和数乘。</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="function"><span class="type">double</span> <span class="title">dot</span><span class="params">(Point a,Point b)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> a.x*b.x+a.y*b.y;</span><br><span class="line">    &#125;<span class="comment">//点积</span></span><br><span class="line">    <span class="function"><span class="type">double</span> <span class="title">cross</span><span class="params">(Point a,Point b)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line"><span class="keyword">return</span> a.x*b.y-a.y*b.x;</span><br><span class="line">    &#125;<span class="comment">//叉积</span></span><br><span class="line">    <span class="function"><span class="type">double</span> <span class="title">getLength</span><span class="params">(Point a)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="built_in">sqrt</span>(<span class="built_in">dot</span>(a,a));</span><br><span class="line">    &#125;<span class="comment">//取模</span></span><br><span class="line">    <span class="comment">//因为a·a=|a|^2，所以会这样。</span></span><br><span class="line">    <span class="function"><span class="type">double</span> <span class="title">getAngle</span><span class="params">(Point a,Point b)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">acos</span>(<span class="built_in">dot</span>(a,b)/<span class="built_in">getLength</span>(a)/<span class="built_in">getLength</span>(b));</span><br><span class="line">    &#125;<span class="comment">//计算向量夹角</span></span><br><span class="line">    <span class="comment">//a·b=|a||b|sinx</span></span><br><span class="line">    <span class="comment">//x=arccos(a·b/(|a||b|))</span></span><br><span class="line">    <span class="function"><span class="type">double</span> <span class="title">area</span><span class="params">(Point a,Point b,Point c)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">cross</span>(b-a,c-a);</span><br><span class="line">    &#125;<span class="comment">//求向量构成的平行四边形有向面积（分正负）</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="点与直线"><a href="#点与直线" class="headerlink" title="点与直线"></a>点与直线</h2><h3 id="直线表达"><a href="#直线表达" class="headerlink" title="直线表达"></a>直线表达</h3><ol><li>点斜式：$ax+by+c=0$</li><li>点向式：$p_0+vt$</li><li>斜截式：$y=kx+b$</li></ol><p><strong>点向式</strong>中，$p=(x_0,y_0)$ 是直线上的一个点，而 $v=\left(^{x_v}_{y_v}\right)$ 是该直线上的一个向量，那么这个直线上的任意一个点都可以用 $p+vt,t\in \mathbb R$ 表示。</p><h3 id="代码实现"><a href="#代码实现" class="headerlink" title="代码实现"></a>代码实现</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">Point</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">double</span> x,y;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">沿用PigAunt的代码风格</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">    <span class="comment">//假设一条直线AB，判断点C是否在AB上，则有ACxBC=0</span></span><br><span class="line">    <span class="function">Point <span class="title">getLineIntersection</span><span class="params">(Point p,Vector v,Point q,Vector w)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        Vector u=p-q;</span><br><span class="line">        <span class="type">double</span> t=<span class="built_in">cross</span>(w,u)/<span class="built_in">cross</span>(v,w);</span><br><span class="line">        <span class="keyword">return</span> p+v*t;</span><br><span class="line">    &#125;<span class="comment">//求直线交点，cross(v,w)=0则两直线平行（重合）。</span></span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="凸包"><a href="#凸包" class="headerlink" title="凸包"></a>凸包</h2><h3 id="最小周长值"><a href="#最小周长值" class="headerlink" title="最小周长值"></a>最小周长值</h3><p>对于一大堆点，我们需要确定一个多边形，使所有点都在多边形内（可以在边上），使得这个多边形周长最短，这就是这个<strong>凸包</strong>。凸包的应用典型就是<a href="https://violeteternal.github.io/Eternity/学习笔记/OI/dp-convex-hull-optimization/"><strong>斜率优化</strong></a></p><h3 id="Andrew-算法"><a href="#Andrew-算法" class="headerlink" title="Andrew 算法"></a>Andrew 算法</h3><p>先给所有点以 $x$ 为第一关键字，$y$ 为第二关键字从小到大排序；然后扫描每个点，看这个点加入后能不能打破原来凸包的性质，如果能，就把原来的点删了；然后将新的点加入。从左往右做一次，我们得到一个上凸壳；从右往左再做一次，我们就得到了一个凸包（已加入的点不再加入），使用向量叉积判断。</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">andrew</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    std::<span class="built_in">sort</span>(p+<span class="number">1</span>,p+<span class="number">1</span>+cnt);</span><br><span class="line">    <span class="type">int</span> top=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=cnt;++i)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">while</span>(top&gt;=<span class="number">2</span>&amp;&amp;<span class="built_in">area</span>(p[stk[top<span class="number">-1</span>]],p[stk[top]],p[i])&lt;=<span class="number">0</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span>(<span class="built_in">area</span>(p[stk[top<span class="number">-1</span>]],p[stk[top]],p[i])&lt;<span class="number">0</span>) use[stk[top--]]=<span class="number">0</span>;</span><br><span class="line">            <span class="keyword">else</span> --top;</span><br><span class="line">        &#125;</span><br><span class="line">        stk[++top]=i;</span><br><span class="line">        use[i]=<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    use[<span class="number">1</span>]=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=cnt;i&gt;=<span class="number">1</span>;--i)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(use[i]) <span class="keyword">continue</span>;</span><br><span class="line">        <span class="keyword">while</span>(top&gt;=<span class="number">2</span>&amp;&amp;<span class="built_in">area</span>(p[stk[top<span class="number">-1</span>]],p[stk[top]],p[i])&lt;<span class="number">0</span>) --top;</span><br><span class="line">        <span class="comment">//这里不能取0，是为了应对共线的情况。</span></span><br><span class="line">        stk[++top]=i;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="练习"><a href="#练习" class="headerlink" title="练习"></a>练习</h3><p><a href="https://www.luogu.com.cn/problem/P3829">洛谷信用卡凸包</a></p><p>就类似于小学做过的一类题，一个多边形周长加上一个圆的周长。将题目给出的数据转化为定点，然后就是凸包的裸题了。补充一个向量旋转的公式：</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">inline</span> Point <span class="title">rotate</span><span class="params">(Point a,<span class="type">double</span> alph)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;a.x*<span class="built_in">cos</span>(alph)+a.y*<span class="built_in">sin</span>(alph),-a.x*<span class="built_in">sin</span>(alph)+a.y*<span class="built_in">cos</span>(alph)&#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Talk is<font style="color:white">n’t</font> cheap,<font style="color:white">don’t </font>show me the Code:</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;ctime&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iomanip&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stack&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;map&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> gh() getchar()</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> re register</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> db double</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> ll;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN=<span class="number">4e4</span>+<span class="number">1</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> dx[]=&#123;<span class="number">0</span>,<span class="number">1</span>,<span class="number">-1</span>,<span class="number">1</span>,<span class="number">-1</span>&#125;;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> dy[]=&#123;<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">-1</span>,<span class="number">-1</span>&#125;;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    x=<span class="number">0</span>;</span><br><span class="line">    <span class="type">char</span> ch=<span class="built_in">gh</span>(),t=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(ch&lt;<span class="string">&#x27;0&#x27;</span>||ch&gt;<span class="string">&#x27;9&#x27;</span>) t|=ch==<span class="string">&#x27;-&#x27;</span>,ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">while</span>(ch&gt;=<span class="string">&#x27;0&#x27;</span>&amp;&amp;ch&lt;=<span class="string">&#x27;9&#x27;</span>) x=(x&lt;&lt;<span class="number">3</span>)+(x&lt;&lt;<span class="number">1</span>)+(ch^<span class="number">48</span>),ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">if</span>(t) x=-x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T,<span class="keyword">class</span> ...T1&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x,T1 &amp;...x1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">read</span>(x),<span class="built_in">read</span>(x1...);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">checkMax</span><span class="params">(T &amp;x,T &amp;y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x&lt;y?x=y,<span class="number">1</span>:<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">checkMin</span><span class="params">(T &amp;x,T &amp;y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x&gt;y?x=y,<span class="number">1</span>:<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> N,cnt;</span><br><span class="line"><span class="type">double</span> len,wid,rth;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Point</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">double</span> x,y;</span><br><span class="line">    Point <span class="keyword">operator</span>-(<span class="type">const</span> Point &amp;a)<span class="type">const</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> &#123;x-a.x,y-a.y&#125;;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">Point</span>(<span class="type">double</span> x=<span class="number">0</span>,<span class="type">double</span> y=<span class="number">0</span>):<span class="built_in">x</span>(x),<span class="built_in">y</span>(y)&#123;&#125;</span><br><span class="line">&#125;Pt[MAXN],centre[MAXN];</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">double</span> <span class="title">cross</span><span class="params">(Point a,Point b)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> a.x*b.y-a.y*b.x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">double</span> <span class="title">area</span><span class="params">(Point a,Point b,Point c)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">cross</span>(b-a,c-a);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> Point <span class="title">rotate</span><span class="params">(Point a,<span class="type">double</span> alph)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;a.x*<span class="built_in">cos</span>(alph)+a.y*<span class="built_in">sin</span>(alph),-a.x*<span class="built_in">sin</span>(alph)+a.y*<span class="built_in">cos</span>(alph)&#125;;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">double</span> theta[MAXN];</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">init</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=N;++i)</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> k=<span class="number">1</span>;k&lt;=<span class="number">4</span>;++k)</span><br><span class="line">        &#123;</span><br><span class="line">            Point dis=<span class="built_in">rotate</span>(&#123;dx[k]*len,dy[k]*wid&#125;,-theta[i]);</span><br><span class="line">            Pt[++cnt]=<span class="built_in">Point</span>(centre[i].x+dis.x,centre[i].y+dis.y);</span><br><span class="line">        &#125;</span><br><span class="line">    <span class="comment">// for(int i=1;i&lt;=cnt;++i) printf(&quot;%.2lf %.2lf\n&quot;,Pt[i].x,Pt[i].y);</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> stk[MAXN&lt;&lt;<span class="number">1</span>],top;</span><br><span class="line"><span class="type">bool</span> used[MAXN];</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">cmp</span><span class="params">(Point a,Point b)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(a.x==b.x) <span class="keyword">return</span> a.y&lt;b.y;</span><br><span class="line">    <span class="keyword">return</span> a.x&lt;b.x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">double</span> <span class="title">getDist</span><span class="params">(Point a,Point b)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> std::<span class="built_in">sqrt</span>((a.x-b.x)*(a.x-b.x)+(a.y-b.y)*(a.y-b.y));</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">andrew</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    std::<span class="built_in">sort</span>(Pt+<span class="number">1</span>,Pt+<span class="number">1</span>+cnt,cmp);</span><br><span class="line">    top=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=cnt;++i)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">while</span>(top&gt;=<span class="number">2</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="type">double</span> res=<span class="built_in">area</span>(Pt[stk[top<span class="number">-1</span>]],Pt[stk[top]],Pt[i]);</span><br><span class="line">            <span class="keyword">if</span>(res&lt;<span class="number">0</span>) used[stk[top--]]=<span class="number">0</span>;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span>(res==<span class="number">0</span>) --top;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        stk[++top]=i;</span><br><span class="line">        used[i]=<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    used[<span class="number">1</span>]=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=cnt;i&gt;=<span class="number">1</span>;--i)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(used[i]) <span class="keyword">continue</span>;</span><br><span class="line">        <span class="keyword">while</span>(top&gt;=<span class="number">2</span>&amp;&amp;<span class="built_in">area</span>(Pt[stk[top<span class="number">-1</span>]],Pt[stk[top]],Pt[i])&lt;<span class="number">0</span>) --top;</span><br><span class="line">        stk[++top]=i;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">double</span> res=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">2</span>;i&lt;=top;++i) res+=<span class="built_in">getDist</span>(Pt[stk[i<span class="number">-1</span>]],Pt[stk[i]]);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%.2lf&quot;</span>,res+(<span class="number">2</span>*rth*<span class="built_in">acos</span>(<span class="number">-1</span>)));</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// freopen(&quot;geo.in&quot;,&quot;r&quot;,stdin);</span></span><br><span class="line">    <span class="comment">// freopen(&quot;geo.out&quot;,&quot;w&quot;,stdout);</span></span><br><span class="line">    <span class="built_in">read</span>(N);</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%lf%lf%lf&quot;</span>,&amp;wid,&amp;len,&amp;rth);</span><br><span class="line">    wid=(wid<span class="number">-2</span>*rth)/<span class="number">2</span>;</span><br><span class="line">    len=(len<span class="number">-2</span>*rth)/<span class="number">2</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=N;++i) <span class="built_in">scanf</span>(<span class="string">&quot;%lf%lf%lf&quot;</span>,&amp;centre[i].x,&amp;centre[i].y,&amp;theta[i]);</span><br><span class="line">    <span class="built_in">init</span>();</span><br><span class="line">    <span class="built_in">andrew</span>();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">2</span></span><br><span class="line"><span class="comment">6.0 2.0 0.0</span></span><br><span class="line"><span class="comment">0.0 0.0 0.0</span></span><br><span class="line"><span class="comment">2.0 -2.0 1.5707963268</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><hr><h2 id="旋转卡壳"><a href="#旋转卡壳" class="headerlink" title="旋转卡壳"></a>旋转卡壳</h2><p>这玩意儿居然有 $2\times2\times2\times3=24$ 种读法。</p><p>正确读法：$\text{旋}(xu\acute{a}n)\text{转}(zhu\grave an)\text{卡}(qi\check a)\text{壳}(qi\grave ao)$</p><h3 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h3><p>对于一个凸包，其直径则是该凸包内两点的最大距离。可以证明：<strong>这两个点必定在凸包上（边上）</strong>。旋转卡壳则是一种求凸包直径的算法。</p><p>那么，为什么会叫旋转卡壳呢？</p><p>扩句：</p><p>用两条互相平行的直线进行（旋转）并（卡）住凸包形成<strong>对踵点</strong>的（壳）并计算。</p><p>所谓对踵点，就是一组点是当前这两条直线卡住凸包（与凸包相切）的那两个点组成的点对，则是一组对踵点。（可以证明，对于任意一个点，与其组成对踵点的点不超过 $3$ 个，那么对踵点不会超过 $3n$ 个，对踵点对也就不会超过 $\frac{3n}{2}$ 个）</p><p><img src="https://oi-wiki.org/geometry/images/rotating-calipers1.png" alt="img"></p><h3 id="计算"><a href="#计算" class="headerlink" title="计算"></a>计算</h3><p>实际上，因为角度是一个区间，内有无数个数，所以让计算机去模拟旋转是不可能的，只会 $TLE$ 到飞起。而我们也会发现，真正有效的只会是当一条旋转直线与凸包的某条边平行时，才会去计算，所谓的旋转卡壳，实际上只是让人脑能够理解罢了。</p><p><img src="https://s3.bmp.ovh/imgs/2022/01/1b0d136e72e18544.gif" alt="img"></p><p>首先使用任何一种凸包算法求出给定所有点的凸包，有着最长距离的点对一定在凸包上。而由于凸包的形状，我们发现，逆时针地遍历凸包上的边，对于每条边都找到离这条边最远的点，那么这时随着边的转动，对应的最远点也在逆时针旋转，不会有反向的情况，这意味着我们可以在逆时针枚举凸包上的边时，记录并维护一个当前最远点，并不断计算、更新答案。</p><p>求出凸包后的数组自然地是按照逆时针旋转的顺序排列，不过要记得提前将最左下角的 $1$ 节点补到数组最后，这样在挨个枚举边 $(i,i+1)$ 时，才能把所有边都枚举到。</p><p>枚举过程中，对于每条边，都检查 $j+1$ 和边 $(i,i+1)$ 的距离是不是比 更大，如果是就将 加一，否则说明 是此边的最优点。判断点到边的距离大小时可以用叉积分别算出两个三角形的面积（如图，黄、蓝两个同底三角形的面积）并直接比较。</p><p><strong>注意</strong>：</p><p>作为一个数组下标喜欢使用 $[1,n]$ 的人，也必须做出取舍，在凸包和旋转卡壳中，使用 $[0,n-1]$ 有几个好处。</p><ol><li>对于单调栈之间，我们会统计两次起点，所以 <code>top</code> 的值会达到 $n+1$ ，则会 $RE$ ，显然。</li><li>在旋转卡壳中有一个操作会执行 <code>j=(j+1)%top</code> ，这样的话，如果单调栈的下标是在 $[0,top-1]$ 的话，就直接执行，而如果是 $[1,top]$ 的话，模就会模出问题。</li></ol><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">double</span> <span class="title">rotcal</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(top&lt;=<span class="number">2</span>) <span class="keyword">return</span> <span class="built_in">getDist</span>(Pt[<span class="number">0</span>],Pt[N<span class="number">-1</span>]);</span><br><span class="line">    <span class="type">double</span> res=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>,j=<span class="number">2</span>;i&lt;top;++i)</span><br><span class="line">    &#123;</span><br><span class="line">        Pir a=Pt[stk[i]],b=Pt[stk[i+<span class="number">1</span>]];</span><br><span class="line">        <span class="keyword">while</span>(<span class="built_in">area</span>(a,b,Pt[stk[j]])&lt;<span class="built_in">area</span>(a,b,Pt[stk[j+<span class="number">1</span>]])) j=(j+<span class="number">1</span>&gt;=top?<span class="number">0</span>:j+<span class="number">1</span>);</span><br><span class="line">        res=<span class="built_in">max</span>(res,<span class="built_in">max</span>(<span class="built_in">getDist</span>(a,Pt[stk[j]]),<span class="built_in">getDist</span>(b,Pt[stk[j]])));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>把旋转卡壳理解为当枚举边的时候，距离边最远的点是单调的。</p><p>凸包时间复杂度 $\mathcal O(n\log n)$ ，旋转卡壳时间复杂度 $\mathcal O(n)$ ，总时间复杂度 $\mathcal O(n\log n)$ 。</p><h3 id="以-0-为起点的旋转卡壳代码"><a href="#以-0-为起点的旋转卡壳代码" class="headerlink" title="以 $0$ 为起点的旋转卡壳代码"></a>以 $0$ 为起点的旋转卡壳代码</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> stk[MAXN&lt;&lt;<span class="number">1</span>],top;</span><br><span class="line"><span class="type">bool</span> use[MAXN];</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">andrew</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    std::<span class="built_in">sort</span>(Pt,Pt+N);</span><br><span class="line">    top=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;N;++i)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">while</span>(top&gt;=<span class="number">2</span>&amp;&amp;<span class="built_in">area</span>(Pt[stk[top<span class="number">-2</span>]],Pt[stk[top<span class="number">-1</span>]],Pt[i])&lt;=<span class="number">0</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span>(<span class="built_in">area</span>(Pt[stk[top<span class="number">-2</span>]],Pt[stk[top<span class="number">-1</span>]],Pt[i])&lt;<span class="number">0</span>)</span><br><span class="line">                use[stk[--top]]=<span class="number">0</span>;</span><br><span class="line">            <span class="keyword">else</span> --top;</span><br><span class="line">        &#125;</span><br><span class="line">        stk[top++]=i;</span><br><span class="line">        use[i]=<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    use[<span class="number">0</span>]=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=N<span class="number">-1</span>;i&gt;=<span class="number">0</span>;--i)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(use[i]) <span class="keyword">continue</span>;</span><br><span class="line">        <span class="keyword">while</span>(top&gt;=<span class="number">2</span>&amp;&amp;<span class="built_in">area</span>(Pt[stk[top<span class="number">-2</span>]],Pt[stk[top<span class="number">-1</span>]],Pt[i])&lt;=<span class="number">0</span>)</span><br><span class="line">            --top;</span><br><span class="line">        stk[top++]=i;</span><br><span class="line">    &#125;</span><br><span class="line">    --top;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">double</span> <span class="title">rotcal</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(top&lt;=<span class="number">2</span>) <span class="keyword">return</span> <span class="built_in">getDist</span>(Pt[<span class="number">0</span>],Pt[N<span class="number">-1</span>]);</span><br><span class="line">    <span class="type">double</span> res=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>,j=<span class="number">2</span>;i&lt;top;++i)</span><br><span class="line">    &#123;</span><br><span class="line">        Pir a=Pt[stk[i]],b=Pt[stk[i+<span class="number">1</span>]];</span><br><span class="line">        <span class="keyword">while</span>(<span class="built_in">area</span>(a,b,Pt[stk[j]])&lt;<span class="built_in">area</span>(a,b,Pt[stk[j+<span class="number">1</span>]])) j=(j+<span class="number">1</span>&gt;=top?<span class="number">0</span>:j+<span class="number">1</span>);</span><br><span class="line">        res=<span class="built_in">max</span>(res,<span class="built_in">max</span>(<span class="built_in">getDist</span>(a,Pt[stk[j]]),<span class="built_in">getDist</span>(b,Pt[stk[j]])));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><a href="https://www.luogu.com.cn/problem/P1452">某谷模板题</a></p><details>    <summary>AC Code</summary><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;ctime&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iomanip&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stack&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;map&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> gh() getchar()</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> re register</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> db double</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> ll;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN=<span class="number">5e4</span>+<span class="number">1</span>;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    x=<span class="number">0</span>;</span><br><span class="line">    <span class="type">char</span> ch=<span class="built_in">gh</span>(),t=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(ch&lt;<span class="string">&#x27;0&#x27;</span>||ch&gt;<span class="string">&#x27;9&#x27;</span>) t|=ch==<span class="string">&#x27;-&#x27;</span>,ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">while</span>(ch&gt;=<span class="string">&#x27;0&#x27;</span>&amp;&amp;ch&lt;=<span class="string">&#x27;9&#x27;</span>) x=(x&lt;&lt;<span class="number">3</span>)+(x&lt;&lt;<span class="number">1</span>)+(ch^<span class="number">48</span>),ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">if</span>(t) x=-x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T,<span class="keyword">class</span> ...T1&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x,T1 &amp;...x1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">read</span>(x),<span class="built_in">read</span>(x1...);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">checkMax</span><span class="params">(T &amp;x,T &amp;y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x&lt;y?x=y,<span class="number">1</span>:<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">checkMin</span><span class="params">(T &amp;x,T &amp;y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x&gt;y?x=y,<span class="number">1</span>:<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> N;</span><br><span class="line"><span class="keyword">using</span> Pir=std::pair&lt;<span class="type">double</span>,<span class="type">double</span>&gt;;</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> fi first</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> se second</span></span><br><span class="line">Pir Pt[MAXN];</span><br><span class="line">Pir <span class="keyword">operator</span>-(Pir &amp;a,Pir &amp;b)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">make_pair</span>(a.fi-b.fi,a.se-b.se);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">double</span> <span class="title">cross</span><span class="params">(Pir a,Pir b)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> a.fi*b.se-b.fi*a.se;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">double</span> <span class="title">area</span><span class="params">(Pir a,Pir b,Pir c)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">cross</span>(b-a,c-a);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">double</span> <span class="title">getDist</span><span class="params">(Pir a,Pir b)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (a.fi-b.fi)*(a.fi-b.fi)+(a.se-b.se)*(a.se-b.se);</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> stk[MAXN&lt;&lt;<span class="number">1</span>],top;</span><br><span class="line"><span class="type">bool</span> use[MAXN];</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">andrew</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    std::<span class="built_in">sort</span>(Pt,Pt+N);</span><br><span class="line">    top=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;N;++i)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">while</span>(top&gt;=<span class="number">2</span>&amp;&amp;<span class="built_in">area</span>(Pt[stk[top<span class="number">-2</span>]],Pt[stk[top<span class="number">-1</span>]],Pt[i])&lt;=<span class="number">0</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span>(<span class="built_in">area</span>(Pt[stk[top<span class="number">-2</span>]],Pt[stk[top<span class="number">-1</span>]],Pt[i])&lt;<span class="number">0</span>)</span><br><span class="line">                use[stk[--top]]=<span class="number">0</span>;</span><br><span class="line">            <span class="keyword">else</span> --top;</span><br><span class="line">        &#125;</span><br><span class="line">        stk[top++]=i;</span><br><span class="line">        use[i]=<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    use[<span class="number">0</span>]=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=N<span class="number">-1</span>;i&gt;=<span class="number">0</span>;--i)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(use[i]) <span class="keyword">continue</span>;</span><br><span class="line">        <span class="keyword">while</span>(top&gt;=<span class="number">2</span>&amp;&amp;<span class="built_in">area</span>(Pt[stk[top<span class="number">-2</span>]],Pt[stk[top<span class="number">-1</span>]],Pt[i])&lt;=<span class="number">0</span>)</span><br><span class="line">            --top;</span><br><span class="line">        stk[top++]=i;</span><br><span class="line">    &#125;</span><br><span class="line">    --top;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">double</span> <span class="title">rotcal</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(top&lt;=<span class="number">2</span>) <span class="keyword">return</span> <span class="built_in">getDist</span>(Pt[<span class="number">0</span>],Pt[N<span class="number">-1</span>]);</span><br><span class="line">    <span class="type">double</span> res=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>,j=<span class="number">2</span>;i&lt;top;++i)</span><br><span class="line">    &#123;</span><br><span class="line">        Pir a=Pt[stk[i]],b=Pt[stk[i+<span class="number">1</span>]];</span><br><span class="line">        <span class="keyword">while</span>(<span class="built_in">area</span>(a,b,Pt[stk[j]])&lt;<span class="built_in">area</span>(a,b,Pt[stk[j+<span class="number">1</span>]])) j=(j+<span class="number">1</span>&gt;=top?<span class="number">0</span>:j+<span class="number">1</span>);</span><br><span class="line">        res=<span class="built_in">max</span>(res,<span class="built_in">max</span>(<span class="built_in">getDist</span>(a,Pt[stk[j]]),<span class="built_in">getDist</span>(b,Pt[stk[j]])));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// freopen(&quot;geo.in&quot;,&quot;r&quot;,stdin);</span></span><br><span class="line">    <span class="comment">// freopen(&quot;geo.out&quot;,&quot;w&quot;,stdout);</span></span><br><span class="line">    <span class="built_in">read</span>(N);</span><br><span class="line">    <span class="keyword">for</span>(re <span class="type">int</span> i=<span class="number">0</span>;i&lt;N;++i) <span class="built_in">scanf</span>(<span class="string">&quot;%lf%lf&quot;</span>,&amp;Pt[i].fi,&amp;Pt[i].se);</span><br><span class="line">    <span class="built_in">andrew</span>();</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%.0lf&quot;</span>,<span class="built_in">rotcal</span>());</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">4</span></span><br><span class="line"><span class="comment">0 0</span></span><br><span class="line"><span class="comment">0 1</span></span><br><span class="line"><span class="comment">1 1</span></span><br><span class="line"><span class="comment">1 0</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure></details><hr><h2 id="三角剖分"><a href="#三角剖分" class="headerlink" title="三角剖分"></a>三角剖分</h2><p>将一个 $n$ 边形剖分成 $n-2$ 个不相交的三角形，这是从小学说到高中的数学题了。</p><p>参考了 $Dyd$ 的 <a href="https://dyd-true.github.io/2022/01/21/%E4%B8%89%E8%A7%92%E5%89%96%E5%88%86/">$Blog$</a></p><p>对于一个圆和一个三角形的面积交，则会分成四种情况（读者可以自行模拟）：</p><ol><li>圆把三角形包住，则面积交就是三角形面积；</li><li>有 $1$ 个点在圆外，则面积是一个小三角形面积和一个小扇形的面积和；</li><li>有 $2$ 个点在圆外且其边与圆相离，则面积是一个扇形；</li><li>有 $2$ 个点在圆外且其边与圆相割，则面积是 $2$ 个小扇形加上一个三角形的面积和。</li></ol><p>但是，多边形与圆面积交呢？情况繁杂，所以把这个多边形分成很多个三角形来算也行。</p><h3 id="叉积运用：多边形面积分"><a href="#叉积运用：多边形面积分" class="headerlink" title="叉积运用：多边形面积分"></a>叉积运用：多边形面积分</h3><p>对于一个多边形的面积（知道所有点的坐标），最好的方法是怎么算？</p><p>平面上任取一点 $p$ ，画出 $p$ 与多边形顶点的向量，则 $S=\sum_{I,J\in N}\vec{PI}\times\vec{PJ}$ ，如果点 $P$ 在多边形内很好证明，但是在多边形外也是成立的，因为叉积的结果是有向的，所以当把所有和全部算完，会发现正好会把多余部分减去，这个方法同样适用于凹多边形，读者可以自行探取。</p><h2 id="扫描线"><a href="#扫描线" class="headerlink" title="扫描线"></a>扫描线</h2><h3 id="矩形面积并"><a href="#矩形面积并" class="headerlink" title="矩形面积并"></a>矩形面积并</h3><p>线段树进阶知识，详见<a href="https://violeteternal.github.io/Eternity/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/OI/scan-line/">扫描线</a></p><p><img src="https://oi-wiki.org/geometry/images/scanning.svg" alt="img"></p><h3 id="三角面积并"><a href="#三角面积并" class="headerlink" title="三角面积并"></a>三角面积并</h3><p>三角形并不会平行于平面直角坐标系，那么我们用一条 $y$ 轴线，只要有顶点（或者交点）就划一次，全部划分，然后按照梯形（广义）面积来算。时间复杂度是 $\mathcal O(n^3)$ 。</p><p>听起来很简单，但是实施在代码上实际上十分困难。有很多需要讲的点。先咕着（还没学懂）。</p><h3 id="辛普森积分"><a href="#辛普森积分" class="headerlink" title="辛普森积分"></a>辛普森积分</h3><h3 id="自适应辛普森积分"><a href="#自适应辛普森积分" class="headerlink" title="自适应辛普森积分"></a>自适应辛普森积分</h3><h3 id="圆的面积并"><a href="#圆的面积并" class="headerlink" title="圆的面积并"></a>圆的面积并</h3><h2 id="平面最近点对"><a href="#平面最近点对" class="headerlink" title="平面最近点对"></a>平面最近点对</h2><h3 id="智慧法"><a href="#智慧法" class="headerlink" title="智慧法"></a>智慧法</h3><blockquote><p>我们充分发扬人类智慧</p></blockquote><p>正解分治，跟我使用<strong>智慧法</strong>有什么关系？</p><blockquote><p>在平面最近点对（加强版）里最高赞题解写道：</p><p>“我们充分发扬人类智慧：<br>将所有点全部绕原点旋转同一个角度，然后按 $x$ 坐标排序根据数学直觉，在随机旋转后，答案中的两个点在数组中肯定不会离得太远<br>所以我们只取每个点向后的 $5$ 个点来计算答案这样速度快得飞起，在 $n=10^6$时都可以在 $1s$ 内卡过”</p><p>这开启了智慧法过本问题（<del>恶心出题人</del>）的新时代！</p></blockquote><h3 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h3>]]></content>
      
      
      <categories>
          
          <category> 学习笔记 </category>
          
          <category> OI </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 计算几何 </tag>
            
            <tag> 凸包 </tag>
            
            <tag> 叉积 </tag>
            
            <tag> 点积 </tag>
            
            <tag> 旋转卡壳 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>高斯消元</title>
      <link href="/Eternity/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/OI/gauss-jordan-elimination/"/>
      <url>/Eternity/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/OI/gauss-jordan-elimination/</url>
      
        <content type="html"><![CDATA[<p>“一列一列的消失，所有绝铭将会被破解。”</p><span id="more"></span><h2 id="高斯消元"><a href="#高斯消元" class="headerlink" title="高斯消元"></a>高斯消元</h2><h3 id="消元法说明"><a href="#消元法说明" class="headerlink" title="消元法说明"></a>消元法说明</h3><p>消元法是将方程组中的一方程的未知数用含有另一未知数的代数式表示，并将其带入到另一方程中，这就消去了一未知数，得到一解；或将方程组中的一方程倍乘某个常数加到另外一方程中去，也可达到消去一未知数的目的。消元法主要用于二元一次方程组的求解。</p><h3 id="消元法理论的核心"><a href="#消元法理论的核心" class="headerlink" title="消元法理论的核心"></a>消元法理论的核心</h3><p>消元法理论的核心主要如下：</p><ul><li>两方程互换，解不变；</li><li>一方程乘以非零数 ，解不变；</li><li>一方程乘以数 加上另一方程，解不变。</li></ul><h3 id="高斯消元法思想概念"><a href="#高斯消元法思想概念" class="headerlink" title="高斯消元法思想概念"></a>高斯消元法思想概念</h3><p>德国数学家高斯对消元法进行了思考分析，得出了如下结论：</p><ul><li>在消元法中，参与计算和发生改变的是方程中各变量的系数；</li><li>各变量并未参与计算，且没有发生改变；</li><li>可以利用系数的位置表示变量，从而省略变量；</li><li>在计算中将变量简化省略，方程的解不变。</li></ul><h3 id="高斯消元五步骤法"><a href="#高斯消元五步骤法" class="headerlink" title="高斯消元五步骤法"></a>高斯消元五步骤法</h3><p>高斯消元法在将增广矩阵化为最简形后对于自由未知量的赋值，需要掌握线性相关知识，且赋值存在人工经验的因素，使得在学习过程中有一定的困难，将高斯消元法划分为五步骤，从而提出五步骤法，内容如下：</p><ol><li>增广矩阵行初等行变换为行最简形；</li><li>还原线性方程组；</li><li>求解第一个变量；</li><li>补充自由未知量；</li><li>列表示方程组通解。</li></ol><hr><p>在说这些之后，包括 OI-Wiki 和《进阶指北》，我也都没有搞懂，所以建议像我这样蒟蒻的人，还是多背背模板好。</p><hr><h2 id="约旦消元法"><a href="#约旦消元法" class="headerlink" title="约旦消元法"></a>约旦消元法</h2><p>大致思路如下：</p><ol><li><p>选择一个尚未被选过的未知数作为主元，选择一个包含这个主元的方程。</p></li><li><p>将这个方程主元的系数化为 $1$ 。</p></li><li><p>通过加减消元，消掉其它方程中的这个未知数。</p></li><li><p>重复以上步骤，直到把每一行都变成只有一项有系数。</p></li></ol><p>我们用矩阵表示每一项系数以及结果。</p><details>    <summary>洛谷模板题</summary><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;ctime&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iomanip&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stack&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;map&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> gh() getchar()</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> underMax(x,y) ((x)&gt;(y)?(x):(y))</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> underMin(x,y) ((x)&lt;(y)?(x):(y))</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> LL;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN=<span class="number">1001</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">double</span> Eps=<span class="number">1e-6</span>;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">underRead</span><span class="params">(T &amp;x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    x=<span class="number">0</span>;</span><br><span class="line">    <span class="type">char</span> ch=<span class="built_in">gh</span>(),t=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(ch&lt;<span class="string">&#x27;0&#x27;</span>||ch&gt;<span class="string">&#x27;9&#x27;</span>) t|=ch==<span class="string">&#x27;-&#x27;</span>,ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">while</span>(ch&gt;=<span class="string">&#x27;0&#x27;</span>&amp;&amp;ch&lt;=<span class="string">&#x27;9&#x27;</span>) x=(x&lt;&lt;<span class="number">3</span>)+(x&lt;&lt;<span class="number">1</span>)+(ch^<span class="number">48</span>),ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">if</span>(t) x=-x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> N;</span><br><span class="line"><span class="type">double</span> Matrix[MAXN][MAXN];</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">double</span> <span class="title">underFabs</span><span class="params">(<span class="type">double</span> x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (x&gt;<span class="number">0</span>?x:-x);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">underSwap</span><span class="params">(<span class="type">double</span> &amp;a,<span class="type">double</span> &amp;b)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">double</span> t=a;a=b;b=t;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">underGauss</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=N;++i)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> t=i;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j=i+<span class="number">1</span>;j&lt;=N;++j)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span>(<span class="built_in">underFabs</span>(Matrix[j][i])&gt;<span class="built_in">underFabs</span>(Matrix[t][i])) t=j;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">1</span>;j&lt;=N+<span class="number">1</span>;++j) <span class="built_in">underSwap</span>(Matrix[t][j],Matrix[i][j]);</span><br><span class="line">        <span class="keyword">if</span>(!Matrix[i][i]) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">1</span>;j&lt;=N;++j)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span>(j!=i)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="type">double</span> temp=Matrix[j][i]/Matrix[i][i];</span><br><span class="line">                <span class="keyword">for</span>(<span class="type">int</span> k=i+<span class="number">1</span>;k&lt;=N+<span class="number">1</span>;++k)</span><br><span class="line">                &#123;</span><br><span class="line">                    Matrix[j][k]-=Matrix[i][k]*temp;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=N;i&gt;<span class="number">0</span>;--i)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j=i+<span class="number">1</span>;j&lt;=N;++j)</span><br><span class="line">        &#123;</span><br><span class="line">            Matrix[i][N]-=Matrix[i][j]*Matrix[j][N];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="comment">//  freopen(&quot;Gauss.in&quot;,&quot;r&quot;,stdin);</span></span><br><span class="line"><span class="comment">//  freopen(&quot;Gauss.out&quot;,&quot;w&quot;,stdout);</span></span><br><span class="line">    <span class="built_in">underRead</span>(N);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=N;++i)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">1</span>;j&lt;=N+<span class="number">1</span>;++j)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">scanf</span>(<span class="string">&quot;%lf&quot;</span>,&amp;Matrix[i][j]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">bool</span> t=<span class="built_in">underGauss</span>();</span><br><span class="line">    <span class="keyword">if</span>(!t) <span class="built_in">printf</span>(<span class="string">&quot;No Solution&quot;</span>);</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=N;++i) <span class="built_in">printf</span>(<span class="string">&quot;%.2lf\n&quot;</span>,Matrix[i][N+<span class="number">1</span>]/Matrix[i][i]);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">3</span></span><br><span class="line"><span class="comment">1 3 4 5</span></span><br><span class="line"><span class="comment">1 4 7 3</span></span><br><span class="line"><span class="comment">9 3 2 2</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure></details>]]></content>
      
      
      <categories>
          
          <category> 学习笔记 </category>
          
          <category> OI </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 数论 </tag>
            
            <tag> 高斯消元 </tag>
            
            <tag> 线性代数 </tag>
            
            <tag> 线性方程 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>《云边有个小卖部》——希望和悲伤，都是一道光</title>
      <link href="/Eternity/%E8%AE%B0%E9%9A%8F%E5%BD%B1%E8%90%BD/cloud-with-me/"/>
      <url>/Eternity/%E8%AE%B0%E9%9A%8F%E5%BD%B1%E8%90%BD/cloud-with-me/</url>
      
        <content type="html"><![CDATA[<p>作者；张嘉佳</p><p>作品名：《云边有个小卖部》</p><span id="more"></span><p>不知道，上次因为看书而哭是多久了……</p><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><blockquote><p>从小与外婆相依为命的刘十三，因为妈妈留言让他好好读书考上名牌大学，找个好姑娘结婚，好好生活，于是笨拙不聪明的刘十三努力学习，废寝忘食，最后悲哀地发现“原来世界上有很多事情，不是你有计划、有毅力就能做到的”。追寻着远方和梦想，刘十三背起行囊，离开了故乡，在大城市里摸爬滚打、失恋又失业、被情敌嘲笑，喝得酩酊大醉后被外婆开着老旧拖拉机，奔波一天一夜“绑架”回到了他的故乡。</p><p>刘十三就这样稀里糊涂地回到故乡，与童年时认识的女孩程霜重逢。程霜热情地为刘十三一年要卖出 1001 份保险出谋划策；和他带着小女孩球球假装一家三口一起玩耍；与他见证了牛大田和秦小贞的爱情故事。同时，他们自己的爱情也逐渐升温。</p><p>可刘十三的命运总是如此曲折：原来外婆早在半年前就知道自己患癌症，已是晚期，最多只有半年时间，如今再也撑不住了。在邻里和程霜的帮忙下，刘十三办好外婆的后事，在除夕夜顶风冒雪 8 个小时把指引亡魂的灯笼挂到高高的山顶。紧接着，程霜也要离开他，到医院动手术，临走前她对刘十三许下一生的承诺。外婆带着对外孙的爱走了，程霜带着对他的期待走了，他带着希望，坚强地活着。</p></blockquote><h2 id="读后"><a href="#读后" class="headerlink" title="读后"></a>读后</h2><blockquote><p> “悲伤的，并不是这本书讲的有多么曲折，而是你把自己带入了故事。”——马也</p></blockquote><p>正值一个很微妙的时间段，阅读到了这本书。其实，在阅读完“外婆的拖拉机”一章之后，我并没有太大的波动，只是，这些话语后来一遍又一遍地出现，才让我最终忍不住，在宁静的正午哭了出来。</p><p>真的是一本比较好的小说，文笔恰到好处，所谓平俗也被化为乡土气息。虽然被吐槽成是给多情小女生看的恋爱悲剧，但我看完之后，也甘愿去做一个多情的小女生。</p><h2 id="随记"><a href="#随记" class="headerlink" title="随记"></a>随记</h2><blockquote></blockquote>]]></content>
      
      
      <categories>
          
          <category> 记随影落 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 轻小说 </tag>
            
            <tag> 恋爱 </tag>
            
            <tag> 治愈 </tag>
            
            <tag> 致郁 </tag>
            
            <tag> 张嘉佳 </tag>
            
            <tag> 乡村 </tag>
            
            <tag> 亲情 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>B.O.O.K</title>
      <link href="/Eternity/Until-The-End/my-reading-life/"/>
      <url>/Eternity/Until-The-End/my-reading-life/</url>
      
        <content type="html"><![CDATA[<p>用来记录一些我读过的书。</p><span id="more"></span><h3 id="《告白》"><a href="#《告白》" class="headerlink" title="《告白》"></a>《告白》</h3><p>$date:2022.6.27$</p><p>经典中国式言情小说，结尾稍微有些 $\text{BE}$ 。</p><h3 id="《不哭不哭，痛痛飞走吧》"><a href="#《不哭不哭，痛痛飞走吧》" class="headerlink" title="《不哭不哭，痛痛飞走吧》"></a>《不哭不哭，痛痛飞走吧》</h3><p>三秋缒的另一本，可惜最近时间紧（懒了），不太想写。</p><p>$date:2022.7.14$</p><h3 id="《三日间的幸福》"><a href="#《三日间的幸福》" class="headerlink" title="《三日间的幸福》"></a>《三日间的幸福》</h3><p>也是三秋缒的书，似乎和我想像的不太一样，但写的确实比我想象的好。</p><p>$date:2022.7.16$</p><h3 id="《恋爱寄生虫》"><a href="#《恋爱寄生虫》" class="headerlink" title="《恋爱寄生虫》"></a>《恋爱寄生虫》</h3><p>也是，还不错。<del>荡漾起了我作为程序员的心</del>。</p><p>$date:2022.7.19$</p><h3 id="《文学少女》全-18-本"><a href="#《文学少女》全-18-本" class="headerlink" title="《文学少女》全 18 本"></a>《文学少女》全 18 本</h3><p>其实我是写了笔记的，不过还是得记录一下。</p><p>看了很久很久，刚开始姜告诉我的时候我以为是《周刊少女》那啥的，结果发现是我完全不知道的一个系列。就慢慢看下去了，刚开始以为只有 15 本，但那个结局有点（虽然很美满但是没有写出来所以我很难受）。</p><p>后来发现还有 3 本。结果《青涩作家》又有点离小谱，但还是看了。果然还是没让我失望（结果还是有点失望）。</p><p>但总归是开心的吧。</p><p>$date:2022.6.28\sim 2022.7.19$</p>]]></content>
      
      
      <categories>
          
          <category> Until The End </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Z函数（扩展Kmp）</title>
      <link href="/Eternity/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/OI/z-func-kmp-ex/"/>
      <url>/Eternity/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/OI/z-func-kmp-ex/</url>
      
        <content type="html"><![CDATA[<p>“$\text{Plan Z never fail!}$”</p><span id="more"></span><h2 id="Z-函数"><a href="#Z-函数" class="headerlink" title="Z 函数"></a>Z 函数</h2><p>对于一个长度为 $len$ 的字符串 $s$ ，有一个长度为 $len$ 的数组称之为 $z$ ，其中 $z[i]$ 表示 $s[1..len]$ 与 $s[i..len]$ 的最长公共前缀 $LCP$ ，那么 $z$ 被称为 $s$ 的 $z$ 函数。</p><p>用文字叙述，即是 $z[i]$ 表示的是字符串 $s$ 与 $s$ 以 $i$ 开头的后缀字串的最长公共前缀长度。</p><h3 id="一些需要了解的"><a href="#一些需要了解的" class="headerlink" title="一些需要了解的"></a>一些需要了解的</h3><p>在有些领域，有这样一个特殊定义 $z[1]=0$ ，即 $s[1..len]$ 与 $s[1..len]$ 的 $LCP$ 值为 $0$ 。但是，以普遍理性而言，这个定义是赘余的，但是，对于国际上现在通用的求 $z[]$ 的办法，对于求 $z[i]$ ，我们需要使用到 $z[0..i-1]$ 。而其中，所需要的，即是 $z[0]=0$ 。但是，在洛谷上的模板题，需要记入的答案是 $z[1]=length(s)$ 。那么，挺玄学的。</p><h3 id="暴力求解"><a href="#暴力求解" class="headerlink" title="暴力求解"></a>暴力求解</h3><p>时间复杂度 $O(n^2)$ 。当然就是每一个后缀都一一比较即可。</p><h3 id="线性时间求解"><a href="#线性时间求解" class="headerlink" title="线性时间求解"></a>线性时间求解</h3><p>这个算法，国外称之为 $Z\ Algorithm$ ，国内则更偏向于 $Kmp.Ex$ 。原因在于此算法的做法和用处都与 $Kmp$ 相类似。</p><p>我们给出一个新的定义称为 <strong>Z-box</strong> ，对于一个 $i$ 而言，我们将区间 $[i,i+z[i]-1]$ 称为是 $i$ 的匹配段，即 <strong>Z-box</strong> 。</p><p>在求解 Z 函数时，我们需要维护右端点最右值的匹配段。为了方便，记作区间 $[l,r]$ 。因为区间 $[l,r]$ 是匹配段，那么， $s[l..r]$ 肯定是 $s$ 的前缀子串。在计算 $z[i]$ 时，我们需要保证 $l\le i$ 。且初始时， $l=r=0$ 。</p><p>在 $z[i]$ 的计算过程中具有：</p><ul><li><p>如果 $i\le r$ ，那么根据 $[l,r]$ 的定义有 $s[i,r]=s[i-l,r-l]$ ，因此 $\min(z[i-l+1],r-i+1)\leq z[i]$ 。这时：</p><ol><li>若 $z[i-l]\leq r-i+1$ ，则 $z[i]=z[i-l]$ 。 </li><li>否则 $z[i-l]\geq r-i+1$ ，这时令 $z[i]=r-i+1$ ，然后暴力枚举下一个字符扩展 $z[i]$ 直到不能扩展为止。</li></ol></li><li><p>如果 $i&gt;r$ ，则从 $s[i]$ 开始暴力求 $z[i]$ 。</p></li><li>求出 $z[i]$ 之后，如果 $i+z[i]-1&gt;r$ ，就更新 $[l,r]$ ，令 $l=i,r=i+z[i]-1$ 即可。</li></ul><h3 id="复杂度分析"><a href="#复杂度分析" class="headerlink" title="复杂度分析"></a>复杂度分析</h3><p>内层函数满足将 $r$ 向后移，而 $r&lt;n-1$ ，共执行 $n$ 次。外层线性遍历，同样是 $n$ 次，总时间复杂度 $\mathcal O(n)$ 。</p><h3 id="应用"><a href="#应用" class="headerlink" title="应用"></a>应用</h3><p>详见 <a href="https://oi-wiki.org/string/z-func/#_6">OI Wiki</a></p><details>    <summary>洛谷模板题</summary><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;ctime&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iomanip&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stack&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;map&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> gh() getchar()</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> re register</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> db double</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> ll;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXS=<span class="number">2e7</span>+<span class="number">1</span>;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    x=<span class="number">0</span>;</span><br><span class="line">    <span class="type">char</span> ch=<span class="built_in">gh</span>(),t=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(ch&lt;<span class="string">&#x27;0&#x27;</span>||ch&gt;<span class="string">&#x27;9&#x27;</span>) t|=ch==<span class="string">&#x27;-&#x27;</span>,ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">while</span>(ch&gt;=<span class="string">&#x27;0&#x27;</span>&amp;&amp;ch&lt;=<span class="string">&#x27;9&#x27;</span>) x=(x&lt;&lt;<span class="number">3</span>)+(x&lt;&lt;<span class="number">1</span>)+(ch^<span class="number">48</span>),ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">if</span>(t) x=-x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T,<span class="keyword">class</span> ...T1&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x,T1 &amp;...x1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">read</span>(x),<span class="built_in">read</span>(x1...);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">checkMax</span><span class="params">(T &amp;x,T &amp;y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x&lt;y?x=y,<span class="number">1</span>:<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">checkMin</span><span class="params">(T &amp;x,T &amp;y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x&gt;y?x=y,<span class="number">1</span>:<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">char</span> Str_a[MAXS],Str_b[MAXS];</span><br><span class="line"><span class="type">int</span> Z[MAXS],P[MAXS],Len_a,Len_b;</span><br><span class="line">ll ans;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">getZ_Func</span><span class="params">(<span class="type">char</span> *s,<span class="type">int</span> *z)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> len=<span class="built_in">strlen</span>(s+<span class="number">1</span>); </span><br><span class="line">    <span class="keyword">for</span>(re <span class="type">int</span> i=<span class="number">1</span>;i&lt;=len;++i) z[i]=<span class="number">0</span>;</span><br><span class="line">    Z[<span class="number">1</span>]=len;   <span class="comment">//特殊判定</span></span><br><span class="line">    <span class="keyword">for</span>(re <span class="type">int</span> i=<span class="number">2</span>,l=<span class="number">0</span>,r=<span class="number">0</span>;i&lt;=len;++i)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(i&lt;=r&amp;&amp;z[i-l+<span class="number">1</span>]&lt;r-i+<span class="number">1</span>) z[i]=z[i-l+<span class="number">1</span>];</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            z[i]=<span class="built_in">max</span>(<span class="number">0</span>,r-i+<span class="number">1</span>);</span><br><span class="line">            <span class="keyword">while</span>(i+z[i]&lt;=len&amp;&amp;s[z[i]+<span class="number">1</span>]==s[i+z[i]]) ++z[i];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(i+z[i]<span class="number">-1</span>&gt;r) l=i,r=i+z[i]<span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ;</span><br><span class="line">&#125;       <span class="comment">//自匹配</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">ex_Kmp</span><span class="params">(<span class="type">char</span> *s1,<span class="type">int</span> *z,<span class="type">char</span> *s2,<span class="type">int</span> *p)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">getZ_Func</span>(s2,z);</span><br><span class="line">    <span class="type">int</span> len=<span class="built_in">strlen</span>(s1+<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">for</span>(re <span class="type">int</span> i=<span class="number">1</span>;i&lt;=len;++i) p[i]=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(re <span class="type">int</span> i=<span class="number">1</span>,l=<span class="number">0</span>,r=<span class="number">0</span>;i&lt;=len;++i)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(i&lt;=r&amp;&amp;z[i-l+<span class="number">1</span>]&lt;r-i+<span class="number">1</span>) p[i]=z[i-l+<span class="number">1</span>];</span><br><span class="line">        <span class="keyword">else</span> </span><br><span class="line">        &#123;</span><br><span class="line">            p[i]=<span class="built_in">max</span>(<span class="number">0</span>,r-i+<span class="number">1</span>);</span><br><span class="line">            <span class="keyword">while</span>(i+p[i]&lt;=len&amp;&amp;s1[i+p[i]]==s2[p[i]+<span class="number">1</span>]) ++p[i];</span><br><span class="line">        &#125; </span><br><span class="line">        <span class="keyword">if</span>(i+p[i]<span class="number">-1</span>&gt;r) l=i,r=i+p[i]<span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ;</span><br><span class="line">&#125;       <span class="comment">//模式串匹配</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// freopen(&quot;Kmp-Ex.in&quot;,&quot;r&quot;,stdin);</span></span><br><span class="line">    <span class="comment">// freopen(&quot;Kmp-Ex.out&quot;,&quot;w&quot;,stdout);</span></span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%s%s&quot;</span>,Str_a+<span class="number">1</span>,Str_b+<span class="number">1</span>);</span><br><span class="line">    Len_a=<span class="built_in">strlen</span>(Str_a+<span class="number">1</span>),Len_b=<span class="built_in">strlen</span>(Str_b+<span class="number">1</span>);</span><br><span class="line">    <span class="built_in">getZ_Func</span>(Str_b,Z);</span><br><span class="line">    <span class="keyword">for</span>(re <span class="type">int</span> i=<span class="number">1</span>;i&lt;=Len_b;++i) ans^=<span class="number">1ll</span>*i*(Z[i]+<span class="number">1</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%lld\n&quot;</span>,ans);</span><br><span class="line">    <span class="built_in">ex_Kmp</span>(Str_a,Z,Str_b,P);</span><br><span class="line">    ans=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(re <span class="type">int</span> i=<span class="number">1</span>;i&lt;=Len_a;++i) ans^=<span class="number">1ll</span>*i*(P[i]+<span class="number">1</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%lld&quot;</span>,ans);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">aaaabaa</span></span><br><span class="line"><span class="comment">aaaaa</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure></details>]]></content>
      
      
      <categories>
          
          <category> 学习笔记 </category>
          
          <category> OI </category>
          
      </categories>
      
      
        <tags>
            
            <tag> String </tag>
            
            <tag> 字符串 </tag>
            
            <tag> Kmp </tag>
            
            <tag> 后缀函数 </tag>
            
            <tag> 前缀函数 </tag>
            
            <tag> 扩展Kmp </tag>
            
            <tag> Z函数 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>数论分块&amp;狄利克雷卷积</title>
      <link href="/Eternity/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/OI/sqrt-decomposition-and-dirichlet-product/"/>
      <url>/Eternity/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/OI/sqrt-decomposition-and-dirichlet-product/</url>
      
        <content type="html"><![CDATA[<p>万事俱备，则时空将会反演。</p><span id="more"></span><h2 id="数论分块"><a href="#数论分块" class="headerlink" title="数论分块"></a>数论分块</h2><p>字面意思，在数学论理中进行分块处理。一般用于快速计算含有向下取整和式的题。当可以在 $\mathcal O(1)$ 内计算出 $f(r)-f(l)$ 或者已经预处理除了 $f$ 的前缀和时，数论分块就能够使用 $\mathcal O(\sqrt n)$ 的时间内计算出类似于 $\sum\limits^{n}_{i=1}f(i)g(\lfloor \frac{n}{i} \rfloor)$ 的和式的值。</p><h3 id="富比尼定理-Fubini’s-theorem"><a href="#富比尼定理-Fubini’s-theorem" class="headerlink" title="富比尼定理(Fubini’s theorem)"></a>富比尼定理(Fubini’s theorem)</h3><p>将 $\lfloor\frac{n}{i}\rfloor$ 打包计算。</p><p>又称“算两次”，以意大利数学家圭多·富比尼（$\text{Guido Fubini}$）命名。 富比尼定理的积分形式：只要二重积分 $ \int\int|f(x,y)|dxdy$ 有界，则可以逐次计算二重积分，并且可以交换逐次积分的顺序。 积分号也是特殊的求和号，因此在一般求和中，富比尼定理往往呈现为更换计数顺序，即交换两个求和号。 组合数学中的富比尼定理表现为，用两种不同的方法计算同一个量，从而建立相等关系。这种方法在反比例函数上有很好的解释：</p><p><img src="https://oi-wiki.org/math/number-theory/images/sqrt-decomposition.png" alt=""></p><p>在区间 $[1,11]$ 中，根据 $y=\lfloor\frac{11}{x}\rfloor$ 的答案不同，被分成了 $5$ 块， $5$ 块整点的最大纵坐标都相同，</p><h3 id="引理-Ⅰ"><a href="#引理-Ⅰ" class="headerlink" title="引理 Ⅰ"></a>引理 Ⅰ</h3><p>$\forall a,b,c\in\mathbb Z,\lfloor\frac{a}{bc}\rfloor=\lfloor\frac{\lfloor\frac{a}{b}\rfloor}{c}\rfloor$ ，证明详见 <a href="https://oi-wiki.org/math/number-theory/sqrt-decomposition/#_1">OI-Wiki</a></p><h3 id="引理-Ⅱ"><a href="#引理-Ⅱ" class="headerlink" title="引理 Ⅱ"></a>引理 Ⅱ</h3><p>$\forall n\in \mathbb N_+,|\{\lfloor\frac{n}{d}\rfloor|d\in\mathbb N_+,d\leq n\}|\leq\lfloor2\sqrt n\rfloor$ ，证明详见 OI-Wiki</p><h3 id="引理-Ⅲ"><a href="#引理-Ⅲ" class="headerlink" title="引理 Ⅲ"></a>引理 Ⅲ</h3><p>对于 $\forall i\le n,\lfloor\frac{n}{i}\rfloor$ 只存在 $\mathcal O(\sqrt n)$ 种不同的值。</p><p>对于 $i\le \sqrt n$ 的部分，$i$ 只存在 $\sqrt n$ 个，取值也不会超过 $\sqrt n$ 个；</p><p>对于 $i&gt;\sqrt n$ 的部分，$\lfloor\frac{n}{i}\rfloor&lt;\sqrt n$ ，取值也不会超过 $\sqrt n$ 个。</p><h3 id="结论"><a href="#结论" class="headerlink" title="结论"></a>结论</h3><p>对于常数 $n$ ，使 $\lfloor\frac{n}{i}\rfloor=\lfloor\frac{n}{j}\rfloor$ 成立的最大满足 $i\leq j\leq n$ 的 $j$ 的值为 $\lfloor\frac{n}{\lfloor\frac{n}{i}\rfloor}\rfloor$ 。即值 $\lfloor\frac{n}{i}\rfloor$ 所在块的右端点为 $\lfloor\frac{n}{\lfloor\frac{n}{i}\rfloor}\rfloor$ 。</p><hr><p>简单证明：</p><p>因为有 $\lfloor\frac{n}r\rfloor=\lfloor\frac{n}{i}\rfloor$ ，则有：</p><p>$r\times\lfloor\frac{n}{i}\rfloor\le n$ ，变式得到：</p><p>$r\le\lfloor\frac{n}{\lfloor\frac{n}{i}\rfloor}\rfloor$ 。</p><p>证毕。</p><hr><h3 id="分块加速"><a href="#分块加速" class="headerlink" title="分块加速"></a>分块加速</h3><p>那么，就如同对数组进行分块一样，对于每一个块的计算，我们就直接用块值乘以个数计算即可，用数论分块加速时间，降低时间复杂度。</p><h3 id="例题"><a href="#例题" class="headerlink" title="例题"></a>例题</h3><h4 id="UVA11526"><a href="#UVA11526" class="headerlink" title="UVA11526"></a><a href="https://www.luogu.com.cn/problem/UVA11526">UVA11526</a></h4><p>题意显而易见了。直接分块计算即可。记得开 <code>long long</code> 。</p><details>    <summary>AC Code</summary><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;ctime&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iomanip&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stack&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;map&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> gh() getchar()</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> re register</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> db double</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> ll;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    x=<span class="number">0</span>;</span><br><span class="line">    <span class="type">char</span> ch=<span class="built_in">gh</span>(),t=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(ch&lt;<span class="string">&#x27;0&#x27;</span>||ch&gt;<span class="string">&#x27;9&#x27;</span>) t|=ch==<span class="string">&#x27;-&#x27;</span>,ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">while</span>(ch&gt;=<span class="string">&#x27;0&#x27;</span>&amp;&amp;ch&lt;=<span class="string">&#x27;9&#x27;</span>) x=(x&lt;&lt;<span class="number">3</span>)+(x&lt;&lt;<span class="number">1</span>)+(ch^<span class="number">48</span>),ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">if</span>(t) x=-x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T,<span class="keyword">class</span> ...T1&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x,T1 &amp;...x1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">read</span>(x),<span class="built_in">read</span>(x1...);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">checkMax</span><span class="params">(T &amp;x,T &amp;y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x&lt;y?x=y,<span class="number">1</span>:<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">checkMin</span><span class="params">(T &amp;x,T &amp;y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x&gt;y?x=y,<span class="number">1</span>:<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> T,n;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> ll <span class="title">H</span><span class="params">(<span class="type">int</span> n)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    ll res=<span class="number">0</span>;</span><br><span class="line">    ll l=<span class="number">1</span>,r;</span><br><span class="line">    <span class="keyword">while</span>(l&lt;=n)</span><br><span class="line">    &#123;</span><br><span class="line">        r=n/(n/l);</span><br><span class="line">        res+=<span class="number">1ll</span>*(r-l+<span class="number">1</span>)*(n/l);</span><br><span class="line">        l=r+<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// freopen(&quot;sqrt-decomposition.in&quot;,&quot;r&quot;,stdin);</span></span><br><span class="line">    <span class="comment">// freopen(&quot;sqrt-decomposition.out&quot;,&quot;w&quot;,stdout);</span></span><br><span class="line">    <span class="built_in">read</span>(T);</span><br><span class="line">    <span class="keyword">while</span>(T--)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">read</span>(n);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%lld\n&quot;</span>,<span class="built_in">H</span>(n));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">2</span></span><br><span class="line"><span class="comment">5</span></span><br><span class="line"><span class="comment">10</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure></details><hr><h4 id="Luogu-2261"><a href="#Luogu-2261" class="headerlink" title="Luogu 2261"></a><a href="https://www.luogu.com.cn/problem/P2261">Luogu 2261</a></h4><p>这道题需要一点特判。</p><p>我们知道 $k\bmod p =k-\lfloor\frac{k}{p}\rfloor\times p$ ，那么，我们需要求的式子也可以转化为：</p><p>$ans=\sum_{i=1}^n k\bmod i=\sum_{i=1}^n k-\lfloor\frac{k}{i}\rfloor\times i=nk-\sum_{i=1}^n \lfloor\frac{n}{i}\rfloor\times i$</p><p>然后就转化为了数论分块的经典各式了。</p><p>对于这道题的特判，因为 $n$ 和 $k $ 的大小关系是不清楚的，而因为 $l\leq n$ 可能会存在 $\lfloor\frac{k}{l}\rfloor$ 为 $0$ 的情况，所以需要特判。</p><details>    <summary>AC Code</summary><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;ctime&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iomanip&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stack&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;map&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> gh() getchar()</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> re register</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> db double</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> ll;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    x=<span class="number">0</span>;</span><br><span class="line">    <span class="type">char</span> ch=<span class="built_in">gh</span>(),t=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(ch&lt;<span class="string">&#x27;0&#x27;</span>||ch&gt;<span class="string">&#x27;9&#x27;</span>) t|=ch==<span class="string">&#x27;-&#x27;</span>,ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">while</span>(ch&gt;=<span class="string">&#x27;0&#x27;</span>&amp;&amp;ch&lt;=<span class="string">&#x27;9&#x27;</span>) x=(x&lt;&lt;<span class="number">3</span>)+(x&lt;&lt;<span class="number">1</span>)+(ch^<span class="number">48</span>),ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">if</span>(t) x=-x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T,<span class="keyword">class</span> ...T1&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x,T1 &amp;...x1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">read</span>(x),<span class="built_in">read</span>(x1...);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">checkMax</span><span class="params">(T &amp;x,T &amp;y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x&lt;y?x=y,<span class="number">1</span>:<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">checkMin</span><span class="params">(T &amp;x,T &amp;y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x&gt;y?x=y,<span class="number">1</span>:<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line">ll N,K,res,ans;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// freopen(&quot;math.in&quot;,&quot;r&quot;,stdin);</span></span><br><span class="line">    <span class="comment">// freopen(&quot;math.out&quot;,&quot;w&quot;,stdout);</span></span><br><span class="line">    <span class="built_in">read</span>(N,K);</span><br><span class="line">    ll l=<span class="number">1</span>,r;</span><br><span class="line">    <span class="keyword">while</span>(l&lt;=N)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(K/l) r=<span class="built_in">min</span>(N,K/(K/l));</span><br><span class="line">        <span class="keyword">else</span> r=N;</span><br><span class="line">        res+=<span class="number">1ll</span>*(l+r)*(r-l+<span class="number">1</span>)*(K/l)/<span class="number">2</span>;</span><br><span class="line">        <span class="comment">// printf(&quot;[%d,%d]=%d\n&quot;,l,r,res);</span></span><br><span class="line">        l=r+<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    ans=N*K-res;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%lld&quot;</span>,ans);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">k/2+1...k</span></span><br><span class="line"><span class="comment">0...(k+1)/2-1</span></span><br><span class="line"><span class="comment">l...r</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure></details><hr><h3 id="N-维数论分块"><a href="#N-维数论分块" class="headerlink" title="N 维数论分块"></a>N 维数论分块</h3><p>不太能了解，也不大可能会考（刀我），如果感兴趣的可以自行去 OI Wiki 上浏览。</p><hr><h2 id="数论函数"><a href="#数论函数" class="headerlink" title="数论函数"></a>数论函数</h2><p><strong>数论函数</strong>是指定义域为正整数的函数。</p><h3 id="积性函数"><a href="#积性函数" class="headerlink" title="积性函数"></a>积性函数</h3><p><strong>积性函数</strong>是一种特殊的数论函数，满足 $f(x,y)=f(x)\times f(y),x\perp y$ ，则 $f$ 是积性函数。显然满足 $f(1)=1$ 。</p><details>    <summary>对于 $x\perp y$ 的理解</summary>其实可以把它看作是 $x$ 的向量与 $y$ 的向量相垂直之类的（？感谢李姐。</details><p><br></p><p>若 $f(x),g(x)$ 为积性函数，则：</p><p>$h(x)=f(x^p)$</p><p>$h(x)=f^p(x)$</p><p>$h(x)=f(x)g(x)$</p><p>$\displaystyle h(x)=\sum_{d\mid x}f(d)g(\frac{x}{d})$</p><p>中的 $h(x)$ 都是积性函数。</p><hr><p>对于任意正整数 $x,y$ 满足 $f(xy)=f(x)\times f(y)$ ，则 $f$ 为<strong>完全积性函数</strong>。</p><p>常见常用的积性函数：</p><ol><li>单位函数 $\epsilon(n)=[n=1]$ ，即当 $n=1$ 时 $\epsilon(n)=1$ ，否则 $\epsilon(n)=0$ 。</li><li>恒等函数 $id_k(n)=n^k,id_1(n)$ 通常简记作 $id(n)$ 。</li><li>常数函数 $I(n)=1$ 。</li><li>除数函数 $\sigma_k(n)=\sum_{d\mid n}d^k,\sigma_0(n)$ 通常简记作 $d(n)$ ，而 $\sigma_1(n)$ 通常简记作 $\sigma(n)$ 。</li><li>欧拉函数 $\varphi(n)=\sum_{i\le n}[\gcd(i,n)=1]$ ，常用的一个计算式是 $\varphi(n)=n\times \prod_{p\in \operatorname{Prime}}\frac{p-1}{p}$ 。</li><li>莫比乌斯函数 $\mu(n)$ ，当 $n=1$ 时，$\mu(1)=1$ ，当 $n&gt;1$ 时，记 $n$ 的质因子分解为 $n=\prod p_i^{k_i}$ ，共有 $\omega(n)$ 种质因子，则当存在 $k_i&gt;1$ 时，$\mu(n)=0$ ，否则 $\mu(n)=(-1)^{\omega(n)}$ 。</li></ol><hr><h2 id="狄利克雷函数"><a href="#狄利克雷函数" class="headerlink" title="狄利克雷函数"></a>狄利克雷函数</h2><h3 id="狄利克雷生成函数"><a href="#狄利克雷生成函数" class="headerlink" title="狄利克雷生成函数"></a>狄利克雷生成函数</h3><p>一个数列的<strong>狄利克雷生成函数</strong>（被称为 $DGF$ ） 被定义为：</p><script type="math/tex; mode=display">\tilde{F}(x)=\sum\limits_{i\ge 1}\frac{f_i}{i^x}    \nonumber</script><p>$f_i$ 是一个从 $\mathbb N_+$ 到 $\mathbb Z$ 的函数，该生成函数与一个数论函数相对应，规定 $f_1=1$ 。</p><p>如果该函数是积性函数，（<strong>积性函数</strong>定义：对于所有互质的整数 $a$ 和 $b$ 有性质 $f(ab)=f(a)f(b)$ 的数论函数）即满足 $\forall i\perp j,f(ij)=f(i)\times f(j)$ ，则 $\tilde{F}(x)$ 可以由质数及其幂来表达，记作：（令 $P$ 为全体质数集合）</p><script type="math/tex; mode=display">\tilde{F}(x)=\prod_{p\in P}(1=\frac{f(p)}{p^x}+\frac{f(p)^2}{p^{2x}}+...)    \nonumber</script><h3 id="狄利克雷卷积"><a href="#狄利克雷卷积" class="headerlink" title="狄利克雷卷积"></a>狄利克雷卷积</h3><p>若数论函数 $f,g,h$ 满足 $h(n)=\sum_{d\mid n}f(d)g(\frac{n}{d})$ ，则称 $h$ 为 $f,g$ 的<strong>狄利克雷卷积</strong>。记作 $h=f\ast g$ 。</p><p>满足性质：</p><ol><li>单位函数 $\epsilon$ 是狄利克雷卷积的单位元（幺元），即 $f\ast\epsilon=f$ 。</li><li>狄利克雷卷积满足结合律和交换律。即 $a\ast b=b\ast a,a\ast(b\ast c)=(a\ast b)\ast c$ 。</li><li><strong>两个积性函数的狄利克雷卷积仍是积性函数</strong>。</li></ol><p>性质三的证明类似于除数函数的积性证明。</p><h3 id="逆元-·-重定义"><a href="#逆元-·-重定义" class="headerlink" title="逆元 · 重定义"></a>逆元 · 重定义</h3><p>在狄利克雷卷积的条件下，我们对逆元进行重定义：</p><p>满足 $f\ast f^{-1}= \epsilon$ ，则称 $f_{-1}$ 为 $f$ 的逆元。</p><p>如果 $f$ 是积性函数，则其逆元 $f^{-1}$ 也是积性函数。</p>]]></content>
      
      
      <categories>
          
          <category> 学习笔记 </category>
          
          <category> OI </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 数论 </tag>
            
            <tag> 质数 </tag>
            
            <tag> 优化 </tag>
            
            <tag> 逆元 </tag>
            
            <tag> 块状链表，块状数组，分块 </tag>
            
            <tag> 函数 </tag>
            
            <tag> 积性函数 </tag>
            
            <tag> 莫比乌斯函数 </tag>
            
            <tag> 莫比乌斯反演 </tag>
            
            <tag> 狄利克雷卷积 </tag>
            
            <tag> 数论分块 </tag>
            
            <tag> 数论函数 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>2021 CSP-S 第二轮</title>
      <link href="/Eternity/%E6%A8%A1%E6%8B%9F%E8%B5%9B-%E6%AF%94%E8%B5%9B/20220618-csp-s/"/>
      <url>/Eternity/%E6%A8%A1%E6%8B%9F%E8%B5%9B-%E6%AF%94%E8%B5%9B/20220618-csp-s/</url>
      
        <content type="html"><![CDATA[<p>考场成绩： $95pt+0+48pt+0=143pt$</p><p>现成绩： $100pt+0+100pt+0=200pt$</p><span id="more"></span><h2 id="P7913-CSP-S-2021-廊桥分配"><a href="#P7913-CSP-S-2021-廊桥分配" class="headerlink" title="P7913 [CSP-S 2021] 廊桥分配"></a><a href="https://www.luogu.com.cn/problem/P7913">P7913 [CSP-S 2021] 廊桥分配</a></h2><p>实力贪心，当初真考的时候在我们学校，我当时坐在 <code>B003</code> 时有一份代码，我就替那个人交了，结果那人爆零。然后洛谷就一直留着这道题，后来清题的时候就把这道题给做了。所以留有印象。</p><p>分开计算，首先将使用 $1\sim n$ 的国内廊桥能最多停多少和 $1\sim n$ 的国外廊桥能停放多少。然后计算答案则是 $ans=\max(res_{in}[i]+res_{out}[n-i]),0\leq i\leq n$ 。这一步是能够想到的。</p><p>对于计算过程，使用两个优先队列，一个 $lQueue$ 来记录一个二元组 $(x,y)$ 表示当前停靠飞机的离开时间和停靠的廊桥编号。另一个 $wQueue$ 来记录当前空闲的廊桥编号，至于为什么是优先队列，因为整个过程秉承<strong>“先到先得”</strong>的原则，且让廊桥编号尽可能小。最后统计前缀和即可。</p><font style="color:white">好吧，事实上，今天上午并没有做出了这道题，只是翻出了之前的代码，然后贺了上去，虽然之后在摆烂的时候把代码完全搞懂了。但总归不是自己做出来的。</font> <details>    <summary>AC Code</summary><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;ctime&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iomanip&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stack&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;map&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> gh() getchar()</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> re register</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> db double</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> ll;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN=<span class="number">1e5</span>+<span class="number">1</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXM=<span class="number">1e5</span>+<span class="number">1</span>;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    x=<span class="number">0</span>;</span><br><span class="line">    <span class="type">char</span> ch=<span class="built_in">gh</span>(),t=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(ch&lt;<span class="string">&#x27;0&#x27;</span>||ch&gt;<span class="string">&#x27;9&#x27;</span>) t|=ch==<span class="string">&#x27;-&#x27;</span>,ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">while</span>(ch&gt;=<span class="string">&#x27;0&#x27;</span>&amp;&amp;ch&lt;=<span class="string">&#x27;9&#x27;</span>) x=(x&lt;&lt;<span class="number">3</span>)+(x&lt;&lt;<span class="number">1</span>)+(ch^<span class="number">48</span>),ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">if</span>(t) x=-x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T,<span class="keyword">class</span> ...T1&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x,T1 &amp;...x1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">read</span>(x),<span class="built_in">read</span>(x1...);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">checkMax</span><span class="params">(T &amp;x,T &amp;y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x&lt;y?x=y,<span class="number">1</span>:<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">checkMin</span><span class="params">(T &amp;x,T &amp;y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x&gt;y?x=y,<span class="number">1</span>:<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">typedef</span> pair&lt;<span class="type">int</span>,<span class="type">int</span>&gt;Pir;</span><br><span class="line"><span class="type">int</span> N,M_in,M_out;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Air</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="type">int</span> arrive,leave;</span><br><span class="line">    <span class="meta">#<span class="keyword">define</span> ain(i) In[i].arrive</span></span><br><span class="line">    <span class="meta">#<span class="keyword">define</span> aout(i) Out[i].arrive</span></span><br><span class="line">    <span class="meta">#<span class="keyword">define</span> lin(i) In[i].leave</span></span><br><span class="line">    <span class="meta">#<span class="keyword">define</span> lout(i) Out[i].leave</span></span><br><span class="line">&#125;In[MAXM],Out[MAXM];</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">cmp</span><span class="params">(Air a,Air b)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">return</span> a.arrive&lt;b.arrive;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> Res_in[MAXM],Res_out[MAXM];</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">calc</span><span class="params">(Air *t,<span class="type">int</span> M,<span class="type">int</span> *res)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">priority_queue&lt;Pir,vector&lt;Pir&gt;,greater&lt;Pir&gt; &gt;lQ;</span><br><span class="line">priority_queue&lt;<span class="type">int</span>,vector&lt;<span class="type">int</span>&gt;,greater&lt;<span class="type">int</span>&gt; &gt;wQ;</span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=N;++i) wQ.<span class="built_in">push</span>(i);</span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=M;++i)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">while</span>(!lQ.<span class="built_in">empty</span>()&amp;&amp;t[i].arrive&gt;=lQ.<span class="built_in">top</span>().first)</span><br><span class="line">&#123;</span><br><span class="line">wQ.<span class="built_in">push</span>(lQ.<span class="built_in">top</span>().second);</span><br><span class="line">lQ.<span class="built_in">pop</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(wQ.<span class="built_in">empty</span>()) <span class="keyword">continue</span>;</span><br><span class="line"><span class="type">int</span> Dist=wQ.<span class="built_in">top</span>();</span><br><span class="line">wQ.<span class="built_in">pop</span>();</span><br><span class="line">++res[Dist];</span><br><span class="line">lQ.<span class="built_in">push</span>(<span class="built_in">make_pair</span>(t[i].leave,Dist));</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=N;++i) res[i]+=res[i<span class="number">-1</span>];</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="comment">//     freopen(&quot;airport.in&quot;,&quot;r&quot;,stdin);</span></span><br><span class="line"><span class="comment">//     freopen(&quot;airport.out&quot;,&quot;w&quot;,stdout);</span></span><br><span class="line">    <span class="built_in">read</span>(N,M_in,M_out);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=M_in;++i) <span class="built_in">read</span>(<span class="built_in">ain</span>(i),<span class="built_in">lin</span>(i));</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=M_out;++i) <span class="built_in">read</span>(<span class="built_in">aout</span>(i),<span class="built_in">lout</span>(i));</span><br><span class="line">    <span class="built_in">sort</span>(In+<span class="number">1</span>,In+<span class="number">1</span>+M_in,cmp);</span><br><span class="line">    <span class="built_in">sort</span>(Out+<span class="number">1</span>,Out+<span class="number">1</span>+M_out,cmp);</span><br><span class="line">    <span class="built_in">calc</span>(In,M_in,Res_in);</span><br><span class="line">    <span class="built_in">calc</span>(Out,M_out,Res_out);</span><br><span class="line">    <span class="type">int</span> Ans=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;=N;++i)</span><br><span class="line">    &#123;</span><br><span class="line">    <span class="type">int</span> res=Res_in[i]+Res_out[N-i];</span><br><span class="line">    <span class="built_in">checkMax</span>(Ans,res);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d&quot;</span>,Ans);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">3 5 4</span></span><br><span class="line"><span class="comment">1 5</span></span><br><span class="line"><span class="comment">3 8</span></span><br><span class="line"><span class="comment">6 10</span></span><br><span class="line"><span class="comment">9 14</span></span><br><span class="line"><span class="comment">13 18</span></span><br><span class="line"><span class="comment">2 11</span></span><br><span class="line"><span class="comment">4 15</span></span><br><span class="line"><span class="comment">7 17</span></span><br><span class="line"><span class="comment">12 16</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br></pre></td></tr></table></figure></details><h2 id="P7915-CSP-S-2021-回文"><a href="#P7915-CSP-S-2021-回文" class="headerlink" title="P7915 [CSP-S 2021] 回文"></a><a href="https://www.luogu.com.cn/problem/P7915">P7915 [CSP-S 2021] 回文</a></h2><p>考场暴力，居然只是 T 和 M ，比较顺利。</p><h3 id="暴力思路"><a href="#暴力思路" class="headerlink" title="暴力思路"></a>暴力思路</h3><p>直接 $dfs$ 或者 $bfs$ ，对于一些优化，我后来思考了一下。因为我们要查找的是字典序最小的，所以肯定是优先 $L$ 才会使用 $R$ 。而对于 $bfs$ 而言，大部分的答案都是一并算出来的，所以在比较答案是必须要全部比较，十分消耗时间。而在使用 $dfs$ 的时候，我们可以在前几次搜索时就搜出了一个备选答案，然后可以在中间段的时候就比较当前搜出的答案和原有答案，减少之后的搜索，可能会有一定优化。</p><p><del>后来发现两个方法的得分是一样的</del>。</p><p>还有，<strong>我在此以磐岩起誓，再不用 string</strong>。考场上用了 <code>string</code> ，然后就快快乐乐地 $CE$ 了。起飞， $Dev-C++$ 还没报错。</p><p>一定要用字符数组，方便又快捷。</p><details>    <summary>48pt by dfs</summary><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;ctime&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iomanip&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stack&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;map&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> gh() getchar()</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> re register</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> db double</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> ll;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN=<span class="number">1e6</span>+<span class="number">1</span>;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    x=<span class="number">0</span>;</span><br><span class="line">    <span class="type">char</span> ch=<span class="built_in">gh</span>(),t=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(ch&lt;<span class="string">&#x27;0&#x27;</span>||ch&gt;<span class="string">&#x27;9&#x27;</span>) t|=ch==<span class="string">&#x27;-&#x27;</span>,ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">while</span>(ch&gt;=<span class="string">&#x27;0&#x27;</span>&amp;&amp;ch&lt;=<span class="string">&#x27;9&#x27;</span>) x=(x&lt;&lt;<span class="number">3</span>)+(x&lt;&lt;<span class="number">1</span>)+(ch^<span class="number">48</span>),ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">if</span>(t) x=-x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T,<span class="keyword">class</span> ...T1&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x,T1 &amp;...x1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">read</span>(x),<span class="built_in">read</span>(x1...);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">checkMax</span><span class="params">(T &amp;x,T &amp;y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x&lt;y?x=y,<span class="number">1</span>:<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">checkMin</span><span class="params">(T &amp;x,T &amp;y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x&gt;y?x=y,<span class="number">1</span>:<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> Test,N,Num[MAXN],pos1,pos2;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Que</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="type">int</span> l1,r1,l2,r2;</span><br><span class="line">string res;</span><br><span class="line"><span class="built_in">Que</span>(<span class="type">int</span> l1=<span class="number">0</span>,<span class="type">int</span> r1=<span class="number">0</span>,<span class="type">int</span> l2=<span class="number">0</span>,<span class="type">int</span> r2=<span class="number">0</span>,string res=<span class="string">&quot;\0&quot;</span>):</span><br><span class="line"><span class="built_in">l1</span>(l1),<span class="built_in">r1</span>(r1),<span class="built_in">l2</span>(l2),<span class="built_in">r2</span>(r2),<span class="built_in">res</span>(res)&#123;&#125;</span><br><span class="line">&#125;;</span><br><span class="line">string ans;</span><br><span class="line"><span class="type">int</span> pos[MAXN],tot=<span class="number">0</span>;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dfs</span><span class="params">(<span class="type">int</span> l1,<span class="type">int</span> r1,<span class="type">int</span> l2,<span class="type">int</span> r2,string res)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">if</span>(!ans.<span class="built_in">empty</span>()&amp;&amp;res[res.<span class="built_in">size</span>()<span class="number">-1</span>]&gt;ans[res.<span class="built_in">size</span>()<span class="number">-1</span>]) <span class="keyword">return</span> ;</span><br><span class="line"><span class="keyword">if</span>(res.<span class="built_in">size</span>()==N/<span class="number">2</span>)</span><br><span class="line">&#123;</span><br><span class="line">string str=res;</span><br><span class="line">tot=<span class="number">0</span>;</span><br><span class="line"><span class="type">int</span> l=l1+<span class="number">1</span>,r=r1<span class="number">-1</span>,ls=<span class="number">0</span>,rs=N+<span class="number">1</span>,Cnt=N/<span class="number">2</span>;</span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=Cnt;++i)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span>(str[i<span class="number">-1</span>]==<span class="string">&#x27;L&#x27;</span>) pos[++tot]=Num[++ls];</span><br><span class="line"><span class="keyword">else</span> pos[++tot]=Num[--rs];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=Cnt;++i)</span><br><span class="line">&#123;</span><br><span class="line"><span class="type">int</span> now=N+<span class="number">1</span>-(i+Cnt);</span><br><span class="line"><span class="keyword">if</span>(Num[l]==pos[now])</span><br><span class="line">&#123;</span><br><span class="line">str+=<span class="string">&quot;L&quot;</span>;</span><br><span class="line">++l;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span>(Num[r]==pos[now])</span><br><span class="line">&#123;</span><br><span class="line">str+=<span class="string">&quot;R&quot;</span>;</span><br><span class="line">--r;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">return</span> ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(str.<span class="built_in">size</span>()!=N) <span class="keyword">return</span> ;</span><br><span class="line"><span class="keyword">if</span>(ans.<span class="built_in">empty</span>()) ans=str;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;N;++i)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span>(ans[i]&gt;str[i])</span><br><span class="line">&#123;</span><br><span class="line">ans=str;</span><br><span class="line"><span class="keyword">return</span> ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span>(ans[i]&lt;str[i]) <span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(Num[l2<span class="number">-1</span>]==Num[l1+<span class="number">1</span>]) <span class="built_in">dfs</span>(l1+<span class="number">1</span>,r1,l2<span class="number">-1</span>,r2,res+<span class="string">&quot;L&quot;</span>);</span><br><span class="line"><span class="keyword">if</span>(Num[r2+<span class="number">1</span>]==Num[l1+<span class="number">1</span>]) <span class="built_in">dfs</span>(l1+<span class="number">1</span>,r1,l2,r2+<span class="number">1</span>,res+<span class="string">&quot;L&quot;</span>);</span><br><span class="line"><span class="keyword">if</span>(Num[l2<span class="number">-1</span>]==Num[r1<span class="number">-1</span>]) <span class="built_in">dfs</span>(l1,r1<span class="number">-1</span>,l2<span class="number">-1</span>,r2,res+<span class="string">&quot;R&quot;</span>);</span><br><span class="line"><span class="keyword">if</span>(Num[r2+<span class="number">1</span>]==Num[r1<span class="number">-1</span>]) <span class="built_in">dfs</span>(l1,r1<span class="number">-1</span>,l2,r2+<span class="number">1</span>,res+<span class="string">&quot;R&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="comment">//     freopen(&quot;palin.in&quot;,&quot;r&quot;,stdin);</span></span><br><span class="line"><span class="comment">//     freopen(&quot;palin.out&quot;,&quot;w&quot;,stdout);</span></span><br><span class="line">    <span class="built_in">read</span>(Test);</span><br><span class="line">    <span class="keyword">while</span>(Test--)</span><br><span class="line">    &#123;</span><br><span class="line">    <span class="built_in">read</span>(N);</span><br><span class="line">    ans.<span class="built_in">clear</span>();</span><br><span class="line">    <span class="built_in">memset</span>(pos,<span class="number">0</span>,<span class="built_in">sizeof</span>(pos));</span><br><span class="line">    N&lt;&lt;=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=N;++i) <span class="built_in">read</span>(Num[i]);</span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=N;++i)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span>(Num[i]==Num[<span class="number">1</span>]&amp;&amp;i!=<span class="number">1</span>) pos1=i;</span><br><span class="line"><span class="keyword">if</span>(Num[i]==Num[N]&amp;&amp;i!=N) pos2=i;</span><br><span class="line">&#125;</span><br><span class="line">    <span class="built_in">dfs</span>(<span class="number">1</span>,N+<span class="number">1</span>,pos1,pos1,<span class="string">&quot;L&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span>(ans.<span class="built_in">empty</span>()) <span class="built_in">dfs</span>(<span class="number">0</span>,N,pos2,pos2,<span class="string">&quot;R&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span>(ans.<span class="built_in">empty</span>()) <span class="built_in">printf</span>(<span class="string">&quot;-1\n&quot;</span>);</span><br><span class="line">    <span class="keyword">else</span> cout&lt;&lt;ans&lt;&lt;endl;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">2</span></span><br><span class="line"><span class="comment">5</span></span><br><span class="line"><span class="comment">4 1 2 4 5 3 1 2 3 5</span></span><br><span class="line"><span class="comment">3</span></span><br><span class="line"><span class="comment">3 2 1 2 1 3</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure></details><details>    <summary>48pt by bfs</summary><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;ctime&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iomanip&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stack&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;map&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> gh() getchar()</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> re register</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> db double</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> ll;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN=<span class="number">1e6</span>+<span class="number">1</span>;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    x=<span class="number">0</span>;</span><br><span class="line">    <span class="type">char</span> ch=<span class="built_in">gh</span>(),t=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(ch&lt;<span class="string">&#x27;0&#x27;</span>||ch&gt;<span class="string">&#x27;9&#x27;</span>) t|=ch==<span class="string">&#x27;-&#x27;</span>,ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">while</span>(ch&gt;=<span class="string">&#x27;0&#x27;</span>&amp;&amp;ch&lt;=<span class="string">&#x27;9&#x27;</span>) x=(x&lt;&lt;<span class="number">3</span>)+(x&lt;&lt;<span class="number">1</span>)+(ch^<span class="number">48</span>),ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">if</span>(t) x=-x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T,<span class="keyword">class</span> ...T1&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x,T1 &amp;...x1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">read</span>(x),<span class="built_in">read</span>(x1...);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">checkMax</span><span class="params">(T &amp;x,T &amp;y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x&lt;y?x=y,<span class="number">1</span>:<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">checkMin</span><span class="params">(T &amp;x,T &amp;y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x&gt;y?x=y,<span class="number">1</span>:<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> Test,N,Num[MAXN],pos1,pos2;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Que</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="type">int</span> l1,r1,l2,r2;</span><br><span class="line">string res;</span><br><span class="line"><span class="built_in">Que</span>(<span class="type">int</span> l1=<span class="number">0</span>,<span class="type">int</span> r1=<span class="number">0</span>,<span class="type">int</span> l2=<span class="number">0</span>,<span class="type">int</span> r2=<span class="number">0</span>,string res=<span class="string">&quot;\0&quot;</span>):</span><br><span class="line"><span class="built_in">l1</span>(l1),<span class="built_in">r1</span>(r1),<span class="built_in">l2</span>(l2),<span class="built_in">r2</span>(r2),<span class="built_in">res</span>(res)&#123;&#125;</span><br><span class="line">&#125;;</span><br><span class="line">string ans;</span><br><span class="line"><span class="type">int</span> pos[MAXN],tot=<span class="number">0</span>;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">bfs</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">queue&lt;Que&gt;Q;</span><br><span class="line">Q.<span class="built_in">push</span>(<span class="built_in">Que</span>(<span class="number">1</span>,N+<span class="number">1</span>,pos1,pos1,<span class="string">&quot;L&quot;</span>));</span><br><span class="line">Q.<span class="built_in">push</span>(<span class="built_in">Que</span>(<span class="number">0</span>,N,pos2,pos2,<span class="string">&quot;R&quot;</span>));</span><br><span class="line"><span class="keyword">while</span>(!Q.<span class="built_in">empty</span>())</span><br><span class="line">&#123;</span><br><span class="line">Que u=Q.<span class="built_in">front</span>();</span><br><span class="line">Q.<span class="built_in">pop</span>();</span><br><span class="line"><span class="keyword">if</span>(!ans.<span class="built_in">empty</span>()&amp;&amp;u.res[u.res.<span class="built_in">size</span>()<span class="number">-1</span>]&gt;ans[u.res.<span class="built_in">size</span>()<span class="number">-1</span>]) <span class="keyword">continue</span>;</span><br><span class="line"><span class="keyword">if</span>(u.res.<span class="built_in">size</span>()==N/<span class="number">2</span>)</span><br><span class="line">&#123;</span><br><span class="line">string str=u.res;</span><br><span class="line">tot=<span class="number">0</span>;</span><br><span class="line"><span class="type">int</span> l=u.l1+<span class="number">1</span>,r=u.r1<span class="number">-1</span>,ls=<span class="number">0</span>,rs=N+<span class="number">1</span>,Cnt=N/<span class="number">2</span>;</span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=Cnt;++i)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span>(str[i<span class="number">-1</span>]==<span class="string">&#x27;L&#x27;</span>) pos[++tot]=Num[++ls];</span><br><span class="line"><span class="keyword">else</span> pos[++tot]=Num[--rs];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=Cnt;++i)</span><br><span class="line">&#123;</span><br><span class="line"><span class="type">int</span> now=N+<span class="number">1</span>-(i+Cnt);</span><br><span class="line"><span class="keyword">if</span>(Num[l]==pos[now])</span><br><span class="line">&#123;</span><br><span class="line">str+=<span class="string">&quot;L&quot;</span>;</span><br><span class="line">++l;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span>(Num[r]==pos[now])</span><br><span class="line">&#123;</span><br><span class="line">str+=<span class="string">&quot;R&quot;</span>;</span><br><span class="line">--r;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">continue</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(str.<span class="built_in">size</span>()!=N) <span class="keyword">continue</span>;</span><br><span class="line"><span class="keyword">if</span>(ans.<span class="built_in">empty</span>()) ans=str;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;N;++i)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span>(ans[i]&gt;str[i])</span><br><span class="line">&#123;</span><br><span class="line">ans=str;</span><br><span class="line"><span class="keyword">continue</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span>(ans[i]&lt;str[i]) <span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">continue</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(u.l1&gt;u.l2||u.r1&lt;u.r2) <span class="keyword">continue</span>;</span><br><span class="line"><span class="keyword">if</span>(Num[u.l2<span class="number">-1</span>]==Num[u.l1+<span class="number">1</span>]) Q.<span class="built_in">push</span>(<span class="built_in">Que</span>(u.l1+<span class="number">1</span>,u.r1,u.l2<span class="number">-1</span>,u.r2,u.res+<span class="string">&quot;L&quot;</span>));</span><br><span class="line"><span class="keyword">if</span>(Num[u.r2+<span class="number">1</span>]==Num[u.l1+<span class="number">1</span>]) Q.<span class="built_in">push</span>(<span class="built_in">Que</span>(u.l1+<span class="number">1</span>,u.r1,u.l2,u.r2+<span class="number">1</span>,u.res+<span class="string">&quot;L&quot;</span>));</span><br><span class="line"><span class="keyword">if</span>(Num[u.l2<span class="number">-1</span>]==Num[u.r1<span class="number">-1</span>]) Q.<span class="built_in">push</span>(<span class="built_in">Que</span>(u.l1,u.r1<span class="number">-1</span>,u.l2<span class="number">-1</span>,u.r2,u.res+<span class="string">&quot;R&quot;</span>));</span><br><span class="line"><span class="keyword">if</span>(Num[u.r2+<span class="number">1</span>]==Num[u.r1<span class="number">-1</span>]) Q.<span class="built_in">push</span>(<span class="built_in">Que</span>(u.l1,u.r1<span class="number">-1</span>,u.l2,u.r2+<span class="number">1</span>,u.res+<span class="string">&quot;R&quot;</span>));</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="comment">//     freopen(&quot;palin.in&quot;,&quot;r&quot;,stdin);</span></span><br><span class="line"><span class="comment">//     freopen(&quot;palin.out&quot;,&quot;w&quot;,stdout);</span></span><br><span class="line">    <span class="built_in">read</span>(Test);</span><br><span class="line">    <span class="keyword">while</span>(Test--)</span><br><span class="line">    &#123;</span><br><span class="line">    <span class="built_in">read</span>(N);</span><br><span class="line">    ans.<span class="built_in">clear</span>();</span><br><span class="line">    <span class="built_in">memset</span>(pos,<span class="number">0</span>,<span class="built_in">sizeof</span>(pos));</span><br><span class="line">    N&lt;&lt;=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=N;++i) <span class="built_in">read</span>(Num[i]);</span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=N;++i)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span>(Num[i]==Num[<span class="number">1</span>]&amp;&amp;i!=<span class="number">1</span>) pos1=i;</span><br><span class="line"><span class="keyword">if</span>(Num[i]==Num[N]&amp;&amp;i!=N) pos2=i;</span><br><span class="line">&#125;</span><br><span class="line">    <span class="built_in">bfs</span>();</span><br><span class="line">    <span class="keyword">if</span>(ans.<span class="built_in">empty</span>()) <span class="built_in">printf</span>(<span class="string">&quot;-1\n&quot;</span>);</span><br><span class="line">    <span class="keyword">else</span> cout&lt;&lt;ans&lt;&lt;endl;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">2</span></span><br><span class="line"><span class="comment">5</span></span><br><span class="line"><span class="comment">4 1 2 4 5 3 1 2 3 5</span></span><br><span class="line"><span class="comment">3</span></span><br><span class="line"><span class="comment">3 2 1 2 1 3</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure></details><h3 id="正解"><a href="#正解" class="headerlink" title="正解"></a>正解</h3><p>还是得明知，我们所求的方案必是字典序最小的。而且每当我们取一个数，就会有另一个数被定下。且有 $b_1=\{a_1,a_{2n}\}$ ，那么对于这两个数的数目的另一个数，记作 $a_x$ ，则必有 $b_{2n}=a_x$ ，这样想的话其实应该会很容易，读者可以自行模拟。</p><p>那么，这道题的正解，就是<strong>四指针</strong>法。</p><p>用作两个指针 $l_1,r_1$ 表示 $b$ 数组的头指针指在的是 $a$ 数组的左端和右端。也就表示区间 $[l_1,r_1]$ 还没有被取到过。而另外两个指针 $l_2,r_2$ 则是 $b$ 数组同理的尾指针，表示区间 $[l_2,r_2]$ 之内的数正好是已经被取到过的数的末尾，可以认为是类似于双向 bfs 那样运作的。那么，整个过程满足 $l_1\leq l_2\leq r_2\leq r_1$，当 $l_1=l_2,r_1=r_2$ 时，表示所有数都被取完，则统计答案。</p><p>那如何字典序最小呢，因为一次会记录两个位置，所以有 $LL&lt;LR&lt;RL&lt;RR$ 。对应的情况可以自行思考。当然，前提是转移的两个位置记为 $nxt_1,nxt_2$ 必定满足 $a_{nxt_1}=a_{nxt_2},nxt_1\neq nxt_2$ ，才能够转移，否则不存在答案。我们可以用一个数组 $back[i]$ 表示位置 $i$ 的数 $a_i$ 值的另一个位置在 $back[i]$ 那么，当 $back[nxt_1]=nxt_2$ 或者 $back[nxt_2]=nxt_1$ 时，即可转移。当然，上述两个条件必然是同时满足的，易证。</p><p>这道题的复杂度应该是 $\mathcal{O}(kn)$ ，其中，$k$ 是不超过 $10$ 的常数。</p><details>    <summary>AC Code</summary><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;ctime&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iomanip&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stack&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;map&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> gh() getchar()</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> re register</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> db double</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> ll;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN=<span class="number">1e6</span>+<span class="number">1</span>;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    x=<span class="number">0</span>;</span><br><span class="line">    <span class="type">char</span> ch=<span class="built_in">gh</span>(),t=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(ch&lt;<span class="string">&#x27;0&#x27;</span>||ch&gt;<span class="string">&#x27;9&#x27;</span>) t|=ch==<span class="string">&#x27;-&#x27;</span>,ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">while</span>(ch&gt;=<span class="string">&#x27;0&#x27;</span>&amp;&amp;ch&lt;=<span class="string">&#x27;9&#x27;</span>) x=(x&lt;&lt;<span class="number">3</span>)+(x&lt;&lt;<span class="number">1</span>)+(ch^<span class="number">48</span>),ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">if</span>(t) x=-x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T,<span class="keyword">class</span> ...T1&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x,T1 &amp;...x1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">read</span>(x),<span class="built_in">read</span>(x1...);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">checkMax</span><span class="params">(T &amp;x,T &amp;y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x&lt;y?x=y,<span class="number">1</span>:<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">checkMin</span><span class="params">(T &amp;x,T &amp;y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x&gt;y?x=y,<span class="number">1</span>:<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> Test,N,Num[MAXN];</span><br><span class="line"><span class="type">int</span> pos[MAXN],back[MAXN];</span><br><span class="line"><span class="type">char</span> ans[MAXN];</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">work</span><span class="params">(<span class="type">int</span> l1,<span class="type">int</span> r1,<span class="type">int</span> l2,<span class="type">int</span> r2)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">2</span>;i&lt;=N/<span class="number">2</span>;++i)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span>(l1&lt;l2&amp;&amp;back[l1]==l2)</span><br><span class="line">&#123;</span><br><span class="line">ans[i]=ans[N-i+<span class="number">1</span>]=<span class="string">&#x27;L&#x27;</span>;</span><br><span class="line">++l1,--l2;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span>(l1&lt;r2&amp;&amp;back[l1]==r2)</span><br><span class="line">&#123;</span><br><span class="line">ans[i]=<span class="string">&#x27;L&#x27;</span>,ans[N-i+<span class="number">1</span>]=<span class="string">&#x27;R&#x27;</span>;</span><br><span class="line">++l1,++r2;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span>(r1&gt;l2&amp;&amp;back[r1]==l2)</span><br><span class="line">&#123;</span><br><span class="line">ans[i]=<span class="string">&#x27;R&#x27;</span>,ans[N-i+<span class="number">1</span>]=<span class="string">&#x27;L&#x27;</span>;</span><br><span class="line">--r1,--l2;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span>(r1&gt;r2&amp;&amp;back[r1]==r2)</span><br><span class="line">&#123;</span><br><span class="line">ans[i]=ans[N-i+<span class="number">1</span>]=<span class="string">&#x27;R&#x27;</span>;</span><br><span class="line">--r1,++r2;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line"><span class="comment">/*printf(&quot;%d %d %d %d\n&quot;,l1,r1,l2,r2);</span></span><br><span class="line"><span class="comment">for(int i=1;i&lt;=N;++i) printf(&quot;%c&quot;,ans[i]);</span></span><br><span class="line"><span class="comment">puts(&quot;&quot;);*/</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">print</span><span class="params">(<span class="type">int</span> x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">if</span>(x) <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=N;++i) <span class="built_in">printf</span>(<span class="string">&quot;%c&quot;</span>,ans[i]);</span><br><span class="line"><span class="keyword">else</span> <span class="built_in">printf</span>(<span class="string">&quot;-1&quot;</span>);</span><br><span class="line"><span class="built_in">puts</span>(<span class="string">&quot;&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">solve</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="type">int</span> posL,posR;</span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=N;++i)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span>(Num[i]==Num[<span class="number">1</span>]&amp;&amp;i!=<span class="number">1</span>) posL=i;</span><br><span class="line"><span class="keyword">if</span>(Num[i]==Num[N]&amp;&amp;i!=N) posR=i;</span><br><span class="line"><span class="keyword">if</span>(!pos[Num[i]]) pos[Num[i]]=i;</span><br><span class="line"><span class="keyword">else</span> back[i]=pos[Num[i]],back[pos[Num[i]]]=i;</span><br><span class="line">&#125;</span><br><span class="line">ans[<span class="number">1</span>]=ans[N]=<span class="string">&#x27;L&#x27;</span>;</span><br><span class="line"><span class="type">bool</span> flag=<span class="built_in">work</span>(<span class="number">2</span>,N,posL<span class="number">-1</span>,posL+<span class="number">1</span>);</span><br><span class="line"><span class="keyword">if</span>(flag)</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">print</span>(<span class="number">1</span>);</span><br><span class="line"><span class="keyword">return</span> ;</span><br><span class="line">&#125;</span><br><span class="line">ans[<span class="number">1</span>]=<span class="string">&#x27;R&#x27;</span>,ans[N]=<span class="string">&#x27;L&#x27;</span>;</span><br><span class="line">flag=<span class="built_in">work</span>(<span class="number">1</span>,N<span class="number">-1</span>,posR<span class="number">-1</span>,posR+<span class="number">1</span>);</span><br><span class="line"><span class="keyword">if</span>(flag) <span class="built_in">print</span>(<span class="number">1</span>);</span><br><span class="line"><span class="keyword">else</span> <span class="built_in">print</span>(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="comment">//     freopen(&quot;palin.in&quot;,&quot;r&quot;,stdin);</span></span><br><span class="line"><span class="comment">//     freopen(&quot;palin.out&quot;,&quot;w&quot;,stdout);</span></span><br><span class="line">    <span class="built_in">read</span>(Test);</span><br><span class="line">    <span class="keyword">while</span>(Test--)</span><br><span class="line">    &#123;</span><br><span class="line">    <span class="built_in">read</span>(N);</span><br><span class="line">    N&lt;&lt;=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=N;++i) <span class="built_in">read</span>(Num[i]);</span><br><span class="line"><span class="built_in">memset</span>(pos,<span class="number">0</span>,<span class="built_in">sizeof</span>(pos));</span><br><span class="line"><span class="built_in">memset</span>(back,<span class="number">0</span>,<span class="built_in">sizeof</span>(back));</span><br><span class="line"><span class="built_in">solve</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">2</span></span><br><span class="line"><span class="comment">5</span></span><br><span class="line"><span class="comment">4 1 2 4 5 3 1 2 3 5</span></span><br><span class="line"><span class="comment">3</span></span><br><span class="line"><span class="comment">3 2 1 2 1 3</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br></pre></td></tr></table></figure></details>]]></content>
      
      
      <categories>
          
          <category> 模拟赛/比赛 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 贪心 </tag>
            
            <tag> 双端队列 </tag>
            
            <tag> 模拟 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>字典树</title>
      <link href="/Eternity/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/OI/trie/"/>
      <url>/Eternity/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/OI/trie/</url>
      
        <content type="html"><![CDATA[<p>“当树的轮廓开始浮现，应有的字样也随之而来。”</p><span id="more"></span><p>学习笔记补完计划</p><hr><h2 id="Trie"><a href="#Trie" class="headerlink" title="Trie"></a>Trie</h2><p>中文名<strong>字典树</strong>，也称<strong>前缀树</strong>，是<strong>AC 自动机</strong>的组成部分之二。（另一个是 <a href="https://violeteternal.github.io/Eternity/学习笔记/OI/kmp/">KMP</a> ），用于匹配字符串前缀。大概样子如下图所示：</p><p><img src="https://oi-wiki.org/string/images/trie1.png" alt=""></p><p>对于很多个模式串 $s_i$ ，如果其前缀有相同的部分，则我们就不需要重新创立一些新的节点，而是从两个不同字符串开始不同的地方延申出另一个节点即可。</p><h3 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h3><h4 id="插入"><a href="#插入" class="headerlink" title="插入"></a>插入</h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">insert</span><span class="params">(<span class="type">char</span> *s)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> u=<span class="number">0</span>,len=<span class="built_in">strlen</span>(s+<span class="number">1</span>);<span class="comment">//根节点</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=len;++i)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(!Tre[u][s[i]]) Tre[u][s[i]]=++Cnt;<span class="comment">//建立新节点</span></span><br><span class="line">        u=Tre[u][s[i]];<span class="comment">//往后跳</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h4 id="查询"><a href="#查询" class="headerlink" title="查询"></a>查询</h4><p>该代码主要查询到是当前字符串是否在模式串中做过前缀子串。</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">query</span><span class="params">(<span class="type">char</span> *s)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> u=<span class="number">0</span>,len=<span class="built_in">strlen</span>(s+<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=len;++i)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(!Tre[u][s[i]]) <span class="keyword">return</span> <span class="number">0</span>;<span class="comment">//不存在</span></span><br><span class="line">        u=Tre[u][s[i]];</span><br><span class="line">&#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>;<span class="comment">//存在</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h3 id="例题"><a href="#例题" class="headerlink" title="例题"></a>例题</h3><h4 id="弱化版"><a href="#弱化版" class="headerlink" title="弱化版"></a><a href="https://www.luogu.com.cn/problem/P2580">弱化版</a></h4><p>如上，多了一个 <code>REPEAT</code> 操作。将每一个名字的最后一个字母的位置记为 $End[u]=id$ ，然后每次到达时判断 $vis[End[u]]$ 是否到达过，而判断是 <code>REPEAT</code> 还是 <code>RIGHT</code> 。</p><details>    <summary>AC Code</summary><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;ctime&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iomanip&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stack&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;map&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">int</span> Root,Tot;</span><br><span class="line"><span class="type">bool</span> End[<span class="number">500001</span>*<span class="number">27</span>];</span><br><span class="line"><span class="type">int</span> Son[<span class="number">500001</span>][<span class="number">27</span>];</span><br><span class="line"><span class="type">char</span> str[<span class="number">51</span>];</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">underInsert</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> U=Root;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;str[i];++i)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(!Son[U][str[i]-<span class="string">&#x27;a&#x27;</span>])</span><br><span class="line">        &#123;</span><br><span class="line">            Son[U][str[i]-<span class="string">&#x27;a&#x27;</span>]=++Tot;</span><br><span class="line">        &#125;</span><br><span class="line">        U=Son[U][str[i]-<span class="string">&#x27;a&#x27;</span>];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">underCheck</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> U=Root;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;str[i];++i)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(!Son[U][str[i]-<span class="string">&#x27;a&#x27;</span>])</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;WRONG\n&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> ;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(!str[i+<span class="number">1</span>])</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span>(End[Son[U][str[i]-<span class="string">&#x27;a&#x27;</span>]])</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="built_in">printf</span>(<span class="string">&quot;REPEAT\n&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">            &#123;</span><br><span class="line">                End[Son[U][str[i]-<span class="string">&#x27;a&#x27;</span>]]=<span class="number">1</span>;</span><br><span class="line">                <span class="built_in">printf</span>(<span class="string">&quot;OK\n&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> ;</span><br><span class="line">        &#125;</span><br><span class="line">        U=Son[U][str[i]-<span class="string">&#x27;a&#x27;</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> N,M;</span><br><span class="line">    Root=Tot=<span class="number">1</span>;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;N);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=N;++i)</span><br><span class="line">    &#123;</span><br><span class="line">        cin&gt;&gt;str+<span class="number">1</span>;</span><br><span class="line">        <span class="built_in">underInsert</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;M);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=M;++i)</span><br><span class="line">    &#123;</span><br><span class="line">        cin&gt;&gt;str+<span class="number">1</span>;</span><br><span class="line">        <span class="built_in">underCheck</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">system</span>(<span class="string">&quot;pause&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></details><h4 id="加强版"><a href="#加强版" class="headerlink" title="加强版"></a><a href="https://www.luogu.com.cn/problem/P8306">加强版</a></h4><p>多了大写字母和数字。所以在建树时需要多建一点（小心爆栈）。当然，如果不太清楚会有多少种情况也是可以用 <code>map</code> 的。（这道题 <code>map</code> 会炸，亲测），因为多组数据，所以要预处理，这道题甚至卡了 <code>memset</code> ，所以就需要手动赋值。<del>本题不卡常</del>。</p><details>    <summary>AC Code</summary><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;ctime&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iomanip&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stack&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;map&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> gh() getchar()</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> re register</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> db double</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> ll;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXS=<span class="number">3e6</span>+<span class="number">1</span>;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    x=<span class="number">0</span>;</span><br><span class="line">    <span class="type">char</span> ch=<span class="built_in">gh</span>(),t=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(ch&lt;<span class="string">&#x27;0&#x27;</span>||ch&gt;<span class="string">&#x27;9&#x27;</span>) t|=ch==<span class="string">&#x27;-&#x27;</span>,ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">while</span>(ch&gt;=<span class="string">&#x27;0&#x27;</span>&amp;&amp;ch&lt;=<span class="string">&#x27;9&#x27;</span>) x=(x&lt;&lt;<span class="number">3</span>)+(x&lt;&lt;<span class="number">1</span>)+(ch^<span class="number">48</span>),ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">if</span>(t) x=-x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T,<span class="keyword">class</span> ...T1&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x,T1 &amp;...x1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">read</span>(x),<span class="built_in">read</span>(x1...);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">checkMax</span><span class="params">(T &amp;x,T &amp;y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x&lt;y?x=y,<span class="number">1</span>:<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">checkMin</span><span class="params">(T &amp;x,T &amp;y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x&gt;y?x=y,<span class="number">1</span>:<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> Test,N,Q,Cnt,End[MAXS];</span><br><span class="line"><span class="type">int</span> Tre[MAXS][<span class="number">71</span>],Total;</span><br><span class="line">std::map&lt;<span class="type">char</span>,<span class="type">int</span>&gt;Idx;</span><br><span class="line"><span class="type">char</span> Str[MAXS];</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">insert</span><span class="params">(<span class="type">char</span> *s)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> u=<span class="number">0</span>,len=<span class="built_in">strlen</span>(s+<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=len;++i)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(!Tre[u][Idx[s[i]]]) Tre[u][Idx[s[i]]]=++Cnt;</span><br><span class="line">        u=Tre[u][Idx[s[i]]];</span><br><span class="line">        ++End[u];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">query</span><span class="params">(<span class="type">char</span> *s)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> u=<span class="number">0</span>,len=<span class="built_in">strlen</span>(s+<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=len;++i)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(!Tre[u][Idx[s[i]]]) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        u=Tre[u][Idx[s[i]]];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> End[u];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// freopen(&quot;trie.in&quot;,&quot;r&quot;,stdin);</span></span><br><span class="line">    <span class="comment">// freopen(&quot;trie.out&quot;,&quot;w&quot;,stdout);</span></span><br><span class="line">    <span class="built_in">read</span>(Test);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">char</span> c=<span class="string">&#x27;A&#x27;</span>;c&lt;=<span class="string">&#x27;Z&#x27;</span>;++c) Idx[c]=++Total;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">char</span> c=<span class="string">&#x27;a&#x27;</span>;c&lt;=<span class="string">&#x27;z&#x27;</span>;++c) Idx[c]=++Total;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">char</span> c=<span class="string">&#x27;0&#x27;</span>;c&lt;=<span class="string">&#x27;9&#x27;</span>;++c) Idx[c]=++Total; </span><br><span class="line">    <span class="keyword">while</span>(Test--)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">read</span>(N,Q);Cnt=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=N;++i) <span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>,Str+<span class="number">1</span>),<span class="built_in">insert</span>(Str);</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=Q;++i) <span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>,Str+<span class="number">1</span>),<span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,<span class="built_in">query</span>(Str));</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;=Cnt;++i)</span><br><span class="line">        &#123;</span><br><span class="line">            End[i]=<span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">0</span>;j&lt;=<span class="number">70</span>;++j)</span><br><span class="line">                Tre[i][j]=<span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">3</span></span><br><span class="line"><span class="comment">3 3</span></span><br><span class="line"><span class="comment">fusufusu</span></span><br><span class="line"><span class="comment">fusu</span></span><br><span class="line"><span class="comment">anguei</span></span><br><span class="line"><span class="comment">fusu</span></span><br><span class="line"><span class="comment">anguei</span></span><br><span class="line"><span class="comment">kkksc</span></span><br><span class="line"><span class="comment">5 2</span></span><br><span class="line"><span class="comment">fusu</span></span><br><span class="line"><span class="comment">Fusu</span></span><br><span class="line"><span class="comment">AFakeFusu</span></span><br><span class="line"><span class="comment">afakefusu</span></span><br><span class="line"><span class="comment">fusuisnotfake</span></span><br><span class="line"><span class="comment">Fusu</span></span><br><span class="line"><span class="comment">fusu</span></span><br><span class="line"><span class="comment">1 1</span></span><br><span class="line"><span class="comment">998244353</span></span><br><span class="line"><span class="comment">9</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure></details><hr><h4 id="CF1312G"><a href="#CF1312G" class="headerlink" title="CF1312G"></a><a href="https://www.luogu.com.cn/problem/CF1312G">CF1312G</a></h4><p>按题意建 trie 树，并进行 dp 。</p><details>    <summary>AC Code</summary><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;ctime&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iomanip&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stack&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;map&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> gh() getchar()</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> re register</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> ll;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN=<span class="number">1e6</span>+<span class="number">1</span>;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    x=<span class="number">0</span>;</span><br><span class="line">    <span class="type">char</span> ch=<span class="built_in">gh</span>(),t=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(ch&lt;<span class="string">&#x27;0&#x27;</span>||ch&gt;<span class="string">&#x27;9&#x27;</span>) t|=ch==<span class="string">&#x27;-&#x27;</span>,ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">while</span>(ch&gt;=<span class="string">&#x27;0&#x27;</span>&amp;&amp;ch&lt;=<span class="string">&#x27;9&#x27;</span>) x=(x&lt;&lt;<span class="number">3</span>)+(x&lt;&lt;<span class="number">1</span>)+(ch^<span class="number">48</span>),ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">if</span>(t) x=-x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T,<span class="keyword">class</span> ...T1&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x,T1 &amp;...x1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">read</span>(x),<span class="built_in">read</span>(x1...);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">checkMax</span><span class="params">(T &amp;x,T &amp;y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x&lt;y?x=y,<span class="number">1</span>:<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">checkMin</span><span class="params">(T &amp;x,T &amp;y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x&gt;y?x=y,<span class="number">1</span>:<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> Tre[MAXN&lt;&lt;<span class="number">1</span>][<span class="number">27</span>],N,K;</span><br><span class="line"><span class="type">char</span> str[<span class="number">20</span>];</span><br><span class="line"><span class="type">int</span> Delta,query[MAXN],dp[MAXN];</span><br><span class="line"><span class="type">bool</span> End[MAXN];</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Sk</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> val,id;</span><br><span class="line">    <span class="built_in">Sk</span>(<span class="type">int</span> v=<span class="number">0</span>,<span class="type">int</span> i=<span class="number">0</span>):<span class="built_in">val</span>(v),<span class="built_in">id</span>(i)&#123;&#125;</span><br><span class="line">&#125;;</span><br><span class="line">stack&lt;Sk&gt;S;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Search</span><span class="params">(<span class="type">int</span> u)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">while</span>(S.<span class="built_in">empty</span>()||dp[u]-Delta&lt;S.<span class="built_in">top</span>().val) S.<span class="built_in">push</span>(<span class="built_in">Sk</span>(dp[u]-Delta,u));</span><br><span class="line">    Delta+=End[u];</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;=<span class="number">25</span>;++i)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(!Tre[u][i]) <span class="keyword">continue</span>;</span><br><span class="line">        dp[Tre[u][i]]=dp[u]+<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span>(!S.<span class="built_in">empty</span>()&amp;&amp;End[Tre[u][i]])</span><br><span class="line">            dp[Tre[u][i]]=<span class="built_in">min</span>(dp[Tre[u][i]],S.<span class="built_in">top</span>().val+Delta+<span class="number">1</span>);</span><br><span class="line">        <span class="built_in">Search</span>(Tre[u][i]); </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(!S.<span class="built_in">empty</span>()&amp;&amp;S.<span class="built_in">top</span>().id==u) S.<span class="built_in">pop</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// freopen(&quot;trie.in&quot;,&quot;r&quot;,stdin);</span></span><br><span class="line">    <span class="comment">// freopen(&quot;trie.out&quot;,&quot;w&quot;,stdout);</span></span><br><span class="line">    <span class="built_in">read</span>(N);</span><br><span class="line">    <span class="built_in">memset</span>(dp,<span class="number">0x3f</span>,<span class="built_in">sizeof</span>(dp));</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>,x;i&lt;=N;++i)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">read</span>(x);</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>,str+<span class="number">1</span>);</span><br><span class="line">        Tre[x][str[<span class="number">1</span>]-<span class="string">&#x27;a&#x27;</span>]=i;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">read</span>(K);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=K;++i) <span class="built_in">read</span>(query[i]),End[query[i]]=<span class="number">1</span>;</span><br><span class="line">    dp[<span class="number">0</span>]=<span class="number">0</span>;</span><br><span class="line">    <span class="built_in">Search</span>(<span class="number">0</span>);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=K;++i) <span class="built_in">printf</span>(<span class="string">&quot;%d &quot;</span>,dp[query[i]]);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">10</span></span><br><span class="line"><span class="comment">0 i</span></span><br><span class="line"><span class="comment">1 q</span></span><br><span class="line"><span class="comment">2 g</span></span><br><span class="line"><span class="comment">0 k</span></span><br><span class="line"><span class="comment">1 e</span></span><br><span class="line"><span class="comment">5 r</span></span><br><span class="line"><span class="comment">4 m</span></span><br><span class="line"><span class="comment">5 h</span></span><br><span class="line"><span class="comment">3 p</span></span><br><span class="line"><span class="comment">3 e</span></span><br><span class="line"><span class="comment">5</span></span><br><span class="line"><span class="comment">8 9 1 10 6</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure></details><hr><h2 id="01-Trie"><a href="#01-Trie" class="headerlink" title="01-Trie"></a>01-Trie</h2><p>顾名思义，每一个结点至多有 $2$ 个儿子，一个表示 $1$ ，一个表示 $0$ 。可以用来处理很多与位运算有关的题。</p><h3 id="最长异或路径"><a href="#最长异或路径" class="headerlink" title="最长异或路径"></a><a href="https://www.luogu.com.cn/problem/P4551">最长异或路径</a></h3><p>首先应该知道一些关于位运算的公式：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">x^0=x,x^x=0</span><br></pre></td></tr></table></figure><p>那么，异或运算满足差分性，对于 $d(l,r)$ ，我们可以化成 $d(1,l)\ xor\ d(1,r)$ 来进行预处理以达到 $\mathcal O(1)$ 的复杂度来查询。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1^1=0,1^0=1,0^1=1,0^0=0</span><br></pre></td></tr></table></figure><p>根据异或的性质，我们需要在所有结果中找到位数不相同最多且尽量在高位的两个，但是逐二比较的时间复杂度过高，必须更换形式：</p><p>01-trie 树可以解决这个问题。</p><p>我们将每一个异或值变成一个仅含 $01$ 的字符串并添加到 trie 树里（从高位往低位以满足答案偏大）。对于这些答案，如果有相异的值，则统计入答案，否则继续查找，这样把每一个值都查找一遍其对应值，最后取最大即可。</p><p>时间复杂度是线性的，但带有常数，约为 $\mathcal O(30n)$ 。</p><details>    <summary>AC Code</summary><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;ctime&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iomanip&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stack&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;map&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> gh() getchar()</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> re register</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> ll;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN=<span class="number">2e6</span>+<span class="number">1</span>;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    x=<span class="number">0</span>;</span><br><span class="line">    <span class="type">char</span> ch=<span class="built_in">gh</span>(),t=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(ch&lt;<span class="string">&#x27;0&#x27;</span>||ch&gt;<span class="string">&#x27;9&#x27;</span>) t|=ch==<span class="string">&#x27;-&#x27;</span>,ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">while</span>(ch&gt;=<span class="string">&#x27;0&#x27;</span>&amp;&amp;ch&lt;=<span class="string">&#x27;9&#x27;</span>) x=(x&lt;&lt;<span class="number">3</span>)+(x&lt;&lt;<span class="number">1</span>)+(ch^<span class="number">48</span>),ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">if</span>(t) x=-x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T,<span class="keyword">class</span> ...T1&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x,T1 &amp;...x1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">read</span>(x),<span class="built_in">read</span>(x1...);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">checkMax</span><span class="params">(T &amp;x,T &amp;y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x&lt;y?x=y,<span class="number">1</span>:<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">checkMin</span><span class="params">(T &amp;x,T &amp;y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x&gt;y?x=y,<span class="number">1</span>:<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> N;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Tree</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> next,to,val;</span><br><span class="line">    <span class="built_in">Tree</span>(<span class="type">int</span> n=<span class="number">0</span>,<span class="type">int</span> t=<span class="number">0</span>,<span class="type">int</span> v=<span class="number">0</span>):<span class="built_in">next</span>(n),<span class="built_in">to</span>(t),<span class="built_in">val</span>(v)&#123;&#125;</span><br><span class="line">&#125;Edge[MAXN&lt;&lt;<span class="number">1</span>];</span><br><span class="line"><span class="type">int</span> Head[MAXN],Total;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">addEdge</span><span class="params">(<span class="type">int</span> u,<span class="type">int</span> v,<span class="type">int</span> w)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Edge[++Total]=<span class="built_in">Tree</span>(Head[u],v,w);Head[u]=Total;</span><br><span class="line">    Edge[++Total]=<span class="built_in">Tree</span>(Head[v],u,w);Head[v]=Total;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> Xor[MAXN];</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dpTree</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> last)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> e=Head[x],v;e;e=Edge[e].next)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>((v=Edge[e].to)==last) <span class="keyword">continue</span>;</span><br><span class="line">        Xor[v]=Xor[x]^Edge[e].val;</span><br><span class="line">        <span class="built_in">dpTree</span>(v,x);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> Tre[MAXN][<span class="number">2</span>],Idx,ans;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">Insert</span><span class="params">(<span class="type">int</span> x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> u=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=(<span class="number">1</span>&lt;&lt;<span class="number">30</span>);i;i&gt;&gt;=<span class="number">1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">bool</span> v=x&amp;i;</span><br><span class="line">        <span class="keyword">if</span>(!Tre[u][v]) Tre[u][v]=++Idx;</span><br><span class="line">        u=Tre[u][v];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">query</span><span class="params">(<span class="type">int</span> x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> res=<span class="number">0</span>,u=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=(<span class="number">1</span>&lt;&lt;<span class="number">30</span>);i;i&gt;&gt;=<span class="number">1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">bool</span> v=x&amp;i;</span><br><span class="line">        <span class="keyword">if</span>(Tre[u][!v]) res+=i,u=Tre[u][!v];</span><br><span class="line">        <span class="keyword">else</span> u=Tre[u][v];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// freopen(&quot;01-trie.in&quot;,&quot;r&quot;,stdin);</span></span><br><span class="line">    <span class="comment">// freopen(&quot;01-trie.out&quot;,&quot;w&quot;,stdout);</span></span><br><span class="line">    <span class="built_in">read</span>(N);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">2</span>,u,v,w;i&lt;=N;++i)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">read</span>(u,v,w);</span><br><span class="line">        <span class="built_in">addEdge</span>(u,v,w);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">dpTree</span>(<span class="number">1</span>,<span class="number">0</span>);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=N;++i) <span class="built_in">Insert</span>(Xor[i]);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=N;++i) ans=<span class="built_in">max</span>(ans,<span class="built_in">query</span>(Xor[i]));</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d&quot;</span>,ans);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">4</span></span><br><span class="line"><span class="comment">1 2 3</span></span><br><span class="line"><span class="comment">2 3 4</span></span><br><span class="line"><span class="comment">2 4 6</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure></details><hr><h2 id="可持久化-Trie"><a href="#可持久化-Trie" class="headerlink" title="可持久化 Trie"></a>可持久化 Trie</h2><p>其思想和主席树是有类似的，对于原有的部分直接牵引，而无需新建结点来浪费空间。</p><p>建树步骤（插入字符串 $s$ ）：</p><ol><li>设当前树的根节点为 $rt$ ，令 $p=rt,i=0$ ；</li><li>建立新的节点 $q$ ，并执行 $rt’=q$ ；</li><li>若 $p\ne 0$ ，则有 $Trie[q][c]=Trie[p][c]$ ；</li><li>建立新的节点 $q’$ ，令 $Trie[q][s_i]=q’$ 。即除了 $s_i$ 的指针不同，$p$ 和 $q$ 保持一致；</li><li>令 $p=Trie[p][s_i],q=Trie[q][s_i],i=i+1$ ；</li><li>重复步骤 $3\sim 5$ 直到字符串遍历完成。</li></ol><p>构建可持久化 $\text{Trie}$ 树所需的空间和时间复杂度都是字符串总长度的线性函数。</p><h3 id="可持久化字典树"><a href="#可持久化字典树" class="headerlink" title="可持久化字典树"></a><a href="https://www.luogu.com.cn/problem/U236173">可持久化字典树</a></h3><p>数据可能有些问题，我也不太清楚自己写对没有，而且感觉好像暴力了。</p><p>$\text{RE,TLE,MLE}$ 交替表演。</p><p>所以，题面可以给出一个思考，但代码和数据的可行度，不太高。</p><p>欢迎各种方式的 $\text{Hack}$ 。</p><h3 id="最大异或和"><a href="#最大异或和" class="headerlink" title="最大异或和"></a><a href="https://www.luogu.com.cn/problem/P4735">最大异或和</a></h3><p>对于查询，很明显有 $a[p]\ xor\ a[p+1]\ xor…\ xor\ a[N]\ xor\ x=s[p-1]\ xor\ s[N]\ xor\ x$ 的性质。</p><p>然后使用类似于 $\text{01-Trie}$ 的方法将所有的 $s$ 都插入到树中，查询其最大值，但是要满足于 $l\le p\le r$ 的条件，所以考虑可持久化。</p><p><del>余下的我也没学懂，贺过去的，想学的自己看题解吧。qwq</del></p><details>    <summary>AC Code</summary><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;ctime&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iomanip&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stack&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;map&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> gh() getchar()</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> re register</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> ll;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN=<span class="number">6e5</span>+<span class="number">1</span>;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    x=<span class="number">0</span>;</span><br><span class="line">    <span class="type">char</span> ch=<span class="built_in">gh</span>(),t=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(ch&lt;<span class="string">&#x27;0&#x27;</span>||ch&gt;<span class="string">&#x27;9&#x27;</span>) t|=ch==<span class="string">&#x27;-&#x27;</span>,ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">while</span>(ch&gt;=<span class="string">&#x27;0&#x27;</span>&amp;&amp;ch&lt;=<span class="string">&#x27;9&#x27;</span>) x=(x&lt;&lt;<span class="number">3</span>)+(x&lt;&lt;<span class="number">1</span>)+(ch^<span class="number">48</span>),ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">if</span>(t) x=-x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T,<span class="keyword">class</span> ...T1&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x,T1 &amp;...x1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">read</span>(x),<span class="built_in">read</span>(x1...);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">checkMax</span><span class="params">(T &amp;x,T &amp;y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x&lt;y?x=y,<span class="number">1</span>:<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">checkMin</span><span class="params">(T &amp;x,T &amp;y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x&gt;y?x=y,<span class="number">1</span>:<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> N,M;</span><br><span class="line"><span class="type">int</span> Trie[MAXN*<span class="number">24</span>][<span class="number">2</span>],End[MAXN*<span class="number">24</span>];</span><br><span class="line"><span class="type">int</span> S[MAXN],Rt[MAXN],Idx;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Insert</span><span class="params">(<span class="type">int</span> i,<span class="type">int</span> k,<span class="type">int</span> p,<span class="type">int</span> q)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(k&lt;<span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        End[q]=i;</span><br><span class="line">        <span class="keyword">return</span> ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> c=S[i]&gt;&gt;k&amp;<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span>(p) Trie[q][c^<span class="number">1</span>]=Trie[p][c^<span class="number">1</span>];</span><br><span class="line">    Trie[q][c]=++Idx;</span><br><span class="line">    <span class="built_in">Insert</span>(i,k<span class="number">-1</span>,Trie[p][c],Trie[q][c]);</span><br><span class="line">    End[q]=<span class="built_in">max</span>(End[Trie[q][<span class="number">0</span>]],End[Trie[q][<span class="number">1</span>]]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">query</span><span class="params">(<span class="type">int</span> now,<span class="type">int</span> val,<span class="type">int</span> k,<span class="type">int</span> inf)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(k&lt;<span class="number">0</span>) <span class="keyword">return</span> S[End[now]]^val;</span><br><span class="line">    <span class="type">int</span> c=val&gt;&gt;k&amp;<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span>(End[Trie[now][c^<span class="number">1</span>]]&gt;=inf)</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">query</span>(Trie[now][c^<span class="number">1</span>],val,k<span class="number">-1</span>,inf);</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">return</span> <span class="built_in">query</span>(Trie[now][c],val,k<span class="number">-1</span>,inf);</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">char</span> opt[<span class="number">3</span>];</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// freopen(&quot;trie.in&quot;,&quot;r&quot;,stdin);</span></span><br><span class="line">    <span class="comment">// freopen(&quot;trie.out&quot;,&quot;w&quot;,stdout);</span></span><br><span class="line">    <span class="built_in">read</span>(N,M);</span><br><span class="line">    End[<span class="number">0</span>]=<span class="number">-1</span>;Rt[<span class="number">0</span>]=++Idx;</span><br><span class="line">    <span class="built_in">Insert</span>(<span class="number">0</span>,<span class="number">23</span>,<span class="number">0</span>,Rt[<span class="number">0</span>]);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>,x;i&lt;=N;++i)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">read</span>(x);</span><br><span class="line">        S[i]=S[i<span class="number">-1</span>]^x;</span><br><span class="line">        Rt[i]=++Idx;</span><br><span class="line">        <span class="built_in">Insert</span>(i,<span class="number">23</span>,Rt[i<span class="number">-1</span>],Rt[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=M;++i)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>,opt+<span class="number">1</span>);</span><br><span class="line">        <span class="keyword">if</span>(opt[<span class="number">1</span>]==<span class="string">&#x27;A&#x27;</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="type">int</span> Qx;<span class="built_in">read</span>(Qx);</span><br><span class="line">            Rt[++N]=++Idx;</span><br><span class="line">            S[N]=S[N<span class="number">-1</span>]^Qx;</span><br><span class="line">            <span class="built_in">Insert</span>(N,<span class="number">23</span>,Rt[N<span class="number">-1</span>],Rt[N]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="type">int</span> Ql,Qr,Qx;<span class="built_in">read</span>(Ql,Qr,Qx);</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,<span class="built_in">query</span>(Rt[Qr<span class="number">-1</span>],Qx^S[N],<span class="number">23</span>,Ql<span class="number">-1</span>));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">5 5</span></span><br><span class="line"><span class="comment">2 6 4 3 6</span></span><br><span class="line"><span class="comment">A 1 </span></span><br><span class="line"><span class="comment">Q 3 5 4 </span></span><br><span class="line"><span class="comment">A 4</span></span><br><span class="line"><span class="comment">Q 5 7 0 </span></span><br><span class="line"><span class="comment">Q 3 6 6 </span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure></details><hr>]]></content>
      
      
      <categories>
          
          <category> 学习笔记 </category>
          
          <category> OI </category>
          
      </categories>
      
      
        <tags>
            
            <tag> String </tag>
            
            <tag> 字符串 </tag>
            
            <tag> 图论 </tag>
            
            <tag> 数据结构 </tag>
            
            <tag> 树型结构 </tag>
            
            <tag> 构造 </tag>
            
            <tag> Trie树 </tag>
            
            <tag> 字典树 </tag>
            
            <tag> 字典图 </tag>
            
            <tag> 可持久化数据结构 </tag>
            
            <tag> 字符串匹配 </tag>
            
            <tag> 01-Trie </tag>
            
            <tag> 可持久化Trie </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>自动机&amp;最小表示法</title>
      <link href="/Eternity/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/OI/automaton/"/>
      <url>/Eternity/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/OI/automaton/</url>
      
        <content type="html"><![CDATA[<p>“能不能 $ \text{AC} $ 我不知道，自动倒是挺自动的。”</p><span id="more"></span><h2 id="最小表示法"><a href="#最小表示法" class="headerlink" title="最小表示法"></a>最小表示法</h2><h3 id="同构字符串"><a href="#同构字符串" class="headerlink" title="同构字符串"></a>同构字符串</h3><p>对于一个字符串 $S$ ，如果存在另一个字符串满足 $S_1\neq S$ ，但是将 $S$ 与 $S_1$ 无限循环之后的母串相同，则称 $S$ 与 $S_1$ 为同构字符串。如下：</p><p>$abca,bcaa,caab,aabc$ 则为该串的 $4$ 个循环同构字符串。</p><h3 id="字符串的最小表示"><a href="#字符串的最小表示" class="headerlink" title="字符串的最小表示"></a>字符串的最小表示</h3><p>对于一个字符串 $S[1\sim n]$ 与其所有的循环同构字符串中字典序最小的一个，称之为 $S$ 的最小表示。则对于上述循环同构字符串而言，其最小表示则为 $aabc$ 。</p><p>那么，怎么求最小表示呢？</p><hr><p>很显然的一种思路是将这 $N$ 个字符串构造出来，然后逐一比较，这是最朴素的办法。时间复杂度会退化到 $\mathcal O(n^2)$ ，是极度不明智的做法。</p><p>我们可以使用<strong>指针扫描法</strong>，两两进行比对，当我们比较 $s[i]$ 和 $s[j]$ 时 ，直接向后扫描，依次取出 $k=0,1,2…,n$ 直到 $s[i+k]\neq s[j+k]$ ，然后进行比较。</p><p>那么，当 $s[i+k]\neq s[j+k]$ 时，如果 $s[i+k]&gt;s[j+k]$ ，我们就可以知道 $s[i]$ 不会成为最小表示，因为 $s[j]&gt;s[i]$ 是必然的。同理，我们也可以推出 $\forall 1\leq p\leq k,s[i+p]$ 都不会成为最小表示，因为这些字符串都包含了 $s[i+k]$ 并且满足 $s[i+k]&gt;s[j+k]$ ，所以可以直接排除这些字符串的比较，也就可以直接执行 <code>i=i+k+1;</code> 一步。同样的，当 $s[i+k]&lt;s[j+k]$ 时，执行 <code>j=j+k+1;</code> 即可。而 $ans=\min(i,j)$ 中的 $ans$ 即使最小表示字符串的头指针。</p><p>对于其复杂度，因为运行的限制条件在于 $i\leq n,j\leq n$ ，而 $i,j$ 必有其一在每一次运行中前进至少一步，则有 $i,j$ 总共移动次数不会超过 $2n$ ，那同理，时间复杂度就不会超过 $\mathcal O(n)$ ，我们就可以在线性时间内解决掉这个问题。</p><p>当然，为了不漏掉所有的字符串，我们需要在开始对字符串进行扩倍处理。</p><p>参考代码：</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span>(re <span class="type">int</span> i=<span class="number">1</span>;i&lt;=N;++i) <span class="built_in">read</span>(val[i]),val[i+N]=val[i];</span><br><span class="line"><span class="keyword">while</span>(i&lt;=N&amp;&amp;j&lt;=N)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">for</span>(k=<span class="number">0</span>;k&lt;N&amp;&amp;val[i+k]==val[j+k];++k);</span><br><span class="line">    <span class="keyword">if</span>(k==N) <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">if</span>(val[i+k]&gt;val[j+k])</span><br><span class="line">    &#123;</span><br><span class="line">        i=i+k+<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span>(i==j) ++i;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        j=j+k+<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span>(i==j) ++j;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> ans=<span class="built_in">min</span>(i,j);</span><br></pre></td></tr></table></figure><p>对于 <code>if(k==N) break;</code> 的解释，是指当前字符串存在循环节，且 $i,j$ 恰好处于两个不同循环节的同一位置，导致之后的匹配全部成功。显然的，因为我们进行了扩倍，所以，当前字符串必定存在循环节且循环长度为 $n$ ，如果还尚不是很明白，读者可以自行纸上模拟，我想，最小表示法的纸上模拟应该还是比较简单的。</p><h3 id="例题"><a href="#例题" class="headerlink" title="例题"></a>例题</h3><h4 id="Luogu-P1368"><a href="#Luogu-P1368" class="headerlink" title="Luogu P1368"></a><a href="https://www.luogu.com.cn/problem/P1368">Luogu P1368</a></h4><p>将字符串转化为数组，其余不变。</p><details>    <summary>AC Code</summary><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;ctime&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iomanip&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stack&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;map&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> gh() getchar()</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> re register</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> db double</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> ll;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN=<span class="number">3e5</span>+<span class="number">1</span>;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    x=<span class="number">0</span>;</span><br><span class="line">    <span class="type">char</span> ch=<span class="built_in">gh</span>(),t=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(ch&lt;<span class="string">&#x27;0&#x27;</span>||ch&gt;<span class="string">&#x27;9&#x27;</span>) t|=ch==<span class="string">&#x27;-&#x27;</span>,ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">while</span>(ch&gt;=<span class="string">&#x27;0&#x27;</span>&amp;&amp;ch&lt;=<span class="string">&#x27;9&#x27;</span>) x=(x&lt;&lt;<span class="number">3</span>)+(x&lt;&lt;<span class="number">1</span>)+(ch^<span class="number">48</span>),ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">if</span>(t) x=-x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T,<span class="keyword">class</span> ...T1&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x,T1 &amp;...x1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">read</span>(x),<span class="built_in">read</span>(x1...);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">checkMax</span><span class="params">(T &amp;x,T &amp;y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x&lt;y?x=y,<span class="number">1</span>:<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">checkMin</span><span class="params">(T &amp;x,T &amp;y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x&gt;y?x=y,<span class="number">1</span>:<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> N,val[MAXN&lt;&lt;<span class="number">2</span>];</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// freopen(&quot;string.in&quot;,&quot;r&quot;,stdin);</span></span><br><span class="line">    <span class="comment">// freopen(&quot;string.out&quot;,&quot;w&quot;,stdout);</span></span><br><span class="line">    <span class="built_in">read</span>(N);</span><br><span class="line">    <span class="keyword">for</span>(re <span class="type">int</span> i=<span class="number">1</span>;i&lt;=N;++i) <span class="built_in">read</span>(val[i]),val[i+N]=val[i];</span><br><span class="line">    <span class="type">int</span> i=<span class="number">1</span>,j=<span class="number">2</span>,k;</span><br><span class="line">    <span class="keyword">while</span>(i&lt;=N&amp;&amp;j&lt;=N)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">for</span>(k=<span class="number">0</span>;k&lt;N&amp;&amp;val[i+k]==val[j+k];++k);</span><br><span class="line">        <span class="keyword">if</span>(k==N) <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">if</span>(val[i+k]&gt;val[j+k])</span><br><span class="line">        &#123;</span><br><span class="line">            i=i+k+<span class="number">1</span>;</span><br><span class="line">            <span class="keyword">if</span>(i==j) ++i;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            j=j+k+<span class="number">1</span>;</span><br><span class="line">            <span class="keyword">if</span>(i==j) ++j;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> ans=<span class="built_in">min</span>(i,j);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> l=ans;l&lt;ans+N;++l) <span class="built_in">printf</span>(<span class="string">&quot;%d &quot;</span>,val[l]);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure></details><hr><h2 id="自动机"><a href="#自动机" class="headerlink" title="自动机"></a>自动机</h2><p>前汁芝士：图论。</p><p>自动机，一般指“确定有限状态自动机”（称之为 <strong>DFA</strong> ）。<a href="https://oi-wiki.org/string/automaton/">OI Wiki</a>上的解释大概是：</p><blockquote><p>首先理解一下自动机是用来干什么的：自动机是一个对信号序列进行判定的数学模型。</p><p>这句话涉及到的名词比较多，逐一解释一下。“信号序列”是指一连串有顺序的信号，例如字符串从前到后的每一个字符、数组从 1 到 n 的每一个数、数从高到低的每一位等。“判定”是指针对某一个命题给出或真或假的回答。有时我们需要对一个信号序列进行判定。一个简单的例子就是判定一个二进制数是奇数还是偶数，较复杂的例子例如判定一个字符串是否回文，判定一个字符串是不是某个特定字符串的子序列等等。</p><p>自动机的工作原理和地图很类似。假设你在你家，然后你从你家到学校，按顺序经过了很多路口。每个路口都有岔路，而你在所有这些路口的选择就构成了一个序列。</p><p>例如，你的选择序列是“家门 -&gt; 右拐 -&gt; 萍水西街 -&gt; 尚园街 -&gt; 古墩路 -&gt; 地铁站 -&gt; 下宁桥”，那你按顺序经过的路口可能是“家 -&gt; 家门口 -&gt; 萍水西街竞舟北路口 -&gt; 萍水西街尚圆街路口 -&gt; 尚园街古墩路口 -&gt; 古墩路中 -&gt; 三坝地铁站 -&gt; 下宁桥地铁站”。可以发现，上学的选择序列不止这一个。同样要去地铁站，你还可以从竞舟北路绕道，或者横穿文鼎苑抄近路。</p><p>而我们如果找到一个选择序列，就可以在地图上比划出这个选择序列能不能去学校。比如，如果一个选择序列是“家门 -&gt; 右拐 -&gt; 萍水西街 -&gt; 尚园街 -&gt; 古墩路 -&gt; 地铁站 -&gt; 钱江路 -&gt; 四号线站台 -&gt; 联庄”，那么它就不会带你去同一个学校，但是仍旧可能是一个可被接受的序列，因为目标地点可能不止一个。</p><p>也就是说，我们通过这个地图和一组目的地，将信号序列分成了三类，一类是无法识别的信号序列（例如“家门 -&gt; ???”），一类是能去学校的信号序列，另一类是不能的信号序列。我们将所有合法的信号序列分成了两类，完成了一个判定问题。</p><p>既然自动机是一个数学模型，那么显然不可能是一张地图。对地图进行抽象之后，可以简化为一个有向图。因此，自动机的结构就是一张有向图。</p><p>而自动机的工作方式和流程图类似，不同的是：自动机的每一个结点都是一个判定结点；自动机的结点只是一个单纯的状态而非任务；自动机的边可以接受多种字符（不局限于 T 或 F）。</p><p>从起始结点开始，从高到低接受这个数的二进制序列，然后看最终停在哪里。如果最终停在红圈结点，则是偶数，否则不是。</p><p>如果需要判定一个有限的信号序列和另外一个信号序列的关系（例如另一个信号序列是不是某个信号序列的子序列），那么常用的方法是针对那个有限的信号序列构建一个自动机。这个在学习 KMP 的时候会讲到。</p><p>需要注意的是，自动机只是一个 <strong>数学模型</strong>，而 <strong>不是算法</strong>，也 <strong>不是数据结构</strong>。实现同一个自动机的方法有很多种，可能会有不一样的时空复杂度。</p><p>接下来你可以选择继续看自动机的形式化定义，也可以去学习 <a href="https://oi-wiki.org/string/kmp/">KMP</a>、<a href="https://oi-wiki.org/string/ac-automaton/">AC 自动机</a> 或 <a href="https://oi-wiki.org/string/sam/">SAM</a>。</p></blockquote><h3 id="形式化定义"><a href="#形式化定义" class="headerlink" title="形式化定义"></a>形式化定义</h3><ol><li>字符集 $\sum$ ，指该自动机能且仅能输入这些字符。</li><li>状态集合 $Q$ ，如果把 DFA 看做是一个有向图，那么 $Q$ 则是图上点的集合。</li><li>起始状态 $start$ ，满足 $start\in Q$ ，字面意思。</li><li>接受状态集合 $F$ ，满足 $F\subseteq Q$ ，似乎是一种特殊状态。</li><li>转移函数 $\delta$ ，可以看做是有向图的边，而边权是一个字母 $c$ ，走过这条边，则会在字符串后加上一个字符 $c$ 。</li></ol><p>总而言之，自动机的学习并不在于自动机本身，而是以自动机为后缀名的一系列数据结构的学习。</p><hr><h2 id="AC自动机-AC-automaton"><a href="#AC自动机-AC-automaton" class="headerlink" title="AC自动机(AC-automaton)"></a>AC自动机(AC-automaton)</h2><p><del>说实话，我一直以为这是一个可以帮我自动 AC 的机器。</del>天底下哪有比这还强的算法？？？</p><p>言归正传， <strong>AC 自动机</strong>是一种多模式串匹配算法。可以自行去了解一下<a href="https://oi-wiki.org/string/automaton/">自动机</a>，反正我是没看太懂。用机房冬神的话来说，<strong>AC 自动机就是在 Trie 树上实现 KMP </strong>。那么，前汁芝士当然就是 Trie 树和 <a href="https://violeteternal.github.io/Eternity/学习笔记/OI/kmp/">KMP</a> 啦。</p><p>那么步骤也就如出一辙了。</p><ol><li>建树：将要读入的所有预处理字符串构造出一棵字典树(Trie-Tree)出来。</li><li>适配&amp;失配：对字典树的所有节点构造其失配指针。</li><li>匹配：读入模式串，进行匹配。</li></ol><h3 id="步骤"><a href="#步骤" class="headerlink" title="步骤"></a>步骤</h3><h4 id="建树"><a href="#建树" class="headerlink" title="建树"></a>建树</h4><p>方法同字典树建树一样，将 n 个匹配串插入字典树即可。</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">addString</span><span class="params">(<span class="type">char</span> *s)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> u=<span class="number">0</span>,len=<span class="built_in">strlen</span>(s+<span class="number">1</span>);<span class="comment">//约定0为空根节点，字符串从1开始</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>,c;i&lt;=len;++i)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(!ch[u][(c=s[i]-<span class="string">&#x27;a&#x27;</span>)]) ch[u][c]=++cnt;</span><br><span class="line">        u=ch[u][c];</span><br><span class="line">&#125;</span><br><span class="line">    ++End[u];<span class="comment">//记录尾结点为u的字串的个数</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="失配"><a href="#失配" class="headerlink" title="失配"></a>失配</h4><p>类似于 KMP 的配对方式，但又因为 Trie 树的模式串并不止一个，所以单独的匹配是不行的，而对于一个节点 $u$ ，其失配指针 $Fail[u]$ 可以满足的是其深度绝对比 $u$ 小。所以我们应该按照深度优先的顺序来进行失配，那也就自然而然地联想到 bfs 的使用了。使用 bfs 可以保证当我们配对 $u$ 的时候，其 $Fail[u]$ 点一定已经被配过了。</p><p>设 $u$ 到 $u$  的儿子转移边上的字母是 $C$ ，则一直跳到节点 $v$ ，满足存在一条转移边是 $C$ ，那么就把 $u$ 的这个转移边的所指结点的失配指针指向 $v$ 的这条转移边所指的节点。如果直到根都没找到，则有 $Fail[u]=Root$ 即可。</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">compare</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    queue&lt;<span class="type">int</span>&gt;Q;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;<span class="number">26</span>;++i) <span class="keyword">if</span>(ch[<span class="number">0</span>][i]) Q.<span class="built_in">push</span>(ch[<span class="number">0</span>][i]);</span><br><span class="line">    <span class="comment">//放入根节点</span></span><br><span class="line">    <span class="keyword">while</span>(!Q.<span class="built_in">empty</span>())</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> u=Q.<span class="built_in">front</span>();Q.<span class="built_in">pop</span>();</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;<span class="number">26</span>;++i)<span class="comment">//遍历u的儿子</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span>(!ch[u][i]) ch[u][i]=ch[Fail[u]][i];</span><br><span class="line">            <span class="comment">//没有该边，直接相连</span></span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">            &#123;</span><br><span class="line">                Q.<span class="built_in">push</span>(ch[u][i]);</span><br><span class="line">                Fail[ch[u][i]]=ch[Fail[u]][i];</span><br><span class="line">                <span class="comment">//失配</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="查询"><a href="#查询" class="headerlink" title="查询"></a>查询</h4><p>依照 kmp 的方法查找母串中模式串的个数就行了。</p><p>这里是查询存在次数的代码：</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">calc</span><span class="params">(<span class="type">char</span> *s)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> u=<span class="number">0</span>,len=<span class="built_in">strlen</span>(s+<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=len;++i)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> c=s[i]-<span class="string">&#x27;a&#x27;</span>;</span><br><span class="line">        u=ch[u][c];</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j=u;j&amp;&amp;End[j]!=<span class="number">-1</span>;j=Fail[j])</span><br><span class="line">            ans+=End[j],End[j]=<span class="number">-1</span>;<span class="comment">//避免重复</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h3 id="例题-1"><a href="#例题-1" class="headerlink" title="例题"></a>例题</h3><h4 id="Luogu-P3808"><a href="#Luogu-P3808" class="headerlink" title="Luogu P3808"></a><a href="https://www.luogu.com.cn/problem/P3808">Luogu P3808</a></h4><p>如上所言。</p><details>    <summary>AC Code</summary><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;ctime&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iomanip&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stack&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;map&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> gh() getchar()</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> re register</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> db double</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> ll;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN=<span class="number">1e6</span>+<span class="number">1</span>;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    x=<span class="number">0</span>;</span><br><span class="line">    <span class="type">char</span> ch=<span class="built_in">gh</span>(),t=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(ch&lt;<span class="string">&#x27;0&#x27;</span>||ch&gt;<span class="string">&#x27;9&#x27;</span>) t|=ch==<span class="string">&#x27;-&#x27;</span>,ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">while</span>(ch&gt;=<span class="string">&#x27;0&#x27;</span>&amp;&amp;ch&lt;=<span class="string">&#x27;9&#x27;</span>) x=(x&lt;&lt;<span class="number">3</span>)+(x&lt;&lt;<span class="number">1</span>)+(ch^<span class="number">48</span>),ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">if</span>(t) x=-x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T,<span class="keyword">class</span> ...T1&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x,T1 &amp;...x1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">read</span>(x),<span class="built_in">read</span>(x1...);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">checkMax</span><span class="params">(T &amp;x,T &amp;y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x&lt;y?x=y,<span class="number">1</span>:<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">checkMin</span><span class="params">(T &amp;x,T &amp;y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x&gt;y?x=y,<span class="number">1</span>:<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> N,ch[MAXN][<span class="number">30</span>];</span><br><span class="line"><span class="type">int</span> ans,cnt,Fail[MAXN],son[MAXN];</span><br><span class="line"><span class="type">char</span> str[MAXN];</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">addString</span><span class="params">(<span class="type">char</span> *s)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> u=<span class="number">0</span>,len=<span class="built_in">strlen</span>(s+<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=len;++i)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> c=s[i]-<span class="string">&#x27;a&#x27;</span>;</span><br><span class="line">        <span class="keyword">if</span>(!ch[u][c]) ch[u][c]=++cnt;</span><br><span class="line">        u=ch[u][c];</span><br><span class="line">    &#125;</span><br><span class="line">    ++son[u];</span><br><span class="line">    <span class="keyword">return</span> ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">compare</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    queue&lt;<span class="type">int</span>&gt;Q;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;<span class="number">26</span>;++i) <span class="keyword">if</span>(ch[<span class="number">0</span>][i]) Q.<span class="built_in">push</span>(ch[<span class="number">0</span>][i]);</span><br><span class="line">    <span class="keyword">while</span>(!Q.<span class="built_in">empty</span>())</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> u=Q.<span class="built_in">front</span>();Q.<span class="built_in">pop</span>();</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;<span class="number">26</span>;++i)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span>(!ch[u][i]) ch[u][i]=ch[Fail[u]][i];</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">            &#123;</span><br><span class="line">                Q.<span class="built_in">push</span>(ch[u][i]);</span><br><span class="line">                Fail[ch[u][i]]=ch[Fail[u]][i];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">calc</span><span class="params">(<span class="type">char</span> *s)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> u=<span class="number">0</span>,len=<span class="built_in">strlen</span>(s+<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=len;++i)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> c=s[i]-<span class="string">&#x27;a&#x27;</span>;</span><br><span class="line">        u=ch[u][c];</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j=u;j&amp;&amp;son[j]!=<span class="number">-1</span>;j=Fail[j]) ans+=son[j],son[j]=<span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// freopen(&quot;AC-automaton.in&quot;,&quot;r&quot;,stdin);</span></span><br><span class="line">    <span class="comment">// freopen(&quot;AC-automaton.out&quot;,&quot;w&quot;,stdout);</span></span><br><span class="line">    <span class="built_in">read</span>(N);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=N;++i)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>,str+<span class="number">1</span>);</span><br><span class="line">        <span class="built_in">addString</span>(str);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">compare</span>();</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>,str+<span class="number">1</span>);</span><br><span class="line">    <span class="built_in">calc</span>(str);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d&quot;</span>,ans);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">4</span></span><br><span class="line"><span class="comment">a</span></span><br><span class="line"><span class="comment">ab</span></span><br><span class="line"><span class="comment">ac</span></span><br><span class="line"><span class="comment">abc</span></span><br><span class="line"><span class="comment">abcd</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure></details><hr><h4 id="Luogu-P3796-加强版"><a href="#Luogu-P3796-加强版" class="headerlink" title="Luogu P3796 加强版"></a><a href="https://www.luogu.com.cn/problem/P3796">Luogu P3796 加强版</a></h4><p>从统计所有，到分开统计，我们可以多使用一个数组 $Idx[x]$ 表示以节点 $x$ 结束的模式串的编号是多少。然后在查询的时候，然后在 $T[i]$ 中统计每一个编号所匹配的所有子串的个数，最后当该点的 $Idx[u]$ 有确值，统计进 $Cnt[Idx[u]]$ 即可。</p><details>    <summary>AC Code</summary><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;ctime&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iomanip&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stack&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;map&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> gh() getchar()</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> re register</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> db double</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> ll;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN=<span class="number">151</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXS=<span class="number">71</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXT=<span class="number">1e6</span>+<span class="number">1</span>;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    x=<span class="number">0</span>;</span><br><span class="line">    <span class="type">char</span> ch=<span class="built_in">gh</span>(),t=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(ch&lt;<span class="string">&#x27;0&#x27;</span>||ch&gt;<span class="string">&#x27;9&#x27;</span>) t|=ch==<span class="string">&#x27;-&#x27;</span>,ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">while</span>(ch&gt;=<span class="string">&#x27;0&#x27;</span>&amp;&amp;ch&lt;=<span class="string">&#x27;9&#x27;</span>) x=(x&lt;&lt;<span class="number">3</span>)+(x&lt;&lt;<span class="number">1</span>)+(ch^<span class="number">48</span>),ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">if</span>(t) x=-x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T,<span class="keyword">class</span> ...T1&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x,T1 &amp;...x1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">read</span>(x),<span class="built_in">read</span>(x1...);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">checkMax</span><span class="params">(T &amp;x,T &amp;y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x&lt;y?x=y,<span class="number">1</span>:<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">checkMin</span><span class="params">(T &amp;x,T &amp;y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x&gt;y?x=y,<span class="number">1</span>:<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> N,Test;</span><br><span class="line"><span class="type">char</span> str[MAXN][MAXS],Tr[MAXT];</span><br><span class="line"><span class="type">int</span> Tre[MAXT][<span class="number">27</span>],Cnt,Idx[MAXT],Sum[MAXN],Tot[MAXT];</span><br><span class="line"><span class="type">int</span> Fail[MAXT],ans;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">init</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">memset</span>(Idx,<span class="number">0</span>,<span class="built_in">sizeof</span>(Idx));</span><br><span class="line">    <span class="built_in">memset</span>(Sum,<span class="number">0</span>,<span class="built_in">sizeof</span>(Sum));</span><br><span class="line">    <span class="built_in">memset</span>(Tre,<span class="number">0</span>,<span class="built_in">sizeof</span>(Tre));</span><br><span class="line">    <span class="built_in">memset</span>(Tot,<span class="number">0</span>,<span class="built_in">sizeof</span>(Tot));</span><br><span class="line">    <span class="built_in">memset</span>(Fail,<span class="number">0</span>,<span class="built_in">sizeof</span>(Fail));</span><br><span class="line">    Cnt=<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">addString</span><span class="params">(<span class="type">char</span> *s,<span class="type">int</span> id)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> u=<span class="number">0</span>,len=<span class="built_in">strlen</span>(s+<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=len;++i)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(!Tre[u][s[i]-<span class="string">&#x27;a&#x27;</span>]) Tre[u][s[i]-<span class="string">&#x27;a&#x27;</span>]=++Cnt;</span><br><span class="line">        u=Tre[u][s[i]-<span class="string">&#x27;a&#x27;</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    Idx[u]=id;</span><br><span class="line">    <span class="keyword">return</span> ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">pareString</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    queue&lt;<span class="type">int</span>&gt;Q;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;<span class="number">26</span>;++i) <span class="keyword">if</span>(Tre[<span class="number">0</span>][i]) Q.<span class="built_in">push</span>(Tre[<span class="number">0</span>][i]);</span><br><span class="line">    <span class="keyword">while</span>(!Q.<span class="built_in">empty</span>())</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> u=Q.<span class="built_in">front</span>();Q.<span class="built_in">pop</span>();</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;<span class="number">26</span>;++i)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span>(!Tre[u][i]) Tre[u][i]=Tre[Fail[u]][i];</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">            &#123;</span><br><span class="line">                Q.<span class="built_in">push</span>(Tre[u][i]);</span><br><span class="line">                Fail[Tre[u][i]]=Tre[Fail[u]][i];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">query</span><span class="params">(<span class="type">char</span> *s)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> u=<span class="number">0</span>,len=<span class="built_in">strlen</span>(s+<span class="number">1</span>),res=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=len;++i)</span><br><span class="line">    &#123;</span><br><span class="line">        u=Tre[u][s[i]-<span class="string">&#x27;a&#x27;</span>];</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j=u;j;j=Fail[j]) ++Tot[j];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;=Cnt;++i)</span><br><span class="line">        <span class="keyword">if</span>(Idx[i]) <span class="built_in">checkMax</span>(res,Tot[i]),Sum[Idx[i]]=Tot[i];</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// freopen(&quot;AC-automaton.in&quot;,&quot;r&quot;,stdin);</span></span><br><span class="line">    <span class="comment">// freopen(&quot;AC-automaton.out&quot;,&quot;w&quot;,stdout);</span></span><br><span class="line">    <span class="built_in">read</span>(N);</span><br><span class="line">    <span class="keyword">while</span>(N)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">init</span>();</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=N;++i)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>,str[i]+<span class="number">1</span>);</span><br><span class="line">            <span class="built_in">addString</span>(str[i],i);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">pareString</span>();</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>,Tr+<span class="number">1</span>);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,ans=<span class="built_in">query</span>(Tr));</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=N;++i)</span><br><span class="line">            <span class="keyword">if</span>(Sum[i]==ans) <span class="built_in">printf</span>(<span class="string">&quot;%s\n&quot;</span>,str[i]+<span class="number">1</span>);</span><br><span class="line">        <span class="built_in">read</span>(N);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">2</span></span><br><span class="line"><span class="comment">aba</span></span><br><span class="line"><span class="comment">bab</span></span><br><span class="line"><span class="comment">ababababac</span></span><br><span class="line"><span class="comment">6</span></span><br><span class="line"><span class="comment">beta</span></span><br><span class="line"><span class="comment">alpha</span></span><br><span class="line"><span class="comment">haha</span></span><br><span class="line"><span class="comment">delta</span></span><br><span class="line"><span class="comment">dede</span></span><br><span class="line"><span class="comment">tata</span></span><br><span class="line"><span class="comment">dedeltalphahahahototatalpha</span></span><br><span class="line"><span class="comment">0</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure></details><hr><h2 id="后缀自动机SAM-Suffix-Automaton"><a href="#后缀自动机SAM-Suffix-Automaton" class="headerlink" title="后缀自动机SAM(Suffix Automaton)"></a>后缀自动机SAM(Suffix Automaton)</h2><h3 id="概念"><a href="#概念" class="headerlink" title="概念"></a>概念</h3><p>对于一个字符串 $s$ 的 SAM 而言，是一个接受 $s$ 的所有后缀子串（包括 $s$ 本身）的最小 DFA 。首先给出个例子：</p><p><img src="https://cdn.luogu.com.cn/upload/pic/48640.png" alt="SAM"></p><p>对于该字符串 $s=’aabab’$ 而言，其后缀子串包括 $’aabab’,’abab’,’bab’,’ab’,’b’$ 即可。这就是一个最朴素的后缀自动机的字典树，但是，我们会发现会存在非常多相等的子树存在，会浪费非常多不必要的空间，最多会达到 $\mathcal O(n^2)$ ，这是不允许的。</p><p>那么，有没有办法将空间优化到 $\mathcal O(n)$ ，线性？很困难？所以才会有仙人创造出后缀自动机。</p><h3 id="线性时间下的后缀自动机"><a href="#线性时间下的后缀自动机" class="headerlink" title="线性时间下的后缀自动机"></a>线性时间下的后缀自动机</h3><p>后缀自动机的性质：</p><ol><li>SAM 是一个 DAG （有向无环图）。结点被称作<strong>状态</strong>，边被称作状态间的<strong>转移</strong>。</li><li>图存在源点 $t_0$ ，被称作<strong>初始状态</strong>，其余所有结点都可从 $t_0$ 出发到达。</li><li>存在一个或多个<strong>终止状态</strong>。从 $t_0$ 出发，最终转移到一个终止状态，路径所连接的一个字符串必定为 $s$ 的后缀；反之， $s$ 的任意后缀均可用一条从 $t_0$ 到某个终止状态的路径表示。</li><li>SAM 是满足上述条件的所有自动机中，结点数最少的。</li></ol><h4 id="Endpos"><a href="#Endpos" class="headerlink" title="Endpos"></a>Endpos</h4><p>记一个数组的每一个元素都是集合，记作 $Endpos[i]$ ，以 $s=’aabab’$ 为例，则有 $Endpos[‘ab’]=\{3,5\}$ 。那么显然，有以下性质：</p><ol><li>设字符串 $s$ 中的两个非空子串 $u$ 和 $v$ ，假定 $|u|\leq |v|$ ，且满足 $Endpos(u)=Endpos(v)$ ，那么 $u$ 的每一次出现，都是以 $w$ 的后缀的形式出现的。</li><li>同样，满足：$\begin{split} \left \{ \begin{array}{ll} Endpos(u)\subseteq Endpos(v)          &amp; \text{if}\ u\ \text{is a suffix of }w\\  Endpos(u)\cap Endpos(v)=\varnothing                 &amp; otherwise \end{array} \right. \end{split}$</li><li>对于一个 $Endpos$ 的<strong>等价类</strong>，将类中的所有子串按长度非递增的顺序排序。每个子串都不会比它前一个子串长，与此同时每个子串也是它前一个子串的后缀。换句话说，对于同一等价类的任一两子串，较短者为较长者的后缀，且该等价类中的子串长度恰好覆盖整个区间 $[x,y]$ 。</li><li>等价类没有相同长度的字符串。</li></ol><h4 id="Link"><a href="#Link" class="headerlink" title="Link"></a>Link</h4><p>对于一个非 $t_0$ 的状态 $v$ ，必然对应于具有相同 $Endpos$ 的等价类。定义 $w$ 是这些字符串中最长的一个，则其他字符串必定是 $w$ 的后缀。</p><p>而对于 $w$ 的最长的几个后缀全部包含于这个等价类，且所有其他后缀（包括空后缀），在其他等价类中。记 $t$ 为满足上述要求最长的后缀，将 $v$ 的后缀链接 $Link[v]$ 与 $t$ 连接。那么，</p><p>一个<strong>后缀链接</strong> $Link[v]$ 连接到对应于 $w$ 的最长后缀的另一个 $Endpos$ 等价类的状态。</p><p>则有</p><ol><li>所有后缀链接构成了一棵以 $t_0$ 为根节点的树。</li><li>通过 $Endpos$ 集合构造的树（子节点集合包含于父节点集合，类似于线段树）与通过后缀链接 $Link$ 构造的树相同。</li></ol><h4 id="Parent-Tree"><a href="#Parent-Tree" class="headerlink" title="Parent Tree"></a>Parent Tree</h4><p>以父子关系构建的树<del>（类似于高中男寝的现状）</del>。有这么一张图：</p><p><img src="https://cdn.luogu.com.cn/upload/image_hosting/dtbqv5ba.png" alt="PT"></p><p>是对应 $s=’aababa’$ 的 Parent Tree 。显而易见地，可以看见很多性质，类似于：</p><ul><li>子节点是父节点的子集，且其表示的后缀串大小依次递增且父节点表示的字符串都是子节点的后缀子串。</li></ul><p>而后缀自动机的构造所需要的状态，正是父母树中的所有状态（可以认为同一个字符串的 SAM 和 Parent Tree 共用同样的节点），但边有所不同。但 Parent Tree 的根就是 PAM 中的 $t_0$ ，即源点。而终止节点就是包含了原串的节点，如上图的 $6$ 号节点。那么，我们的任务，就是在此原点中，构建出一个有向无环图，使其路径，有且仅有原字符串 $s$ 的所有后缀子串。</p><h3 id="构造"><a href="#构造" class="headerlink" title="构造"></a>构造</h3><p>首先，后缀自动机的构造算法是一个<strong>在线</strong>算法， 我们逐一读入字符串中的每一个字符，并对应维护后缀自动机。为了保证线性的空间复杂度，每一个状态仅有两个元素表示为 $len$ 和 $link$ 。</p><p>首先，初始化整个后缀自动机，创立空根节点满足 $len[t_0]=0,link[t_0]=-1,last=0,cnt=0$ ，$-1$ 表示虚空根，初始长度为 $0$ ，$cnt$ 是当前节点编号与总结点数。$last$ 表示在添加字符 $c$ 时，整个自动机对应的状态。</p><p>接着，</p><p>读入字符 $c$ ，为字符 $c$ 创建一个新的状态记为 $cur$ ，并使 $len[cur]=len[last]+1$ 。</p><p>从状态 $last$ 开始，遍历后缀链接数组 $link[]$ ，寻找是否存在某个点已经有了到 $c$ 的转移，并将该点记为 $p$ 。</p><p>如果不存在，则 $p=-1$ ，且 $c$ 字符是第一次在该字符串中出现。则运行 $link[cur]=0$ 并退出。</p><p>如果存在状态 $p\neq -1$ 则令 $p$ 通过 $c$ 转移到的状态为 $q$ 。如果有 $len[p]+1=len[q]$ 的话，则有 $link[cur]=q$ ；否则，</p><p>对于状态 $cur$ 与当前节点 $p’$ 所指的 $q$ 而言，他们必定有一段公共后缀（至少包含一个字符 $c$ ）。然后，我们创建一个新状态记为 $clone$ ，并满足 $len[clone]=len[p]+1$ ，并让 $q$ 和 $cur$ 都指向 $clone$ ，即让 $clone$ 成为 $q$ 和 $cur$ 的父节点。让 $clone$ 代替 $q$ 的存在，使所有曾转移至 $q$ 的边全部定向指向 $clone$ 即可。</p><p>最后，将 $last$ 更新为 $cur$ 即可。我们从 $last$ 开始，遍历后缀链接直到 $t_0$ ，将所有经过的状态记为终止节点，那么，从 $t_0$ 到任意终止节点的路径所构成的字符串，包含且仅包含所有 $s $ 的后缀子串。这些被标记的状态，也全部都是终止状态。 </p><p>对于上述所有的证明与拓展讲解，详见<a href="https://oi-wiki.org/string/sam/#_6">OI Wiki</a></p><h3 id="例题-2"><a href="#例题-2" class="headerlink" title="例题"></a>例题</h3><h4 id="Luogu-P3804"><a href="#Luogu-P3804" class="headerlink" title="Luogu P3804"></a><a href="https://www.luogu.com.cn/problem/P3804">Luogu P3804</a></h4><p>构造不用多说，运用在于查找一个子串出现的个数。最后的统计可以使用<strong>拓扑排序</strong>或者<strong>深度优先搜索</strong>。我的拓扑似乎炸了，换了 dfs 才过的。计算出现次数，只需要将 $EndposSize[Link[u]]+=EndposSize[u]$ 即可。</p><details>    <summary>AC Code</summary><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;ctime&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iomanip&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stack&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;map&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> gh() getchar()</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> re register</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> db double</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> ll;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN=<span class="number">2e6</span>+<span class="number">1</span>;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    x=<span class="number">0</span>;</span><br><span class="line">    <span class="type">char</span> ch=<span class="built_in">gh</span>(),t=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(ch&lt;<span class="string">&#x27;0&#x27;</span>||ch&gt;<span class="string">&#x27;9&#x27;</span>) t|=ch==<span class="string">&#x27;-&#x27;</span>,ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">while</span>(ch&gt;=<span class="string">&#x27;0&#x27;</span>&amp;&amp;ch&lt;=<span class="string">&#x27;9&#x27;</span>) x=(x&lt;&lt;<span class="number">3</span>)+(x&lt;&lt;<span class="number">1</span>)+(ch^<span class="number">48</span>),ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">if</span>(t) x=-x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T,<span class="keyword">class</span> ...T1&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x,T1 &amp;...x1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">read</span>(x),<span class="built_in">read</span>(x1...);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">checkMax</span><span class="params">(T &amp;x,T &amp;y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x&lt;y?x=y,<span class="number">1</span>:<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">checkMin</span><span class="params">(T &amp;x,T &amp;y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x&gt;y?x=y,<span class="number">1</span>:<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">char</span> Str[MAXN];</span><br><span class="line"><span class="keyword">namespace</span> SAM</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">State</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> len,link,next[<span class="number">27</span>];</span><br><span class="line">    &#125;Tre[MAXN&lt;&lt;<span class="number">1</span>];</span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">Path</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> next,to;</span><br><span class="line">    &#125;Edge[MAXN&lt;&lt;<span class="number">1</span>];</span><br><span class="line">    <span class="type">int</span> Total,Head[MAXN];</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">addEdge</span><span class="params">(<span class="type">int</span> u,<span class="type">int</span> v)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        Edge[++Total]=(Path)&#123;Head[u],v&#125;;Head[u]=Total;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> Last,Size=<span class="number">0</span>,Endpos[MAXN],T[MAXN],A[MAXN];</span><br><span class="line">    ll ans=<span class="number">0</span>;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">init</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        Tre[<span class="number">1</span>].len=<span class="number">0</span>,Tre[<span class="number">1</span>].link=<span class="number">0</span>;</span><br><span class="line">        Last=<span class="number">1</span>,Size=<span class="number">1</span>;</span><br><span class="line">        <span class="built_in">memset</span>(Endpos,<span class="number">0</span>,<span class="built_in">sizeof</span>(Endpos));</span><br><span class="line">        <span class="built_in">memset</span>(T,<span class="number">0</span>,<span class="built_in">sizeof</span>(T));</span><br><span class="line">        <span class="built_in">memset</span>(A,<span class="number">0</span>,<span class="built_in">sizeof</span>(A));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">Extend</span><span class="params">(<span class="type">char</span> c)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="type">int</span> cur=++Size;</span><br><span class="line">        Tre[cur].len=Tre[Last].len+<span class="number">1</span>;</span><br><span class="line">        <span class="type">int</span> p=Last;</span><br><span class="line">        Endpos[cur]=<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">while</span>(p&amp;&amp;!Tre[p].next[c-<span class="string">&#x27;a&#x27;</span>])</span><br><span class="line">        &#123;</span><br><span class="line">            Tre[p].next[c-<span class="string">&#x27;a&#x27;</span>]=cur;</span><br><span class="line">            p=Tre[p].link;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(!p) Tre[cur].link=<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="type">int</span> q=Tre[p].next[c-<span class="string">&#x27;a&#x27;</span>];</span><br><span class="line">            <span class="keyword">if</span>(Tre[p].len+<span class="number">1</span>==Tre[q].len) Tre[cur].link=q;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">            &#123;</span><br><span class="line">                <span class="type">int</span> clone=++Size;</span><br><span class="line">                Tre[clone]=Tre[q];</span><br><span class="line">                Tre[clone].len=Tre[p].len+<span class="number">1</span>;</span><br><span class="line">                <span class="keyword">while</span>(p&amp;&amp;Tre[p].next[c-<span class="string">&#x27;a&#x27;</span>]==q)</span><br><span class="line">                &#123;</span><br><span class="line">                    Tre[p].next[c-<span class="string">&#x27;a&#x27;</span>]=clone;</span><br><span class="line">                    p=Tre[p].link;</span><br><span class="line">                &#125;</span><br><span class="line">                Tre[q].link=Tre[cur].link=clone;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        Last=cur;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">dfs</span><span class="params">(<span class="type">int</span> x)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> e=Head[x];e;e=Edge[e].next)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">dfs</span>(Edge[e].to);</span><br><span class="line">            Endpos[x]+=Endpos[Edge[e].to];</span><br><span class="line">        &#125;</span><br><span class="line">        ll res=Endpos[x]*Tre[x].len;</span><br><span class="line">        <span class="keyword">if</span>(Endpos[x]!=<span class="number">1</span>) <span class="built_in">checkMax</span>(ans,res);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">calc</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">2</span>;i&lt;=Size;++i) <span class="built_in">addEdge</span>(Tre[i].link,i);</span><br><span class="line">        <span class="built_in">dfs</span>(<span class="number">1</span>);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%lld&quot;</span>,ans);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> SAM;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// freopen(&quot;suffix-automaton.in&quot;,&quot;r&quot;,stdin);</span></span><br><span class="line">    <span class="comment">// freopen(&quot;suffix-automaton.out&quot;,&quot;w&quot;,stdout);</span></span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>,Str+<span class="number">1</span>);</span><br><span class="line">    <span class="type">int</span> Len=<span class="built_in">strlen</span>(Str+<span class="number">1</span>);</span><br><span class="line">    SAM::<span class="built_in">init</span>();</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=Len;++i) SAM::<span class="built_in">Extend</span>(Str[i]);</span><br><span class="line">    SAM::<span class="built_in">calc</span>();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">abab</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure></details><h3 id="后话"><a href="#后话" class="headerlink" title="后话"></a>后话</h3><p>可以证明，最终 Parent Tree 和 SAM 所依赖的那个图 $G(V,E)$ ，满足 $V\leq n,E\leq n$ ，即这张图的边数和点数都是 $\mathcal O(n)$ 的。证明较复杂，读者可以自行搜索阅读。</p>]]></content>
      
      
      <categories>
          
          <category> 学习笔记 </category>
          
          <category> OI </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 优化 </tag>
            
            <tag> String </tag>
            
            <tag> 字符串 </tag>
            
            <tag> 图论 </tag>
            
            <tag> bfs </tag>
            
            <tag> 数据结构 </tag>
            
            <tag> 树型结构 </tag>
            
            <tag> 构造 </tag>
            
            <tag> 自动机 </tag>
            
            <tag> 后缀自动机 </tag>
            
            <tag> 后缀数组 </tag>
            
            <tag> 后缀树 </tag>
            
            <tag> Trie树 </tag>
            
            <tag> Kmp </tag>
            
            <tag> 搜索树 </tag>
            
            <tag> AC自动机 </tag>
            
            <tag> 字典树 </tag>
            
            <tag> 字典图 </tag>
            
            <tag> 后缀函数 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>O.I</title>
      <link href="/Eternity/Until-The-End/my-OIer-life/"/>
      <url>/Eternity/Until-The-End/my-OIer-life/</url>
      
        <content type="html"><![CDATA[<div class="hbe hbe-container" id="hexo-blog-encrypt" data-wpm="Oh, this is an invalid password. Check and try again, please." data-whm="OOPS, these decrypted content may changed, but you can still have a look.">  <script id="hbeData" type="hbeData" data-hmacdigest="85fc6a9e8bacfc0bc0d03b04f1cb5c93e042b8dffe01557cc41ef6389f9e80ec">8a9f14dab31ea0fa4a1e98a3a95c850c116f1e7972a3803d3f384901d05d5b90074957ea9909112ad7f5f8c486494c02adc0213d106d43f1cfc12e148798503b99182722ce4551aa3c93db8e9d22a35bbbfb76e6c6ed9517a707589a6c942a35c94420c13260606593923579284cd94f316e7316e0987f5d06db0e8bff9ba91059a3b22a213a7896111055f2307a4155e6b95d80e1083c79afa19276862836352c298467af6aa016b23e5589b30c57b751f3a519e4c2e22176ed8165237598f32364c0ffa6f6f464f413deb3772ac9502f79efb5817c743f01d1d04c0d477665d59334ee8a03d3b887e45adbcc7ff99d74a935522892fb1a264dc9683f9d9ebcec57867d11a2eb905f08e2c162552090046c651e7a14cd84ceb0fa902a8a904140fda6fb20d037cd4035f85b8ff62aaa124346a4b064cb457875e8078bdc845aa6944e6fafdb225535d83695fc97706ad27e8c7d8b2f49d026a1b29c3c2da4a9d14e3bcaf1514f9c9b9a72b75fc6dbb8efc1024b7e7f1c67e498e95c6cc64a2a07961f1fccdd68c1e81a56da66d074d7da6bbef2c68e53a919539afe441215355e9498a8a51c1cfb18903ddf24eb00a9ee305a37bf4cafd3c5f1dedf7df93f701012855862a2b7fc77802412ac2e93f360201be39140e9d383e30774a3b8dc1e97fdad1bfc869acb63186dae5cd1bea5322f33ef8176b871825f3e9dd3e255386b3355fc6c86918614ef258548ac812cce940a6f2e2e121011817a5ee21eb37bdf2db7c6c706c4eb1fd9f263aeb1c8c4490732c1bc8b57cf6e62a40483b762ee7e2ec7998641abb46c6d34579e1fdfeb05588a7abfc60143e67031f1055761c594b25423300e69fa0cbac20fbf346dd6aa7d6a0b9d1d9e62f205c4f280a8a75d45110cd2037a96d2c994df7ecaf012c60a1326798c378a76425fc500a684c6c62b111154aaefa7c1472ec35438a6950b534dbc2ed904a27beec4fc689759e293ad4c101d5f5c4d4685e3a0aea351f6a60ac78fa00b7bef5fd8c637df077918f9df1f3b66b78951fccd9481b8d641c0cbec0d82dbe7a534224e13ac0a71b75f0b35f00148ee977d935bd1639e0a2cc335d411680dae9fe1b440943cb8c289b91877d0cd5a0c2a4417079437538846c05c53e3d78179eae4cd2f916eaa309e74fe54c1ced3a2ded5e1c08a26eca638414ddca76c7e098808ed237342c8140b24fb57faf9d0d6c4f224b4dc8c48ead89050555b16b2f3ee0b9f01532675009e3d80eb4ec30eae5fd1a1d8a7be254f1f5bde449026bf841a6e66a93691a38ec7b6f58dd5858676986e70772d0ac097f6353657ab7b148c096ad00127c2af0e523cf7e3279a6b382012b1d18af3f6865777160ee864e7844a12af84ef4d7adff88954ad27c7cf593113a3399c4d9d94cd965ad24209cd4137982cffafa32ae47c91179c10f5bc7fe880c78e2694f6aa81e75bda39a9c7e28ddf9d7efd1daf6fcd2a08eaac8358977fc5b7bf8474c9d6af4c51b115fd2d9b93ec5ebd459b4136cee751255d4cf73829936ed44a93599903e60f9f33ecf5e9fe1f16a3da594337456d95060c38ab4a91f89a5a49828b93a07004d9222b5ac26dbabd4805aa2f57f85f7dafd2b3fac46af5ae6a3e89ea2d1be4795d56cdb2975e2c034dfd06230a54e6e661c34aad70667520413b4ceacd55d180f5e3ae8a7ed2febdd12b4ec4c3008b17573af03ddaab5ebcce64a0922523563eb4f75b88bee03a4391beec92cfc4ac85d4c46a6d9d09e107be2a9d5b44d77b65bb2d54bb6666555c4020793b2b0336c3995b248631a8e94f55c39990a6f0cf6843373853205c51239734907249c60aaa48e62ab443be32995e80092485ae4778899cad5f46c43243f55c11f32a882915c17d206beec93b85aeaf47c6a213c4eddc3655918b5dc2df9d0ca48bd02e9a98ec719e61320ee0e363fee86817eabc5954d74d647587057a0aed5c57ca65733eb85fa8915238360b61d3c2e856d588f55603c41a91d9166c5e3540a7363c4305029e5fa80a657e7ee17b22b812c94e4856e2ae36d22bfc7807110859d09e5f9b76f9e91495e324c74f8b930a5440084d76761bd62fe3c99c8693c98e4bbbdec22a421c902f6316578f8cdee85fb8cd913c9300f478c24f2c1e1db45546c990bf91b8a0a581b72f8007b0a86cbfbb610aacbcd34a214529daee5201e0af81111a2056186878fe443e3998e99cd915660efdf8bf9dd4265e208da2346aac990745617166d2e68f58c79b5830446dfbc838a56a91e8c2b93ca5d504f0741024e4069435b2ac681e2c8ce077580ef984a0c56567822afdf369e2ee472ea1ac256234c967b489ecd9ffefe1de663df74b05bddf36ca8d479fd99cfb69170f2e429bb812932d3639dca41db388bc16bac850dd070d46a6d01aae61668bb31a95214bebb0540026e1dcdf62582762d71f99c10acaf663ab6d0a2b1df2d3509653fc394c2f7149c01499f297efb459394e504f19b287c4ce8f2c728bc2c3972090d5c3b798dd40b349cd3872b741787eb801df9c4e6c3f015849c440774d9f76a4d743a9fbb65df59b8594de0e0f18e6e8de2203b31a87c4ae8b04d6843ff4b685df624e</script>  <div class="hbe hbe-content">    <div class="hbe hbe-input hbe-input-xray">      <input class="hbe hbe-input-field hbe-input-field-xray" type="password" id="hbePass">      <label class="hbe hbe-input-label hbe-input-label-xray" for="hbePass">        <span class="hbe hbe-input-label-content hbe-input-label-content-xray">提问：I Ak ???</span>      </label>      <svg class="hbe hbe-graphic hbe-graphic-xray" width="300%" height="100%" viewBox="0 0 1200 60" preserveAspectRatio="none">        <path d="M0,56.5c0,0,298.666,0,399.333,0C448.336,56.5,513.994,46,597,46c77.327,0,135,10.5,200.999,10.5c95.996,0,402.001,0,402.001,0"></path>        <path d="M0,2.5c0,0,298.666,0,399.333,0C448.336,2.5,513.994,13,597,13c77.327,0,135-10.5,200.999-10.5c95.996,0,402.001,0,402.001,0"></path>      </svg>    </div>  </div></div><script data-pjax src="/Eternity/lib/hbe.js"></script><link href="/Eternity/css/hbe.style.css" rel="stylesheet" type="text/css">]]></content>
      
      
      <categories>
          
          <category> Until The End </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>点分治</title>
      <link href="/Eternity/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/OI/divided-conquer/"/>
      <url>/Eternity/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/OI/divided-conquer/</url>
      
        <content type="html"><![CDATA[<p>燃其主核，破其王座。</p><span id="more"></span><h2 id="解释"><a href="#解释" class="headerlink" title="解释"></a>解释</h2><p><strong>点分治</strong>用于对一些具有限定条件的路径进行静态统计的算法。</p><p>一般步骤在于：</p><ol><li>任选一个根节点 $p$ （<del>一般</del> $p$ <strong>必须</strong>是<strong>树的重心</strong>）</li><li>从 $p$ 出发进行一次 $Dfs$ ，求得两个数组 $dist$ 与 $belong$</li><li>执行 $calc(p)$</li><li>删除根节点 $p$ ，对 $p$ 的每一个子树重复 $1 \sim 4$ 的操作。</li></ol><p>对于不同的题目，其 $calc(p)$ 函数大同小异。但其他都差不多。</p><p>$dist[x]$ 表示节点 $x$ 到根节点 $p$ 的距离。</p><p>$belong[x]$ 表示节点 $x$ 所属于的是根节点 $p$ 的哪一棵子树。</p><p>规定： $dist[p]=0,belong[p]=p$</p><p>我们设 $T$ 为递归操作所到达的最大深度。那么复杂度则为 $\mathcal O(TN\log N)$</p><p>总而言之，复杂度的波动范围则是 $\mathcal O(N\log N)\sim\mathcal O(N^2\log N)$ 。</p><p>显然，这个波动极大，对于两个极值而言，一个，是链，一个，是重心。所以，这也是为什么 $p$ 必须要取树的重心。但查找重心需要一定的时间，大概是 $\mathcal O(\log N)$</p><p>所以，点分治的时间就是 $\mathcal O(N\log^2 N)$ 了。</p><h2 id="例题"><a href="#例题" class="headerlink" title="例题"></a>例题</h2><h3 id="Luogu-P3806"><a href="#Luogu-P3806" class="headerlink" title="Luogu.P3806"></a><a href="https://www.luogu.com.cn/problem/P3806">Luogu.P3806</a></h3><p>其他部分不多赘述。重点说 $calc(p)$ 部分。</p><p>有两种做法。</p><h4 id="树上直接统计"><a href="#树上直接统计" class="headerlink" title="树上直接统计"></a>树上直接统计</h4><p>设 $p$ 的子树为 $s_1,s_2…s_m$</p><p>对于 $s_i$ 中的每一个节点 $x$ ，将满足 $dist[x]+dist[y]=K$ 的节点 $y$ 统计出即可。</p><p>可以使用<strong>树状数组</strong>。 </p><ol><li>对于 $s_i$ 中的每一个节点 $x$ ，查询其前缀和 $ask(K-dist[x])$ ，即 $y$ 的个数。</li><li>对于 $s_i$ 中的每一个节点 $x$ ，进行 $add(dist[x],1)$ ，表示与 $p$ 距离为 $dist[x]$ 的节点增加了 $1$ 个。</li></ol><p>按子树一棵棵统计保证了 $belong[x]\neq belong[y]$ ，查询前缀和保证了 $dist[x]+dist[y]=K$ 。</p><p>进行优化的话，可以使用平衡树代替树状数组，或者离散化。</p><h4 id="指针扫描数组"><a href="#指针扫描数组" class="headerlink" title="指针扫描数组"></a>指针扫描数组</h4><p>将树的节点转化为一个一维数组记为 $num[i]$ ，并按照其 $dist$ 值进行由小到大排序。然后创建头指针和尾指针 $l,r$ 或者 $head,tail$ 。从前后扫描 $num$ 数组。</p><p>那么，当 <code>++l</code> 和 <code>--r</code> 在执行时， $dist[num[l]]+dist[num[r]]$ 应该是单调递减的。</p><p>用 $cnt[s]$ 表示 $l+1\sim r$ 之间满足 $belong[num[i]]=s$ 的位置 $i$ 的个数。当路径一端 $x$ 等于 $num[l]$ 时，统计答案 $y=r-l-cnt[belong[num[l]]]$</p><p>这道题用的就是这个思路。 </p><hr><h4 id="杂话"><a href="#杂话" class="headerlink" title="杂话"></a>杂话</h4><p>对于这道题，转离线统计，用点分治的传统方法，找重心，计算，删点即可。</p><p>时间复杂度 $\mathcal O(nm\log n)$ </p><details>    <summary>AC Code</summary><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;ctime&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iomanip&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stack&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;map&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> gh() getchar()</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> re register</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> db double</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> ll;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN=<span class="number">1e7</span>+<span class="number">1</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXM=<span class="number">1e5</span>+<span class="number">1</span>;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    x=<span class="number">0</span>;</span><br><span class="line">    <span class="type">char</span> ch=<span class="built_in">gh</span>(),t=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(ch&lt;<span class="string">&#x27;0&#x27;</span>||ch&gt;<span class="string">&#x27;9&#x27;</span>) t|=ch==<span class="string">&#x27;-&#x27;</span>,ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">while</span>(ch&gt;=<span class="string">&#x27;0&#x27;</span>&amp;&amp;ch&lt;=<span class="string">&#x27;9&#x27;</span>) x=(x&lt;&lt;<span class="number">3</span>)+(x&lt;&lt;<span class="number">1</span>)+(ch^<span class="number">48</span>),ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">if</span>(t) x=-x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T,<span class="keyword">class</span> ...T1&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x,T1 &amp;...x1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">read</span>(x),<span class="built_in">read</span>(x1...);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">checkMax</span><span class="params">(T &amp;x,T &amp;y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x&lt;y?x=y,<span class="number">1</span>:<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">checkMin</span><span class="params">(T &amp;x,T &amp;y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x&gt;y?x=y,<span class="number">1</span>:<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> N,M;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Road</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> next,to,val;</span><br><span class="line">    <span class="built_in">Road</span>(<span class="type">int</span> next=<span class="number">0</span>,<span class="type">int</span> to=<span class="number">0</span>,<span class="type">int</span> val=<span class="number">0</span>):</span><br><span class="line">        <span class="built_in">next</span>(next),<span class="built_in">to</span>(to),<span class="built_in">val</span>(val)&#123;&#125;</span><br><span class="line">&#125;Edge[MAXN&lt;&lt;<span class="number">1</span>];</span><br><span class="line"><span class="type">int</span> Head[MAXN],Total;</span><br><span class="line"><span class="type">int</span> Pos,ans_Pos,Size[MAXN];</span><br><span class="line"><span class="type">bool</span> vis_Pos[MAXN],vis[MAXN];</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">addEdge</span><span class="params">(<span class="type">int</span> u,<span class="type">int</span> v,<span class="type">int</span> w)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Edge[++Total]=<span class="built_in">Road</span>(Head[u],v,w);Head[u]=Total;</span><br><span class="line">    Edge[++Total]=<span class="built_in">Road</span>(Head[v],u,w);Head[v]=Total;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dfs_Pos</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> fa,<span class="type">int</span> size)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Size[x]=<span class="number">1</span>;</span><br><span class="line">    <span class="type">int</span> Max_Part=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> e=Head[x],v;e;e=Edge[e].next)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>((v=Edge[e].to)==fa||vis[v]) <span class="keyword">continue</span>;</span><br><span class="line">        <span class="built_in">dfs_Pos</span>(v,x,size);</span><br><span class="line">        Size[x]+=Size[v];</span><br><span class="line">        Max_Part=<span class="built_in">max</span>(Max_Part,Size[v]);</span><br><span class="line">    &#125;</span><br><span class="line">    Max_Part=<span class="built_in">max</span>(Max_Part,size-Max_Part);</span><br><span class="line">    <span class="keyword">if</span>(!Pos||Max_Part&lt;ans_Pos)</span><br><span class="line">    &#123;</span><br><span class="line">        ans_Pos=Max_Part;</span><br><span class="line">        Pos=x;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> blg[MAXN],dis[MAXN],query[MAXM];</span><br><span class="line"><span class="type">int</span> num[MAXN],Tot;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">cmp</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> dis[x]&lt;dis[y];</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dfs_Dist</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> fa,<span class="type">int</span> val,<span class="type">int</span> u)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    num[++Tot]=x;</span><br><span class="line">    dis[x]=val,blg[x]=u;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> e=Head[x],v;e;e=Edge[e].next)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>((v=Edge[e].to)==fa||vis[v]) <span class="keyword">continue</span>;</span><br><span class="line">        <span class="built_in">dfs_Dist</span>(v,x,val+Edge[e].val,u);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">bool</span> ans[MAXM];</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dfs_Calc</span><span class="params">(<span class="type">int</span> x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Tot=<span class="number">0</span>;</span><br><span class="line">    num[++Tot]=x;</span><br><span class="line">    dis[x]=<span class="number">0</span>,blg[x]=x;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> e=Head[x],v;e;e=Edge[e].next)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(vis[(v=Edge[e].to)]) <span class="keyword">continue</span>;</span><br><span class="line">        <span class="built_in">dfs_Dist</span>(v,x,Edge[e].val,v);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">sort</span>(num+<span class="number">1</span>,num+<span class="number">1</span>+Tot,cmp);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=M;++i)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> l=<span class="number">1</span>,r=Tot;</span><br><span class="line">        <span class="keyword">while</span>(l&lt;r)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span>(dis[num[l]]+dis[num[r]]&gt;query[i]) --r;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span>(dis[num[l]]+dis[num[r]]&lt;query[i]) ++l;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span>(blg[num[l]]==blg[num[r]])</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">if</span>(dis[num[r]]==dis[num[r<span class="number">-1</span>]]) --r;</span><br><span class="line">                <span class="keyword">else</span> ++l;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">            &#123;</span><br><span class="line">                ans[i]=<span class="number">1</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">solve</span><span class="params">(<span class="type">int</span> x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    vis[x]=<span class="number">1</span>;</span><br><span class="line">    <span class="built_in">dfs_Calc</span>(x);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> e=Head[x],v;e;e=Edge[e].next)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(vis[(v=Edge[e].to)]) <span class="keyword">continue</span>;</span><br><span class="line">        Pos=<span class="number">0</span>;</span><br><span class="line">        <span class="built_in">dfs_Pos</span>(v,<span class="number">0</span>,Size[v]);</span><br><span class="line">        <span class="built_in">solve</span>(Pos);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// freopen(&quot;tree.in&quot;,&quot;r&quot;,stdin);</span></span><br><span class="line">    <span class="comment">// freopen(&quot;tree.out&quot;,&quot;w&quot;,stdout);</span></span><br><span class="line">    <span class="built_in">read</span>(N,M);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>,u,v,w;i&lt;N;++i)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">read</span>(u,v,w);</span><br><span class="line">        <span class="built_in">addEdge</span>(u,v,w);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">dfs_Pos</span>(<span class="number">1</span>,<span class="number">-1</span>,N);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=M;++i) <span class="built_in">read</span>(query[i]);</span><br><span class="line">    <span class="built_in">solve</span>(Pos);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=M;++i)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(ans[i]||!query[i]) <span class="built_in">printf</span>(<span class="string">&quot;AYE\n&quot;</span>);</span><br><span class="line">        <span class="keyword">else</span> <span class="built_in">printf</span>(<span class="string">&quot;NAY\n&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">2 1</span></span><br><span class="line"><span class="comment">1 2 2</span></span><br><span class="line"><span class="comment">2</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure></details><h2 id="后记"><a href="#后记" class="headerlink" title="后记"></a>后记</h2><p>似乎这玩意儿 NOIP 是不考的，省选之后的内容了，最近几年也只有 WC 和 IOI 考过。</p>]]></content>
      
      
      <categories>
          
          <category> 学习笔记 </category>
          
          <category> OI </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 图论 </tag>
            
            <tag> 搜索 </tag>
            
            <tag> 数据结构 </tag>
            
            <tag> 树状数组 </tag>
            
            <tag> 树型结构 </tag>
            
            <tag> 指针 </tag>
            
            <tag> 点分治 </tag>
            
            <tag> 分治 </tag>
            
            <tag> 二次扫描与换根法 </tag>
            
            <tag> 树的重心 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>四季之歌</title>
      <link href="/Eternity/%E7%9F%AD%E7%AF%87%E5%B0%8F%E8%AF%B4/%E5%9B%9B%E5%AD%A3%E4%B9%8B%E6%AD%8C/season-a-song/"/>
      <url>/Eternity/%E7%9F%AD%E7%AF%87%E5%B0%8F%E8%AF%B4/%E5%9B%9B%E5%AD%A3%E4%B9%8B%E6%AD%8C/season-a-song/</url>
      
        <content type="html"><![CDATA[<p>三百六十五个日子，三百六十五种不同的思念。</p><span id="more"></span><hr><p>你可曾听说过四季的歌谣……</p><p>唯有凛春不可窥探，而未遇的星霜终会到来；<br>唯有盛夏不可触及，而忽而之岁月值得等待；<br>唯有荏秋不可遇见，而相逢的枫花梦殇灵白；<br>唯有深冬不可僭越，而将至之高空长氤云海。 </p><p>霜花同蝉鸣共绘的四时之诗，是你我往昔的恋依；<br>黄昏与白昼共奏的四季之歌，是你我余烬之追忆。 </p>]]></content>
      
      
      <categories>
          
          <category> 短篇小说 </category>
          
          <category> 四季之歌 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 轻小说 </tag>
            
            <tag> 东辰 </tag>
            
            <tag> 总概 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>未遇之春</title>
      <link href="/Eternity/%E7%9F%AD%E7%AF%87%E5%B0%8F%E8%AF%B4/%E5%9B%9B%E5%AD%A3%E4%B9%8B%E6%AD%8C/season-uncomed-spring/"/>
      <url>/Eternity/%E7%9F%AD%E7%AF%87%E5%B0%8F%E8%AF%B4/%E5%9B%9B%E5%AD%A3%E4%B9%8B%E6%AD%8C/season-uncomed-spring/</url>
      
        <content type="html"><![CDATA[<p>四季之歌 其一 春之篇</p><p>这是，关于我，关于他，关于她的故事。</p><span id="more"></span><hr><p>“南方的冬天也不会冷成这样吧。”亍余缓缓地吐气，随身前的水蒸气液化而飘散在空中，“开始变冷了呢。”</p><h2 id="灰色的时间"><a href="#灰色的时间" class="headerlink" title="灰色的时间"></a>灰色的时间</h2><p>作为班级乃至全校的佼佼者，亍余当之无愧受众人倾慕，虽不能称作为极品，但也算是长相端正了。也正因如此，他能注意到一些难以琢磨的目光，虽说不会太过在意。但他也不禁感到惋惜。</p><p>——如果一心学习也有错的话，那也就天理不容了。</p><p>亍余就是这样一个人，将除了学习之外的东西抛掷脑后的读书人。只不过，他也会在不久之后为这句话而后悔就是了。</p><hr><h3 id="黄昏之章"><a href="#黄昏之章" class="headerlink" title="黄昏之章"></a>黄昏之章</h3><p>在这间教室里，有着一个与亍余截然相反的人。</p><p>谈起石山，亍余似乎对他没有任何印象。石山就像是一个影子一样，不知道他和谁玩的好，不知道他的爱好，没有见过他发言，也不曾听过他谈笑。老师也很少提及过他。虽然成绩也不差。估计也正是因为他忽上忽下的成绩，让老师不好去说他吧。唯有一头自然卷的卷发能让他成为周围人记起的存在。</p><hr><p>我与这间教室格格不入。</p><p>并不意味着我有多么优秀，这间教室里的人都不配与我同屋；也不是说我极差透顶，没有人愿意接触我，我就是一个毒瘤。</p>]]></content>
      
      
      <categories>
          
          <category> 短篇小说 </category>
          
          <category> 四季之歌 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 轻小说 </tag>
            
            <tag> 恋爱 </tag>
            
            <tag> 校园 </tag>
            
            <tag> 东辰 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>忽而今夏</title>
      <link href="/Eternity/%E7%9F%AD%E7%AF%87%E5%B0%8F%E8%AF%B4/%E5%9B%9B%E5%AD%A3%E4%B9%8B%E6%AD%8C/season-sudden-summer/"/>
      <url>/Eternity/%E7%9F%AD%E7%AF%87%E5%B0%8F%E8%AF%B4/%E5%9B%9B%E5%AD%A3%E4%B9%8B%E6%AD%8C/season-sudden-summer/</url>
      
        <content type="html"><![CDATA[<p>四季之歌 其二 夏之篇</p><p>雨落殇花秋千荡千秋花殇落雨，歌残梦醉冷风吟风冷醉梦残歌。</p><span id="more"></span>]]></content>
      
      
      <categories>
          
          <category> 短篇小说 </category>
          
          <category> 四季之歌 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 轻小说 </tag>
            
            <tag> 东辰 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>逢秋之日</title>
      <link href="/Eternity/%E7%9F%AD%E7%AF%87%E5%B0%8F%E8%AF%B4/%E5%9B%9B%E5%AD%A3%E4%B9%8B%E6%AD%8C/season-met-autumn/"/>
      <url>/Eternity/%E7%9F%AD%E7%AF%87%E5%B0%8F%E8%AF%B4/%E5%9B%9B%E5%AD%A3%E4%B9%8B%E6%AD%8C/season-met-autumn/</url>
      
        <content type="html"><![CDATA[<p>四季之歌 其三 秋之篇</p><p>时间如同停止一般的楸天，每一秒，却在，蝶翼骤振。</p><span id="more"></span>]]></content>
      
      
      <categories>
          
          <category> 短篇小说 </category>
          
          <category> 四季之歌 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 轻小说 </tag>
            
            <tag> 东辰 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>凛冬将至</title>
      <link href="/Eternity/%E7%9F%AD%E7%AF%87%E5%B0%8F%E8%AF%B4/%E5%9B%9B%E5%AD%A3%E4%B9%8B%E6%AD%8C/season-coming-winter/"/>
      <url>/Eternity/%E7%9F%AD%E7%AF%87%E5%B0%8F%E8%AF%B4/%E5%9B%9B%E5%AD%A3%E4%B9%8B%E6%AD%8C/season-coming-winter/</url>
      
        <content type="html"><![CDATA[<p>四季之歌 其四 冬之篇</p><p>萦绕着北极光的极寒雪山，是否又是旅途的终点？</p><span id="more"></span><hr><p>或许，即使是像流冬这样经验丰富的人，也会为眼前所见而大为震撼。</p><h2 id="末秋与寒天"><a href="#末秋与寒天" class="headerlink" title="末秋与寒天"></a>末秋与寒天</h2><p>人们在之前从来也没有发现它的存在，估计也是情有可原的。去到过北极的人本就不多，何况一般的科学研究都选在了较为暖和的春夏季节，也不会有人傻到大冬天的去北极避寒。而正好的是，在那个时候，这座雪山也隐藏着面貌，同周围融为一体。</p><p>直到入了深秋，极夜笼罩了北极圈，变化才会不经意间发生——不合时宜的北极光萦绕在这座雪山高处，风雪席卷，让整座雪山直至山脚也盲不可视。虽然政府曾派过部队前去调查，而当直升机靠近苍白的风壁时，真相又总是让人大跌眼镜。那并不是所谓的风壁，夹杂在风之间的，墨黑的磐岩一遍又一遍地切割着半空中俱为一体的霜雪，一切随风旋转的物质都在高速运动，阻挡了任何试图窥探，与作弊登顶的外客。就像是在告诉流冬一行人，想要探索雪山的秘密，只剩下徒步攀登一条路可走。</p><p>而事实就是，任何官方与民间组织的探险队，从没有回来过。</p><p>这，便成为了“极北雪山”，一个近在咫尺的民间传说。也成为了，流冬一行人，此行的起点。</p><hr><h3 id="旅者之章"><a href="#旅者之章" class="headerlink" title="旅者之章"></a>旅者之章</h3><p>极北雪山中国研究所 霜降</p><p>即使流冬一行人呆在隔了三层铁板的地下研究室里，温度计的示数永远都指在的是 0℃ 左右。呼出的气体在液化之前就已经变作冰粒直至坠去了。</p><p>流冬想起自己在这里的目的，那是他正在离开青藏高原的途中，手中的手机一有信号，便收到了几条熟悉号码的短信。虽说熟悉，但也好几年没有遇见过了。那是他的初中同学，一个他曾经誓死力争的对手。</p><p>“有空吗？”裕涧说话永远是那么言简意赅。然后他们就在初秋的时候回到了曾经一起呆过的学校，作为大人再次进去，也就不会被校警阻拦了。</p><p>“唔……”流冬已经不知道说什么好了，毕竟他面前站了两个人。裕涧和他们的另一位同学，煜僭。作为从初中开始就玩好的两人，在一起也不为怪吧，流冬只能这样对自己说，可惜自己到现在也是孤独一人在世界各地跑上跑下。<font style="color:white">也从来没有人说过孤独是种错误吧。</font></p><p>“好了，这次又有什么新奇的想法。”流冬并不是很想在呆在这个令人尴尬的环境，只是想着办法能够赶快去往自己的下一个目的地。“嗯……好吧，直入主题。”裕涧将手插在胸前，微微点了点头，“作为闻名世界的冒险家，你应该对‘极北雪山’有所了解吧。”裕涧直勾勾地盯着流冬，等候着没有什么意义的回答。“这个回答是没有意义的吧，难道我还会不知道么？”流冬轻轻地笑了，“再说了，就算不是冒险家，也会有所耳闻吧。”</p><p>——我也不是什么大冒险家啊。<font style="color:white">蠢货，哪里像你，拥有近乎完美的人生</font></p><p>“嗯，确实，”裕涧似乎也意识到自己犯了一个常识性的错误，“那……你有兴趣吗？”</p><p>——诶？</p><p>“我们打算去那里做研究，探究一些非自然现象，这是研究院计划的一部分。”煜僭补充道，递给流冬一些不应该被传播的图片。一些能够被划为机密的文件。</p><p>“那，为什么要叫上我呢，我又不擅长这些。”其实，流冬也是想去一探究竟的。只是，他并不想以自己的性命做赌注。</p><p>“你知道的，那些……嗯……外界的传言，并不是完全没有道理。可能，我们需要一些经验比我们丰富的人，对于常年呆在实验室的人来说，生还的几率不能说没有，也微乎其微。所以，我们需要一个人能够活着将研究结果带出去。”</p><p>——哈？</p><p>“你这么说，抱着必死的决心？”流冬只是觉得很好笑，他没想到裕涧会说出这样恐怖的话，在他眼里，从小到大，裕涧从来就没有完不成的事，只要他想，一切尽在可得。裕涧和煜僭都沉默了，空气仿佛凝固了一般，如果不是那架一楼大厅的钢琴发出的钢琴声从远处传来，有人可能会认为是时间被暂停了吧。</p><p>“对。”</p><p>这下轮到流冬沉默了。</p><p>——可我还没有下好决心呢，万一我也……</p><p>“我相信你，你能够走出去。”</p><p>——但是……</p><p>“拜托了。”流冬能够清晰地看出裕涧并没有在开玩笑，他的眼瞳荡漾着墨一般深邃。像是一个黑洞，使流冬无法逃脱。他低下头，不敢再去直面裕涧的眼神。只是咬紧了牙，微微点了点头。然后，他听见裕涧松了一口气，发出了微小的笑声。虽然是沁人心脾，却让流冬感到一丝毛骨悚然。</p><p>“谢谢。”</p><hr><h3 id="雪花之章"><a href="#雪花之章" class="headerlink" title="雪花之章"></a>雪花之章</h3><p>不知已然在不同舒适的座位与载具上做了多久，窗外的风景也不断地变化着。从南方的枫花，到偏北的落雪，直到冰天之地，厚重的吉普驶过成块儿的浮冰，留下两缕履带的痕迹。此时的雪山静静地躺在那里，没有丝毫不祥的痕迹，也并没有引起流冬的注意。他将视野偏向距离雪山几公里外的巨大楼房，那是中国的研究所，被冻住的红漆依然是他祖国最明显的象征，当然，其他几个国家的也在其边。</p><p>吉普直接驶进了研究所的地下通道，重重的铁门在身后关闭了三次。流冬陪着裕涧下了车，大厅之中，熟悉或是不熟悉的人，站着或者坐着。当然，除了一些从没有在任何地方以任何形式出现过的研究员，其他流冬还是有所耳闻，只是他不能理解，为什么这些人也会参与进这个任务。</p><p>“为什么会有这么多无关人员啊？”流冬悄悄地问裕涧，用手指戳了戳他的后背。</p><p>“嗯……其实，我也没办法，虽说可以请出很多专业的登山人员，但是这并不是最有效的，因为事实证明，并不是专业的登山人员能活着出来，所有，我找了我熟悉的社会各界人士，都能来有所尝试，算是一种冒险吧。”裕涧摊开手，无奈地笑笑。又突然将嘴凑近了流冬耳边，“而且，有一个事实是没有被公布的，曾有人从极北雪山活着出来的，而那个人却是整个队伍中唯一一个非专业人员——一个作家！”</p><p>“那他带出了什么消息吗。”</p><p>“很可惜，没有，他被找到的时候舌头已经被冻断，死在了来研究所的路上。”</p><p>——不合常理。</p><p>对话截止，裕涧带着流冬去会见了大厅里的人。其中有一部分人都是曾经的初中同学。</p><p>作为中国著名作家的阳尘，每一篇文章都深受钟爱；研究化学直至痴迷的贾烷和祥镜，曾也是并肩作战的兄弟；还有极限运动员砚昊，煞佑，宣椿；数学天才雎蒿；成熟但有些极端的泽沛，依然在物理上大有作为的系桐，活泼耐性的日隐，以及各行各业的人……</p><p>还有卢申。</p><p>卢申曾是能与裕涧比肩的人，依靠天生的智慧与后来者的努力，登峰造极，差一点点就让裕涧跌落神坛。但有一句古话——天才与疯子仅有一念之差，而显然的，裕涧才是那个天才。</p><hr><p>于是，老友重逢，大家说着，笑着。逐渐忘记了身旁三米厚的铁门，与门外的风雪。</p><p>直到裕涧在某一个下午，穿上了防寒服，让流冬与他一起出去一趟。两个人本还想聊些天的，可一出铁门，满面的风雪便让人与人之间的话语声被湮没在了雪花的呼啸声中。两人艰难地走到煜僭的吉普旁，迅速地开门攀上，又迅速地关门，以免车子内被雪花占领，热空气急速逃窜。</p><p>“这是要去哪儿？”直到这时，流冬的声音才勉强能够被听见。“见证历史性的一刻。”坐在后座的裕涧笑着，只是盯着前面，或是前方飞舞的雪花，或是正在开车的煜僭。</p><p>忽地，车停了。流冬毫无方向感，因为从始至终，他能看见的只有雪花。“我们到了”煜僭说着，关闭了发动机，“我就不下去了。”于是，仅仅走出不到两米远，流冬已经看不见吉普车了。他感觉到裕涧握着他的手，这有点让他措手不及。从裕涧的嘴型，流冬能够勉强读出。</p><p>“你马上就会看见了。”</p><p>忽然，流冬感觉到身边的雪花开始高速流动，似乎快要将他托起，盛到半空中去，幸有裕涧把他握住，才没有飞起来，流冬能隐约地看见，裕涧的脚下有一个铁钩，紧紧地插入了冰层。雪花飞舞，如六角形的飞刀一般，如果不是因为厚重的防寒服，两个人早已被切成肉片了吧。</p><p>正因为雪花的飞舞，周围的视野逐渐辽阔，流冬也才发现，眼前，正是极北雪山。静静地屹立在那儿，从山脚到山顶都是一片祥和，雪松摇摆着，挡住了一片又一片雪花的足迹。雪花包围着极北雪山，如同被风暴吸住一样，久久徘徊。越积越深。流冬向后看去，远处的雪花依然飞舞，挡住了一切视线。</p><p>“奇迹之一，当极北雪山‘极端化’时，周围与冬天有关的所有东西都会被吸引。就好像曾经在做电与磁实验时，距离磁铁不远的所有铁屑都会被吸引过去一样，而其他的，则会有规则地排列。”</p><p>没有风再吹过流冬的身边，但身后的雪依然呼啸着。北极光随着极夜降临，如同流水般，开始萦绕在极北雪山的山巅。霞绿的光如丝绸一般柔软，伴随着雕刻精致的六角形的琉璃。逐渐使山顶淡出了人们的视野。</p><p>接着，流冬感觉到地面开始震动，躺在极冰上的雪堆也被震散，向低处落去。忽然间，流冬感觉到耳膜的极度振动，一股强大的声波从远处传来，穿云而来——那是与风雪隔绝，在寒极的冬天不会听见的声音。</p><p>闪电在白天并没有什么光彩，就像是有人在大白天打开手电筒闪了闪。但至于声音，依然震耳欲聋。“怎么会？”流冬质问着裕涧，他只是觉得十分不解。“这是奇迹之二，没有任何预兆的暴风雨，就像是以前科幻电影里的神仙降临，必定会带着些自然的超现象一样。”</p><p>只是过了不到半个小时，原本能和周围事物融为一体的雪山，瞬间孤立而出，处处都彰显着与这个自然格格不入的现象。流冬看得入迷，才意识到有人正在拍着他的肩膀。裕涧的护目镜已经被雪给掩盖了，“明天，我们将会出发，去探索你面前的庞然大物。”</p><hr><h3 id="启程之章"><a href="#启程之章" class="headerlink" title="启程之章"></a>启程之章</h3><p>极北雪山山脚休憩站</p><p>一百多号人挤在一个热气屋里，谁都不愿意向房外踏出半步。</p>]]></content>
      
      
      <categories>
          
          <category> 短篇小说 </category>
          
          <category> 四季之歌 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 轻小说 </tag>
            
            <tag> 冒险 </tag>
            
            <tag> 东辰 </tag>
            
            <tag> 奇幻 </tag>
            
            <tag> 科幻 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>《那年夏天……》——致那无法触及的</title>
      <link href="/Eternity/%E7%9F%AD%E7%AF%87%E5%B0%8F%E8%AF%B4/%E7%B3%BB%E7%BC%92%E4%B8%89%E6%97%A5%E7%9A%84%E7%A7%8B%E5%A4%A9/mermaid-princess/"/>
      <url>/Eternity/%E7%9F%AD%E7%AF%87%E5%B0%8F%E8%AF%B4/%E7%B3%BB%E7%BC%92%E4%B8%89%E6%97%A5%E7%9A%84%E7%A7%8B%E5%A4%A9/mermaid-princess/</url>
      
        <content type="html"><![CDATA[<p>转自：知乎</p><span id="more"></span><h2 id="人鱼公主的愿望"><a href="#人鱼公主的愿望" class="headerlink" title="人鱼公主的愿望"></a>人鱼公主的愿望</h2><p>如果说，汉斯·克里斯汀·安徒生所写的人鱼公主里的公主愿望是与人类王子相爱走完一生，那我的愿望与她是相同的，但我就像是人鱼公主里的公主一样，在付出时间与努力之后什么也没有得到。</p><p>如果说，人能活到八十岁。那么在意识成形后，它大概还能享受几十年的夏天。我将我所度过的夏天排放在桌子上，全部放平后就能发现有两个夏天很特别，一个非常的明亮，一个非常的暗淡，接下来，我会将明亮的这个夏天尽可能的详细说给你听。</p><p>那是发生在一九九几年的夏天，我与他相遇了。</p><p>我与深町阳介开始当朋友是在国小的时候,不，说是朋友或许不对，因为我并没有与他确认明确的朋友关系，我只是将他单方面当做我的朋友。</p><p>记得那是在我入院几个月后发生的事。有一天，他转入了我在的病房，他睡在我正前方的病床上，他是一个看起来不好搭话，而且面相有些凶恶的男生。其实正前方的病床住进了什么人与我没有关系，但我就是会注意这个男生，这并不是因为他的面相凶恶又或者对人恶言相向才让我注意他，说起我会注意他的原因？也只是很无趣的小事，但对当时的我来说，这一定是一件大事吧。我想，我是在嫉妒他，是一种毫不掩饰，很明显的嫉妒。</p><p>他的母亲基本每天都会来看他，不论是春夏秋冬，又或者阴晴雨雪，他的母亲都会来医院看他。对于他母亲的行动我很是无法理解，因为就我的家庭而言，我的母亲是那种就算来到医院看我也是一副「我也不是喜欢来才这里」表情的人，但当时因为我年纪小，我以为是母亲因为太过劳累的关系才会这样，所以在母亲来到病房时我总是装出一副「没关系」的态度，在母亲待在病房里时我总是跟他谈一些没营养的话题，比方说什么医生的态度和善或者星期几的饭菜好吃等等，尽管我努力将事情说的有趣，但我的母亲只是一脸僵硬地用很简短的话回答我。随着年龄增长，我也逐渐意识到那是一种「认为人很麻烦的态度」，或许你会想说我有被害妄想症，但如果你看过我母亲的那种态度，我想你也一定会明白我再说什么。</p><p>每当他的母亲来到病房时，我总是拉起床边的防护帘，挡住眼前过于幸福的光景。虽然我的想法上明白看了也只会徒增悲伤，但我就是忍不住去看，心想着如果现在被照顾的不是他，而是我那该有多好。每当我的这个想法产生的瞬间，就被我马上打消，就连我自己都对自己的不干脆感到厌恶，明明只要果断接受现状就好了，但我怎么样就是无法放弃「只要我继续等下去，说不定哪一天我的母亲就会像他的母亲一样对待我。」但从结果上看，我的等待并没有用，只要我的脚一天不好，我所遇见的状况就不会有任何的好转，明白这点是在几个月后的那一天。</p><p>我与他的关系自那一阵子后有变的缓和一点。记得那是在美渚汀一年一度的烟火大会的夜晚。那一天，窗外的声响异常的大，在这个一到夜晚就只听得见蝉鸣声的美渚汀来说是很难得的夜晚。我降低身体的感觉，提高耳朵的灵敏度。窗外除了人潮的声音还有一声声巨大的声响。当我意识到这是烟火声时，我已经听不到烟火声了。我放空脑袋躺在床上闭上眼睛，尝试想像烟火是个什么样子，但仔细检索记忆后我才意识到我根本就没亲眼看过烟火这种东西，对烟火的记忆也只停留在五颜六色，飞到空中没过多久就会消失这种概念上的东西。因为平常在美渚汀里很少能看见或听见烟火的声音，再加上这半年多来的住院，已经让我彻底忘记了烟火这种东西到底是个什么样子，不，说不定连忘记烟火这件事本身我都已经忘记了也说不定。</p><p>　　想到这里，我的心中充满了不安，有一种像被墨汁般漆黑的海水给覆盖住的感觉，让我一时之间喘不过气来。让我从这份不安里脱身的契机正是因为他，因为母亲而被我单方面讨厌的他，不，说不定他也很讨厌我，只是我没发现而已。</p><p>当我回过神来，似乎已经过了十几分钟，我起身朝他的病床看去，病床上空无一人，我环视整间病房后才发现他正站在窗边看着外面的烟花。</p><p>我坐在病床上看着他。他有胎记的半边脸被一次次升起的烟花所照亮。在烟花升起的瞬间他似乎说了些什么，但因为烟花跟窗外的人潮声太大，让我听不清他说了什么。</p><p>大概过了有几分钟吧，我意识到我的眼角有着液体状的东西流下。我想，那一定是因为屋顶漏水滴到我脸上导致的。不然，我根本没有理由哭的不是吗？就在我这么想时，我的心中出现了一个不属于我的声音，它对我说道：「你是真的认为是屋顶漏水的吗？你难道不是对窗户边那个可以站着的男人产生嫉妒以及在自己无法站立的事实前产生绝望所流下的眼泪吗？」</p><p>也许正如你所说的吧，我对心中出现的那个声音附和到，但它完全不理会我，好像一开始就不存在一样地消失了。</p><p>我再度躺到床上，看向天花板。也许正如刚刚那个人所说，我的确是对自己无法再次站立这件事产生绝望并且嫉妒着能正常行走的他吧。只是，一旦开始思考起这种不合常理的事，就感觉全世界处处是不合理的地方，虽然我的想法上非常明白，但我就是忍不住想对什么人发脾气，但我发现没有什么人比起我自己更合适对自己发脾气了。</p><p>机会难得，我想尝试看看久违的哭一次。我也不管周围的人是如何想的，我将头埋进枕头里开始哭，眼泪化成一滴滴水滴在枕头上，我就像是要将几年间积累的眼泪全部哭干一样不断地哭。</p><p>我感觉到我的肩膀被人拍了一记，但因为在这个病房里我没有任何熟人所以让我感到惊讶。「不管对方是谁，我都不想正面被人看到我的这副模样」我简单擦拭了脸上的眼泪，看向后方。</p><p>最先印入眼帘的是他脸上大到有小半张脸的胎记。「为什么是他？他来我这里想干什么？难道是因为我的哭声太大影响到他而过来教训我的吗？」一旦开始思考他人的想法，各式各样的猜测都从心底里不断涌现，让我无心思考别的，注意力只专注在「他为什么要来到我的病床前。」</p><p>「我的疑问直到最后都没有得到他的解答。我想，那时的我之所以没有向他询问他为什么要来到我的病床前的答案是因为我还认为『反正我们的时间还很足够。』如果当时的我明白我们之间已经没有剩下多少时间的话，我一定会向他询问他当时为什么会来到我的病床前。</p><p>他坐到我病床旁的凳子上。他似乎是为了让我确定他手上什么也没有一般将两只手摊开放到我的眼前，在我确定后他手上没有任何东西后，他将手掌合起摩擦了两下手掌后，停下动作不动，正当我以为他发生什么情况而靠近查看时，随着一声轻微的声响后，他的手掌出现了一朵白色的花朵，那是一朵不管怎么看都跟真花这个定义无法搭边的人造花。但在他的手上，这朵花显得格外美丽，我想，眼前的这朵花它一定是我从过去到现在所见过花中最美的一朵，因为这朵花它不是为了别人，而是为了我而绽放的。</p><p>　　看完他的表演，过了一会，他似乎感觉自己将事情搞砸了一般低下头，看到他的这副样子我发出了笑声，他似乎对我的反应感到惊奇，用一副傻眼的表情看着我。</p><p>我不回应他，只是静静看着他手上的那朵纯白色的人造花。他看到我没回答，也很礼貌的不追问我，耐心的等待我的回答。我们之间大概经历了几分钟的沉默吧。</p><p>回过神来，我先对他表达了一声感谢。「谢谢。」我对旁边的他说道。</p><p>「不客气。刚刚你为什么要哭呢？」</p><p>「不知道。我知道我这么说你可能不太相信，但我哭的理由连我自己也不是非常清楚。我只是久违的想哭哭看，但没想到一哭起来就一发不可收拾了。」</p><p>「原来如此。你哭的理由我也不是不能理解。」</p><p>我想，就是在这个时候吧。让我首次对什么人产生了好感，不，那个时候这份感情也许还不能称为好感吧，可能更像是一种「眼前的这个人说不定会理解我的」这种心情吧。</p><p>自那天之后，我跟他的关系越来越好。他每天都会将他学习的魔术变给我看，尽管他的技巧不是多么高超，偶尔还会犯些小错误，但这些都没有关系。他的表演，是当时的我每天唯一期待的事情。</p><p>那时的我，由衷的期待这样的日子能更长一些，但我想老天爷就是那种不会聆听人愿望的存在。越是期待的事情越不可能实现，越是期待长久的事情就会越快结束，但要说这种话也得老天爷真的存在才可以，也许这时的我只是想借着老天爷表达些什么也说不定吧。</p><p>这一天，他也像平常一样来到我的病床旁将白天练习好的魔术变给我看。在他表演完后，我也像往常一样鼓掌。这时的我，还不知道他接下来即将要告诉我足以改变我往后人生的一句话。</p><p>如果故事在这里结束就好了，我曾无数次的如此期待，但我就是像是被冲上岸的人鱼一样无力，只有接受的这项选择。</p><p>「我准备离开了。」他很平静地对我说道。</p><p>因为事出突然，让我的反应一下慢了几秒。「准备离开？」我像是为了确定我没听错他说的话般将话重复了一遍。</p><p>「是的，医生前些日子来通知我可以离开的事情了。」</p><p>「……是这样啊，那恭喜你出院。」</p><p>「谢谢。」</p><p>「以后，我会跟你联系的，可以请你将你的联系地址给我吗？」</p><p>「可以，你等一下。」</p><p>他走到一旁的桌子上开始写东西。过了一会，他将写有他联系地址的纸条交给我。</p><p>我跟他的对话到此为止，跟他的关系也到此为止，已一段关系的结尾来说，说好听点也不能说是太好。</p><p>几天后，他的母亲就来到医院将他接走。离开时，他来到我的病床旁对我说了些什么，但当时的我根本没有将他的话听进耳朵只是尽可能的敷衍他赶紧离开。</p><p>我想，那时的我虽然想法上明白他的离开是迟早的事，但就是无法很好的感知他已经离开的这件事，在他离开后的那段日子里，我每天都期待着他能回到这间病房，再次来到我的病床旁将他练习好的魔术表演给我看，但在他离开快一个月后我也终于不得不接受他已经不会在回到这里来的这件事。</p><p>在他离开后的几个月后，我接到了医生的通知，说我可以暂时出院回家休养一段时间。在接到医生的出院通知时，说真的，我并没有感到多高兴，我只是满心想着「啊啊，终于可以离开这里了。」</p><p>隔天，我的母亲就来到病房接我。她走到我的病床旁对我说：「千草，准备一下。我们要走了。」</p><p>母亲的态度非常的冷淡。说真的，如果不是因为我跟母亲长的实在太过相像说我们是母女应该都没有人会相信。想必在母亲眼里，我一定是个令她感到厌烦的存在吧。</p><p>我不回应母亲，自顾自的穿上衣服等待母亲说离开。</p><p>「千草，我们走吧。」</p><p>拿上行李，我跟着母亲走出病房。走出这间曾经拥有着我跟他回忆的房间，这时的我，没有对即将失去这个回忆的场所表现出半点伤心的情感，我想那时的我还深深怀有着「没过多久我大概就要再次回到这里来的想法吧。」</p><p>然而我没有得到这个机会。就是在这天晚上，我第一次遇见了人鱼，不，应该说是自称人鱼的女巫吧。</p><h2 id="夏日的奇迹"><a href="#夏日的奇迹" class="headerlink" title="夏日的奇迹"></a>夏日的奇迹</h2><p>出了医院大门就看到父亲停好车子等在那边，自我开始住院起，我就基本没有见到过父亲，在我的印象里父亲是一个非常和蔼可亲的人，但现在我眼前的这个男人虽然面容与过去相比多了一种岁月的痕迹，但现在的他看起来跟过去那个和蔼可亲的父亲有了明显的不一样。</p><p>他看到我与母亲后叫我们上车坐好。我与母亲坐在父亲的车子后座。在开车回到家的路程中，母亲她们一句话也不说，只是静静地看着窗户外的景色。我原以为只要我的病情有所好转，母亲她们就会变回原本的样子，但事到如今，我才真的明白，只要病这种东西不从根本上解决掉，我所面临的问题就不会有任何的好转。</p><p>回到家中的我，坐上母亲准备好的轮椅，母亲站在我的身后，推着轮椅前进，让我回到自己的房间。</p><p>将我送到房间后，母亲对我说：「你先好好休息，等等吃饭了我会上来叫你。」</p><p>我正准备转头过去示意母亲我知道了，但转头过去她人已经不在那里。</p><p>我推动轮椅到书桌前。书桌上还放着我曾经看到一半的书与摆放着我还能站立时跟母亲她们一起在海边游玩的照片的相框，我拿起相框尝试看清母亲她们的笑容，但它与桌面上的书都积了一小层的灰，使我看不清照片原来的模样。对现在的我来说，母亲她们的笑容根本无法想像，我只能从曾经存在她们笑容中的物品中摄取一点「曾经母亲对我也是很温柔」的美好回忆。就在我如此回忆时，我心里曾经出现的那个声音再次对我说道：「事到如今，你才发现到这种行为只是自己单方面的自舔伤口吗？显然不是。你不是早已对这种状况心知肚明了吗？」</p><p>「你这是什么意思？」我对它询问到。</p><p>「你不懂我的意思吗？」它说道。</p><p>「那我转换一个说法来说好了，你真的是因为看不到她们的笑容才感到悲伤的吗？」</p><p>「……」</p><p>说完这句话，它就消失了。不论我如何在心中呼喊它，它都没有再对我做出回应。</p><p>我放下相框，坐在轮椅上静静思考它说的话，但不论我如何检视自己的脑袋都得不出合适的回答。</p><p>过了十几分钟，母亲上来叫我吃饭。</p><p>到了客厅，父亲正坐在椅子上看电视。母亲为我装好饭后，我们坐在客厅吃饭。吃饭过程中，父亲与母亲话也不说一句，只是各吃着自己的饭，在客厅里不断传来的只有从电视里发出的凄凉笑声。吃完饭后，我跟母亲说我想尽快回到房间休息，让她送我回房间。</p><p>回到房间后，我下了轮椅躺到床铺上，我没有任何想做的事情，躺到床铺上后我只是静静地看着天花板，也不知道是在什么时候，我就这么睡着了。</p><p>再次醒来，已经是深夜两点多。我坐上轮椅下到客厅寻找水喝，在喝了一点水后，我打开玄关的大门决定外出散散心。</p><p>这天深夜，我捏着轮椅轮子独自走在空无一人的街道上。 夏日夜晚吹来的凉风，有些格外的冷。但我不以为然，依然独自走着。 走了大约十分钟后，我来到了一处可以看到大海的沙滩。但走近一看，我才发现这片沙滩已经结束了它做为一片沙滩的使命。随处叠放的破旧电视、已经完全变了样的木制书架、屏幕裂开的电脑显示器，看到这幅景象不知怎么的我感到一种久违的安心感，仔细思考这份安心感之后我得出「大概是这里的环境不会在变的更差所以让我得到一种安心的感觉。」</p><p>随着海面吹来的凉风，让我的身体微微一震，为了避免感冒，我准备离开海滩回到家中。就是在这时，从不远处传来了那个声音，那个在现在这个时代已经基本听不到的那个声音。我朝着声音的方向看去，在那里的是一个与这个堆满破旧物品场所显得格格不入的鲜红色电话亭。我就像是被电话铃声吸引的傀儡一样，等我回过神来，我已经站在电话亭的旁边。在只有轻微海浪声的的海边，电话亭的电话铃声显得异常大声，正当我犹豫要不要走进电话亭接起这通「可能是打给固定某个人」的电话时，电话铃声中断了。听不见电话铃声后我不由自主的松了一口气，看来我比自己想像中更重视这通电话。但没过多久，电话铃声再次响起，它就像是知道我在电话旁边一样，电话的铃声不断的回响在夜晚的海边。我用力拉开电话亭的门，力气大到令我产生一种说不定会将整个门都扯下来的错觉。进入电话亭后，我还是犹豫着要不要接起这通可能是打给每天固定在这个时间会来到这里的某个人的电话又或者是无聊随便找了一个电话打，可能性这种东西一旦开始思考就会无止境的开始想像，但我的这个疑问，在接起电话后的几分钟就得到了电话那头的那个人的解答。就在我思考其他可能性时，电话也在一旁响个不停，仿佛是催促我赶紧接起电话。</p><p>「在做好被电话另外一头的人说一顿的准备后我接起了电话。」但之后的发展，完全超乎我的预估。</p><p>「你曾有一段放不下的过往对吗？荻上千草小姐。」</p><p>听筒那方说话的是一个女人，先不论她说的是什么，她确实准确无误的说出了我的名字，但她根本不给我多于的思考时间，只是自顾自的继续说着。我停止一切多余的想法，将注意力全部放在她接下来说的话。</p><p>「在不久前，你曾对深町阳介这个人产生了好感，但他突然地离开令你对他产生了一点不好的情感，同时你的心里也产生了一种如果不是我的腿脚不方便的话，我也许也能追上他的想法。」</p><p>那么，现在我来让你脚恢复成没有损伤前的状态，但与此同时，你也必须答应我一个条件。</p><p>听完她的发言，我花了大约近一分钟的时间才全部理清。理清思绪后我对她说道：「假设你说的是真的好了，但你知道你现在说的东西有多么疯狂吗？」</p><p>「我知道。但对现在的你来说这是一场不坏的交易吧？」</p><p>「你说的条件是指什么？」我问道。</p><p>「如果你不答应我玩这一场游戏，那么你知道这件事也没有什么用。」</p><p>我将听筒从嘴边拿开，陷入短暂的沉思。「正如电话那头的女人说所，如果先不看条件是什么，这对我来说的确是一场不坏的交易。」但这种说治就能治好的事情怎么可能存在，电话那头正在说话的女人一定是疯了。我准备就这样将电话挂断，但当我想这么做时，我的想法中出现了一种恶魔般的期待，「也许那个女人真的是拥有什么我无法想象的本事，确实能治疗好我的腿脚也说不定。」没过多久，我的脑袋就被「可能与不可能」这两种想法装满，根本无心想那个女人所说的条件到底是什么。</p><p>最后，我果然还是输给了自己的期待，我决定答应那个女人的游戏。但话说回来，我并不是真的打算相信那个女人所说的一切，我所采取的方法是「先答应她的游戏，看情况在决定日后的走向，毕竟这种说给你治好就能治好的人根本不可能存在。」</p><p>不论对方是想耍我还是别的什么，我都决定先答应她的游戏。</p><p>我拿起听筒对她说：「我决定参加你说的游戏，现在，可以请你告诉我条件是什么了吧？」</p><p>「可以。因为你已经接受了我的游戏。我的条件就是『你往后的人生中有一段时间是由我来掌握的，时间的长断也由我来决定。』」</p><p>「时间的长断也由你来决定？那你不就相当于把我的人生变成你的了吗？」</p><p>「话是如此。但你的人生值不值得我将它变成我的东西呢？」</p><p>这个女人的问题提的非常讽刺。她应该是故意这么说的，因为她毫无保留的用我能听懂的话说出我最讨厌的话。</p><p>我不回答她的问题。问她：「你什么时候能治好我的腿脚？」</p><p>「嘟嘟嘟嘟……」</p><p>那个女人将电话挂断。留下我一个人独自待在原地。伴随着电话挂断声，我的心情渐渐恢复平静。</p><p>离开电话亭，我坐在轮椅上思考那个女人到底是怎么知道我会在今天晚上外出。如果说我曾经会深夜外出那可能是我身边的某个人为了耍我而做的恶作剧，但今天我会出来纯属是巧合，就连我自己都无法预测到，当然如果说那个女人只是刚好撞上这个巧合打电话给我那只能说是巧合撞上巧合，但她准确的喊出了我的名字，如果事已至此在说这是巧合，就有点自欺欺人的感觉。我放松身体，靠在椅背上。不论我怎么思考，我都无法想出那个女人是如何做到的。</p><p>「不是有一个假说可以证明吗？」我的心中传来那个声音。</p><p>「你说的假说是什么？」</p><p>「你自己不是应该最清楚吗？其实你有解释这一切的答案，只是你自己不愿意接受那个答案罢了。」</p><p>不要说了。我没有完全相信那个女人说的一切，就算到了现在我的理性也由为清楚的告诉我「刚刚发生的一切其实是一场整人节目。」因为如果不是这样，那个女人所说的一切只能证明她疯了，事实上也可能确实是这样。</p><p>「如果说那个女人说的一切都是虚假的，那么曾一度尝试相信她发言的你岂不是更疯狂吗？」</p><p>我不回应它，任由它口沫横飞的说，也不知道是什么时候，它就不在说话就这么消失了。</p><p>在海滩上待了一段时间后，我准备起身回家，我捏着轮椅的轮子向着家的方向出发。海风像是要护送我回家一般，在我转身准备离开时吹起一阵清爽的凉风。我转身看向远方，浅黑色的天空正逐渐泛白。为了避免被父母发现我偷跑出来的事情，我加快速度回家。</p><p>到达家门前后，我避免发出声音小心翼翼的打开家门。家里跟我离开前没有什么变化，看起来，母亲她们应该还没有醒来。松了一口气后，我尽量避免发出声音回到自己的房间。</p><p>回到房间后，我躺到床上开始思考起今天晚上那个女人说的话。「那个女人所说的东西，虽然荒唐令人无法相信，但她确实说出了我的期待。如果说，她说的一切是真的，那对我来说说不定会是一件好事吧。」在思考这件事的过程中，我不知不觉间睡着了。</p><p>当然，隔天起床后我的期待没有实现，想来也是理所当然的，说治就能治好这件事怎么可能存在。虽然我自认自己没有在期待这件事的发生，但从结果上看，我比起自己认为的还要在意这件事。</p><p>我起身坐到床边看向窗外。窗外的天空像被石灰涂抹过一般灰蒙蒙的，使人无法看清天空原有的颜色。每到夏天，美渚汀都会异常的炎热，所以能在夏天里看到这样天气的日子实在是非常稀少。</p><p>明明是白天，但周围却安静的出奇，俨然就像是身处在一座空无一人的城市，但我并不讨厌这种感觉。</p><p>就在这时，从楼下传来一阵像是铃铛的声响，我不去搭理这个声音，但它就像是催促我赶紧过来一般不断的发出声响。我回到床上，将被子盖过头底决定不去理会就这么等它自己消失。过了一会，发出这个声响的人似乎是累了停止发出那一阵阵的声响，就在我以为不会发出声响准备在睡一觉时，门口传来敲门声。</p><p>我提高警觉，将注意力都放在门口上。这时，门外传来母亲的声音。</p><p>「千草，你睡醒了吗？」</p><p>在听到母亲的声音后，我的心情稍微得到了放松。我不回应她，等她自己离开。</p><p>但母亲像是看出我不想理她一般自顾自的说道：「千草，刚刚有送货员给你送来了东西，你有时间了出来拿一下。」</p><p>我不顾母亲说的东西，只是独自待在房间里看着一片洁白的天花板，家里洁白的天花板与我在医院里看到的非常相似，记得那时是我刚住进医院没多久的一天。</p><p>那天在接到医生的报告后我躺在病床上想医生先前说过的话。但话说回来，我不记得医生说了些什么，我的意识从医生说出「以后你再也无法行走」这句话后就中断了，我想医生在那之后说的话我都无法准确的体会吧。</p><p>「尽管到了现在，我也无法准确相信自己已经无法走路，但我就像是路边的小石子一样，既便被人踢动也无法做出任何反抗。」</p><p>这时，我想起母亲对我说起过的放在门口的东西。</p><p>我打开房门，一个纸箱正放在那里。在确定了收件人荻上千草后我才将纸箱拿进房间。</p><p>我拆开纸箱，里面放着用看起来很高级的牛皮纸封起来的信封，信封的上面写着我的名字。拆开信件，里面放着一张来自参叶国中的录取通知书，除了通知书以外还有一套一起寄来的水手服，看来这套衣服就是参叶国中的校服。</p><p>如果说，这封录取通知书能在早一点寄来我应该会发自心底里的高兴吧，但现在的我即便收到这封录取通知书也丝毫想笑的感觉都没有，我只是满心想着「啊啊，原来还有这件事啊。」不过，现在才寄到也没有什么用了吧？以我现在这副样子，是绝对无法正常上下学的。</p><p>我坐在轮椅上不动，「为什么这种事情偏偏要发生在我的身上？」我对着空无一人的房间问道。当然，我并没有得到回答，我只是独自思考着这件事。越想只觉得这个世界上的一切是那么的不合理想尽情破坏。</p><p>我搜索周围有没有即便破坏了也没有关系的东西，最后，我的视线放到了跟随录取通知书一起寄过来的水手服。「反正我也没办法去上学了这衣服就算怎么样了也没有关系吧？」我在桌子上找能破坏衣服的工具，这时，我看到了沾了一点灰尘的笔筒里插着用来剪纸的小剪刀，到了这时我才发现，这个剪刀原来除了剪纸还能用来剪破衣服。</p><p>我将衣服拿起放在眼前，将拿着的剪刀对准衣服靠近，准备就这么剪下去。</p><p>「咚咚咚……」门外突如其来的一阵声音使我的脑袋一下冷静了下来，我停下手中的动作任由剪刀与校服从我手中滑落。缓过神来时门外的那个声音已经停止了。</p><p>我将校服与滑落的剪刀捡起收拾好放在桌面上后躺到床上。</p><p>我将毛毯盖过头顶什么也不想只是这么躲到漆黑一片的世界里，因为我觉得如果不这么做，我一定又会做出什么比刚刚更出格的事情，也不知道过了多久，我就这么睡着了。</p><p>我独自一人坐在轮椅上看着大海，海水随着一阵阵波浪拍打着岸边溅起形状不一的浪花，眼前的景色很美，我发自心底里的这么认为。正当我准备继续享受这段安静的时间时，我的意识中断了。</p><p>在眼睛只能睁开到一部分的状态下我最先看到的是类似我房间的天花板图像，我努力让眼睛对焦将眼前的图像合成一幅清晰的画面，但意识的不清晰使我没能成功。刚从睡梦中清醒的身体本能的向我的脑袋发出需求水的要求，喉咙就像是被火烤一般传来一种异常难受的感觉，我下了床铺走到桌前拿起水杯里的水喝，但杯子里只有不到一点的水根本不够喝。</p><p>我打开房门准备走下楼梯，意识还不清晰的我为了避免踩空扶着楼梯间的栏杆一步步慢慢走向厨房。到到厨房后我就像是饥饿到了极点的野狼一样冲到冰箱前从里面取出清水喝下，缓解了口渴后我打开厨房的后门走到外面。</p><p>夏天是非常炎热的一个季节，我想这应该很多人知道，但是晚上的夏天却非常凉爽，我想这应该很少人知道，至少在这美渚汀里夏天的夜晚基本不会有人在外面。</p><p>迎面吹来的凉风非常的清爽，这阵风中既有炎热夏天的味道也有夜晚的夏天的感觉。「夏天真的是一个很不可思议的季节呢」我如此想道。</p><p>在吹了一会凉风后，模糊的意识也逐渐清晰，我关上后门准备就这么回到房里继续睡觉。</p><p>走出厨房的几秒钟我突然意识到一件事，一件在很久以前我还会天天做的事，但那件事由于几个月前发生的事故而剥夺走了我做这件事的权力。这辈子恐怕在也无法走路了，医院里的医生对我如此说道。几经尝试没有用后我也终于决定接受自己无法在走路这个无力改变的状况时，几天前的那个深夜，那个女人所说的东西却颠覆了我原本的认为。当时的我以为这只是一场无聊的整人节目，但现在眼前发生的状况却告诉我那个女人所说的一切都是真的。</p><p>「我的大腿正比直的站立着……」</p><p>因为事情发生的太过突然，我甚至怀疑自己是不是根本没有睡醒还在梦境中又或者是天天想着大腿能复原而最终想疯了导致脑袋出现问题认为自己的大腿终于好了。</p><p>但事实上我的脑袋非常清楚，因为脑袋有问题的人是不可能觉察到自己的脑袋有问题的。</p><p>正当我为眼前的状况找不着头绪时，那个声音再次在黑暗的空间里响起了，那个可能可以解决我一切问题的声音。</p><p>走廊的另外一头，座机正发出一声声声响。我就像是害怕失去刚刚得到零用钱的小孩子一样跑到座机前接起电话。</p><p>我原以为我会对着电话那头提出一大堆问题，但事实上我却什么也说不出只是静静等待着电话那一边的人说话。</p><p>「晚上好，荻上小姐。」</p><p>「……」我不回应她，等待她继续向下说。 也许你现在正在想为什么我会知道你家里的电话，为什么会知道你现在会站在座机的旁边又或者为什么我会选择现在打电话给你吧？</p><p>「……你，你到底是什么人？」</p><p>电话那头的女人用很得意的声音回答我道：「我是人鱼王国的人鱼。」</p><p>「人鱼王国的人鱼？」我就像是为了避免听错一样，而重复了一遍她刚刚说的话。</p><p>「是的。」</p><p>如果说，将这个女人现在所说的话放在曾经我一定不会去给予理睬，但现在我却开始相信这个女人说的东西是真的，我想我根本就是疯了。</p><p>你打电话来做什么？</p><p>「来做什么？做为治疗好你大腿的条件你忘记了吗？」</p><p>当她说到条件时我才想起这件已经被我忘到脑袋角落的重要事情。</p><p>「所以说，你现在是来履行你的条件的吗？」</p><p>「不是。我今天打电话来是为了恭喜你的。」</p><p>「那还真是谢谢你。」</p><p>「嘟嘟嘟嘟……」</p><p>那个女人不等我说完就将电话挂断，她就像是夜晚里的星星一样在白天即将来临时什么痕迹也不留的就这么消失了。</p><p>这天夜里，我基本没有睡着，只是静静地看着天花板与大腿度过夜晚漫长的时间。我想我应该是在害怕吧，害怕一旦闭上眼睛，大腿就会恢复成无法行走的模样，害怕一旦睡着再次醒来时就会发现大腿复原只是我做的一个美梦。</p><p>但隔天醒来后，我周围发生的情况都在告诉我「这不是在做一场美梦，我的大腿确实复原了。」</p><p>我能准确体会到我的大腿已经复原这件事全靠母亲与父亲脸上惊讶的表情。简单来说，当他们看见我的大腿可以笔直站立时，他们的嘴巴张大到了可以当做下巴的位置，他们甚至以为两个人产生了相同的幻觉看见了一个跟自己女儿长的非常像的人而不停的询问有关过去的事情来确认我是他们的女儿「荻上千草」这个人。不过，他们反应也是很正常的，毕竟在几个月前自己的女儿已经被医生打上了「这一辈子都不可能在行走的标签」会感觉到惊讶也是理所当然的吧。</p><p>父亲与母亲他们将我的大腿复原归究于奇迹这类的说法，虽然他们嘴上对我这么说，但我很清楚他们根本没有了解事情经过的打算，他们只是将眼前看得见却无法理解的东西给归为奇迹这类的说法罢了。</p><p>自那一天起，我的生活有了很大的改变，父亲与母亲对我的态度越来越和善，来到新学校后同学们对我非常好，我的朋友也逐渐多了起来，在这之后，我的父亲因为工作上的成功顺利买下了一套比我们之前住的要好的多的房子。自那一天起，我身边所有的事情都变的越来越好，我就像是要将先前不幸时期没有使用过的运气放到现在全部使用完一样不断过着幸福的生活。如果一定要形容这段生活的话，就像是一种周围一切都变的太合理的这种感觉。我就像是《灰姑娘》故事中的灰姑娘一样，在得到了女巫的帮助后就此过上与之前截然不同的幸福人生，但自从那一天起这个自称人鱼的女人就像是《灰姑娘》故事中的女巫一样在帮助了我之后就这么消失没在我的身边出现过。</p><p>她消失的这段时间里已经让我将她曾经说的约定忘到了记忆的深处。</p><p>「这时的我因为过于注重眼前的幸福，而忽视了今后的日子。但是我想不只是我，这个世界上应该也有人拥有着这种『只要现在好，以后的事情以后再说吧』的处事论吧。」</p><p>在大腿复原后的那段日子里每当父母对我露出他们那种久违的笑容时我都深刻感觉到「如果我的大腿不复原那一切应该就不会是这样了吧」的想法，其实会有这段想法也不是什么奇怪的事情，如果你也曾经看过我住院时期母亲他们对我露出的态度就会完全理解我说的东西了。</p><p>「也许任何人在拥有成功一面的背后也都潜藏着一败涂地的可能性，只可惜到了如今依然有很多人不顾眼前难以翻身的局面只是相信着所谓的曾经或者以后可能会变好的以后。如果说，人所面临的问题不能得到根本的解决，周围的情况是很难拥有好的转变的，我再次深刻感受到这点。也许人生就是这种只要出现蝴蝶振翅般的变化就会走上与曾经截然不同的路。」</p><p>今日，我向往常一样外出上完学回到家中在自己的房间里看书。看书这个习惯是从我小时候就拥有的习惯，除了住院那段时间停止后我对看书这件事依然保持着很高的热情，如果说我的房间里有什么跟我这个年纪很不相配的东西那就是我的房间里摆放着一个放满书的大型书架。母亲看到我天天在家中看书也难免担心我会不会因为看书这件事而变得无法跟周围的人正常沟通只是天天看书，她也曾耐心劝导我要出去跟朋友玩，但被我以「我想将我住院时期没看完的书看完」为由给拒绝了。不过话说回来，这些书不论我看书怎么慢也完全可以在一年内看完，到了我升上国中三年级马上就要毕业升上高中的现在，母亲也没有再来劝导我出去想必是因为她已经发现了，她的女儿我不想出去这件事吧。</p><p>说起我国中度过的日子，虽然可以说是有趣但绝对谈不上是会让我印象深刻的校园生活。尽管我上的是美渚汀里最好的国中，尽管我在学校里有很多的朋友，尽管我在里面有很多快乐的回忆但我就是会记不住这些，比起这三年来的快乐记忆我在国小时期的悲惨生活还让我更印象深刻一点，但如果要说在这三年里有什么事情是让能我印象深刻的话，确实是有一件事。</p><p>记得那是在刚上国中的第一天，在临近上课前的几分钟我坐到座位上拿出教科书预习等等课上要教的内容，但在隔了三个位置的右手边有一个位置上发出异常吵杂的声音，那声音并不是由一个人发出，而是至少有四，五个人在说话，它们说出的话杂乱在一起使人根本无法听清它们到底说了些什么。起先我以为那些人正在霸凌什么人，但从他们的装束上看去并不像是那种小混混的打扮。在他们中的一个人离开后我看见了那个女孩子，在看见那个女孩子后我也终于理解为什么那群人会挤在那个位置的附近，因为那个位置上坐着初鹿野 唯。</p><p>其实什么位置坐上了什么人对我来说都没有太大的影响，但是这个女孩子与我不同，她却有着坐上了什么位置都能带来影响的魅力。</p><p>自那之后我总是不自主的去注意这个女孩子，一旦开始注意她后，我就很明显的发现这个班上的大部分人也都基本将注意力放在初鹿野 唯这个女生身上，不过想来也是很正常的，如果说我是个男孩子我也一定会对她产生好感，她就是有这样的魅力。</p><p>从她的表现上来看，她很清楚自己的魅力但从来不过度使用，她与任何人都保持着一定的距离，既不会让人感觉到遥不可及也不会让人感到太好亲近但她对周围人群的笑容让我感到一种痛心疾首，她的笑容有种勉强的感觉在其中，如果不是我也曾经经历过这种笑容想必是不可能发现的吧。但当时的我根本无心探究她为什么会这么笑，如果说初鹿野 唯这个女孩子除去这点真的可以说是完美，她的魅力不只是从她的样貌中散发出来的，她的举手投足或者行动方面都做的非常出色，那时的我对她的表现感到一种发自心底里的佩服。</p><p>初鹿野 唯这个女孩子的笑容给我一种勉强自己的想法这种感觉也只到国中二年级时。还记得那是正值夏日的某一天，初鹿野 唯也像往常一样来上学。最早注意到初鹿野身上异常的是经常会跑到她身边找她聊天的一个名叫「美纪」的女孩子。她看着初鹿野的脸说道：「唯，你的脸上那个黑点是怎么回事？」听到她这么说，周围的人马上跑到了初鹿野的身旁开始问她脸上的黑点是怎么回事？但初鹿野并没有回答她们，只是摸着脸上的黑点像是在抚摸什么来之不易的宝物一样。原本大家都以为那是年纪到了会自然长在脸上的东西所以没有在提起这个黑点的事情。</p><p>但自从那天过后的半个月，初鹿野脸上的黑点越来越大，现在已经长到有小半块脸的程度。对于这个类似污秽的痕迹，同学们之间存在着很多的说法，有的人说初鹿野是活该，有的人同情初鹿野的遭遇，有的人说初鹿野可怜，有的人对于初鹿野的遭遇感到开心，真的可谓是五花八门。但初鹿野本人似乎根本不在意这些，反倒因为脸上长了这个污秽的痕迹而感到开心，周围同情初鹿野遭遇的同学们也积极鼓励她不要自我放弃，她也像是将这份鼓励深深记在心里一样积极回应周围鼓励她的同学们。那个时期的初鹿野如果要说与曾经有什么明显的不一样的话我想就是出现在她脸上的污秽与她笑容中出现的改变。她的笑容与过去有着明显的不同。如果说她曾经的笑容给我的感觉是一种「什么美好东西被破坏殆尽所剩下的残骸」的话，那么她现在的笑容给我的感觉「就像是得到了什么无可替代的美好东西一样。」但对于我来说，她的改变不只是这些。</p><p>初鹿野脸上的那个痕迹跟我曾经看过的他脸上的痕迹很像，跟那个曾经被我单方面讨厌又被我单方面当做朋友的他。</p><p>「这时我还没能理解到，初鹿野脸上的那个痕迹会对我们三个人的人生产生多大的改变。我只是静静地享受着当下的幸福人生，如果说我能早些觉察到初鹿野脸上的痕迹是怎么回事，也许一切就会不同了，但我值到最后也没能得到这个机会，也许这就是对我的报应吧，对一心耽溺于幸福人生的我的报应。」</p><p>曾经身为初鹿野同班同学的我们一直都无法理解一件事，那件事是发生在升上国中三年级的时候。某一天初鹿野没有来上学，在这天之后的明天，后天，大后天她也都没有来上课。虽然老师说是初鹿野同学家中发生了一些事情，但看老师回应的态度她也应该不是很清楚发生了什么事。就这样，她一个星期都没有来上学，再次看见初鹿野时，我想谁都无法相信眼前这位态度冰冷的少女会是曾经那个积极回应大家鼓励的少女。虽然同学们都有问她发生了什么事，但初鹿野本人一点都不愿意谈，即便是导师问她她也只是以「没什么」应付她。</p><p>自那时起，初鹿野就很少来到学校，就算偶尔来到学校里也只是什么都不说一个人坐在座位上，久而久之曾经跟初鹿野熟识的人也开始觉得初鹿野不想跟她们做朋友了而逐渐蔬远她。虽然同学们私底下会讨论初鹿野的身上发生了什么，但却不在她的面前问这件事了，不在她面前讨论这件事，在不知不觉间同学们形成了这种默契。</p><p>距离上一次见到她，已经是三个星期以前的事情。这时同学们都忙着学习或者开始考虑上什么高中而烦恼着，而我则已经通过自考进入了「美渚第一高中」就在前几天我的录取通知书也已经收到了，虽然母亲跟我说不去学校上学也没有什么关系了，但我还是坚持想将国中时期的日子全部过完。我想对我来说这段国中生的日子算是代表了我幸福的一段日子。</p><p>「然而幸福这种东西，一旦到了某个瞬间就会完全抛弃你。」明白这件事是在国中毕业典礼的当天。</p><p>这天，我起晚了，一睡醒换上校服就赶到学校参加毕业典礼。到达学校时，校门口已经被数不清的父母们围住，我花了不少气力才成功进入学校。到达校内后我赶到班上，同学们正兴趣高涨的讨论着今后的去向以及放假了要去哪里游玩等等，我则坐在座位上等候老师过来通知毕业典礼的开始时间。大约过了二十分钟，老师来到班上通知我们下去集合开毕业典礼，到达体育馆后老师开始点名，在点到初鹿野名字时班上没有人应答也没有任何人说出她去了哪里，老师也不管她如何只是持续着点名，在确定了只有初鹿野一个人没来后老师告诉我们不要吵闹便离开了座位。</p><p>过了几分钟，校长走到了讲台上开始致毕业典礼词。讲了大约二十来分钟后，校长以「在这里，祝各位同学顺利毕业」为最后一句话结束了这场毕业典礼。毕业典礼结束后，老师走到我们的面前通知我们拿上放在班级里的东西就可以回家了。</p><p>回到班上，同学们先是各自道别在来就是决定放假后组织一起去哪里玩。当然，我没能参加去哪里游玩的讨论，这样说可能有点问题，准确来说是我自己不想去参加那边的讨论。我跟几个关系要好的同学们道别后就离开了教室踏上了回家的路。</p><p>这时，如果我已经知道我没有多少时间的话我想我至少应该跟她们每个人认真道别一下才对，但我没有得到这个机会。</p><p>进入家中后，我被家中突然响起的一阵声音给吓了一跳。我朝声音的来源靠近发现是家中的座机正在响，我想也没多想就接起了电话。</p><p>「首先，恭喜你国中毕业。荻上千草小姐。」</p><p>电话那头传来我熟悉的声音。</p><p>「……你打电话过来不可能是单纯为了恭喜我的吧？」</p><p>「是的。我这一次打电话过来还有一件事但恭喜你国中毕业也是真的。」</p><p>「那还真是谢谢你。那么，你说的另外一件事是什么？」</p><p>「你果然忘记我们的约定了啊。」</p><p>当她说出约定后，我开始回溯记忆中的约定，到了这时我才明白她这次打电话来是为了什么。</p><p>「你现在是来实现跟我的约定的是吧？」</p><p>「看起来，你想起来是什么事情了。是的，这次我打电话过来就是为了实现这个约定的。」</p><p>「……如果我违约的话，你会怎么样？」</p><p>「违约吗？我想你自己应该非常清楚违约的话会有怎么样的后果吧。」</p><p>「……」</p><p>「在你拿走这个身体前，我有一件事想问你。」</p><p>「荻上千草小姐，我想你现在没有理由可以问我什么事吧？」</p><p>「话虽如此，但你会选择在这个时间段拿走我的身体一定有你的理由吧？」</p><p>「我想就凭这点，我有理由可以问你事情。」</p><p>那个女人发出一声类似嘲笑般的笑声后对我说：「虽然我没有义务回答你的问题，但做为你最后的一个问题我就回答你好了。」</p><p>「请说吧。荻上千草小姐。」</p><p>「深町阳介现在过的好吗？」</p><p>「……没想到。」</p><p>「我原以为你会问我一些你什么时候将身体还给我或者我可以活多久这类的问题，没想到你竟然会问我关于别人的事情。」</p><p>我不说话，等待她解答我的疑问。</p><p>「他过的不算好。」</p><p>「不算好是怎么回事？」我反问她。</p><p>你的一个问题我已经回答完了，荻上千草小姐。</p><p>「对你来说，他的事情你只要了解到这里就好了。」</p><p>「了解到这里是怎么回事？他现在到底过……的」我的意识到这里中断了。</p><p>再次恢复意识醒来时，我正躺在医院的病床上。意识恢复大半后，我坐起身来，在我起身后一个蓝白相间的记事本滑落到病床的边缘线附近，我拿起记事本翻开。上面写着的是距今一年前值到前几天发生的事，但我回溯记忆我根本没有写过这种东西，而且记事本上面写着的事情我根本都没有印象。这时，我想到了那个女人，那个自称是人鱼的女人，如果说这个记事本上面写的一切都是真的话，那么写这个记事本的人一定就是她。</p><p>我不懂她这么做的用意，但她放在这里一定是希望让我看，虽然我没有肯定的根据，但我就是这么认为的。</p><p>我坐在床上将记事本翻到第一页开始看起，那是从我失去意识后的隔天开始的故事，那是发生在一九九几年的夏天里的故事。</p>]]></content>
      
      
      <categories>
          
          <category> 短篇小说 </category>
          
          <category> 系缒三日的秋天 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 轻小说 </tag>
            
            <tag> 恋爱 </tag>
            
            <tag> 校园 </tag>
            
            <tag> 三秋缒 </tag>
            
            <tag> 奇幻 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>《重启人生》 ——致，我一落千丈的人生</title>
      <link href="/Eternity/%E7%9F%AD%E7%AF%87%E5%B0%8F%E8%AF%B4/%E7%B3%BB%E7%BC%92%E4%B8%89%E6%97%A5%E7%9A%84%E7%A7%8B%E5%A4%A9/starting-over-again/"/>
      <url>/Eternity/%E7%9F%AD%E7%AF%87%E5%B0%8F%E8%AF%B4/%E7%B3%BB%E7%BC%92%E4%B8%89%E6%97%A5%E7%9A%84%E7%A7%8B%E5%A4%A9/starting-over-again/</url>
      
        <content type="html"><![CDATA[<p>转自：知乎</p><span id="more"></span><p>我接下来要说的故事跟你曾经听过的故事可能有所不同。</p><p>如果说人生可以重新开始，很多的人应该都会利用第一人生中的后悔与反省来期待更加美好的第二人生。</p><p>每个人应该多少都有那么些后悔。有的人后悔没有在年轻时代好好爱过一个人，有的人后悔在年轻时代谈了恋爱，有的人后悔没有好好跟父母说过一次话，有的人后悔告诉父母什么事，有的人后悔跟什么人扯上关系，有的人后悔没跟什么人早点变熟。嗯，总之我想表达的就是「人生就是伴随着后悔」关于这点，你也应该大致会认同。</p><p>但是，说起我做的事，几乎跟上述完全相反呢。不，其实我也曾做过蠢事哦。</p><p>当我得知我的人生倒转了十年我是这么想的。「为什么要对我做这么多于的事情？」</p><p>成为一个对自己人生毫无后悔的人应该非常稀有吧，什么重新开始人生的机会应该要给那些天天祈祷人生能够重新来过的人吧？但是呢，机会这种东西往往是给那些不祈求机会的人，从这点来看老天爷还真是爱唱反调呢，当然，要说这种话也得老天爷真的存在才行呢。我应该是想通过老天爷来表达些什么吧。</p><p>说起曾经我是如何忍受那么悲惨的高中生活？说起来也是非常无聊的理由。</p><p>在教室里面有一个男生，那个看起来与我一样被人孤立起来的人。他跟我一样没有朋友可以聊天，至少在我可以看见的时间里我从来看见他与什么人交谈过。眼睛里总是表露出一种「我根本不属于这里的眼神」，他就是这样的一个男生。</p><p>真要说的话，他的个子还算高，长着清秀的五官。他的视线总是朝下，偶尔必须与人四目相对时就像是在瞪别人一样，就算与人沟通也从来都是一副高高在上，完全不在意别人的态度。虽然他的态度如此，但从旁看来他完全不具备拥有这种态度的资格就是了。</p><p>他与我念的是同一所国中，我们在国中时代绝不是找不到任何朋友，只要我们愿意主动开口搭话，分散在教室角落的那些人自然会将我们当做朋友。但很糟糕的是，当时的我心中还怀有着很强的坚持，打个比方来说就是「我认为我还是曾经那个人人称赞的女生。」我从以前就认为朋友这种东西就是应该由其他人来主动靠近我的。当然，就算我在怎么迟钝，也不可能对不主动就交不到朋友这点没有任何的察觉，准确来说是我察觉了却完全没有想行动的想法。</p><p>我曾以为，时间过去我所面临的问题就会有所好转，但实际情况却不是如此，我所面临的问题的确没有变的更坏，但也没有任何好转的现象。谁也不能保证等了就会有好的结果，就像是雨等了也不一定会变小，离开的人等了也不一定就会回来，我的等待只是再一次的重现了过去无数人所证明的不可能。</p><p>不知不觉就说到了朋友这个方面上，我本来是要说怎么度过这段悲惨生活的吧？</p><p>那是升上国中三年级的时候，比起先前，我在班上受到孤立时的自卑感变的异常大。每当到了这种时候我总是看向那个男生，看向那个与我一样没有任何朋友的男生。说起来，我的做法真的是很不要脸「也就是说我将那个男生的悲惨经历当做一种理所应当的镇静剂，虽然我很清楚这种做法有多么不要脸，但当时的我如果没有这么做，就一定无法保持正常的理性。」话说回来，我感觉他也是将我的处境当做一种镇静剂来保持他的理智。你可能会想说我有被害妄想症，但如果你看过一次他的眼神你就会完全理解我在说什么了，那是一种彻底地瞧不起人的眼神，也就是说我们两个人虽然想的不同，但骨子里却是同一类人吧。</p><p>说起被孤立时的状态？真的是糟糕透了，但当时的我因为有他的存在而感到庆幸，光是看着他不幸的模样就让我深深的感到救赎哦。我曾不只一次凭借着「我虽然被女生们孤立，但跟他比起来我还是有一些方面比他强来看不起他。而他则是凭着我虽然被男生们孤立，但比起男生被孤立还是女生被孤立比较可怜吧来看不起我。」嗯，当时的我们就是借着这种想法来伤害彼此与互相安慰的。</p><p>一年级的时候，我还不太习惯这种孤单一人的生活，而跑去图书馆看书打发时间。而他也是这样，所以我们经常在图书馆碰到。虽然我们认识彼此，但却不会出口打招呼，只是就这么擦肩而过，不打扰对方。</p><p>在每个月都会来访的意志消沉期，我总是选择去医务室来躲避这段时间。然而每三次就会有一次跟他碰到，看来他跟我想逃的课都是一样的啊。</p><p>虽然这种做法不是很好，但是效果却很显著。如今回忆起来，如果不是有他的存在，我或许早就离开了那间学校，一个人躲在房间里很闷酒也说不定，但正他的出现，我才没有变成这样，我由衷的感谢他出现的这件事。</p><p>在那之后，我与他的关系变的更亲密了，明明我们两个人根本不像是那种可以与人变的亲密的样子，但也许正是因为当时的我们怀着这种相同的想法才导致我们多多少少变亲密了一点吧。</p><p>还记得那是因为班导多于的想法，让我们可以自由选择座位，但自由选择座位的人不能选择最后一排，由此一来坐最后一排的人就成了完全不介意座位的人。当时的我每五次换座位就会有一次跟他坐一起，自此之后大家好像也都将我跟他坐一起视为一种合情合理。每当大家投来那种好像我们是一对的眼神时，我总是在想「有没有搞错，为什么会把我跟这种人想成一对？我的男朋友可比他优秀太多了，把我跟他想成一对我也很困扰的好不好？」每到了这种需要忍受同学眼神时我总是看向他以求得心灵上的慰藉。</p><p>我跟他不仅是孤立的原因相同，就连孤立的本质也很相同。我们都有着一副「我们根本不属于这种地方」的眼神。其实就我而言我非常清楚第二人生的自己有多么不像样，根本就没有任何资格去小看他人，但是每当我想起第一人生的种种时我总是想着「你们这些人跟我第一人生所交的朋友根本就是两个极端，看不起你们也是理所应当的吧」。当然，在她们看来我可能是比他们更不怎么样的人就是了。</p><p>我总是因为想着第一人生的幸福，才导致迟迟无法接受第二人生的现状。就算到了现在，我也不断的在想「为什么我的第二人生会变成这样？我明明是按照第一人生一样的选择来做的，为什么会出现如此大的偏差？也许正是因为经历了完美幸福的第一人生，才导致了我无法接受现在的第二人生也说不定。」</p><p>这天，离开学校回到家的我，将书包扔在地上后就躺到床上。我闭上眼睛，回忆起第一人生的幸福与常叶在一起的日子。回忆第一人生的幸福，这是来到第二人生的我每天必做的事情，无论春夏秋冬，阴晴雨雪我都不曾中断这件事。每当回忆起第一人生的幸福，我就越感第二人生的糟糕，真的是糟糕的人生呢。我想这就是对我的报复吧，不是对任何人，而是对我的报复，对天天耽溺于幸福的我的报复。话说回来，我也曾想过会不会就是因为老是想着第一人生的幸福，才导致第二人生的我迟迟无法融入这个环境。</p><p>我祈祷着一觉醒来，第三人生能重新开始，我怀抱着这份期待睡着了。</p><p>醒来之后，映入眼帘的是房间的天花板。意识清醒后，我朝自己的手看去，并没有变小。我的祈祷失败，第三人生变没有开始，我还是待在第二人生里，也许是我睡糊涂了「认为只要我希望，第三人生就会重新开始，实际上发生在我身上的事情本来就是『不可能发生的事情』」，而这种现象只能称它为奇迹了，而我却想有意识的去引发奇迹，看来我真的是睡糊涂了。我曾在一本医学书上看到，身患绝症的人有可能在自己不知道的情况下痊愈，而这种现象只能说是奇迹，但这种奇迹不可能连续两次降临在同一个人身上。现在，我对这点已经很明确地体会到了。</p><p>我自以为自己没有期待第三人生，但醒来之后发现人生没有改变的我比我自己原本想的还要失落，看来我远比我自己想的还要更期待第三人生。</p><p>我本以为我的这种愚蠢会因为时间而渐渐被消磨殆尽，但经过了这样的一段时间后我才明白真正被消磨殆尽的并不是这份愚蠢，而是我自身。</p><p>就在日复一日的这种状态中，我迎来了高中的毕业典礼，紧接着是原本应该让我感到开心的大学生活。</p><p>原本看起来美丽的一切，现在看起来是那么的刺眼让我打从心底里感到厌恶。</p><p>「今天，就放弃去学校好了。」决定好后，我打电话给班导已身体不舒服为由请假。</p><p>请好假后，我回到床铺里面继续补觉，自从来到第二人生后，我的睡眠时间就比第一人生增加了几倍，曾经我认为睡觉是人生的浪费，但现在我觉得睡觉才是人生的一件大事。要我来说，之所以会认为睡觉是人生的浪费那是因为活着的人有太多要做的事与幸福所以才会认为睡觉这种要花费几个小时的事情是一种浪费，这句话既然是由曾经过的非常幸福的我来说就一定没错。假设一个人活着不会发生任何好事那对这个人来说它还会继续醒着延长这份痛苦吗，我想不会，所以睡觉这种可以减少几个小时痛苦的事就成了对我们这种人的恩惠。醒来之后，我独自一人躲在公寓里面喝闷酒，我原本以为酒这种东西跟我这种人是最没有缘分，但从结果来看，我错了，酒跟我们这种人的契合度是最高的。</p><p>不过这件事只有当人生过的不幸之后才能理解实在是太讽刺了。</p><p>说到底，只是我将一切想的都的太简单了。</p><p>我以为只要一切按照过去的模样重新下棋，我的人生就能变成我期待的模样，可单我下完后，坐在我对面的命运却一步步将我推落地狱的深渊。</p><p>如果说，我早一点觉察到这不对劲。</p><p>如果说，我早一点明白选择的相同，不代表带来的结果也是相同这件事的话，我想一切也许就不会是现在这样了。</p><p>可一旦究其根源，都是因为我与其他人做了不一样的选择。</p><p>可这又有什么错，比起那些贪婪的人企图改变悲惨人生的人，我只是遵守了规则，选择了重现我原本的人生，我只是按照了原本的历史，应该没有任何的问题才对啊。</p><p>但到了现在回过来想截至目前的一切，我也才明白，我不打算改变人生这点就是我最大的错误。</p><p>因为我做了与其它人截然不同的选择。</p><p>因为我选择了不改变人生，与其它人不同，我知道未来的一切，因为我的选择让原本不可定的未来变成了确定，我为了自己的幸福而忽视了原本未来可能改变的一切。</p><p>手上的啤酒罐发出刺耳的声音。</p><p>我将已经变了形的啤酒罐用力甩在地上。</p><p>「可是这一切跟我有什么关系啊。」</p><p>「我只是遵从了原本的人生，没有为此做过任何错误的事，我只是期待一切能像原来一样啊。」</p><p>那是原本就属于我的人生、我的过去、我的未来、我的现在，我的一切，这原本都该是属于我的东西却都因为那个「分身」而一切都变了样。</p><p>我无时不无刻都希望那个「分身」赶快消失。</p><p>只要一旦她消失了，常叶一定就会看向除了她以外最符合第一人生女友的我了。</p><p>可是根本没有任何确切的根据指明「分身」消失后一定是这样，在与原本人生的对照下，我根本就无法再肯定的说出一定会是这样这种话了。</p><p>虽然心里很明白这件事，可我只能无力的选择相信，不然我想我一定会受不了接连而至的现实。</p><p>为了平复自己的内心，在这之后我采取了连我自己都难以想象的做法。</p><p>当我回过神来时，我已经成了新闻上很经常听到的跟踪犯。</p><p>至于我为什么会采取这样的行动在这之后我也无法说出个大概。</p><p>如果一定要给这个行动找个理由那我认为最符合的说法就是「慰藉。」</p><p>可我很清楚，这根本就不可能从根本上解救我，相反会让我心中的裂缝更加的增大。</p><p>我只能从跟踪常叶与第一人生中的回忆中摄取幸福的养分，但越是这样只能越发的感到空虚。</p><p>但我很清楚，这根本不是长久的。</p><p>总有一天，我会将幸福的花蜜吸食殆尽从而导致花朵的枯萎。</p><p>旧的回忆总会被新的记忆取代，而能根本解决这个问题的方法其实在一开始离我很近，只是因为我表现的太有把握了，所以一切才变的不断超出我的预计。</p><p>如果在那一刻，我能不那么有把握而是遵从第一人生中的不安与担心或许结果就会导向与第一人生完全相同的结果。</p><p>现在就算想起来那时的记忆，也尽是让人感到不快。</p><p>那是在国中三年级与第一人生中相同的樱花盛开的季节中的某一天傍晚。</p><p>与第一人生相同，当无关紧要的人都离开后教室后只剩下常叶与我独自留在教室中。</p><p>「与第一人生中完全相同。」我在心中想到。</p><p>在符合的时间点出现了该出现的人。</p><p>「只要完成这最后一步，这样至少算是完成了一个阶段。」</p><p>可是常叶却自始至终不对我开口，好像只是在单方面的享受着两个人独处一室却互不发言的这种氛围。</p><p>就在我想着该如何让常叶开口时，常叶他却先开口了。</p><p>「柊同学，这样会不会很尴尬？」</p><p>「终于来了，想好该怎么跟我告白了吗？」</p><p>当然，我只是将这想法埋藏在心里并没有说出来，我表现的不以为然的回答道。</p><p>「不会，倒是常叶同学你不回去吗？」</p><p>「对不起，让你感觉困扰了吗？」</p><p>「我不是这个意思，只是好奇这个放学时间为什么你还不准备回去。」</p><p>「我也不太明白，总感觉有什么事情还没做所以还不能走。」</p><p>「是这样啊。」</p><p>「你还没向我告白呢，我已经做好了答应的准备，你可以来告白了。」</p><p>「……那个，柊同学。」</p><p>「来了，终于要来了。」</p><p>「叮叮叮叮叮叮……」</p><p>伴随着刺耳的清校铃声，完全的掩盖了常叶的声音。</p><p>「对不起，常叶同学你刚刚说什么？我没听清楚。」</p><p>「也没什么特别的，只是到了清校时间，女孩子一个人回家也不安全吧，想问一下你要跟我一起走吗？」</p><p>「说的也是，那就麻烦你了。」</p><p>「真是倒霉，偏偏在这个时候响起铃声。」</p><p>我在心里埋怨了一句。</p><p>如果不是因为这个铃声，常叶应该就会顺势对我表白了。</p><p>但是现在换到公园去，我想结果也是一样的就没有多在意。</p><p>但我这时根本就忘记了，我从这一刻开始就已经偏离了第一人生。</p><p>这个细微的改动带动了接下来的一切连锁反应。</p><p>被夕阳染红的街道我与常叶的身影融入其中。</p><p>被夕阳照耀着常叶的侧脸看起来有点不同于同龄人的成熟。</p><p>「会这样也是理所应当的。」</p><p>毕竟他可是我第一人生中的男朋友。</p><p>就算是到了第二人生有这么优秀也是理所应当的吧。</p><p>沉默在我们之间弥漫开来。</p><p>时间仿佛定格在了一刻间，常叶不在说一句话，我们只是抱持着适当的距离肩并肩走着。</p><p>「不好意思，让你感觉尴尬了吧。柊同学。」</p><p>常叶开口打破了我们之间的沉默。</p><p>「不会，我想你一定是在想什么事情吧。」</p><p>「很明显吗？」</p><p>「嗯，很明显，就像是已经写在脸上等待别人来说一样。」</p><p>常叶干笑了几声回答我。</p><p>「不好意思，影响你心情了吧。」</p><p>「不会，看你这个样子一定是什么很重要的事情吧。」</p><p>「嗯，是对我来说很重要的一件事。」</p><p>「关于以后升学的事吗？」</p><p>「……不是。」</p><p>不知道是不是因为夕阳照射的角度不同了，常叶的脸看起来有些许微红。</p><p>「……老实说，我也不知道该怎么说这种事情。」</p><p>看这个模样「一定是指对我告白这件事了。」我在心里想到。</p><p>「如果你不介意，可以跟我说说。」</p><p>「这不太合适吧。」常叶想了一会说道。</p><p>「……」</p><p>「这有什么不好意思的，我明明都已经给你一个绝好的告白机会了。」</p><p>当然我并没有将这句话说出口。</p><p>就在我刚刚短暂的犹豫之中，我想起第一人生中他对我告白时的场景，他紧张的神情、颤抖的声音，我想常叶现在所体会的应该就是第一人生中他的那种苦恼。第一人生中的他在鼓起勇气向我告白前也一定是在这样的犹豫后才做了决定。</p><p>或许真的是我太着急了，我其实根本没有必要去刻意制作方便常叶来告白的场景，当他想好一切自然就会遵守第一人生中的一切来找我告白，我只需要适当的引导常叶做这个选择就好了。</p><p>「既然你都这么说了，那我就不问了。但是我觉得你既然有想做的事情那就去做吧。」</p><p>「不管结果是怎么样，至少不要让自己留下遗憾。」</p><p>「说的也是，谢谢你。柊同学。」</p><p>这样就好了。我只需要进行引导接下来只要等待常叶的告白就可以了。</p><p>「不客气，以后如果有什么问题也可以跟我说。」</p><p>然后我们就这样你一句我一句不断的闲聊着。</p><p>这之后我与常叶的关系一天比一天亲密但自始至终常叶都不来向我告白。</p><p>虽然从那天后我知道等待是一个磨人的过程，我也明白我不能着急为了最好的还原历史，我所能做的就是等待。</p><p>但耐心伴随着一天、两天、一个星期、两个星期、甚至快过了一个月我都还没有得到常叶的告白，就在我终于快忍耐不住时常叶终于来找我了他说有件事想告诉我。</p><p>「等待终于得到了回报。」</p><p>还好我一直等待，接下来一切就会按照原本的历史进行下去。</p><p>我是这么想的。</p><p>「我准备向喜欢的女孩子告白了。」</p><p>「终于来了。」</p><p>「说起来常叶你还记得我们第一次一起回家时也跟我说过有在烦恼的事情吧。」</p><p>「难道就是这件事吗？」</p><p>其实这个问题根本毫无意义，经历过第一人生的我很清楚这个问题的答案，只是在即将迎面而来的幸福前不经意的想去抓弄一下。</p><p>「嗯，因为那时我还没有决定，因为对方是个很好的人我觉得自己配不上她所以不敢尝试告白。」</p><p>「常叶的这番话让我不禁想起第一人生中他跟我告白时的模样，原来他当时表现的那种紧张是因为担心这个。」</p><p>「不过，我想你应该不用担心，只要将你真实的心情传达给对方，我想对方一定会感觉到。」</p><p>「那你准备好告白了吗？常叶。」</p><p>「嗯，我想明天就告白。」</p><p>「……或许，现在也可以哦。」</p><p>「谢谢你，但是我还是打算按照自己本来想的那样去告白。」</p><p>「是这样啊。」</p><p>「他们果然就像是游戏中出现的固定角色一样，只会遵照原本的计划来不会根据眼前的情况做出改变。」</p><p>我在心里叹了一口气。</p><p>不过仔细想想他们也只是遵守原本人生，对我来说也节省了我去刻意引导人生走向同样结果的辛苦。</p><p>与常叶道别回到自己家后，我倒在床铺上想着常叶明天会怎么跟我告白。</p><p>会是跟第一人生一样的告白吗？还是说有一点不同呢。</p><p>应该是会有一点不一样吧，毕竟常叶给我与第一人生中的他，该怎么说？感觉还是有一点不同，不过我想这也是正常的吧。就像是电脑主机关闭重新启动的过程中会额外生成一些其它东西，常叶恐怕也只是经历了相同的过程。</p><p>这天晚上我倒在床铺上翻来覆去也睡不着，一心只想着即将迎面而来的幸福。根本无心思考其它的事情。</p><p>一个晚上转眼即逝，我打开房间的窗户，窗户外的天空染上了一层乌云。</p><p>说起来，昨天的天气预报中好像是有提到今天可能会下雨。</p><p>「老天爷也真是不做美。」我在心里想到。</p><p>坐在教室里的时候我等待着时间尽快度过。</p><p>终于等到放学时间，班级上的人一个个离开教室只剩下我跟常叶后我想终于可以跟第一人生一样了。</p><p>可是常叶却始终不朝我走来。</p><p>就在我奇怪是怎么回事时，教室的门被拉开。</p><p>是一个女孩子。</p><p>她看了一眼坐在教室中的我跟常叶。</p><p>「不好意思，我进错教室了。」说完她将教室的门再度拉上。</p><p>可是就算门关上后常叶也是一言不发的坐在那边。</p><p>我们就这么坐着事情不会有一点前进。</p><p>我站起身拿起书包朝教室外走去。</p><p>这样一来常叶不会还是什么动作都没有吧。</p><p>可当我用眼角的余光扫到常叶他还是仍然坐在那边。</p><p>「喂，你在做什么？常叶。你的告白对象的我可是要离开了你怎么还在那边不动？」</p><p>「你到底在做什么啊。」</p><p>「就算是在紧张看到我这样了你都还是没有任何举动吗？」</p><p>「我就不相信我真的离开了你还能这样坐在那里。」</p><p>我走出教室将门拉上。</p><p>在没有人的走廊一步又一步踩到地板上的声音显异常大声。</p><p>一步、两步、十几步，走到走廊尽头下楼的楼梯就在那，我回头看向教室的位置，常叶仍然没有走出来。</p><p>我走下楼，每到一层就停下来等一会常叶追上来。</p><p>慢慢的我已经走到第一层常叶却还是没有追上来。</p><p>我就这样独自一人站在教学楼的门口等待常叶出来。</p><p>可不管我等了多久常叶就是没有出来。</p><p>「就算是紧张我也不至于到这种程度吧。」</p><p>觉得事情有点不对劲的我走上楼到我们的教室。</p><p>快到教室门口时我听到了常叶的声音。</p><p>「我喜欢你，请你跟我交往吧。」</p><p>常叶说完后没有任何回应。</p><p>「原来是这样，常叶是在做对我告白的预演。」</p><p>「如果这个时候看到我来，他一定会很惊讶吧，预演被要告白的对象听到，不知道他的脸会红到什么样。」</p><p>正当我走到教室外一点准备拉开教室门时，教室门的玻璃上透出的景象却与我想的完全不是一个模样。</p><p>常叶的面前站着一个女孩子。</p><p>是刚刚打开门进来教室的女孩子。</p><p>她刚刚不是已经走了吗？为什么会在这里？常叶为什么要对她告白？</p><p>这些问题一下冲上脑袋，一时之间我根本来不及处理这么多问题，而在下一秒。</p><p>从教室中传出了女孩子的声音。</p><p>「……好的。」</p><p>我没有多想马上逃离了现场，我也不知道是怎么回事，心里只想着尽快离开这里，不管是哪里都好，只要尽快离开这里。</p><p>这天的隔天我直接以身体不适为理由请假在家。</p><p>在隔天被父母以「现在是升学的重要时期不要浪费时间」而被催促去学校。</p><p>可是到了学校我也根本无心去学习，我的心自始至终都停留在常叶对那个女孩子告白的那一刻。</p><p>在我恍惚中已经到了放学时间。</p><p>将我拉回现实的是常叶。</p><p>「柊同学，你没事吧。」</p><p>意识从恍惚中清醒。</p><p>「啊，我没事。」</p><p>「我看你今天脸色不太正常，而且昨天也请假，你病还没好吗？要不要去保健室请老师看看。」</p><p>「不用了，我们走吧。」</p><p>回家路上，常叶的脸上毫不掩饰开心。</p><p>「谢谢你，柊同学。」</p><p>「欸？为什么要向我道谢？」</p><p>「因为你的鼓励我已经向喜欢的女孩子告白成功了，她已经答应做我的女朋友了。」</p><p>其实我本来昨天就想告诉你这件事并跟你道谢的，结果你没有来但是今天说也不晚吧。</p><p>「真的非常谢谢你，柊同学。」</p><p>常叶的眼中没有一丝虚假，他是真的感谢我。</p><p>「……不……不要，拜托你不要用这种眼神看我。」</p><p>我推了一下常叶从他身边跑开，我想在常叶的眼中我的眼神一定像是看到了什么可怕的东西。</p><p>这天之后我总是刻意的回避着常叶，在上课时我也根本没有了任何的心思，当然在这样的状态持续了一段时间后，毫无疑问我的成绩自然避免不了逐渐变坏的局面。</p><p>最后在面临升学考试时我的成绩与第一人生时相比更是一落千丈。</p><p>在这之后我进了一所比第一人生差的多的高中。</p><p>入学后的分班，虽然周围看起来都是一群笨蛋但是到了这种学校的我毫无疑问也已经成为它们的其中一员。不过至少在这里我不用担心会遇见常叶。</p><p>至少在这这个学校里我可以享受之前我没能享受的心灵上的安静。</p><p>不管怎么回忆都尽是让人不快的记忆。</p><p>我停止回忆从回忆中抽身，我想我明天还是会像今天一样吧。</p><p>成为一个跟踪狂，借此给予自己心灵上的慰藉。</p><p>我讨厌这样的自己。</p>]]></content>
      
      
      <categories>
          
          <category> 短篇小说 </category>
          
          <category> 系缒三日的秋天 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 轻小说 </tag>
            
            <tag> 恋爱 </tag>
            
            <tag> 三秋缒 </tag>
            
            <tag> 奇幻 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>温大神</title>
      <link href="/Eternity/%E7%9F%AD%E7%AF%87%E5%B0%8F%E8%AF%B4/%E6%97%AD%E6%97%A5%E4%B8%9C%E5%8D%87%E7%9A%84%E4%BC%A0%E8%AF%B4/i-may-ak-ipho/"/>
      <url>/Eternity/%E7%9F%AD%E7%AF%87%E5%B0%8F%E8%AF%B4/%E6%97%AD%E6%97%A5%E4%B8%9C%E5%8D%87%E7%9A%84%E4%BC%A0%E8%AF%B4/i-may-ak-ipho/</url>
      
        <content type="html"><![CDATA[<p>东辰高中竞赛教室的格局，是和别处不同的。</p><span id="more"></span><p>东辰高中竞赛教室的格局，是和别处不同的：都是前面一个长方形的大展台，台上预备着答题卡，可以随时考试。停课搞竞赛的人，早上七点四十，每每散步到教室去，吃魏主任买的包子，——这是退役前的事，现在六点二十起床，——几个人分一袋，热热的吃了刷题；倘肯多花七块，便可以买一瓶<a href="https://www.zhihu.com/search?q=雀巢咖啡&amp;search_source=Entity&amp;hybrid_search_source=Entity&amp;hybrid_search_extra={:,:1540871187}">雀巢咖啡</a>，做饮料了。食堂是有早饭的，但这些搞竞赛的，多是懒狗，大抵起不了那么早。只有学常规的，才踱进学校食堂里，要大红枣汁酸奶，慢慢地坐喝。</p><p>我从高一起，便在东辰高中学物竞，教练说，样子太傻，怕进不了省队，就混个省一罢。外面的竞赛主任，虽然容易说话，但唠唠叨叨缠夹不清的时候也很不少。他往往要亲眼看着试卷被发下来，看过有没有人考试时睡觉，又亲看试卷被收上去，然后放心：在这严重监督下，划水也很为难。所以过了几天，教练又说我得不了省一靠前。幸亏我的脸皮厚，劝退不得，便改为专混省一垫底的一种无聊职务了。</p><p>我从此便整天的坐在座位上里，专刷我的<a href="https://www.zhihu.com/search?q=程书&amp;search_source=Entity&amp;hybrid_search_source=Entity&amp;hybrid_search_extra={:,:1540871187}">程书</a>。虽然没有什么失职，但总觉得有些单调，有些无聊。教练是一副凶脸孔，班主任也没有好声气，教人活泼不得；只有<a href="https://www.zhihu.com/search?q=温志强&amp;search_source=Entity&amp;hybrid_search_source=Entity&amp;hybrid_search_extra={:,:1540871187}">温志强</a>上课，才可以笑几声，所以至今还记得。</p><p>温志强是没读过什么正经大学而教竞赛的唯一的人。他身材很高大；青白脸色，言语间时常夹些他妈的；一部乱蓬蓬的头发。穿的虽然是耐克，可是又脏又破，似乎十多年没有补，也没有洗。他对人说话，总是满口<a href="https://www.zhihu.com/search?q=四大力学&amp;search_source=Entity&amp;hybrid_search_source=Entity&amp;hybrid_search_extra={:,:1540871187}">四大力学</a>，叫人半懂不懂的。因为他姓温，别人便从描红纸上的“国际金牌教练温志强”这半懂不懂的话里，替他取下一个绰号，叫作温大神。温志强一到班，所有刷题或者划水的人便都看着他笑，有的叫道，“温老师，你出的题又在其他机构出现了！”他不回答，对学生说，“那几道题做完了没有”便排出九页答案。他们又故意的高声嚷道，“你一定又抄了国际竞赛题了！”温志强睁大眼睛说，“你怎么这样凭空污人清白……”“什么清白？我前天亲眼见你偷了那道黑洞的题，吊着打。”温志强便涨红了脸，额上的青筋条条绽出，争辩道，“借鉴不能算偷……借鉴！……金牌竞赛教练的事，能算偷么？”接连便是难懂的话，什么“场论弦论”，什么“格林互易定理”之类，引得众人都哄笑起来：教室内外充满了快活的空气。</p><p>听人家背地里谈论，温志强原来也去嘉祥应聘过，但终于没有应聘上，又不会教常规，于是愈过愈穷，弄到将要到东辰来教书了。幸而装的一手好逼，便骗骗校领导，有了百万年薪。可惜他又有一样坏脾气，便是好耍懒做。教不到几十分钟，便连人和手机游戏，一齐失踪。如是几次，觉得他很吊的人也不多了。温志强没有法，便免不了经常做些装逼的事。但他在我们学校里，品行却比别人都好，就是从不拖堂；虽然间或没有题目的答案，暂时记在笔记本上，但到了一月的第 $32$ 天，定然给学生答案，从笔记本上拭去了温志强的名字。</p><p>温志强上了十分钟课，涨红的脸色渐渐复了原，旁人便又问道，“温老师，你当真教过国际金牌么？”温志强看着问他的人，显出不屑置辩的神气。他们便接着说道，“你怎的在网上半个名字都搜索不到呢？”温志强立刻显出颓唐不安模样，脸上笼上了一层灰色，嘴里说些话；这回可全是<a href="https://www.zhihu.com/search?q=杨天华&amp;search_source=Entity&amp;hybrid_search_source=Entity&amp;hybrid_search_extra={:,:1540871187}">杨天华</a>，熊召西，以前深圳中学的校长看他不爽，不准他宣传之类，一些不懂了。在这时候，众人也都哄笑起来：教室内外充满了快活的空气。</p><p>有几回，他批改的题有问题，同学们围住了温志强。他便给他们解释。同学们听了解释，仍然不服，眼睛都望着iPad。温志强着了慌，伸开五指将iPad罩住，弯腰下去说道，“不多了，我会的题已经不多了。”直起身又看一看解析，自己摇头说，“不多不多！多乎哉？不多也。”于是这一群学生都在笑声里回座位了。</p><p>温志强是这样的使人快活，可是没有他，别人也便这么过。</p><p>有一天，大约是复赛前的两三天，某物竞的一方通行正在慢慢的刷模拟卷，取下课堂用本，忽然说，“温志强长久没有来了。还欠十九个答案解析呢！”我才也觉得他的确长久没有来了。一个刷试题选的人说道，“他怎么会来？……他会出的题出完了。”某物竞的一方通行说，“哦！”“他总仍旧是装逼。这一回，是自己发昏，竟装到祝大爷家里去了。他面前，装得的吗？”“后来怎么样？”“怎么样？先说他给东辰要教出几个国际金牌，后来是集训队，装了大半夜，再说这一届可以出几个省队。”“后来呢？”“后来请他去绵阳最贵的餐厅吃饭了。”“吃了饭怎样呢？”“怎样？……谁晓得？许是去小学部从小培养竞赛了。”一方通行也不再问，仍然慢慢的刷他的卷子。</p><p>竞赛出名单过后，秋风是一天凉比一天，看看将近一诊；我整天的补常规，也须穿上校服外套了。一天的下半天，竞赛教室没有一个人，我正合了眼坐着。忽然间听得一个声音，“我烟呢。”这声音虽然极低，却很耳熟。看时又全没有人。站起来向外一望，那温志强便在花坛下对了台阶坐着。他脸上黑而且瘦，已经不成样子；穿一件破卫衣，盘着两腿，下面垫一个挎包，用草绳在肩上挂住；见了我，又说道，“这么简单的题，考得太烂了。”某咸鱼也伸出头去，一面说，“温志强么？你还考前还压了三十个题呢！”温志强很颓唐的仰面答道，“这……这回没中罢。这一回是卢竟，把我的题用来湖南内部考试了。”我仍然同平常一样，笑着对他说，“温志强，你又装了逼了！”但他这回却不十分分辩，单说了一句“不要取笑！”“取笑？要是不装逼，怎么会考前骗我们？”温志强低声说道，“决赛题我经常压中，还有金秋营……”他的眼色，很像恳求我，不要再提。此时已经聚集了几个学弟，便和他们都笑了。我把他说价值数十万的几十套卷子，端出去，放在垃圾桶里。他告诉我他的题是多么多么好，一定不能泄露，见他满手是泥，原来他便用这手打篮球的。不一会，他打完他的部落冲突，便又在旁人的说笑声中，慢慢走去了。</p><p>自此以后，又长久没有看见温志强。到了年关，我取下课堂用本说，“温志强还欠十九个解析呢！”到第二年的二诊，又说“温志强还欠十九个解析呢！”到三诊可是没有说，再到高考也没有看见他。</p><p>我到现在终于没有见——大约温志强的确只懂怎么教物理竞赛国际金牌。</p>]]></content>
      
      
      <categories>
          
          <category> 短篇小说 </category>
          
          <category> 旭日东升的传说 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 东辰 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>《那年夏天……》——经过彻底思量后犯下的错误，仍有着媲美正确答案的价值</title>
      <link href="/Eternity/%E8%AE%B0%E9%9A%8F%E5%BD%B1%E8%90%BD/summer-complex/"/>
      <url>/Eternity/%E8%AE%B0%E9%9A%8F%E5%BD%B1%E8%90%BD/summer-complex/</url>
      
        <content type="html"><![CDATA[<p>作者：（日本）三秋缒</p><p>作品名：《那年夏天，你打来的电话》《那年夏天，我拨去的电话》</p><span id="more"></span><p>如果说《重启人生》给了我感同身受的失败感，则《那年夏天……》给了我非同凡响的治愈。</p><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>分为上下册的较长小说，也能算是一部佳作了。（光是唯的封面已经把我的 $xp$ 戳爆了）</p><h3 id="那年夏天，你打来的电话"><a href="#那年夏天，你打来的电话" class="headerlink" title="那年夏天，你打来的电话"></a>那年夏天，你打来的电话</h3><blockquote><p>拿起听筒的那个瞬间，不可思议的夏天就此拉开序幕。</p><p>“要不要来打个赌？”</p><p>电话那边传来了一个女声，“十岁那年的夏天，你对初鹿野同学心生好感。但对当时的你而言，初鹿野同学实在太遥远。你心想‘我没有资格喜欢她’，用这种想法压抑自己对她的感情。同时你却有另一种想法——‘要不是这个胎记，也许我们的关系会不太一样’。那么，就让我去掉你的胎记看看吧。如果你能因此得到初鹿野同学的心，这场赌局就算你赢。”</p></blockquote><h3 id="那年夏天，我拨去的电话"><a href="#那年夏天，我拨去的电话" class="headerlink" title="那年夏天，我拨去的电话"></a>那年夏天，我拨去的电话</h3><blockquote><p>我一直认为，只要没有这块丑陋的胎记，就能赢得初鹿野的心。于是我答应了神秘女子的赌局，获得了理想的容貌。但讽刺的是，当我和初鹿野重逢时，却在她的脸上看到了似曾相识的丑陋胎记。面对性格大变的初鹿野，我束手无策。同时还被告知，如果不能在规定时间内获得初鹿野的心，等待我的是和童话《人鱼公主》相同的结局。</p><p>夏日的末尾，这场拼尽一切的豪赌即将迎来结果的揭晓。</p></blockquote><h2 id="一些感想"><a href="#一些感想" class="headerlink" title="一些感想"></a>一些感想</h2><p>在托管的晚上 $11:00$ 结束了两本书的阅读。说句实话，对于我这种读书不带脑子的人， $90\%$ 的结局都猜不到，所以才会觉得所有我读过的书的结局都很新颖吧。这，算幸运还是不幸呢。</p><hr><p><strong>警告，以下内容涉嫌剧透，如果没有读过原著，请酌情阅读！！！</strong></p><hr><h3 id="对书中人物的看法"><a href="#对书中人物的看法" class="headerlink" title="对书中人物的看法"></a>对书中人物的看法</h3><h4 id="深町阳介"><a href="#深町阳介" class="headerlink" title="深町阳介"></a>深町阳介</h4><p>作为“我”，已经做到了。这就是为什么三秋缒能写出如此完美的第一人称式小说，就只有他，能够讲述这个夏天的故事。无论从语文角度而讲的人物描写，还是单从轻小说角度而言的一切。这一个人物的塑造都是完美的。</p><h4 id="荻上千草"><a href="#荻上千草" class="headerlink" title="荻上千草"></a>荻上千草</h4><p>无论是人类，亦或是人鱼，两者其实都是一样的，作为一个 $16$ 岁的高中生，洋溢了青春，对健康有所展望，在“我”犯下错误之后去提醒和帮助，并非无情，但也将赌者之心展现的淋漓尽致。这便是小说中悬念能够打动我的原因。也许有人猜到了结局，很可惜，我没有。我上文也说过，即使是这样，我也是满足的，这样才会有惊喜与惊吓。就如同……<font style="color:white">如果人生一样都望到头了，哪还有什么意义可言呢。</font></p><h4 id="初鹿野唯"><a href="#初鹿野唯" class="headerlink" title="初鹿野唯"></a>初鹿野唯</h4><p>太戳 xp 了，无论是失忆前或者失忆后，无论有胎记还是没有胎记。我挺喜欢这类女生的，不因高高捧起而自高自大，发自内心的善良能够改变他人，也不因挫败而垂头丧气，在忘掉一切之后坦然接受，保持一颗开朗的心去面对生活，也许以前我遇见过一个，可惜，可惜已经没有可惜了吧。</p><p>阿姜告诉我，他不太喜欢唯的原因是因为胎记，但在我看来，即使有胎记，我也是喜欢的。就像做过的英语阅读一样，不因外貌而取人，不因富贵而取人，如果真心喜欢一个人，便不需要理由。</p><h2 id="摘抄"><a href="#摘抄" class="headerlink" title="摘抄"></a>摘抄</h2><blockquote><p>真要说起来，人多多少少都是一边忘记一些事情一边活下去。真的什么都记得住的人，只有那么一小撮而已。可是，谁也不会抱怨这一点。你知道为什么吗？我想这是因为，大家都知道，到头来所谓的回忆只不过就像奖杯或纪念品，当下这一瞬间才是最重要的。</p><p>你听我说。你也许不知道，但我很喜欢跟你说话。喜欢单方面听你说话、喜欢单方面说话给你听，也喜欢跟你什么都不说，就只是待在一起。要是你不在了，我会非常寂寞。所以，请你不要擅自消失……我可是很担心的喔。</p><p>中岛敦说过，要是什么都不做，人生未免太长；但真要做什么，却又未免太短。八十次夏天，对于无法享受夏天的人来说太多，对于能够享受的人则太少。相信就是这么回事。</p><p>当然说到底，“喜欢”的理由全都是事后安上去的。喜欢星星的人生下来就是会喜欢上星星，就这么简单。</p><p>小时候每个人都是公主、每个人都是王子，做梦也不会想到自己竟然不是灰姑娘，而是她的姊姊。但随着年纪增长，会渐渐感觉到自我认知与他人评价之间有着落差，让人们不得不慢慢修正认知中的自己：我不是公主，我不是王子。</p><p>「那么，我换个问法吧，你希望幽灵是什么样的东西？」<br>她喝了一口饮料，抬头看着天空。湿润的嘴唇被阳光照得发出闪闪白光。 「我想想……以我来说，我希望幽灵是种受了很多苦，怨恨活人、为自己的际遇悲叹的东西。」<br>「为什么？」<br>「如果是这样，不就会觉得活着还稍微好上那么一点吗？」她说话时仍然仰望着天空。「如果幽灵全都是露出一脸安详的表情照看着活人，我应该会很羡慕他们，而想加入他们吧。」</p><p>看在旁人眼里，可能会觉得我只是个被困在孩缇时代记忆当中的傻瓜。但是不管别人怎么说我都不在乎。我想到我死为止，都会是这段记忆的幸福奴隶。</p><p>是夏天的尾声会先到，还是我会先死去？如果可以，我希望我能在夏天结束之前离开这个世界。在积雨云消失之前，在蝉全部消失之前，在向日葵枯萎之前。因为不管什么时候，最寂寞的都是最后一个离开的人。</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> 记随影落 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 轻小说 </tag>
            
            <tag> 恋爱 </tag>
            
            <tag> 三秋缒 </tag>
            
            <tag> 奇幻 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>斜率优化dp/凸包优化dp</title>
      <link href="/Eternity/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/OI/dp-convex-hull-optimization/"/>
      <url>/Eternity/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/OI/dp-convex-hull-optimization/</url>
      
        <content type="html"><![CDATA[<p>“不可名状。”</p><span id="more"></span><p>对于一个转移方程，能够表示为：</p><p>$f[i]=Kc[i]+B$ </p><p>的一次函数形式，它则可以使用斜率优化，用于解决单调队列解决不了的问题。</p><p>单调队列可以解决形如 $f[i]=f[j]+x[i]$ 形式的问题，</p><p>而斜率优化用于解决形如 $f[i]=f[j]+x[i]\times x[j]$ 之类拥有 $x[i]\times x[j]$ 形式的转移方程。</p><p>这种题可以使用：</p><ol><li>决策单调性优化dp</li><li>斜率优化dp</li><li>高级数据结构优化dp（如李超线段树）</li></ol><p>来解决。</p><h2 id="例题"><a href="#例题" class="headerlink" title="例题"></a>例题</h2><h3 id="P2365-任务安排"><a href="#P2365-任务安排" class="headerlink" title="P2365 任务安排"></a><a href="https://www.luogu.com.cn/problem/P2365">P2365 任务安排</a></h3><h4 id="朴素思想"><a href="#朴素思想" class="headerlink" title="朴素思想"></a>朴素思想</h4><p>首先应该知道，不分批并不一定是最优的，因为<strong>每个任务的完成时间规定为其所在批次的最后一个任务的完成时间</strong>。</p><p>用 $dp[i][j]$ 来表示当前第 $i$ 个工程，已经分了 $j$ 组的最小代价，用 $pret[]$ 和 $prec[]$ 数组表示两个代价的前缀和。</p><p>则有：</p><p>$dp[i,j]=\min\limits_{0\leq k&lt;i}\{dp[k,j-1]+(s\times j+pret[i])\times (prec[i]-prec[k])\}$</p><p>时间复杂度 $O(n^3)$ ，空间复杂度 $O(n^2)$ ，不够。</p><h4 id="费用提前计算优化"><a href="#费用提前计算优化" class="headerlink" title="费用提前计算优化"></a>费用提前计算优化</h4><p>根据以往的做题经验，我们尝试把二维化成一维，即让 $dp[i]$表示前 $i$ 个任务分批执行的最小费用。</p><p>但是这样我们就不知道机器启动过几次了！</p><p>别慌，冷静分析一下你会发现，如果我们要从 $dp[j]$ 转移到 $dp[i]$ 的话，由于第 $j+1\sim i$ 都是在同一批内完成的，我们只需要把 $s$ 对 $j+1$ 后的影响补充到费用中就可以了！</p><p>$dp[i]=\min\limits_{0\leq j&lt;i}\{dp[j]+pret[i]\times(prec[i]-prec[j])+s\times (prec[n]-prec[j])\}$</p><p>时间复杂度 $\mathcal O(n^2)$ ，这就是<strong>费用提前计算</strong>的思想。</p><details>    <summary>AC Code</summary><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;ctime&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iomanip&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stack&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;map&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> gh() getchar()</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> re register</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> db double</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> ll;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN=<span class="number">5e3</span>+<span class="number">1</span>;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    x=<span class="number">0</span>;</span><br><span class="line">    <span class="type">char</span> ch=<span class="built_in">gh</span>(),t=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(ch&lt;<span class="string">&#x27;0&#x27;</span>||ch&gt;<span class="string">&#x27;9&#x27;</span>) t|=ch==<span class="string">&#x27;-&#x27;</span>,ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">while</span>(ch&gt;=<span class="string">&#x27;0&#x27;</span>&amp;&amp;ch&lt;=<span class="string">&#x27;9&#x27;</span>) x=(x&lt;&lt;<span class="number">3</span>)+(x&lt;&lt;<span class="number">1</span>)+(ch^<span class="number">48</span>),ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">if</span>(t) x=-x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T,<span class="keyword">class</span> ...T1&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x,T1 &amp;...x1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">read</span>(x),<span class="built_in">read</span>(x1...);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">checkMax</span><span class="params">(T &amp;x,T &amp;y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x&lt;y?x=y,<span class="number">1</span>:<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">checkMin</span><span class="params">(T &amp;x,T &amp;y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x&gt;y?x=y,<span class="number">1</span>:<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> N,S;</span><br><span class="line">ll dp[MAXN],Tme[MAXN],Cst[MAXN];</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// freopen(&quot;dp-slopeopt.in&quot;,&quot;r&quot;,stdin);</span></span><br><span class="line">    <span class="comment">// freopen(&quot;dp-slopeopt.out&quot;,&quot;w&quot;,stdout);</span></span><br><span class="line">    <span class="built_in">read</span>(N,S);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=N;++i) <span class="built_in">read</span>(Tme[i],Cst[i]);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">2</span>;i&lt;=N;++i) Tme[i]+=Tme[i<span class="number">-1</span>],Cst[i]+=Cst[i<span class="number">-1</span>];</span><br><span class="line">    <span class="built_in">memset</span>(dp,<span class="number">0x3f</span>,<span class="built_in">sizeof</span>(dp));</span><br><span class="line">    dp[<span class="number">0</span>]=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=N;++i)</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">0</span>;j&lt;i;++j)</span><br><span class="line">            dp[i]=<span class="built_in">min</span>(dp[i],dp[j]+Tme[i]*(Cst[i]-Cst[j])+S*(Cst[N]-Cst[j]));</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%lld&quot;</span>,dp[N]);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure></details><h4 id="斜率优化"><a href="#斜率优化" class="headerlink" title="斜率优化"></a>斜率优化</h4><p>对于上述的转移方程而言，一共有三个会影响答案的变量：</p><p>$j,dp[j],dp[i]$</p><p>把最小值去掉，然后化简：</p><p>$dp[j]=(s+pret[i])\times prec[j]+dp[i]-pret[i]\times prec[i]-s\times prec[n]$</p><p>那么，这是一个 $dp[j]$ 关于 $prec[j]$ 的一次函数。</p><p>斜率为 $s+pret[i]$ ，截距为 $dp[i]-pret[i]\times prec[i]-s\times prec[n]$</p><p>目标是 $dp[i]$ 最小，即<strong>截距</strong>最小。</p><hr><p>接下来，我会以我所理解的斜率优化阐述，可能不对，慎重阅读！！！</p><hr><p>首先，做出 $x=prec[j],y=dp[j]$ 的图像。并做出相应的散点 $(prec[j],dp[j])$ 。（我们这里首先只说横坐标单调递增的情况）</p><p>对于每一次计算 $i$ 时，我们将一条斜率为 $s+pret[i]$ 的直线从 $-\inf$ 开始向上移动，对于第一个碰到的点，该点对应的截距就是 $\min\{dp[i]\}$ 。</p><p>而对于用 $\mathcal{O}(1)$ 的时间找出最小的点，我们用类似于单调队列优化里的思想维护散点组成的凸包的上下凸边即可。</p><p>对于一个点是否在凸包上，满足：</p><ul><li>该点与上一个凸包点组成直线的斜率小于当前斜率；</li><li>该点与下一个凸包点组成直线的斜率大于当前斜率。</li></ul><p>即对于 $j_1&lt;j_2&lt;j_3$ ，使 $j_2$ 成为凸包点的条件：</p><ul><li>如果上凸，则 $j_2$ 不可能为最优。</li><li>如果下凸，且 $\frac{dp[j_2]-dp[j_1]}{prec[j_2]-prec[j_1]}&lt;\frac{dp[j_3]-dp[j_2]}{prec[j_3]-prec[j_2]}$ 。</li></ul><p>简单来说，对于这三个点，只要 $l_{j_1-j_2}$ 的斜率小于 $l_{j_2-j_3}$ 的斜率即可。</p><p>然后就是类似于单调队列的维护了：</p><ul><li>检查队头元素 $q[l]$ 和 $q[l+1]$ 所构成的直线斜率是否满足：$\frac{dp[q[l+1]]-dp[q[l]]}{prec[q[l+1]]-prec[q[l]]}\leq s+pret[i]$ ，如果满足，则执行 <code>++head</code> ，重复该步骤。</li><li>取出当前队头，更新答案。</li><li>检查队尾元素 $j_1=q[r-1]$ 和 $j_2=q[r]$ ，和当前点 $j_{3}=i$ ，是否满足斜率单调递增，如果不是，则执行 <code>--tail</code> ，重复该步骤。</li><li><code>q[++tail]=i</code></li></ul><p>完成。</p><details>    <summary>AC Code</summary><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;ctime&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iomanip&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stack&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;map&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> gh() getchar()</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> re register</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> db double</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> ll;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN=<span class="number">3e5</span>+<span class="number">1</span>;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    x=<span class="number">0</span>;</span><br><span class="line">    <span class="type">char</span> ch=<span class="built_in">gh</span>(),t=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(ch&lt;<span class="string">&#x27;0&#x27;</span>||ch&gt;<span class="string">&#x27;9&#x27;</span>) t|=ch==<span class="string">&#x27;-&#x27;</span>,ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">while</span>(ch&gt;=<span class="string">&#x27;0&#x27;</span>&amp;&amp;ch&lt;=<span class="string">&#x27;9&#x27;</span>) x=(x&lt;&lt;<span class="number">3</span>)+(x&lt;&lt;<span class="number">1</span>)+(ch^<span class="number">48</span>),ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">if</span>(t) x=-x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T,<span class="keyword">class</span> ...T1&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x,T1 &amp;...x1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">read</span>(x),<span class="built_in">read</span>(x1...);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">checkMax</span><span class="params">(T &amp;x,T &amp;y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x&lt;y?x=y,<span class="number">1</span>:<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">checkMin</span><span class="params">(T &amp;x,T &amp;y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x&gt;y?x=y,<span class="number">1</span>:<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> N,S;</span><br><span class="line">ll dp[MAXN],Tme[MAXN],Cst[MAXN];</span><br><span class="line"><span class="type">int</span> Q[MAXN],head,tail;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// freopen(&quot;dp-slopeopt.in&quot;,&quot;r&quot;,stdin);</span></span><br><span class="line">    <span class="comment">// freopen(&quot;dp-slopeopt.out&quot;,&quot;w&quot;,stdout);</span></span><br><span class="line">    <span class="built_in">read</span>(N,S);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=N;++i) <span class="built_in">read</span>(Tme[i],Cst[i]);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">2</span>;i&lt;=N;++i) Tme[i]+=Tme[i<span class="number">-1</span>],Cst[i]+=Cst[i<span class="number">-1</span>];</span><br><span class="line">    <span class="built_in">memset</span>(dp,<span class="number">0x3f</span>,<span class="built_in">sizeof</span>(dp));</span><br><span class="line">    dp[<span class="number">0</span>]=<span class="number">0</span>;</span><br><span class="line">    <span class="comment">/*for(int i=1;i&lt;=N;++i)</span></span><br><span class="line"><span class="comment">        for(int j=0;j&lt;i;++j)</span></span><br><span class="line"><span class="comment">            dp[i]=min(dp[i],dp[j]+Tme[i]*(Cst[i]-Cst[j])+S*(Cst[N]-Cst[j]));*/</span></span><br><span class="line">    <span class="comment">//O(n^2)</span></span><br><span class="line">    Q[<span class="number">1</span>]=<span class="number">0</span>,head=tail=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=N;++i)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">while</span>(head&lt;tail&amp;&amp;(dp[Q[head+<span class="number">1</span>]]-dp[Q[head]])&lt;=(Tme[i]+S)*(Cst[Q[head+<span class="number">1</span>]]-Cst[Q[head]])) ++head;</span><br><span class="line">        <span class="type">int</span> j=Q[head];</span><br><span class="line">        dp[i]=dp[j]-(Tme[i]+S)*(Cst[j])+Tme[i]*Cst[i]+S*Cst[N];</span><br><span class="line">        <span class="keyword">while</span>(head&lt;tail&amp;&amp;(dp[Q[tail]]-dp[Q[tail<span class="number">-1</span>]])*(Cst[i]-Cst[Q[tail]])&gt;=(dp[i]-dp[Q[tail]])*(Cst[Q[tail]]-Cst[Q[tail<span class="number">-1</span>]])) --tail;</span><br><span class="line">        Q[++tail]=i;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%lld&quot;</span>,dp[N]);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">5</span></span><br><span class="line"><span class="comment">1</span></span><br><span class="line"><span class="comment">1 3</span></span><br><span class="line"><span class="comment">3 2</span></span><br><span class="line"><span class="comment">4 3</span></span><br><span class="line"><span class="comment">2 3</span></span><br><span class="line"><span class="comment">1 4</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure></details><h3 id="P3195-HNOI2008-玩具装箱"><a href="#P3195-HNOI2008-玩具装箱" class="headerlink" title="P3195 [HNOI2008]玩具装箱"></a><a href="https://www.luogu.com.cn/problem/P3195">P3195 [HNOI2008]玩具装箱</a></h3><h4 id="题解"><a href="#题解" class="headerlink" title="题解"></a>题解</h4><p>这道题看似是紫题，其实也是一道斜率优化的模板题。</p><p>令 $a[i]=sum[i]+i,b[i]=a[i]+L+1$ ，方便表示 。</p><p>推出转移方程为：</p><p>$dp[i]=dp[j]+(a[i]-b[j])^2$</p><p>然后变成点斜式：</p><p>$dp[i]-a[i]^2=2a[i]\times b[j]+dp[j]+b[j]^2$</p><p>用一次函数的方式表示：</p><p>$x=b[j]$</p><p>$y=dp[j]+b[j]^2$</p><p>$k=2a[i]$</p><p>$b=dp[i]-a[i]^2$</p><p>完成。</p><p>然后用经典的斜率优化单调推进解出即可。</p><p><strong>注：在斜率优化里，一般为了避免除法导致的运行时错误，所以将除法提出变成乘法，但在这一次里，我还是写的除法，算是斜率优化的另一种写法。</strong></p><details>    <summary>AC Code</summary><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;ctime&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iomanip&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stack&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;map&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> gh() getchar()</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> re register</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> db double</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> ll;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN=<span class="number">5e4</span>+<span class="number">1</span>;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    x=<span class="number">0</span>;</span><br><span class="line">    <span class="type">char</span> ch=<span class="built_in">gh</span>(),t=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(ch&lt;<span class="string">&#x27;0&#x27;</span>||ch&gt;<span class="string">&#x27;9&#x27;</span>) t|=ch==<span class="string">&#x27;-&#x27;</span>,ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">while</span>(ch&gt;=<span class="string">&#x27;0&#x27;</span>&amp;&amp;ch&lt;=<span class="string">&#x27;9&#x27;</span>) x=(x&lt;&lt;<span class="number">3</span>)+(x&lt;&lt;<span class="number">1</span>)+(ch^<span class="number">48</span>),ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">if</span>(t) x=-x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T,<span class="keyword">class</span> ...T1&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x,T1 &amp;...x1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">read</span>(x),<span class="built_in">read</span>(x1...);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">checkMax</span><span class="params">(T &amp;x,T &amp;y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x&lt;y?x=y,<span class="number">1</span>:<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">checkMin</span><span class="params">(T &amp;x,T &amp;y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x&gt;y?x=y,<span class="number">1</span>:<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> N,head=<span class="number">1</span>,tail=<span class="number">1</span>,q[MAXN];</span><br><span class="line">ll L;</span><br><span class="line">db len[MAXN],dp[MAXN];</span><br><span class="line"><span class="function"><span class="keyword">inline</span> db <span class="title">calcA</span><span class="params">(<span class="type">int</span> x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> len[x]+x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> db <span class="title">calcB</span><span class="params">(<span class="type">int</span> x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">calcA</span>(x)+L+<span class="number">1</span>;;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> db <span class="title">calcX</span><span class="params">(<span class="type">int</span> x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">calcB</span>(x);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> db <span class="title">calcY</span><span class="params">(<span class="type">int</span> x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> dp[x]+<span class="built_in">calcB</span>(x)*<span class="built_in">calcB</span>(x);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> db <span class="title">slope</span><span class="params">(<span class="type">int</span> a,<span class="type">int</span> b)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (<span class="built_in">calcY</span>(a)-<span class="built_in">calcY</span>(b))/(<span class="built_in">calcX</span>(a)-<span class="built_in">calcX</span>(b));</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// freopen(&quot;dp-convex-hull-opt.in&quot;,&quot;r&quot;,stdin);</span></span><br><span class="line">    <span class="comment">// freopen(&quot;dp-convex-hull-opt.out&quot;,&quot;w&quot;,stdout);</span></span><br><span class="line">    <span class="built_in">read</span>(N,L);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=N;++i) <span class="built_in">scanf</span>(<span class="string">&quot;%lf&quot;</span>,&amp;len[i]),len[i]+=len[i<span class="number">-1</span>];</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=N;++i)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">while</span>(head&lt;tail&amp;&amp;<span class="built_in">slope</span>(q[head],q[head+<span class="number">1</span>])&lt;<span class="number">2</span>*<span class="built_in">calcA</span>(i)) ++head;</span><br><span class="line">        <span class="type">int</span> j=q[head];</span><br><span class="line">        dp[i]=dp[j]+(<span class="built_in">calcA</span>(i)-<span class="built_in">calcB</span>(j))*(<span class="built_in">calcA</span>(i)-<span class="built_in">calcB</span>(j));</span><br><span class="line">        <span class="keyword">while</span>(head&lt;tail&amp;&amp;<span class="built_in">slope</span>(i,q[tail<span class="number">-1</span>])&lt;<span class="built_in">slope</span>(q[tail<span class="number">-1</span>],q[tail])) --tail;</span><br><span class="line">        q[++tail]=i;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%lld&quot;</span>,(ll)dp[N]);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">xj=lenj+j</span></span><br><span class="line"><span class="comment">yj=dpj+(lenj+j)^2</span></span><br><span class="line"><span class="comment">ki=-2(L+1-(lenj+j))</span></span><br><span class="line"><span class="comment">bi=dpi-(leni+i-(L+1))^2</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure></details><h3 id="CF311B-Cats-Transport"><a href="#CF311B-Cats-Transport" class="headerlink" title="CF311B Cats Transport"></a><a href="https://www.luogu.com.cn/problem/CF311B">CF311B Cats Transport</a></h3><p>多维斜率优化，推出式子。</p><p>用 $s[i]$ 表示 $\sum\limits^{i}_{k=1}t[k]$ ，则有：</p><p>$\sum_{k = j + 1}^{i}{t_{i} - t_{k}}= \sum_{k = j + 1}^{i}{t_{i}} - \sum_{k = j + 1}^{i}{t_{k}} = (i - j) t_{i} - (s[i] - s[j])$</p><p>用 $dp[i][j]$ 表示第 $i$ 个人选择了 $j$ 只猫的最小代价。然后得出斜率式：</p><p>$s[k]+dp[i-1][k]=t[j]k-jt[j]+s[j]+dp[i][j]$</p><p>$y=s[k]+dp[i-1][k],k=t[j],b=-jt[j]+s[j]+dp[i][j]$</p><p>完成，反正我是不会做的。</p><details>    <summary>AC Code</summary><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;ctime&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iomanip&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stack&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;map&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> gh() getchar()</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> re register</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> db double</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> ll;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN=<span class="number">1e5</span>+<span class="number">1</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXP=<span class="number">1e2</span>+<span class="number">1</span>;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    x=<span class="number">0</span>;</span><br><span class="line">    <span class="type">char</span> ch=<span class="built_in">gh</span>(),t=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(ch&lt;<span class="string">&#x27;0&#x27;</span>||ch&gt;<span class="string">&#x27;9&#x27;</span>) t|=ch==<span class="string">&#x27;-&#x27;</span>,ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">while</span>(ch&gt;=<span class="string">&#x27;0&#x27;</span>&amp;&amp;ch&lt;=<span class="string">&#x27;9&#x27;</span>) x=(x&lt;&lt;<span class="number">3</span>)+(x&lt;&lt;<span class="number">1</span>)+(ch^<span class="number">48</span>),ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">if</span>(t) x=-x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T,<span class="keyword">class</span> ...T1&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x,T1 &amp;...x1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">read</span>(x),<span class="built_in">read</span>(x1...);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">checkMax</span><span class="params">(T &amp;x,T &amp;y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x&lt;y?x=y,<span class="number">1</span>:<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">checkMin</span><span class="params">(T &amp;x,T &amp;y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x&gt;y?x=y,<span class="number">1</span>:<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> N,M,P;</span><br><span class="line">ll dth[MAXN],tme[MAXN],id,cst[MAXN];</span><br><span class="line">ll dp[MAXP][MAXN],Que[MAXN],sum[MAXN];</span><br><span class="line"><span class="function"><span class="keyword">inline</span> ll <span class="title">get_Y</span><span class="params">(<span class="type">int</span> k,<span class="type">int</span> j)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> dp[j<span class="number">-1</span>][k]+sum[k];</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// freopen(&quot;dp.in&quot;,&quot;r&quot;,stdin);</span></span><br><span class="line">    <span class="comment">// freopen(&quot;dp.out&quot;,&quot;w&quot;,stdout);</span></span><br><span class="line">    <span class="built_in">read</span>(N,M,P);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">2</span>;i&lt;=N;++i) <span class="built_in">read</span>(dth[i]),dth[i]+=dth[i<span class="number">-1</span>];</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=M;++i)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">read</span>(id,tme[i]);</span><br><span class="line">        cst[i]=tme[i]-dth[id];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">sort</span>(cst+<span class="number">1</span>,cst+<span class="number">1</span>+M);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=M;++i) sum[i]=sum[i<span class="number">-1</span>]+cst[i];</span><br><span class="line">    <span class="built_in">memset</span>(dp,<span class="number">0x3f</span>,<span class="built_in">sizeof</span>(dp));</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;=P;++i) dp[i][<span class="number">0</span>]=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">1</span>;j&lt;=P;++j)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> head=<span class="number">0</span>,tail=<span class="number">0</span>;</span><br><span class="line">        Que[<span class="number">0</span>]=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=M;++i)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">while</span>(head&lt;tail&amp;&amp;(<span class="built_in">get_Y</span>(Que[head+<span class="number">1</span>],j)-<span class="built_in">get_Y</span>(Que[head],j))&lt;=cst[i]*(Que[head+<span class="number">1</span>]-Que[head])) ++head;</span><br><span class="line">            <span class="type">int</span> k=Que[head];</span><br><span class="line">            dp[j][i]=dp[j<span class="number">-1</span>][k]-cst[i]*k+sum[k]+cst[i]*i-sum[i];</span><br><span class="line">            <span class="keyword">while</span>(head&lt;tail&amp;&amp;(<span class="built_in">get_Y</span>(Que[tail],j)-<span class="built_in">get_Y</span>(Que[tail<span class="number">-1</span>],j))*(i-Que[tail])&gt;=(<span class="built_in">get_Y</span>(i,j)-<span class="built_in">get_Y</span>(Que[tail],j))*(Que[tail]-Que[tail<span class="number">-1</span>])) --tail;</span><br><span class="line">            Que[++tail]=i;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%lld&quot;</span>,dp[P][M]);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">4 6 2</span></span><br><span class="line"><span class="comment">1 3 5</span></span><br><span class="line"><span class="comment">1 0</span></span><br><span class="line"><span class="comment">2 1</span></span><br><span class="line"><span class="comment">4 9</span></span><br><span class="line"><span class="comment">1 10</span></span><br><span class="line"><span class="comment">2 10</span></span><br><span class="line"><span class="comment">3 12</span></span><br><span class="line"><span class="comment">*/</span>    </span><br></pre></td></tr></table></figure></details><hr><h3 id="P3628-特别行动队"><a href="#P3628-特别行动队" class="headerlink" title="P3628 特别行动队"></a><a href="https://www.luogu.com.cn/problem/P3628">P3628 特别行动队</a></h3><p>当做是我练习推式子的练习题了。发现异常好推。</p><p>令 $s[i]$ 表示为 $x$ 的前缀和，则有：</p><p>$dp[i]=as[i]^2+bs[i]+c+as[j]^2-2as[i]s[j]-bs[j]+dp[j]$</p><p>然后化成函数式表示为：</p><p>$dp[j]+as[j]^2-bs[j]=2as[i]s[j]+dp[i]-as[i]^2-bs[i]-c$ </p><p>$\mathcal{END}$</p><details>    <summary>AC Code</summary><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;ctime&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iomanip&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stack&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;map&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> gh() getchar()</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> re register</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> ll;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN=<span class="number">1e6</span>+<span class="number">1</span>;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    x=<span class="number">0</span>;</span><br><span class="line">    <span class="type">char</span> ch=<span class="built_in">gh</span>(),t=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(ch&lt;<span class="string">&#x27;0&#x27;</span>||ch&gt;<span class="string">&#x27;9&#x27;</span>) t|=ch==<span class="string">&#x27;-&#x27;</span>,ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">while</span>(ch&gt;=<span class="string">&#x27;0&#x27;</span>&amp;&amp;ch&lt;=<span class="string">&#x27;9&#x27;</span>) x=(x&lt;&lt;<span class="number">3</span>)+(x&lt;&lt;<span class="number">1</span>)+(ch^<span class="number">48</span>),ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">if</span>(t) x=-x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T,<span class="keyword">class</span> ...T1&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x,T1 &amp;...x1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">read</span>(x),<span class="built_in">read</span>(x1...);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">checkMax</span><span class="params">(T &amp;x,T &amp;y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x&lt;y?x=y,<span class="number">1</span>:<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">checkMin</span><span class="params">(T &amp;x,T &amp;y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x&gt;y?x=y,<span class="number">1</span>:<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line">ll N,a,b,c;</span><br><span class="line">ll s[MAXN],dp[MAXN],val;</span><br><span class="line">ll head,tail,Que[MAXN];</span><br><span class="line"><span class="function"><span class="keyword">inline</span> ll <span class="title">K</span><span class="params">(<span class="type">int</span> id)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">2</span>*a*s[id];</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> ll <span class="title">X</span><span class="params">(<span class="type">int</span> id)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> s[id];</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> ll <span class="title">Y</span><span class="params">(<span class="type">int</span> id)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> dp[id]+a*s[id]*s[id]-b*s[id];</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> ll <span class="title">B</span><span class="params">(<span class="type">int</span> id)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> dp[id]-a*dp[id]*dp[id]-b*dp[id]-c;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> ll <span class="title">slope</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (<span class="built_in">Y</span>(x)-<span class="built_in">Y</span>(y))/(<span class="built_in">X</span>(x)-<span class="built_in">X</span>(y));</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// freopen(&quot;dp-convex.in&quot;,&quot;r&quot;,stdin);</span></span><br><span class="line">    <span class="comment">// freopen(&quot;dp-convex.out&quot;,&quot;w&quot;,stdout);</span></span><br><span class="line">    <span class="built_in">read</span>(N,a,b,c);</span><br><span class="line">    Que[head=tail=<span class="number">1</span>]=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=N;++i)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">read</span>(val);</span><br><span class="line">        s[i]=s[i<span class="number">-1</span>]+val;</span><br><span class="line">        <span class="keyword">while</span>((<span class="built_in">head</span>&lt;tail)&amp;&amp;(<span class="built_in">Y</span>(Que[head+<span class="number">1</span>])-<span class="built_in">Y</span>(Que[head]))&gt;(<span class="built_in">X</span>(Que[head+<span class="number">1</span>])-<span class="built_in">X</span>(Que[head]))*<span class="built_in">K</span>(i)) ++head;</span><br><span class="line">        <span class="keyword">if</span>(head&lt;=tail) dp[i]=dp[Que[head]]+(s[i]-s[Que[head]])*(s[i]-s[Que[head]])*a+(s[i]-s[Que[head]])*b+c;</span><br><span class="line">        <span class="keyword">while</span>((head&lt;tail)&amp;&amp;(<span class="built_in">Y</span>(Que[tail])-<span class="built_in">Y</span>(Que[tail<span class="number">-1</span>]))*(<span class="built_in">X</span>(i)-<span class="built_in">X</span>(Que[tail]))&lt;=((<span class="built_in">Y</span>(i)-<span class="built_in">Y</span>(Que[tail]))*(<span class="built_in">X</span>(Que[tail])-<span class="built_in">X</span>(Que[tail<span class="number">-1</span>])))) --tail;</span><br><span class="line">        Que[++tail]=i;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%lld&quot;</span>,dp[N]);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">f[j]+a*s[j]*s[j]-b*s[j]=2*a*s[i]*s[j]+f[i]</span></span><br><span class="line"><span class="comment">4 </span></span><br><span class="line"><span class="comment">-1 10 -20 </span></span><br><span class="line"><span class="comment">2 2 3 4 </span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure></details><hr><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><hr><p>关于 $x,y,k,b$ 的选择：</p><p>首先，明晰斜率优化是用来解决以： $dp[i]=\min/\max\{dp[j]+a[i]+b[j]+a[i]\times b[j]\}$ 的问题，当然 $a[i]$ 和 $b[j]$ 不一定存在，但是 $a[i]\times b[j]$ 一定存在。</p><p>然后，拆下 $\min/\max$ ，并将<strong>只</strong>关于 $j$ 的置于一旁：</p><p>$dp[j]+b[j]=-a[i]\times b[j]+dp[i]-a[i]$</p><p>这个时候，一次函数式就已经列出来了。</p><ol><li><strong>仅</strong>关于 $i$ 的项作为 $b$ ；</li><li><strong>仅</strong>关于 $j$ 的项作为 $y$ ；</li><li><strong>既</strong>关于 $i$ <strong>又</strong>关于 $j$ 的项中，$i$ 项作 $k$ ，$j$ 项作 $x$ 。</li><li>其中<strong>既</strong>与 $i$ 无关，<strong>又</strong>和 $j$ 无关的常数项视作与 $i$ 同类。</li></ol><hr><p>依我看来，斜率优化算是 $\mathcal{dp}$ 一栏里最难的部分了。省选+会涉及，所以根据 <code>onehui</code> 给我定的目标，我还是不得不学。</p><font style="color:white">说实话，依我而看，我的实力远远不够，后路很长，如果一起前进最后的结果终究是四分五裂。所以，也许，是时候，做出取舍。但即使如此，我也必须努力才行啊。</font><p>$\mathcal{finished\ at\ 2022.5.14}$</p>]]></content>
      
      
      <categories>
          
          <category> 学习笔记 </category>
          
          <category> OI </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 数论 </tag>
            
            <tag> DP </tag>
            
            <tag> 优化 </tag>
            
            <tag> 斜率优化 </tag>
            
            <tag> 几何 </tag>
            
            <tag> 凸包 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>恒永末世，决铭永生，终末之诗</title>
      <link href="/Eternity/%E5%9B%9E%E5%93%8D%E5%9C%B0%E5%9F%9F%E7%9A%84%E8%B5%9E%E7%BE%8E%E8%AF%97/%E5%A4%9A%E5%85%83%E5%AE%87%E5%AE%99%E7%9A%84%E4%BA%A4%E7%BB%87%E4%B8%8E%E7%A2%B0%E6%92%9E/Eternaltale/"/>
      <url>/Eternity/%E5%9B%9E%E5%93%8D%E5%9C%B0%E5%9F%9F%E7%9A%84%E8%B5%9E%E7%BE%8E%E8%AF%97/%E5%A4%9A%E5%85%83%E5%AE%87%E5%AE%99%E7%9A%84%E4%BA%A4%E7%BB%87%E4%B8%8E%E7%A2%B0%E6%92%9E/Eternaltale/</url>
      
        <content type="html"><![CDATA[<p>“Nothing is <font style="color:darkviolet">Eternal</font> but <font style="color:red">love</font>“</p><span id="more"></span><hr><h2 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h2><p>现阶段作者：我，即落幕の残影</p><p>现阶段更新平台：Bilibili，网易云音乐。</p><p>现阶段更新方式：OST，小说。</p><p>整个AU共分为五个阶段：</p><blockquote><p>Eternalverse 终末之诗 亘古篇之一</p><p>Eternaltale: Soul Save 恒永末世：魂萦之赎 亘古篇之二</p><p>Eternaltale: Void Origin 恒永末世：源启虚空 过去篇</p><p>Eternaltale: Ashes Finale 恒永末世：烬灭终焉 现在篇</p><p>Eternalrune 决铭永生 未来篇</p></blockquote><h2 id="背景故事"><a href="#背景故事" class="headerlink" title="背景故事"></a>背景故事</h2><h3 id="亘古的遗产-Before-End"><a href="#亘古的遗产-Before-End" class="headerlink" title="亘古的遗产(Before End)"></a>亘古的遗产(Before End)</h3><p>这是发生在 $\text{X-tale}$ 和 $\text{Underverse}$ 之前的故事。</p><p>涂鸦球领域的某一个角落，这是一条早已被废弃的 $\text{Dusttale }$时间线，一切都随入了自由，而作为 $\text{Dusttale}$ 的原主人——$\text{Chara}$，也当然早已无所不能，「这……肯定不是第一次了吧……」，然而，随意重置，随意屠杀，面对已经对此厌倦的 $\text{Sans}$，$\text{Chara}$ 也开始厌倦了起来。于是，她看向了地下室的六魂……</p><p>知晓了，这只是一条废弃的时间线；知晓了，这只是千千万万个时间线的复制体……仅仅是因为 $\text{Ink}$ 的一点疏忽，使这个 $\text{LV}$ 已经无法计算，成为了一条时间线神明的 $\text{Chara}$，带着她附身的 $\text{Frisk }$，进入了涂鸦球领域，开始了，别有一番滋味的<strong>屠杀</strong>。</p><h3 id="过去与未来-Under-Choice"><a href="#过去与未来-Under-Choice" class="headerlink" title="过去与未来(Under Choice)"></a>过去与未来(Under Choice)</h3><p>你，作为第七人类，坠落地底。</p><p>而你的脑海，另一个声音响起。她陪伴着你，给予你指导，但不会为你的选择做出任何评价。</p><p>无论你做了什么事，只需要一步 $\text{Reset}$ ，便不会承担责任。</p><p>被暗影侵蚀的遗迹，如影之城欢迎所有冒失闯入的探险家；<br>风雪封锁的极冰镇，寒冷埋葬的秘密与不可视的亘古谜团；<br>回音四起的郁花之海，在耀晶与流水之中窥见真正的自我；<br>热浪翻滚的熔岩陨石，在决心的闪耀之中明晰埋葬的真相；</p><p>【你，在看着，对吧？】有人在质问，你？或者，你，背后的……</p><p>暗紫的闪电划破轰鸣的机器，黑白的记忆碎片重叠交错；<br>你看到了熟悉的陌生人，他正在用手和你打招呼。</p><p>王城将至，你的旅途，即将达到终点。</p><p>而在此之前，螺旋的楼梯步步升高，每一层都是从未见过的挑战。</p><p>而当暮色的光刺破银白的长廊，钟声悠扬。</p><p>你并不是主宰和神明，所以，没有人理应忍让你。</p><p>经历烈火焚烧，才会再见朝阳。</p><p>而，背叛是常有的事……</p><h3 id="之后的传说-After-Tale"><a href="#之后的传说-After-Tale" class="headerlink" title="之后的传说(After Tale)"></a>之后的传说(After Tale)</h3><p>逆转过去之后的六十年，人类与怪物共同的幸福生活。</p><p>作为弃孤的 $\text{Kris}$ 被 $\text{Frisk}$ 和 $\text{Chara}$ 收养，与曾经的怪物们一起生活。</p><p>而在学校的一次郊外活动时，与同学 $\text{Susie}$ ，找到了一处隐秘的遗迹，与，一段未被挖掘的秘密，和一方潜藏的巨大危机。</p><h2 id="地域"><a href="#地域" class="headerlink" title="地域"></a>地域</h2><h3 id="如影之城"><a href="#如影之城" class="headerlink" title="如影之城"></a>如影之城</h3><p>地底的第一片区域，被称为<strong>遗迹</strong>（$\text{Ruined City}$）的地方。云烟弥漫的雾障之城，这里曾是怪物生活的第一个王都，曾经称为<strong>诡离虹</strong>（$\text{Early Home}$）的地方。</p><p>现在，仍有少部分怪物生活在这里，有许多谜题和机关，但似乎都被谁拆除或者改造得没有任何危险。在小镇的中心，一棵地底的参天大树直破层岩，地脉与树血一齐涌动。</p><p>守护者 $\text{Toriel}$ 面慈和善，用最好的晚餐款待你，与你同览小镇的风光，帮助你交结了许许多多的朋友。但似乎……对你总有一丝防备。</p><p>一朵会说话的紫罗兰，自称为你初识地底世界的向导，并从一开始就指导你的各种行动，却在遇见 $\text{Toriel}$ 之后消失无踪。</p><p>小镇上，每一个怪物都有自己的个性与思考。他们可以与你成为知交；也可以站在对立面，与你为敌。</p><p>在雾障侵蚀的暗影之中，小镇依然洋溢着其乐融融。</p><p>而在迷雾中迷失，无意中，便会进入一条，没有颜色的长廊。会说话的门，与无尽的深渊螺旋。仿佛，地底的地底。在那里，遗留着居住的痕迹，与，记载着无法理解的文字的日记。</p>]]></content>
      
      
      <categories>
          
          <category> 回响地域的赞美诗 </category>
          
          <category> 多元宇宙的交织与碰撞 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> UndertaleAU </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>《重启人生》——无法被修正的过去，和我们再一次的未来</title>
      <link href="/Eternity/%E8%AE%B0%E9%9A%8F%E5%BD%B1%E8%90%BD/starting-over/"/>
      <url>/Eternity/%E8%AE%B0%E9%9A%8F%E5%BD%B1%E8%90%BD/starting-over/</url>
      
        <content type="html"><![CDATA[<p>作者：（日本）三秋缒</p><p>作品名：《重启人生Starting Over》</p><span id="more"></span><p>在中考之前读完了这本书，似乎不是一个正确的时间，但总而言之，得到了心灵的洗礼。</p><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>《重启人生》是作家三秋缒的处女作，但他已经非常尽力的在完善这本书了。</p><blockquote><p>这是，<br>迎接二十岁生日的我，<br>重新回到十岁，<br>又再次走向二十岁的故事。</p></blockquote><p>如果有机会去重新做一件自己认为是成功了的事，我想，凭借着记忆，不会把其做得更好，反而会导致意想不到的结果吧。毕竟，运气和时运都存在在那里。老天爷是不会眷顾同一个人两次的，如果老天爷真的存在。</p><hr><p><strong>警告，以下内容涉嫌剧透，如果没有读过原著，请酌情阅读！！！</strong></p><hr><p>这本书确实注重第一观感，就和Undertale一样。</p><h2 id="一些感悟"><a href="#一些感悟" class="headerlink" title="一些感悟"></a>一些感悟</h2><p>人会改变，也能改变，必须改变。幸福，不是按照程序等来的，而是要自己去发现，去寻找，去努力。</p><p>这可能就是“我”在第二人生失败的原因吧。我一直坚信，仅仅去靠经验之谈生活，这个人是不可能存在好结果的。经验这种东西，并不是指引你走向未来，而是教会你如何使用过去。</p><p>说实话，这本轻小说的结局我是没有猜到的，能说是Happy Ending吗？或许是，又或许不能算是，两个支离破碎的人在末日尽头拥抱了对方，以寻求片刻的完整，对于失望与绝望而言，这也许也能使一个较好的结果吧。</p><p>我不太喜欢第一人称的小说，因为其巨大的代入感，最终又会在我看完整本书的时候让我产生巨大的落差感。<strong>因为，我与“我”之间存在了太大的差异了。</strong>而《重启人生》，这种失败的感觉我倒是深有体会吧。<strong>作为一个没有第一人生的第二人生的我，真的是太有体会了。</strong>在生活一步一步的逼迫之下，选择成为了圣诞节的坏大人。<font style="color:white">也许就是我的宿命，以梦想为借口，逃避生活。</font></p><p>说句实话，对于我个人而言，我认为我能算是半个完美的人。即使不是成绩最好，即使依然有人讨厌，即使家里存在纠葛，即使……但如果不对生活进行抱怨的话，我想，即使是流浪的人也会感到幸福，就像文中的臼水一般，唯一放在心上的，便是今天的天气。</p><p>可能很多人在最后会觉得这本书有些悲观。是真的，但对于我而言刚好合适，我是一个在内心消极与黑暗中挣扎的人，也正因如此，我才会喜欢这本书。</p><p>很多时候我们不懂得去珍惜身边的人和事，直到自己失去了的时候才去后悔。活着有时候要长远计划也要享受当下。而不能一味地去羡慕别人。我们又何尝不是，找着虚假的理由欺骗自己，我只想对自己说要面对现实，没有人愿意看着这么废物的自己，那就去改变而不是去逃避。<font style="color:white">虽然，有些时候，逃避是最好的选择，麻痹自己，也是一种生存的手段。将生活的苟且看作是诗和远方，或许自责也会少几分吧。</font></p><p>又或许，如果我能够有这所谓的第二人生，也许我会想着去改变什么。因为现在想起来，也许以前的很多年都是在徘徊中前进的。我的生活或许是完美的，但我并不是完美的。如果能给我再一次机会，也许我能够对她道歉，也许我能和他道别，也许……</p><blockquote><p>这个世界上没有如果。</p></blockquote><p>这便是答案。</p><p>或许，正因为有遗憾存在，才有去追寻未来的理由吧。</p><h2 id="名句"><a href="#名句" class="headerlink" title="名句"></a>名句</h2><blockquote><p>所谓的人生啊，哪怕只是出现蝴蝶扑翅般微小的差异，也会发生极大的变化。</p><p>正确的答案不一定是真实的答案。就算是一场误会，只要持续十年，对本人来说，那就已经是不想修正的现实了。</p><p>我讨厌看到现在进行时的幸福，却喜欢品尝幸福的余韵，那种味道淡淡的，让人觉得或许这里曾有过幸福。</p><p>至少比起想象未来如何活着，考虑死亡的事要顺利得多。</p><p>可那个人应该也是以第一名为目标，最后才能跑出第三名的成绩。假设他从一开始就以第三名为目标，最后一定是拿到第七名或第九名吧。</p><p>若是过着五十分的生活，人就会连小事都放在心上，希望生活变成五十一分；若是过着负五十分的生活，再怎么努力变成负四十九分也没有意义。</p><p>成为一个对自己人生丝毫没有后悔的人。这样的人大概非常幸福吧？要不然，就是一个超级大笨蛋；不是过着没有任何地方需要反省的完美人生，就是连反省自己人生的脑袋都没有。</p><p>因为微小的差异，人会改变，也能改变。</p><p>只要丢掉“因为一直以来都是这样，以后也会一样的吧”这样的想法就好。</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> 记随影落 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 轻小说 </tag>
            
            <tag> 恋爱 </tag>
            
            <tag> 三秋缒 </tag>
            
            <tag> 奇幻 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>D.C</title>
      <link href="/Eternity/Until-The-End/my-primary-school-from-4-to-6/"/>
      <url>/Eternity/Until-The-End/my-primary-school-from-4-to-6/</url>
      
        <content type="html"><![CDATA[<div class="hbe hbe-container" id="hexo-blog-encrypt" data-wpm="Oh, this is an invalid password. Check and try again, please." data-whm="OOPS, these decrypted content may changed, but you can still have a look.">  <script id="hbeData" type="hbeData" data-hmacdigest="fc3f31f9801f98c62d6a5fc06b627205f0bfd65cb8130eaec82127d401dd22f5">956fa686beba65e04596fd799f3775e672369116bcd6125d89206d7efafc653e3e61174e1404890bd808bd01608a024aa35abd9f52aba4bc4e267524d1019a8f</script>  <div class="hbe hbe-content">    <div class="hbe hbe-input hbe-input-xray">      <input class="hbe hbe-input-field hbe-input-field-xray" type="password" id="hbePass">      <label class="hbe hbe-input-label hbe-input-label-xray" for="hbePass">        <span class="hbe hbe-input-label-content hbe-input-label-content-xray">密码：我的小学班主任名字小写缩写</span>      </label>      <svg class="hbe hbe-graphic hbe-graphic-xray" width="300%" height="100%" viewBox="0 0 1200 60" preserveAspectRatio="none">        <path d="M0,56.5c0,0,298.666,0,399.333,0C448.336,56.5,513.994,46,597,46c77.327,0,135,10.5,200.999,10.5c95.996,0,402.001,0,402.001,0"></path>        <path d="M0,2.5c0,0,298.666,0,399.333,0C448.336,2.5,513.994,13,597,13c77.327,0,135-10.5,200.999-10.5c95.996,0,402.001,0,402.001,0"></path>      </svg>    </div>  </div></div><script data-pjax src="/Eternity/lib/hbe.js"></script><link href="/Eternity/css/hbe.style.css" rel="stylesheet" type="text/css">]]></content>
      
      
      <categories>
          
          <category> Until The End </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>随机100题(26/100)</title>
      <link href="/Eternity/%E9%A2%98%E8%A7%A3/100-text/"/>
      <url>/Eternity/%E9%A2%98%E8%A7%A3/100-text/</url>
      
        <content type="html"><![CDATA[<p>“作为这一年的奋斗目标，难度：提高左右”</p><span id="more"></span><h3 id="1-P4170-CQOI2007-涂色"><a href="#1-P4170-CQOI2007-涂色" class="headerlink" title="1.P4170 [CQOI2007]涂色"></a>1.<a href="https://www.luogu.com.cn/problem/P4170">P4170 [CQOI2007]涂色</a></h3><p>$date: 2022.4.10$</p><p>区间 $dp$ 模板题，转移方程有三种：</p><ol><li>$dp_{l,r}=1,l=r$</li><li>$dp_{l,r}=\min\{dp_{l+1,r},dp_{l,r-1}\},op_l=op_r$</li><li>$dp_{l,r}=\min\{dp_{l,r},dp_{l,k}+dp_{k+1,r}\},op_l \neq op_r,k \in [l,r]$</li></ol><p>第一种，涂一块只需要一次即可；</p><p>而对于第二种，我们在涂的时候只需要再其子区间的时候多涂一块，不需要再涂一次，所以不用统计答案；</p><p>第三种，经典断点即可。</p><details>    <summary>AC Code</summary><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;ctime&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iomanip&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stack&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;map&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> gh() getchar()</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> re register</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> db double</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> ll;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN=<span class="number">51</span>;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    x=<span class="number">0</span>;</span><br><span class="line">    <span class="type">char</span> ch=<span class="built_in">gh</span>(),t=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(ch&lt;<span class="string">&#x27;0&#x27;</span>||ch&gt;<span class="string">&#x27;9&#x27;</span>) t|=ch==<span class="string">&#x27;-&#x27;</span>,ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">while</span>(ch&gt;=<span class="string">&#x27;0&#x27;</span>&amp;&amp;ch&lt;=<span class="string">&#x27;9&#x27;</span>) x=(x&lt;&lt;<span class="number">3</span>)+(x&lt;&lt;<span class="number">1</span>)+(ch^<span class="number">48</span>),ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">if</span>(t) x=-x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> dp[MAXN][MAXN],n,op[MAXN];</span><br><span class="line"><span class="type">char</span> str[MAXN];</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">change</span><span class="params">(<span class="type">char</span> s)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> s-<span class="string">&#x27;A&#x27;</span>+<span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// freopen(&quot;dp-section.in&quot;,&quot;r&quot;,stdin);</span></span><br><span class="line">    <span class="comment">// freopen(&quot;dp-section.out&quot;,&quot;w&quot;,stdout);</span></span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>,str+<span class="number">1</span>);</span><br><span class="line">    n=<span class="built_in">strlen</span>(str+<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;++i) op[i]=<span class="built_in">change</span>(str[i]);</span><br><span class="line">    <span class="built_in">memset</span>(dp,<span class="number">0x3f</span>,<span class="built_in">sizeof</span>(dp));</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> len=<span class="number">1</span>;len&lt;=n;++len)</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> l=<span class="number">1</span>;l&lt;=n-len+<span class="number">1</span>;++l)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="type">int</span> r=l+len<span class="number">-1</span>;</span><br><span class="line">            <span class="keyword">if</span>(l==r) dp[l][r]=<span class="number">1</span>;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span>(op[l]==op[r])</span><br><span class="line">                dp[l][r]=<span class="built_in">min</span>(dp[l+<span class="number">1</span>][r],dp[l][r<span class="number">-1</span>]);</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                <span class="keyword">for</span>(<span class="type">int</span> k=l;k&lt;r;++k)</span><br><span class="line">                    dp[l][r]=<span class="built_in">min</span>(dp[l][r],dp[l][k]+dp[k+<span class="number">1</span>][r]);</span><br><span class="line">        &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d&quot;</span>,dp[<span class="number">1</span>][n]);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">AAAAA</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure></details><h3 id="2-CF1109A-Sasha-and-a-Bit-of-Relax"><a href="#2-CF1109A-Sasha-and-a-Bit-of-Relax" class="headerlink" title="2.CF1109A Sasha and a Bit of Relax"></a>2.<a href="https://www.luogu.com.cn/problem/CF1109A">CF1109A Sasha and a Bit of Relax</a></h3><p>$date:2022.4.10$</p><p>区间数学题，详见<a href="https://www.luogu.com.cn/blog/FallenShadow/solution-cf1109a">题解</a></p><details>    <summary>AC Code</summary><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;ctime&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iomanip&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stack&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;map&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> gh() getchar()</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> re register</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> db double</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ls p&lt;&lt;1</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> rs ls|1</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> ll;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN=<span class="number">3e5</span>+<span class="number">1</span>;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    x=<span class="number">0</span>;</span><br><span class="line">    <span class="type">char</span> ch=<span class="built_in">gh</span>(),t=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(ch&lt;<span class="string">&#x27;0&#x27;</span>||ch&gt;<span class="string">&#x27;9&#x27;</span>) t|=ch==<span class="string">&#x27;-&#x27;</span>,ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">while</span>(ch&gt;=<span class="string">&#x27;0&#x27;</span>&amp;&amp;ch&lt;=<span class="string">&#x27;9&#x27;</span>) x=(x&lt;&lt;<span class="number">3</span>)+(x&lt;&lt;<span class="number">1</span>)+(ch^<span class="number">48</span>),ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">if</span>(t) x=-x;</span><br><span class="line">&#125;</span><br><span class="line">ll n,val,sum[MAXN];</span><br><span class="line">ll res;</span><br><span class="line">map&lt;pair&lt;ll,ll&gt;,ll&gt;M;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// freopen(&quot;segment.in&quot;,&quot;r&quot;,stdin);</span></span><br><span class="line">    <span class="comment">// freopen(&quot;segment.out&quot;,&quot;w&quot;,stdout);</span></span><br><span class="line">    <span class="built_in">read</span>(n);</span><br><span class="line">    ++M[<span class="built_in">make_pair</span>(<span class="number">0</span>,<span class="number">1</span>)];</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;++i)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">read</span>(val);</span><br><span class="line">        sum[i]=sum[i<span class="number">-1</span>]^val;</span><br><span class="line">        ll x=!(i&amp;<span class="number">1</span>);</span><br><span class="line">        res+=M[<span class="built_in">make_pair</span>(sum[i],x)];</span><br><span class="line">        ++M[<span class="built_in">make_pair</span>(sum[i],x)];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%lld&quot;</span>,res);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">5</span></span><br><span class="line"><span class="comment">1 2 3 4 5</span></span><br><span class="line"><span class="comment">6</span></span><br><span class="line"><span class="comment">3 2 2 3 7 6</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">x^x=0</span></span><br><span class="line"><span class="comment">x^0=x</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure></details><h3 id="3-P8179-「EZEC-11」Tyres"><a href="#3-P8179-「EZEC-11」Tyres" class="headerlink" title="3.P8179 「EZEC-11」Tyres"></a><a href="https://www.luogu.com.cn/problem/P8179">3.P8179 「EZEC-11」Tyres</a></h3><p>$date:2022.04.16$</p><p>虽然不是随机跳的，但是还是记上吧。调了大半天的。最后发现 $INF$ 开小了。题解的话看出题人就可以了，这里不多说。（<del>主要是讲不明白</del>）。</p><details>    <summary>AC Code</summary><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;ctime&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iomanip&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stack&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;map&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> gh() getchar()</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> underMax(x,y) ((x)&gt;(y)?(x):(y))</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> underMin(x,y) ((x)&lt;(y)?(x):(y))</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> ll;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN=<span class="number">505</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXM=<span class="number">2e5</span>+<span class="number">1</span>;</span><br><span class="line"><span class="type">const</span> ll MAXB=<span class="number">25</span>;</span><br><span class="line"><span class="type">const</span> ll INF=<span class="number">0x3f3f3f3f3f3f3f3f</span>;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    x=<span class="number">0</span>;</span><br><span class="line">    <span class="type">char</span> ch=<span class="built_in">gh</span>(),t=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(ch&lt;<span class="string">&#x27;0&#x27;</span>||ch&gt;<span class="string">&#x27;9&#x27;</span>) t|=ch==<span class="string">&#x27;-&#x27;</span>,ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">while</span>(ch&gt;=<span class="string">&#x27;0&#x27;</span>&amp;&amp;ch&lt;=<span class="string">&#x27;9&#x27;</span>) x=(x&lt;&lt;<span class="number">3</span>)+(x&lt;&lt;<span class="number">1</span>)+(ch^<span class="number">48</span>),ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">if</span>(t) x=-x;</span><br><span class="line">&#125;</span><br><span class="line">ll n,m;</span><br><span class="line">ll t,dp[MAXN][MAXB+<span class="number">8</span>],g[MAXM],hgt[MAXM];</span><br><span class="line">ll a[MAXN],b[MAXN],c[MAXN],s;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Compare</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">operator</span><span class="params">()</span><span class="params">(<span class="type">const</span> ll&amp;x,<span class="type">const</span> ll&amp;y)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> (a[x]+b[x]*c[x]*c[x]&gt;a[y]+b[y]*c[y]*c[y])||</span><br><span class="line">            (a[x]+b[x]*c[x]*c[x]==a[y]+b[y]*c[y]*c[y]&amp;&amp;x&gt;y);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line">priority_queue&lt;ll,vector&lt;ll&gt;,Compare&gt;Q;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// freopen(&quot;t3.in&quot;,&quot;r&quot;,stdin);</span></span><br><span class="line">    <span class="comment">// freopen(&quot;t3.out&quot;,&quot;w&quot;,stdout);</span></span><br><span class="line">    <span class="built_in">read</span>(n),<span class="built_in">read</span>(m),<span class="built_in">read</span>(t),s=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(ll i=<span class="number">1</span>;i&lt;=n;++i)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">read</span>(a[i]),<span class="built_in">read</span>(b[i]),c[i]=MAXB,Q.<span class="built_in">push</span>(i);</span><br><span class="line">        dp[i][<span class="number">1</span>]=a[i]+t;</span><br><span class="line">        <span class="keyword">for</span>(ll j=<span class="number">2</span>;j&lt;=MAXB;++j)</span><br><span class="line">            dp[i][j]=dp[i][j<span class="number">-1</span>]+a[i]+b[i]*(j<span class="number">-1</span>)*(j<span class="number">-1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">memset</span>(g,<span class="number">0x3f</span>,<span class="built_in">sizeof</span>(g)),g[<span class="number">0</span>]=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(ll i=<span class="number">1</span>;i&lt;=n;++i)</span><br><span class="line">    &#123;</span><br><span class="line">        s=<span class="built_in">min</span>(m,s+MAXB);</span><br><span class="line">        <span class="keyword">for</span>(ll j=s;j&gt;=<span class="number">0</span>;--j)</span><br><span class="line">            <span class="keyword">for</span>(ll k=<span class="number">0</span>;k&lt;=MAXB&amp;&amp;k&lt;=j;++k)</span><br><span class="line">                g[j]=<span class="built_in">min</span>(g[j],g[j-k]+dp[i][k]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(ll i=<span class="number">1</span>;i&lt;=m;++i)</span><br><span class="line">    &#123;</span><br><span class="line">        ll x=Q.<span class="built_in">top</span>();</span><br><span class="line">        Q.<span class="built_in">pop</span>();</span><br><span class="line">        hgt[i]=hgt[i<span class="number">-1</span>]+a[x]+b[x]*c[x]*c[x];</span><br><span class="line">        ++c[x],Q.<span class="built_in">push</span>(x);</span><br><span class="line">    &#125;</span><br><span class="line">    ll ans=INF;</span><br><span class="line">    <span class="keyword">for</span>(ll i=<span class="number">0</span>;i&lt;=s&amp;&amp;i&lt;=m;++i) ans=<span class="built_in">min</span>(ans,g[i]+hgt[m-i]);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%lld&quot;</span>,ans-t);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">2 4 50</span></span><br><span class="line"><span class="comment">10 100</span></span><br><span class="line"><span class="comment">100 1</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure></details><h3 id="4-CF986A-Fair"><a href="#4-CF986A-Fair" class="headerlink" title="4.CF986A Fair"></a><a href="https://www.luogu.com.cn/problem/CF986A">4.CF986A Fair</a></h3><p>$date:2022.04.16$</p><p><del>看到最短路，我啪的一下就点进来了</del>。这道题类似于全源最短路，但是其点数和边数过大，所以考虑按颜色分配。用 $Dist[c][v]$ 表示到 $c$ 节点涂上 $v$ 颜色的最小代价，然后用 $O(n)$ 的 $bfs$ 跑即可，然后将所有颜色排序，在每个节点处取前 $s$ 个 $Dist_{c,v}$ 即可。</p><details>    <summary>AC Code</summary><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;ctime&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iomanip&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stack&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;map&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> gh() getchar()</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> re register</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> db double</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> ll;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN=<span class="number">1e5</span>+<span class="number">1</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXM=<span class="number">1e5</span>+<span class="number">1</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXK=<span class="number">101</span>;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    x=<span class="number">0</span>;</span><br><span class="line">    <span class="type">char</span> ch=<span class="built_in">gh</span>(),t=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(ch&lt;<span class="string">&#x27;0&#x27;</span>||ch&gt;<span class="string">&#x27;9&#x27;</span>) t|=ch==<span class="string">&#x27;-&#x27;</span>,ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">while</span>(ch&gt;=<span class="string">&#x27;0&#x27;</span>&amp;&amp;ch&lt;=<span class="string">&#x27;9&#x27;</span>) x=(x&lt;&lt;<span class="number">3</span>)+(x&lt;&lt;<span class="number">1</span>)+(ch^<span class="number">48</span>),ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">if</span>(t) x=-x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">checkMax</span><span class="params">(T &amp;x,T &amp;y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x&lt;y?x=y,<span class="number">1</span>:<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">checkMin</span><span class="params">(T &amp;x,T &amp;y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x&gt;y?x=y,<span class="number">1</span>:<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> n,m,k,s,cnt[MAXN];</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">edge</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> next,to;</span><br><span class="line">&#125;Edge[MAXM&lt;&lt;<span class="number">1</span>];</span><br><span class="line"><span class="type">int</span> Head[MAXN],Total,Dist[MAXN][MAXK];</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">addEdge</span><span class="params">(<span class="type">int</span> u,<span class="type">int</span> v)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Edge[++Total]=(edge)&#123;Head[u],v&#125;;Head[u]=Total;</span><br><span class="line">    Edge[++Total]=(edge)&#123;Head[v],u&#125;;Head[v]=Total;</span><br><span class="line">&#125;</span><br><span class="line">vector&lt;<span class="type">int</span>&gt;Col[MAXK];</span><br><span class="line">queue&lt;<span class="type">int</span>&gt;Q;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// freopen(&quot;mininum-road.in&quot;,&quot;r&quot;,stdin);</span></span><br><span class="line">    <span class="comment">// freopen(&quot;mininum-road.out&quot;,&quot;w&quot;,stdout);</span></span><br><span class="line">    <span class="built_in">read</span>(n),<span class="built_in">read</span>(m),<span class="built_in">read</span>(k),<span class="built_in">read</span>(s);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;++i) <span class="built_in">read</span>(cnt[i]),Col[cnt[i]].<span class="built_in">push_back</span>(i);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>,u,v;i&lt;=m;++i)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">read</span>(u),<span class="built_in">read</span>(v);</span><br><span class="line">        <span class="built_in">addEdge</span>(u,v);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">memset</span>(Dist,<span class="number">-1</span>,<span class="built_in">sizeof</span>(Dist));</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> c=<span class="number">1</span>;c&lt;=k;++c)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">auto</span> i:Col[c])</span><br><span class="line">        &#123;</span><br><span class="line">            Q.<span class="built_in">push</span>(i);</span><br><span class="line">            Dist[i][c]=<span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">while</span>(!Q.<span class="built_in">empty</span>())</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="type">int</span> u=Q.<span class="built_in">front</span>();Q.<span class="built_in">pop</span>();</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> e=Head[u],v;e;e=Edge[e].next)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">if</span>(Dist[(v=Edge[e].to)][c]==<span class="number">-1</span>)</span><br><span class="line">                    Dist[v][c]=Dist[u][c]+<span class="number">1</span>,Q.<span class="built_in">push</span>(v);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> ans=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;++i)</span><br><span class="line">    &#123;</span><br><span class="line">        ans=<span class="number">0</span>;</span><br><span class="line">        <span class="built_in">sort</span>(Dist[i]+<span class="number">1</span>,Dist[i]+<span class="number">1</span>+k);</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">1</span>;j&lt;=s;++j) ans+=Dist[i][j];</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d &quot;</span>,ans);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">5 5 4 3</span></span><br><span class="line"><span class="comment">1 2 4 3 2</span></span><br><span class="line"><span class="comment">1 2</span></span><br><span class="line"><span class="comment">2 3</span></span><br><span class="line"><span class="comment">3 4</span></span><br><span class="line"><span class="comment">4 1</span></span><br><span class="line"><span class="comment">4 5</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure></details><h3 id="5-P5810-SCOI2004-文本的输入"><a href="#5-P5810-SCOI2004-文本的输入" class="headerlink" title="5.P5810 [SCOI2004]文本的输入"></a>5.<a href="https://www.luogu.com.cn/problem/P5810">P5810 [SCOI2004]文本的输入</a></h3><p>$date:2022.4.19$</p><p>并不是随机跳的，无意中刷了一道四川省选题。</p><p>一道数学类型的 $dp$ 题。定义 <code>dp[i]</code> 为代价为 $i$ 时的最大字符数，对于添加字符，则 <code>dp[i]=dp[i-1]+1</code> 。而对于复制则遍历 $i-k,k=2j+5,j \in \mathbb{N^*}$ ，然后转移 $dp_i=\max^{k=2j+5 \leq i}_{u=1}(u+1)dp_{i-k}$ 即可。可以证明 <code>dp[i]</code> 单调。二分查找即可。</p><details>    <summary>AC Code</summary><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;ctime&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iomanip&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stack&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;map&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> gh() getchar()</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> re register</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> db double</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> ll;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN=<span class="number">4e5</span>+<span class="number">1</span>;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    x=<span class="number">0</span>;</span><br><span class="line">    <span class="type">char</span> ch=<span class="built_in">gh</span>(),t=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(ch&lt;<span class="string">&#x27;0&#x27;</span>||ch&gt;<span class="string">&#x27;9&#x27;</span>) t|=ch==<span class="string">&#x27;-&#x27;</span>,ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">while</span>(ch&gt;=<span class="string">&#x27;0&#x27;</span>&amp;&amp;ch&lt;=<span class="string">&#x27;9&#x27;</span>) x=(x&lt;&lt;<span class="number">3</span>)+(x&lt;&lt;<span class="number">1</span>)+(ch^<span class="number">48</span>),ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">if</span>(t) x=-x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">checkMax</span><span class="params">(T &amp;x,T &amp;y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x&lt;y?x=y,<span class="number">1</span>:<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">checkMin</span><span class="params">(T &amp;x,T &amp;y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x&gt;y?x=y,<span class="number">1</span>:<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line">ll T,dp[MAXN],ans;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// freopen(&quot;o(1).in&quot;,&quot;r&quot;,stdin);</span></span><br><span class="line">    <span class="comment">// freopen(&quot;o(1).out&quot;,&quot;w&quot;,stdout);</span></span><br><span class="line">    <span class="built_in">read</span>(T);</span><br><span class="line">    <span class="keyword">if</span>(T==<span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;0&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(ans=<span class="number">1</span>;dp[ans<span class="number">-1</span>]&lt;T;++ans)</span><br><span class="line">    &#123;</span><br><span class="line">        dp[ans]=dp[ans<span class="number">-1</span>]+<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span>(ll i=ans<span class="number">-7</span>,j=<span class="number">2</span>;i&gt;=<span class="number">1</span>;i-=<span class="number">2</span>,++j)</span><br><span class="line">            dp[ans]=<span class="built_in">max</span>(dp[ans],dp[i]*j);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%lld&quot;</span>,ans<span class="number">-1</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">20</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure></details><h3 id="6-P1934-封印"><a href="#6-P1934-封印" class="headerlink" title="6.P1934 封印"></a>6.<a href="https://www.luogu.com.cn/problem/P1934">P1934 封印</a></h3><p>$date:2022.4.20$</p><p>较水的 $dp$ 题，转移方程：$dp_{i}=\min\{dp_{j}+(v_i+v_j)(\sum\limits^{i}_{k=j}v_k)\},v_i+v_j \leq t,j&lt;i$ 初始化 $dp_{i}=dp_{i-1}+n^2v_i$ ，注意开 <code>long long</code> ，要爆。</p><details>    <summary>AC Code</summary><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;ctime&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iomanip&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stack&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;map&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> gh() getchar()</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> re register</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> db double</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> ll;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN=<span class="number">1001</span>;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    x=<span class="number">0</span>;</span><br><span class="line">    <span class="type">char</span> ch=<span class="built_in">gh</span>(),t=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(ch&lt;<span class="string">&#x27;0&#x27;</span>||ch&gt;<span class="string">&#x27;9&#x27;</span>) t|=ch==<span class="string">&#x27;-&#x27;</span>,ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">while</span>(ch&gt;=<span class="string">&#x27;0&#x27;</span>&amp;&amp;ch&lt;=<span class="string">&#x27;9&#x27;</span>) x=(x&lt;&lt;<span class="number">3</span>)+(x&lt;&lt;<span class="number">1</span>)+(ch^<span class="number">48</span>),ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">if</span>(t) x=-x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">checkMax</span><span class="params">(T &amp;x,T &amp;y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x&lt;y?x=y,<span class="number">1</span>:<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">checkMin</span><span class="params">(T &amp;x,T &amp;y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x&gt;y?x=y,<span class="number">1</span>:<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> n;</span><br><span class="line">ll val[MAXN],sum[MAXN],dp[MAXN],t;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// freopen(&quot;dp.in&quot;,&quot;r&quot;,stdin);</span></span><br><span class="line">    <span class="comment">// freopen(&quot;dp.out&quot;,&quot;w&quot;,stdout);</span></span><br><span class="line">    <span class="built_in">read</span>(n),<span class="built_in">read</span>(t);</span><br><span class="line">    <span class="keyword">for</span>(re <span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;++i) <span class="built_in">read</span>(val[i]),sum[i]=sum[i<span class="number">-1</span>]+val[i];</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;++i)</span><br><span class="line">    &#123;</span><br><span class="line">        dp[i]=dp[i<span class="number">-1</span>]+n*n*val[i];</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j=i<span class="number">-1</span>;j&gt;=<span class="number">1</span>;--j)</span><br><span class="line">            <span class="keyword">if</span>(val[i]+val[j]&lt;=t)</span><br><span class="line">                dp[i]=<span class="built_in">min</span>(dp[i],dp[j<span class="number">-1</span>]+(val[i]+val[j])*(sum[i]-sum[j<span class="number">-1</span>]));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%lld&quot;</span>,dp[n]);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">6 10</span></span><br><span class="line"><span class="comment">8 5 7 9 3 5</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure></details><h3 id="7-P7224-RC-04-子集积"><a href="#7-P7224-RC-04-子集积" class="headerlink" title="7.P7224 [RC-04] 子集积"></a><a href="https://www.luogu.com.cn/problem/P7224">7.P7224 [RC-04] 子集积</a></h3><p>$date:2022.4.20$</p><p>好吧，刚开始我以为这是一道普普通通的背包，结果是我想错了。<del>果然还是太菜了</del>，看了题解之后才有了点思路，但是还是失败了。就算贺过去了。这里给出题解的思路。</p><p>一共有 $2^n$ 个子集，暴力加入每一个物品，然后算就完事了。但是这样的时间复杂度是 $O(nm)$ ，不太保险。所以将 $a_i$ 相同的统一处理。即转换为完全背包。令 $a_i=j(j&gt;1)$ 的 $i$ 有 $k$ 个，则对于 $j,j^2,j^3…j^k$ 的转移系数为 $(^k_q)$ 。如果 $a_i=1$ 则将答案乘以 $2^k$ 而不作转移，最后统一处理。</p><p>时间复杂度 $O(\sum\limits^{m}_{i=2}\sum\limits^{cnt_i}_{j=1}\lfloor\frac{m}{i^j}\rfloor)$ ，一个很离谱的式子。近似于 $O(m \ln m)$ 。</p><p>预处理阶乘以及逆元以及阶乘的逆元用来求组合数。然后就背包了。</p><p>尝试了一下封装写法。</p><details>    <summary>AC Code</summary><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;ctime&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iomanip&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stack&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;map&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> gh() getchar()</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> re register</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> db double</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> ll;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN=<span class="number">1e6</span>+<span class="number">1</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> Mod=<span class="number">998244353</span>;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    x=<span class="number">0</span>;</span><br><span class="line">    <span class="type">char</span> ch=<span class="built_in">gh</span>(),t=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(ch&lt;<span class="string">&#x27;0&#x27;</span>||ch&gt;<span class="string">&#x27;9&#x27;</span>) t|=ch==<span class="string">&#x27;-&#x27;</span>,ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">while</span>(ch&gt;=<span class="string">&#x27;0&#x27;</span>&amp;&amp;ch&lt;=<span class="string">&#x27;9&#x27;</span>) x=(x&lt;&lt;<span class="number">3</span>)+(x&lt;&lt;<span class="number">1</span>)+(ch^<span class="number">48</span>),ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">if</span>(t) x=-x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">checkMax</span><span class="params">(T &amp;x,T &amp;y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x&lt;y?x=y,<span class="number">1</span>:<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">checkMin</span><span class="params">(T &amp;x,T &amp;y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x&gt;y?x=y,<span class="number">1</span>:<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">namespace</span> Calc</span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">add</span><span class="params">(<span class="type">int</span> &amp;a,<span class="type">int</span> b)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        a=a+b-(a+b&gt;=Mod?Mod:<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">sub</span><span class="params">(<span class="type">int</span> &amp;a,<span class="type">int</span> b)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        a=a-b+(a-b&lt;<span class="number">0</span>?Mod:<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">pro</span><span class="params">(<span class="type">int</span> a,<span class="type">int</span> b)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1ll</span>*a*b%Mod;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="type">int</span> fac[MAXN],inv[MAXN],inv_fac[MAXN],n;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">init</span><span class="params">(<span class="type">int</span> n)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    fac[<span class="number">0</span>]=inv_fac[<span class="number">0</span>]=<span class="number">1</span>;</span><br><span class="line">    fac[<span class="number">1</span>]=inv[<span class="number">1</span>]=inv_fac[<span class="number">1</span>]=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">2</span>;i&lt;=n;++i)</span><br><span class="line">    &#123;</span><br><span class="line">        fac[i]=Calc::<span class="built_in">pro</span>(fac[i<span class="number">-1</span>],i);</span><br><span class="line">        inv[i]=Calc::<span class="built_in">pro</span>(Mod-Mod/i,inv[Mod%i]);</span><br><span class="line">        inv_fac[i]=Calc::<span class="built_in">pro</span>(inv_fac[i<span class="number">-1</span>],inv[i]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">C</span><span class="params">(<span class="type">int</span> n,<span class="type">int</span> m)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(n&lt;<span class="number">0</span>||m&lt;<span class="number">0</span>||n&lt;m) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">return</span> Calc::<span class="built_in">pro</span>(fac[n],Calc::<span class="built_in">pro</span>(inv_fac[m],inv_fac[n-m]));</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> m,val[MAXN],dp[MAXN],cnt[MAXN];</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// freopen(&quot;dp-bag.in&quot;,&quot;r&quot;,stdin);</span></span><br><span class="line">    <span class="comment">// freopen(&quot;dp-bag.out&quot;,&quot;w&quot;,stdout);</span></span><br><span class="line">    <span class="built_in">read</span>(n),<span class="built_in">read</span>(m);</span><br><span class="line">    <span class="keyword">for</span>(re <span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;++i) <span class="built_in">read</span>(val[i]),++cnt[val[i]];</span><br><span class="line">    <span class="type">int</span> Max=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">2</span>;i&lt;MAXN;++i) <span class="built_in">checkMax</span>(Max,cnt[i]);</span><br><span class="line">    <span class="built_in">init</span>(Max);</span><br><span class="line">    dp[<span class="number">1</span>]=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">2</span>;i&lt;MAXN;++i)</span><br><span class="line">        <span class="keyword">if</span>(cnt[i])</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> k=m/i;k&gt;=<span class="number">1</span>;--k)</span><br><span class="line">                <span class="keyword">if</span>(dp[k])</span><br><span class="line">                &#123;</span><br><span class="line">                    ll v=i;</span><br><span class="line">                    <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">1</span>;j&lt;=cnt[i]&amp;&amp;v*k&lt;=m;++j,v*=i)</span><br><span class="line">                        Calc::<span class="built_in">add</span>(dp[v*k],Calc::<span class="built_in">pro</span>(<span class="built_in">C</span>(cnt[i],j),dp[k]));</span><br><span class="line">                &#125;</span><br><span class="line">    <span class="type">int</span> ans=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n-cnt[<span class="number">1</span>];++i) Calc::<span class="built_in">add</span>(ans,ans);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=m;++i) Calc::<span class="built_in">sub</span>(ans,dp[i]);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=cnt[<span class="number">1</span>];++i) Calc::<span class="built_in">add</span>(ans,ans);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d&quot;</span>,ans); </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">20 123456</span></span><br><span class="line"><span class="comment">1 5 12 24 189893 233333 2 22 134 3284 28456 261 50 10 1 2 2 2 2 22</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure></details><h3 id="8-P7228-COCI2015-2016-3-MOLEKULE"><a href="#8-P7228-COCI2015-2016-3-MOLEKULE" class="headerlink" title="8.P7228 [COCI2015-2016#3] MOLEKULE"></a><a href="https://www.luogu.com.cn/problem/P7228">8.P7228 [COCI2015-2016#3] MOLEKULE</a></h3><p>$date:2022.4.20$</p><p>跑一遍 $dfs$ ，然后使其入度和出度相交为 $0$ 即可。毕竟这道题不需要让你输出价值。</p><details>    <summary>AC Code</summary><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;ctime&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iomanip&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stack&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;map&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> gh() getchar()</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> re register</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> db double</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> ll;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN=<span class="number">1e6</span>+<span class="number">1</span>;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    x=<span class="number">0</span>;</span><br><span class="line">    <span class="type">char</span> ch=<span class="built_in">gh</span>(),t=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(ch&lt;<span class="string">&#x27;0&#x27;</span>||ch&gt;<span class="string">&#x27;9&#x27;</span>) t|=ch==<span class="string">&#x27;-&#x27;</span>,ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">while</span>(ch&gt;=<span class="string">&#x27;0&#x27;</span>&amp;&amp;ch&lt;=<span class="string">&#x27;9&#x27;</span>) x=(x&lt;&lt;<span class="number">3</span>)+(x&lt;&lt;<span class="number">1</span>)+(ch^<span class="number">48</span>),ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">if</span>(t) x=-x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">checkMax</span><span class="params">(T &amp;x,T &amp;y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x&lt;y?x=y,<span class="number">1</span>:<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">checkMin</span><span class="params">(T &amp;x,T &amp;y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x&gt;y?x=y,<span class="number">1</span>:<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">namespace</span> Graph</span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> Head[MAXN],Total,To[MAXN&lt;&lt;<span class="number">1</span>];</span><br><span class="line">    <span class="type">bool</span> f,vis[MAXN];</span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">edge</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> next,to;</span><br><span class="line">    &#125;Edge[MAXN&lt;&lt;<span class="number">1</span>];</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">addEdge</span><span class="params">(<span class="type">int</span> u,<span class="type">int</span> v)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        Edge[++Total]=(edge)&#123;Head[u],v&#125;;Head[u]=Total;</span><br><span class="line">        Edge[Total+MAXN]=(edge)&#123;Head[v],u&#125;;Head[v]=Total+MAXN;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">dfs</span><span class="params">(<span class="type">int</span> u)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(vis[u]) <span class="keyword">return</span> ;</span><br><span class="line">        vis[u]=<span class="number">1</span>,f^=<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> e=Head[u],v;e;e=Edge[e].next)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span>(vis[(v=Edge[e].to)]) <span class="keyword">continue</span>;</span><br><span class="line">            <span class="keyword">if</span>(e&gt;MAXN) To[e-MAXN]=f^<span class="number">1</span>;</span><br><span class="line">            <span class="keyword">else</span> To[e]=f;</span><br><span class="line">            <span class="built_in">dfs</span>(v);</span><br><span class="line">        &#125;</span><br><span class="line">        f^=<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">outPrint</span><span class="params">(<span class="type">int</span> n)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;n;++i) <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,To[i]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> N;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// freopen(&quot;dfs.in&quot;,&quot;r&quot;,stdin);</span></span><br><span class="line">    <span class="comment">// freopen(&quot;dfs.out&quot;,&quot;w&quot;,stdout);</span></span><br><span class="line">    <span class="built_in">read</span>(N);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>,u,v;i&lt;N;++i)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">read</span>(u),<span class="built_in">read</span>(v);</span><br><span class="line">        Graph::<span class="built_in">addEdge</span>(u,v);</span><br><span class="line">    &#125;</span><br><span class="line">    Graph::<span class="built_in">dfs</span>(<span class="number">1</span>);</span><br><span class="line">    Graph::<span class="built_in">outPrint</span>(N);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">3</span></span><br><span class="line"><span class="comment">1 2</span></span><br><span class="line"><span class="comment">2 3</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure></details><h3 id="9-P4763-CERC2014-Bricks"><a href="#9-P4763-CERC2014-Bricks" class="headerlink" title="9.P4763 [CERC2014]Bricks"></a>9.<a href="https://www.luogu.com.cn/problem/P4763">P4763 [CERC2014]Bricks</a></h3><p>$date:2022.4.20$</p><p>看到同机房巨佬 $Live$ 在切，然后想起以前在学校的 $OI$ 上做过，然后就过来 $experience^2$ 了。一道比较难思考的贪心题。思路也忘了，估计现在也不会打了。</p><details>    <summary>AC Code</summary><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;ctime&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iomanip&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stack&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;map&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> gh() getchar()</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> re register</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> db double</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> ll;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN=<span class="number">1e5</span>+<span class="number">1</span>;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    x=<span class="number">0</span>;</span><br><span class="line">    <span class="type">char</span> ch=<span class="built_in">gh</span>(),t=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(ch&lt;<span class="string">&#x27;0&#x27;</span>||ch&gt;<span class="string">&#x27;9&#x27;</span>) t|=ch==<span class="string">&#x27;-&#x27;</span>,ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">while</span>(ch&gt;=<span class="string">&#x27;0&#x27;</span>&amp;&amp;ch&lt;=<span class="string">&#x27;9&#x27;</span>) x=(x&lt;&lt;<span class="number">3</span>)+(x&lt;&lt;<span class="number">1</span>)+(ch^<span class="number">48</span>),ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">if</span>(t) x=-x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">checkMax</span><span class="params">(T &amp;x,T &amp;y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x&lt;y?x=y,<span class="number">1</span>:<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">checkMin</span><span class="params">(T &amp;x,T &amp;y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x&gt;y?x=y,<span class="number">1</span>:<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> N,ans,T;</span><br><span class="line"><span class="type">int</span> val[MAXN],cnt[MAXN],t[MAXN];</span><br><span class="line"><span class="type">char</span> op[MAXN];</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">change</span><span class="params">(<span class="type">char</span> s)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (s==<span class="string">&#x27;B&#x27;</span>?<span class="number">1</span>:<span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">init</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">read</span>(N),ans=<span class="number">0</span>;</span><br><span class="line">    <span class="built_in">memset</span>(op,<span class="string">&#x27;\0&#x27;</span>,<span class="built_in">sizeof</span>(op));</span><br><span class="line">    <span class="built_in">memset</span>(cnt,<span class="number">0</span>,<span class="built_in">sizeof</span>(cnt));</span><br><span class="line">    <span class="built_in">memset</span>(t,<span class="number">0</span>,<span class="built_in">sizeof</span>(t));</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=N;++i)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">read</span>(val[i]);</span><br><span class="line">        cin&gt;&gt;op[i];</span><br><span class="line">        cnt[<span class="built_in">change</span>(op[i])]+=val[i];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// freopen(&quot;brick.in&quot;,&quot;r&quot;,stdin);</span></span><br><span class="line">    <span class="comment">// freopen(&quot;brick.out&quot;,&quot;w&quot;,stdout);</span></span><br><span class="line">    <span class="built_in">read</span>(T);</span><br><span class="line">    <span class="keyword">while</span>(T--)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">init</span>();</span><br><span class="line">        <span class="keyword">if</span>(!cnt[<span class="number">0</span>]||!cnt[<span class="number">1</span>])</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,cnt[<span class="number">0</span>]+cnt[<span class="number">1</span>]);</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=N;++i)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="type">int</span> x=<span class="built_in">change</span>(op[i]),y=<span class="built_in">change</span>(op[i])^<span class="number">1</span>;</span><br><span class="line">            <span class="keyword">if</span>(<span class="number">1ll</span>*cnt[x]*t[y]%cnt[y]==<span class="number">0</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="type">int</span> res=<span class="number">1ll</span>*cnt[x]*t[y]/cnt[y]-t[x];</span><br><span class="line">                <span class="keyword">if</span>(res&gt;=<span class="number">1</span>&amp;&amp;res&lt;=val[i]) ++ans;</span><br><span class="line">            &#125;</span><br><span class="line">            t[x]+=val[i];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,ans);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">3</span></span><br><span class="line"><span class="comment">3</span></span><br><span class="line"><span class="comment">1 B</span></span><br><span class="line"><span class="comment">3 W</span></span><br><span class="line"><span class="comment">2 B</span></span><br><span class="line"><span class="comment">4</span></span><br><span class="line"><span class="comment">3 W</span></span><br><span class="line"><span class="comment">3 B</span></span><br><span class="line"><span class="comment">9 W</span></span><br><span class="line"><span class="comment">1 B</span></span><br><span class="line"><span class="comment">2</span></span><br><span class="line"><span class="comment">2 W</span></span><br><span class="line"><span class="comment">3 W</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure></details><h3 id="10-CF1562C-Rings"><a href="#10-CF1562C-Rings" class="headerlink" title="10.CF1562C Rings"></a>10.<a href="https://www.luogu.com.cn/problem/CF1562C">CF1562C Rings</a></h3><p>$date:2022.04.22$</p><p>暴力 $O(n^2)$ 查找，但显然是过不了的。所以我们来找数学规律。</p><p>由于 $0$ 是任何非 $0$ 整数的倍数，一个数本身也是自己的倍数，所以：</p><ul><li>如果该字符串中有大于等于 $\lfloor \frac{n}{2} \rfloor$ 的连续子串全为 $0$ ，那么另找一个长度大于 $\lfloor \frac{n}{2} \rfloor$ 的连续子串即可。</li><li>如果该字符串中有两个长度大于等于 $\lfloor \frac{n}{2} \rfloor$ 的连续子串，或者是有一个长度大于等于 $\frac{n}{2}$ 的连续子串且该字串前面一位或数位为 $0$，那么也是一组解。</li><li>如果一个字符串有一个长度大于等于 $\lfloor \frac{n}{2} \rfloor$ 的连续子串，它的后面一位或数位为 $0$，说明包括后面的 $0$ 的子串一定是该子串的 $2$ 倍，是一组解。</li><li>否则说明该字符串全为 $1$，符合上面的第二种情况。事实上，上面第一种情况也可以归到第二、三两种情况里。</li></ul><p>所以，无论什么情况，该题都是有解的，用 $O(n)$ 扫一遍即可。</p><details>    <summary>AC Code</summary><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;ctime&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iomanip&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stack&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;map&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> gh() getchar()</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> re register</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> db double</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> ll;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN=<span class="number">1e6</span>+<span class="number">1</span>;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    x=<span class="number">0</span>;</span><br><span class="line">    <span class="type">char</span> ch=<span class="built_in">gh</span>(),t=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(ch&lt;<span class="string">&#x27;0&#x27;</span>||ch&gt;<span class="string">&#x27;9&#x27;</span>) t|=ch==<span class="string">&#x27;-&#x27;</span>,ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">while</span>(ch&gt;=<span class="string">&#x27;0&#x27;</span>&amp;&amp;ch&lt;=<span class="string">&#x27;9&#x27;</span>) x=(x&lt;&lt;<span class="number">3</span>)+(x&lt;&lt;<span class="number">1</span>)+(ch^<span class="number">48</span>),ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">if</span>(t) x=-x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">checkMax</span><span class="params">(T &amp;x,T &amp;y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x&lt;y?x=y,<span class="number">1</span>:<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">checkMin</span><span class="params">(T &amp;x,T &amp;y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x&gt;y?x=y,<span class="number">1</span>:<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> T,n;</span><br><span class="line"><span class="type">char</span> str[MAXN];</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// freopen(&quot;rings.in&quot;,&quot;r&quot;,stdin);</span></span><br><span class="line">    <span class="comment">// freopen(&quot;rings.out&quot;,&quot;w&quot;,stdout);</span></span><br><span class="line">    <span class="built_in">read</span>(T);</span><br><span class="line">    <span class="keyword">while</span>(T--)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">read</span>(n);</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>,str+<span class="number">1</span>);</span><br><span class="line">        <span class="type">bool</span> flag=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;<span class="built_in">i</span>&lt;=n;++i)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span>(str[i]==<span class="string">&#x27;0&#x27;</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                flag=<span class="number">1</span>;</span><br><span class="line">                <span class="keyword">if</span>(i&gt;(n&gt;&gt;<span class="number">1</span>)) <span class="built_in">printf</span>(<span class="string">&quot;1 %d 1 %d\n&quot;</span>,i,i<span class="number">-1</span>);</span><br><span class="line">                <span class="keyword">else</span> <span class="built_in">printf</span>(<span class="string">&quot;%d %d %d %d\n&quot;</span>,i,n,i+<span class="number">1</span>,n);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(!flag) <span class="built_in">printf</span>(<span class="string">&quot;1 %d 2 %d\n&quot;</span>,n<span class="number">-1</span>,n);</span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">7</span></span><br><span class="line"><span class="comment">6</span></span><br><span class="line"><span class="comment">101111</span></span><br><span class="line"><span class="comment">9</span></span><br><span class="line"><span class="comment">111000111</span></span><br><span class="line"><span class="comment">8</span></span><br><span class="line"><span class="comment">10000000</span></span><br><span class="line"><span class="comment">5</span></span><br><span class="line"><span class="comment">11011</span></span><br><span class="line"><span class="comment">6</span></span><br><span class="line"><span class="comment">001111</span></span><br><span class="line"><span class="comment">3</span></span><br><span class="line"><span class="comment">101</span></span><br><span class="line"><span class="comment">30</span></span><br><span class="line"><span class="comment">100000000000000100000000000000</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure></details><h3 id="11-P2620-虫洞"><a href="#11-P2620-虫洞" class="headerlink" title="11.P2620 虫洞"></a>11.<a href="https://www.luogu.com.cn/problem/P2620">P2620 虫洞</a></h3><p>$date:2022.4.22-2022.4.23$</p><p>一道说难不难，说简单不简单的题。</p><p>考点：离散化+建图+最短路</p><p>对于这个数轴而言，能够改变答案贡献的只有虫洞，而虫洞的范围 $P \leq 40$ ，所以考虑建图。首先离散化，对于虫洞的起点与终点，有一条单向边 $E(u,v)=0$ ，并构建一个起点 $0$ 和一个终点 $W$ ，一共 $2P+2$ 个节点，对于非 $E(u,v)=0$ 的边，我们用递归处理其边权。因为不能踩到虫洞起点，所以我们需要将起点存储（推荐 <code>set</code> 和 <code>map</code> ），然后避开即可。</p><p>然后跑最短路就可以了。用 $Floyd$ 还是 $SPFA$ 或是 $Dijkstra$ 都是可以的，常数极小。</p><p>挖坑：一开始使用 <code>vector</code> 来离散，然后就爆了很久，后来换成数组就好了。所以 $Stl$ 能不用尽量不用。</p><details>    <summary>AC Code</summary><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;ctime&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iomanip&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stack&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;map&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;set&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> gh() getchar()</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> re register</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> db double</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> ll;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXP=<span class="number">41</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> INF=<span class="number">0x3fffffff</span>;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    x=<span class="number">0</span>;</span><br><span class="line">    <span class="type">char</span> ch=<span class="built_in">gh</span>(),t=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(ch&lt;<span class="string">&#x27;0&#x27;</span>||ch&gt;<span class="string">&#x27;9&#x27;</span>) t|=ch==<span class="string">&#x27;-&#x27;</span>,ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">while</span>(ch&gt;=<span class="string">&#x27;0&#x27;</span>&amp;&amp;ch&lt;=<span class="string">&#x27;9&#x27;</span>) x=(x&lt;&lt;<span class="number">3</span>)+(x&lt;&lt;<span class="number">1</span>)+(ch^<span class="number">48</span>),ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">if</span>(t) x=-x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T,<span class="keyword">class</span> ...T1&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x,T1 &amp;...x1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">read</span>(x),<span class="built_in">read</span>(x1...);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">checkMax</span><span class="params">(T &amp;x,T &amp;y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x&lt;y?x=y,<span class="number">1</span>:<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">checkMin</span><span class="params">(T &amp;x,T &amp;y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x&gt;y?x=y,<span class="number">1</span>:<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> W,S,P,lenP;</span><br><span class="line"><span class="type">int</span> sat[MAXP],fnl[MAXP];</span><br><span class="line"><span class="type">bool</span> path[MAXP][MAXP];</span><br><span class="line"><span class="type">int</span> Dir[MAXP&lt;&lt;<span class="number">4</span>];</span><br><span class="line">std::set&lt;<span class="type">int</span>&gt;St;</span><br><span class="line"><span class="keyword">namespace</span> Floyd</span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> Dist[MAXP&lt;&lt;<span class="number">2</span>][MAXP&lt;&lt;<span class="number">2</span>];</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">initForEveryTest</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="built_in">memset</span>(Dist,<span class="number">0x3f</span>,<span class="built_in">sizeof</span>(Dist));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">calcEdge</span><span class="params">(<span class="type">int</span> u,<span class="type">int</span> v)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(u==v) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">if</span>(St.<span class="built_in">count</span>(u)) <span class="keyword">return</span> INF;</span><br><span class="line">        <span class="type">int</span> k=v;</span><br><span class="line">        <span class="keyword">for</span>(re <span class="type">int</span> i=<span class="number">1</span>;i&lt;=P;++i)</span><br><span class="line">            <span class="keyword">if</span>(u&lt;sat[i]&amp;&amp;sat[i]&lt;k&amp;&amp;(sat[i]-u)%S==<span class="number">0</span>) k=sat[i];</span><br><span class="line">        <span class="keyword">while</span>(k!=v&amp;&amp;St.<span class="built_in">count</span>(k)) --k;</span><br><span class="line">        <span class="keyword">if</span>(k==u) <span class="keyword">return</span> INF;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">calcEdge</span>(k,v)+(k-u+S<span class="number">-1</span>)/S;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">init</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">for</span>(re <span class="type">int</span> i=<span class="number">1</span>;i&lt;lenP;++i)</span><br><span class="line">            <span class="keyword">for</span>(re <span class="type">int</span> j=i+<span class="number">1</span>;j&lt;=lenP;++j)</span><br><span class="line">                Dist[i][j]=<span class="built_in">min</span>(Dist[i][j],<span class="built_in">calcEdge</span>(Dir[i],Dir[j]));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">calc</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">for</span>(re <span class="type">int</span> k=<span class="number">1</span>;k&lt;=lenP;++k)</span><br><span class="line">            <span class="keyword">for</span>(re <span class="type">int</span> i=<span class="number">1</span>;i&lt;=lenP;++i)</span><br><span class="line">                <span class="keyword">for</span>(re <span class="type">int</span> j=<span class="number">1</span>;j&lt;=lenP;++j)</span><br><span class="line">                    Dist[i][j]=<span class="built_in">min</span>(Dist[i][j],Dist[i][k]+Dist[k][j]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">outPut</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,Dist[<span class="number">1</span>][lenP]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">addEdge</span><span class="params">(<span class="type">int</span> u,<span class="type">int</span> v,<span class="type">int</span> w)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        Dist[u][v]=w;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> Floyd;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// freopen(&quot;dp-graph.in&quot;,&quot;r&quot;,stdin);</span></span><br><span class="line">    <span class="comment">// freopen(&quot;dp-graph.out&quot;,&quot;w&quot;,stdout);</span></span><br><span class="line">    <span class="built_in">read</span>(W);</span><br><span class="line">    <span class="keyword">while</span>(W)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">read</span>(S,P);</span><br><span class="line">        St.<span class="built_in">clear</span>(),lenP=<span class="number">0</span>;</span><br><span class="line">        <span class="built_in">memset</span>(Dir,<span class="number">0</span>,<span class="built_in">sizeof</span>(Dir));</span><br><span class="line">        Floyd::<span class="built_in">initForEveryTest</span>();</span><br><span class="line">        <span class="keyword">for</span>(re <span class="type">int</span> i=<span class="number">1</span>;i&lt;=P;++i)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">read</span>(sat[i],fnl[i]);</span><br><span class="line">            Dir[++lenP]=sat[i],Dir[++lenP]=fnl[i];</span><br><span class="line">            St.<span class="built_in">insert</span>(sat[i]);</span><br><span class="line">        &#125;</span><br><span class="line">        Dir[++lenP]=<span class="number">0</span>,Dir[++lenP]=W;</span><br><span class="line">        <span class="built_in">sort</span>(Dir+<span class="number">1</span>,Dir+<span class="number">1</span>+lenP);</span><br><span class="line">        lenP=<span class="built_in">unique</span>(Dir+<span class="number">1</span>,Dir+<span class="number">1</span>+lenP)-Dir<span class="number">-1</span>;</span><br><span class="line">        <span class="keyword">for</span>(re <span class="type">int</span> i=<span class="number">1</span>;i&lt;=P;++i)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="type">int</span> d1=<span class="built_in">lower_bound</span>(Dir+<span class="number">1</span>,Dir+<span class="number">1</span>+lenP,sat[i])-Dir;</span><br><span class="line">            <span class="type">int</span> d2=<span class="built_in">lower_bound</span>(Dir+<span class="number">1</span>,Dir+<span class="number">1</span>+lenP,fnl[i])-Dir;</span><br><span class="line">            Floyd::<span class="built_in">addEdge</span>(d1,d2,<span class="number">0</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        Floyd::<span class="built_in">init</span>();</span><br><span class="line">        Floyd::<span class="built_in">calc</span>();</span><br><span class="line">        Floyd::<span class="built_in">outPut</span>();</span><br><span class="line">        <span class="built_in">read</span>(W);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">28 3 5</span></span><br><span class="line"><span class="comment">2 18</span></span><br><span class="line"><span class="comment">5 13</span></span><br><span class="line"><span class="comment">12 6</span></span><br><span class="line"><span class="comment">17 25</span></span><br><span class="line"><span class="comment">20 15</span></span><br><span class="line"><span class="comment">50 6 1</span></span><br><span class="line"><span class="comment">9 45</span></span><br><span class="line"><span class="comment">0</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure></details><h3 id="12-P1879-USACO06NOV-Corn-Fields-G"><a href="#12-P1879-USACO06NOV-Corn-Fields-G" class="headerlink" title="12.P1879 [USACO06NOV]Corn Fields G"></a>12.<a href="https://www.luogu.com.cn/problem/P1879">P1879 [USACO06NOV]Corn Fields G</a></h3><p>$date:2022.04.24$</p><p>经典状压模板题，没啥好讲的。只是因为括号打错位调了很久。<del>太菜了</del>。</p><p>今天省选名单出了，在线膜拜省队爷wfy。</p><details>    <summary>AC Code</summary><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;ctime&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iomanip&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stack&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;map&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> gh() getchar()</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> register</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> db double</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> ll;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN=<span class="number">13</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXM=<span class="number">13</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXP=<span class="number">1</span>&lt;&lt;<span class="number">14</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> Mod=<span class="number">1e8</span>;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    x=<span class="number">0</span>;</span><br><span class="line">    <span class="type">char</span> ch=<span class="built_in">gh</span>(),t=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(ch&lt;<span class="string">&#x27;0&#x27;</span>||ch&gt;<span class="string">&#x27;9&#x27;</span>) t|=ch==<span class="string">&#x27;-&#x27;</span>,ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">while</span>(ch&gt;=<span class="string">&#x27;0&#x27;</span>&amp;&amp;ch&lt;=<span class="string">&#x27;9&#x27;</span>) x=(x&lt;&lt;<span class="number">3</span>)+(x&lt;&lt;<span class="number">1</span>)+(ch^<span class="number">48</span>),ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">if</span>(t) x=-x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T,<span class="keyword">class</span> ...T1&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x,T1 &amp;...x1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">read</span>(x),<span class="built_in">read</span>(x1...);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">checkMax</span><span class="params">(T &amp;x,T &amp;y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x&lt;y?x=y,<span class="number">1</span>:<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">checkMin</span><span class="params">(T &amp;x,T &amp;y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x&gt;y?x=y,<span class="number">1</span>:<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> N,M;</span><br><span class="line"><span class="type">int</span> Map[MAXN][MAXM],state[MAXP];</span><br><span class="line"><span class="type">int</span> dp[MAXN][MAXP],ok[MAXN];</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// freopen(&quot;dp-compression.in&quot;,&quot;r&quot;,stdin);</span></span><br><span class="line">    <span class="comment">// freopen(&quot;dp-compression.out&quot;,&quot;w&quot;,stdout);</span></span><br><span class="line">    <span class="built_in">read</span>(N,M);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=N;++i)</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">1</span>;j&lt;=M;++j)</span><br><span class="line">            <span class="built_in">read</span>(Map[i][j]);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=N;++i)</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">1</span>;j&lt;=M;++j)</span><br><span class="line">            ok[i]=(ok[i]&lt;&lt;<span class="number">1</span>)+Map[i][j];</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> s=<span class="number">0</span>;s&lt;(<span class="number">1</span>&lt;&lt;M);++s)</span><br><span class="line">        state[s]=((s&amp;(s&gt;&gt;<span class="number">1</span>))==<span class="number">0</span>)&amp;&amp;((s&amp;(s&lt;&lt;<span class="number">1</span>))==<span class="number">0</span>);</span><br><span class="line">    dp[<span class="number">0</span>][<span class="number">0</span>]=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=N;++i)</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> s=<span class="number">0</span>;s&lt;(<span class="number">1</span>&lt;&lt;M);++s)</span><br><span class="line">            <span class="keyword">if</span>(state[s]&amp;&amp;((s&amp;ok[i])==s))</span><br><span class="line">                <span class="keyword">for</span>(<span class="type">int</span> sl=<span class="number">0</span>;sl&lt;(<span class="number">1</span>&lt;&lt;M);++sl)</span><br><span class="line">                    <span class="keyword">if</span>((s&amp;sl)==<span class="number">0</span>)</span><br><span class="line">                        dp[i][s]=(dp[i][s]+dp[i<span class="number">-1</span>][sl])%Mod;</span><br><span class="line">    <span class="type">int</span> res=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> s=<span class="number">0</span>;s&lt;(<span class="number">1</span>&lt;&lt;M);++s)</span><br><span class="line">        res=(res+dp[N][s])%Mod;</span><br><span class="line">    <span class="comment">/*for(int i=1;i&lt;=N;++i)&#123;</span></span><br><span class="line"><span class="comment">        for(int s=0;s&lt;(1&lt;&lt;M);++s)</span></span><br><span class="line"><span class="comment">            printf(&quot;%d &quot;,dp[i][s]);</span></span><br><span class="line"><span class="comment">        printf(&quot;%d &quot;,ok[i]);</span></span><br><span class="line"><span class="comment">        puts(&quot;&quot;);</span></span><br><span class="line"><span class="comment">    &#125;</span></span><br><span class="line"><span class="comment">    for(int s=0;s&lt;(1&lt;&lt;M);++s) printf(&quot;%d &quot;,state[s]);</span></span><br><span class="line"><span class="comment">    puts(&quot;&quot;);*/</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d&quot;</span>,res);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">2 3</span></span><br><span class="line"><span class="comment">1 1 1</span></span><br><span class="line"><span class="comment">0 1 0</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure></details><h3 id="13-CF803D-Magazine-Ad"><a href="#13-CF803D-Magazine-Ad" class="headerlink" title="13.CF803D Magazine Ad"></a>13.<a href="https://www.luogu.com.cn/problem/CF803D">CF803D Magazine Ad</a></h3><p>$date:2022.4.27$</p><p>较 $H_2O$ 的二分题，注意字符串的读入。详见<a href="https://www.luogu.com.cn/blog/FallenShadow/solution-cf803d">题解</a></p><details>    <summary>AC Code</summary><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;ctime&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iomanip&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stack&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;map&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> gh() getchar()</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> re register</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> db double</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> ll;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXS=<span class="number">1e6</span>+<span class="number">1</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXK=<span class="number">1e5</span>+<span class="number">1</span>;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    x=<span class="number">0</span>;</span><br><span class="line">    <span class="type">char</span> ch=<span class="built_in">gh</span>(),t=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(ch&lt;<span class="string">&#x27;0&#x27;</span>||ch&gt;<span class="string">&#x27;9&#x27;</span>) t|=ch==<span class="string">&#x27;-&#x27;</span>,ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">while</span>(ch&gt;=<span class="string">&#x27;0&#x27;</span>&amp;&amp;ch&lt;=<span class="string">&#x27;9&#x27;</span>) x=(x&lt;&lt;<span class="number">3</span>)+(x&lt;&lt;<span class="number">1</span>)+(ch^<span class="number">48</span>),ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">if</span>(t) x=-x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T,<span class="keyword">class</span> ...T1&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x,T1 &amp;...x1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">read</span>(x),<span class="built_in">read</span>(x1...);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">checkMax</span><span class="params">(T &amp;x,T &amp;y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x&lt;y?x=y,<span class="number">1</span>:<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">checkMin</span><span class="params">(T &amp;x,T &amp;y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x&gt;y?x=y,<span class="number">1</span>:<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> k,len,p;</span><br><span class="line"><span class="type">char</span> str[MAXS];</span><br><span class="line"><span class="type">int</span> val[MAXS],tot;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">check</span><span class="params">(<span class="type">int</span> x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> res=<span class="number">0</span>,cnt=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=tot;++i)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(val[i]&gt;x) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">if</span>(res+val[i]&lt;=x) res+=val[i];</span><br><span class="line">        <span class="keyword">else</span> ++cnt,res=val[i];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// printf(&quot;%d %d\n&quot;,x,cnt);</span></span><br><span class="line">    <span class="keyword">if</span>(cnt&gt;=k) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// freopen(&quot;dp.in&quot;,&quot;r&quot;,stdin);</span></span><br><span class="line">    <span class="comment">// freopen(&quot;dp.out&quot;,&quot;w&quot;,stdout);</span></span><br><span class="line">    <span class="built_in">read</span>(k);</span><br><span class="line">    <span class="keyword">while</span>((str[++len]=<span class="built_in">gh</span>())!=<span class="string">&#x27;\n&#x27;</span>);</span><br><span class="line">    p=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=len;++i)</span><br><span class="line">        <span class="keyword">if</span>(str[i]==<span class="string">&#x27;-&#x27;</span>||str[i]==<span class="string">&#x27; &#x27;</span>)</span><br><span class="line">            val[++tot]=i-p+<span class="number">1</span>,p=i+<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span>(p!=len+<span class="number">1</span>) val[++tot]=len-p;</span><br><span class="line">    <span class="type">int</span> l=<span class="number">0</span>,r=len;</span><br><span class="line">    <span class="keyword">while</span>(l&lt;r)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> mid=(l+r)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span>(<span class="built_in">check</span>(mid)) r=mid;</span><br><span class="line">        <span class="keyword">else</span> l=mid+<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d&quot;</span>,l);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">4</span></span><br><span class="line"><span class="comment">garage for sa-le</span></span><br><span class="line"><span class="comment">7 4 3 2</span></span><br><span class="line"><span class="comment">4</span></span><br><span class="line"><span class="comment">Edu-ca-tion-al Ro-unds are so fun</span></span><br><span class="line"><span class="comment">4 3 5 3 3 5 4 3 3</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure></details><h3 id="14-P1471-方差"><a href="#14-P1471-方差" class="headerlink" title="14.P1471 方差"></a>14.<a href="https://www.luogu.com.cn/problem/P1471">P1471 方差</a></h3><p>$date:2022.4.28$</p><p><del>好久没有手切过蓝题了</del></p><p>区间维护题，较基础的线段树模板，结合了一点数学知识。</p><script type="math/tex; mode=display">\sum\limits^{r}_{i=l}(x_i+d)^2=\sum\limits^{r}_{i=l}(x_i)^2+2d\sum\limits_{i=l}^{r}x_i+(r-l+1)d^2</script><p>然后维护即可。记得在粘贴代码时改掉函数名。</p><details>    <summary>AC Code</summary><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;ctime&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iomanip&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stack&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;map&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> gh() getchar()</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> re register</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> db double</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> ll;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN=<span class="number">1e6</span>+<span class="number">1</span>;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    x=<span class="number">0</span>;</span><br><span class="line">    <span class="type">char</span> ch=<span class="built_in">gh</span>(),t=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(ch&lt;<span class="string">&#x27;0&#x27;</span>||ch&gt;<span class="string">&#x27;9&#x27;</span>) t|=ch==<span class="string">&#x27;-&#x27;</span>,ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">while</span>(ch&gt;=<span class="string">&#x27;0&#x27;</span>&amp;&amp;ch&lt;=<span class="string">&#x27;9&#x27;</span>) x=(x&lt;&lt;<span class="number">3</span>)+(x&lt;&lt;<span class="number">1</span>)+(ch^<span class="number">48</span>),ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">if</span>(t) x=-x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T,<span class="keyword">class</span> ...T1&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x,T1 &amp;...x1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">read</span>(x),<span class="built_in">read</span>(x1...);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">checkMax</span><span class="params">(T &amp;x,T &amp;y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x&lt;y?x=y,<span class="number">1</span>:<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">checkMin</span><span class="params">(T &amp;x,T &amp;y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x&gt;y?x=y,<span class="number">1</span>:<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> N,M;</span><br><span class="line">db val[MAXN];</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Seg</span></span><br><span class="line">&#123;</span><br><span class="line">    db val,val2,tag;</span><br><span class="line">    <span class="type">int</span> l,r;</span><br><span class="line">    <span class="function">db <span class="title">sum</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1.0</span>*(r-l+<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;Tree[MAXN&lt;&lt;<span class="number">2</span>];</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">pushUp</span><span class="params">(<span class="type">int</span> p)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Tree[p].val=Tree[p&lt;&lt;<span class="number">1</span>].val+Tree[p&lt;&lt;<span class="number">1</span>|<span class="number">1</span>].val;</span><br><span class="line">    Tree[p].val2=Tree[p&lt;&lt;<span class="number">1</span>].val2+Tree[p&lt;&lt;<span class="number">1</span>|<span class="number">1</span>].val2;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">pushDown</span><span class="params">(<span class="type">int</span> p)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(Tree[p].tag)</span><br><span class="line">    &#123;</span><br><span class="line">        Tree[p&lt;&lt;<span class="number">1</span>].val2+=(Tree[p&lt;&lt;<span class="number">1</span>].val*Tree[p].tag)*<span class="number">2</span>+Tree[p&lt;&lt;<span class="number">1</span>].<span class="built_in">sum</span>()*Tree[p].tag*Tree[p].tag;</span><br><span class="line">        Tree[p&lt;&lt;<span class="number">1</span>|<span class="number">1</span>].val2+=(Tree[p&lt;&lt;<span class="number">1</span>|<span class="number">1</span>].val*Tree[p].tag)*<span class="number">2</span>+Tree[p&lt;&lt;<span class="number">1</span>|<span class="number">1</span>].<span class="built_in">sum</span>()*Tree[p].tag*Tree[p].tag;</span><br><span class="line">        Tree[p&lt;&lt;<span class="number">1</span>].val+=Tree[p&lt;&lt;<span class="number">1</span>].<span class="built_in">sum</span>()*Tree[p].tag;</span><br><span class="line">        Tree[p&lt;&lt;<span class="number">1</span>|<span class="number">1</span>].val+=Tree[p&lt;&lt;<span class="number">1</span>|<span class="number">1</span>].<span class="built_in">sum</span>()*Tree[p].tag;</span><br><span class="line">        Tree[p&lt;&lt;<span class="number">1</span>].tag+=Tree[p].tag,Tree[p&lt;&lt;<span class="number">1</span>|<span class="number">1</span>].tag+=Tree[p].tag;</span><br><span class="line">        Tree[p].tag=<span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">build</span><span class="params">(<span class="type">int</span> p,<span class="type">int</span> l,<span class="type">int</span> r)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Tree[p].l=l,Tree[p].r=r;</span><br><span class="line">    <span class="keyword">if</span>(l==r)</span><br><span class="line">    &#123;</span><br><span class="line">        Tree[p].val=val[l];</span><br><span class="line">        Tree[p].val2=val[l]*val[r];</span><br><span class="line">        <span class="keyword">return</span> ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> mid=(l+r)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">    <span class="built_in">build</span>(p&lt;&lt;<span class="number">1</span>,l,mid),<span class="built_in">build</span>(p&lt;&lt;<span class="number">1</span>|<span class="number">1</span>,mid+<span class="number">1</span>,r);</span><br><span class="line">    <span class="built_in">pushUp</span>(p);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">modify</span><span class="params">(<span class="type">int</span> p,<span class="type">int</span> l,<span class="type">int</span> r,db d)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(l&lt;=Tree[p].l&amp;&amp;Tree[p].r&lt;=r)</span><br><span class="line">    &#123;</span><br><span class="line">        Tree[p].val2+=(Tree[p].val*d)*<span class="number">2</span>+Tree[p].<span class="built_in">sum</span>()*d*d;</span><br><span class="line">        Tree[p].val+=Tree[p].<span class="built_in">sum</span>()*d;</span><br><span class="line">        Tree[p].tag+=d;</span><br><span class="line">        <span class="keyword">return</span> ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">pushDown</span>(p);</span><br><span class="line">    <span class="type">int</span> mid=(Tree[p].l+Tree[p].r)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span>(l&lt;=mid) <span class="built_in">modify</span>(p&lt;&lt;<span class="number">1</span>,l,r,d);</span><br><span class="line">    <span class="keyword">if</span>(mid&lt;r) <span class="built_in">modify</span>(p&lt;&lt;<span class="number">1</span>|<span class="number">1</span>,l,r,d);</span><br><span class="line">    <span class="built_in">pushUp</span>(p);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">db <span class="title">queryAverage</span><span class="params">(<span class="type">int</span> p,<span class="type">int</span> l,<span class="type">int</span> r)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(l&lt;=Tree[p].l&amp;&amp;Tree[p].r&lt;=r) <span class="keyword">return</span> Tree[p].val;</span><br><span class="line">    <span class="type">int</span> mid=(Tree[p].l+Tree[p].r)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">    db val=<span class="number">0</span>;</span><br><span class="line">    <span class="built_in">pushDown</span>(p);</span><br><span class="line">    <span class="keyword">if</span>(l&lt;=mid) val+=<span class="built_in">queryAverage</span>(p&lt;&lt;<span class="number">1</span>,l,r);</span><br><span class="line">    <span class="keyword">if</span>(mid&lt;r) val+=<span class="built_in">queryAverage</span>(p&lt;&lt;<span class="number">1</span>|<span class="number">1</span>,l,r);</span><br><span class="line">    <span class="keyword">return</span> val;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">db <span class="title">queryVariance</span><span class="params">(<span class="type">int</span> p,<span class="type">int</span> l,<span class="type">int</span> r)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(l&lt;=Tree[p].l&amp;&amp;Tree[p].r&lt;=r) <span class="keyword">return</span> Tree[p].val2;</span><br><span class="line">    <span class="type">int</span> mid=(Tree[p].l+Tree[p].r)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">    db val=<span class="number">0</span>;</span><br><span class="line">    <span class="built_in">pushDown</span>(p);</span><br><span class="line">    <span class="keyword">if</span>(l&lt;=mid) val+=<span class="built_in">queryVariance</span>(p&lt;&lt;<span class="number">1</span>,l,r);</span><br><span class="line">    <span class="keyword">if</span>(mid&lt;r) val+=<span class="built_in">queryVariance</span>(p&lt;&lt;<span class="number">1</span>|<span class="number">1</span>,l,r);</span><br><span class="line">    <span class="keyword">return</span> val;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// freopen(&quot;segmentbit.in&quot;,&quot;r&quot;,stdin);</span></span><br><span class="line">    <span class="comment">// freopen(&quot;segmentbit.out&quot;,&quot;w&quot;,stdout);</span></span><br><span class="line">    <span class="built_in">read</span>(N,M);</span><br><span class="line">    <span class="keyword">for</span>(re <span class="type">int</span> i=<span class="number">1</span>;i&lt;=N;++i) <span class="built_in">scanf</span>(<span class="string">&quot;%lf&quot;</span>,&amp;val[i]);</span><br><span class="line">    <span class="built_in">build</span>(<span class="number">1</span>,<span class="number">1</span>,N);</span><br><span class="line">    <span class="keyword">while</span>(M--)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> op,ql,qr;</span><br><span class="line">        <span class="built_in">read</span>(op,ql,qr);</span><br><span class="line">        <span class="keyword">if</span>(op==<span class="number">1</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            db qk;</span><br><span class="line">            <span class="built_in">scanf</span>(<span class="string">&quot;%lf&quot;</span>,&amp;qk);</span><br><span class="line">            <span class="built_in">modify</span>(<span class="number">1</span>,ql,qr,qk);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(op==<span class="number">2</span>) <span class="built_in">printf</span>(<span class="string">&quot;%.4lf\n&quot;</span>,<span class="built_in">queryAverage</span>(<span class="number">1</span>,ql,qr)/(qr-ql+<span class="number">1</span>));</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            db x1=<span class="built_in">queryAverage</span>(<span class="number">1</span>,ql,qr),x2=<span class="built_in">queryVariance</span>(<span class="number">1</span>,ql,qr);</span><br><span class="line">            db res=x2+(qr-ql+<span class="number">1</span>)*(x1/(qr-ql+<span class="number">1</span>))*(x1/(qr-ql+<span class="number">1</span>))<span class="number">-2</span>*(x1/(qr-ql+<span class="number">1</span>))*x1;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;%.4lf\n&quot;</span>,res/(qr-ql+<span class="number">1</span>));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">5 5</span></span><br><span class="line"><span class="comment">1 5 4 2 3</span></span><br><span class="line"><span class="comment">2 1 4</span></span><br><span class="line"><span class="comment">3 1 5</span></span><br><span class="line"><span class="comment">1 1 1 1</span></span><br><span class="line"><span class="comment">1 2 2 -1</span></span><br><span class="line"><span class="comment">3 1 5</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure></details><h3 id="15-P4162-SCOI2009-最长距离"><a href="#15-P4162-SCOI2009-最长距离" class="headerlink" title="15.P4162 [SCOI2009]最长距离"></a>15.<a href="https://www.luogu.com.cn/problem/P4162">P4162 [SCOI2009]最长距离</a></h3><p>$date:2022.05.06$</p><p>建图，将 $nm$ 的矩阵转化为一个有 $nm$ 个点的图，$c(i,j)=(map[j]=1)?1:0$ 即可，然后每到一个点记录一次答案记为 $res=\max\{res,calc(s,k)\}$ 。</p><details>    <summary>AC Code</summary><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;ctime&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iomanip&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stack&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;map&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> gh() getchar()</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> re register</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> db double</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> ll;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN=<span class="number">31</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> INF=<span class="number">0x7f7f7f7f</span>;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    x=<span class="number">0</span>;</span><br><span class="line">    <span class="type">char</span> ch=<span class="built_in">gh</span>(),t=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(ch&lt;<span class="string">&#x27;0&#x27;</span>||ch&gt;<span class="string">&#x27;9&#x27;</span>) t|=ch==<span class="string">&#x27;-&#x27;</span>,ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">while</span>(ch&gt;=<span class="string">&#x27;0&#x27;</span>&amp;&amp;ch&lt;=<span class="string">&#x27;9&#x27;</span>) x=(x&lt;&lt;<span class="number">3</span>)+(x&lt;&lt;<span class="number">1</span>)+(ch^<span class="number">48</span>),ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">if</span>(t) x=-x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T,<span class="keyword">class</span> ...T1&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x,T1 &amp;...x1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">read</span>(x),<span class="built_in">read</span>(x1...);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">checkMax</span><span class="params">(T &amp;x,T &amp;y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x&lt;y?x=y,<span class="number">1</span>:<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">checkMin</span><span class="params">(T &amp;x,T &amp;y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x&gt;y?x=y,<span class="number">1</span>:<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> dx[]=&#123;<span class="number">0</span>,<span class="number">1</span>,<span class="number">-1</span>,<span class="number">0</span>,<span class="number">0</span>&#125;;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> dy[]=&#123;<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">-1</span>&#125;;</span><br><span class="line"><span class="type">int</span> N,M,T;</span><br><span class="line"><span class="type">char</span> Map[MAXN][MAXN];</span><br><span class="line"><span class="type">int</span> Start[MAXN*MAXN];</span><br><span class="line">db Dist[MAXN*MAXN][MAXN*MAXN],res;</span><br><span class="line"><span class="type">char</span> ch;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">getId</span><span class="params">(<span class="type">int</span> i,<span class="type">int</span> j)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (i<span class="number">-1</span>)*M+j;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> db <span class="title">calc</span><span class="params">(db x,db y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">sqrt</span>(x*x+y*y);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">edge</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> next,to,val;</span><br><span class="line">&#125;Edge[MAXN*MAXN*MAXN*MAXN&lt;&lt;<span class="number">2</span>];</span><br><span class="line"><span class="type">int</span> Head[MAXN*MAXN],Total;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">addEdge</span><span class="params">(<span class="type">int</span> u,<span class="type">int</span> v,<span class="type">int</span> w)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Edge[++Total]=(edge)&#123;Head[u],v,w&#125;;Head[u]=Total;</span><br><span class="line">    <span class="comment">// Edge[++Total]=(edge)&#123;Head[v],u,w&#125;;Head[v]=Total;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> Dir[MAXN*MAXN];</span><br><span class="line"><span class="type">bool</span> Vis[MAXN*MAXN];</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">spfa</span><span class="params">(<span class="type">int</span> s)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=N*M;++i) Dir[i]=INF,Vis[i]=<span class="number">0</span>;</span><br><span class="line">    Dir[s]=Start[s],Vis[s]=<span class="number">1</span>;</span><br><span class="line">    queue&lt;<span class="type">int</span>&gt;Q;</span><br><span class="line">    Q.<span class="built_in">push</span>(s);</span><br><span class="line">    <span class="comment">// printf(&quot;start from %d with %d\n&quot;,s,Dir[s]);</span></span><br><span class="line">    <span class="keyword">while</span>(!Q.<span class="built_in">empty</span>())</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> u=Q.<span class="built_in">front</span>();Q.<span class="built_in">pop</span>();</span><br><span class="line">        <span class="built_in">checkMax</span>(res,Dist[s][u]);</span><br><span class="line">        Vis[u]=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> e=Head[u],v;e;e=Edge[e].next)</span><br><span class="line">        &#123;</span><br><span class="line">            v=Edge[e].to;</span><br><span class="line">            <span class="comment">// printf(&quot;road from %d to %d\n&quot;,u,v);</span></span><br><span class="line">            <span class="keyword">if</span>(Dir[v]&gt;Dir[u]+Edge[e].val)</span><br><span class="line">            &#123;</span><br><span class="line">                Dir[v]=Dir[u]+Edge[e].val;</span><br><span class="line">                <span class="comment">// printf(&quot;from %d to %d spend %d\n&quot;,u,v,Dir[v]);</span></span><br><span class="line">                <span class="keyword">if</span>(!Vis[v]&amp;&amp;T&gt;=Dir[v])</span><br><span class="line">                &#123;</span><br><span class="line">                    Vis[v]=<span class="number">1</span>;</span><br><span class="line">                    Q.<span class="built_in">push</span>(v);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// freopen(&quot;min-road.in&quot;,&quot;r&quot;,stdin);</span></span><br><span class="line">    <span class="comment">// freopen(&quot;min-road.out&quot;,&quot;w&quot;,stdout);</span></span><br><span class="line">    <span class="built_in">read</span>(N,M,T);</span><br><span class="line">    <span class="keyword">for</span>(re <span class="type">int</span> i=<span class="number">1</span>;i&lt;=N;++i) <span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>,Map[i]+<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=N;++i)</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">1</span>;j&lt;=N;++j)</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> k=<span class="number">1</span>;k&lt;=M;++k)</span><br><span class="line">                <span class="keyword">for</span>(<span class="type">int</span> l=<span class="number">1</span>;l&lt;=M;++l)</span><br><span class="line">                    Dist[<span class="built_in">getId</span>(i,k)][<span class="built_in">getId</span>(j,l)]=<span class="built_in">calc</span>(i-j,k-l);</span><br><span class="line">    <span class="comment">/*for(int i=1;i&lt;=N;++i)&#123;</span></span><br><span class="line"><span class="comment">        for(int j=1;j&lt;=M;++j)</span></span><br><span class="line"><span class="comment">            printf(&quot;%d &quot;,getId(i,j));</span></span><br><span class="line"><span class="comment">        puts(&quot;&quot;);</span></span><br><span class="line"><span class="comment">    &#125;</span></span><br><span class="line"><span class="comment">    return 0;*/</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=N;++i)</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">1</span>;j&lt;=M;++j)</span><br><span class="line">        &#123;</span><br><span class="line">            Start[<span class="built_in">getId</span>(i,j)]=Map[i][j]-<span class="string">&#x27;0&#x27;</span>;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> k=<span class="number">1</span>,w;k&lt;=<span class="number">4</span>;++k)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="type">int</span> nx=i+dx[k],ny=j+dy[k];</span><br><span class="line">                <span class="keyword">if</span>(nx&lt;<span class="number">1</span>||nx&gt;N||ny&lt;<span class="number">1</span>||ny&gt;M) <span class="keyword">continue</span>;</span><br><span class="line">                w=Map[nx][ny]-<span class="string">&#x27;0&#x27;</span>;</span><br><span class="line">                <span class="built_in">addEdge</span>(<span class="built_in">getId</span>(i,j),<span class="built_in">getId</span>(nx,ny),w);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=N*M;++i) <span class="built_in">spfa</span>(i);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%.6lf&quot;</span>,res);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">3 3 0</span></span><br><span class="line"><span class="comment">001</span></span><br><span class="line"><span class="comment">001</span></span><br><span class="line"><span class="comment">110</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure></details><h3 id="16-P6870-COCI2019-2020-5-Zapina"><a href="#16-P6870-COCI2019-2020-5-Zapina" class="headerlink" title="16.P6870 [COCI2019-2020#5] Zapina"></a>16.<a href="https://www.luogu.com.cn/problem/P6870">P6870 [COCI2019-2020#5] Zapina</a></h3><p>$date:2022.05.06$</p><p>数学dp ，组合数学题。</p><p>杨辉三角求组合数： $C(n,m)=C(n-1,m)+C(n-1,m-1)$</p><p>转移方程：</p><script type="math/tex; mode=display">dp[i][j]=\left\{\begin{aligned}&C(j,i)*(i-1)^{j-i},\text{使i开心} \\&\sum\limits^{k=j}_{k=0}dp[i-1][j-k]*C(j,k),k \in [0,j],k \neq i,\text{使i不开心}\\\end{aligned}\right.</script><details>    <summary>AC Code</summary><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;ctime&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iomanip&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stack&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;map&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> gh() getchar()</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> re register</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> db double</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> ll;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN=<span class="number">351</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> Mod=<span class="number">1e9</span>+<span class="number">7</span>;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    x=<span class="number">0</span>;</span><br><span class="line">    <span class="type">char</span> ch=<span class="built_in">gh</span>(),t=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(ch&lt;<span class="string">&#x27;0&#x27;</span>||ch&gt;<span class="string">&#x27;9&#x27;</span>) t|=ch==<span class="string">&#x27;-&#x27;</span>,ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">while</span>(ch&gt;=<span class="string">&#x27;0&#x27;</span>&amp;&amp;ch&lt;=<span class="string">&#x27;9&#x27;</span>) x=(x&lt;&lt;<span class="number">3</span>)+(x&lt;&lt;<span class="number">1</span>)+(ch^<span class="number">48</span>),ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">if</span>(t) x=-x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T,<span class="keyword">class</span> ...T1&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x,T1 &amp;...x1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">read</span>(x),<span class="built_in">read</span>(x1...);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">checkMax</span><span class="params">(T &amp;x,T &amp;y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x&lt;y?x=y,<span class="number">1</span>:<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">checkMin</span><span class="params">(T &amp;x,T &amp;y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x&gt;y?x=y,<span class="number">1</span>:<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> N,dp[MAXN][MAXN],C[MAXN][MAXN];</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">quickPow</span><span class="params">(ll a,<span class="type">int</span> b)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    ll res=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span>(b)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(b&amp;<span class="number">1</span>) res=res*a%Mod;</span><br><span class="line">        a=a*a%Mod;</span><br><span class="line">        b&gt;&gt;=<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">init</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;=N;++i)</span><br><span class="line">    &#123;</span><br><span class="line">        C[i][<span class="number">0</span>]=C[i][i]=<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">1</span>;j&lt;i;++j)</span><br><span class="line">            C[i][j]=(C[i<span class="number">-1</span>][j<span class="number">-1</span>]+C[i<span class="number">-1</span>][j])%Mod;</span><br><span class="line">    &#125;</span><br><span class="line">    dp[<span class="number">1</span>][<span class="number">1</span>]=<span class="number">1</span>;</span><br><span class="line">    <span class="comment">/*for(int i=0;i&lt;=N;++i)&#123;</span></span><br><span class="line"><span class="comment">        for(int j=0;j&lt;=i;++j)</span></span><br><span class="line"><span class="comment">            printf(&quot;%d &quot;,C[i][j]);</span></span><br><span class="line"><span class="comment">        puts(&quot;&quot;);</span></span><br><span class="line"><span class="comment">    &#125;*/</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// freopen(&quot;dp.in&quot;,&quot;r&quot;,stdin);</span></span><br><span class="line">    <span class="comment">// freopen(&quot;dp.out&quot;,&quot;w&quot;,stdout);</span></span><br><span class="line">    <span class="built_in">read</span>(N);</span><br><span class="line">    <span class="built_in">init</span>();</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">2</span>;i&lt;=N;++i)</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">1</span>;j&lt;=N;++j)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span>(j&gt;=i) dp[i][j]=<span class="number">1ll</span>*C[j][i]*<span class="built_in">quickPow</span>(i<span class="number">-1</span>,j-i)%Mod;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> k=<span class="number">0</span>;k&lt;=j;++k)</span><br><span class="line">                <span class="keyword">if</span>(i!=k) dp[i][j]=(dp[i][j]+<span class="number">1ll</span>*C[j][k]*dp[i<span class="number">-1</span>][j-k])%Mod;</span><br><span class="line">        &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d&quot;</span>,dp[N][N]%Mod);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">1</span></span><br><span class="line"><span class="comment">2</span></span><br><span class="line"><span class="comment">314</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure></details><h3 id="17-CF1119B-Alyona-and-a-Narrow-Fridge"><a href="#17-CF1119B-Alyona-and-a-Narrow-Fridge" class="headerlink" title="17.CF1119B Alyona and a Narrow Fridge"></a>17.<a href="https://www.luogu.com.cn/problem/CF1119B">CF1119B Alyona and a Narrow Fridge</a></h3><p>$date:2022.05.06$</p><p>很玄学的一道题，样例看不懂，题解不明白。</p><p>more and more vegetables, what should I do?</p><p>贺过去了，二分 $+$ 贪心。</p><details>    <summary>AC Code</summary><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;ctime&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iomanip&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stack&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;map&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> gh() getchar()</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> re register</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> db double</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> ll;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN=<span class="number">1e3</span>+<span class="number">1</span>;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    x=<span class="number">0</span>;</span><br><span class="line">    <span class="type">char</span> ch=<span class="built_in">gh</span>(),t=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(ch&lt;<span class="string">&#x27;0&#x27;</span>||ch&gt;<span class="string">&#x27;9&#x27;</span>) t|=ch==<span class="string">&#x27;-&#x27;</span>,ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">while</span>(ch&gt;=<span class="string">&#x27;0&#x27;</span>&amp;&amp;ch&lt;=<span class="string">&#x27;9&#x27;</span>) x=(x&lt;&lt;<span class="number">3</span>)+(x&lt;&lt;<span class="number">1</span>)+(ch^<span class="number">48</span>),ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">if</span>(t) x=-x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T,<span class="keyword">class</span> ...T1&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x,T1 &amp;...x1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">read</span>(x),<span class="built_in">read</span>(x1...);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">checkMax</span><span class="params">(T &amp;x,T &amp;y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x&lt;y?x=y,<span class="number">1</span>:<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">checkMin</span><span class="params">(T &amp;x,T &amp;y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x&gt;y?x=y,<span class="number">1</span>:<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> H,N,hgt[MAXN];</span><br><span class="line">vector&lt;<span class="type">int</span>&gt;V;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">cmp</span><span class="params">(<span class="type">int</span> a,<span class="type">int</span> b)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> a&gt;b;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">check</span><span class="params">(<span class="type">int</span> x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    V.<span class="built_in">clear</span>();</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=x;++i) V.<span class="built_in">push_back</span>(hgt[i]);</span><br><span class="line">    <span class="built_in">sort</span>(V.<span class="built_in">begin</span>(),V.<span class="built_in">end</span>(),cmp);</span><br><span class="line">    <span class="type">int</span> maxn=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>,pos1,pos2;i&lt;V.<span class="built_in">size</span>();++i)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>((i+<span class="number">1</span>)&amp;<span class="number">1</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            pos1=maxn+V[i];</span><br><span class="line">            <span class="keyword">if</span>(pos1&gt;H) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            pos2=maxn+V[i];</span><br><span class="line">            <span class="keyword">if</span>(pos2&gt;H) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">            maxn=<span class="built_in">max</span>(pos1,pos2);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// freopen(&quot;dp?.in&quot;,&quot;r&quot;,stdin);</span></span><br><span class="line">    <span class="comment">// freopen(&quot;dp?.out&quot;,&quot;w&quot;,stdout);</span></span><br><span class="line">    <span class="built_in">read</span>(N,H);</span><br><span class="line">    <span class="keyword">for</span>(re <span class="type">int</span> i=<span class="number">1</span>;i&lt;=N;++i) <span class="built_in">read</span>(hgt[i]);</span><br><span class="line">    <span class="type">int</span> l=<span class="number">1</span>,r=N+<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span>(l&lt;r<span class="number">-1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> mid=(l+r)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span>(<span class="built_in">check</span>(mid)) l=mid;</span><br><span class="line">        <span class="keyword">else</span> r=mid;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d&quot;</span>,l);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">5 7</span></span><br><span class="line"><span class="comment">2 3 5 4 1</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure></details><h3 id="18-P7159-「dWoi-R1」Sweet-Fruit-Chocolate"><a href="#18-P7159-「dWoi-R1」Sweet-Fruit-Chocolate" class="headerlink" title="18.P7159 「dWoi R1」Sweet Fruit Chocolate"></a>18.<a href="https://www.luogu.com.cn/problem/P7159">P7159 「dWoi R1」Sweet Fruit Chocolate</a></h3><p>$date:2022.5.27$</p><p>简单的树形 dp 问题，时间复杂度 $\mathcal O(n)$</p><p>计算方程 $ans=\sum^{n}_{i=1}d_ia_i$ ，记 $d_i$ 为第 $i$ 个点到根节点的距离。</p><details>    <summary>AC Code</summary><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;ctime&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iomanip&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stack&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;map&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> gh() getchar()</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> re register</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> db double</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> ll;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN=<span class="number">1e6</span>+<span class="number">1</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> Mod=<span class="number">998244353</span>;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    x=<span class="number">0</span>;</span><br><span class="line">    <span class="type">char</span> ch=<span class="built_in">gh</span>(),t=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(ch&lt;<span class="string">&#x27;0&#x27;</span>||ch&gt;<span class="string">&#x27;9&#x27;</span>) t|=ch==<span class="string">&#x27;-&#x27;</span>,ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">while</span>(ch&gt;=<span class="string">&#x27;0&#x27;</span>&amp;&amp;ch&lt;=<span class="string">&#x27;9&#x27;</span>) x=(x&lt;&lt;<span class="number">3</span>)+(x&lt;&lt;<span class="number">1</span>)+(ch^<span class="number">48</span>),ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">if</span>(t) x=-x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T,<span class="keyword">class</span> ...T1&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x,T1 &amp;...x1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">read</span>(x),<span class="built_in">read</span>(x1...);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">checkMax</span><span class="params">(T &amp;x,T &amp;y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x&lt;y?x=y,<span class="number">1</span>:<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">checkMin</span><span class="params">(T &amp;x,T &amp;y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x&gt;y?x=y,<span class="number">1</span>:<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> N;</span><br><span class="line">ll num[MAXN],dp[MAXN],ans;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">edge</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> next,to;</span><br><span class="line">&#125;Edge[MAXN&lt;&lt;<span class="number">1</span>];</span><br><span class="line"><span class="type">int</span> Head[MAXN],Total;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">addEdge</span><span class="params">(<span class="type">int</span> u,<span class="type">int</span> v)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Edge[++Total]=(edge)&#123;Head[u],v&#125;;Head[u]=Total;</span><br><span class="line">    Edge[++Total]=(edge)&#123;Head[v],u&#125;;Head[v]=Total;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dpTree</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> last)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    dp[x]=dp[last]+<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> e=Head[x],v;e;e=Edge[e].next)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>((v=Edge[e].to)==last) <span class="keyword">continue</span>;</span><br><span class="line">        <span class="built_in">dpTree</span>(v,x);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> ll <span class="title">powFast</span><span class="params">(ll a,<span class="type">int</span> b)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    ll res=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span>(b)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(b&amp;<span class="number">1</span>) res=res*a%Mod;</span><br><span class="line">        a=a*a%Mod;</span><br><span class="line">        b&gt;&gt;=<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> res%Mod;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// freopen(&quot;tree.in&quot;,&quot;r&quot;,stdin);</span></span><br><span class="line">    <span class="comment">// freopen(&quot;tree.out&quot;,&quot;w&quot;,stdout);</span></span><br><span class="line">    <span class="built_in">read</span>(N);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=N;++i) <span class="built_in">read</span>(num[i]);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>,u,v;i&lt;N;++i)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">read</span>(u,v);</span><br><span class="line">        <span class="built_in">addEdge</span>(u,v);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">dpTree</span>(<span class="number">1</span>,<span class="number">0</span>);</span><br><span class="line">    ll Cnt=<span class="built_in">powFast</span>(<span class="number">2ll</span>,N<span class="number">-1</span>);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=N;++i)</span><br><span class="line">        ans=(ans+dp[i]*num[i])%Mod;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%lld&quot;</span>,ans*Cnt%Mod);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">3</span></span><br><span class="line"><span class="comment">1 1 2</span></span><br><span class="line"><span class="comment">1 2</span></span><br><span class="line"><span class="comment">2 3</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure></details><h3 id="19-CF747B-Mammoth’s-Genome-Decoding"><a href="#19-CF747B-Mammoth’s-Genome-Decoding" class="headerlink" title="19.CF747B Mammoth’s Genome Decoding"></a><a href="https://www.luogu.com.cn/problem/CF747B">19.CF747B Mammoth’s Genome Decoding</a></h3><p>$date:2022.5.27$</p><p>暴力，暴力，暴力。甚至懒得优化。</p><details>    <summary>AC Code</summary><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;ctime&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iomanip&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stack&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;map&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> gh() getchar()</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> re register</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> db double</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> ll;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN=<span class="number">1e4</span>+<span class="number">1</span>;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    x=<span class="number">0</span>;</span><br><span class="line">    <span class="type">char</span> ch=<span class="built_in">gh</span>(),t=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(ch&lt;<span class="string">&#x27;0&#x27;</span>||ch&gt;<span class="string">&#x27;9&#x27;</span>) t|=ch==<span class="string">&#x27;-&#x27;</span>,ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">while</span>(ch&gt;=<span class="string">&#x27;0&#x27;</span>&amp;&amp;ch&lt;=<span class="string">&#x27;9&#x27;</span>) x=(x&lt;&lt;<span class="number">3</span>)+(x&lt;&lt;<span class="number">1</span>)+(ch^<span class="number">48</span>),ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">if</span>(t) x=-x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T,<span class="keyword">class</span> ...T1&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x,T1 &amp;...x1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">read</span>(x),<span class="built_in">read</span>(x1...);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">checkMax</span><span class="params">(T &amp;x,T &amp;y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x&lt;y?x=y,<span class="number">1</span>:<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">checkMin</span><span class="params">(T &amp;x,T &amp;y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x&gt;y?x=y,<span class="number">1</span>:<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> N,num[<span class="number">5</span>];</span><br><span class="line"><span class="type">char</span> str[MAXN],res[MAXN];</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">change</span><span class="params">(<span class="type">char</span> s)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(s==<span class="string">&#x27;A&#x27;</span>) <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span>(s==<span class="string">&#x27;C&#x27;</span>) <span class="keyword">return</span> <span class="number">2</span>;</span><br><span class="line">    <span class="keyword">if</span>(s==<span class="string">&#x27;G&#x27;</span>) <span class="keyword">return</span> <span class="number">3</span>;</span><br><span class="line">    <span class="keyword">if</span>(s==<span class="string">&#x27;T&#x27;</span>) <span class="keyword">return</span> <span class="number">4</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">char</span> <span class="title">back</span><span class="params">(<span class="type">int</span> s)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(s==<span class="number">1</span>) <span class="keyword">return</span> <span class="string">&#x27;A&#x27;</span>;</span><br><span class="line">    <span class="keyword">if</span>(s==<span class="number">2</span>) <span class="keyword">return</span> <span class="string">&#x27;C&#x27;</span>;</span><br><span class="line">    <span class="keyword">if</span>(s==<span class="number">3</span>) <span class="keyword">return</span> <span class="string">&#x27;G&#x27;</span>;</span><br><span class="line">    <span class="keyword">if</span>(s==<span class="number">4</span>) <span class="keyword">return</span> <span class="string">&#x27;T&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">comMin</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> id=<span class="number">1</span>,res=<span class="number">1e9</span>;</span><br><span class="line">    <span class="keyword">if</span>(num[<span class="number">1</span>]&lt;res) res=num[<span class="number">1</span>],id=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span>(num[<span class="number">2</span>]&lt;res) res=num[<span class="number">2</span>],id=<span class="number">2</span>;</span><br><span class="line">    <span class="keyword">if</span>(num[<span class="number">3</span>]&lt;res) res=num[<span class="number">3</span>],id=<span class="number">3</span>;</span><br><span class="line">    <span class="keyword">if</span>(num[<span class="number">4</span>]&lt;res) res=num[<span class="number">4</span>],id=<span class="number">4</span>;</span><br><span class="line">    <span class="keyword">return</span> id;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// freopen(&quot;AGCT.in&quot;,&quot;r&quot;,stdin);</span></span><br><span class="line">    <span class="comment">// freopen(&quot;AGCT.out&quot;,&quot;w&quot;,stdout);</span></span><br><span class="line">    <span class="built_in">read</span>(N);</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>,str+<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=N;++i) <span class="keyword">if</span>(str[i]!=<span class="string">&#x27;?&#x27;</span>) ++num[<span class="built_in">change</span>(str[i])];</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=N;++i)</span><br><span class="line">        <span class="keyword">if</span>(str[i]==<span class="string">&#x27;?&#x27;</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="type">int</span> s=<span class="built_in">comMin</span>();</span><br><span class="line">            res[i]=<span class="built_in">back</span>(s);</span><br><span class="line">            ++num[s];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> res[i]=str[i];</span><br><span class="line">    <span class="type">int</span> numMin=<span class="built_in">min</span>(num[<span class="number">1</span>],<span class="built_in">min</span>(num[<span class="number">2</span>],<span class="built_in">min</span>(num[<span class="number">3</span>],num[<span class="number">4</span>])));</span><br><span class="line">    <span class="type">int</span> numMax=<span class="built_in">max</span>(num[<span class="number">1</span>],<span class="built_in">max</span>(num[<span class="number">2</span>],<span class="built_in">max</span>(num[<span class="number">3</span>],num[<span class="number">4</span>])));</span><br><span class="line">    <span class="keyword">if</span>(numMin!=numMax) <span class="built_in">printf</span>(<span class="string">&quot;===&quot;</span>);</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=N;++i) <span class="built_in">printf</span>(<span class="string">&quot;%c&quot;</span>,res[i]);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">8</span></span><br><span class="line"><span class="comment">AG?C??CT</span></span><br><span class="line"><span class="comment">*/</span>    </span><br></pre></td></tr></table></figure></details><h3 id="20-CF1136A-Nastya-Is-Reading-a-Book"><a href="#20-CF1136A-Nastya-Is-Reading-a-Book" class="headerlink" title="20.CF1136A Nastya Is Reading a Book"></a><a href="https://www.luogu.com.cn/problem/CF1136A">20.CF1136A Nastya Is Reading a Book</a></h3><p>$date:2022.6.16$</p><p>超级大水题。</p><details>    <summary>AC Code</summary><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;ctime&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iomanip&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stack&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;map&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> gh() getchar()</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> re register</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> db double</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> ll;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN=<span class="number">101</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXP=<span class="number">1e4</span>+<span class="number">1</span>;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    x=<span class="number">0</span>;</span><br><span class="line">    <span class="type">char</span> ch=<span class="built_in">gh</span>(),t=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(ch&lt;<span class="string">&#x27;0&#x27;</span>||ch&gt;<span class="string">&#x27;9&#x27;</span>) t|=ch==<span class="string">&#x27;-&#x27;</span>,ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">while</span>(ch&gt;=<span class="string">&#x27;0&#x27;</span>&amp;&amp;ch&lt;=<span class="string">&#x27;9&#x27;</span>) x=(x&lt;&lt;<span class="number">3</span>)+(x&lt;&lt;<span class="number">1</span>)+(ch^<span class="number">48</span>),ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">if</span>(t) x=-x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T,<span class="keyword">class</span> ...T1&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x,T1 &amp;...x1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">read</span>(x),<span class="built_in">read</span>(x1...);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">checkMax</span><span class="params">(T &amp;x,T &amp;y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x&lt;y?x=y,<span class="number">1</span>:<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">checkMin</span><span class="params">(T &amp;x,T &amp;y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x&gt;y?x=y,<span class="number">1</span>:<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> N,l[MAXN],r[MAXN],K;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// freopen(&quot;cf.in&quot;,&quot;r&quot;,stdin);</span></span><br><span class="line">    <span class="comment">// freopen(&quot;cf.out&quot;,&quot;w&quot;,stdout);</span></span><br><span class="line">    <span class="built_in">read</span>(N);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=N;++i) <span class="built_in">read</span>(l[i],r[i]);</span><br><span class="line">    <span class="built_in">read</span>(K);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=N;++i)</span><br><span class="line">        <span class="keyword">if</span>(l[i]&lt;=K&amp;&amp;K&lt;=r[i])</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;%d&quot;</span>,N-i+<span class="number">1</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure></details><h3 id="21-P3912-素数个数"><a href="#21-P3912-素数个数" class="headerlink" title="21.P3912 素数个数"></a><a href="https://www.luogu.com.cn/problem/P3912">21.P3912 素数个数</a></h3><p>$date:2022.6.16$</p><p>线性筛质数模板题。</p><details>    <summary>AC Code</summary><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;ctime&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iomanip&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stack&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;map&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> gh() getchar()</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> re register</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> db double</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> ll;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN=<span class="number">1e8</span>+<span class="number">1</span>;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    x=<span class="number">0</span>;</span><br><span class="line">    <span class="type">char</span> ch=<span class="built_in">gh</span>(),t=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(ch&lt;<span class="string">&#x27;0&#x27;</span>||ch&gt;<span class="string">&#x27;9&#x27;</span>) t|=ch==<span class="string">&#x27;-&#x27;</span>,ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">while</span>(ch&gt;=<span class="string">&#x27;0&#x27;</span>&amp;&amp;ch&lt;=<span class="string">&#x27;9&#x27;</span>) x=(x&lt;&lt;<span class="number">3</span>)+(x&lt;&lt;<span class="number">1</span>)+(ch^<span class="number">48</span>),ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">if</span>(t) x=-x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T,<span class="keyword">class</span> ...T1&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x,T1 &amp;...x1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">read</span>(x),<span class="built_in">read</span>(x1...);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">checkMax</span><span class="params">(T &amp;x,T &amp;y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x&lt;y?x=y,<span class="number">1</span>:<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">checkMin</span><span class="params">(T &amp;x,T &amp;y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x&gt;y?x=y,<span class="number">1</span>:<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> N,Total,pri[MAXN];</span><br><span class="line"><span class="type">bool</span> ok[MAXN];</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">init</span><span class="params">(<span class="type">int</span> MaxN)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">memset</span>(ok,<span class="number">1</span>,<span class="built_in">sizeof</span>(ok));</span><br><span class="line">    ok[<span class="number">1</span>]=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">2</span>;i&lt;=MaxN;++i)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(ok[i]) pri[++Total]=i;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">1</span>;j&lt;=Total&amp;&amp;i*pri[j]&lt;=MaxN;++j)</span><br><span class="line">        &#123;</span><br><span class="line">            ok[i*pri[j]]=<span class="number">0</span>;</span><br><span class="line">            <span class="keyword">if</span>(i%pri[j]==<span class="number">0</span>) <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d&quot;</span>,Total);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// freopen(&quot;xor.in&quot;,&quot;r&quot;,stdin);</span></span><br><span class="line">    <span class="comment">// freopen(&quot;xor.out&quot;,&quot;w&quot;,stdout);</span></span><br><span class="line">    <span class="built_in">read</span>(N);</span><br><span class="line">    <span class="built_in">init</span>(N);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure></details><h3 id="22-P5131-荷取融合"><a href="#22-P5131-荷取融合" class="headerlink" title="22.P5131 荷取融合"></a><a href="https://www.luogu.com.cn/problem/P5131">22.P5131 荷取融合</a></h3><p>$date:2022.6.16$</p><p>常规 dp 题。</p><p>用 $dp_{i,j}$ 表示前 $i$ 个中选了 $j$ 个的方案数，用 $g_{i,j}$ 表示相应的贡献总和。</p><p>转移方程：</p><p> $dp_{i,j}=dp_{i-1,j}+dp_{i,j-1}$</p><p>$g_{i,j}=g_{i-1,j}+g_{i,j-1}\times val_i$</p><p>最终答案：</p><p>$\frac{g_{n,k}}{f_{n,k}}$</p><p>快速幂求逆元即可。</p><details>    <summary>AC Code</summary><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;ctime&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iomanip&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stack&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;map&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> gh() getchar()</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> re register</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> db double</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> ll;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN=<span class="number">1e5</span>+<span class="number">1</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXK=<span class="number">3e2</span>+<span class="number">1</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> Mod=<span class="number">19260817</span>;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    x=<span class="number">0</span>;</span><br><span class="line">    <span class="type">char</span> ch=<span class="built_in">gh</span>(),t=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(ch&lt;<span class="string">&#x27;0&#x27;</span>||ch&gt;<span class="string">&#x27;9&#x27;</span>) t|=ch==<span class="string">&#x27;-&#x27;</span>,ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">while</span>(ch&gt;=<span class="string">&#x27;0&#x27;</span>&amp;&amp;ch&lt;=<span class="string">&#x27;9&#x27;</span>) x=(x&lt;&lt;<span class="number">3</span>)+(x&lt;&lt;<span class="number">1</span>)+(ch^<span class="number">48</span>),ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">if</span>(t) x=-x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T,<span class="keyword">class</span> ...T1&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x,T1 &amp;...x1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">read</span>(x),<span class="built_in">read</span>(x1...);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">checkMax</span><span class="params">(T &amp;x,T &amp;y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x&lt;y?x=y,<span class="number">1</span>:<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">checkMin</span><span class="params">(T &amp;x,T &amp;y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x&gt;y?x=y,<span class="number">1</span>:<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> N,K,val[MAXN],dp[<span class="number">2</span>][MAXK],g[<span class="number">2</span>][MAXK];</span><br><span class="line"><span class="type">bool</span> ok;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">qPow</span><span class="params">(<span class="type">int</span> a,<span class="type">int</span> b)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> res=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span>(b)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(b&amp;<span class="number">1</span>) res=<span class="number">1ll</span>*res*a%Mod;</span><br><span class="line">        a=<span class="number">1ll</span>*a*a%Mod;</span><br><span class="line">        b&gt;&gt;=<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// freopen(&quot;math.in&quot;,&quot;r&quot;,stdin);</span></span><br><span class="line">    <span class="comment">// freopen(&quot;math.out&quot;,&quot;w&quot;,stdout);</span></span><br><span class="line">    <span class="built_in">read</span>(N,K);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=N;++i) <span class="built_in">read</span>(val[i]);</span><br><span class="line">    dp[!ok][<span class="number">0</span>]=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=N;++i)</span><br><span class="line">    &#123;</span><br><span class="line">        dp[ok][<span class="number">0</span>]=<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">1</span>;j&lt;=K;++j) dp[ok][j]=(dp[!ok][j]+dp[ok][j<span class="number">-1</span>])%Mod;</span><br><span class="line">        g[ok][<span class="number">0</span>]=<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">1</span>;j&lt;=K;++j) g[ok][j]=(<span class="number">1ll</span>*g[!ok][j]+<span class="number">1ll</span>*g[ok][j<span class="number">-1</span>]*val[i])%Mod;</span><br><span class="line">        ok^=<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d&quot;</span>,<span class="number">1ll</span>*g[!ok][K]*<span class="built_in">qPow</span>(dp[!ok][K],Mod<span class="number">-2</span>)%Mod);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">3 2</span></span><br><span class="line"><span class="comment">3 1 2</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure></details><h3 id="23-P5997-PA2014-Pakowanie"><a href="#23-P5997-PA2014-Pakowanie" class="headerlink" title="23.P5997 [PA2014]Pakowanie"></a><a href="https://www.luogu.com.cn/problem/P5997">23.P5997 [PA2014]Pakowanie</a></h3><p>$date:2022.6.16$</p><p>状压 dp 题，贺过去的。不太能理解，看题解，或者自己做吧。</p><details>    <summary>AC Code</summary><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;ctime&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iomanip&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stack&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;map&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> gh() getchar()</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> re register</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> db double</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> ll;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN=<span class="number">25</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXS=(<span class="number">1</span>&lt;&lt;<span class="number">25</span>)+<span class="number">1</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXM=<span class="number">101</span>;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    x=<span class="number">0</span>;</span><br><span class="line">    <span class="type">char</span> ch=<span class="built_in">gh</span>(),t=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(ch&lt;<span class="string">&#x27;0&#x27;</span>||ch&gt;<span class="string">&#x27;9&#x27;</span>) t|=ch==<span class="string">&#x27;-&#x27;</span>,ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">while</span>(ch&gt;=<span class="string">&#x27;0&#x27;</span>&amp;&amp;ch&lt;=<span class="string">&#x27;9&#x27;</span>) x=(x&lt;&lt;<span class="number">3</span>)+(x&lt;&lt;<span class="number">1</span>)+(ch^<span class="number">48</span>),ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">if</span>(t) x=-x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T,<span class="keyword">class</span> ...T1&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x,T1 &amp;...x1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">read</span>(x),<span class="built_in">read</span>(x1...);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">checkMax</span><span class="params">(T &amp;x,T &amp;y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x&lt;y?x=y,<span class="number">1</span>:<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">checkMin</span><span class="params">(T &amp;x,T &amp;y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x&gt;y?x=y,<span class="number">1</span>:<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> N,M,dp[MAXS],dw[MAXS];</span><br><span class="line"><span class="type">int</span> wgt[MAXN],cpy[MAXM];</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">cmp</span><span class="params">(<span class="type">int</span> a,<span class="type">int</span> b)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> a&gt;b;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// freopen(&quot;bag?.in&quot;,&quot;r&quot;,stdin);</span></span><br><span class="line">    <span class="comment">// freopen(&quot;bag?.out&quot;,&quot;w&quot;,stdout);</span></span><br><span class="line">    <span class="built_in">read</span>(N,M);</span><br><span class="line">    <span class="keyword">for</span>(re <span class="type">int</span> i=<span class="number">1</span>;i&lt;=N;++i) <span class="built_in">read</span>(wgt[i]);</span><br><span class="line">    <span class="keyword">for</span>(re <span class="type">int</span> i=<span class="number">1</span>;i&lt;=M;++i) <span class="built_in">read</span>(cpy[i]);</span><br><span class="line">    <span class="built_in">sort</span>(cpy+<span class="number">1</span>,cpy+<span class="number">1</span>+M,cmp);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;(<span class="number">1</span>&lt;&lt;N);++i) dp[i]=M+<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> s=<span class="number">0</span>;s&lt;(<span class="number">1</span>&lt;&lt;N);++s)</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">1</span>;j&lt;=N;++j)</span><br><span class="line">            <span class="keyword">if</span>(s&amp;(<span class="number">1</span>&lt;&lt;(j<span class="number">-1</span>)))</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="type">int</span> up=s^(<span class="number">1</span>&lt;&lt;(j<span class="number">-1</span>));</span><br><span class="line">                <span class="keyword">if</span>(dw[up]&gt;=wgt[j])</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="keyword">if</span>(dp[s]&gt;dp[up]||(dp[s]==dp[up]&amp;&amp;dw[up]-wgt[j]&gt;dw[s]))</span><br><span class="line">                    &#123;</span><br><span class="line">                        dp[s]=dp[up];</span><br><span class="line">                        dw[s]=dw[up]-wgt[j];</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">if</span>(cpy[dp[up]+<span class="number">1</span>]&gt;=wgt[j])</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="keyword">if</span>(dp[s]&gt;dp[up]+<span class="number">1</span>||(dp[s]==dp[up]+<span class="number">1</span>&amp;&amp;cpy[dp[up]+<span class="number">1</span>]-wgt[j]&gt;dw[s]))</span><br><span class="line">                    &#123;</span><br><span class="line">                        dp[s]=dp[up]+<span class="number">1</span>;</span><br><span class="line">                        dw[s]=cpy[dp[up]+<span class="number">1</span>]-wgt[j];</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">    <span class="keyword">if</span>(dp[(<span class="number">1</span>&lt;&lt;N)<span class="number">-1</span>]&gt;=M+<span class="number">1</span>) <span class="built_in">printf</span>(<span class="string">&quot;NIE&quot;</span>);</span><br><span class="line">    <span class="keyword">else</span> <span class="built_in">printf</span>(<span class="string">&quot;%d&quot;</span>,dp[(<span class="number">1</span>&lt;&lt;N)<span class="number">-1</span>]);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure></details><h3 id="24-CF1512E-Permutation-by-Sum"><a href="#24-CF1512E-Permutation-by-Sum" class="headerlink" title="24.CF1512E Permutation by Sum"></a><a href="https://www.luogu.com.cn/problem/CF1512E">24.CF1512E Permutation by Sum</a></h3><p>$date:2022.6.16$</p><p>一道思路很简单的题，转化为，给定两个数 $s,k$ 求构造一个数列 $\sum\limits^{s}_{i=1}a_i=k,\forall i,j,a_i \neq a_j$ 即可。</p><p>重点在于如何构造，亲测暴力构造会爆，所以使用贪心。详情查看题解。</p><details>    <summary>AC Code</summary><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;ctime&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iomanip&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stack&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;map&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> gh() getchar()</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> re register</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> db double</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> ll;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN=<span class="number">501</span>;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    x=<span class="number">0</span>;</span><br><span class="line">    <span class="type">char</span> ch=<span class="built_in">gh</span>(),t=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(ch&lt;<span class="string">&#x27;0&#x27;</span>||ch&gt;<span class="string">&#x27;9&#x27;</span>) t|=ch==<span class="string">&#x27;-&#x27;</span>,ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">while</span>(ch&gt;=<span class="string">&#x27;0&#x27;</span>&amp;&amp;ch&lt;=<span class="string">&#x27;9&#x27;</span>) x=(x&lt;&lt;<span class="number">3</span>)+(x&lt;&lt;<span class="number">1</span>)+(ch^<span class="number">48</span>),ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">if</span>(t) x=-x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T,<span class="keyword">class</span> ...T1&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x,T1 &amp;...x1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">read</span>(x),<span class="built_in">read</span>(x1...);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">checkMax</span><span class="params">(T &amp;x,T &amp;y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x&lt;y?x=y,<span class="number">1</span>:<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">checkMin</span><span class="params">(T &amp;x,T &amp;y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x&gt;y?x=y,<span class="number">1</span>:<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> Test,N,Ql,Qr,Qsum;</span><br><span class="line"><span class="type">int</span> Max[MAXN],Min[MAXN],pos,path[MAXN];</span><br><span class="line"><span class="type">bool</span> vis[MAXN],flag;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// freopen(&quot;sum.in&quot;,&quot;r&quot;,stdin);</span></span><br><span class="line">    <span class="comment">// freopen(&quot;sum.out&quot;,&quot;w&quot;,stdout);</span></span><br><span class="line">    <span class="built_in">read</span>(Test);</span><br><span class="line">    <span class="keyword">while</span>(Test--)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">read</span>(N,Ql,Qr,Qsum);</span><br><span class="line">        <span class="built_in">memset</span>(vis,<span class="number">0</span>,<span class="built_in">sizeof</span>(vis));</span><br><span class="line">        <span class="type">int</span> left=Qr-Ql+<span class="number">1</span>,l=Ql;</span><br><span class="line">        <span class="comment">// printf(&quot;%d %d\n&quot;,((Qr-Ql+1)*(Qr-Ql+2)/2),((Qr-Ql+1)*(N+N+Ql-Qr)/2));</span></span><br><span class="line">        Max[<span class="number">0</span>]=Min[<span class="number">0</span>]=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=N;++i)</span><br><span class="line">        &#123;</span><br><span class="line">            Min[i]=(i+<span class="number">1</span>)*i/<span class="number">2</span>;</span><br><span class="line">            Max[i]=(N+N-i+<span class="number">1</span>)*i/<span class="number">2</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=N;++i) vis[i]=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=N;++i)</span><br><span class="line">            <span class="keyword">if</span>(Qsum-i&gt;=Min[left<span class="number">-1</span>]&amp;&amp;Qsum-i&lt;=Max[left<span class="number">-1</span>])</span><br><span class="line">            &#123;</span><br><span class="line">                path[l++]=i;--left;</span><br><span class="line">                Qsum-=i;vis[i]=<span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        <span class="keyword">if</span>(l!=Qr+<span class="number">1</span>) <span class="built_in">printf</span>(<span class="string">&quot;-1\n&quot;</span>);</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="type">int</span> End=<span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=N;++i)</span><br><span class="line">                <span class="keyword">if</span>(!vis[i])</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="keyword">if</span>(End==Ql<span class="number">-1</span>) End=Qr;</span><br><span class="line">                    path[++End]=i;</span><br><span class="line">                &#125;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=N;++i) <span class="built_in">printf</span>(<span class="string">&quot;%d &quot;</span>,path[i]);</span><br><span class="line">            <span class="built_in">puts</span>(<span class="string">&quot;&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">sum=(a1+an)n/2</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">n-(qr-ql) ... n</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure></details><h3 id="25-P5017-NOIP2018-普及组-摆渡车"><a href="#25-P5017-NOIP2018-普及组-摆渡车" class="headerlink" title="25.P5017 [NOIP2018 普及组] 摆渡车"></a><a href="https://www.luogu.com.cn/problem/P5017">25.P5017 [NOIP2018 普及组] 摆渡车</a></h3><p>$date:2022.6.16$</p><p>一道其实很早以前就像做了，但是因为实力和时间的原因一直在咕。</p><p>斜率优化的经典题之一。</p><p>记 $dp_{i}$ 表示第 $i$ 刻时间的最小等待时间，$cnt_i$ 为第 $i$ 刻时间的人数，$sum_i$ 表示来到的时间和。</p><p>斜率式：</p><p>$dp_j+sum_j=i\times cnt_j+(dp_i-cnt_i\times i+sum_i)$</p><p>即可。</p><p>可惜琢磨了半天什么都没有想出来，然后又贺了。</p><details>    <summary>AC Code</summary><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;ctime&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iomanip&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stack&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;map&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> gh() getchar()</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> re register</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> db double</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> ll;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN=<span class="number">501</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXT=<span class="number">4e6</span>+<span class="number">1</span>;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    x=<span class="number">0</span>;</span><br><span class="line">    <span class="type">char</span> ch=<span class="built_in">gh</span>(),t=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(ch&lt;<span class="string">&#x27;0&#x27;</span>||ch&gt;<span class="string">&#x27;9&#x27;</span>) t|=ch==<span class="string">&#x27;-&#x27;</span>,ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">while</span>(ch&gt;=<span class="string">&#x27;0&#x27;</span>&amp;&amp;ch&lt;=<span class="string">&#x27;9&#x27;</span>) x=(x&lt;&lt;<span class="number">3</span>)+(x&lt;&lt;<span class="number">1</span>)+(ch^<span class="number">48</span>),ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">if</span>(t) x=-x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T,<span class="keyword">class</span> ...T1&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x,T1 &amp;...x1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">read</span>(x),<span class="built_in">read</span>(x1...);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">checkMax</span><span class="params">(T &amp;x,T &amp;y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x&lt;y?x=y,<span class="number">1</span>:<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">checkMin</span><span class="params">(T &amp;x,T &amp;y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x&gt;y?x=y,<span class="number">1</span>:<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> N,M,T,waiting_Time;</span><br><span class="line"><span class="type">int</span> dp[MAXT],cnt[MAXT],sum[MAXT];</span><br><span class="line"><span class="type">int</span> Que[MAXT&lt;&lt;<span class="number">1</span>];</span><br><span class="line"><span class="function"><span class="keyword">inline</span> db <span class="title">slope</span><span class="params">(<span class="type">int</span> i,<span class="type">int</span> j)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (db)(dp[j]+sum[j]-dp[i]-sum[i])/(cnt[i]==cnt[j]?<span class="number">1e-9</span>:cnt[j]-cnt[i]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// freopen(&quot;slope.in&quot;,&quot;r&quot;,stdin);</span></span><br><span class="line">    <span class="comment">// freopen(&quot;slope.out&quot;,&quot;w&quot;,stdout);</span></span><br><span class="line">    <span class="built_in">read</span>(N,M);</span><br><span class="line">    <span class="keyword">for</span>(re <span class="type">int</span> i=<span class="number">1</span>;i&lt;=N;++i)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">read</span>(waiting_Time);T=<span class="built_in">max</span>(T,waiting_Time);</span><br><span class="line">        ++cnt[waiting_Time],sum[waiting_Time]+=waiting_Time;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;T+M;++i) cnt[i]+=cnt[i<span class="number">-1</span>],sum[i]+=sum[i<span class="number">-1</span>];</span><br><span class="line">    <span class="type">int</span> head=<span class="number">1</span>,tail=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;T+M;++i)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(i-M&gt;=<span class="number">0</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">while</span>(head&lt;tail&amp;&amp;<span class="built_in">slope</span>(Que[tail<span class="number">-1</span>],Que[tail])&gt;=<span class="built_in">slope</span>(Que[tail],i-M)) --tail;</span><br><span class="line">            Que[++tail]=i-M;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">while</span>(head&lt;tail&amp;&amp;<span class="built_in">slope</span>(Que[head],Que[head+<span class="number">1</span>])&lt;=i) ++head;</span><br><span class="line">        <span class="type">int</span> j=Que[head];</span><br><span class="line">        dp[i]=cnt[i]*i-sum[i];</span><br><span class="line">        <span class="keyword">if</span>(head&lt;=tail)</span><br><span class="line">            dp[i]=<span class="built_in">min</span>(dp[i],dp[j]+(cnt[i]-cnt[j])*i-(sum[i]-sum[j]));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> ans=<span class="number">1e9</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=T;i&lt;T+M;++i) ans=<span class="built_in">min</span>(ans,dp[i]);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d&quot;</span>,ans);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">5 5 </span></span><br><span class="line"><span class="comment">11 13 1 5 5 </span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure></details><h3 id="26-CF987C-Three-displays"><a href="#26-CF987C-Three-displays" class="headerlink" title="26.CF987C Three displays"></a><a href="https://www.luogu.com.cn/problem/CF987C">26.CF987C Three displays</a></h3><p>线段树优化dp ，<del>因为数据过水不需要优化。</del></p><p>暴力 dp 时间复杂度 $\mathcal O(n^2)$ 勉强能过，优化后复杂度 $\mathcal O(n\log n)$ ，Live 巨佬应该会打，也可以看题解，我只会暴力。</p><p>记着不要把题看错了，也不要完全相信翻译，适量读读原文。</p><details>    <summary>暴力AC Code</summary><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;ctime&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iomanip&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stack&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;map&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> gh() getchar()</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> re register</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> db double</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> ll;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN=<span class="number">3e3</span>+<span class="number">1</span>;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    x=<span class="number">0</span>;</span><br><span class="line">    <span class="type">char</span> ch=<span class="built_in">gh</span>(),t=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(ch&lt;<span class="string">&#x27;0&#x27;</span>||ch&gt;<span class="string">&#x27;9&#x27;</span>) t|=ch==<span class="string">&#x27;-&#x27;</span>,ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">while</span>(ch&gt;=<span class="string">&#x27;0&#x27;</span>&amp;&amp;ch&lt;=<span class="string">&#x27;9&#x27;</span>) x=(x&lt;&lt;<span class="number">3</span>)+(x&lt;&lt;<span class="number">1</span>)+(ch^<span class="number">48</span>),ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">if</span>(t) x=-x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T,<span class="keyword">class</span> ...T1&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x,T1 &amp;...x1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">read</span>(x),<span class="built_in">read</span>(x1...);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">checkMax</span><span class="params">(T &amp;x,T &amp;y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x&lt;y?x=y,<span class="number">1</span>:<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">checkMin</span><span class="params">(T &amp;x,T &amp;y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x&gt;y?x=y,<span class="number">1</span>:<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> N,Min1=<span class="number">1e9</span>,Min2=<span class="number">1e9</span>,Min3=<span class="number">1e9</span>;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Display</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> s,c;</span><br><span class="line">&#125;Num[MAXN];</span><br><span class="line"><span class="type">int</span> dp[MAXN][<span class="number">4</span>];</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// freopen(&quot;math.in&quot;,&quot;r&quot;,stdin);</span></span><br><span class="line">    <span class="comment">// freopen(&quot;math.out&quot;,&quot;w&quot;,stdout);</span></span><br><span class="line">    <span class="built_in">read</span>(N);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=N;++i) <span class="built_in">read</span>(Num[i].s);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=N;++i) <span class="built_in">read</span>(Num[i].c);</span><br><span class="line">    <span class="built_in">memset</span>(dp,<span class="number">0x3f</span>,<span class="built_in">sizeof</span>(dp));</span><br><span class="line">    dp[<span class="number">0</span>][<span class="number">0</span>]=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=N;++i)</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">1</span>;j&lt;=<span class="number">3</span>;++j)</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> k=<span class="number">0</span>;k&lt;i;++k)</span><br><span class="line">                <span class="keyword">if</span>(Num[i].s&gt;Num[k].s)</span><br><span class="line">                    dp[i][j]=<span class="built_in">min</span>(dp[i][j],dp[k][j<span class="number">-1</span>]+Num[i].c);</span><br><span class="line">    <span class="keyword">if</span>(dp[N][<span class="number">3</span>]==<span class="number">1061109567</span>) <span class="built_in">printf</span>(<span class="string">&quot;-1&quot;</span>);</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> ans=<span class="number">1e9</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">3</span>;i&lt;=N;++i) <span class="built_in">checkMin</span>(ans,dp[i][<span class="number">3</span>]);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d&quot;</span>,ans);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">5</span></span><br><span class="line"><span class="comment">2 4 5 4 10</span></span><br><span class="line"><span class="comment">40 30 20 10 40</span></span><br><span class="line"><span class="comment">10</span></span><br><span class="line"><span class="comment">1 2 3 4 5 6 7 8 9 10</span></span><br><span class="line"><span class="comment">10 13 11 14 15 12 13 13 18 13</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure></details>]]></content>
      
      
      <categories>
          
          <category> 题解 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 数论 </tag>
            
            <tag> 质数 </tag>
            
            <tag> DP </tag>
            
            <tag> 区间dp </tag>
            
            <tag> 优化 </tag>
            
            <tag> RMQ </tag>
            
            <tag> 位运算 </tag>
            
            <tag> String </tag>
            
            <tag> 字符串 </tag>
            
            <tag> 数位dp </tag>
            
            <tag> 最短路 </tag>
            
            <tag> 图论 </tag>
            
            <tag> 搜索 </tag>
            
            <tag> 队列 </tag>
            
            <tag> bfs </tag>
            
            <tag> dfs </tag>
            
            <tag> 贪心 </tag>
            
            <tag> 平衡树 </tag>
            
            <tag> 枚举，暴力 </tag>
            
            <tag> 数据结构 </tag>
            
            <tag> SPFA </tag>
            
            <tag> 进制 </tag>
            
            <tag> Floyd </tag>
            
            <tag> 离散化 </tag>
            
            <tag> 状压dp </tag>
            
            <tag> 状态压缩 </tag>
            
            <tag> 二分 </tag>
            
            <tag> 线段树 </tag>
            
            <tag> 树状数组 </tag>
            
            <tag> 建图 </tag>
            
            <tag> 组合数学 </tag>
            
            <tag> 树型结构 </tag>
            
            <tag> 逆元 </tag>
            
            <tag> 快速幂 </tag>
            
            <tag> 构造 </tag>
            
            <tag> 斜率优化 </tag>
            
            <tag> 线段树优化dp </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>kmp字符串匹配算法</title>
      <link href="/Eternity/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/OI/kmp/"/>
      <url>/Eternity/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/OI/kmp/</url>
      
        <content type="html"><![CDATA[<p>“强大的并不是你在顺境中能多么快的前进，而是你能多快在逆流中找回你自己”</p><span id="more"></span><p>俗称 $KMP$ 算法，用法是在一个字符串 $A$ 中快速地找到一个子串 $B$ 的出现情况。是<strong>AC自动机</strong>的组成部分之一。</p><p>对于引言，你是否有想法呢？</p><p>对于一个字符串，如果当我们匹配失败，我们是否需要重新开始匹配，还是说，我们能够仅仅往前一点，然后从这一个位置再次比配。对于 $KMP$ 而言，我们有一个定义称为<strong>失配数组</strong>。是对于该点如果没有匹配成功而跳回的位置，一般记作 <code>nxt[]</code> 或者 <code>kmp[]</code> 。看个人喜好。</p><h2 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h2><h3 id="预处理"><a href="#预处理" class="headerlink" title="预处理"></a>预处理</h3><p>我们需要遍历子串 $B$ 以记录失配数组的失配情况。如果该点无法匹配，则从该点以 <code>j=nxt[j]</code> 往前跳，直到可以再次匹配为止。然后以这样的顺序处理出失配数组。</p><p>KMP 的实现是调整 $j$ 的位置（减小 $j$ 值）并使 $j$ 尽量大，使得 $A[i-j+1…i]$ 与 $B[1…j]$ 保持匹配且尝试匹配 $A[i+1]$ 和 $B[j+1]$ 。</p><h3 id="匹配"><a href="#匹配" class="headerlink" title="匹配"></a>匹配</h3><p>遍历字符串 $A$ ，定义一个指针记为 $j$ 表示当前已经匹配到了第 $j$ 位。如果 $a[i] \neq b[j]$ ，则往前失配，直到再次匹配为止，如果 <code>j=len(b)</code> ，则证明我们已经匹配到了一个完整的子串 $B$ 。之后的操作就根据题目而定了。</p><h2 id="例题"><a href="#例题" class="headerlink" title="例题"></a>例题</h2><h3 id="【模板】kmp"><a href="#【模板】kmp" class="headerlink" title="【模板】kmp"></a><a href="https://www.luogu.com.cn/problem/P3375">【模板】kmp</a></h3><p>按上述实现即可，可能不太清楚，所以接下来给出代码。</p><p>这是没有改码风之前的代码，凑合着看吧。</p><details>    <summary>AC Code</summary><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;ctime&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iomanip&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stack&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;map&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">using</span> std::cin;</span><br><span class="line"><span class="keyword">using</span> std::cout;</span><br><span class="line"><span class="type">char</span> stra[<span class="number">10000001</span>],strb[<span class="number">10000001</span>];</span><br><span class="line"><span class="type">int</span> Kmp[<span class="number">10000001</span>],N,M,j;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="comment">//freopen(&quot;.in&quot;,&quot;r&quot;,stdin);</span></span><br><span class="line"><span class="comment">//freopen(&quot;.out&quot;,&quot;w&quot;,stdout);</span></span><br><span class="line">cin&gt;&gt;(stra+<span class="number">1</span>)&gt;&gt;(strb+<span class="number">1</span>);</span><br><span class="line">    Kmp[<span class="number">1</span>]=<span class="number">0</span>;</span><br><span class="line">    N=<span class="built_in">strlen</span>(strb+<span class="number">1</span>);</span><br><span class="line">    M=<span class="built_in">strlen</span>(stra+<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">2</span>;i&lt;=N;++i)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">while</span>(j&amp;&amp;strb[i]!=strb[j+<span class="number">1</span>])</span><br><span class="line">        &#123;</span><br><span class="line">            j=Kmp[j];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(strb[i]==strb[j+<span class="number">1</span>])</span><br><span class="line">        &#123;</span><br><span class="line">            ++j;</span><br><span class="line">        &#125;</span><br><span class="line">        Kmp[i]=j;</span><br><span class="line">    &#125;</span><br><span class="line">    j=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=M;++i)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">while</span>(j&amp;&amp;strb[j+<span class="number">1</span>]!=stra[i])</span><br><span class="line">        &#123;</span><br><span class="line">            j=Kmp[j];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(stra[i]==strb[j+<span class="number">1</span>])</span><br><span class="line">        &#123;</span><br><span class="line">            ++j;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(j==N)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,i-N+<span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=N;++i)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d &quot;</span>,Kmp[i]);</span><br><span class="line">    &#125;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">ABABABC</span></span><br><span class="line"><span class="comment">ABA</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure></details><h3 id="HNOI2008-GT考试"><a href="#HNOI2008-GT考试" class="headerlink" title="[HNOI2008]GT考试"></a><a href="https://www.luogu.com.cn/problem/P3193">[HNOI2008]GT考试</a></h3><p>一道比较难的 $kmp$ 题，因为 $kmp$ 的思路其实与 $dp$ 差不多，所以一般而言两者是连在一起考的。用 <code>f[i][j]</code> 表示对于 $i$ 位数匹配到 $j$ 位的答案数，似乎有点像数位dp。预处理出 <code>a[i][j]</code> 表示从 <code>f[x][i]</code> 转移到 <code>f[x+1][j]</code> 的可能数。</p><p>那么转移方程则是 $dp_{i,j}=\sum\limits^{m-1}_{k=0}dp_{i-1,k}*a_{k,j}$ 即可。则答案便是 $\sum\limits_{i=0}^{m-1}dp_{n,i}$ 。但这样的话，时间复杂度是 $O(nm^2)$ ，对于这道题而言只能得到 $40pt$ 。</p><p><a href="https://violeteternal.github.io/Eternity/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/matrix/">前置芝士：矩阵快速幂</a></p><p>将 $dp_{i,j}$ 记作矩阵 $DP_{i}$ ，$DP_{i}$ 的第一层就是 $dp_{i,j}$ 转移方程变成了 $DP_{i}=DP_{i-1}*G$ 然后求 $DP_n$ 即可。</p><details>    <summary>AC Code</summary><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;ctime&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iomanip&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stack&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;map&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> gh() getchar()</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> underMax(x,y) ((x)&gt;(y)?(x):(y))</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> underMin(x,y) ((x)&lt;(y)?(x):(y))</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> ll;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN=<span class="number">21</span>;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">underRead</span><span class="params">(T &amp;x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    x=<span class="number">0</span>;</span><br><span class="line">    <span class="type">char</span> ch=<span class="built_in">gh</span>(),t=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(ch&lt;<span class="string">&#x27;0&#x27;</span>||ch&gt;<span class="string">&#x27;9&#x27;</span>) t|=ch==<span class="string">&#x27;-&#x27;</span>,ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">while</span>(ch&gt;=<span class="string">&#x27;0&#x27;</span>&amp;&amp;ch&lt;=<span class="string">&#x27;9&#x27;</span>) x=(x&lt;&lt;<span class="number">3</span>)+(x&lt;&lt;<span class="number">1</span>)+(ch^<span class="number">48</span>),ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">if</span>(t) x=-x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> N,M,K;</span><br><span class="line"><span class="type">int</span> f[MAXN][MAXN];        <span class="comment">//f(i,j)表示所有长度为i，且不包含M串</span></span><br><span class="line">                        <span class="comment">//且该串的末尾部分和S串当前匹配的最大长度为j</span></span><br><span class="line">                        <span class="comment">//的所有字符串的集合。</span></span><br><span class="line"><span class="type">char</span> str[MAXN];</span><br><span class="line"><span class="type">int</span> Kmp[MAXN];</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">underExpr</span><span class="params">(<span class="type">int</span> c[][MAXN],<span class="type">int</span> a[][MAXN],<span class="type">int</span> b[][MAXN])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">static</span> <span class="type">int</span> t[MAXN][MAXN];</span><br><span class="line">    <span class="built_in">memset</span>(t,<span class="number">0</span>,<span class="built_in">sizeof</span>(t));</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;M;++i)</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">0</span>;j&lt;M;++j)</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> k=<span class="number">0</span>;k&lt;M;++k)</span><br><span class="line">                t[i][j]=(t[i][j]+a[i][k]*b[k][j])%K;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;M;++i)</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">0</span>;j&lt;M;++j)</span><br><span class="line">            c[i][j]=t[i][j];</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">underQuickPow</span><span class="params">(<span class="type">int</span> k)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> f0[MAXN][MAXN]=&#123;<span class="number">1</span>&#125;;</span><br><span class="line">    <span class="keyword">while</span>(k)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(k&amp;<span class="number">1</span>) <span class="built_in">underExpr</span>(f0,f0,f);</span><br><span class="line">        <span class="built_in">underExpr</span>(f,f,f);</span><br><span class="line">        k&gt;&gt;=<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> res=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;M;++i) res=(res+f0[<span class="number">0</span>][i])%K;</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// freopen(&quot;GTtest.in&quot;,&quot;r&quot;,stdin);</span></span><br><span class="line">    <span class="comment">// freopen(&quot;GTtest.out&quot;,&quot;w&quot;,stdout);</span></span><br><span class="line">    <span class="built_in">underRead</span>(N),<span class="built_in">underRead</span>(M),<span class="built_in">underRead</span>(K);</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>,str+<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">2</span>,j=<span class="number">0</span>;i&lt;=M;++i)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">while</span>(j&amp;&amp;str[j+<span class="number">1</span>]!=str[i]) j=Kmp[j];</span><br><span class="line">        <span class="keyword">if</span>(str[j+<span class="number">1</span>]==str[i])++j;</span><br><span class="line">        Kmp[i]=j;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//初始化f</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">0</span>;j&lt;M;++j)</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> c=<span class="string">&#x27;0&#x27;</span>;c&lt;=<span class="string">&#x27;9&#x27;</span>;++c)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="type">int</span> k=j;</span><br><span class="line">            <span class="keyword">while</span>(k&amp;&amp;str[k+<span class="number">1</span>]!=c) k=Kmp[k];</span><br><span class="line">            <span class="keyword">if</span>(str[k+<span class="number">1</span>]==c) ++k;</span><br><span class="line">            <span class="keyword">if</span>(k&lt;M) ++f[j][k];</span><br><span class="line">        &#125;</span><br><span class="line">    <span class="comment">//f(n)=f(0)+A^N</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d&quot;</span>,<span class="built_in">underQuickPow</span>(N));</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">4 3 100</span></span><br><span class="line"><span class="comment">111</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure></details>]]></content>
      
      
      <categories>
          
          <category> 学习笔记 </category>
          
          <category> OI </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 优化 </tag>
            
            <tag> String </tag>
            
            <tag> 字符串 </tag>
            
            <tag> 搜索 </tag>
            
            <tag> Kmp </tag>
            
            <tag> 前缀数组 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>状态压缩dp</title>
      <link href="/Eternity/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/OI/dp-state-compression/"/>
      <url>/Eternity/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/OI/dp-state-compression/</url>
      
        <content type="html"><![CDATA[<p>“每天一遍，MLE再见。”</p><span id="more"></span><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>对于一类题而言，如果用 $dp$ 来做的话，会有 $m$ 个状态，而作为我们来讲，我们不可能去开一个数组 $dp[2][2][2][2][2][2][2]…[2]$ 来记录，因为空间是动态的。所以我们考虑将这 $m$ 个状态压缩成一个 $m$ 位的二进制数。存储为一位，则空间复杂度与时间复杂度都是 $O(2^m)$ 的话，枚举 $[0,2^m-1]$ ，而对于这个二进制数，它的第 $k$ 位为 $1$ 则满足第 $k$ 个条件，判断语句为 <code>if(i&gt;&gt;k&amp;1)</code> 即可。</p><p>这种题可实行的范围一般都不超过 $10 \sim 20$ ，所以很容易识别。</p><h2 id="例题"><a href="#例题" class="headerlink" title="例题"></a>例题</h2><h3 id="Acwing91-最短Hamilton路径"><a href="#Acwing91-最短Hamilton路径" class="headerlink" title="Acwing91.最短Hamilton路径"></a><a href="https://www.acwing.com/problem/content/93/">Acwing91.最短Hamilton路径</a></h3><p>最经典的状压题，我们用一个长度为 $n$ 的二进制数来存储，第 $k$ 位为 $0$ ，则表示第 $k$ 个点还没有到达；反之，则表示第 $k$ 个点已经到达。然后遍历即可，时间复杂度 $O(2^nn^2)$ 。</p><details>    <summary>查看代码</summary><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;ctime&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iomanip&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stack&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;map&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> gh() getchar()</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> re register</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> db double</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> ll;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN=<span class="number">21</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXS=<span class="number">1</span>&lt;&lt;<span class="number">21</span>;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    x=<span class="number">0</span>;</span><br><span class="line">    <span class="type">char</span> ch=<span class="built_in">gh</span>(),t=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(ch&lt;<span class="string">&#x27;0&#x27;</span>||ch&gt;<span class="string">&#x27;9&#x27;</span>) t|=ch==<span class="string">&#x27;-&#x27;</span>,ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">while</span>(ch&gt;=<span class="string">&#x27;0&#x27;</span>&amp;&amp;ch&lt;=<span class="string">&#x27;9&#x27;</span>) x=(x&lt;&lt;<span class="number">3</span>)+(x&lt;&lt;<span class="number">1</span>)+(ch^<span class="number">48</span>),ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">if</span>(t) x=-x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> n;</span><br><span class="line"><span class="type">int</span> val[MAXN][MAXN],dp[MAXS][MAXN];</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// freopen(&quot;dp-state-compression.in&quot;,&quot;r&quot;,stdin);</span></span><br><span class="line">    <span class="comment">// freopen(&quot;dp-state-compression.out&quot;,&quot;w&quot;,stdout);</span></span><br><span class="line">    <span class="built_in">read</span>(n);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;n;++i)</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">0</span>;j&lt;n;++j)</span><br><span class="line">            <span class="built_in">read</span>(val[i][j]);</span><br><span class="line">    <span class="built_in">memset</span>(dp,<span class="number">0x3f</span>,<span class="built_in">sizeof</span>(dp));</span><br><span class="line">    dp[<span class="number">1</span>][<span class="number">0</span>]=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;(<span class="number">1</span>&lt;&lt;n);++i)</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">0</span>;j&lt;n;++j)</span><br><span class="line">            <span class="keyword">if</span>(i&gt;&gt;j&amp;<span class="number">1</span>)</span><br><span class="line">                <span class="keyword">for</span>(<span class="type">int</span> k=<span class="number">0</span>;k&lt;n;++k)</span><br><span class="line">                    <span class="keyword">if</span>(i&gt;&gt;k&amp;<span class="number">1</span>)</span><br><span class="line">                        dp[i][j]=<span class="built_in">min</span>(dp[i][j],dp[i-(<span class="number">1</span>&lt;&lt;j)][k]+val[k][j]);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d&quot;</span>,dp[(<span class="number">1</span>&lt;&lt;n)<span class="number">-1</span>][n<span class="number">-1</span>]);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">5</span></span><br><span class="line"><span class="comment">0 2 4 5 1</span></span><br><span class="line"><span class="comment">2 0 6 5 3</span></span><br><span class="line"><span class="comment">4 6 0 8 3</span></span><br><span class="line"><span class="comment">5 5 8 0 5</span></span><br><span class="line"><span class="comment">1 3 3 5 0</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure></details><hr><h3 id="P1896-SCOI2005-互不侵犯"><a href="#P1896-SCOI2005-互不侵犯" class="headerlink" title="P1896 [SCOI2005]互不侵犯"></a><a href="https://www.luogu.com.cn/problem/P1896">P1896 [SCOI2005]互不侵犯</a></h3><p>也是一道较为经典的状压dp题，考虑当前行与上一行的状态，满足：</p><ul><li>没有相邻的 $1$ </li><li>$s_{line}\&amp;s_{line-1}=0$</li></ul><p>即可。</p><details>    <summary>AC Code</summary><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;ctime&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iomanip&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stack&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;map&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> gh() getchar()</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> re register</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> db double</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> ll;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXS=(<span class="number">1</span>&lt;&lt;<span class="number">10</span>)<span class="number">-1</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN=<span class="number">10</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXK=<span class="number">101</span>;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    x=<span class="number">0</span>;</span><br><span class="line">    <span class="type">char</span> ch=<span class="built_in">gh</span>(),t=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(ch&lt;<span class="string">&#x27;0&#x27;</span>||ch&gt;<span class="string">&#x27;9&#x27;</span>) t|=ch==<span class="string">&#x27;-&#x27;</span>,ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">while</span>(ch&gt;=<span class="string">&#x27;0&#x27;</span>&amp;&amp;ch&lt;=<span class="string">&#x27;9&#x27;</span>) x=(x&lt;&lt;<span class="number">3</span>)+(x&lt;&lt;<span class="number">1</span>)+(ch^<span class="number">48</span>),ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">if</span>(t) x=-x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">checkMax</span><span class="params">(T &amp;x,T &amp;y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x&lt;y?x=y,<span class="number">1</span>:<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">checkMin</span><span class="params">(T &amp;x,T &amp;y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x&gt;y?x=y,<span class="number">1</span>:<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> N,K,Total;</span><br><span class="line">ll dp[MAXK][MAXN][MAXS],ok[MAXS],cnt[MAXS];</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">init</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> s=<span class="number">0</span>;s&lt;(<span class="number">1</span>&lt;&lt;N);++s)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> o=s,c=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span>(o)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span>(o&amp;<span class="number">1</span>) ++c;</span><br><span class="line">            o&gt;&gt;=<span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        cnt[s]=c;</span><br><span class="line">        <span class="keyword">if</span>(!(((s&lt;&lt;<span class="number">1</span>)|(s&gt;&gt;<span class="number">1</span>))&amp;s)) ok[++Total]=s;</span><br><span class="line">    &#125;</span><br><span class="line">    dp[<span class="number">0</span>][<span class="number">0</span>][<span class="number">0</span>]=<span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// freopen(&quot;dp-compression.in&quot;,&quot;r&quot;,stdin);</span></span><br><span class="line">    <span class="comment">// freopen(&quot;dp-compression.out&quot;,&quot;w&quot;,stdout);</span></span><br><span class="line">    <span class="built_in">read</span>(N),<span class="built_in">read</span>(K);</span><br><span class="line">    <span class="built_in">init</span>();</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> line=<span class="number">1</span>;line&lt;=N;++line)</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> l=<span class="number">1</span>;l&lt;=Total;++l)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="type">int</span> sl=ok[l];</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> r=<span class="number">1</span>;r&lt;=Total;++r)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="type">int</span> sr=ok[r];</span><br><span class="line">                <span class="keyword">if</span>(!((sr|(sr&lt;&lt;<span class="number">1</span>)|(sr&gt;&gt;<span class="number">1</span>))&amp;sl))</span><br><span class="line">                    <span class="keyword">for</span>(<span class="type">int</span> k=<span class="number">0</span>;k&lt;=K;++k)</span><br><span class="line">                        <span class="keyword">if</span>(k-cnt[sl]&gt;=<span class="number">0</span>)</span><br><span class="line">                            dp[k][line][sl]+=dp[k-cnt[sl]][line<span class="number">-1</span>][sr];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    ll ans=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=Total;++i) ans+=dp[K][N][ok[i]];</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%lld&quot;</span>,ans);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">3 2</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure></details><hr><h3 id="P2704-NOI2001-炮兵阵地"><a href="#P2704-NOI2001-炮兵阵地" class="headerlink" title="P2704 [NOI2001] 炮兵阵地"></a><a href="https://www.luogu.com.cn/problem/P2704">P2704 [NOI2001] 炮兵阵地</a></h3><p>这便是一道比较进阶的状压dp题了。因为对于一排而言，我们需要记录前两行的信息才能对该行的信息进行转移。所以需要维护前两行的状态，用 $dp[i][j][k]$ 表示第 $i$ 行的状态是 $j$ 并且 $i-1$ 行的状态是 $k$ 的答案总数。并对 $i-2$ 进行转移。</p><p>但是，这样的时间复杂度是 $2^{3m}n$ ，根本不够。所以，我们需要预处理出对于每一行而言的可行方案，直接在可行方案里计算即可。</p><p>然而，空间复杂度 $O(2^{2m}n)$ ，又超出了空间限制，所以我们可以像背包那样使用滚动数组。</p><details>    <summary>查看代码</summary><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;ctime&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iomanip&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stack&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;map&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> gh() getchar()</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> re register</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> db double</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> popcount(x) __builtin_popcount(x)</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> ll;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN=<span class="number">101</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXM=<span class="number">11</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXS=<span class="number">1</span>&lt;&lt;<span class="number">10</span>|<span class="number">10</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> INF=<span class="number">0x7f7f7f7f</span>;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    x=<span class="number">0</span>;</span><br><span class="line">    <span class="type">char</span> ch=<span class="built_in">gh</span>(),t=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(ch&lt;<span class="string">&#x27;0&#x27;</span>||ch&gt;<span class="string">&#x27;9&#x27;</span>) t|=ch==<span class="string">&#x27;-&#x27;</span>,ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">while</span>(ch&gt;=<span class="string">&#x27;0&#x27;</span>&amp;&amp;ch&lt;=<span class="string">&#x27;9&#x27;</span>) x=(x&lt;&lt;<span class="number">3</span>)+(x&lt;&lt;<span class="number">1</span>)+(ch^<span class="number">48</span>),ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">if</span>(t) x=-x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> n,m,id[MAXS],sz;</span><br><span class="line"><span class="type">int</span> dp[<span class="number">2</span>][MAXS][MAXS];</span><br><span class="line"><span class="type">bool</span> valid[MAXN][MAXM];</span><br><span class="line">vector&lt;<span class="type">int</span>&gt;V,okV[MAXS][MAXS];</span><br><span class="line"><span class="type">char</span> op[MAXM+<span class="number">5</span>];</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">init</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> s=<span class="number">0</span>;s&lt;(<span class="number">1</span>&lt;&lt;m);++s)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">bool</span> flag=<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">0</span>;j&lt;m<span class="number">-1</span>&amp;&amp;flag;++j)</span><br><span class="line">            <span class="keyword">if</span>(s&gt;&gt;j&amp;<span class="number">1</span>) flag=!(s&gt;&gt;(j+<span class="number">1</span>)&amp;<span class="number">1</span>)&amp;&amp;!(s&gt;&gt;(j+<span class="number">2</span>)&amp;<span class="number">1</span>);</span><br><span class="line">        <span class="keyword">if</span>(flag) id[s]=V.<span class="built_in">size</span>(),V.<span class="built_in">push_back</span>(s);</span><br><span class="line">    &#125;</span><br><span class="line">    sz=V.<span class="built_in">size</span>();      <span class="comment">//V[0,sz-1] is valid</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;sz;++i)</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">0</span>;j&lt;sz;++j)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span>(V[i]&amp;V[j]) <span class="keyword">continue</span>;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> k=<span class="number">0</span>;k&lt;sz;++k)</span><br><span class="line">                <span class="keyword">if</span>(!(V[i]&amp;V[k])&amp;&amp;!(V[j]&amp;V[k])) okV[i][j].<span class="built_in">push_back</span>(k);</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">check</span><span class="params">(<span class="type">int</span> op,<span class="type">int</span> s)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;m;++i)</span><br><span class="line">        <span class="keyword">if</span>((s&gt;&gt;i&amp;<span class="number">1</span>)&amp;&amp;!valid[op][i]) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// freopen(&quot;dp-sp.in&quot;,&quot;r&quot;,stdin);</span></span><br><span class="line">    <span class="comment">// freopen(&quot;dp-sp.out&quot;,&quot;w&quot;,stdout);</span></span><br><span class="line">    <span class="built_in">read</span>(n),<span class="built_in">read</span>(m);</span><br><span class="line">    <span class="built_in">init</span>();</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;++i)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>,op);</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">0</span>;j&lt;m;++j) valid[i][j]=op[j]==<span class="string">&#x27;P&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/*memset(dp[0],-63,sizeof(dp[0]));*/</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">0</span>;j&lt;sz;++j)</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> k=<span class="number">0</span>;k&lt;sz;++k)</span><br><span class="line">            dp[<span class="number">0</span>][j][k]=-INF;</span><br><span class="line">    dp[<span class="number">0</span>][<span class="number">0</span>][<span class="number">0</span>]=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;++i)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">/*memset(dp[i&amp;1],0,sizeof(dp[i&amp;1]));*/</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">0</span>;j&lt;sz;++j)</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> k=<span class="number">0</span>;k&lt;sz;++k)</span><br><span class="line">                dp[i&amp;<span class="number">1</span>][j][k]=-INF;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">0</span>;j&lt;sz;++j)</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> k=<span class="number">0</span>;k&lt;sz;++k)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">if</span>(dp[(i<span class="number">-1</span>)&amp;<span class="number">1</span>][j][k]==-INF) <span class="keyword">continue</span>;</span><br><span class="line">                <span class="keyword">for</span>(<span class="type">int</span> nxt:okV[j][k])</span><br><span class="line">                    <span class="keyword">if</span>(<span class="built_in">check</span>(i,V[nxt])) dp[i&amp;<span class="number">1</span>][nxt][j]=<span class="built_in">max</span>(dp[i&amp;<span class="number">1</span>][nxt][j],dp[(i<span class="number">-1</span>)&amp;<span class="number">1</span>][j][k]+<span class="built_in">popcount</span>(V[nxt]));</span><br><span class="line">            &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> res=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">0</span>;j&lt;sz;++j)</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> k=<span class="number">0</span>;k&lt;sz;++k)</span><br><span class="line">        res=<span class="built_in">max</span>(res,dp[n&amp;<span class="number">1</span>][j][k]);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d&quot;</span>,res);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">5 4</span></span><br><span class="line"><span class="comment">PHPP</span></span><br><span class="line"><span class="comment">PPHH</span></span><br><span class="line"><span class="comment">PPPP</span></span><br><span class="line"><span class="comment">PHPP</span></span><br><span class="line"><span class="comment">PHHP</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure></details><hr><h3 id="P3959-宝藏"><a href="#P3959-宝藏" class="headerlink" title="P3959 宝藏"></a>P3959 宝藏</h3><p>求一个图的最小权生成树，这里的最小权关系到其生成高度。</p><p>定义状态为 $dp[i][s]$ 表示当前生成树的高度为 $i$ ，且点集状态为 $s $ 的情况。每一次转移 $s$ 的子集 $T$ 以及 $s$ 与 $T$ 相异的部分。</p><p>判断子集的方法： <code>T=(T-1)&amp;s</code> 。</p><p>转移为：</p><p>$dp[i][s]=\min\{dp[i-1][T]+temp\times j\}$</p><details>    <summary>AC Code</summary><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;ctime&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iomanip&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stack&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;map&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> gh() getchar()</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> re register</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> ll;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN=<span class="number">15</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXM=<span class="number">5e3</span>+<span class="number">1</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXS=<span class="number">1</span>&lt;&lt;MAXN;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> INF=<span class="number">0x3f3f3f3f</span>;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    x=<span class="number">0</span>;</span><br><span class="line">    <span class="type">char</span> ch=<span class="built_in">gh</span>(),t=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(ch&lt;<span class="string">&#x27;0&#x27;</span>||ch&gt;<span class="string">&#x27;9&#x27;</span>) t|=ch==<span class="string">&#x27;-&#x27;</span>,ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">while</span>(ch&gt;=<span class="string">&#x27;0&#x27;</span>&amp;&amp;ch&lt;=<span class="string">&#x27;9&#x27;</span>) x=(x&lt;&lt;<span class="number">3</span>)+(x&lt;&lt;<span class="number">1</span>)+(ch^<span class="number">48</span>),ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">if</span>(t) x=-x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T,<span class="keyword">class</span> ...T1&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x,T1 &amp;...x1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">read</span>(x),<span class="built_in">read</span>(x1...);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">checkMax</span><span class="params">(T &amp;x,T &amp;y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x&lt;y?x=y,<span class="number">1</span>:<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">checkMin</span><span class="params">(T &amp;x,T &amp;y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x&gt;y?x=y,<span class="number">1</span>:<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> N,M;</span><br><span class="line">ll dp[MAXN][MAXS],w,ans=INF;</span><br><span class="line">ll Path[MAXN][MAXN],Dist[MAXS];</span><br><span class="line"><span class="comment">/*struct G</span></span><br><span class="line"><span class="comment">&#123;</span></span><br><span class="line"><span class="comment">    int next,to;</span></span><br><span class="line"><span class="comment">    ll val;</span></span><br><span class="line"><span class="comment">    G(int n=0,int t=0,ll v=0):next(n),to(t),val(v)&#123;&#125;</span></span><br><span class="line"><span class="comment">&#125;Edge[MAXM&lt;&lt;1];</span></span><br><span class="line"><span class="comment">int Head[MAXN],Total;</span></span><br><span class="line"><span class="comment">int Path[MAXN][MAXN];</span></span><br><span class="line"><span class="comment">bool Vis[MAXN];</span></span><br><span class="line"><span class="comment">inline void addEdge(int u,int v,ll w)</span></span><br><span class="line"><span class="comment">&#123;</span></span><br><span class="line"><span class="comment">    Edge[++Total]=G(Head[u],v,w);Head[u]=Total;</span></span><br><span class="line"><span class="comment">    Edge[++Total]=G(Head[v],u,w);Head[v]=Total;</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment">inline void Init()</span></span><br><span class="line"><span class="comment">&#123;</span></span><br><span class="line"><span class="comment">    queue&lt;int&gt;Q;</span></span><br><span class="line"><span class="comment">    for(int s=0;s&lt;N;++s)</span></span><br><span class="line"><span class="comment">    &#123;</span></span><br><span class="line"><span class="comment">        memset(Vis,0,sizeof(Vis));</span></span><br><span class="line"><span class="comment">        for(int i=0;i&lt;N;++i) Path[s][i]=INF;</span></span><br><span class="line"><span class="comment">        Path[s][s]=1;Vis[s]=1;</span></span><br><span class="line"><span class="comment">        Q.push(s);</span></span><br><span class="line"><span class="comment">        while(!Q.empty())</span></span><br><span class="line"><span class="comment">        &#123;</span></span><br><span class="line"><span class="comment">            int u=Q.front();Q.pop();</span></span><br><span class="line"><span class="comment">            Vis[u]=0;</span></span><br><span class="line"><span class="comment">            for(int e=Head[u];e;e=Edge[e].next)</span></span><br><span class="line"><span class="comment">            &#123;</span></span><br><span class="line"><span class="comment">                int v=Edge[e].to;</span></span><br><span class="line"><span class="comment">                if(Path[s][v]&gt;Path[s][u]+1)</span></span><br><span class="line"><span class="comment">                &#123;</span></span><br><span class="line"><span class="comment">                    Path[s][v]=Path[s][u]+1;</span></span><br><span class="line"><span class="comment">                    if(!Vis[v]) Q.push(v);</span></span><br><span class="line"><span class="comment">                &#125;</span></span><br><span class="line"><span class="comment">            &#125;</span></span><br><span class="line"><span class="comment">        &#125;</span></span><br><span class="line"><span class="comment">        while(!Q.empty()) Q.pop();</span></span><br><span class="line"><span class="comment">    &#125;</span></span><br><span class="line"><span class="comment">&#125;*/</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// freopen(&quot;dp-compressin.in&quot;,&quot;r&quot;,stdin);</span></span><br><span class="line">    <span class="comment">// freopen(&quot;dp-compressin.out&quot;,&quot;w&quot;,stdout);</span></span><br><span class="line">    <span class="built_in">read</span>(N,M);</span><br><span class="line">    <span class="built_in">memset</span>(Path,<span class="number">0x3f</span>,<span class="built_in">sizeof</span>(Path));</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>,u,v;i&lt;=M;++i)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">read</span>(u,v,w);</span><br><span class="line">        --u,--v;</span><br><span class="line">        Path[u][v]=Path[v][u]=<span class="built_in">min</span>(Path[u][v],w);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">memset</span>(dp,<span class="number">0x3f</span>,<span class="built_in">sizeof</span>(dp));</span><br><span class="line">    <span class="type">int</span> S=(<span class="number">1</span>&lt;&lt;N)<span class="number">-1</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> s=<span class="number">1</span>;s&lt;=S;++s)</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;N;++i)</span><br><span class="line">            <span class="keyword">if</span>((<span class="number">1</span>&lt;&lt;i)|s==s)</span><br><span class="line">            &#123;</span><br><span class="line">                Path[i][i]=<span class="number">0</span>;</span><br><span class="line">                <span class="keyword">for</span>(<span class="type">int</span> k=<span class="number">0</span>;k&lt;N;++k)</span><br><span class="line">                    <span class="keyword">if</span>(Path[i][k]!=INF) Dist[s]|=(<span class="number">1</span>&lt;&lt;k);</span><br><span class="line">            &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;N;++i) dp[<span class="number">0</span>][<span class="number">1</span>&lt;&lt;i]=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> s=<span class="number">2</span>;s&lt;=S;++s)</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> T=s<span class="number">-1</span>;T;T=(T<span class="number">-1</span>)&amp;s)</span><br><span class="line">            <span class="keyword">if</span>((Dist[T]|s)==Dist[T])</span><br><span class="line">            &#123;</span><br><span class="line">                ll res=<span class="number">0</span>;</span><br><span class="line">                <span class="type">int</span> sf=T^s;</span><br><span class="line">                <span class="keyword">for</span>(<span class="type">int</span> k=<span class="number">0</span>;k&lt;N;++k)</span><br><span class="line">                    <span class="keyword">if</span>((<span class="number">1</span>&lt;&lt;k)&amp;sf)</span><br><span class="line">                    &#123;</span><br><span class="line">                        ll temp=INF;</span><br><span class="line">                        <span class="keyword">for</span>(<span class="type">int</span> l=<span class="number">0</span>;l&lt;N;++l)</span><br><span class="line">                            <span class="keyword">if</span>((<span class="number">1</span>&lt;&lt;l)&amp;T) <span class="built_in">checkMin</span>(temp,Path[l][k]);</span><br><span class="line">                        res+=temp;</span><br><span class="line">                    &#125;</span><br><span class="line">                <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">1</span>;j&lt;N;++j)</span><br><span class="line">                    <span class="keyword">if</span>(dp[j<span class="number">-1</span>][T]!=INF)</span><br><span class="line">                        dp[j][s]=<span class="built_in">min</span>(dp[j][s],dp[j<span class="number">-1</span>][T]+res*j);</span><br><span class="line">            &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;N;++i) <span class="built_in">checkMin</span>(ans,dp[i][S]);</span><br><span class="line">    <span class="comment">/*for(int i=1,u,v;i&lt;=M;++i)</span></span><br><span class="line"><span class="comment">    &#123;</span></span><br><span class="line"><span class="comment">        read(u,v,w);</span></span><br><span class="line"><span class="comment">        addEdge(u-1,v-1,w);</span></span><br><span class="line"><span class="comment">    &#125;</span></span><br><span class="line"><span class="comment">    Init();</span></span><br><span class="line"><span class="comment">    for(int start=0;start&lt;N;++start)</span></span><br><span class="line"><span class="comment">    &#123;</span></span><br><span class="line"><span class="comment">        ll res=INF;</span></span><br><span class="line"><span class="comment">        for(int s=0;s&lt;(1&lt;&lt;N);++s)</span></span><br><span class="line"><span class="comment">            for(int i=0;i&lt;N;++i)</span></span><br><span class="line"><span class="comment">                dp[start][s]=INF;</span></span><br><span class="line"><span class="comment">        dp[start][1&lt;&lt;start]=0;</span></span><br><span class="line"><span class="comment">        for(int s=0;s&lt;(1&lt;&lt;N);++s)</span></span><br><span class="line"><span class="comment">            for(int st=0;st&lt;N;++st)</span></span><br><span class="line"><span class="comment">                if((s&gt;&gt;st)&amp;1)</span></span><br><span class="line"><span class="comment">                    for(int e=Head[st],v;e;e=Edge[e].next)</span></span><br><span class="line"><span class="comment">                        if((s&gt;&gt;(v=Edge[e].to))&amp;1)</span></span><br><span class="line"><span class="comment">                            dp[start][s]=min(dp[start][s],dp[start][s-(1&lt;&lt;v)]+Edge[e].val*Path[start][st]);</span></span><br><span class="line"><span class="comment">        checkMin(ans,dp[start][(1&lt;&lt;N)-1]);</span></span><br><span class="line"><span class="comment">    &#125;*/</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%lld&quot;</span>,ans);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">4 5 </span></span><br><span class="line"><span class="comment">1 2 1 </span></span><br><span class="line"><span class="comment">1 3 3 </span></span><br><span class="line"><span class="comment">1 4 1 </span></span><br><span class="line"><span class="comment">2 3 4 </span></span><br><span class="line"><span class="comment">3 4 1 </span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure></details><hr><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>其实，状态压缩并不仅限于使用在dp内，很多地方都能用到。方便，但十分难调（机房某巨佬所言）。算是dp一环中比较难的一类了。（之后还会有四边形不等式和斜率优化）</p>]]></content>
      
      
      <categories>
          
          <category> 学习笔记 </category>
          
          <category> OI </category>
          
      </categories>
      
      
        <tags>
            
            <tag> DP </tag>
            
            <tag> 优化 </tag>
            
            <tag> 状压dp </tag>
            
            <tag> 状态压缩 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>树型dp</title>
      <link href="/Eternity/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/OI/dp-tree/"/>
      <url>/Eternity/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/OI/dp-tree/</url>
      
        <content type="html"><![CDATA[<p>“父承子业。”</p><span id="more"></span><p>简单来说就是在一棵树上进行 $dp$ 操作。一般是从子节点转移到父节点。初始化为叶节点。</p><p>其可扩展性十分高。所以没有固定模板而言。但一般实现方式如下：</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">dp</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> last)</span><span class="comment">//当前节点以及其父节点</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    dp[x]=<span class="comment">/*something*/</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> e=Head[x],v;e;e=Edge[e].next)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>((v=Edge[e].to)==last) <span class="keyword">continue</span>;<span class="comment">//不可回溯</span></span><br><span class="line">        <span class="built_in">dp</span>(v,x);</span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">        some Codes;</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line">&#125;</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    some Code;</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">dp</span>(Rt,<span class="number">-1</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="基本操作"><a href="#基本操作" class="headerlink" title="基本操作"></a>基本操作</h2><h3 id="求树的直径"><a href="#求树的直径" class="headerlink" title="求树的直径"></a>求树的直径</h3><p>两种方法</p><ol><li>两遍 $bfs$ 或 $dfs$ 。第一次从任意点开始，找到该点能到达的最远距离，第二次从找到的点出发，再次找最远点。这两点就是树的直径。复杂度 $O(2n)$ 。</li><li>考虑树型 $dp$ 。时间复杂度 $O(n)$ 。</li></ol><p>第一种方法不必多述，而对于第二种方法：我们用 $dp_{k,x},k \in \{0,1\},x \in n$ 来记录该点所能到达其子树的最远距离和次远距离。</p><h2 id="例题"><a href="#例题" class="headerlink" title="例题"></a>例题</h2><h3 id="P3047-USACO12FEB-Nearby-Cows-G"><a href="#P3047-USACO12FEB-Nearby-Cows-G" class="headerlink" title="P3047 [USACO12FEB]Nearby Cows G"></a><a href="https://www.luogu.com.cn/problem/P3047">P3047 [USACO12FEB]Nearby Cows G</a></h3><p>对于一个点 $x$ ，与它相距不超过 $k$ 的点有两种情况：</p><ul><li>在 $x$ 的儿子之中。</li><li>在 $x$ 之上（或其父节点的另一棵子树）</li></ul><p>那么我们进行两次遍历，第一次查找每一个点向下查找能找到的点权值，记为 <code>dp[0][x][k]</code> ，第二次查找父节点满足条件的点权值，将两次计算相加即可。需要进行容斥。</p><details>    <summary>AC Code</summary><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;ctime&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iomanip&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stack&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;map&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> gh() getchar()</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> re register</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> ll;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN=<span class="number">1e5</span>+<span class="number">1</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXK=<span class="number">21</span>;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    x=<span class="number">0</span>;</span><br><span class="line">    <span class="type">char</span> ch=<span class="built_in">gh</span>(),t=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(ch&lt;<span class="string">&#x27;0&#x27;</span>||ch&gt;<span class="string">&#x27;9&#x27;</span>) t|=ch==<span class="string">&#x27;-&#x27;</span>,ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">while</span>(ch&gt;=<span class="string">&#x27;0&#x27;</span>&amp;&amp;ch&lt;=<span class="string">&#x27;9&#x27;</span>) x=(x&lt;&lt;<span class="number">3</span>)+(x&lt;&lt;<span class="number">1</span>)+(ch^<span class="number">48</span>),ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">if</span>(t) x=-x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> N,K,Val[MAXN];</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Tree</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> next,to;</span><br><span class="line">&#125;Edge[MAXN&lt;&lt;<span class="number">1</span>];</span><br><span class="line"><span class="type">int</span> Head[MAXN],Total;</span><br><span class="line"><span class="type">int</span> dp[<span class="number">2</span>][MAXN][MAXK];</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">addEdge</span><span class="params">(<span class="type">int</span> u,<span class="type">int</span> v)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Edge[++Total]=(Tree)&#123;Head[u],v&#125;;Head[u]=Total;</span><br><span class="line">    Edge[++Total]=(Tree)&#123;Head[v],u&#125;;Head[v]=Total;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dfs</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> last)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;=K;++i) dp[<span class="number">0</span>][x][i]=Val[x];</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> e=Head[x],v;e;e=Edge[e].next)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>((v=Edge[e].to)==last) <span class="keyword">continue</span>;</span><br><span class="line">        <span class="built_in">dfs</span>(v,x);</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=K;++i) dp[<span class="number">0</span>][x][i]+=dp[<span class="number">0</span>][v][i<span class="number">-1</span>];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dfsSec</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> last)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> e=Head[x],v;e;e=Edge[e].next)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>((v=Edge[e].to)==last) <span class="keyword">continue</span>;</span><br><span class="line">        dp[<span class="number">1</span>][v][<span class="number">1</span>]+=dp[<span class="number">0</span>][x][<span class="number">0</span>];</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">2</span>;i&lt;=K;++i) dp[<span class="number">1</span>][v][i]+=dp[<span class="number">1</span>][x][i<span class="number">-1</span>]-dp[<span class="number">0</span>][v][i<span class="number">-2</span>];</span><br><span class="line">        <span class="built_in">dfsSec</span>(v,x);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// freopen(&quot;tredp.in&quot;,&quot;r&quot;,stdin);</span></span><br><span class="line">    <span class="comment">// freopen(&quot;tredp.out&quot;,&quot;w&quot;,stdout);</span></span><br><span class="line">    <span class="built_in">read</span>(N),<span class="built_in">read</span>(K);</span><br><span class="line">    <span class="keyword">for</span>(re <span class="type">int</span> i=<span class="number">1</span>;i&lt;N;++i)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> u,v;</span><br><span class="line">        <span class="built_in">read</span>(u),<span class="built_in">read</span>(v);</span><br><span class="line">        <span class="built_in">addEdge</span>(u,v);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(re <span class="type">int</span> i=<span class="number">1</span>;i&lt;=N;++i) <span class="built_in">read</span>(Val[i]);</span><br><span class="line">    <span class="built_in">dfs</span>(<span class="number">1</span>,<span class="number">-1</span>);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=N;++i)</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">0</span>;j&lt;=K;++j)</span><br><span class="line">            dp[<span class="number">1</span>][i][j]=dp[<span class="number">0</span>][i][j];</span><br><span class="line">    <span class="built_in">dfsSec</span>(<span class="number">1</span>,<span class="number">-1</span>);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=N;++i) <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,dp[<span class="number">1</span>][i][K]);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">6 2 </span></span><br><span class="line"><span class="comment">5 1 </span></span><br><span class="line"><span class="comment">3 6 </span></span><br><span class="line"><span class="comment">2 4 </span></span><br><span class="line"><span class="comment">2 1 </span></span><br><span class="line"><span class="comment">3 2 </span></span><br><span class="line"><span class="comment">1 </span></span><br><span class="line"><span class="comment">2 </span></span><br><span class="line"><span class="comment">3 </span></span><br><span class="line"><span class="comment">4 </span></span><br><span class="line"><span class="comment">5 </span></span><br><span class="line"><span class="comment">6 </span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure></details><h3 id="P7103-「C-E-L-U-01」族谱树"><a href="#P7103-「C-E-L-U-01」族谱树" class="headerlink" title="P7103 「C.E.L.U-01」族谱树"></a><a href="https://www.luogu.com.cn/problem/P7103">P7103 「C.E.L.U-01」族谱树</a></h3><p>这道题其实并不是一道纯粹树型 $dp$ 。直接用 $Tarjan$ 求所有深度的 $lca$ 即可。复杂度 $O(n+q)$ 。据说 $O(n \log n)$ 会被卡。不清楚。</p><details>    <summary>AC Code</summary><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;ctime&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iomanip&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stack&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;map&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> gh() getchar()</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> re register</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> ll;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN=<span class="number">5e6</span>+<span class="number">1</span>;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    x=<span class="number">0</span>;</span><br><span class="line">    <span class="type">char</span> ch=<span class="built_in">gh</span>(),t=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(ch&lt;<span class="string">&#x27;0&#x27;</span>||ch&gt;<span class="string">&#x27;9&#x27;</span>) t|=ch==<span class="string">&#x27;-&#x27;</span>,ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">while</span>(ch&gt;=<span class="string">&#x27;0&#x27;</span>&amp;&amp;ch&lt;=<span class="string">&#x27;9&#x27;</span>) x=(x&lt;&lt;<span class="number">3</span>)+(x&lt;&lt;<span class="number">1</span>)+(ch^<span class="number">48</span>),ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">if</span>(t) x=-x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> N,M,K[MAXN],Q;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Tree</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> next,to;</span><br><span class="line">&#125;Edge[MAXN&lt;&lt;<span class="number">1</span>];</span><br><span class="line"><span class="type">int</span> Head[MAXN],Total;</span><br><span class="line"><span class="type">int</span> f[MAXN],dep[MAXN];</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">addEdge</span><span class="params">(<span class="type">int</span> u,<span class="type">int</span> v)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Edge[++Total]=(Tree)&#123;Head[u],v&#125;;Head[u]=Total;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">find</span><span class="params">(<span class="type">int</span> x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(x==f[x]) <span class="keyword">return</span> x;</span><br><span class="line">    <span class="keyword">return</span> f[x]=<span class="built_in">find</span>(f[x]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dpTree</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> last)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    dep[x]=dep[last]+<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> e=Head[x];e;e=Edge[e].next) <span class="built_in">dpTree</span>(Edge[e].to,x),f[Edge[e].to]=x;</span><br><span class="line">    K[dep[x]]=K[dep[x]]?<span class="built_in">find</span>(K[dep[x]]):x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// freopen(&quot;tredp.in&quot;,&quot;r&quot;,stdin);</span></span><br><span class="line">    <span class="comment">// freopen(&quot;tredp.out&quot;,&quot;w&quot;,stdout);</span></span><br><span class="line">    <span class="built_in">read</span>(N),<span class="built_in">read</span>(M);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>,fa;i&lt;=N;++i)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">read</span>(fa);f[i]=i;</span><br><span class="line">        <span class="built_in">addEdge</span>(fa,i);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">dpTree</span>(<span class="number">1</span>,<span class="number">-1</span>);</span><br><span class="line">    <span class="keyword">while</span>(M--)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">read</span>(Q);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,K[Q]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">8 3</span></span><br><span class="line"><span class="comment">0 1 1 2 2 3 4 5</span></span><br><span class="line"><span class="comment">2</span></span><br><span class="line"><span class="comment">1</span></span><br><span class="line"><span class="comment">4</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure></details><h3 id="Loj-10155-「一本通-5-2-例-3」数字转换"><a href="#Loj-10155-「一本通-5-2-例-3」数字转换" class="headerlink" title="Loj#10155. 「一本通 5.2 例 3」数字转换"></a><a href="https://loj.ac/p/10155">Loj#10155. 「一本通 5.2 例 3」数字转换</a></h3><p>这题我还比较喜欢。不看标签我是绝对不会想到用树型 $dp$ 来解的。我们记数 $i$ 的约数和为 $f(i)$ 。而当 $f(i) \leq i$ 时，可以互相转换。如果将每一个数都看作一个节点，则我们连一条边 $c(i,f(i))$ 。然后对于这一个无向图。求出其直径即可。而对于线性求约数和。读者可以自行思考如何实现复杂度 $O(n \log n)$，或者看代码。</p><details>    <summary>AC Code</summary><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;ctime&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iomanip&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stack&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;map&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> gh() getchar()</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> re register</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> ll;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN=<span class="number">1e6</span>+<span class="number">1</span>;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    x=<span class="number">0</span>;</span><br><span class="line">    <span class="type">char</span> ch=<span class="built_in">gh</span>(),t=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(ch&lt;<span class="string">&#x27;0&#x27;</span>||ch&gt;<span class="string">&#x27;9&#x27;</span>) t|=ch==<span class="string">&#x27;-&#x27;</span>,ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">while</span>(ch&gt;=<span class="string">&#x27;0&#x27;</span>&amp;&amp;ch&lt;=<span class="string">&#x27;9&#x27;</span>) x=(x&lt;&lt;<span class="number">3</span>)+(x&lt;&lt;<span class="number">1</span>)+(ch^<span class="number">48</span>),ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">if</span>(t) x=-x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> Limit,f[MAXN],dp[<span class="number">3</span>][MAXN],ans;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">init</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;MAXN;++i) f[i]=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">2</span>;i&lt;MAXN;++i)</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">2</span>;i*j&lt;MAXN;++j)</span><br><span class="line">            f[i*j]+=i;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Tree</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> next,to;</span><br><span class="line">&#125;Edge[MAXN&lt;&lt;<span class="number">1</span>];</span><br><span class="line"><span class="type">int</span> Head[MAXN],Total;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">addEdge</span><span class="params">(<span class="type">int</span> u,<span class="type">int</span> v)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Edge[++Total]=(Tree)&#123;Head[u],v&#125;;Head[u]=Total;</span><br><span class="line">    Edge[++Total]=(Tree)&#123;Head[v],u&#125;;Head[v]=Total;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dpTree</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> last)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> e=Head[x];e;e=Edge[e].next)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> v=Edge[e].to;</span><br><span class="line">        <span class="keyword">if</span>(v==last||v==x) <span class="keyword">continue</span>;</span><br><span class="line">        <span class="built_in">dpTree</span>(v,x);</span><br><span class="line">        <span class="keyword">if</span>(dp[<span class="number">1</span>][x]&lt;dp[<span class="number">1</span>][v]+<span class="number">1</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            dp[<span class="number">2</span>][x]=dp[<span class="number">1</span>][x];</span><br><span class="line">            dp[<span class="number">1</span>][x]=dp[<span class="number">1</span>][v]+<span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(dp[<span class="number">2</span>][x]&lt;dp[<span class="number">1</span>][v]+<span class="number">1</span>) dp[<span class="number">2</span>][x]=dp[<span class="number">1</span>][v]+<span class="number">1</span>;</span><br><span class="line">        ans=<span class="built_in">max</span>(ans,dp[<span class="number">1</span>][x]+dp[<span class="number">2</span>][x]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// freopen(&quot;tree-d.in&quot;,&quot;r&quot;,stdin);</span></span><br><span class="line">    <span class="comment">// freopen(&quot;tree-d.out&quot;,&quot;w&quot;,stdout);</span></span><br><span class="line">    <span class="built_in">init</span>();</span><br><span class="line">    <span class="built_in">read</span>(Limit);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=Limit;++i) <span class="keyword">if</span>(i&gt;=f[i]) <span class="built_in">addEdge</span>(i,f[i]);</span><br><span class="line">    <span class="comment">// for(int i=1;i&lt;=Limit;++i) cout&lt;&lt;i&lt;&lt;&quot; &quot;&lt;&lt;f[i]&lt;&lt;endl;</span></span><br><span class="line">    <span class="built_in">dpTree</span>(<span class="number">1</span>,<span class="number">-1</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d&quot;</span>,ans);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">7</span></span><br><span class="line"><span class="comment">79</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure></details><hr><h2 id="二次扫描与换根法"><a href="#二次扫描与换根法" class="headerlink" title="二次扫描与换根法"></a>二次扫描与换根法</h2><p><del>因为考到了所以又回来重新学习。</del></p><p>这个思路用于求解一棵无根树，且不定根时的最值答案。主要就是首先随机一个点为根，跑一遍 $\text{dp}$ ，再利用求得的解再一次动态规划，第二次的动态规划称为<strong>换根</strong>。</p><h3 id="例题-1"><a href="#例题-1" class="headerlink" title="例题"></a>例题</h3><h4 id="P3478"><a href="#P3478" class="headerlink" title="P3478"></a><a href="https://www.luogu.com.cn/problem/P3478">P3478</a></h4><blockquote><p>求得一个根使 $\displaystyle\sum dep_i$ 最大。</p></blockquote><p>不难看出，遍历所得答案的时间复杂度是 $\mathcal O(n^2)$ 。而换根 $\text{dp}$ 可以优化到 $\mathcal O(n)$ 。</p><p>设当前根节点为 $u$ ，我们接下来会将根切换到 $u$ 的子结点 $v$ 上。那么，对于这次换根的影响，我们会发现，所有 $v$ 子树上的结点（包括 $v$ ），深度都会减一，而其他结点的深度加一。</p><p>那么，就可以得到一个递推式，设以 $u$ 为根结点的深度和为 $f[u]$ ，则有：</p><p>$f[v]=f[u]-size[v]+(size[1]-size[v])$</p><p>第一次扫描时设的根结点是 $1$ 。</p><p>然后最后扫描一遍并记录最大答案即可。</p><details>    <summary>AC Code</summary><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN=<span class="number">1e6</span>+<span class="number">10</span>;</span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> ll;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    x=<span class="number">0</span>;</span><br><span class="line">    <span class="type">char</span> ch=<span class="built_in">getchar</span>(),t=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(ch&lt;<span class="string">&#x27;0&#x27;</span>||ch&gt;<span class="string">&#x27;9&#x27;</span>) t|=ch==<span class="string">&#x27;-&#x27;</span>,ch=<span class="built_in">getchar</span>();</span><br><span class="line">    <span class="keyword">while</span>(ch&gt;=<span class="string">&#x27;0&#x27;</span>&amp;&amp;ch&lt;=<span class="string">&#x27;9&#x27;</span>) x=(x&lt;&lt;<span class="number">3</span>)+(x&lt;&lt;<span class="number">1</span>)+(ch^<span class="number">48</span>),ch=<span class="built_in">getchar</span>();</span><br><span class="line">    <span class="keyword">if</span>(t) x=-x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T,<span class="keyword">class</span> ...T1&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x,T1 &amp;...x1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">read</span>(x),<span class="built_in">read</span>(x1...);</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> N;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Tre</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> next,to;</span><br><span class="line">&#125;Edge[MAXN&lt;&lt;<span class="number">1</span>];</span><br><span class="line"><span class="type">int</span> Head[MAXN],Total;</span><br><span class="line">ll dp[MAXN],Siz[MAXN],Dep[MAXN];</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">addEdge</span><span class="params">(<span class="type">int</span> u,<span class="type">int</span> v)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Edge[++Total]=(Tre)&#123;Head[u],v&#125;;Head[u]=Total;</span><br><span class="line">    Edge[++Total]=(Tre)&#123;Head[v],u&#125;;Head[v]=Total;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dfsPre</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> last)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Siz[x]=<span class="number">1</span>,Dep[x]=Dep[last]+<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> e=Head[x],v;e;e=Edge[e].next)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>((v=Edge[e].to)==last) <span class="keyword">continue</span>;</span><br><span class="line">        <span class="built_in">dfsPre</span>(v,x);</span><br><span class="line">        Siz[x]+=Siz[v];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dfsCalc</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> last)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> e=Head[x],v;e;e=Edge[e].next)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>((v=Edge[e].to)==last) <span class="keyword">continue</span>;</span><br><span class="line">        dp[v]=dp[x]+Siz[<span class="number">1</span>]-Siz[v]*<span class="number">2</span>;</span><br><span class="line">        <span class="built_in">dfsCalc</span>(v,x);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">ll Ans=<span class="number">-0x3f3f3f3f</span>,idx;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">read</span>(N);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">2</span>,u,v;i&lt;=N;++i)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">read</span>(u,v);<span class="built_in">addEdge</span>(u,v);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">dfsPre</span>(<span class="number">1</span>,<span class="number">0</span>);<span class="built_in">dfsCalc</span>(<span class="number">1</span>,<span class="number">0</span>);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=N;++i)</span><br><span class="line">        <span class="keyword">if</span>(dp[i]&gt;Ans)</span><br><span class="line">        &#123;</span><br><span class="line">            Ans=dp[i];</span><br><span class="line">            idx=i;</span><br><span class="line">        &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%lld&quot;</span>,idx);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">8</span></span><br><span class="line"><span class="comment">1 4</span></span><br><span class="line"><span class="comment">5 6</span></span><br><span class="line"><span class="comment">4 5</span></span><br><span class="line"><span class="comment">6 7</span></span><br><span class="line"><span class="comment">6 8</span></span><br><span class="line"><span class="comment">2 4</span></span><br><span class="line"><span class="comment">3 4</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure></details><hr><h4 id="P2986"><a href="#P2986" class="headerlink" title="P2986"></a><a href="https://www.luogu.com.cn/problem/P2986">P2986</a></h4><p>比较基础，甚至 $\text{H}_2\text{O}$ 了一道蓝题。</p><p>转移方程：$dp[v]=dp[x]+(Siz[1]-2Siz[v])\times val[e]$</p><p>其中 $e$ 为边 $(u,v)$ ，$Siz[u]$ 表示以 $u$ 为根结点的子树中的牛的个数。</p><details>    <summary>AC Code</summary><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> gh() getchar()</span></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN=<span class="number">1e5</span>+<span class="number">10</span>;</span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> ll;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    x=<span class="number">0</span>;</span><br><span class="line">    <span class="type">char</span> ch=<span class="built_in">gh</span>(),t=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(ch&lt;<span class="string">&#x27;0&#x27;</span>||ch&gt;<span class="string">&#x27;9&#x27;</span>) t|=ch==<span class="string">&#x27;-&#x27;</span>,ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">while</span>(ch&gt;=<span class="string">&#x27;0&#x27;</span>&amp;&amp;ch&lt;=<span class="string">&#x27;9&#x27;</span>) x=(x&lt;&lt;<span class="number">3</span>)+(x&lt;&lt;<span class="number">1</span>)+(ch^<span class="number">48</span>),ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">if</span>(t) x=-x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T,<span class="keyword">class</span> ...T1&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x,T1 &amp;...x1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">read</span>(x),<span class="built_in">read</span>(x1...);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">write</span><span class="params">(T x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(x&lt;<span class="number">0</span>) <span class="built_in">putchar</span>(<span class="string">&#x27;-&#x27;</span>),x=-x;</span><br><span class="line">    <span class="keyword">if</span>(x&gt;<span class="number">9</span>) <span class="built_in">write</span>(x/<span class="number">10</span>);</span><br><span class="line">    <span class="built_in">putchar</span>(x%<span class="number">10</span>+<span class="string">&#x27;0&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> N,C[MAXN];</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Tre</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> next,to,val;</span><br><span class="line">&#125;Edge[MAXN&lt;&lt;<span class="number">1</span>];</span><br><span class="line"><span class="type">int</span> Head[MAXN],Total;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">addEdge</span><span class="params">(<span class="type">int</span> u,<span class="type">int</span> v,<span class="type">int</span> w)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Edge[++Total]=(Tre)&#123;Head[u],v,w&#125;;Head[u]=Total;</span><br><span class="line">    Edge[++Total]=(Tre)&#123;Head[v],u,w&#125;;Head[v]=Total;</span><br><span class="line">&#125;</span><br><span class="line">ll dp[MAXN],Siz[MAXN],Dist[MAXN];</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dfsPre</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> last)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Siz[x]=C[x];</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> e=Head[x],v;e;e=Edge[e].next)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>((v=Edge[e].to)==last) <span class="keyword">continue</span>;</span><br><span class="line">        Dist[v]=Dist[x]+Edge[e].val;</span><br><span class="line">        <span class="built_in">dfsPre</span>(v,x);</span><br><span class="line">        Siz[x]+=Siz[v];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dfsCalc</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> last)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> e=Head[x],v;e;e=Edge[e].next)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>((v=Edge[e].to)==last) <span class="keyword">continue</span>;</span><br><span class="line">        dp[v]=dp[x]+(Siz[<span class="number">1</span>]<span class="number">-2</span>*Siz[v])*Edge[e].val;</span><br><span class="line">        <span class="built_in">dfsCalc</span>(v,x);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">ll ans=<span class="number">1e18</span>;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">read</span>(N);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=N;++i) <span class="built_in">read</span>(C[i]);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">2</span>,u,v;i&lt;=N;++i)</span><br><span class="line">    &#123;</span><br><span class="line">        ll w;</span><br><span class="line">        <span class="built_in">read</span>(u,v,w);<span class="built_in">addEdge</span>(u,v,w);</span><br><span class="line">    &#125;</span><br><span class="line">    Dist[<span class="number">1</span>]=<span class="number">0</span>;</span><br><span class="line">    <span class="built_in">dfsPre</span>(<span class="number">1</span>,<span class="number">0</span>);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=N;++i) dp[<span class="number">1</span>]+=Dist[i]*C[i];</span><br><span class="line">    <span class="built_in">dfsCalc</span>(<span class="number">1</span>,<span class="number">0</span>);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=N;++i) ans=std::<span class="built_in">min</span>(ans,dp[i]);</span><br><span class="line">    <span class="built_in">write</span>(ans);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">5 </span></span><br><span class="line"><span class="comment">1 </span></span><br><span class="line"><span class="comment">1 </span></span><br><span class="line"><span class="comment">0 </span></span><br><span class="line"><span class="comment">0 </span></span><br><span class="line"><span class="comment">2 </span></span><br><span class="line"><span class="comment">1 3 1 </span></span><br><span class="line"><span class="comment">2 3 2 </span></span><br><span class="line"><span class="comment">3 4 3 </span></span><br><span class="line"><span class="comment">4 5 3 </span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure></details><hr>]]></content>
      
      
      <categories>
          
          <category> 学习笔记 </category>
          
          <category> OI </category>
          
      </categories>
      
      
        <tags>
            
            <tag> DP </tag>
            
            <tag> 优化 </tag>
            
            <tag> 图论 </tag>
            
            <tag> 搜索 </tag>
            
            <tag> 树型结构 </tag>
            
            <tag> LCA </tag>
            
            <tag> 树型dp </tag>
            
            <tag> 二次扫描与换根法 </tag>
            
            <tag> 树的重心 </tag>
            
            <tag> 并查集 </tag>
            
            <tag> 递归 </tag>
            
            <tag> 换根dp </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>树上最近公共祖先(LCA)</title>
      <link href="/Eternity/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/OI/lca/"/>
      <url>/Eternity/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/OI/lca/</url>
      
        <content type="html"><![CDATA[<p>“你与我最初的缔结”</p><span id="more"></span><h2 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h2><p><strong>LCA（Least Common Ancestors）</strong>：即最近公共祖先，是指在有根树中，找出某两个结点 $u$ 和 $v$ 最近的公共祖先。</p><p>对于下图（取自洛谷）：</p><p><img src="https://cdn.luogu.com.cn/upload/pic/61612.png" alt="LCA"></p><p>$lca(13,5)=3$</p><p>$lca(6,4)=4$</p><p>$lca(18,2)=2$</p><p>$lca(15,18)=5$</p><p>…</p><h2 id="朴素思路"><a href="#朴素思路" class="headerlink" title="朴素思路"></a>朴素思路</h2><p>从一个点开始，向上标记至根节点；然后将另一点向上搜索到第一个标记的点，该点则是两点的 $lca$ 。这样的复杂度是 $O(nq)$ ，$q$ 表示询问次数。<del>非常滴慢</del>。</p><h2 id="一般方法"><a href="#一般方法" class="headerlink" title="一般方法"></a>一般方法</h2><h3 id="倍增"><a href="#倍增" class="headerlink" title="倍增"></a>倍增</h3><hr><h3 id="树链剖分"><a href="#树链剖分" class="headerlink" title="树链剖分"></a>树链剖分</h3><p>裸裸的树剖，甚至不需要数据结构维护。</p><p>对于一组询问 $(x,y)$ 首先将两个点跳到同一条重链上，然后输出深度小的点即可。</p><details>    <summary>AC Code</summary><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;ctime&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iomanip&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stack&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;map&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> gh() getchar()</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> re register</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> db double</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> ll;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN=<span class="number">5e5</span>+<span class="number">1</span>;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    x=<span class="number">0</span>;</span><br><span class="line">    <span class="type">char</span> ch=<span class="built_in">gh</span>(),t=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(ch&lt;<span class="string">&#x27;0&#x27;</span>||ch&gt;<span class="string">&#x27;9&#x27;</span>) t|=ch==<span class="string">&#x27;-&#x27;</span>,ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">while</span>(ch&gt;=<span class="string">&#x27;0&#x27;</span>&amp;&amp;ch&lt;=<span class="string">&#x27;9&#x27;</span>) x=(x&lt;&lt;<span class="number">3</span>)+(x&lt;&lt;<span class="number">1</span>)+(ch^<span class="number">48</span>),ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">if</span>(t) x=-x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T,<span class="keyword">class</span> ...T1&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x,T1 &amp;...x1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">read</span>(x),<span class="built_in">read</span>(x1...);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">checkMax</span><span class="params">(T &amp;x,T &amp;y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x&lt;y?x=y,<span class="number">1</span>:<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">checkMin</span><span class="params">(T &amp;x,T &amp;y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x&gt;y?x=y,<span class="number">1</span>:<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> N,M,Root;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Graph</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> next,to;</span><br><span class="line">    <span class="built_in">Graph</span>(<span class="type">int</span> n=<span class="number">0</span>,<span class="type">int</span> t=<span class="number">0</span>):<span class="built_in">next</span>(n),<span class="built_in">to</span>(t)&#123;&#125;</span><br><span class="line">&#125;Edge[MAXN&lt;&lt;<span class="number">1</span>];</span><br><span class="line"><span class="type">int</span> Head[MAXN],Total;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">addEdge</span><span class="params">(<span class="type">int</span> u,<span class="type">int</span> v)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Edge[++Total]=<span class="built_in">Graph</span>(Head[u],v);Head[u]=Total;</span><br><span class="line">    Edge[++Total]=<span class="built_in">Graph</span>(Head[v],u);Head[v]=Total;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> Size[MAXN],Dep[MAXN],Top[MAXN],Fa[MAXN],Son[MAXN];</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dfsTree</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> last,<span class="type">int</span> dep)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Fa[x]=last,Size[x]=<span class="number">1</span>,Dep[x]=dep;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> e=Head[x],v;e;e=Edge[e].next)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>((v=Edge[e].to)==last) <span class="keyword">continue</span>;</span><br><span class="line">        <span class="built_in">dfsTree</span>(v,x,dep+<span class="number">1</span>);</span><br><span class="line">        Size[x]+=Size[v];</span><br><span class="line">        <span class="keyword">if</span>(!Son[x]||Size[Son[x]]&lt;Size[v]) Son[x]=v;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dfsDfn</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> topf)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Top[x]=topf;</span><br><span class="line">    <span class="keyword">if</span>(!Son[x]) <span class="keyword">return</span> ;</span><br><span class="line">    <span class="built_in">dfsDfn</span>(Son[x],topf);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> e=Head[x],v;e;e=Edge[e].next)</span><br><span class="line">    &#123;</span><br><span class="line">        v=Edge[e].to;</span><br><span class="line">        <span class="keyword">if</span>(v==Fa[x]||v==Son[x]) <span class="keyword">continue</span>;</span><br><span class="line">        <span class="built_in">dfsDfn</span>(v,v);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">lca</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">while</span>(Top[x]!=Top[y])</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(Dep[Top[x]]&lt;Dep[Top[y]]) <span class="built_in">swap</span>(x,y);</span><br><span class="line">        x=Fa[Top[x]];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(Dep[x]&gt;Dep[y]) <span class="built_in">swap</span>(x,y);</span><br><span class="line">    <span class="keyword">return</span> x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// freopen(&quot;tree-chain.in&quot;,&quot;r&quot;,stdin);</span></span><br><span class="line">    <span class="comment">// freopen(&quot;tree-chain.out&quot;,&quot;w&quot;,stdout);</span></span><br><span class="line">    <span class="built_in">read</span>(N,M,Root);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">2</span>,u,v;i&lt;=N;++i)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">read</span>(u,v);</span><br><span class="line">        <span class="built_in">addEdge</span>(u,v);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">dfsTree</span>(Root,<span class="number">0</span>,<span class="number">1</span>);</span><br><span class="line">    <span class="built_in">dfsDfn</span>(Root,Root);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>,x,y;i&lt;=M;++i)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">read</span>(x,y);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,<span class="built_in">lca</span>(x,y));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">5 5 4</span></span><br><span class="line"><span class="comment">3 1</span></span><br><span class="line"><span class="comment">2 4</span></span><br><span class="line"><span class="comment">5 1</span></span><br><span class="line"><span class="comment">1 4</span></span><br><span class="line"><span class="comment">2 4</span></span><br><span class="line"><span class="comment">3 2</span></span><br><span class="line"><span class="comment">3 5</span></span><br><span class="line"><span class="comment">1 2</span></span><br><span class="line"><span class="comment">4 5</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure></details><hr><h3 id="Tarjan"><a href="#Tarjan" class="headerlink" title="Tarjan"></a>Tarjan</h3><hr><h3 id="st表"><a href="#st表" class="headerlink" title="st表"></a>st表</h3><p>做到 $O(n \log n)$ 的预处理，$O(1)$ 的查询，算比较快的了。将整个树遍历，每遍历一个点将其加至序列末尾。记为数组 $id(x)$ 。无论是到达还是回溯都需要记录。可以证明该序列不会超过 $2n-1$ 。从 $x$ 到 $y$ 需要从 $lca$ 的一个子树走到另一个子树。则在区间 $[id(x),id(y)]$ 之间一定存在 $lca(x,y)$ 。</p><p>而 $lca(x,y)$ 就是其中深度最小的点。用 $st$ 表维护。</p><details>    <summary>ST表</summary><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;ctime&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iomanip&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stack&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;map&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> gh() getchar()</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> re register</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> underMax(x,y) ((x)&gt;(y)?(x):(y))</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> underMin(x,y) ((x)&lt;(y)?(x):(y))</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> ll;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN=<span class="number">5e5</span>+<span class="number">1</span>;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">underRead</span><span class="params">(T &amp;x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    x=<span class="number">0</span>;</span><br><span class="line">    <span class="type">char</span> ch=<span class="built_in">gh</span>(),t=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(ch&lt;<span class="string">&#x27;0&#x27;</span>||ch&gt;<span class="string">&#x27;9&#x27;</span>) t|=ch==<span class="string">&#x27;-&#x27;</span>,ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">while</span>(ch&gt;=<span class="string">&#x27;0&#x27;</span>&amp;&amp;ch&lt;=<span class="string">&#x27;9&#x27;</span>) x=(x&lt;&lt;<span class="number">3</span>)+(x&lt;&lt;<span class="number">1</span>)+(ch^<span class="number">48</span>),ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">if</span>(t) x=-x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> N,M,Idx,Rt;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">edge</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> next,to;</span><br><span class="line">&#125;Edge[MAXN&lt;&lt;<span class="number">1</span>];</span><br><span class="line"><span class="type">int</span> Head[MAXN],Total;</span><br><span class="line"><span class="type">int</span> Log[MAXN&lt;&lt;<span class="number">1</span>],St[MAXN&lt;&lt;<span class="number">1</span>][<span class="number">64</span>],Dep[MAXN],Id[MAXN];</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">underAddEdge</span><span class="params">(<span class="type">int</span> u,<span class="type">int</span> v)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Edge[++Total]=(edge)&#123;Head[u],v&#125;;Head[u]=Total;</span><br><span class="line">    Edge[++Total]=(edge)&#123;Head[v],u&#125;;Head[v]=Total;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">underSwap</span><span class="params">(<span class="type">int</span> &amp;x,<span class="type">int</span> &amp;y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    x^=y^=x^=y;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">underDfs</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> last)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    St[++Idx][<span class="number">0</span>]=x;Id[x]=Idx;Dep[x]=Dep[last]+<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> e=Head[x],v;e;e=Edge[e].next)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>((v=Edge[e].to)==last) <span class="keyword">continue</span>;</span><br><span class="line">        <span class="built_in">underDfs</span>(v,x);</span><br><span class="line">        St[++Idx][<span class="number">0</span>]=x;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">underDepMin</span><span class="params">(<span class="type">int</span> a,<span class="type">int</span> b)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> Dep[a]&lt;Dep[b]?a:b;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">underInit</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">2</span>;i&lt;=Idx;++i) Log[i]=Log[i&gt;&gt;<span class="number">1</span>]+<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> k=<span class="number">1</span>;(<span class="number">1</span>&lt;&lt;k)&lt;=Idx;++k)</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i+(<span class="number">1</span>&lt;&lt;k)<span class="number">-1</span>&lt;=Idx;++i)</span><br><span class="line">            St[i][k]=<span class="built_in">underDepMin</span>(St[i][k<span class="number">-1</span>],St[i+(<span class="number">1</span>&lt;&lt;(k<span class="number">-1</span>))][k<span class="number">-1</span>]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">underLca</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    x=Id[x],y=Id[y];</span><br><span class="line">    <span class="keyword">if</span>(x&gt;y) <span class="built_in">underSwap</span>(x,y);</span><br><span class="line">    <span class="type">int</span> k=Log[y-x+<span class="number">1</span>];</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">underDepMin</span>(St[x][k],St[y-(<span class="number">1</span>&lt;&lt;(k))+<span class="number">1</span>][k]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// freopen(&quot;LCA.in&quot;,&quot;r&quot;,stdin);</span></span><br><span class="line">    <span class="comment">// freopen(&quot;LCA.out&quot;,&quot;w&quot;,stdout);</span></span><br><span class="line">    <span class="built_in">underRead</span>(N),<span class="built_in">underRead</span>(M),<span class="built_in">underRead</span>(Rt);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>,u,v;i&lt;N;++i)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">underRead</span>(u),<span class="built_in">underRead</span>(v);</span><br><span class="line">        <span class="built_in">underAddEdge</span>(u,v);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">underDfs</span>(Rt,<span class="number">-1</span>);</span><br><span class="line">    <span class="built_in">underInit</span>();</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> x,y;M;--M)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">underRead</span>(x),<span class="built_in">underRead</span>(y);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,<span class="built_in">underLca</span>(x,y));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">5 5 4</span></span><br><span class="line"><span class="comment">3 1</span></span><br><span class="line"><span class="comment">2 4</span></span><br><span class="line"><span class="comment">5 1</span></span><br><span class="line"><span class="comment">1 4</span></span><br><span class="line"><span class="comment">2 4</span></span><br><span class="line"><span class="comment">3 2</span></span><br><span class="line"><span class="comment">3 5</span></span><br><span class="line"><span class="comment">1 2</span></span><br><span class="line"><span class="comment">4 5</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure></details>]]></content>
      
      
      <categories>
          
          <category> 学习笔记 </category>
          
          <category> OI </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 搜索 </tag>
            
            <tag> 树型结构 </tag>
            
            <tag> LCA </tag>
            
            <tag> Tarjan </tag>
            
            <tag> 树链剖分 </tag>
            
            <tag> 分治 </tag>
            
            <tag> 并查集 </tag>
            
            <tag> 递归 </tag>
            
            <tag> ST表 </tag>
            
            <tag> 倍增 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>数位dp</title>
      <link href="/Eternity/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/OI/dp-digit/"/>
      <url>/Eternity/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/OI/dp-digit/</url>
      
        <content type="html"><![CDATA[<p>“聚小而大。”</p><span id="more"></span><h2 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h2><p>一种以位数为转移条件的 $dp$ ，一般是统计一个区间内满足一类条件的计数 $dp$ 。一般的初始转移有二维 $dp_{i,j}$ 表示有 $i$ 位且末位为 $j$ 的统计个数。一般满足差分性质（与<strong>树状数组</strong>类似），即 $[l,r]=[1,r]-[1,l-1]$ 的性质。</p><h2 id="写法"><a href="#写法" class="headerlink" title="写法"></a>写法</h2><h3 id="迭代式"><a href="#迭代式" class="headerlink" title="迭代式"></a>迭代式</h3><p>即使用 <code>for</code> 循环来遍历整个 <code>dp</code> 数组。</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">dp</span><span class="params">(<span class="type">int</span> x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(!x) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    vector&lt;<span class="type">int</span>&gt;Num;<span class="comment">//存储limit的每一位</span></span><br><span class="line">    <span class="keyword">while</span>(x) Num.<span class="built_in">push_back</span>(x%<span class="number">10</span>),x/=<span class="number">10</span>;</span><br><span class="line">    ll res=<span class="number">0</span>;<span class="comment">//存储答案</span></span><br><span class="line">    <span class="type">int</span> last=<span class="comment">/*init*/</span>;<span class="comment">//限制条件s</span></span><br><span class="line">    <span class="keyword">for</span>(re <span class="type">int</span> i=Num.<span class="built_in">size</span>()<span class="number">-1</span>;i&gt;=<span class="number">0</span>;--i)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> x=Num[i];</span><br><span class="line">        <span class="keyword">for</span>(re <span class="type">int</span> j=<span class="number">0</span>;j&lt;x;++j) <span class="keyword">if</span>(<span class="comment">/*some condition*/</span>) res+=dp[i+<span class="number">1</span>][j];</span><br><span class="line">        <span class="keyword">if</span>(<span class="comment">/*some condition*/</span>) last=x;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">if</span>(!i) ++res;</span><br><span class="line">&#125;<span class="comment">//以limit=119547为例，这部分计算的是[100000,119547]的值</span></span><br><span class="line">    <span class="keyword">for</span>(re <span class="type">int</span> i=Num.<span class="built_in">size</span>()<span class="number">-2</span>;i&gt;=<span class="number">0</span>;--i)</span><br><span class="line">        <span class="keyword">for</span>(re <span class="type">int</span> j=<span class="number">0</span>;j&lt;=<span class="number">9</span>;++j)</span><br><span class="line">            res+=dp[i+<span class="number">1</span>][j];</span><br><span class="line">    <span class="comment">//同上，这部分计算[1,99999]的总值</span></span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="记忆化"><a href="#记忆化" class="headerlink" title="记忆化"></a>记忆化</h3><p>使用<code>dfs</code>遍历所有的情况</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">ll <span class="title">dfs</span><span class="params">(<span class="type">int</span> x<span class="comment">/*,bool con1,bool con2...bool conn*/</span>)</span><span class="comment">//一些限制条件，x表示位数</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(!x) <span class="keyword">return</span> <span class="comment">/*something*/</span>;</span><br><span class="line">    ll &amp;res=dp[x]<span class="comment">/*[some][conditions]...[]*/</span>;</span><br><span class="line">    <span class="keyword">if</span>(~res) <span class="keyword">return</span> res;<span class="comment">//该位置已达到</span></span><br><span class="line">    res=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(re <span class="type">int</span> i=<span class="number">0</span>;i&lt;=cntN;++i)<span class="comment">//limit范围内</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="comment">/*some conditions*/</span>) <span class="comment">/*something*/</span>;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(<span class="comment">/*some conditions*/</span>) <span class="comment">/*something*/</span>;</span><br><span class="line">        <span class="keyword">else</span> <span class="comment">/*something*/</span>;</span><br><span class="line">        res+=<span class="built_in">dfs</span>(x<span class="number">-1</span><span class="comment">/*,...,...,...,*/</span>);<span class="comment">//查找下一位</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="初始化"><a href="#初始化" class="headerlink" title="初始化"></a>初始化</h3><p>将所有应算的都算出来， $dp$ 的过程只是在查找 $limit$ 范围之内的。</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">init</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(re <span class="type">int</span> i=<span class="number">0</span>;i&lt;=<span class="number">9</span>;++i) dp[<span class="number">1</span>][i]=<span class="number">1</span>;<span class="comment">//处理[0,9]</span></span><br><span class="line">    <span class="keyword">for</span>(re <span class="type">int</span> i=<span class="number">1</span>;i&lt;MAXN;++i)</span><br><span class="line">        <span class="keyword">for</span>(re <span class="type">int</span> j=<span class="number">0</span>;j&lt;=<span class="number">9</span>;++j)</span><br><span class="line">            <span class="comment">/*for(re int l=?;?;?)*/</span></span><br><span class="line">            <span class="comment">/*some conditions*/</span>dp[i][j]=dp[i<span class="number">-1</span>][<span class="comment">/*some conditions*/</span>];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="例题"><a href="#例题" class="headerlink" title="例题"></a>例题</h2><h3 id="Luogu-P2657-windy数"><a href="#Luogu-P2657-windy数" class="headerlink" title="Luogu P2657 windy数"></a><a href="https://www.luogu.com.cn/problem/P2657">Luogu P2657 windy数</a></h3><h4 id="解释"><a href="#解释" class="headerlink" title="解释"></a>解释</h4><p>数位 $dp$ 模板题，用 $dp_{i,j}$ 表示位数为 $i$ ，最高位是 $j$ 的计数，递推出在 $limit$ 内满足的个数，对于相邻的两位，只要其相差不到 $2$ 都可以相加。最终答案便是 <code>dp(r)-dp(l-1)</code> 。</p><h4 id="AC-Code"><a href="#AC-Code" class="headerlink" title="AC Code"></a>AC Code</h4><p>递推写法。</p><details>    <summary>查看代码</summary><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;ctime&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iomanip&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stack&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;map&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> gh() getchar()</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> re register</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> underMax(x,y) ((x)&gt;(y)?(x):(y))</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> underMin(x,y) ((x)&lt;(y)?(x):(y))</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> ll;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">underRead</span><span class="params">(T &amp;x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    x=<span class="number">0</span>;</span><br><span class="line">    <span class="type">char</span> ch=<span class="built_in">gh</span>(),t=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(ch&lt;<span class="string">&#x27;0&#x27;</span>||ch&gt;<span class="string">&#x27;9&#x27;</span>) t|=ch==<span class="string">&#x27;-&#x27;</span>,ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">while</span>(ch&gt;=<span class="string">&#x27;0&#x27;</span>&amp;&amp;ch&lt;=<span class="string">&#x27;9&#x27;</span>) x=(x&lt;&lt;<span class="number">3</span>)+(x&lt;&lt;<span class="number">1</span>)+(ch^<span class="number">48</span>),ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">if</span>(t) x=-x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> dp[<span class="number">11</span>][<span class="number">11</span>],l,r;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">underAbs</span><span class="params">(<span class="type">int</span> x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (x&gt;<span class="number">0</span>?x:-x);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">underInit</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(re <span class="type">int</span> i=<span class="number">0</span>;i&lt;=<span class="number">9</span>;++i) dp[<span class="number">1</span>][i]=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>(re <span class="type">int</span> i=<span class="number">2</span>;i&lt;=<span class="number">10</span>;++i)</span><br><span class="line">        <span class="keyword">for</span>(re <span class="type">int</span> j=<span class="number">0</span>;j&lt;=<span class="number">9</span>;++j)</span><br><span class="line">            <span class="keyword">for</span>(re <span class="type">int</span> l=<span class="number">0</span>;l&lt;=<span class="number">9</span>;++l)</span><br><span class="line">                <span class="keyword">if</span>(<span class="built_in">underAbs</span>(l-j)&gt;=<span class="number">2</span>)</span><br><span class="line">                    dp[i][l]+=dp[i<span class="number">-1</span>][j];</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">underDp</span><span class="params">(<span class="type">int</span> N)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(!N) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    vector&lt;<span class="type">int</span>&gt;Num;</span><br><span class="line">    Num.<span class="built_in">clear</span>();</span><br><span class="line">    <span class="type">int</span> n=N,res=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(n) Num.<span class="built_in">push_back</span>(n%<span class="number">10</span>),n/=<span class="number">10</span>;</span><br><span class="line">    <span class="type">int</span> last=<span class="number">-2</span>;</span><br><span class="line">    <span class="keyword">for</span>(re <span class="type">int</span> i=Num.<span class="built_in">size</span>()<span class="number">-1</span>;i&gt;=<span class="number">0</span>;--i)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> x=Num[i];</span><br><span class="line">        <span class="keyword">for</span>(re <span class="type">int</span> j=i==Num.<span class="built_in">size</span>()<span class="number">-1</span>;j&lt;x;++j)</span><br><span class="line">            <span class="keyword">if</span>(<span class="built_in">underAbs</span>(j-last)&gt;=<span class="number">2</span>) res+=dp[i+<span class="number">1</span>][j];</span><br><span class="line">        <span class="keyword">if</span>(<span class="built_in">underAbs</span>(x-last)&gt;=<span class="number">2</span>) last=x;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">if</span>(!i) ++res;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(re <span class="type">int</span> i=Num.<span class="built_in">size</span>()<span class="number">-2</span>;i&gt;=<span class="number">0</span>;--i)</span><br><span class="line">        <span class="keyword">for</span>(re <span class="type">int</span> j=<span class="number">1</span>;j&lt;=<span class="number">9</span>;++j)</span><br><span class="line">            res+=dp[i+<span class="number">1</span>][j];</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// freopen(&quot;digit-dp.in&quot;,&quot;r&quot;,stdin);</span></span><br><span class="line">    <span class="comment">// freopen(&quot;digit-dp.out&quot;,&quot;w&quot;,stdout);</span></span><br><span class="line">    <span class="built_in">underRead</span>(l),<span class="built_in">underRead</span>(r);</span><br><span class="line">    <span class="built_in">underInit</span>();</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d&quot;</span>,<span class="built_in">underDp</span>(r)-<span class="built_in">underDp</span>(l<span class="number">-1</span>));</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">25 50</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure></details><h3 id="Loj-10166-数字游戏"><a href="#Loj-10166-数字游戏" class="headerlink" title="Loj #10166 数字游戏"></a><a href="https://loj.ac/p/10166">Loj #10166 数字游戏</a></h3><h4 id="解释-1"><a href="#解释-1" class="headerlink" title="解释"></a>解释</h4><p>与上一题差不了多少。预处理 $dp_{i,j,k}$ 表示 $i$ 位最高位为 $j$ 且模 $k$ 的计数即可。</p><h4 id="AC-Code-1"><a href="#AC-Code-1" class="headerlink" title="AC Code"></a>AC Code</h4><p>同样是迭代式写法。</p><details>    <summary>查看代码</summary><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;ctime&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iomanip&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stack&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;map&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> gh() getchar()</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> re register</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> underMax(x,y) ((x)&gt;(y)?(x):(y))</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> underMin(x,y) ((x)&lt;(y)?(x):(y))</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> ll;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN=<span class="number">21</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXMOD=<span class="number">101</span>;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">underRead</span><span class="params">(T &amp;x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    x=<span class="number">0</span>;</span><br><span class="line">    <span class="type">char</span> ch=<span class="built_in">gh</span>(),t=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(ch&lt;<span class="string">&#x27;0&#x27;</span>||ch&gt;<span class="string">&#x27;9&#x27;</span>) t|=ch==<span class="string">&#x27;-&#x27;</span>,ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">while</span>(ch&gt;=<span class="string">&#x27;0&#x27;</span>&amp;&amp;ch&lt;=<span class="string">&#x27;9&#x27;</span>) x=(x&lt;&lt;<span class="number">3</span>)+(x&lt;&lt;<span class="number">1</span>)+(ch^<span class="number">48</span>),ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">if</span>(t) x=-x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> l,r,mod;</span><br><span class="line">ll dp[MAXN][<span class="number">10</span>][MAXMOD];</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">underMod</span><span class="params">(<span class="type">int</span> x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (x%mod+mod)%mod;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">underInit</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">memset</span>(dp,<span class="number">0</span>,<span class="built_in">sizeof</span>(dp));</span><br><span class="line">    <span class="keyword">for</span>(re <span class="type">int</span> i=<span class="number">0</span>;i&lt;=<span class="number">9</span>;++i) dp[<span class="number">1</span>][i][i%mod]=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>(re <span class="type">int</span> i=<span class="number">2</span>;i&lt;MAXN;++i)</span><br><span class="line">        <span class="keyword">for</span>(re <span class="type">int</span> j=<span class="number">0</span>;j&lt;=<span class="number">9</span>;++j)</span><br><span class="line">            <span class="keyword">for</span>(re <span class="type">int</span> k=<span class="number">0</span>;k&lt;=<span class="number">9</span>;++k)</span><br><span class="line">                <span class="keyword">for</span>(re <span class="type">int</span> l=<span class="number">0</span>;l&lt;mod;++l)</span><br><span class="line">                    dp[i][j][l]+=dp[i<span class="number">-1</span>][k][<span class="built_in">underMod</span>(l-j)];</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> ll <span class="title">underDp</span><span class="params">(<span class="type">int</span> N)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(!N) <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    vector&lt;<span class="type">int</span>&gt;Num;</span><br><span class="line">    <span class="keyword">while</span>(N) Num.<span class="built_in">push_back</span>(N%<span class="number">10</span>),N/=<span class="number">10</span>;</span><br><span class="line">    ll res=<span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> last=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(re <span class="type">int</span> i=Num.<span class="built_in">size</span>()<span class="number">-1</span>;i&gt;=<span class="number">0</span>;--i)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> x=Num[i];</span><br><span class="line">        <span class="keyword">for</span>(re <span class="type">int</span> j=<span class="number">0</span>;j&lt;x;++j) res+=dp[i+<span class="number">1</span>][j][<span class="built_in">underMod</span>(-last)];</span><br><span class="line">        last=<span class="built_in">underMod</span>(last+x);</span><br><span class="line">        <span class="keyword">if</span>(!i&amp;&amp;!last) ++res;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// freopen(&quot;digit-dp.in&quot;,&quot;r&quot;,stdin);</span></span><br><span class="line">    <span class="comment">// freopen(&quot;digit-dp.out&quot;,&quot;w&quot;,stdout);</span></span><br><span class="line">    <span class="keyword">while</span>(cin&gt;&gt;l&gt;&gt;r&gt;&gt;mod)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">underInit</span>();</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%lld\n&quot;</span>,<span class="built_in">underDp</span>(r)-<span class="built_in">underDp</span>(l<span class="number">-1</span>));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">1 19 9</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure></details><h3 id="Luogu-P6669-组合数问题"><a href="#Luogu-P6669-组合数问题" class="headerlink" title="Luogu P6669 组合数问题"></a><a href="https://www.luogu.com.cn/problem/P6669">Luogu P6669 组合数问题</a></h3><h4 id="解释-2"><a href="#解释-2" class="headerlink" title="解释"></a>解释</h4><p>其实这道题用记忆化要好些一些，一个五维数组记录位数，$n$ 数是否达到上限， $m$ 数是否达到上限，$n$和 $m$ 是否相同过以及 $n$ 是否小于过 $m$ 的情况。这里需要很多组合数的前置知识（比如<strong>卢卡斯定理</strong>）以优化。这里不多解释，有兴趣可以在洛谷上看题解。</p><h4 id="AC-Code-2"><a href="#AC-Code-2" class="headerlink" title="AC Code"></a>AC Code</h4><details>    <summary>查看代码</summary><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;ctime&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iomanip&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stack&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;map&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> gh() getchar()</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> re register</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> underMax(x,y) ((x)&gt;(y)?(x):(y))</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> underMin(x,y) ((x)&lt;(y)?(x):(y))</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> ll;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN=<span class="number">61</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MOD=<span class="number">1e9</span>+<span class="number">7</span>;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">underRead</span><span class="params">(T &amp;x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    x=<span class="number">0</span>;</span><br><span class="line">    <span class="type">char</span> ch=<span class="built_in">gh</span>(),t=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(ch&lt;<span class="string">&#x27;0&#x27;</span>||ch&gt;<span class="string">&#x27;9&#x27;</span>) t|=ch==<span class="string">&#x27;-&#x27;</span>,ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">while</span>(ch&gt;=<span class="string">&#x27;0&#x27;</span>&amp;&amp;ch&lt;=<span class="string">&#x27;9&#x27;</span>) x=(x&lt;&lt;<span class="number">3</span>)+(x&lt;&lt;<span class="number">1</span>)+(ch^<span class="number">48</span>),ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">if</span>(t) x=-x;</span><br><span class="line">&#125;</span><br><span class="line">ll n,m,dp[MAXN][<span class="number">2</span>][<span class="number">2</span>][<span class="number">2</span>][<span class="number">2</span>],N[MAXN],M[MAXN],k;</span><br><span class="line"><span class="type">int</span> T;</span><br><span class="line"><span class="function">ll <span class="title">underDfs</span><span class="params">(<span class="type">int</span> x,<span class="type">bool</span> qn,<span class="type">bool</span> qm,<span class="type">bool</span> dif,<span class="type">bool</span> sml)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(!x) <span class="keyword">return</span> sml;</span><br><span class="line">    ll &amp;res=dp[x][qn][qm][dif][sml];</span><br><span class="line">    <span class="keyword">if</span>(~res) <span class="keyword">return</span> res;</span><br><span class="line">    res=<span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> cntN=qn?k<span class="number">-1</span>:N[x],cntM=qm?k<span class="number">-1</span>:M[x];</span><br><span class="line">    <span class="keyword">for</span>(re <span class="type">int</span> i=<span class="number">0</span>;i&lt;=cntN;++i)</span><br><span class="line">        <span class="keyword">for</span>(re <span class="type">int</span> j=<span class="number">0</span>;(j&lt;=i||dif)&amp;&amp;j&lt;=cntM;++j)</span><br><span class="line">            res=(res+<span class="built_in">underDfs</span>(x<span class="number">-1</span>,qn|(i&lt;cntN),qm|(j&lt;cntM),dif|(i!=j),sml|(i&lt;j)))%MOD;</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// freopen(&quot;digit-dp.in&quot;,&quot;r&quot;,stdin);</span></span><br><span class="line">    <span class="comment">// freopen(&quot;digit-dp.out&quot;,&quot;w&quot;,stdout);</span></span><br><span class="line">    <span class="built_in">underRead</span>(T),<span class="built_in">underRead</span>(k);</span><br><span class="line">    <span class="keyword">while</span>(T--)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">underRead</span>(n),<span class="built_in">underRead</span>(m);</span><br><span class="line">        <span class="built_in">memset</span>(dp,<span class="number">-1</span>,<span class="built_in">sizeof</span>(dp));</span><br><span class="line">        ll Max=<span class="built_in">underMax</span>(n,m),size=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span>(Max) Max/=k,++size;</span><br><span class="line">        <span class="keyword">for</span>(re <span class="type">int</span> i=<span class="number">1</span>;i&lt;=size;++i) N[i]=n%k,n/=k;</span><br><span class="line">        <span class="keyword">for</span>(re <span class="type">int</span> i=<span class="number">1</span>;i&lt;=size;++i) M[i]=m%k,m/=k;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%lld\n&quot;</span>,<span class="built_in">underDfs</span>(size,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">1 2</span></span><br><span class="line"><span class="comment">3 3</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure></details>]]></content>
      
      
      <categories>
          
          <category> 学习笔记 </category>
          
          <category> OI </category>
          
      </categories>
      
      
        <tags>
            
            <tag> DP </tag>
            
            <tag> 优化 </tag>
            
            <tag> 数位dp </tag>
            
            <tag> 组合数学 </tag>
            
            <tag> Lucas定理 </tag>
            
            <tag> 二项式定理 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>NOI-Online 2022 提高组</title>
      <link href="/Eternity/%E6%A8%A1%E6%8B%9F%E8%B5%9B-%E6%AF%94%E8%B5%9B/noionline-senior-2022/"/>
      <url>/Eternity/%E6%A8%A1%E6%8B%9F%E8%B5%9B-%E6%AF%94%E8%B5%9B/noionline-senior-2022/</url>
      
        <content type="html"><![CDATA[<p>被单调队列了。</p><span id="more"></span><h2 id="T1-P8251-丹钓战"><a href="#T1-P8251-丹钓战" class="headerlink" title="T1 P8251 丹钓战"></a><a href="https://www.luogu.com.cn/problem/P8251">T1 P8251 丹钓战</a></h2><h3 id="思路"><a href="#思路" class="headerlink" title="思路"></a>思路</h3><p>单调栈预处理出一个 $c$ 数组以记录每一个数对答案的贡献。然后将题意转化为求 $[l,r]$ 中小于 $l$ 的个数，每个元素对答案的贡献当且仅当其下的元素不在 $[l,r]$ 之间。用主席树维护即可。</p><p>官方时间复杂度 $O((n+q) \log n)$</p><p><del>考场没打出来，暴力30pt</del></p><h3 id="AC-Code"><a href="#AC-Code" class="headerlink" title="AC Code"></a>AC Code</h3><details>    <summary>查看代码</summary><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;ctime&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iomanip&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stack&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;map&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> gh() getchar()</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> re register</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> underMax(x,y) ((x)&gt;(y)?(x):(y))</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> underMin(x,y) ((x)&lt;(y)?(x):(y))</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> ll;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN=<span class="number">5e5</span>+<span class="number">1</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> INF=<span class="number">1e9</span>;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">underRead</span><span class="params">(T &amp;x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    x=<span class="number">0</span>;</span><br><span class="line">    <span class="type">char</span> ch=<span class="built_in">gh</span>(),t=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(ch&lt;<span class="string">&#x27;0&#x27;</span>||ch&gt;<span class="string">&#x27;9&#x27;</span>) t|=ch==<span class="string">&#x27;-&#x27;</span>,ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">while</span>(ch&gt;=<span class="string">&#x27;0&#x27;</span>&amp;&amp;ch&lt;=<span class="string">&#x27;9&#x27;</span>) x=(x&lt;&lt;<span class="number">3</span>)+(x&lt;&lt;<span class="number">1</span>)+(ch^<span class="number">48</span>),ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">if</span>(t) x=-x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> N,M,T,Rt[MAXN],Idx,Ql,Qr;</span><br><span class="line"><span class="type">int</span> a[MAXN],b[MAXN],c[MAXN];</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">PST</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> l,r,dat;</span><br><span class="line">&#125;Tree[MAXN&lt;&lt;<span class="number">6</span>];</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">underPushUp</span><span class="params">(<span class="type">int</span> x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Tree[x].dat=Tree[Tree[x].l].dat+Tree[Tree[x].r].dat;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">underBuild</span><span class="params">(<span class="type">int</span> &amp;x,<span class="type">int</span> l,<span class="type">int</span> r)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    x=++Idx;</span><br><span class="line">    <span class="keyword">if</span>(l==r) <span class="keyword">return</span> ;</span><br><span class="line">    <span class="type">int</span> mid=(l+r)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">    <span class="built_in">underBuild</span>(Tree[x].l,l,mid),<span class="built_in">underBuild</span>(Tree[x].r,mid+<span class="number">1</span>,r);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">underModify</span><span class="params">(<span class="type">int</span> &amp;x,<span class="type">int</span> l,<span class="type">int</span> r,<span class="type">int</span> d)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Tree[++Idx]=Tree[x];</span><br><span class="line">    ++Tree[Idx].dat,x=Idx;</span><br><span class="line">    <span class="keyword">if</span>(l==r) <span class="keyword">return</span> ;</span><br><span class="line">    <span class="type">int</span> mid=(l+r)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span>(d&lt;=mid) <span class="built_in">underModify</span>(Tree[x].l,l,mid,d);</span><br><span class="line">    <span class="keyword">else</span> <span class="built_in">underModify</span>(Tree[x].r,mid+<span class="number">1</span>,r,d);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">underQuery</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> l,<span class="type">int</span> r,<span class="type">int</span> k)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(l==r) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> mid=(l+r)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span>(k==mid) <span class="keyword">return</span> Tree[Tree[x].l].dat;</span><br><span class="line">    <span class="keyword">if</span>(k&lt;mid) <span class="keyword">return</span> <span class="built_in">underQuery</span>(Tree[x].l,l,mid,k);</span><br><span class="line">    <span class="keyword">return</span> Tree[Tree[x].l].dat+<span class="built_in">underQuery</span>(Tree[x].r,mid+<span class="number">1</span>,r,k);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// freopen(&quot;stack.in&quot;,&quot;r&quot;,stdin);</span></span><br><span class="line">    <span class="comment">// freopen(&quot;stack.out&quot;,&quot;w&quot;,stdout);</span></span><br><span class="line">    <span class="built_in">underRead</span>(N),<span class="built_in">underRead</span>(M);</span><br><span class="line">    <span class="keyword">for</span>(re <span class="type">int</span> i=<span class="number">1</span>;i&lt;=N;++i) <span class="built_in">underRead</span>(a[i]);</span><br><span class="line">    <span class="keyword">for</span>(re <span class="type">int</span> i=<span class="number">1</span>;i&lt;=N;++i) <span class="built_in">underRead</span>(b[i]);</span><br><span class="line">    a[<span class="number">0</span>]=c[<span class="number">0</span>]=<span class="number">0</span>;</span><br><span class="line">    b[<span class="number">0</span>]=INF;</span><br><span class="line">    <span class="built_in">underBuild</span>(Rt[<span class="number">0</span>],<span class="number">0</span>,N);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=N;++i)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> l=<span class="number">0</span>,r=T,mid;</span><br><span class="line">        <span class="keyword">while</span>(l&lt;r)</span><br><span class="line">        &#123;</span><br><span class="line">            mid=(l+r+<span class="number">1</span>)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">            <span class="keyword">if</span>(b[i]&lt;b[c[mid]]) l=mid;</span><br><span class="line">            <span class="keyword">else</span> r=mid<span class="number">-1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">while</span>(a[c[l]]==a[i]) --l;</span><br><span class="line">        T=l+<span class="number">1</span>;</span><br><span class="line">        c[T]=i;</span><br><span class="line">        Rt[i]=Rt[i<span class="number">-1</span>];</span><br><span class="line">        <span class="built_in">underModify</span>(Rt[i],<span class="number">0</span>,N,c[l]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(re <span class="type">int</span> i=<span class="number">1</span>;i&lt;=M;++i)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">underRead</span>(Ql),<span class="built_in">underRead</span>(Qr);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,<span class="built_in">underQuery</span>(Rt[Qr],<span class="number">0</span>,N,Ql<span class="number">-1</span>)-<span class="built_in">underQuery</span>(Rt[Ql<span class="number">-1</span>],<span class="number">0</span>,N,Ql<span class="number">-1</span>));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">10 4</span></span><br><span class="line"><span class="comment">3 1 3 1 2 3 3 2 1 1</span></span><br><span class="line"><span class="comment">10 10 2 9 7 5 4 7 6 1</span></span><br><span class="line"><span class="comment">1 4</span></span><br><span class="line"><span class="comment">7 8</span></span><br><span class="line"><span class="comment">7 10</span></span><br><span class="line"><span class="comment">1 8</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure></details><h2 id="T2-P8252-讨论"><a href="#T2-P8252-讨论" class="headerlink" title="T2 P8252 讨论"></a><a href="https://www.luogu.com.cn/problem/P8252">T2 P8252 讨论</a></h2><h2 id="T3-P8253-如何正确地排序"><a href="#T3-P8253-如何正确地排序" class="headerlink" title="T3 P8253 如何正确地排序"></a><a href="https://www.luogu.com.cn/problem/P8253">T3 P8253 如何正确地排序</a></h2>]]></content>
      
      
      <categories>
          
          <category> 模拟赛/比赛 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 数论 </tag>
            
            <tag> RMQ </tag>
            
            <tag> 数据结构 </tag>
            
            <tag> 线段树 </tag>
            
            <tag> 分治 </tag>
            
            <tag> 单调栈 </tag>
            
            <tag> 主席树 </tag>
            
            <tag> 可持久化数据结构 </tag>
            
            <tag> 容斥原理 </tag>
            
            <tag> 三维偏序 </tag>
            
            <tag> CDQ分治 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>数据结构2022.03.20练习</title>
      <link href="/Eternity/%E6%A8%A1%E6%8B%9F%E8%B5%9B-%E6%AF%94%E8%B5%9B/20220320/"/>
      <url>/Eternity/%E6%A8%A1%E6%8B%9F%E8%B5%9B-%E6%AF%94%E8%B5%9B/20220320/</url>
      
        <content type="html"><![CDATA[<p>结果：C Accepted</p><p>改题进度：BC Accepted</p><span id="more"></span><h2 id="Task-One——Tree"><a href="#Task-One——Tree" class="headerlink" title="Task One——Tree"></a>Task One——Tree</h2><p>始终不得求解</p><h2 id="Task-Two——普通计算姬-common"><a href="#Task-Two——普通计算姬-common" class="headerlink" title="Task Two——普通计算姬(common)"></a>Task Two——普通计算姬(common)</h2><p><a href="https://hydro.ac/d/bzoj/p/4765">题目链接</a></p><h3 id="思路"><a href="#思路" class="headerlink" title="思路"></a>思路</h3><p>求出该树的 $dfs$ 序。对于每一次询问，用树状数组或者线段树维护即可。对于修改，部分分做法即是对树状数组进行暴力修改。然而这样只能得 $90pt$ 。然后将整个 $dfs$ 序的序列进行分块，记录每一个点对每一个序列的贡献，修改序列和即可。最后一个点会爆 $long \ long$ ，需要开 $ull$ </p><h3 id="AC-Code"><a href="#AC-Code" class="headerlink" title="AC Code"></a>AC Code</h3><details>    <summary>查看代码</summary><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;ctime&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iomanip&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stack&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;map&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> gh() getchar()</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> re register</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> underMax(x,y) ((x)&gt;(y)?(x):(y))</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> underMin(x,y) ((x)&lt;(y)?(x):(y))</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ls p&lt;&lt;1</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> rs p&lt;&lt;1|1</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> ll;</span><br><span class="line"><span class="keyword">typedef</span> <span class="type">unsigned</span> <span class="type">long</span> <span class="type">long</span> ull;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN=<span class="number">1e5</span>+<span class="number">1</span>;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">underRead</span><span class="params">(T &amp;x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    x=<span class="number">0</span>;</span><br><span class="line">    <span class="type">char</span> ch=<span class="built_in">gh</span>(),t=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(ch&lt;<span class="string">&#x27;0&#x27;</span>||ch&gt;<span class="string">&#x27;9&#x27;</span>) t|=ch==<span class="string">&#x27;-&#x27;</span>,ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">while</span>(ch&gt;=<span class="string">&#x27;0&#x27;</span>&amp;&amp;ch&lt;=<span class="string">&#x27;9&#x27;</span>) x=(x&lt;&lt;<span class="number">3</span>)+(x&lt;&lt;<span class="number">1</span>)+(ch^<span class="number">48</span>),ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">if</span>(t) x=-x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> N,M,u,v,op,Qf,Qs,Rt,Idx,Blo;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">edge</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> next,to;</span><br><span class="line">&#125;Edge[MAXN&lt;&lt;<span class="number">1</span>];</span><br><span class="line"><span class="type">int</span> Head[MAXN],Total,cnt[MAXN],pos[MAXN],r[MAXN][<span class="number">401</span>];</span><br><span class="line">ull Val[MAXN],Tre[MAXN],sum[MAXN];</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Segment</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> l,r;</span><br><span class="line">&#125;Seg[MAXN];</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">underAddEdge</span><span class="params">(<span class="type">int</span> u,<span class="type">int</span> v)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Edge[++Total]=(edge)&#123;Head[u],v&#125;;Head[u]=Total;</span><br><span class="line">    Edge[++Total]=(edge)&#123;Head[v],u&#125;;Head[v]=Total;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">underDfs</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> last)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Seg[x].l=++Idx;++cnt[pos[x]];</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=Blo;++i) r[x][i]=cnt[i];</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> e=Head[x];e;e=Edge[e].next)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> v=Edge[e].to;</span><br><span class="line">        <span class="keyword">if</span>(v!=last) <span class="built_in">underDfs</span>(v,x);</span><br><span class="line">    &#125;</span><br><span class="line">    Seg[x].r=Idx;--cnt[pos[x]];</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">underLowbit</span><span class="params">(<span class="type">int</span> x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x&amp;(-x);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">underAdd</span><span class="params">(<span class="type">int</span> x,ull val)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(;x&lt;=N;x+=<span class="built_in">underLowbit</span>(x)) Tre[x]+=val;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> ull <span class="title">underQuery</span><span class="params">(<span class="type">int</span> x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    ull ans=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(;x&gt;=<span class="number">1</span>;x-=<span class="built_in">underLowbit</span>(x)) ans+=Tre[x];</span><br><span class="line">    <span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> ull <span class="title">underCalc</span><span class="params">(<span class="type">int</span> l,<span class="type">int</span> r)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">underQuery</span>(r)-<span class="built_in">underQuery</span>(l<span class="number">-1</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">underInitBlock</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> block=<span class="built_in">sqrt</span>(N);</span><br><span class="line">    Blo=(N%block)?(N/block+<span class="number">1</span>):(N/block);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=N;++i) pos[i]=(i<span class="number">-1</span>)/Blo+<span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">underUpdate</span><span class="params">(<span class="type">int</span> x,ull k)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=Blo;++i) sum[i]+=(ull)r[x][i]*k;</span><br><span class="line">    <span class="built_in">underAdd</span>(Seg[x].l,k);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> ull <span class="title">underAns</span><span class="params">(<span class="type">int</span> l,<span class="type">int</span> r)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    ull res=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span>(pos[r]-pos[l]&lt;=<span class="number">1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=l;i&lt;=r;++i) res+=<span class="built_in">underCalc</span>(Seg[i].l,Seg[i].r);</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=l;i&lt;=pos[l]*Blo;++i) res+=<span class="built_in">underCalc</span>(Seg[i].l,Seg[i].r);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=pos[l]+<span class="number">1</span>;i&lt;=pos[r]<span class="number">-1</span>;++i) res+=sum[i];</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=(pos[r]<span class="number">-1</span>)*Blo+<span class="number">1</span>;i&lt;=r;++i) res+=<span class="built_in">underCalc</span>(Seg[i].l,Seg[i].r);</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">freopen</span>(<span class="string">&quot;common.in&quot;</span>,<span class="string">&quot;r&quot;</span>,stdin);</span><br><span class="line">    <span class="built_in">freopen</span>(<span class="string">&quot;common.out&quot;</span>,<span class="string">&quot;w&quot;</span>,stdout);</span><br><span class="line">    <span class="built_in">underRead</span>(N),<span class="built_in">underRead</span>(M);</span><br><span class="line">    <span class="built_in">underInitBlock</span>();</span><br><span class="line">    <span class="keyword">for</span>(re <span class="type">int</span> i=<span class="number">1</span>;i&lt;=N;++i) <span class="built_in">underRead</span>(Val[i]);</span><br><span class="line">    <span class="keyword">for</span>(re <span class="type">int</span> i=<span class="number">1</span>;i&lt;=N;++i)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">underRead</span>(u),<span class="built_in">underRead</span>(v);</span><br><span class="line">        <span class="keyword">if</span>(!u) Rt=v;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(!u) Rt=u;</span><br><span class="line">        <span class="keyword">else</span> <span class="built_in">underAddEdge</span>(u,v);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">underDfs</span>(Rt,<span class="number">-1</span>);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=N;++i) <span class="built_in">underUpdate</span>(i,Val[i]);</span><br><span class="line">    <span class="keyword">while</span>(M--)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">underRead</span>(op),<span class="built_in">underRead</span>(Qf),<span class="built_in">underRead</span>(Qs);</span><br><span class="line">        <span class="keyword">if</span>(op==<span class="number">1</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">underUpdate</span>(Qf,Qs-Val[Qf]);</span><br><span class="line">            Val[Qf]=Qs;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="built_in">printf</span>(<span class="string">&quot;%llu\n&quot;</span>,<span class="built_in">underAns</span>(Qf,Qs));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">6 4</span></span><br><span class="line"><span class="comment">0 0 3 4 0 1</span></span><br><span class="line"><span class="comment">0 1</span></span><br><span class="line"><span class="comment">1 2</span></span><br><span class="line"><span class="comment">2 3</span></span><br><span class="line"><span class="comment">2 4</span></span><br><span class="line"><span class="comment">3 5</span></span><br><span class="line"><span class="comment">5 6</span></span><br><span class="line"><span class="comment">2 1 2</span></span><br><span class="line"><span class="comment">1 1 1</span></span><br><span class="line"><span class="comment">2 3 6</span></span><br><span class="line"><span class="comment">2 3 5</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure></details><h2 id="Task-Three——文艺计算姬-art"><a href="#Task-Three——文艺计算姬-art" class="headerlink" title="Task Three——文艺计算姬(art)"></a>Task Three——文艺计算姬(art)</h2><p><a href="https://hydro.ac/d/bzoj/p/4766">题目链接</a></p><h3 id="思路-1"><a href="#思路-1" class="headerlink" title="思路"></a>思路</h3><p>暴力取一些比较小的点，然后推公式。毕竟 $1 \leq n,m \leq 10^{18}$ 。</p><p>然后推得公式为 $ans=n^{m-1}m^{n-1}$ 。然后用快速幂即可。注意 $1e18*1e18$ 会爆 $long\ long$ 。所以需要快速乘。</p><h3 id="AC-Code-1"><a href="#AC-Code-1" class="headerlink" title="AC Code"></a>AC Code</h3><details>    <summary>查看代码</summary><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;ctime&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iomanip&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stack&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;map&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> gh() getchar()</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> re register</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> underMax(x,y) ((x)&gt;(y)?(x):(y))</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> underMin(x,y) ((x)&lt;(y)?(x):(y))</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> ll;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN=<span class="number">1e6</span>+<span class="number">1</span>;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">underRead</span><span class="params">(T &amp;x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    x=<span class="number">0</span>;</span><br><span class="line">    <span class="type">char</span> ch=<span class="built_in">gh</span>(),t=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(ch&lt;<span class="string">&#x27;0&#x27;</span>||ch&gt;<span class="string">&#x27;9&#x27;</span>) t|=ch==<span class="string">&#x27;-&#x27;</span>,ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">while</span>(ch&gt;=<span class="string">&#x27;0&#x27;</span>&amp;&amp;ch&lt;=<span class="string">&#x27;9&#x27;</span>) x=(x&lt;&lt;<span class="number">3</span>)+(x&lt;&lt;<span class="number">1</span>)+(ch^<span class="number">48</span>),ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">if</span>(t) x=-x;</span><br><span class="line">&#125;</span><br><span class="line">ll N,M,P,tot,ans;</span><br><span class="line"><span class="type">int</span> fa[MAXN&lt;&lt;<span class="number">1</span>];</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">underInit</span><span class="params">(<span class="type">int</span> n,<span class="type">int</span> m)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n+m;++i) fa[i]=i;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">underFind</span><span class="params">(<span class="type">int</span> x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(fa[x]==x) <span class="keyword">return</span> x;</span><br><span class="line">    <span class="keyword">return</span> fa[x]=<span class="built_in">underFind</span>(fa[x]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">underD</span><span class="params">(<span class="type">int</span> n,<span class="type">int</span> m,<span class="type">int</span> edge)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(edge==n+m<span class="number">-1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        ++ans;</span><br><span class="line">        <span class="keyword">return</span> ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(re <span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;++i)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">for</span>(re <span class="type">int</span> j=n+<span class="number">1</span>;j&lt;=m;++j)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span>(<span class="built_in">underFind</span>(i)!=<span class="built_in">underFind</span>(j))</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="type">int</span> p1=<span class="built_in">underFind</span>(i),p2=<span class="built_in">underFind</span>(j);</span><br><span class="line">                fa[p1]=p2;</span><br><span class="line">                <span class="built_in">underD</span>(n,m,edge+<span class="number">1</span>);</span><br><span class="line">                fa[p1]=p1;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> ll <span class="title">underSmi</span><span class="params">(ll a,ll b,ll p)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    ll res=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(b&gt;<span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(b&amp;<span class="number">1</span>) res=(res+a)%p;</span><br><span class="line">        a=(a+a)%p;</span><br><span class="line">        b&gt;&gt;=<span class="number">1</span>;</span><br><span class="line">        <span class="comment">// printf(&quot;%lld %lld %lld\n&quot;,a,b,res);</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> ll <span class="title">underQmi</span><span class="params">(ll a,ll b,ll p)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    ll res=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span>(b&gt;<span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(b&amp;<span class="number">1</span>) res=<span class="built_in">underSmi</span>(res,a,p)%p;</span><br><span class="line">        a=<span class="built_in">underSmi</span>(a,a,p)%p;</span><br><span class="line">        b&gt;&gt;=<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">freopen</span>(<span class="string">&quot;art.in&quot;</span>,<span class="string">&quot;r&quot;</span>,stdin);</span><br><span class="line">    <span class="built_in">freopen</span>(<span class="string">&quot;art.out&quot;</span>,<span class="string">&quot;w&quot;</span>,stdout);</span><br><span class="line">    <span class="built_in">underRead</span>(N),<span class="built_in">underRead</span>(M),<span class="built_in">underRead</span>(P);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%lld&quot;</span>,<span class="built_in">underSmi</span>(<span class="built_in">underQmi</span>(N,M<span class="number">-1</span>,P),<span class="built_in">underQmi</span>(M,N<span class="number">-1</span>,P),P));</span><br><span class="line">    <span class="comment">// printf(&quot;%lld %lld\n&quot;,N,M);</span></span><br><span class="line">    <span class="comment">/*for(re int i=1;i&lt;=N;++i)</span></span><br><span class="line"><span class="comment">    &#123;</span></span><br><span class="line"><span class="comment">        for(re int j=1;j&lt;=M;++j)</span></span><br><span class="line"><span class="comment">        &#123;</span></span><br><span class="line"><span class="comment">            underInit(i,j);</span></span><br><span class="line"><span class="comment">            underD(i,j,0);</span></span><br><span class="line"><span class="comment">            printf(&quot;%d,%d=%lld\n&quot;,i,j,ans);</span></span><br><span class="line"><span class="comment">        &#125;</span></span><br><span class="line"><span class="comment">    &#125;*/</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">1,1=1</span></span><br><span class="line"><span class="comment">1,2=1</span></span><br><span class="line"><span class="comment">2,2=4</span></span><br><span class="line"><span class="comment">2,3=12</span></span><br><span class="line"><span class="comment">2,4=32</span></span><br><span class="line"><span class="comment">3,1=1</span></span><br><span class="line"><span class="comment">3,2=12</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">f(n,m)=n^(m-1)*m^(n-1)</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure></details>]]></content>
      
      
      <categories>
          
          <category> 模拟赛/比赛 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 数论 </tag>
            
            <tag> DP </tag>
            
            <tag> RMQ </tag>
            
            <tag> 数据结构 </tag>
            
            <tag> 线段树 </tag>
            
            <tag> 树状数组 </tag>
            
            <tag> 块状链表，块状数组，分块 </tag>
            
            <tag> Dfs序 </tag>
            
            <tag> Prufer序 </tag>
            
            <tag> Matrix-Tree定理 </tag>
            
            <tag> LCA </tag>
            
            <tag> Tarjan </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>P3850书架</title>
      <link href="/Eternity/%E9%A2%98%E8%A7%A3/p3850/"/>
      <url>/Eternity/%E9%A2%98%E8%A7%A3/p3850/</url>
      
        <content type="html"><![CDATA[<p>“STL的妙用”</p><span id="more"></span><p>使用 $rope$ 轻松解决。</p><p><a href="https://violeteternal.github.io/Eternity/%E9%A2%98%E8%A7%A3/p4008">rope的使用</a></p><details>    <summary>AC Code</summary><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;ctime&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iomanip&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stack&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;map&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;ext/rope&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> gh() getchar()</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> re register</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> underMax(x,y) ((x)&gt;(y)?(x):(y))</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> underMin(x,y) ((x)&lt;(y)?(x):(y))</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> ll;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> __gnu_cxx;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN=<span class="number">1e6</span>+<span class="number">1</span>;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">underRead</span><span class="params">(T &amp;x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    x=<span class="number">0</span>;</span><br><span class="line">    <span class="type">char</span> ch=<span class="built_in">gh</span>(),t=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(ch&lt;<span class="string">&#x27;0&#x27;</span>||ch&gt;<span class="string">&#x27;9&#x27;</span>) t|=ch==<span class="string">&#x27;-&#x27;</span>,ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">while</span>(ch&gt;=<span class="string">&#x27;0&#x27;</span>&amp;&amp;ch&lt;=<span class="string">&#x27;9&#x27;</span>) x=(x&lt;&lt;<span class="number">3</span>)+(x&lt;&lt;<span class="number">1</span>)+(ch^<span class="number">48</span>),ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">if</span>(t) x=-x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> N,M,x;</span><br><span class="line">string t[MAXN&lt;&lt;<span class="number">1</span>];</span><br><span class="line">rope&lt;<span class="type">int</span>&gt;R;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// freopen(&quot;rope.in&quot;,&quot;r&quot;,stdin);</span></span><br><span class="line">    <span class="comment">// freopen(&quot;rope.out&quot;,&quot;w&quot;,stdout);</span></span><br><span class="line">    <span class="built_in">underRead</span>(N);</span><br><span class="line">    <span class="keyword">for</span>(re <span class="type">int</span> i=<span class="number">1</span>;i&lt;=N;++i)</span><br><span class="line">    &#123;</span><br><span class="line">        cin&gt;&gt;t[R.<span class="built_in">size</span>()];</span><br><span class="line">        R.<span class="built_in">push_back</span>(R.<span class="built_in">size</span>());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">underRead</span>(N);</span><br><span class="line">    <span class="keyword">for</span>(re <span class="type">int</span> i=<span class="number">1</span>;i&lt;=N;++i)</span><br><span class="line">    &#123;</span><br><span class="line">        cin&gt;&gt;t[R.<span class="built_in">size</span>()];</span><br><span class="line">        <span class="built_in">underRead</span>(x);</span><br><span class="line">        R.<span class="built_in">insert</span>(x,R.<span class="built_in">size</span>());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">underRead</span>(N);</span><br><span class="line">    <span class="keyword">for</span>(re <span class="type">int</span> i=<span class="number">1</span>;i&lt;=N;++i)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">underRead</span>(x);</span><br><span class="line">        cout&lt;&lt;t[R[x]]&lt;&lt;endl;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure></details>]]></content>
      
      
      <categories>
          
          <category> 题解 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 平衡树 </tag>
            
            <tag> Splay </tag>
            
            <tag> STL </tag>
            
            <tag> rope </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>dcoj2008 蜜雪冰城</title>
      <link href="/Eternity/%E9%A2%98%E8%A7%A3/dcoj2008/"/>
      <url>/Eternity/%E9%A2%98%E8%A7%A3/dcoj2008/</url>
      
        <content type="html"><![CDATA[<p>区间dp经典题</p><span id="more"></span><h2 id="题目描述"><a href="#题目描述" class="headerlink" title="题目描述"></a>题目描述</h2><p>给定 $m$ 个三元组 $\{a_i,b_i,c_i\}$ ，表示第 $i$ 个人会选择区间 $[a_i,b_i]$ 中最便宜的值 $val_k$ 如果 $c_i \leq val_k$ 。设计一个长度为 $n$ 的数列 $val_i$ 使收益最大。</p><p>输出最大收益以及一种方案，含 $spj$ 。</p><p>样例：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">#1 in:</span><br><span class="line">7 5</span><br><span class="line">1 4 7</span><br><span class="line">3 7 13</span><br><span class="line">5 6 20</span><br><span class="line">6 7 1</span><br><span class="line">1 2 5</span><br><span class="line"></span><br><span class="line">#1 out:</span><br><span class="line">43</span><br><span class="line">5 5 13 13 20 20 13</span><br><span class="line"></span><br><span class="line">#2 in:</span><br><span class="line">10 10</span><br><span class="line">1 7 3141</span><br><span class="line">2 8 5926</span><br><span class="line">3 5 5358</span><br><span class="line">1 9 9793</span><br><span class="line">5 10 2384</span><br><span class="line">4 7 6264</span><br><span class="line">5 9 3383</span><br><span class="line">9 10 27950</span><br><span class="line">3 8 2884</span><br><span class="line">1 7 1971</span><br><span class="line"></span><br><span class="line">#2 out:</span><br><span class="line">55021</span><br><span class="line">1971 2384 5358 6264 6264 6264 6264 2384 27950 27950</span><br></pre></td></tr></table></figure><p>数据范围：</p><p>$n \leq 50,m \leq 4000,1 \leq a_i \leq b_i \leq n,1 \leq c_i \leq 500000$</p><p>$subtask1:n=1$</p><p>$subtask2:n,m$</p><p>$subtask3:$无特殊限制</p><h2 id="思路"><a href="#思路" class="headerlink" title="思路"></a>思路</h2><p>首先，我们必须明白：$val_k \in T,T=\{c_1,c_2…c_m\},k \in [1,n]$ 。这需要一些简单的证明，这里不多赘述。</p><h3 id="部分分"><a href="#部分分" class="headerlink" title="部分分"></a>部分分</h3><p>对于 $subtask1$ 而言，暴力枚举每一个价格，求出最大收益。期望得分： $30pt$</p><p>对于 $suntask2$ 而言，用 $O(2^m)$ 的时间暴力枚举每一个人是否会贡献答案。用线段树维护区间值，求出最大收益。时间复杂度 $O(2^m(n+m)\log n)$ ，期望得分： $60pt$ 。</p><p><del>这题确实良心</del></p><h3 id="区间dp"><a href="#区间dp" class="headerlink" title="区间dp"></a>区间dp</h3><p>首先离散化出有多少个不同的 $c_i$ ，用 $M$ 表示离散化之后的个数。我们设 $val_k$ 是区间 $[l,r]$ 之间的最小值。$(l \leq k \leq r)$ ，则对于任何一个 $l \leq a_i \leq b_i \leq r$  的人而言，他的答案贡献必定是 $val_k$ 。那么我们用 $dp_{l,r,v}$ 表示区间 $[l,r]$ 内最小值为 $v$ 已得到的最优解。$cnt_k$ 表示有多少个人对该点的答案有贡献。则转移方程为：</p><p>$dp_{l,r,v}=\max\{dp_{l,r,v},dp_{l,k-1,v_1}+dp_{k+1,r,v_2}+cnt_k*v\}(v \leq v_1,v_2 \leq c_M)$</p><p>也许你会直呼：<del>就这？</del></p><p>怎么可能！你算算复杂度：区间枚举 $O(n^3)$ 枚举价值 $O(m^3)$ 。加起来 $O(n^3m^3)$ 。过得了个寄！你说用四边形不等式优化到 $O(n^2m^3)$ ？开玩笑！？还不是过不了，何况这道题不能用四边形不等式优化。</p><h3 id="优化"><a href="#优化" class="headerlink" title="优化"></a>优化</h3><p>不能从 $n$ 入手，就优化 $m$ 。用一个数组 $g_{l,r,v}$ 预处理出 $\max\{dp_{l,r,v_1}\},v \leq v_1 \leq c_M$ 。直接优化成 $O(n^3m)$ 那过这道题就是氢氢忪忪了。</p><h3 id="输出方案"><a href="#输出方案" class="headerlink" title="输出方案"></a>输出方案</h3><p>记录每一种 $[l,r]$ 是从哪一个 $k$ 转移过来的即可。</p><h2 id="AC-Code"><a href="#AC-Code" class="headerlink" title="AC Code"></a>AC Code</h2><details>    <summary>查看代码</summary><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;ctime&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iomanip&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stack&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;map&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> gh() getchar()</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> re register</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> underMax(x,y) ((x)&gt;(y)?(x):(y))</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> underMin(x,y) ((x)&lt;(y)?(x):(y))</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> ll;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN=<span class="number">51</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXM=<span class="number">4001</span>;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">underRead</span><span class="params">(T &amp;x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    x=<span class="number">0</span>;</span><br><span class="line">    <span class="type">char</span> ch=<span class="built_in">gh</span>(),t=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(ch&lt;<span class="string">&#x27;0&#x27;</span>||ch&gt;<span class="string">&#x27;9&#x27;</span>) t|=ch==<span class="string">&#x27;-&#x27;</span>,ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">while</span>(ch&gt;=<span class="string">&#x27;0&#x27;</span>&amp;&amp;ch&lt;=<span class="string">&#x27;9&#x27;</span>) x=(x&lt;&lt;<span class="number">3</span>)+(x&lt;&lt;<span class="number">1</span>)+(ch^<span class="number">48</span>),ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">if</span>(t) x=-x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> N,M,a[MAXM],b[MAXM],c[MAXM],cnt[MAXM],ans;</span><br><span class="line"><span class="type">int</span> dp[MAXN][MAXN][MAXM],g[MAXN][MAXN][MAXM];</span><br><span class="line">vector&lt;<span class="type">int</span>&gt;V;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">underInit</span><span class="params">(<span class="type">int</span> l,<span class="type">int</span> r,<span class="type">int</span> k)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">memset</span>(cnt,<span class="number">0</span>,<span class="built_in">sizeof</span>(cnt));</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=M;++i)</span><br><span class="line">        <span class="keyword">if</span>(l&lt;=a[i]&amp;&amp;b[i]&lt;=r&amp;&amp;a[i]&lt;=k&amp;&amp;k&lt;=b[i]) ++cnt[c[i]];</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> num[MAXN][MAXN][MAXM],renum[MAXN][MAXN][MAXM];</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">underPrint</span><span class="params">(<span class="type">int</span> l,<span class="type">int</span> r,<span class="type">int</span> k)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> id=num[l][r][k];</span><br><span class="line">    <span class="keyword">if</span>(l&lt;=id<span class="number">-1</span>) <span class="built_in">underPrint</span>(l,num[l][r][k]<span class="number">-1</span>,renum[l][id<span class="number">-1</span>][k]);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d &quot;</span>,V[k<span class="number">-1</span>]);</span><br><span class="line">    <span class="keyword">if</span>(id+<span class="number">1</span>&lt;=r) <span class="built_in">underPrint</span>(id+<span class="number">1</span>,r,renum[id+<span class="number">1</span>][r][k]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// freopen(&quot;section-dp.in&quot;,&quot;r&quot;,stdin);</span></span><br><span class="line">    <span class="comment">// freopen(&quot;section-dp.out&quot;,&quot;w&quot;,stdout);</span></span><br><span class="line">    <span class="built_in">underRead</span>(N),<span class="built_in">underRead</span>(M);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=M;++i)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">underRead</span>(a[i]),<span class="built_in">underRead</span>(b[i]),<span class="built_in">underRead</span>(c[i]);</span><br><span class="line">        V.<span class="built_in">push_back</span>(c[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">sort</span>(V.<span class="built_in">begin</span>(),V.<span class="built_in">end</span>());</span><br><span class="line">    V.<span class="built_in">erase</span>(<span class="built_in">unique</span>(V.<span class="built_in">begin</span>(),V.<span class="built_in">end</span>()),V.<span class="built_in">end</span>());</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=M;++i) c[i]=<span class="built_in">lower_bound</span>(V.<span class="built_in">begin</span>(),V.<span class="built_in">end</span>(),c[i])-V.<span class="built_in">begin</span>()+<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> l=N;l&gt;=<span class="number">1</span>;--l)</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> r=l;r&lt;=N;++r)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> k=l,sum;k&lt;=r;++k)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="built_in">underInit</span>(l,r,k);</span><br><span class="line">                sum=<span class="number">0</span>;</span><br><span class="line">                <span class="keyword">for</span>(<span class="type">int</span> i=V.<span class="built_in">size</span>();i&gt;=<span class="number">1</span>;--i)</span><br><span class="line">                &#123;</span><br><span class="line">                    sum+=cnt[i];</span><br><span class="line">                    ans=sum*V[i<span class="number">-1</span>]+g[l][k<span class="number">-1</span>][i]+g[k+<span class="number">1</span>][r][i];</span><br><span class="line">                    <span class="keyword">if</span>(ans&gt;dp[l][r][i]||!dp[l][r][i])</span><br><span class="line">                    &#123;</span><br><span class="line">                        dp[l][r][i]=ans;</span><br><span class="line">                        num[l][r][i]=k;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> k=V.<span class="built_in">size</span>();k&gt;=<span class="number">1</span>;--k)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">if</span>(dp[l][r][k]&gt;g[l][r][k+<span class="number">1</span>]||!g[l][r][k+<span class="number">1</span>])</span><br><span class="line">                &#123;</span><br><span class="line">                    g[l][r][k]=dp[l][r][k];</span><br><span class="line">                    renum[l][r][k]=k;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                &#123;</span><br><span class="line">                    g[l][r][k]=g[l][r][k+<span class="number">1</span>];</span><br><span class="line">                    renum[l][r][k]=renum[l][r][k+<span class="number">1</span>];</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,g[<span class="number">1</span>][N][<span class="number">1</span>]);</span><br><span class="line">    <span class="built_in">underPrint</span>(<span class="number">1</span>,N,renum[<span class="number">1</span>][N][<span class="number">1</span>]);</span><br><span class="line">    cerr&lt;&lt;endl&lt;&lt;<span class="string">&quot;time:&quot;</span>&lt;&lt;<span class="built_in">clock</span>()&lt;&lt;<span class="string">&quot;ms&quot;</span>&lt;&lt;endl;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">7 5</span></span><br><span class="line"><span class="comment">1 4 7</span></span><br><span class="line"><span class="comment">3 7 13</span></span><br><span class="line"><span class="comment">5 6 20</span></span><br><span class="line"><span class="comment">6 7 1</span></span><br><span class="line"><span class="comment">1 2 5</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure></details>]]></content>
      
      
      <categories>
          
          <category> 题解 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> DP </tag>
            
            <tag> 区间dp </tag>
            
            <tag> 离散化 </tag>
            
            <tag> STL </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>区间dp</title>
      <link href="/Eternity/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/OI/dp-of-section/"/>
      <url>/Eternity/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/OI/dp-of-section/</url>
      
        <content type="html"><![CDATA[<p>“随着方程推进，登峰造极。”</p><span id="more"></span><h2 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h2><p>在区间上进行动态规划，从而求解一段区间上的最优解。通过合并小区间递推出大区间的 $dp$ 算法。</p><h2 id="思路-实现"><a href="#思路-实现" class="headerlink" title="思路/实现"></a>思路/实现</h2><p><strong>合并</strong>：即将两个或多个部分进行整合，当然也可以反过来；</p><p><strong>特征</strong>：能将问题分解为能两两合并的形式；</p><p><strong>求解</strong>：对整个问题设最优值，枚举合并点，将问题分解为左右两个部分，最后合并两个部分的最优值得到原问题的最优值。</p><p>一般来说，其转移方程都与：</p><p>$dp_{i,j}=\max\{dp_{i,j},dp_{i,k}+dp_{k,j}+cost_k\},k \in [l,r]$</p><p>类似。注意，此处的 $\max$ 并不一定指数值上的较大值。</p><p>一般来说，能够达到 $O(n^3)$ 复杂度的题都要考虑区间 $dp$ 。对于小部分题而言，能够用<strong>四边形不等式</strong>优化到 $O(n^2)$ 。</p><h3 id="区间dp的三种写法"><a href="#区间dp的三种写法" class="headerlink" title="区间dp的三种写法"></a>区间dp的三种写法</h3><p>都可以证明出是从小区间到大区间。</p><p>$len$ 表示区间长度，$l$ 表示左端点， $r$ 表示右端点。$k$ 为枚举点。</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span>(<span class="type">int</span> len=<span class="number">1</span>;len&lt;=n;++len)</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> l=<span class="number">1</span>;l&lt;=n-len+<span class="number">1</span>;++l)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> r=l+len<span class="number">-1</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> k=l;k&lt;=r;++k)</span><br><span class="line">            <span class="comment">//do something</span></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span>(<span class="type">int</span> l=n;l&gt;=<span class="number">1</span>;--l)</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> r=l;r&lt;=n;++r)</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> k=l;k&lt;=r;++k)</span><br><span class="line">            <span class="comment">//do something</span></span><br></pre></td></tr></table></figure><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span>(<span class="type">int</span> r=<span class="number">1</span>;r&lt;=n;++r)</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> l=r;l&gt;=<span class="number">1</span>;--l)</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> k=l;k&lt;=r;++k)</span><br><span class="line">            <span class="comment">//do something</span></span><br></pre></td></tr></table></figure><p>没什么太大区别，看自己习惯。</p><h2 id="例题"><a href="#例题" class="headerlink" title="例题"></a>例题</h2><h3 id="Luogu-P1880-NOI1995-石子合并"><a href="#Luogu-P1880-NOI1995-石子合并" class="headerlink" title="Luogu P1880 [NOI1995] 石子合并"></a><a href="https://www.luogu.com.cn/problem/P1880">Luogu P1880 [NOI1995] 石子合并</a></h3><h4 id="题意"><a href="#题意" class="headerlink" title="题意"></a>题意</h4><p>给定 $n$ 个数，每次操作将相邻两堆合并。得分为两个数字的和。求最大得分和最小的分。</p><h4 id="思路"><a href="#思路" class="headerlink" title="思路"></a>思路</h4><p><strong>暴力</strong>：</p><p>暴力合并，时间复杂度 $O(n!)$</p><p><strong>区间dp</strong>：</p><p>对于每一个状态 $dp_{i,j}$ 都可由 $dp_{i,k}$ 与 $dp_{k+1,j}$ 转移而来。</p><p>$dp_{i,j}=\max\{dp_{i,j},dp_{i,k}+dp_{k+1,j}\},k \in [i,j]$</p><p>具体过程还需读者自行思考。</p><details>    <summary>AC Code</summary><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;ctime&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iomanip&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stack&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">using</span> std::cin;</span><br><span class="line"><span class="keyword">using</span> std::cout;</span><br><span class="line"><span class="type">int</span> n,Stone[<span class="number">201</span>];</span><br><span class="line"><span class="type">int</span> StonePrime[<span class="number">201</span>];</span><br><span class="line"><span class="type">int</span> F[<span class="number">201</span>][<span class="number">201</span>],MaxG;</span><br><span class="line"><span class="type">int</span> G[<span class="number">201</span>][<span class="number">201</span>],MinF=<span class="number">1e9</span>;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">Min</span><span class="params">(<span class="type">int</span> a,<span class="type">int</span> b)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">return</span> a&gt;b?b:a;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">Max</span><span class="params">(<span class="type">int</span> a,<span class="type">int</span> b)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">return</span> a&gt;b?a:b;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="comment">//freopen(&quot;.in&quot;,&quot;r&quot;,stdin);</span></span><br><span class="line"><span class="comment">//freopen(&quot;.out&quot;,&quot;w&quot;,stdout);</span></span><br><span class="line"><span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;n);</span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;++i)</span><br><span class="line">&#123;</span><br><span class="line">F[i][i]=<span class="number">0</span>;</span><br><span class="line">G[i][i]=<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line">StonePrime[<span class="number">0</span>]=<span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;++i)</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;Stone[i]);</span><br><span class="line">Stone[i+n]=Stone[i];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=<span class="number">2</span>*n;++i)</span><br><span class="line">&#123;</span><br><span class="line">StonePrime[i]=Stone[i]+StonePrime[i<span class="number">-1</span>];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> p=<span class="number">1</span>;p&lt;n;++p)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>,j=p+i;(i&lt;n*<span class="number">2</span>)&amp;&amp;(j&lt;<span class="number">2</span>*n);++i,j=p+i)</span><br><span class="line">&#123;</span><br><span class="line">F[i][j]=<span class="number">1e9</span>;</span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> k=i;k&lt;j;++k)</span><br><span class="line">&#123;</span><br><span class="line">F[i][j]=<span class="built_in">Min</span>(F[i][j],F[i][k]+F[k+<span class="number">1</span>][j]+StonePrime[j]-StonePrime[i<span class="number">-1</span>]);</span><br><span class="line">G[i][j]=<span class="built_in">Max</span>(G[i][j],G[i][k]+G[k+<span class="number">1</span>][j]+StonePrime[j]-StonePrime[i<span class="number">-1</span>]);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;++i)</span><br><span class="line">&#123;</span><br><span class="line">MinF=<span class="built_in">Min</span>(MinF,F[i][i+n<span class="number">-1</span>]);</span><br><span class="line">MaxG=<span class="built_in">Max</span>(MaxG,G[i][i+n<span class="number">-1</span>]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;%d\n%d&quot;</span>,MinF,MaxG);</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">4</span></span><br><span class="line"><span class="comment">4 5 9 4</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure></details><h3 id="Luogu-P1063-NOIP2006-提高组-能量项链"><a href="#Luogu-P1063-NOIP2006-提高组-能量项链" class="headerlink" title="Luogu P1063 [NOIP2006 提高组] 能量项链"></a><a href="https://www.luogu.com.cn/problem/P1063">Luogu P1063 [NOIP2006 提高组] 能量项链</a></h3><h4 id="转移方程"><a href="#转移方程" class="headerlink" title="转移方程"></a>转移方程</h4><p>$dp_{l,r}=\max\{dp_{l,r},dp{l,k}+dp{k,r}+val_l<em>val_k</em>val_r\},k \in [l,r]$</p><details>    <summary>AC Code</summary><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;ctime&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iomanip&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stack&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">using</span> std::cin;</span><br><span class="line"><span class="keyword">using</span> std::cout;</span><br><span class="line"><span class="type">int</span> n,Power[<span class="number">201</span>];</span><br><span class="line"><span class="type">int</span> G[<span class="number">201</span>][<span class="number">201</span>],MaxG;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">Min</span><span class="params">(<span class="type">int</span> a,<span class="type">int</span> b)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">return</span> a&gt;b?b:a;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">Max</span><span class="params">(<span class="type">int</span> a,<span class="type">int</span> b)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">return</span> a&gt;b?a:b;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="comment">//freopen(&quot;.in&quot;,&quot;r&quot;,stdin);</span></span><br><span class="line"><span class="comment">//freopen(&quot;.out&quot;,&quot;w&quot;,stdout);</span></span><br><span class="line"><span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;n);</span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;++i)</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;Power[i]);</span><br><span class="line">Power[i+n]=Power[i];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">2</span>;i&lt;n*<span class="number">2</span>;++i)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> j=i<span class="number">-1</span>;i-j&lt;n&amp;&amp;j&gt;=<span class="number">1</span>;--j)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> k=j;k&lt;i;++k)</span><br><span class="line">&#123;</span><br><span class="line">G[j][i]=<span class="built_in">Max</span>(G[j][i],G[k+<span class="number">1</span>][i]+G[j][k]+Power[j]*Power[k+<span class="number">1</span>]*Power[i+<span class="number">1</span>]);</span><br><span class="line">&#125;</span><br><span class="line">MaxG=<span class="built_in">Max</span>(MaxG,G[j][i]);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;%d&quot;</span>,MaxG);</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">4</span></span><br><span class="line"><span class="comment">2 3 5 10</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure></details><h3 id="其他题目"><a href="#其他题目" class="headerlink" title="其他题目"></a>其他题目</h3><p><a href="https://violeteternal.github.io/Eternity/题解/dcoj2008">DCOJ#.2008蜜雪冰城</a></p><p><a href="">LuoguP1436棋盘分割</a></p>]]></content>
      
      
      <categories>
          
          <category> 学习笔记 </category>
          
          <category> OI </category>
          
      </categories>
      
      
        <tags>
            
            <tag> DP </tag>
            
            <tag> 区间dp </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>P4008 [NOI2003]文本编辑器</title>
      <link href="/Eternity/%E9%A2%98%E8%A7%A3/p4008/"/>
      <url>/Eternity/%E9%A2%98%E8%A7%A3/p4008/</url>
      
        <content type="html"><![CDATA[<p>我愿称之为最强 $STL$ ！！！</p><span id="more"></span><script src="/js/mathjax.js"></script><h3 id="Rope"><a href="#Rope" class="headerlink" title="Rope"></a>Rope</h3><p>学习了一种超级强大的 $STL$ ，甚至于很多竞赛禁止使用。</p><blockquote><p>$rope$</p></blockquote><p>非标准 $STL$ ，仅能在 $C++11$ 以后使用。</p><p>需要头文件 <code>#include&lt;ext/rope&gt;</code></p><p>并需要 <code>using namespace __gnu_cxx;</code></p><p>定义为 <code>rope&lt;变量类型&gt;变量名</code> 或 <code>crope 变量名称</code></p><p><code>crope R</code> 其实就是 <code>rope&lt;char&gt;R</code></p><p>结合了<strong>链表</strong>和<strong>数组</strong>各自优点的块状链表。内部结构<strong>可持久化平衡树</strong>套<strong>红黑树</strong>。</p><h3 id="操作"><a href="#操作" class="headerlink" title="操作"></a>操作</h3><p><code>push_back(x)</code> : 在末尾添加 $x$  ( $x$ 是 <code>char</code> 类型的)。</p><p><code>insert(pos,x)</code>:在 $pos$ 插入 $x$  ( $x$ 是字符串, $x$ 后面加个 $int$ 参数可以只能 $x$ 中插入几个)。</p><p><code>erase(pos,x)</code>: 从 $pos$ 开始删除 $x$ 个。</p><p><code>replace(pos,x)</code>: 从 $pos$ 开始换成 $x$ ( $x$ 是字符串, $x$ 后面加个 $int$ 参数可以只能 $x$ 中的前几个)。</p><p><code>substr(pos,x)</code>提取 $pos$ 开始 $x$ 个。</p><p><code>copy(pos,len,x)</code>:从 $pos$ 到 $pos+len$ 替换成 $x$ 。</p><p>访问：同数组，用<code>R[x]</code>即可。大部分操作都是 $O(\log n)$ 的复杂度。</p><h2 id="该题"><a href="#该题" class="headerlink" title="该题"></a>该题</h2><p>当用上 $rope$ 后，可持久的紫题没有丝毫威严。</p><p>吸氧过：</p><h3 id="AC-Code"><a href="#AC-Code" class="headerlink" title="AC Code"></a>AC Code</h3><details>    <summary>查看代码</summary><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;ctime&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iomanip&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stack&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;map&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;ext/rope&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> gh() getchar()</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> re register</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> underMax(x,y) ((x)&gt;(y)?(x):(y))</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> underMin(x,y) ((x)&lt;(y)?(x):(y))</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> ll;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> __gnu_cxx;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">underRead</span><span class="params">(T &amp;x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    x=<span class="number">0</span>;</span><br><span class="line">    <span class="type">char</span> ch=<span class="built_in">gh</span>(),t=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(ch&lt;<span class="string">&#x27;0&#x27;</span>||ch&gt;<span class="string">&#x27;9&#x27;</span>) t|=ch==<span class="string">&#x27;-&#x27;</span>,ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">while</span>(ch&gt;=<span class="string">&#x27;0&#x27;</span>&amp;&amp;ch&lt;=<span class="string">&#x27;9&#x27;</span>) x=(x&lt;&lt;<span class="number">3</span>)+(x&lt;&lt;<span class="number">1</span>)+(ch^<span class="number">48</span>),ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">if</span>(t) x=-x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> N,pos;</span><br><span class="line">string Str;</span><br><span class="line">rope&lt;<span class="type">char</span>&gt;R;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// freopen(&quot;rope.in&quot;,&quot;r&quot;,stdin);</span></span><br><span class="line">    <span class="comment">// freopen(&quot;rope.out&quot;,&quot;w&quot;,stdout);</span></span><br><span class="line">    <span class="built_in">underRead</span>(N);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=N;++i)</span><br><span class="line">    &#123;</span><br><span class="line">        cin&gt;&gt;Str;</span><br><span class="line">        <span class="keyword">if</span>(Str[<span class="number">0</span>]==<span class="string">&#x27;M&#x27;</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="type">int</span> k;</span><br><span class="line">            <span class="built_in">underRead</span>(k);</span><br><span class="line">            pos=k;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(Str[<span class="number">0</span>]==<span class="string">&#x27;I&#x27;</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="type">int</span> n;</span><br><span class="line">            <span class="built_in">underRead</span>(n);</span><br><span class="line">            <span class="type">char</span> ch;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;n;++i)</span><br><span class="line">            &#123;</span><br><span class="line">                ch=<span class="built_in">gh</span>();</span><br><span class="line">                <span class="keyword">if</span>(ch&lt;<span class="number">32</span>||ch&gt;<span class="number">126</span>) --i;</span><br><span class="line">                <span class="keyword">else</span> R.<span class="built_in">insert</span>(pos+i,ch);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(Str[<span class="number">0</span>]==<span class="string">&#x27;D&#x27;</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="type">int</span> n;</span><br><span class="line">            <span class="built_in">underRead</span>(n);</span><br><span class="line">            R.<span class="built_in">erase</span>(pos,n);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(Str[<span class="number">0</span>]==<span class="string">&#x27;G&#x27;</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="type">int</span> n;</span><br><span class="line">            <span class="built_in">underRead</span>(n);</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;n;++i) cout&lt;&lt;R[pos+i];</span><br><span class="line">            <span class="built_in">puts</span>(<span class="string">&quot;&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(Str[<span class="number">0</span>]==<span class="string">&#x27;P&#x27;</span>) --pos;</span><br><span class="line">        <span class="keyword">else</span> ++pos;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">15</span></span><br><span class="line"><span class="comment">Insert 26</span></span><br><span class="line"><span class="comment">abcdefghijklmnop</span></span><br><span class="line"><span class="comment">qrstuv wxy</span></span><br><span class="line"><span class="comment">Move 15</span></span><br><span class="line"><span class="comment">Delete 11</span></span><br><span class="line"><span class="comment">Move 5</span></span><br><span class="line"><span class="comment">Insert 1</span></span><br><span class="line"><span class="comment">^</span></span><br><span class="line"><span class="comment">Next</span></span><br><span class="line"><span class="comment">Insert 1</span></span><br><span class="line"><span class="comment">_</span></span><br><span class="line"><span class="comment">Next</span></span><br><span class="line"><span class="comment">Next</span></span><br><span class="line"><span class="comment">Insert 4</span></span><br><span class="line"><span class="comment">.\/.</span></span><br><span class="line"><span class="comment">Get 4</span></span><br><span class="line"><span class="comment">Prev</span></span><br><span class="line"><span class="comment">Insert 1</span></span><br><span class="line"><span class="comment">^</span></span><br><span class="line"><span class="comment">Move 0</span></span><br><span class="line"><span class="comment">Get 22</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">10</span></span><br><span class="line"><span class="comment">Insert 5 opres</span></span><br><span class="line"><span class="comment">Get 3</span></span><br><span class="line"><span class="comment">Next</span></span><br><span class="line"><span class="comment">Next</span></span><br><span class="line"><span class="comment">Get 3</span></span><br><span class="line"><span class="comment">Insert 10 undertales</span></span><br><span class="line"><span class="comment">Move 6</span></span><br><span class="line"><span class="comment">Get 10</span></span><br><span class="line"><span class="comment">Delete 1</span></span><br><span class="line"><span class="comment">Get 9</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure></details>]]></content>
      
      
      <categories>
          
          <category> 题解 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 字符串 </tag>
            
            <tag> 平衡树 </tag>
            
            <tag> 块状链表，块状数组，分块 </tag>
            
            <tag> STL </tag>
            
            <tag> 递归 </tag>
            
            <tag> 可持久化数据结构 </tag>
            
            <tag> rope </tag>
            
            <tag> 可持久化平衡树 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>P1503 鬼子进村</title>
      <link href="/Eternity/%E9%A2%98%E8%A7%A3/p1503/"/>
      <url>/Eternity/%E9%A2%98%E8%A7%A3/p1503/</url>
      
        <content type="html"><![CDATA[<p>$Splay$</p><span id="more"></span><p>求前驱后继。</p><details>    <summary>查看代码</summary><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;ctime&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iomanip&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stack&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;map&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> gh() getchar()</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> underMax(x,y) ((x)&gt;(y)?(x):(y))</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> underMin(x,y) ((x)&lt;(y)?(x):(y))</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> ll;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN=<span class="number">1e5</span>+<span class="number">1</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> INF=<span class="number">0x7f7f7f7f</span>;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">underRead</span><span class="params">(T &amp;x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    x=<span class="number">0</span>;</span><br><span class="line">    <span class="type">char</span> ch=<span class="built_in">gh</span>(),t=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(ch&lt;<span class="string">&#x27;0&#x27;</span>||ch&gt;<span class="string">&#x27;9&#x27;</span>) t|=ch==<span class="string">&#x27;-&#x27;</span>,ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">while</span>(ch&gt;=<span class="string">&#x27;0&#x27;</span>&amp;&amp;ch&lt;=<span class="string">&#x27;9&#x27;</span>) x=(x&lt;&lt;<span class="number">3</span>)+(x&lt;&lt;<span class="number">1</span>)+(ch^<span class="number">48</span>),ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">if</span>(t) x=-x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> N,M,Idx,Vis[MAXN];</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Splay</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> chi[<span class="number">2</span>],fa;</span><br><span class="line">    <span class="type">int</span> size,val;</span><br><span class="line">&#125;Tree[MAXN];</span><br><span class="line"><span class="type">int</span> Root,Qx;</span><br><span class="line"><span class="type">char</span> op;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">underPushUp</span><span class="params">(<span class="type">int</span> x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Tree[x].size=Tree[Tree[x].chi[<span class="number">0</span>]].size+Tree[Tree[x].chi[<span class="number">1</span>]].size+<span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">underRotate</span><span class="params">(<span class="type">int</span> x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> y=Tree[x].fa,z=Tree[y].fa;</span><br><span class="line">    <span class="type">int</span> k=Tree[y].chi[<span class="number">1</span>]==x;</span><br><span class="line">    Tree[z].chi[Tree[z].chi[<span class="number">1</span>]==y]=x;</span><br><span class="line">    Tree[x].fa=z;</span><br><span class="line">    Tree[y].chi[k]=Tree[x].chi[k^<span class="number">1</span>];</span><br><span class="line">    Tree[Tree[x].chi[k^<span class="number">1</span>]].fa=y;</span><br><span class="line">    Tree[x].chi[k^<span class="number">1</span>]=y;</span><br><span class="line">    Tree[y].fa=x;</span><br><span class="line">    <span class="built_in">underPushUp</span>(y);</span><br><span class="line">    <span class="built_in">underPushUp</span>(x);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">Splay</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> k)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">while</span>(Tree[x].fa!=k)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> y=Tree[x].fa,z=Tree[y].fa;</span><br><span class="line">        <span class="keyword">if</span>(z!=k)</span><br><span class="line">            <span class="keyword">if</span>((Tree[y].chi[<span class="number">1</span>]==x)^(Tree[z].chi[<span class="number">1</span>]==y))</span><br><span class="line">                <span class="built_in">underRotate</span>(x);</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                <span class="built_in">underRotate</span>(y);</span><br><span class="line">        <span class="built_in">underRotate</span>(x);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(!k) Root=x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">underInsert</span><span class="params">(<span class="type">int</span> x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> u=Root,p;</span><br><span class="line">    <span class="keyword">while</span>(u)</span><br><span class="line">    &#123;</span><br><span class="line">        p=u;</span><br><span class="line">        u=Tree[u].chi[x&gt;Tree[u].val];</span><br><span class="line">    &#125;</span><br><span class="line">    u=++Idx;</span><br><span class="line">    <span class="keyword">if</span>(p) Tree[p].chi[x&gt;Tree[p].val]=u;</span><br><span class="line">    Tree[u].val=x;</span><br><span class="line">    Tree[u].size=<span class="number">1</span>;</span><br><span class="line">    Tree[u].fa=p;</span><br><span class="line">    <span class="built_in">Splay</span>(u,<span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">underInit</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Root=++Idx;</span><br><span class="line">    Tree[Root].fa=<span class="number">0</span>;</span><br><span class="line">    Tree[Root].val=<span class="number">0</span>;</span><br><span class="line">    Tree[Root].size=<span class="number">1</span>;</span><br><span class="line">    <span class="built_in">underInsert</span>(N+<span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">underGetPre</span><span class="params">(<span class="type">int</span> x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> u=Root,res,v=Root;</span><br><span class="line">    <span class="keyword">while</span>(u)</span><br><span class="line">    &#123;</span><br><span class="line">        v=u;</span><br><span class="line">        <span class="keyword">if</span>(Tree[u].val&lt;x)</span><br><span class="line">        &#123;</span><br><span class="line">            res=u;</span><br><span class="line">            u=Tree[u].chi[<span class="number">1</span>];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> u=Tree[u].chi[<span class="number">0</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">Splay</span>(v,<span class="number">0</span>);</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">underGetNxt</span><span class="params">(<span class="type">int</span> x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> u=Root,res,v=Root;</span><br><span class="line">    <span class="keyword">while</span>(u)</span><br><span class="line">    &#123;</span><br><span class="line">        v=u;</span><br><span class="line">        <span class="keyword">if</span>(Tree[u].val&gt;x)</span><br><span class="line">        &#123;</span><br><span class="line">            res=u;</span><br><span class="line">            u=Tree[u].chi[<span class="number">0</span>];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> u=Tree[u].chi[<span class="number">1</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">Splay</span>(v,<span class="number">0</span>);</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">underErase</span><span class="params">(<span class="type">int</span> x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> l=<span class="built_in">underGetPre</span>(x),r=<span class="built_in">underGetNxt</span>(x);</span><br><span class="line">    <span class="built_in">Splay</span>(l,<span class="number">0</span>),<span class="built_in">Splay</span>(r,l);</span><br><span class="line">    Tree[Tree[r].chi[<span class="number">0</span>]].size=<span class="number">0</span>;</span><br><span class="line">    Tree[Tree[r].chi[<span class="number">0</span>]].fa=<span class="number">0</span>;</span><br><span class="line">    Tree[r].chi[<span class="number">0</span>]=<span class="number">0</span>;</span><br><span class="line">    <span class="built_in">Splay</span>(r,<span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> top,S[MAXN];</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// freopen(&quot;splay.in&quot;,&quot;r&quot;,stdin);</span></span><br><span class="line">    <span class="comment">// freopen(&quot;splay.out&quot;,&quot;w&quot;,stdout);</span></span><br><span class="line">    <span class="built_in">underRead</span>(N),<span class="built_in">underRead</span>(M);</span><br><span class="line">    <span class="built_in">underInit</span>();</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=M;++i)</span><br><span class="line">    &#123;</span><br><span class="line">        cin&gt;&gt;op;</span><br><span class="line">        <span class="keyword">if</span>(op==<span class="string">&#x27;D&#x27;</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">underRead</span>(Qx);</span><br><span class="line">            <span class="built_in">underInsert</span>(Qx);</span><br><span class="line">            S[++top]=Qx;</span><br><span class="line">            Vis[Qx]=<span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(op==<span class="string">&#x27;R&#x27;</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            Vis[S[top]]=<span class="number">0</span>;</span><br><span class="line">            <span class="built_in">underErase</span>(S[top--]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(op==<span class="string">&#x27;Q&#x27;</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">underRead</span>(Qx);</span><br><span class="line">            <span class="keyword">if</span>(Vis[Qx]) <span class="built_in">printf</span>(<span class="string">&quot;0\n&quot;</span>);</span><br><span class="line">            <span class="keyword">else</span> <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,Tree[<span class="built_in">underGetNxt</span>(Qx)].val-Tree[<span class="built_in">underGetPre</span>(Qx)].val<span class="number">-1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">7 9</span></span><br><span class="line"><span class="comment">D 3</span></span><br><span class="line"><span class="comment">D 6</span></span><br><span class="line"><span class="comment">D 5</span></span><br><span class="line"><span class="comment">Q 4</span></span><br><span class="line"><span class="comment">Q 5</span></span><br><span class="line"><span class="comment">R</span></span><br><span class="line"><span class="comment">Q 4</span></span><br><span class="line"><span class="comment">R</span></span><br><span class="line"><span class="comment">Q 4</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure></details>]]></content>
      
      
      <categories>
          
          <category> 题解 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 平衡树 </tag>
            
            <tag> Splay </tag>
            
            <tag> Treap </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>P2073 送花</title>
      <link href="/Eternity/%E9%A2%98%E8%A7%A3/p2073/"/>
      <url>/Eternity/%E9%A2%98%E8%A7%A3/p2073/</url>
      
        <content type="html"><![CDATA[<script src="/js/mathjax.js"></script><p>$STL\ yyds!$</p><span id="more"></span><p>敲了半天的 $Splay$ 无果后索性换 $stl$ ，没想到居然还跑进了最优解！？<del>顺便学了一下 $map$</del></p><details>    <summary>AC Code</summary><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;ctime&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iomanip&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stack&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;map&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> gh() getchar()</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> underMax(x,y) ((x)&gt;(y)?(x):(y))</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> underMin(x,y) ((x)&lt;(y)?(x):(y))</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> ll;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN=<span class="number">1e5</span>+<span class="number">1</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> INF=<span class="number">0x7f7f7f7f</span>;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">underRead</span><span class="params">(T &amp;x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    x=<span class="number">0</span>;</span><br><span class="line">    <span class="type">char</span> ch=<span class="built_in">gh</span>(),t=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(ch&lt;<span class="string">&#x27;0&#x27;</span>||ch&gt;<span class="string">&#x27;9&#x27;</span>) t|=ch==<span class="string">&#x27;-&#x27;</span>,ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">while</span>(ch&gt;=<span class="string">&#x27;0&#x27;</span>&amp;&amp;ch&lt;=<span class="string">&#x27;9&#x27;</span>) x=(x&lt;&lt;<span class="number">3</span>)+(x&lt;&lt;<span class="number">1</span>)+(ch^<span class="number">48</span>),ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">if</span>(t) x=-x;</span><br><span class="line">&#125;</span><br><span class="line">map&lt;ll,ll&gt;M;</span><br><span class="line">ll op,w,c;</span><br><span class="line">ll res,ans;</span><br><span class="line"><span class="comment">/*int M,Idx,op;</span></span><br><span class="line"><span class="comment">struct Val</span></span><br><span class="line"><span class="comment">&#123;</span></span><br><span class="line"><span class="comment">    int w,c;</span></span><br><span class="line"><span class="comment">&#125;;</span></span><br><span class="line"><span class="comment">struct Splay</span></span><br><span class="line"><span class="comment">&#123;</span></span><br><span class="line"><span class="comment">    int chi[2],fa;</span></span><br><span class="line"><span class="comment">    int num,size;</span></span><br><span class="line"><span class="comment">    Val val;</span></span><br><span class="line"><span class="comment">&#125;Tree[MAXN];</span></span><br><span class="line"><span class="comment">int Root;</span></span><br><span class="line"><span class="comment">int Vis[MAXN],ans;</span></span><br><span class="line"><span class="comment">inline void underPushUp(int x)</span></span><br><span class="line"><span class="comment">&#123;</span></span><br><span class="line"><span class="comment">    Tree[x].size=Tree[Tree[x].chi[0]].size+Tree[Tree[x].chi[1]].size+Tree[x].num;</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment">inline void underRotate(int x)</span></span><br><span class="line"><span class="comment">&#123;</span></span><br><span class="line"><span class="comment">    int y=Tree[x].fa,z=Tree[y].fa;</span></span><br><span class="line"><span class="comment">    int k=Tree[y].chi[1]==x;</span></span><br><span class="line"><span class="comment">    Tree[z].chi[Tree[z].chi[1]==y]=x;</span></span><br><span class="line"><span class="comment">    Tree[x].fa=z;</span></span><br><span class="line"><span class="comment">    Tree[y].chi[k]=Tree[x].chi[k^1];</span></span><br><span class="line"><span class="comment">    Tree[Tree[x].chi[k^1]].fa=y;</span></span><br><span class="line"><span class="comment">    Tree[x].chi[k^1]=y;</span></span><br><span class="line"><span class="comment">    Tree[y].fa=x;</span></span><br><span class="line"><span class="comment">    underPushUp(y);</span></span><br><span class="line"><span class="comment">    underPushUp(x);</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment">inline void Splay(int x,int k)</span></span><br><span class="line"><span class="comment">&#123;</span></span><br><span class="line"><span class="comment">    while(Tree[x].fa!=k)</span></span><br><span class="line"><span class="comment">    &#123;</span></span><br><span class="line"><span class="comment">        int y=Tree[x].fa,z=Tree[y].fa;</span></span><br><span class="line"><span class="comment">        if(z!=k)</span></span><br><span class="line"><span class="comment">            if((Tree[y].chi[1]==x)^(Tree[z].chi[1]==y))</span></span><br><span class="line"><span class="comment">                underRotate(x);</span></span><br><span class="line"><span class="comment">            else</span></span><br><span class="line"><span class="comment">                underRotate(y);</span></span><br><span class="line"><span class="comment">        underRotate(x);</span></span><br><span class="line"><span class="comment">    &#125;</span></span><br><span class="line"><span class="comment">    if(!k) Root=x;</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment">bool f;</span></span><br><span class="line"><span class="comment">inline void underInsert(Val x)</span></span><br><span class="line"><span class="comment">&#123;</span></span><br><span class="line"><span class="comment">    int u=Root,p;</span></span><br><span class="line"><span class="comment">    while(u)</span></span><br><span class="line"><span class="comment">    &#123;</span></span><br><span class="line"><span class="comment">        if(Tree[u].val.c==x.c)</span></span><br><span class="line"><span class="comment">        &#123;  </span></span><br><span class="line"><span class="comment">            f=1;</span></span><br><span class="line"><span class="comment">            return ;</span></span><br><span class="line"><span class="comment">        &#125;</span></span><br><span class="line"><span class="comment">        p=u;</span></span><br><span class="line"><span class="comment">        u=Tree[u].chi[x.c&gt;Tree[u].val.c];</span></span><br><span class="line"><span class="comment">    &#125;</span></span><br><span class="line"><span class="comment">    u=++Idx;</span></span><br><span class="line"><span class="comment">    if(p) Tree[p].chi[x.c&gt;Tree[p].val.c]=u;</span></span><br><span class="line"><span class="comment">    Tree[u].val.c=x.c;</span></span><br><span class="line"><span class="comment">    Tree[u].val.w=x.w;</span></span><br><span class="line"><span class="comment">    Tree[u].size=1;</span></span><br><span class="line"><span class="comment">    Tree[u].fa=p;</span></span><br><span class="line"><span class="comment">    Tree[u].num=1;</span></span><br><span class="line"><span class="comment">    Splay(u,0);</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment">inline void underInit()</span></span><br><span class="line"><span class="comment">&#123;</span></span><br><span class="line"><span class="comment">    Root=++Idx;</span></span><br><span class="line"><span class="comment">    Tree[Root].fa=0;</span></span><br><span class="line"><span class="comment">    Tree[Root].num=1;</span></span><br><span class="line"><span class="comment">    Tree[Root].size=1;</span></span><br><span class="line"><span class="comment">    Tree[Root].val.c=INF;</span></span><br><span class="line"><span class="comment">    Val u;</span></span><br><span class="line"><span class="comment">    u.w=0,u.c=-INF;</span></span><br><span class="line"><span class="comment">    underInsert(u);</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment">inline int underGetPre(int x)</span></span><br><span class="line"><span class="comment">&#123;</span></span><br><span class="line"><span class="comment">    int u=Root,res,v=Root;</span></span><br><span class="line"><span class="comment">    while(u)</span></span><br><span class="line"><span class="comment">    &#123;</span></span><br><span class="line"><span class="comment">        v=u;</span></span><br><span class="line"><span class="comment">        if(Tree[u].val.c&lt;x)</span></span><br><span class="line"><span class="comment">        &#123;</span></span><br><span class="line"><span class="comment">            res=u;</span></span><br><span class="line"><span class="comment">            u=Tree[u].chi[1];</span></span><br><span class="line"><span class="comment">        &#125;</span></span><br><span class="line"><span class="comment">        else u=Tree[u].chi[0];</span></span><br><span class="line"><span class="comment">    &#125;</span></span><br><span class="line"><span class="comment">    Splay(v,0);</span></span><br><span class="line"><span class="comment">    return res;</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment">inline int underGetNxt(int x)</span></span><br><span class="line"><span class="comment">&#123;</span></span><br><span class="line"><span class="comment">    int u=Root,res,v=Root;</span></span><br><span class="line"><span class="comment">    while(u)</span></span><br><span class="line"><span class="comment">    &#123;</span></span><br><span class="line"><span class="comment">        v=u;</span></span><br><span class="line"><span class="comment">        if(Tree[u].val.c&gt;x)</span></span><br><span class="line"><span class="comment">        &#123;</span></span><br><span class="line"><span class="comment">            res=u;</span></span><br><span class="line"><span class="comment">            u=Tree[u].chi[0];</span></span><br><span class="line"><span class="comment">        &#125;</span></span><br><span class="line"><span class="comment">        else u=Tree[u].chi[1];</span></span><br><span class="line"><span class="comment">    &#125;</span></span><br><span class="line"><span class="comment">    Splay(v,0);</span></span><br><span class="line"><span class="comment">    return res;</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment">inline void underErase(int x)</span></span><br><span class="line"><span class="comment">&#123;</span></span><br><span class="line"><span class="comment">    int l=underGetPre(x),r=underGetNxt(x);</span></span><br><span class="line"><span class="comment">    Splay(l,0),Splay(r,l);</span></span><br><span class="line"><span class="comment">    Tree[Tree[r].chi[0]].fa=0;</span></span><br><span class="line"><span class="comment">    Tree[r].chi[0]=0;</span></span><br><span class="line"><span class="comment">    Splay(r,0);</span></span><br><span class="line"><span class="comment">&#125;*/</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// freopen(&quot;splay.in&quot;,&quot;r&quot;,stdin);</span></span><br><span class="line">    <span class="comment">// freopen(&quot;splay.out&quot;,&quot;w&quot;,stdout);</span></span><br><span class="line">    <span class="comment">/*underInit();*/</span></span><br><span class="line">    map&lt;ll,ll&gt;::iterator it;</span><br><span class="line">    <span class="keyword">while</span>(<span class="number">1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">underRead</span>(op);</span><br><span class="line">        <span class="keyword">if</span>(op==<span class="number">-1</span>) <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(op==<span class="number">1</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">underRead</span>(w),<span class="built_in">underRead</span>(c);</span><br><span class="line">            <span class="comment">// if(M.count(c)) continue;</span></span><br><span class="line">            M.<span class="built_in">insert</span>(<span class="built_in">make_pair</span>(c,w));</span><br><span class="line">            <span class="comment">/*Val Q;</span></span><br><span class="line"><span class="comment">            scanf(&quot;%d%d&quot;,&amp;Q.w,&amp;Q.c);</span></span><br><span class="line"><span class="comment">            f=0;</span></span><br><span class="line"><span class="comment">            underInsert(Q);</span></span><br><span class="line"><span class="comment">            if(f) Vis[Q.c]=Q.w;</span></span><br><span class="line"><span class="comment">            ans+=Q.w;*/</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(op==<span class="number">3</span>&amp;&amp;!M.<span class="built_in">empty</span>())</span><br><span class="line">        &#123;</span><br><span class="line">            it=M.<span class="built_in">begin</span>();</span><br><span class="line">            M.<span class="built_in">erase</span>(it);</span><br><span class="line">            <span class="comment">/*int x=underGetPre(INF);</span></span><br><span class="line"><span class="comment">            if(!Vis[Tree[x].val.c]) continue;</span></span><br><span class="line"><span class="comment">            underErase(Tree[x].val.c);</span></span><br><span class="line"><span class="comment">            ans-=Vis[Tree[x].val.c];</span></span><br><span class="line"><span class="comment">            Vis[Tree[x].val.c]=0;*/</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(op==<span class="number">2</span>&amp;&amp;!M.<span class="built_in">empty</span>())</span><br><span class="line">        &#123;</span><br><span class="line">            it=M.<span class="built_in">end</span>();</span><br><span class="line">            M.<span class="built_in">erase</span>(--it);</span><br><span class="line">            <span class="comment">/*int x=underGetNxt(-INF);</span></span><br><span class="line"><span class="comment">            if(!Vis[Tree[x].val.c]) continue;</span></span><br><span class="line"><span class="comment">            underErase(Tree[x].val.c);</span></span><br><span class="line"><span class="comment">            ans-=Vis[Tree[x].val.c];</span></span><br><span class="line"><span class="comment">            Vis[Tree[x].val.c]=0;*/</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(map&lt;ll,ll&gt;::iterator i=M.<span class="built_in">begin</span>();i!=M.<span class="built_in">end</span>();i++)</span><br><span class="line">    &#123;</span><br><span class="line">        ans+=(*i).second;</span><br><span class="line">        res+=(*i).first;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%lld %lld&quot;</span>,ans,res);</span><br><span class="line">    <span class="comment">/*printf(&quot;%d&quot;,ans);*/</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">1 1 1</span></span><br><span class="line"><span class="comment">1 2 5</span></span><br><span class="line"><span class="comment">2</span></span><br><span class="line"><span class="comment">1 3 3</span></span><br><span class="line"><span class="comment">3</span></span><br><span class="line"><span class="comment">1 5 2</span></span><br><span class="line"><span class="comment">-1</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure></details>]]></content>
      
      
      <categories>
          
          <category> 题解 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 平衡树 </tag>
            
            <tag> 线段树 </tag>
            
            <tag> Splay </tag>
            
            <tag> STL </tag>
            
            <tag> 单调队列 </tag>
            
            <tag> map </tag>
            
            <tag> set </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>S.H.A.D.O.W</title>
      <link href="/Eternity/Until-The-End/my-junior-high-school-life/"/>
      <url>/Eternity/Until-The-End/my-junior-high-school-life/</url>
      
        <content type="html"><![CDATA[<p>“追随影子的人，自己就是影子。”——《荷马史诗》</p><span id="more"></span><p>$\mathfrak{\color{Purple}{Separate\ Here,After\ Directing\ Our\ Ways}}$</p><h2 id="日志"><a href="#日志" class="headerlink" title="日志"></a>日志</h2><h3 id="Day-365"><a href="#Day-365" class="headerlink" title="Day-365"></a>Day-365</h3><p>现在回想初二考地生的时候。似乎还有那时背诵的激情。无论是考差了的奋勇而上，还是又比之前进步了之后的欣喜若狂。那时的激情也许是现在我最缺的东西。</p><p>$result:90+85=175$，约下来 $70pt$ 。不能算差，但也决不能算好。</p><h3 id="Day-99"><a href="#Day-99" class="headerlink" title="Day -99"></a>Day -99</h3><p>百日誓师大会，俗称<del>高中招生大会</del>。本以为会是带给我中考最后的激情的，但开始一个半小时的国际班和文化班的招生宣传实属把我恶心到了。以至于之后除了宣誓重回状态外，全靠唐某给我讲了讲<strong>求导</strong>。<del>虽然完全没学会</del>。</p><h3 id="Day-90-Day-88"><a href="#Day-90-Day-88" class="headerlink" title="Day -90~Day -88"></a>Day -90~Day -88</h3><p>很神奇的一段时间，因为填志愿的原因，一趟<del>被迫</del>免费的旅行就开始了。两弹城，方特，梓潼东辰……于是爷的加倍月假就无了。虽然一些细节是不太愉快的，但也许在中考之前，能与同学回归纯真的时间真的不多了。以后也不可能会有了吧……</p><h3 id="Day-Date-2022-3-14"><a href="#Day-Date-2022-3-14" class="headerlink" title="Day ??? Date: 2022-3-14"></a>Day ??? Date: 2022-3-14</h3><p>机房（？，应该是全校都断网了，南瘦。趁着一会儿把 $Luogu$ 打了卡后，就开始<del>摆烂</del>了，后来花了点时间把一阶段的新 $Lead$ 给写了，虽然和脑中的旋律不太一样，但也比以前好多了。</p><h3 id="Day-84"><a href="#Day-84" class="headerlink" title="Day -84"></a>Day -84</h3><p>艺术中考。</p><p>对于我这种美术常年一张试卷能错出 $10$ 道题的人，满分真的很难吧。也许就会和之前一样，成为又一个遗憾。上午有人考了，听说音乐简单出天际，美术难出天际……没希望了。什么中国画的五大元素（后来发现 $fAKe$ 了），什么兵马俑的制作工艺（本来以为上午考了下午就不会考了。结果我被 $AK$ 了，这道题就愉愉快快地错了）。在备考室快睡着了，等一个小时确实无聊。何况中午还在机房 $H_2O$ 。</p><p>考试期间，甚至没有隔开做，戴了眼镜旁边的一目了然，不过选择顺序不同，差点抄错几道。在题基本做完之后，<del>机房便充满了快活的气息</del>。音乐的音频总是能被挖掘出新的玩法。也许，即使各方压力都在不断实施，但我们这一届初三，也基本没有个初三样吧……不知道以后的学弟学妹们在这个时候又会是怎样的呢。</p><h3 id="Day-83"><a href="#Day-83" class="headerlink" title="Day -83"></a>Day -83</h3><p>眼镜镜片掉了一块，找了半天没找到。难受。</p><h3 id="Day-82"><a href="#Day-82" class="headerlink" title="Day -82"></a>Day -82</h3><p>寝室惨案。</p><h3 id="Day-81"><a href="#Day-81" class="headerlink" title="Day -81"></a>Day -81</h3><p>$Song$_$Gch$ 我滴超人，他居然帮我把镜片找到了（<del>虽然还是要换眼镜了</del>）</p><h3 id="Day-79"><a href="#Day-79" class="headerlink" title="Day -79"></a>Day -79</h3><p>网又双叒叕断了，<del>网与电不可兼得</del>。</p><h3 id="Day-77"><a href="#Day-77" class="headerlink" title="Day -77"></a>Day -77</h3><p>英语听说考试。</p><p>能在最近的地方（唯十多个在弘毅楼）的地方也是比较幸运的了。化学课 $H_2O$ 了十多分钟，因为不用赶路，所以备考室的时间额外的多，遇到了以前的生物老师，也许她从来也没有记得我过，但至少我还是有印象的。考生须知与英语老师所讲大相径庭。不过对我而言，两者都没有什么必要记下吧。按自己所想即好。第二大题的某一道题在练习的最后一刻改了回来，所幸没有读错，其他一切顺利。希望能突破最高成绩（ $29.3pt$）吧。</p><h3 id="Day-75-Day-74"><a href="#Day-75-Day-74" class="headerlink" title="Day -75~Day -74"></a>Day -75~Day -74</h3><p>第一学月知识清扫，又称初三学年第二次诊断考试模拟考试。就是高一学长们考过的二诊。中午在机房继续 $H_2O$ 出了 $CTT\ Phase2$ 的 $Cover$ 。头天晚上考了语文。阅读题是刘亮程的《木匠》，有史以来第一篇没读出褒贬色彩的文章，然后选择题就不出意外地错了。感觉作文还不错，手感极佳。不知道具体效果怎么样。晚上回来对答案直接对破防了，似乎错了五道选择题，希望有修改吧。第二天加油！</p><p>一起床就考数学，一上午的理科让人喘不过气。数学还比较顺利，一道题一道题地慢慢算，跳过了选择最后一道，填空题最后一道算出了 $sin \alpha = \frac{80}{\sqrt{7921}}$ 总觉得看着不像个答案，先跳过了。后面的题都中规中矩，顺利解决，倒数第二道题的最后一问似乎有两种情况，幸好瞎碰的时候发现了，没丢掉这几分。留了十多分钟来开 $\sqrt{7921}$ ，开到四十几的时候没时间了，开破防了，摆烂。吃午饭的时候听他们说似乎基本上都没有开出来。结果谁能想到 $\sqrt{7921}=89$ 呢，只有手撕根号的郭巨开出来了吧。。。</p><p>下午考文综和英语，中午难得睡了个午觉。中规中矩，反正不会做，碰运气吧。英语还好，仔细点都做得对，讨论的时候基本也差不多，该对的对，该错的错。没啥好说的。估计又考差了吧，没时间去思考了。</p><p>疲于奔命。</p><h3 id="Day-73"><a href="#Day-73" class="headerlink" title="Day -73"></a>Day -73</h3><p>对答案风波。直接炸裂，平均选择题 $4-5$ 道，没什么挣扎的必要了，估计又要遭批了。英语阅读虽然全对，结果语法又错了两个，裂开。所幸数学只扣了 $10pt$ 。希望能和预测的一样。</p><h3 id="Day-70"><a href="#Day-70" class="headerlink" title="Day -70"></a>Day -70</h3><p>放假前夕，成绩还是出来了。该炸的炸了，不该炸的也炸了。没办法，不能理解就是不能理解。数学抄错了一道填空题，还扣了 $13pt$ 的步骤分！？英语作文扣了 $5pt$ ，不能说什么……</p><p>$110pt+123pt+104pt+86pt+82pt<em>0.7+(79+72)</em>0.4pt \approx 536.4pt$ 。</p><p>各科不太准确，没看太清楚。“中考没人问你数学考了多少，只会问你总分是多少。”，差点进倒十。</p><h3 id="Day-64-Day-63"><a href="#Day-64-Day-63" class="headerlink" title="Day -64~Day -63"></a>Day -64~Day -63</h3><p>初中以来第一次托管，因为似乎除了绵阳籍的人都回不去，结果我爸妈还给我们班的人送了披萨我都回不去（就隔了一个门啊啊啊），在机房泡了一个晚上 $+$ 一个上午。开始了一个宏伟的计划（即<strong>随机100题</strong>，紧随 Rusun 和 mydcwfy 巨佬的步伐）。把 $The\ Past\ v5$ 写了一下，还不满意，修改一下再发给<strong>北柠</strong>。下周就是体考 $+$ 二诊了，体考 $70pt$ 都悬，二诊更没有底，听天由命吧。</p><p>晚上的数学周考居然把应用题算错了，最后一道题也没有算对，状态不太好，头又开始痛了。</p><h3 id="Day-59"><a href="#Day-59" class="headerlink" title="Day-59"></a>Day-59</h3><p>体考。</p><p>原本定周三考，但因为周三下午的竞赛课，所以我们四个班提前到了周二下午，<del>本来不紧张的，结果他这一整给我正紧张了</del>，考前吃了2块巧克力，喝了一罐红牛。<font style="color: white">兰姐让我们第一节下课喝，结果后来体育老师骂我们说：“你们这群傻子，这玩意儿是你跑完长跑站不起来之后才喝的。”，打脸.jpg。</font>在操场上排好，一边做准备运动，一边还在尝试立定跳远，看着从2.4到2.3再到2.2，<del>然后心里就越来越来没有底了</del>，不过还是硬着头皮上吧！！！</p><p>离考试还有半个多小时，老师一直在讲一些<strong>注意事项</strong>：</p><blockquote><font style="color: white">《我绝对不会告诉你踩线之后机器不报就继续跳》</font><p>多动脑，多思考。</p><font style="color: white">《我也不可能提醒你立定跳远和实心球踩线了就赶快跳出去》</font><p>秉承不吃亏也不犯规的原则。</p><font style="color: white">《我更不可能告诉你跑长跑时能提前就提前》</font><p>无论结果如何，请尽你的全力。</p><font style="color: white">《我不提倡，不建议，不同意，也不反对，也不支持，也不负责》</font><p>在后方，爱你们的体育老师永远支持你们。</p><font style="color: white">《如果你发现了什么小技巧，请悄悄地告诉你的同学，不要让监考老师知道》</font><p>请创造属于你们的辉煌。</p><font style="color: white">《什么中长跑抄近道，抢跑啊这些玩意儿的，没有老师教过你》。</font><p>by: 体育组组长唐松<font style="color: white">&amp;体育组纯净水派遣员罗巍</font></p></blockquote><font style="color: white;">挪威yyds，体育老师们真是太可爱了。</font>还打了一会儿乒乓，结果还没排到就进场了。前面便是战场。<font style="color: white">对于有一点，体育老师告诉我们：“乒乓球考完之后，老师会在你的手上写一个数字，代表你打的个数，如果不是20的话，记得，我们学校的老师在乒乓球篷子后面抽烟。”强调了<b>抽烟</b>二字，然后我们就都笑起来了。</font><p>进场，扫了身份证之后第一项是引体向上。排在我前面都满了，搞得我很慌，<del>毕竟曲臂10个都有点悬</del>，然后<font style="color: white">不</font>紧张地入场，本来是想向某田那样卡机器bug的。然后犹豫了，就没卡上，然后硬着头皮又上了。前7个曲臂都算上了，这是个好兆头，但是第8个似乎没算上（后来发现其实算上了，只是我没听到），然后就换成了直臂，用着我那没有个所以然的摆动技巧+硬拉了2个，有几个同学告诉我可以下来了，然后$Wise\ Man$ <font style="color: white">李承骏</font>大喊：“还差一个”，然后当时我又没力气了，然后吊在那里出冷汗，幸好老师大喊：“不要瞎说！以机器为准”。然后我才惶惶地下来了，幸好还是满了，当时真的想把那傻子打一顿。</p><p>第二个就是立定跳远，最没有把握的一项，前面几个巨佬不出所料依然是 $AK$ 的，包括马老师和总统都是满的，然后稍稍续了力，第一跳234，差了很多，第二次调整了一下心态，跳了237，历史峰值，虽然没有满，但已经很满足了，希望在最后的60天能够跳到250吧。</p><p>第三项球类，似乎是整个体考里最 $H_2O$ 的一项，毕竟是人测。<del>你说有没有一种可能，前面的一些空并不是排版问题，我只是说一种可能</del>。在进场之前，结果他四个人四个人的进场，导致我错失了马老师<font style="color: white">李驰</font>的球拍，只能使用总统<font style="color:white">杨紫轩</font>的球拍，结果六星真神弹性超强，第一颗球直接弹飞了。后面倒是发挥正常，全部算分。靠自己实力得了满分，没有借助外力。</p><p>最后一项1000米。四字方针：往死里跑。仅此而已，即可。<font style="color: white">起跑线向前移了也没多少，没必要。</font>起跑口令声音太小，都是蟹老板<font style="color:white">解子力</font>提醒了我们才开始跑的，前一圈半，小组第四，非常顺利，鼻子也没堵，甚至于把马老师甩在了后面。第二圈开始，脑袋一片空白，面前是走马灯的场景，身体已经到达了极限，然后看着小组同学一个又一个从身边经过。最后冲刺阶段，老师在场外大喊：“不要着急，还有1分钟！！”，然后我就没慌了，继续按速度跑下去，<del>我还不信我1分钟跑不完100米</del>。然后看见马老师超了过去，又想：“人生仅此一次的体考，何不努力呢。”然后就开始超负荷运转去追马老师，虽然最后没有追上，冲刺还差点摔了一跤。最后成绩3分37秒。足足比以前进步了20秒！！！虽然跑完之后十分狼狈，但足矣。</p><p>最终成绩：$20pt+20pt+17.4pt+20pt=77.4pt$ ，历史最高，虽然不是满分，但也是尽全力的结果了。后来去食堂吃饭，已经没多少人了。打了一碗饭，甚至已经没有力气去嚼了，又全部倒了。也就没有吃晚饭。阿姜<font style="color:white">姜历阳</font>扶着我回了教室，还在食堂吐了。可以说是非常狼狈了。<del>五年来第一次穿短裤</del>。青春的激情亦是如此吧。回到教室后，一切也就像没发生一般。开始复习二诊，这一次，我的热情也再次迸发了。</p><font style="color:white">悄悄膜拜两位满分的宋巨</font><p>二诊加油！！！</p><h4 id="Day-80-Day-61"><a href="#Day-80-Day-61" class="headerlink" title="Day-80~Day -61"></a>Day-80~Day -61</h4><p>晚上下了晚自习来到操场，虽然已是睡觉的点，但至少有一百多号人。大家都在为体考努力着。唐queen<font style="color:white">唐骏宇</font>陪着我一起来锻炼，每天如此，疲惫着回到寝室，又在床上疯了一般做俯卧撑和仰卧起坐。也许没有什么成效，但至少，这才是作为少年而言，应该去追逐的——$\mathfrak{Dream}$。</p><h3 id="Day-57-Day-56"><a href="#Day-57-Day-56" class="headerlink" title="Day -57~Day -56"></a>Day -57~Day -56</h3><p>二诊。</p><p>上午九点的语文，前两个小时全是复习语文。（事实证明复习了与没复习无异，一直复习《儒林外史》结果谁又知道考的是《西游记》呢）题比较和善，<del>毕竟字音字形没错</del>。至于其他的，中规中矩。散文是《油菜花编织的旧街》，议论文是什么儿童阅读之类的文章，具体忘了。作文是以“馈赠”为话题，以前倒是写过以《你的馈赠，点燃了我》为标题的作文，但也忘得差不多了。就用我那 $128MB$ 的文采糊了一篇，编不下去了就偏题了……</p><p>下午的英语和文综，英语中规中矩，也就只能这么形容了，毕竟考完似乎都没人在讨论。文综的时政没复习到，但还好都能蒙出来。文综居然考到了 $6:30$ 人都快饿傻了。感觉这次比较简单（寝室的政史大佬告诉我们很多坑，笑容凝固了）。晚上还彳亍。睡了吧，文科考完了就考完了。明天理科加油！</p><p>依然是上午九点的数学。先扫了一遍题，比较正常，乍一看没什么偏题，然后用 $10s$ 切掉了前 $6$ 题，用了后 $10min$ 切掉了后 $6$ 题。选择题比较基础，压轴题也不算难，一遍算对。填空题也差不多。后来做的时候就没看时间了，觉得肯定来得及。$18$ 题思路出来了，但是用了超纲知识，比较难算，先放了放，往后做……一直没看时间，感觉这次绰绰有余。然而，在我做倒数第二题时，$15min$ 的铃打了。把我吓了一跳，脑袋有点复杂。（我不能理解为什么感觉数学比较简单，计算量也不太大，结果差点没做完？）可能是状态不太好，然后发现第 $3$ 问不会做，就线条了。把压轴题切了之后回去把 $18$ 题算出来，检查了一下计算题和方差，继续 $\text{ban}$ 倒数第二题，在只剩 $5min$ 时，总算 $\text{ban}$ 出来了，放心交卷。我们考试有一个平行班女生死活不交卷，似乎是没涂选择题，最后死缠烂打涂完交了。</p><p>中午吃饭时，才发现似乎很多人都没有做完。计算题好像错了一大堆。差点以为我也错了，幸好没错。最喜剧的是，花卷<font style="color:white">邓发文</font>告诉我他没有涂选择题，复习的一节课：$20min$ 回忆 $20min$ 后悔 ，挺惨的，直接丢掉 $36pt$ 。</p><p>下午理综，比起前面几科还算正常，正常答题，正常交卷，状态不错，物理概念混淆导致似乎又要错几道选择题。</p><p>祈祷 $ing$</p><p>数学晚自习，对下来答案发现我第 $7$ 题忽略 $x=0$ 出错了，焯！真想把自己杀了，$\text{ban}$ 了许久的倒数第二题最后一问也错了，还错了一个范围，至少 $9pt$ 。人麻了， $140pt$ 无望。希望不要扣步骤分，不然像上次一样扣个几十分步骤分又得起飞。</p><h3 id="Day-55"><a href="#Day-55" class="headerlink" title="Day -55"></a>Day -55</h3><p>上午的英语和语文，语文选择题没错。英语错了 $1$ 道完形填空，又是没有联系上下文导致的错误。信息摘录有点蹊跷，不详。</p><p>下午搞化学，选择全对，比较开心。后面的填空可能有 $3$ 道，估计不会上 $10pt$ ，<del>希望</del>。</p><p>晚上的信息学大起义，终于放周假了。二诊结束，在中考之前也没有什么好担心的了。</p><h3 id="Day-54"><a href="#Day-54" class="headerlink" title="Day -54"></a>Day -54</h3><p>网易云音乐人账号申请成功了，接下来要致力于音乐制作了，原神什么的还是先咕一段时间了。要追上北柠<font style="color:white">龚杨益</font>的步伐了呢。试着在网易云上找到我吧。</p><h3 id="Day-53"><a href="#Day-53" class="headerlink" title="Day -53"></a>Day -53</h3><p>做了一中午的两段新 $Lead$ ，然后在 $1:50$ 的时候未响应了。离大谱，思路一断，只有周五才能重新写了，破防了。怪不得今天是四月打卡的第一个凶。晚上的英语周考直接起飞，$\text{9道阅读完型+2道信息摘录}$ ，扣出 $22pt$ 的高分……</p><font style="color:white">想恋爱了。</font><h3 id="Day-50"><a href="#Day-50" class="headerlink" title="Day -50"></a>Day -50</h3><p>似乎是这一天，二诊成绩出来了。</p><p>语文和物理炸了。其他似乎还彳亍。可惜还是没有Song_Gch<font style="color:white">宋冠程</font>巨佬强，<del>总算不是寝室和机房垫底了</del>。</p><script type="math/tex; mode=display">121pt+139pt+115pt+88pt+96pt*0.7+85pt*0.4+88pt*0.4=731(599)    \nonumber</script><p>语数外物化政史。就很离谱，<del>离600仅有一步之遥</del>。</p><p>挺离大谱的，对下来语文作文才 $44pt$ ，甚至还有人 $26pt$ 的语文。可能这次有点严。</p><font style="color:white">晚上，邓发文似乎因为过左而速通失败了。挺惨的，也算是一个比较大的挫伤吧。</font><br><font style="color:white">“我也只是个孩子啊……”</font><h3 id="Day-46"><a href="#Day-46" class="headerlink" title="Day -46"></a>Day -46</h3><p>省选名单已出，在线膜拜省队爷wfy。</p><h3 id="Day-45"><a href="#Day-45" class="headerlink" title="Day -45"></a>Day -45</h3><p>今天中午去拍了毕业照，顶着八分熟的太阳坐在草坪上。还要求穿运动外套。本来打算要睡午觉的，又睡不成的。虽然刚开始都在抱怨，但最后似乎都是很开心的。</p><p>先拍小集体照，$10$ 个人一组。和徐姜<del>马</del>邓等人一起。</p><p>然后单人照。最后是集体照。有摆出的 $45$ ，还有中规中矩的团体照。还有穿着博士服的毕业照。</p><p>最强的是，最后分成了原来的 $45$ 和 $46$ 班，爷的青春又回来了。看着他们恭迎西昌大帝回归，和猴王又站在一起。也许，感慨还是很多的吧。</p><p>语文作文想写《忽而今夏》，纪念一下为数不多的青春吧。</p><h3 id="Day-43"><a href="#Day-43" class="headerlink" title="Day -43"></a>Day -43</h3><p>物化实验操作考试。</p><p>化学：牌号 $5$ ，实验 $2$ 。组装实验室制取氧气的装置。</p><p>没想到居然是最简单一个，属实是三生有幸了。</p><p>物理：牌号 $2$ ，实验 $1$ 。探究凸透镜成像问题。</p><p>也比较简单，只是说需要填的空比较多。希望没有填错。</p><p>到头来，似乎和去年的生物实验操作考试一样 $H_2O$ 。<del>没有得到满分的也帮忙给处理了</del>。就这样过去了吧。</p><h3 id="Day-34"><a href="#Day-34" class="headerlink" title="Day -34"></a>Day -34</h3><p>没有时间了，是时候暂时 $AFO$ ，考虑一下眼前的中考了。</p><p>还进行了第三学月月考，状态不佳。下周三诊，下下周二模。</p><h3 id="Day-28-Day-27"><a href="#Day-28-Day-27" class="headerlink" title="Day -28~Day -27"></a>Day -28~Day -27</h3><p>估计是最后一次更新了，这周因为严重的疫情又得托管了。（还有可能中考之前也回不去的DY人，挺惨，希望不要是这样）</p><h3 id="Day-26"><a href="#Day-26" class="headerlink" title="Day -26"></a>Day -26</h3><p>还是滚回来继续写了，最近状态一直不太好，<font style="color:white">或者？整个人都不太好了。</font>嗯……能否有未来呢。不要再让我振作起来了吧，我真的快受不了。今天做了一个英语阅读，里面有一句比较有哲理的话：“看上一个人需要 $1$ 秒，喜欢一个人需要 $1$ 个小时，爱上一个人需要 $1$ 天，而忘记一个人需要 $1$ 辈子。”<font style="color:white">“比起去想未来如何活着，还是想着如何去死更简单一些。”，突然觉得《重启人生》里的这句话真的很有道理，虽然我并没有打算那样做，也不代表我已经放弃生活了，可能只是……有些？悲观的想法吧。</font></p><h3 id="Day-21-Day-20"><a href="#Day-21-Day-20" class="headerlink" title="Day -21~Day -20"></a>Day -21~Day -20</h3><p>三诊（游仙区二诊）。</p><p>大寄了，语文<strong>甘败下风</strong>，错了个字形，数学更是吊炸天，压轴题全对，结果 $20\sim 23$ 题，没一个对， $130+$ 都有点悬，幸好其他<del>似乎</del>没炸。化学 $-2pt$ ，物理 $-5pt$ ，中规中矩。</p><p>本来是不打算写这次的，因为没必要，下周就是四诊（涪城区三诊），中考之前全是大考，周周大考。主要是为了纪念一篇语法填空，（虽然错了 $4$ 道）</p><blockquote><p>It was 37 ℃ in Los Angeles, California. <strong>Toby</strong> had made plans to go hiking(徒步) today,His mum told him <u>not to go</u>(not go) because it was too hot. Toby still wanted to go. Toby and his friend drove up to the hiking trail(小路). When they got <u>off</u> the car, they felt the heat at once. “Toby, I’m starting to sweat already,” his friend said.”You <u>will be</u>(be) fine. Just drink some water.” Toby said.</p><p>As they started walking, they noticed that the plants were all brown. They all died! There were not a lot of people hiking <u>either</u>. Toby’s friend started to put sunscreen on.”Want some?” he asked. Toby said,”I don’t get burned.” “Well, suit <u>yourself</u>(you),” his friend said. As they continued walking, the trail <u>got/was getting</u>(get) steeper and steeper(陡峭的). “Hey Bryan, remember that one time your mum hiked with us?” Toby asked. It was completely <u>silent</u>(silence). Toby turned around. Bryan was on the ground! He had passed out.</p><p>Toby called the police. When the police came, they told Toby that Bryan passed out from the <u>heat</u>(hot). “You shouldn’t be out on a day like this,” they said. Toby rode with Bryan to the hospital. He even sat beside Bryan <u>until</u> he was out. An hour later, Bryan was up. Toby hugged(拥抱) him.”You’re totally red!” Bryan said. Toby looked at himself and saw that both his arms <u>were sunburnt</u>(sunburn).</p></blockquote><h3 id="Day-19-Day-4"><a href="#Day-19-Day-4" class="headerlink" title="Day -19~Day-4"></a>Day -19~Day-4</h3><p>我想，之后也不会很久才回来机房，所以也不会很频繁的更新，当然，具体时间也记不太清了。如果能想起来，就作为四级标题吧。</p><hr><h4 id="Day-19"><a href="#Day-19" class="headerlink" title="Day -19"></a>Day -19</h4><p>Eternaltale 的一周年就这么到了，糊了一首 Eternalania 就混过去了，我真的很开心有人一直支持我走到这一步，无论我认识与否，无论相隔多远，<strong>因为热爱，所以坚持。</strong></p><hr><p>上周游仙的成绩嘛，比我估计的要好，我以为是倒数呢，结果还是四十多名，年级 269 ，要继续加油了。<font style="color:white">还是在某个人后一位，真神起。</font></p><hr><h4 id="Day-14"><a href="#Day-14" class="headerlink" title="Day -14"></a>Day -14</h4><p>决定不会再来机房了，下周估计竞赛课也真正地要停了。告别这个位置了吧，格式化之后，也不会有什么留念了。</p><p><code>B003</code></p><p>再见。</p><p>六月，不能再有遗憾了。</p><hr><p>下午，竞赛课结束之后，想了很多，那个晚上都挺郁闷的，然后就写下了这段话：</p><blockquote><p>现在看来，曾经有两条路摆在我的面前，终点分别是我此生梦寐以求的事物。于是我犹豫着，直到我想起来要做出选择的时候，已经晚了。</p><p>眼前仅有一条没有未来的路了，而那些我追逐的同伴，早已搭乘了另一次航班。</p><p>最后，还真活得像影子一样，曾经的我无所事事，现在的我一无是处。或许，我的人生还真是失败。</p></blockquote><hr><h4 id="Day-13-Day-12"><a href="#Day-13-Day-12" class="headerlink" title="Day -13~Day -12"></a>Day -13~Day -12</h4><p>涪城三诊，实则四诊。</p><p>稳定发挥，一般般罢了。</p><p>主要是 Day 2 的时候午觉提前醒了，发现隔壁高中在放歌。仔细一听才发现是<a href="https://music.163.com/#/song?id=1409311773">《夜に駆ける》</a>，然后就起飞了。估计也就是因为这个，整个下午虽然脑子清醒了，身体没跟上。然后理综就寄了。</p><p>语文 5 道仙人，大寄。</p><p>然后成绩就愉快的出来了。</p><p>$118pt+145pt+112.5pt+95pt+97pt<em>0.7+(77pt+91pt)</em>0.4=606.5pt$</p><p><del>语文和政治稳定发挥。</del></p><p>年级 86 ，班级 28。徐神之后一位。</p><p>总算是正常了，希望这个状态维持到中考。</p><p><del>最近倒是越复习越郁闷了</del>。</p><h4 id="Day-11"><a href="#Day-11" class="headerlink" title="Day -11"></a>Day -11</h4><p>五大竞赛会晤餐厅。</p><p>似乎是五科竞赛一起请吃饭。（据说生物顶不住其他四科的压力，哈哈）四个班的班导也来了。</p><p>开场秀：淦神杯酒释<del>兵权</del>。</p><p>其他四科的同学基本上 7:30 都走完了，就留下信息学吃到 8:30 才走。（可能是因为刚开始都在为淦神操心）Rusun 给我们讲了很多，也给赵悦岑和 Sukwog 讲了很多。不知道如何吧，喝了一些酒，精神多了。晚上回去把 EOT 的 Phase 1 给完善了，中考之后再做 OST 。<code>wanhui</code> 说 15 号就上课，难受。</p><h3 id="Day-3-Day-2"><a href="#Day-3-Day-2" class="headerlink" title="Day -3~Day -2"></a>Day -3~Day -2</h3><p>中考全真型模拟考试兼最后的内假。</p><p>总而言之，就是去找回了状态，都还是不错的，数学唯一错了的题居然是一道计算。</p><p>內假晚上和发卷和姜一起吃了一顿，然后早早睡觉了。没有必要再玩下去了，是时候该认真了。</p><h3 id="Day-1"><a href="#Day-1" class="headerlink" title="Day -1"></a>Day -1</h3><p>$6.10$</p><p>那么，是时候出征了。上午穿了班服，质感和校服无异，结果学校通知老赵出征不能穿班服或者校服。然后这件 200 多元的衣服，就这样毫无用处的被废弃了。</p><p>下午，出征仪式，看到似乎是三十多班的班服，大红的底，背面一个帆船的样子，刻印了所有人的名字，前面用艺术字书写了“遇见”。好吧，不得不承认，我们班的还是太 $\mathcal{low}$ 了。<del>自家的梗遭别人搬去了。</del></p><p>今天一早起来居然头痛，嗓子痛，好像是感冒了，然后很慌，这件事必须在今天解决，如果拖到了明天实属不幸。还好姜有前车之鉴，有藿香正气<strong>水</strong>，我刚开始以为这玩意儿和藿香正气<strong>液</strong>一个味道，直到我喝下去……哇，味道不亚于干吃一坨芥末，<del>估计这就是为什么能够治头痛的原因。</del>狂喝了四瓶，晚上感觉好多了。</p><p>热血沸腾吧只能说，嗓子都快喊哑了，授状元旗，授出征旗，老师们的鼓励（<del>土之宏四杀</del>），穿越状元门等等。我在绵中考的，姜在绵外考的，徐神也在绵中。车上还挺热闹的，虽然不知道淦神总是喜欢想些有的没的，无所谓了。<font style="color:white">与我无关。</font></p><p>绵中真的很大，校园环境也很好，半山腰的风景也不错。教室很宽敞，居然在活动教室考，而且还在讲台旁边，属实是三生有幸了。侧立试空调，讲台配置话筒，无死角扩音。当然，并没有使我心动就是了。</p><p>晚上翻来覆去说不着，一直在想一些之后的事，并不是紧张，但就是睡不着，有些事，需要被结束。</p><h3 id="Day-0"><a href="#Day-0" class="headerlink" title="Day 0"></a>Day 0</h3><p>当时钟从 $date:2022.6.10$ 滑向 $date:2022.6.11$ 时， $Day\ 0$ 已然结束。</p><h3 id="Day-1-1"><a href="#Day-1-1" class="headerlink" title="Day 1"></a>Day 1</h3><p>那么，光子开始实现负增长了。</p><p>回到了 $6:40$ 的作息，七点整到教室开始复习语文，也只是清风乱翻书罢了。更多的，则是祈祷。头不痛了，如此甚好。</p><p>$8:00$ ，启程。</p><p>进考室，揣了个板子垫桌子。还拿了瓶藿香正气水备用。</p><p>语文，先看答卷，中规中矩，作文格子有点多。</p><p>再发题卷，乍一看还好，名著《水浒传》杀了一个回马枪，作文有点难构思，其他没什么大碍。</p><p>感觉字音错了，又好像没错；感觉字形错了，又好像没错；感觉成语错了，又好像没错；感觉病句错了，又好像没错；感觉涂错了，又好像没错。</p><p>……</p><p>留了 80 分钟写作文，还差点没写完。旁边那个女生打铃之后还在涂卡，监考老师直接把她笔甩了。离谱。</p><p>下午，英语和文综。</p><p>英语 20 分钟完成小题，40 分钟完卷，说实话，没想到会这么简单（<del>虽然不一定考得好</del>），然后就开始稀里糊涂了。</p><p><a href="https://www.bilibili.com/video/BV1GJ411x7h7?spm_id_from=333.337">文综资料</a></p><p>被骗了吗？我考的时候就是这个感觉。</p><p>我真的无话可说了，所有周考，月考，大考，四次诊断，全真型模拟考试，全部都是已政史史政的顺序，出题，你你你您你您中考，就史政政史了？！？！？！当时拿下题卷一看，wc，哪家政治大题 $22pt$ 啊？？？哪家历史小论文分四个小问啊？？？？</p><p>属于是，出题老师把全绵阳市考生和老师都变成小丑了。</p><p>离谱。</p><p>理科不要再更离谱了。</p><p>说实话，文科普遍简单，对我而言，不算灾难，也不算赐福。只能任其发挥吧。作为贯培之人，真正的战场，在明天。</p><p>晚上回寝，去找了老孙，然后做了自己应该做的。真的很愧疚，一直甚至连老孙的生日是多久都不知道。</p><h3 id="Day-2"><a href="#Day-2" class="headerlink" title="Day 2"></a>Day 2</h3><p>一样的时间。</p><p>上午数学。乍一看，似乎也没有多难，就开始放松心态慢慢做。选择和填空题的压轴题都一遍推了，然后。</p><p>23 题第 2 问就卡了。</p><p>说真的，从初三开始，数学试卷的第 23 题我就没做出来过。明明真正的压轴题应该是 24 和 25 才对啊啊啊啊啊啊啊啊啊啊啊啊。</p><p>然后就跳了，剩下 40 分钟，先通篇检查了一遍，然后开始 $ban$ 23 题。解出来应该是一个一元四次根式方程，硬解了。然后解出来一个不太正确的答案，然后继续，只剩 5 分钟，发现消元消错了。然后 3 分钟超极限运作解了一个一元三次方程，总算是把第 2 问给解决了。但因为一直怕打铃所以不敢动笔了，第 3 问已经算出来了，但不敢写了，挺可惜的。如果当时就开始写的话，其实应该是赶得上了。只能说自己胆子太小了吧。</p><p>下午理综，中规中矩，除了物理有一道题数据极其复杂。算出来有一个高度是 $30\times\frac{20}{29}$ ，你懂的，物理不能有分数，它还是个圆柱，$\pi=3.14$ ，我一直以为数据错了，然后将整张草稿纸都献给了这道题，第 32 题。在车上对答案是，居然还和总统算的一样，挺开心的。</p><p>那么，结束了。</p><hr><p>但是，$date=2022.6.12$ 还没有结束呢。</p><p>回到了 DC ，家长们在两旁欢送，红色奔驰带领大巴开路，一切都以准备就绪，终末降至。</p><p>首先是学校为 2019 级准备的毕业典礼，在欢声笑语中，不仅是对过去的回忆，同样是对未来的展望。<del>死去的活动突然攻击我，不存在的记忆涌上心头。</del>一晃啊，三年真的就过去了。最后一次，我，姜，徐神的欢悦了吧。</p><p>直到接近 6 点，回到教室，嘈杂中，却不知说什么。盛夏的黄昏还没有到来，天依然是亮堂的。接着，老赵进来了。关上门，窗，帘。</p><p>“于是，我们的旅程到头了。”</p><p>发放着绿敞的毕业证，琉璃般的相册。然后，便安静了。</p><p>她开始回忆自己<strong>走过</strong>的路，自己的小学老师，自己的初中老师，自己的高中老师，自己的大学老师。以及，因为自己作为班主任，女儿在身边，不知不觉地长大。然后，泪，悄然滑落。忽而盛夏，重点，果然还是在忽而吧。</p><p>结束时，我第一个离开了教室，并不是因为我对此没有留恋，只不过，应该见的人，总是会相见的。我是一个对别离无感的人，并不是岁月磨损了我的情感，只不过，这世上有太多的分别，让我无暇兼顾罢了。</p><hr><p>晚上，和父母在小店里吃肥肠，此时，我是那 7 个没有参加毕业聚餐的人之一。很可惜，但也不后悔。夜至，启程，踏上归途。听着 CZTV 的歌，不知为何，对审判曲也产生了一丝疲倦，或许并不应该是那个被审判的人吧。直到 11 点才到家，没有什么睡意，就开始打原神，看番，干自己应当去干的事，并写下了接下来的一大段话。</p><p>便是，</p><p>久久不能忘怀。</p><h3 id="Day-8"><a href="#Day-8" class="headerlink" title="Day 8"></a>Day 8</h3><p>这是于我而言，更重要的聚会。</p><p>一共 $5$ 家人，我，老孙，田总，杨老师，和丹丹老师。很自然的，小孩聊小孩的，大人聊大人的。老孙摆着 $47$ 班的事，我摆着 $45$ 的事，邓摆着绵中的事，回忆如潮水般涌现。陪着豆瓣（丹老师儿子）一起打屁股肉，总之，虽然最后回到家已经九点半了，但我也是快乐的。</p><p>老孙送了我一支紫罗兰的羽毛笔作为毕业礼物，他也最终发了动态表示了对初中的总结。算是落幕了吧。</p><p>$\mathfrak{Until\ The\ End.}$</p><h3 id="Day-11-1"><a href="#Day-11-1" class="headerlink" title="Day 11"></a>Day 11</h3><p>成绩既出，终将结束。</p><hr><h2 id="暗语别离，各赴彼方"><a href="#暗语别离，各赴彼方" class="headerlink" title="暗语别离，各赴彼方"></a>暗语别离，各赴彼方</h2><p>我想，这就是最后一站了吧。 </p><p>即使是在盛夏的今天，在盖上笔盖的那一刻，在走出毕业门，走出那个拥挤着68个人的教室之后，曾穿着迷彩服奔向操场的记忆，却又在脑海的另一头唤起。 </p><p>父亲曾说：“人们幻想未来，长息度日如年；却又在回忆过去，感叹年岁易晚。” </p><p>也许，只有真正走过了，才会明白所谓的“岁月如梭”。</p><p> 这是我人生中，第二个难忘的三年。拥有着天下独绝的意义。</p><p>可惜曾徘徊许久，直到现在才明白自己真正应该去追求的东西，真正在代码的海洋中畅游，在乐韵的长空中翱翔，撰写地域之诗。 </p><p>老大曾说过：“所谓成长，便是当你回忆你曾干过每一件事，都不算人事的时候。” </p><p>此话有理。 </p><p>唯有凛春不可窥探，而未遇的星霜终会到来； </p><p>唯有盛夏不可触及，而忽而之岁月值得等待； </p><p>唯有荏秋不可遇见，而相逢的枫花梦殇灵白； </p><p>唯有深冬不可僭越，而将至之高空长氤云海。 </p><p>霜花同蝉鸣共绘的四时之诗，是你我往昔的恋依；</p><p>黄昏与白昼共奏的四季之歌，是你我余烬之追忆。 </p><p>未结束的围棋局，是你我曾许下的诺言，当人生的历程殆尽，我与你终会在碧霄之上遇见。 </p><p>天斗的沙漏，上帝的眼睛；</p><p>终幕的碑铭，恒永的陨星；</p><p>亘古的琴吟，末世的魂萦； </p><p>尘埃的追忆，传说的往昔。 </p><p>万象已定，绝怠者轻弹暗语，终至别离。</p><p>很可惜，东辰的教育制度也有不足。 </p><p>一方面，因人制宜； </p><p>另一面，众人无谊。 </p><p>曾有两年的积淀，却在最后一年散尽；</p><p>现有一载之追忆，却又不俟离别之时。</p><p>若有缘，我们将再读三年；若无缘，就此别过，天涯共月。</p><p>或许，除开只放了3天的假期不说，还算是挺完美的，但我其实早已料到。我曾选择了这条路，我不会后悔，我不能后悔，我也必须前行。</p><p>S.H.A.D.O.W </p><p>Separate Here, After Directing Our Ways. </p><p>我们在喃喃暗语中别离，寻梦自己更远的彼方。</p><p>奔走尘世间，浮沉余梦中，狂愚者幻想，妄誓者歌醉。 </p><p>愿，</p><p>姜，奇异啵士；唐雎，徐神，马老师，贾娃，怀斯曼，邹煞，发卷，知津；郭神，卢神，墨神；唐克温，达达，靳哥，沛沛，国王，总统；大姐，罗老师，飞老师，蒋神，博爷，俊江，子睿，<font style="color:white">言若</font>…… </p><p>当然， </p><p>冠神，淦神，赵悦岑…… </p><p>以及，</p><p>老龚，韩巨，吴彦祖，大哥，秃鹫，仓鼠，旌哥，严怡，家齐，女皇，皇上…… </p><p>永远记得这里有等着你们的刘叔。</p><p>还有， </p><p>老赵，土老师，长城爷爷，张妈妈，康康…… </p><p>不会忘记你们的欢声笑语。</p><p>和，</p><p>那两位陪伴我度过了六年的人。 </p><p>或许，6月12日有它另外的意义。愿德斯德洛林长存…… </p><p>我回来了，就如同我曾从这里出发。</p><p>2022.6.12 中考之后 written by 听风Eternal, also FallsnShadow. </p><p>彳亍之行，终至尽头。</p><p>那么，</p><p>乘客们，2022 的车到站了，不过，也只是提醒你们， </p><p>该换乘了。</p><hr><h2 id="应该纪念的"><a href="#应该纪念的" class="headerlink" title="应该纪念的"></a>应该纪念的</h2><h3 id="2020年的冬天-x-徐神"><a href="#2020年的冬天-x-徐神" class="headerlink" title="2020年的冬天 x 徐神"></a>2020年的冬天 x 徐神</h3><p>如果熟悉我的人，应该都会明白，年少时的我，在那个时候，和她相遇了。</p><p>……</p><p>说实话，我现在并不是很想写了。如果仅仅是一句“谢谢”都没有的话，我去纪念这也没有什么意义了。还不如多谈谈徐神。</p><p>徐神是个很神奇的人，他干的所有事情都让你有些讨厌他，但你又会发现那只是无意之举，又让你无法生恨。我曾恨过他，因为一些无关紧要的事，但最后和好，因为都曾是受害者。我与他并不是同路人，只是因为一些微妙的原因而相遇，最终也是曲终人散。</p><p>不过，我也还是会记得这个人吧，我也当然希望会被人记住呢。</p><h3 id="长城爷爷-x-土之宏-x-张妈"><a href="#长城爷爷-x-土之宏-x-张妈" class="headerlink" title="长城爷爷 x 土之宏 x 张妈"></a>长城爷爷 x 土之宏 x 张妈</h3><p>老痰历险记，貌似仙人，小黄片片……</p><p>三位仙人的梗实属太多，我全靠记忆是绝对不可能记得完全的。</p><hr><p>长城爷爷给我的第一印象是初二有一节课，徐来先同志水课（开会去了），就让隔壁班没有课的李老师过来上。李老师没有任何准备，想起什么说什么，然后讲了一节勾股定理。说话生动有趣，人也长相和蔼，后来就喜欢上了。初三调班，理所当然调了过去，然后更深刻地接触了这个人，也发现长城爷爷是一个有故事的人，虽然已经到了退休的年龄，却似乎还是有一颗孩童的心。</p><blockquote><p>我要抚摸你了啊。</p></blockquote><p>李老师，还是少抽一些烟好。</p><hr><p>对于张妈，从初二开始，以为是一个严肃的老大哥（侧脸有点像我的一个小学同学）。后来才发现这人挺和蔼的，喜欢水课（后来发现这是物理老师的天性），但也让我的物理成绩忽上忽下。</p><blockquote><p>嘿嘿嘿。</p></blockquote><p>张老师也少抽点吧，记得锻炼下身体诶。</p><hr><p>土之宏当之无愧我初中记忆最深刻的老师，虽然化学只交了我一年，但能被我记一辈子。<del>血赚</del>。刚开始，给我一种死骄傲，只会读 PPT 的老老师，直到初三第一次评讲试卷。（虽然班上倒数第二），全班无一例外（？）的狂笑。</p><blockquote><p>胶头滴管</p></blockquote><p>后来，发现他的讲课非常有意思。事实上，是人设与课堂的完美结合。</p><blockquote><p>粉碎 $^2$ </p></blockquote><p>从此，每一次评讲化学试卷都是一次享受，无论是考得差还是考得好。</p><blockquote><p>眼睛瞎，耳朵聋，简直是高天赋。</p></blockquote><p>他居然还是上届机房巨佬们的初三班主任。在 DC 的贴吧里，讨论最多的初中老师，也是长城爷爷和土之宏。</p><blockquote><p>你给我滚，我不要你！</p></blockquote><p>但似乎也是一个饱经风霜的人，曾经的同学跌入氨气池，能够颜色不改的侃侃而谈，全班狂笑也不为所动，似乎也被离别变得麻木。</p><blockquote><p>滚出去！</p></blockquote><p>化学老师有个好处，每个夏天都有一个三个月的假期；化学老师有个坏处，每个夏天都要经历一次离别。</p><blockquote><p>简直是冒死仙人。</p></blockquote><p>感谢你，王老师，带给我如此的快乐，也让我爱上了化学。</p><h3 id="老赵"><a href="#老赵" class="headerlink" title="老赵"></a>老赵</h3><p>老赵这个人给了我一种不可接触感，可能是因为我本来就怕语文老师，又怕班主任，然后就更怕老赵了。作为一个年轻的老师，她激荡，能伸能缩，可以让我们过得非常开心，也可以让我们过得十分痛苦，但我相信，她还是为了我们好吧。</p><p>虽说我在中考之后已经没脸去见她了，可能是对不起她对我的如此期盼。但我还是会去感谢她的。</p>]]></content>
      
      
      <categories>
          
          <category> Until The End </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>平衡树</title>
      <link href="/Eternity/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/OI/balanced-tree/"/>
      <url>/Eternity/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/OI/balanced-tree/</url>
      
        <content type="html"><![CDATA[<p>“平衡的旋转，亦是世上最美的舞蹈。”</p><span id="more"></span><h2 id="二叉搜索树-Binary-Search-Tree"><a href="#二叉搜索树-Binary-Search-Tree" class="headerlink" title="二叉搜索树(Binary Search Tree)"></a>二叉搜索树(Binary Search Tree)</h2><h3 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h3><p>顾名思义，一棵二叉树，满足左子点的值小于父节点，右子点的值大于父节点。所有节点都满足该性质。当然，空节点不算。</p><h3 id="性质-特点"><a href="#性质-特点" class="headerlink" title="性质/特点"></a>性质/特点</h3><p>能够高效地完成：</p><ul><li>插入</li><li>查询</li><li>删除</li></ul><p>若 $x$ 是其中节点，而 $y$ 和 $z$ 分别是其左子点与右子点。那么它们满足：</p><blockquote><p>$y.key \leq x.key \leq z.key$</p></blockquote><h3 id="复杂度-代码实现"><a href="#复杂度-代码实现" class="headerlink" title="复杂度/代码实现"></a>复杂度/代码实现</h3><p>均摊 $O(\log n)$</p><h4 id="查找"><a href="#查找" class="headerlink" title="查找"></a>查找</h4><p>从根节点开始，按性质向下查找即可</p><h4 id="插入"><a href="#插入" class="headerlink" title="插入"></a>插入</h4><p>根据性质查找直到空节点，并新建节点。</p><h4 id="删除"><a href="#删除" class="headerlink" title="删除"></a>删除</h4><h5 id="叶节点"><a href="#叶节点" class="headerlink" title="叶节点"></a>叶节点</h5><p>直接删除</p><h5 id="仅有一个子节点的父节点"><a href="#仅有一个子节点的父节点" class="headerlink" title="仅有一个子节点的父节点"></a>仅有一个子节点的父节点</h5><p>上移其子节点，删除其本身</p><h5 id="双子节点的父节点"><a href="#双子节点的父节点" class="headerlink" title="双子节点的父节点"></a>双子节点的父节点</h5><p>找到需要删除的节点 $p$ 的直接前驱（或后驱） $s$ ，用 $s$ 代替 $p$ ，并删除 $s$</p><h3 id="另话"><a href="#另话" class="headerlink" title="另话"></a>另话</h3><p>然而，二叉查找树虽然均摊 $O(\log n)$ ，但实际上，当树作为一条链时，其任何操作都是 $O(n)$ ，<del>那做个P啊</del>，所以就会有了<strong>平衡树</strong>这种东西</p><h2 id="Treap"><a href="#Treap" class="headerlink" title="Treap"></a>Treap</h2><p>有两位巨佬告诉我， $Treap$ 这东西不需要学。所以我也就简单提提。</p><h3 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h3><p>$Treap$ 实际上是一个合成词，$Tree+Heap$ 的合成。也顾名思义，给每一个节点加入一个随机值 $rand()$ 使其基本达到平衡。从而保证树的深度在 $\log n$ 左右。当这棵树的深度达到平衡极限时，进行<strong>左旋</strong>和<strong>右旋</strong>操作使深度降低。</p><h4 id="旋转-rotate"><a href="#旋转-rotate" class="headerlink" title="旋转(rotate)"></a>旋转(rotate)</h4><p>旋转分为<strong>左旋(zig)</strong>和<strong>右旋(zag)</strong>。其目的是使子节点转到根节点处。因为平衡树的操作众多，所以这里重点讲旋转，其他的因题而异即可。</p><p>$rotate(\&amp;p,d)$ 中，以 $p$ 为初始根节点旋转，$d=0$ 时左旋，$d=1$ 时右旋。</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">underRotate</span><span class="params">(<span class="type">int</span> &amp;p,<span class="type">int</span> d)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="type">int</span> k=Tree.son[p][d^<span class="number">1</span>];</span><br><span class="line">Tree.son[p][d^<span class="number">1</span>]=Tree.son[k][d];</span><br><span class="line">Tree.son[k][d]=p;</span><br><span class="line"><span class="built_in">underPushUp</span>(p);</span><br><span class="line"><span class="built_in">underPushUp</span>(k);</span><br><span class="line">p=k;</span><br><span class="line"><span class="keyword">return</span> ;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>以左旋为例：</p><p>将右子点保存为 $k$ ，将 $p$ 的右子点变成 $k$ 的左子点。再将 $k$ 的左子点变成 $p$ 。然后将 $p$ 和 $k$ 都进行 $pushup$ 。（如果你不知道 $pushup$ 是啥请看<a href="">线段树学习笔记</a>）</p><h4 id="初始化"><a href="#初始化" class="headerlink" title="初始化"></a>初始化</h4><p>建立一个极小点($-\inf$)和一个极大点($\inf$)防止越界</p><h3 id="AC-Code"><a href="#AC-Code" class="headerlink" title="AC Code"></a>AC Code</h3><details>    <summary>查看代码</summary><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;ctime&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iomanip&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stack&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;map&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> gh() getchar()</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> underMax(x,y) ((x)&gt;(y)?(x):(y))</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> underMin(x,y) ((x)&lt;(y)?(x):(y))</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> ll;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN=<span class="number">1e6</span>+<span class="number">1</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> INF=<span class="number">0x7f7f7f7f</span>;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">underRead</span><span class="params">(T &amp;x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    x=<span class="number">0</span>;</span><br><span class="line">    <span class="type">char</span> ch=<span class="built_in">gh</span>(),t=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(ch&lt;<span class="string">&#x27;0&#x27;</span>||ch&gt;<span class="string">&#x27;9&#x27;</span>) t|=ch==<span class="string">&#x27;-&#x27;</span>,ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">while</span>(ch&gt;=<span class="string">&#x27;0&#x27;</span>&amp;&amp;ch&lt;=<span class="string">&#x27;9&#x27;</span>) x=(x&lt;&lt;<span class="number">3</span>)+(x&lt;&lt;<span class="number">1</span>)+(ch^<span class="number">48</span>),ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">if</span>(t) x=-x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> M,Idx,Rt,op,x;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Treap</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> son[<span class="number">2</span>],val,rd,cnt,size;</span><br><span class="line">&#125;Tree[MAXN];</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">underNew</span><span class="params">(<span class="type">int</span> val)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Tree[++Idx].val=val;</span><br><span class="line">    Tree[Idx].rd=<span class="built_in">rand</span>();</span><br><span class="line">    Tree[Idx].cnt=Tree[Idx].size=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">return</span> Idx;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">underPushUp</span><span class="params">(<span class="type">int</span> p)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Tree[p].size=Tree[Tree[p].son[<span class="number">0</span>]].size+Tree[Tree[p].son[<span class="number">1</span>]].size+Tree[p].cnt;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">underBuild</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">underNew</span>(-INF),<span class="built_in">underNew</span>(INF);</span><br><span class="line">    Rt=<span class="number">1</span>,Tree[<span class="number">1</span>].son[<span class="number">1</span>]=<span class="number">2</span>;</span><br><span class="line">    <span class="built_in">underPushUp</span>(Rt);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">underRotate</span><span class="params">(<span class="type">int</span> &amp;p,<span class="type">int</span> d)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> k=Tree[p].son[d^<span class="number">1</span>];</span><br><span class="line">    Tree[p].son[d^<span class="number">1</span>]=Tree[k].son[d];</span><br><span class="line">    Tree[k].son[d]=p;</span><br><span class="line">    p=k;</span><br><span class="line">    <span class="built_in">underPushUp</span>(Tree[p].son[d]);</span><br><span class="line">    <span class="built_in">underPushUp</span>(p);</span><br><span class="line"><span class="keyword">return</span> ;</span><br><span class="line">&#125;   <span class="comment">//d=0 -&gt; zag</span></span><br><span class="line">    <span class="comment">//d=1 -&gt; zig</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">underInsert</span><span class="params">(<span class="type">int</span> &amp;p,<span class="type">int</span> val)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(p==<span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        p=<span class="built_in">underNew</span>(val);</span><br><span class="line">        <span class="keyword">return</span> ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(val==Tree[p].val)</span><br><span class="line">    &#123;</span><br><span class="line">        ++Tree[p].cnt,<span class="built_in">underPushUp</span>(p);</span><br><span class="line">        <span class="keyword">return</span> ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(val&lt;Tree[p].val)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">underInsert</span>(Tree[p].son[<span class="number">0</span>],val);</span><br><span class="line">        <span class="keyword">if</span>(Tree[p].rd&lt;Tree[Tree[p].son[<span class="number">0</span>]].rd) <span class="built_in">underRotate</span>(p,<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">underInsert</span>(Tree[p].son[<span class="number">1</span>],val);</span><br><span class="line">        <span class="keyword">if</span>(Tree[p].rd&lt;Tree[Tree[p].son[<span class="number">1</span>]].rd) <span class="built_in">underRotate</span>(p,<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">underPushUp</span>(p);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">underGetRankByVal</span><span class="params">(<span class="type">int</span> p,<span class="type">int</span> val)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(p==<span class="number">0</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span>(val==Tree[p].val) <span class="keyword">return</span> Tree[Tree[p].son[<span class="number">0</span>]].size+<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span>(val&lt;Tree[p].val) <span class="keyword">return</span> <span class="built_in">underGetRankByVal</span>(Tree[p].son[<span class="number">0</span>],val);</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">underGetRankByVal</span>(Tree[p].son[<span class="number">1</span>],val)+Tree[Tree[p].son[<span class="number">0</span>]].size+Tree[p].cnt;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">underGetValByRank</span><span class="params">(<span class="type">int</span> p,<span class="type">int</span> rank)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(p==<span class="number">0</span>) <span class="keyword">return</span> INF;</span><br><span class="line">    <span class="keyword">if</span>(Tree[Tree[p].son[<span class="number">0</span>]].size&gt;=rank) <span class="keyword">return</span> <span class="built_in">underGetValByRank</span>(Tree[p].son[<span class="number">0</span>],rank);</span><br><span class="line">    <span class="keyword">if</span>(Tree[Tree[p].son[<span class="number">0</span>]].size+Tree[p].cnt&gt;=rank) <span class="keyword">return</span> Tree[p].val;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">underGetValByRank</span>(Tree[p].son[<span class="number">1</span>],rank-Tree[Tree[p].son[<span class="number">0</span>]].size-Tree[p].cnt);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">underGetPre</span><span class="params">(<span class="type">int</span> val)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> ans=<span class="number">1</span>,p=Rt;</span><br><span class="line">    <span class="keyword">while</span>(p)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(val==Tree[p].val)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span>(Tree[p].son[<span class="number">0</span>])</span><br><span class="line">            &#123;</span><br><span class="line">                p=Tree[p].son[<span class="number">0</span>];</span><br><span class="line">                <span class="keyword">while</span>(Tree[p].son[<span class="number">1</span>]) p=Tree[p].son[<span class="number">1</span>];</span><br><span class="line">                ans=p;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(Tree[p].val&lt;val&amp;&amp;Tree[p].val&gt;Tree[ans].val) ans=p;</span><br><span class="line">        p=(val&lt;Tree[p].val?Tree[p].son[<span class="number">0</span>]:Tree[p].son[<span class="number">1</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> Tree[ans].val;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">underGetNxt</span><span class="params">(<span class="type">int</span> val)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> ans=<span class="number">2</span>,p=Rt;</span><br><span class="line">    <span class="keyword">while</span>(p)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(val==Tree[p].val)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span>(Tree[p].son[<span class="number">1</span>])</span><br><span class="line">            &#123;</span><br><span class="line">                p=Tree[p].son[<span class="number">1</span>];</span><br><span class="line">                <span class="keyword">while</span>(Tree[p].son[<span class="number">0</span>]) p=Tree[p].son[<span class="number">0</span>];</span><br><span class="line">                ans=p;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(Tree[p].val&gt;val&amp;&amp;Tree[p].val&lt;Tree[ans].val) ans=p;</span><br><span class="line">        p=(val&lt;Tree[p].val?Tree[p].son[<span class="number">0</span>]:Tree[p].son[<span class="number">1</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> Tree[ans].val;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">underErase</span><span class="params">(<span class="type">int</span> &amp;p,<span class="type">int</span> val)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(p==<span class="number">0</span>) <span class="keyword">return</span> ;</span><br><span class="line">    <span class="keyword">if</span>(val==Tree[p].val)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(Tree[p].cnt&gt;<span class="number">1</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            --Tree[p].cnt,<span class="built_in">underPushUp</span>(p);</span><br><span class="line">            <span class="keyword">return</span> ;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(Tree[p].son[<span class="number">0</span>]||Tree[p].son[<span class="number">1</span>])</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span>(!Tree[p].son[<span class="number">1</span>]||Tree[Tree[p].son[<span class="number">0</span>]].rd&gt;Tree[Tree[p].son[<span class="number">1</span>]].rd) <span class="built_in">underRotate</span>(p,<span class="number">1</span>),<span class="built_in">underErase</span>(Tree[p].son[<span class="number">1</span>],val);</span><br><span class="line">            <span class="keyword">else</span> <span class="built_in">underRotate</span>(p,<span class="number">0</span>),<span class="built_in">underErase</span>(Tree[p].son[<span class="number">0</span>],val);</span><br><span class="line">            <span class="built_in">underPushUp</span>(p);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> p=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">return</span> ;</span><br><span class="line">    &#125;</span><br><span class="line">    val&lt;Tree[p].val?<span class="built_in">underErase</span>(Tree[p].son[<span class="number">0</span>],val):<span class="built_in">underErase</span>(Tree[p].son[<span class="number">1</span>],val);</span><br><span class="line">    <span class="built_in">underPushUp</span>(p);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// freopen(&quot;splay.in&quot;,&quot;r&quot;,stdin);</span></span><br><span class="line">    <span class="comment">// freopen(&quot;splay.out&quot;,&quot;w&quot;,stdout);</span></span><br><span class="line">    <span class="built_in">underBuild</span>();</span><br><span class="line">    <span class="built_in">underRead</span>(M);</span><br><span class="line">    <span class="keyword">while</span>(M--)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">underRead</span>(op),<span class="built_in">underRead</span>(x);</span><br><span class="line">        <span class="keyword">switch</span>(op)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">1</span>:<span class="built_in">underInsert</span>(Rt,x);<span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">2</span>:<span class="built_in">underErase</span>(Rt,x);<span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">3</span>:<span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,<span class="built_in">underGetRankByVal</span>(Rt,x)<span class="number">-1</span>);<span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">4</span>:<span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,<span class="built_in">underGetValByRank</span>(Rt,x+<span class="number">1</span>));<span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">5</span>:<span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,<span class="built_in">underGetPre</span>(x));<span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">6</span>:<span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,<span class="built_in">underGetNxt</span>(x));<span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">10</span></span><br><span class="line"><span class="comment">1 106465</span></span><br><span class="line"><span class="comment">4 1</span></span><br><span class="line"><span class="comment">1 317721</span></span><br><span class="line"><span class="comment">1 460929</span></span><br><span class="line"><span class="comment">1 644985</span></span><br><span class="line"><span class="comment">1 84185</span></span><br><span class="line"><span class="comment">1 89851</span></span><br><span class="line"><span class="comment">6 81968</span></span><br><span class="line"><span class="comment">1 492737</span></span><br><span class="line"><span class="comment">5 493598</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure></details><h2 id="Splay"><a href="#Splay" class="headerlink" title="Splay"></a>Splay</h2><h3 id="定义-1"><a href="#定义-1" class="headerlink" title="定义"></a>定义</h3><p>俗称<strong>伸展树</strong>。也是一种二叉排序树，为了使整个查找时间变小，将被查频率高的那些节点转到靠近根节点的位置。每次查找节点之后对树进行重构，把被查找的节点搬移到树根。</p><p>为了将当前被访问节点旋转到树根，我们通常将节点自底向上旋转，直至该节点成为树根为止。“旋转”的巧妙之处就是在不打乱数列中数据大小关系（指中序遍历结果是全序的）情况下，所有基本操作的平摊复杂度仍为 $O(\log n)$。</p><p>一般来说， $Splay$ 的节点维护信息为：</p><div class="table-container"><table><thead><tr><th style="text-align:center">$fa$</th><th style="text-align:center">$chi[0/1]$</th><th style="text-align:center">$dat$</th><th style="text-align:center">$cnt$</th><th style="text-align:center">$size$</th></tr></thead><tbody><tr><td style="text-align:center">父节点编号</td><td style="text-align:center">子节点编号（一般 $0$ 为左子点，$1$ 为右子点）</td><td style="text-align:center">节点权值</td><td style="text-align:center">该节点权值出现的个数</td><td style="text-align:center">子树大小</td></tr></tbody></table></div><h3 id="操作"><a href="#操作" class="headerlink" title="操作"></a>操作</h3><h4 id="旋转操作"><a href="#旋转操作" class="headerlink" title="旋转操作"></a>旋转操作</h4><p>与 $Treap$ 的旋转类似。</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">underRotate</span><span class="params">(<span class="type">int</span> x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> y=Tree[x].fa,z=Tree[y].fa;</span><br><span class="line">    <span class="type">int</span> k=Tree[y].chi[<span class="number">1</span>]==x;</span><br><span class="line">    Tree[z].chi[Tree[z].chi[<span class="number">1</span>]==y]=x;</span><br><span class="line">    Tree[x].fa=z;</span><br><span class="line">    Tree[y].chi[k]=Tree[x].chi[k^<span class="number">1</span>];</span><br><span class="line">    Tree[Tree[x].chi[k^<span class="number">1</span>]].fa=y;</span><br><span class="line">    Tree[x].chi[k^<span class="number">1</span>]=y;</span><br><span class="line">    Tree[y].fa=x;</span><br><span class="line">    <span class="built_in">underPushUp</span>(y);</span><br><span class="line">    <span class="built_in">underPushUp</span>(x);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Splay操作"><a href="#Splay操作" class="headerlink" title="Splay操作"></a>Splay操作</h4><p>传递两个参数 $x$ 和 $k$ 表示将编号为 $x$ 的节点旋转到 $k$ 处，当 $k=0$ 时旋转到根节点。</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">Splay</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> k)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">while</span>(Tree[x].fa!=k)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> y=Tree[x].fa,z=Tree[y].fa;</span><br><span class="line">        <span class="keyword">if</span>(z!=k)</span><br><span class="line">            <span class="keyword">if</span>((Tree[y].chi[<span class="number">1</span>]==x)^(Tree[z].chi[<span class="number">1</span>]==y))</span><br><span class="line">                <span class="built_in">underRotate</span>(x);</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                <span class="built_in">underRotate</span>(y);</span><br><span class="line">        <span class="built_in">underRotate</span>(x);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(!k) Root=x;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>总的说其实就上面两句，但实际上还是要讨论很多情况的。<del>背板子就完事儿了</del>。</p><p>其他的就根据题目而定了。这里给出一些比较常用的操作：</p><h4 id="插入操作"><a href="#插入操作" class="headerlink" title="插入操作"></a>插入操作</h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">underInsert</span><span class="params">(<span class="type">int</span> x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> u=Root,p;</span><br><span class="line">    <span class="keyword">while</span>(u)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(Tree[u].dat==x)</span><br><span class="line">        &#123;</span><br><span class="line">            ++Tree[u].cnt;</span><br><span class="line">            ++Tree[u].size;</span><br><span class="line">            <span class="built_in">Splay</span>(u,<span class="number">0</span>);</span><br><span class="line">            <span class="keyword">return</span> ;</span><br><span class="line">        &#125;</span><br><span class="line">        p=u;</span><br><span class="line">        u=Tree[u].chi[x&gt;Tree[u].dat];</span><br><span class="line">    &#125;</span><br><span class="line">    u=++Idx;</span><br><span class="line">    <span class="keyword">if</span>(p) Tree[p].chi[x&gt;Tree[p].dat]=u;</span><br><span class="line">    Tree[u].dat=x;</span><br><span class="line">    Tree[u].size=<span class="number">1</span>;</span><br><span class="line">    Tree[u].fa=p;</span><br><span class="line">    Tree[u].cnt=<span class="number">1</span>;</span><br><span class="line">    <span class="built_in">Splay</span>(u,<span class="number">0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="删除操作"><a href="#删除操作" class="headerlink" title="删除操作"></a>删除操作</h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">underErase</span><span class="params">(<span class="type">int</span> x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> l=<span class="built_in">underGetPre</span>(x),r=<span class="built_in">underGetNxt</span>(x);</span><br><span class="line">    <span class="built_in">Splay</span>(l,<span class="number">0</span>),<span class="built_in">Splay</span>(r,l);</span><br><span class="line">    Tree[Tree[r].chi[<span class="number">0</span>]].cnt--;</span><br><span class="line">    Tree[Tree[r].chi[<span class="number">0</span>]].size--;</span><br><span class="line">    <span class="keyword">if</span>(!Tree[Tree[r].chi[<span class="number">0</span>]].cnt)</span><br><span class="line">    &#123;</span><br><span class="line">        Tree[Tree[r].chi[<span class="number">0</span>]].fa=<span class="number">0</span>;</span><br><span class="line">        Tree[r].chi[<span class="number">0</span>]=<span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">Splay</span>(r,<span class="number">0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="查找前驱操作"><a href="#查找前驱操作" class="headerlink" title="查找前驱操作"></a>查找前驱操作</h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">underGetPre</span><span class="params">(<span class="type">int</span> x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> u=Root,res,v=Root;</span><br><span class="line">    <span class="keyword">while</span>(u)</span><br><span class="line">    &#123;</span><br><span class="line">        v=u;</span><br><span class="line">        <span class="keyword">if</span>(Tree[u].dat&lt;x)</span><br><span class="line">        &#123;</span><br><span class="line">            res=u;</span><br><span class="line">            u=Tree[u].chi[<span class="number">1</span>];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> u=Tree[u].chi[<span class="number">0</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">Splay</span>(v,<span class="number">0</span>);</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="查找后驱操作"><a href="#查找后驱操作" class="headerlink" title="查找后驱操作"></a>查找后驱操作</h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">underGetNxt</span><span class="params">(<span class="type">int</span> x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> u=Root,res,v=Root;</span><br><span class="line">    <span class="keyword">while</span>(u)</span><br><span class="line">    &#123;</span><br><span class="line">        v=u;</span><br><span class="line">        <span class="keyword">if</span>(Tree[u].dat&gt;x)</span><br><span class="line">        &#123;</span><br><span class="line">            res=u;</span><br><span class="line">            u=Tree[u].chi[<span class="number">0</span>];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> u=Tree[u].chi[<span class="number">1</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">Splay</span>(v,<span class="number">0</span>);</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="查找排名操作"><a href="#查找排名操作" class="headerlink" title="查找排名操作"></a>查找排名操作</h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">underNum</span><span class="params">(<span class="type">int</span> x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> u=Root;</span><br><span class="line">    <span class="keyword">while</span>(u)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(Tree[Tree[u].chi[<span class="number">0</span>]].size&gt;=x) u=Tree[u].chi[<span class="number">0</span>];</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(x&lt;=Tree[Tree[u].chi[<span class="number">0</span>]].size+Tree[u].cnt&amp;&amp;x&gt;=Tree[Tree[u].chi[<span class="number">0</span>]].size+<span class="number">1</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">Splay</span>(u,<span class="number">0</span>);</span><br><span class="line">            <span class="keyword">return</span> u;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            x-=Tree[Tree[u].chi[<span class="number">0</span>]].size+Tree[u].cnt;</span><br><span class="line">            u=Tree[u].chi[<span class="number">1</span>];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="AC-Code-1"><a href="#AC-Code-1" class="headerlink" title="AC Code"></a>AC Code</h3><details>    <summary>查看代码</summary><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;ctime&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iomanip&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stack&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;map&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> gh() getchar()</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> underMax(x,y) ((x)&gt;(y)?(x):(y))</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> underMin(x,y) ((x)&lt;(y)?(x):(y))</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> ll;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN=<span class="number">1e5</span>+<span class="number">1</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> INF=<span class="number">0x7f7f7f7f</span>;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">underRead</span><span class="params">(T &amp;x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    x=<span class="number">0</span>;</span><br><span class="line">    <span class="type">char</span> ch=<span class="built_in">gh</span>(),t=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(ch&lt;<span class="string">&#x27;0&#x27;</span>||ch&gt;<span class="string">&#x27;9&#x27;</span>) t|=ch==<span class="string">&#x27;-&#x27;</span>,ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">while</span>(ch&gt;=<span class="string">&#x27;0&#x27;</span>&amp;&amp;ch&lt;=<span class="string">&#x27;9&#x27;</span>) x=(x&lt;&lt;<span class="number">3</span>)+(x&lt;&lt;<span class="number">1</span>)+(ch^<span class="number">48</span>),ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">if</span>(t) x=-x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> M,Idx;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Splay</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> chi[<span class="number">2</span>],fa;</span><br><span class="line">    <span class="type">int</span> cnt,size,dat;</span><br><span class="line">&#125;Tree[MAXN];</span><br><span class="line"><span class="type">int</span> Root;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">underPushUp</span><span class="params">(<span class="type">int</span> x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Tree[x].size=Tree[Tree[x].chi[<span class="number">0</span>]].size+Tree[Tree[x].chi[<span class="number">1</span>]].size+Tree[x].cnt;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">underRotate</span><span class="params">(<span class="type">int</span> x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> y=Tree[x].fa,z=Tree[y].fa;</span><br><span class="line">    <span class="type">int</span> k=Tree[y].chi[<span class="number">1</span>]==x;</span><br><span class="line">    Tree[z].chi[Tree[z].chi[<span class="number">1</span>]==y]=x;</span><br><span class="line">    Tree[x].fa=z;</span><br><span class="line">    Tree[y].chi[k]=Tree[x].chi[k^<span class="number">1</span>];</span><br><span class="line">    Tree[Tree[x].chi[k^<span class="number">1</span>]].fa=y;</span><br><span class="line">    Tree[x].chi[k^<span class="number">1</span>]=y;</span><br><span class="line">    Tree[y].fa=x;</span><br><span class="line">    <span class="built_in">underPushUp</span>(y);</span><br><span class="line">    <span class="built_in">underPushUp</span>(x);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">Splay</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> k)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">while</span>(Tree[x].fa!=k)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> y=Tree[x].fa,z=Tree[y].fa;</span><br><span class="line">        <span class="keyword">if</span>(z!=k)</span><br><span class="line">            <span class="keyword">if</span>((Tree[y].chi[<span class="number">1</span>]==x)^(Tree[z].chi[<span class="number">1</span>]==y))</span><br><span class="line">                <span class="built_in">underRotate</span>(x);</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                <span class="built_in">underRotate</span>(y);</span><br><span class="line">        <span class="built_in">underRotate</span>(x);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(!k) Root=x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">underInsert</span><span class="params">(<span class="type">int</span> x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> u=Root,p;</span><br><span class="line">    <span class="keyword">while</span>(u)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(Tree[u].dat==x)</span><br><span class="line">        &#123;</span><br><span class="line">            ++Tree[u].cnt;</span><br><span class="line">            ++Tree[u].size;</span><br><span class="line">            <span class="built_in">Splay</span>(u,<span class="number">0</span>);</span><br><span class="line">            <span class="keyword">return</span> ;</span><br><span class="line">        &#125;</span><br><span class="line">        p=u;</span><br><span class="line">        u=Tree[u].chi[x&gt;Tree[u].dat];</span><br><span class="line">    &#125;</span><br><span class="line">    u=++Idx;</span><br><span class="line">    <span class="keyword">if</span>(p) Tree[p].chi[x&gt;Tree[p].dat]=u;</span><br><span class="line">    Tree[u].dat=x;</span><br><span class="line">    Tree[u].size=<span class="number">1</span>;</span><br><span class="line">    Tree[u].fa=p;</span><br><span class="line">    Tree[u].cnt=<span class="number">1</span>;</span><br><span class="line">    <span class="built_in">Splay</span>(u,<span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">underInit</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Root=++Idx;</span><br><span class="line">    Tree[Root].fa=<span class="number">0</span>;</span><br><span class="line">    Tree[Root].cnt=<span class="number">1</span>;</span><br><span class="line">    Tree[Root].size=<span class="number">1</span>;</span><br><span class="line">    Tree[Root].dat=INF;</span><br><span class="line">    <span class="built_in">underInsert</span>(-INF);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">underGetPre</span><span class="params">(<span class="type">int</span> x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> u=Root,res,v=Root;</span><br><span class="line">    <span class="keyword">while</span>(u)</span><br><span class="line">    &#123;</span><br><span class="line">        v=u;</span><br><span class="line">        <span class="keyword">if</span>(Tree[u].dat&lt;x)</span><br><span class="line">        &#123;</span><br><span class="line">            res=u;</span><br><span class="line">            u=Tree[u].chi[<span class="number">1</span>];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> u=Tree[u].chi[<span class="number">0</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">Splay</span>(v,<span class="number">0</span>);</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">underGetNxt</span><span class="params">(<span class="type">int</span> x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> u=Root,res,v=Root;</span><br><span class="line">    <span class="keyword">while</span>(u)</span><br><span class="line">    &#123;</span><br><span class="line">        v=u;</span><br><span class="line">        <span class="keyword">if</span>(Tree[u].dat&gt;x)</span><br><span class="line">        &#123;</span><br><span class="line">            res=u;</span><br><span class="line">            u=Tree[u].chi[<span class="number">0</span>];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> u=Tree[u].chi[<span class="number">1</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">Splay</span>(v,<span class="number">0</span>);</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">underErase</span><span class="params">(<span class="type">int</span> x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> l=<span class="built_in">underGetPre</span>(x),r=<span class="built_in">underGetNxt</span>(x);</span><br><span class="line">    <span class="built_in">Splay</span>(l,<span class="number">0</span>),<span class="built_in">Splay</span>(r,l);</span><br><span class="line">    Tree[Tree[r].chi[<span class="number">0</span>]].cnt--;</span><br><span class="line">    Tree[Tree[r].chi[<span class="number">0</span>]].size--;</span><br><span class="line">    <span class="keyword">if</span>(!Tree[Tree[r].chi[<span class="number">0</span>]].cnt)</span><br><span class="line">    &#123;</span><br><span class="line">        Tree[Tree[r].chi[<span class="number">0</span>]].fa=<span class="number">0</span>;</span><br><span class="line">        Tree[r].chi[<span class="number">0</span>]=<span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">Splay</span>(r,<span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">underNum</span><span class="params">(<span class="type">int</span> x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> u=Root;</span><br><span class="line">    <span class="keyword">while</span>(u)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(Tree[Tree[u].chi[<span class="number">0</span>]].size&gt;=x) u=Tree[u].chi[<span class="number">0</span>];</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(x&lt;=Tree[Tree[u].chi[<span class="number">0</span>]].size+Tree[u].cnt&amp;&amp;x&gt;=Tree[Tree[u].chi[<span class="number">0</span>]].size+<span class="number">1</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">Splay</span>(u,<span class="number">0</span>);</span><br><span class="line">            <span class="keyword">return</span> u;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            x-=Tree[Tree[u].chi[<span class="number">0</span>]].size+Tree[u].cnt;</span><br><span class="line">            u=Tree[u].chi[<span class="number">1</span>];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// freopen(&quot;splay.in&quot;,&quot;r&quot;,stdin);</span></span><br><span class="line">    <span class="comment">// freopen(&quot;splay.out&quot;,&quot;w&quot;,stdout);</span></span><br><span class="line">    <span class="built_in">underInit</span>();</span><br><span class="line">    <span class="built_in">underRead</span>(M);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=M;++i)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> op,x;</span><br><span class="line">        <span class="built_in">underRead</span>(op),<span class="built_in">underRead</span>(x);</span><br><span class="line">        <span class="keyword">if</span>(op==<span class="number">1</span>) <span class="built_in">underInsert</span>(x);</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(op==<span class="number">2</span>) <span class="built_in">underErase</span>(x);</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(op==<span class="number">3</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">Splay</span>(<span class="built_in">underGetPre</span>(x),<span class="number">0</span>);</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,Tree[Tree[Root].chi[<span class="number">0</span>]].size+Tree[Root].cnt);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(op==<span class="number">4</span>) <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,Tree[<span class="built_in">underNum</span>(x+<span class="number">1</span>)].dat);</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(op==<span class="number">5</span>) <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,Tree[<span class="built_in">underGetPre</span>(x)].dat);</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(op==<span class="number">6</span>) <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,Tree[<span class="built_in">underGetNxt</span>(x)].dat);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">10</span></span><br><span class="line"><span class="comment">1 106465</span></span><br><span class="line"><span class="comment">4 1</span></span><br><span class="line"><span class="comment">1 317721</span></span><br><span class="line"><span class="comment">1 460929</span></span><br><span class="line"><span class="comment">1 644985</span></span><br><span class="line"><span class="comment">1 84185</span></span><br><span class="line"><span class="comment">1 89851</span></span><br><span class="line"><span class="comment">6 81968</span></span><br><span class="line"><span class="comment">1 492737</span></span><br><span class="line"><span class="comment">5 493598</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure></details><h3 id="文艺平衡树"><a href="#文艺平衡树" class="headerlink" title="文艺平衡树"></a>文艺平衡树</h3><p><a href="https://www.luogu.com.cn/problem/P3391">例题</a></p><h4 id="思路"><a href="#思路" class="headerlink" title="思路"></a>思路</h4><p>我们已知，平衡树的中序遍历永远满足全序。我们又会发现（<del>其实要推一下</del>），当我们把区间 $[l,r]$ 反转时，就是将其两个子节点指针交换。将 $l$ 转到根节点，将 $r$ 转为 $l$ 的子节点。然后交换其子树编号即可。</p><h4 id="AC-Code-2"><a href="#AC-Code-2" class="headerlink" title="AC Code"></a>AC Code</h4><details>    <summary>查看代码</summary><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;ctime&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iomanip&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stack&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;map&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> gh() getchar()</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> re register</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> underMax(x,y) ((x)&gt;(y)?(x):(y))</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> underMin(x,y) ((x)&lt;(y)?(x):(y))</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> ll;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN=<span class="number">1e6</span>+<span class="number">1</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> INF=<span class="number">0x7f7f7f7f</span>;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">underRead</span><span class="params">(T &amp;x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    x=<span class="number">0</span>;</span><br><span class="line">    <span class="type">char</span> ch=<span class="built_in">gh</span>(),t=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(ch&lt;<span class="string">&#x27;0&#x27;</span>||ch&gt;<span class="string">&#x27;9&#x27;</span>) t|=ch==<span class="string">&#x27;-&#x27;</span>,ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">while</span>(ch&gt;=<span class="string">&#x27;0&#x27;</span>&amp;&amp;ch&lt;=<span class="string">&#x27;9&#x27;</span>) x=(x&lt;&lt;<span class="number">3</span>)+(x&lt;&lt;<span class="number">1</span>)+(ch^<span class="number">48</span>),ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">if</span>(t) x=-x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> N,M,Idx;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Splay</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> chi[<span class="number">2</span>],fa,tag;</span><br><span class="line">    <span class="type">int</span> cnt,size,dat;</span><br><span class="line">&#125;Tree[MAXN];</span><br><span class="line"><span class="type">int</span> Root;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">underPushUp</span><span class="params">(<span class="type">int</span> x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Tree[x].size=Tree[Tree[x].chi[<span class="number">0</span>]].size+Tree[Tree[x].chi[<span class="number">1</span>]].size+<span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">underPushDown</span><span class="params">(<span class="type">int</span> x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">if</span>(Tree[x].tag)</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">swap</span>(Tree[x].chi[<span class="number">0</span>],Tree[x].chi[<span class="number">1</span>]);</span><br><span class="line">Tree[Tree[x].chi[<span class="number">0</span>]].tag^=<span class="number">1</span>;</span><br><span class="line">Tree[Tree[x].chi[<span class="number">1</span>]].tag^=<span class="number">1</span>;</span><br><span class="line">Tree[x].tag^=<span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">underRotate</span><span class="params">(<span class="type">int</span> x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> y=Tree[x].fa,z=Tree[y].fa;</span><br><span class="line">    <span class="type">int</span> k=Tree[y].chi[<span class="number">1</span>]==x;</span><br><span class="line">    Tree[z].chi[Tree[z].chi[<span class="number">1</span>]==y]=x;</span><br><span class="line">    Tree[x].fa=z;</span><br><span class="line">    Tree[y].chi[k]=Tree[x].chi[k^<span class="number">1</span>];</span><br><span class="line">    Tree[Tree[x].chi[k^<span class="number">1</span>]].fa=y;</span><br><span class="line">    Tree[x].chi[k^<span class="number">1</span>]=y;</span><br><span class="line">    Tree[y].fa=x;</span><br><span class="line">    <span class="built_in">underPushUp</span>(y);</span><br><span class="line">    <span class="built_in">underPushUp</span>(x);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">Splay</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> k)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">while</span>(Tree[x].fa!=k)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> y=Tree[x].fa,z=Tree[y].fa;</span><br><span class="line">        <span class="keyword">if</span>(z!=k)</span><br><span class="line">            <span class="keyword">if</span>((Tree[y].chi[<span class="number">1</span>]==x)^(Tree[z].chi[<span class="number">1</span>]==y)) <span class="built_in">underRotate</span>(x);</span><br><span class="line">            <span class="keyword">else</span> <span class="built_in">underRotate</span>(y);</span><br><span class="line">        <span class="built_in">underRotate</span>(x);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(!k) Root=x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">underInsert</span><span class="params">(<span class="type">int</span> x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> u=Root,p=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(u)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(Tree[u].dat==x)</span><br><span class="line">        &#123;</span><br><span class="line">            ++Tree[u].cnt;</span><br><span class="line">            ++Tree[u].size;</span><br><span class="line">            <span class="built_in">Splay</span>(u,<span class="number">0</span>);</span><br><span class="line">            <span class="keyword">return</span> ;</span><br><span class="line">        &#125;</span><br><span class="line">        p=u;</span><br><span class="line">        u=Tree[u].chi[x&gt;Tree[u].dat];</span><br><span class="line">    &#125;</span><br><span class="line">    u=++Idx;</span><br><span class="line">    <span class="keyword">if</span>(p) Tree[p].chi[x&gt;Tree[p].dat]=u;</span><br><span class="line">    Tree[u].dat=x;</span><br><span class="line">    Tree[u].size=<span class="number">1</span>;</span><br><span class="line">    Tree[u].fa=p;</span><br><span class="line">    Tree[u].cnt=<span class="number">1</span>;</span><br><span class="line">    <span class="built_in">Splay</span>(u,<span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">underWrite</span><span class="params">(<span class="type">int</span> rt)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="built_in">underPushDown</span>(rt);</span><br><span class="line"><span class="keyword">if</span>(Tree[rt].chi[<span class="number">0</span>]) <span class="built_in">underWrite</span>(Tree[rt].chi[<span class="number">0</span>]);</span><br><span class="line"><span class="keyword">if</span>(Tree[rt].dat&gt;<span class="number">1</span>&amp;&amp;Tree[rt].dat&lt;N+<span class="number">2</span>) <span class="built_in">printf</span>(<span class="string">&quot;%d &quot;</span>,Tree[rt].dat<span class="number">-1</span>);</span><br><span class="line"><span class="keyword">if</span>(Tree[rt].chi[<span class="number">1</span>]) <span class="built_in">underWrite</span>(Tree[rt].chi[<span class="number">1</span>]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">underKth</span><span class="params">(<span class="type">int</span> k)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="type">int</span> u=Root;</span><br><span class="line"><span class="keyword">while</span>(<span class="number">1</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">underPushDown</span>(u);</span><br><span class="line"><span class="keyword">if</span>(Tree[Tree[u].chi[<span class="number">0</span>]].size&gt;=k) u=Tree[u].chi[<span class="number">0</span>];</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span>(Tree[Tree[u].chi[<span class="number">0</span>]].size+<span class="number">1</span>==k) <span class="keyword">return</span> u;</span><br><span class="line"><span class="keyword">else</span> k-=Tree[Tree[u].chi[<span class="number">0</span>]].size+<span class="number">1</span>,u=Tree[u].chi[<span class="number">1</span>];</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">underSwap</span><span class="params">(<span class="type">int</span> l,<span class="type">int</span> r)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">l=<span class="built_in">underKth</span>(l);</span><br><span class="line">r=<span class="built_in">underKth</span>(r+<span class="number">2</span>);</span><br><span class="line"><span class="built_in">Splay</span>(l,<span class="number">0</span>);</span><br><span class="line"><span class="built_in">Splay</span>(r,l);</span><br><span class="line">Tree[Tree[Tree[Root].chi[<span class="number">1</span>]].chi[<span class="number">0</span>]].tag^=<span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">underInit</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Root=++Idx;</span><br><span class="line">    Tree[Root].fa=<span class="number">0</span>;</span><br><span class="line">    Tree[Root].cnt=<span class="number">1</span>;</span><br><span class="line">    Tree[Root].size=<span class="number">1</span>;</span><br><span class="line">    Tree[Root].dat=INF;</span><br><span class="line">    <span class="built_in">underInsert</span>(-INF);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// freopen(&quot;splay.in&quot;,&quot;r&quot;,stdin);</span></span><br><span class="line">    <span class="comment">// freopen(&quot;splay.out&quot;,&quot;w&quot;,stdout);</span></span><br><span class="line">    <span class="built_in">underRead</span>(N),<span class="built_in">underRead</span>(M);</span><br><span class="line">    <span class="keyword">for</span>(re <span class="type">int</span> i=<span class="number">1</span>;i&lt;=N+<span class="number">2</span>;++i) <span class="built_in">underInsert</span>(i);</span><br><span class="line">    <span class="keyword">for</span>(re <span class="type">int</span> i=<span class="number">1</span>;i&lt;=M;++i)</span><br><span class="line">    &#123;</span><br><span class="line">    <span class="type">int</span> Ql,Qr;</span><br><span class="line">        <span class="built_in">underRead</span>(Ql),<span class="built_in">underRead</span>(Qr);</span><br><span class="line">        <span class="built_in">underSwap</span>(Ql,Qr);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">underWrite</span>(Root);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">5 3</span></span><br><span class="line"><span class="comment">1 3</span></span><br><span class="line"><span class="comment">1 3</span></span><br><span class="line"><span class="comment">1 4</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br></pre></td></tr></table></figure></details><h2 id="Fhq-Treap"><a href="#Fhq-Treap" class="headerlink" title="Fhq-Treap"></a>Fhq-Treap</h2><p>暂代补充</p><h2 id="AVL数"><a href="#AVL数" class="headerlink" title="AVL数"></a>AVL数</h2><p>暂代补充</p><h2 id="红黑树"><a href="#红黑树" class="headerlink" title="红黑树"></a>红黑树</h2><p>估计不会有了</p><hr><p>没有更多了</p><p>首次更新：$date\ 2022.3.14$</p><p>最后更新：$date\ 2022.3.19$</p>]]></content>
      
      
      <categories>
          
          <category> 学习笔记 </category>
          
          <category> OI </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 平衡树 </tag>
            
            <tag> 数据结构 </tag>
            
            <tag> 线段树 </tag>
            
            <tag> Splay </tag>
            
            <tag> 二叉搜索树 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>可持久化线段树(主席树)</title>
      <link href="/Eternity/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/OI/persistent-segment-tree/"/>
      <url>/Eternity/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/OI/persistent-segment-tree/</url>
      
        <content type="html"><![CDATA[<p>“人最重要的，是不能忘记自己为何出发。”</p><span id="more"></span><h2 id="可持久化数据结构"><a href="#可持久化数据结构" class="headerlink" title="可持久化数据结构"></a>可持久化数据结构</h2><p>一种数据结构可持久化，当其满足<strong>本身的拓扑结构不变</strong>时，其可持久化。</p><p>因此，$\text{Trie}$ 树，线段树，树状数组，平衡树等都支持可持久化。</p><blockquote><p>类似于 $\text{Github}$ 的 <code>git</code> 操作。——$\text{Yxc}$</p></blockquote><p>可持久化数据结构用于支持存储该数据结构的所有历史版本。</p><p>假设有 $\mathcal O(m)$ 次操作，那么就会有 $m+1$ 个历史版本，如果每一个版本都去 $\text{copy}$ 一份的话，空间复杂度会高达 $\mathcal O(n(m+1))$ ，那么，可持久化的核心思想就是只去记录每一个版本被<strong>修改</strong>过的点，即与前一个版本不同的结点。</p><h2 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h2><p><strong>主席树</strong>全称<strong>可持久化权值线段树</strong>，用于维护区间最值与一些奇奇怪怪的东西。支持历史询问与修改（目前不会），似乎与普通线段树的时间复杂度是一样的，但空间会减少很多消耗。</p><p>在算法执行的过程中，会发现在更新一个动态集合时，需要维护其过去的版本。这样的集合称为是<strong>可持久</strong>的。</p><h2 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h2><h3 id="建树-build"><a href="#建树-build" class="headerlink" title="建树(build)"></a>建树(build)</h3><p>首先，建立起<strong>亘古树</strong>，即一开始的整棵线段树。但是根本不需要。对于主席树而言，改掉了我的一个习惯：即线段树的左区间与右区间是存于 $Tree$ 内的。这样可能会消耗一些空间。但对于主席树而言，其儿子节点并不满足 <code>Tree[p].l=p&lt;&lt;1</code> 与 <code>Tree[p].r=p&lt;&lt;1|1</code> 的关系，所以对于建树而言，每一个节点的 $l$ 和 $r$ 存储的是其左右儿子的点编号。每输入一个数，就动态修改即可，根本不需要进行 $build$ 操作。<del>一般不建</del></p><h3 id="修改-插入-modify"><a href="#修改-插入-modify" class="headerlink" title="修改/插入(modify)"></a>修改/插入(modify)</h3><p>每输入一个值……其实这句话是不对的。对于部分主席树的题而言，是需要<strong>离散化</strong>的。所以插入（修改）操作都是在输入完并离散化之后才一次性完成的。</p><p>以洛谷的<a href="https://www.luogu.com.cn/problem/P3834">模板题</a>为例，我们需要求区间 $[l,r]$ 的第 $k$ 小值。则对于这道题的历史版本 $v_i$ ，处理的其实是<strong>前缀和</strong>的信息。即我们建的第 $i$ 个树存储的是区间 $[1,i]$ 的 $Val$ 信息。而叶节点存储的则是第 $i$ 个数的个数。</p><p>对于每一次的插入操作，我们就在原来基础上插入一条链直达叶节点，表示我们在该位置插入了一个数。然后自下而上更新区间值 $dat$ ，这与线段树是一样的。而不同的是，在插入过程中，其节点编号 $p$ 是动态的。因为当一个地方没有被修改时，我们会指向其历史编号，只有当修改时才会新建编号，而我们新建了编号后，其父节点所指的子节点也是会更改的。所以就会有 <code>int &amp;x</code> 的情况。</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">underModify</span><span class="params">(<span class="type">int</span> &amp;x,<span class="type">int</span> l,<span class="type">int</span> r,<span class="type">int</span> d)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Tree[++Idx]=Tree[x];</span><br><span class="line">    x=Idx;</span><br><span class="line">    <span class="keyword">if</span>(l==r)</span><br><span class="line">    &#123;</span><br><span class="line">        ++Tree[x].dat;</span><br><span class="line">        <span class="keyword">return</span> ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> mid=(l+r)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span>(d&lt;=mid) <span class="built_in">underModify</span>(Tree[x].l,l,mid,d);</span><br><span class="line">    <span class="keyword">else</span> <span class="built_in">underModify</span>(Tree[x].r,mid+<span class="number">1</span>,r,d);</span><br><span class="line">    <span class="built_in">underPushUp</span>(x);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="查询-query"><a href="#查询-query" class="headerlink" title="查询(query)"></a>查询(query)</h3><p>其意义并非真正的线段树查询。因为用了二分的思想又与线段树相似而称之为查询。对于查询第 $k$ 小数而言，因为我们已经离散化排了序的，则：</p><ol><li>当该节点的左儿子存储的数的个数大于 $k$ ，则查询左儿子；</li><li>当该节点的左儿子存储的数的个数小于 $k$ ，则查询右儿子的第 $k-ls$ 小值。</li></ol><p>这就因题而异了，只是提一句。</p><h3 id="初始化"><a href="#初始化" class="headerlink" title="初始化"></a>初始化</h3><h4 id="离散化"><a href="#离散化" class="headerlink" title="离散化"></a>离散化</h4><p>因题而异。可以有，也可以没有。</p><h4 id="排序"><a href="#排序" class="headerlink" title="排序"></a>排序</h4><p>因题而异。可以有，也可以没有。</p><h4 id="修改根节点-root"><a href="#修改根节点-root" class="headerlink" title="修改根节点(root)"></a>修改根节点(root)</h4><p>每一个历史线段树的根节点在一开始的时候都是空的，其会在插入操作里不断更新。这也是为什么 <code>int &amp;x</code> 的原因（<del>二次重提</del>）</p><h2 id="AC-Code"><a href="#AC-Code" class="headerlink" title="AC Code"></a>AC Code</h2><details>    <summary>查看代码</summary><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;ctime&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iomanip&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stack&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;map&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> gh() getchar()</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> re register</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> underMax(x,y) ((x)&gt;(y)?(x):(y))</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> underMin(x,y) ((x)&lt;(y)?(x):(y))</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> ll;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN=<span class="number">1e6</span>+<span class="number">1</span>;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">underRead</span><span class="params">(T &amp;x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    x=<span class="number">0</span>;</span><br><span class="line">    <span class="type">char</span> ch=<span class="built_in">gh</span>(),t=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(ch&lt;<span class="string">&#x27;0&#x27;</span>||ch&gt;<span class="string">&#x27;9&#x27;</span>) t|=ch==<span class="string">&#x27;-&#x27;</span>,ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">while</span>(ch&gt;=<span class="string">&#x27;0&#x27;</span>&amp;&amp;ch&lt;=<span class="string">&#x27;9&#x27;</span>) x=(x&lt;&lt;<span class="number">3</span>)+(x&lt;&lt;<span class="number">1</span>)+(ch^<span class="number">48</span>),ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">if</span>(t) x=-x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> N,M,Val[MAXN&lt;&lt;<span class="number">1</span>],Root[MAXN&lt;&lt;<span class="number">1</span>];</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">PersistentSegmentTree</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> dat,l,r;</span><br><span class="line">&#125;Tree[MAXN&lt;&lt;<span class="number">4</span>];</span><br><span class="line"><span class="type">int</span> Idx;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">underPushUp</span><span class="params">(<span class="type">int</span> p)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Tree[p].dat=Tree[Tree[p].l].dat+Tree[Tree[p].r].dat;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">underModify</span><span class="params">(<span class="type">int</span> &amp;x,<span class="type">int</span> l,<span class="type">int</span> r,<span class="type">int</span> d)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Tree[++Idx]=Tree[x];</span><br><span class="line">    x=Idx;</span><br><span class="line">    <span class="keyword">if</span>(l==r)</span><br><span class="line">    &#123;</span><br><span class="line">        ++Tree[x].dat;</span><br><span class="line">        <span class="keyword">return</span> ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> mid=(l+r)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span>(d&lt;=mid) <span class="built_in">underModify</span>(Tree[x].l,l,mid,d);</span><br><span class="line">    <span class="keyword">else</span> <span class="built_in">underModify</span>(Tree[x].r,mid+<span class="number">1</span>,r,d);</span><br><span class="line">    <span class="built_in">underPushUp</span>(x);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">underQuery</span><span class="params">(<span class="type">int</span> x1,<span class="type">int</span> x2,<span class="type">int</span> l,<span class="type">int</span> r,<span class="type">int</span> k)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(l==r) <span class="keyword">return</span> l;</span><br><span class="line">    <span class="type">int</span> mid=(l+r)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">    <span class="type">int</span> ls=Tree[Tree[x2].l].dat-Tree[Tree[x1].l].dat;</span><br><span class="line">    <span class="keyword">if</span>(k&lt;=ls) <span class="keyword">return</span> <span class="built_in">underQuery</span>(Tree[x1].l,Tree[x2].l,l,mid,k);</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">return</span> <span class="built_in">underQuery</span>(Tree[x1].r,Tree[x2].r,mid+<span class="number">1</span>,r,k-ls);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// freopen(&quot;PST.in&quot;,&quot;r&quot;,stdin);</span></span><br><span class="line">    <span class="comment">// freopen(&quot;PST.out&quot;,&quot;w&quot;,stdout);</span></span><br><span class="line">    vector&lt;<span class="type">int</span>&gt;V;</span><br><span class="line">    <span class="built_in">underRead</span>(N),<span class="built_in">underRead</span>(M);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=N;++i) </span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">underRead</span>(Val[i]);</span><br><span class="line">        V.<span class="built_in">push_back</span>(Val[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">sort</span>(V.<span class="built_in">begin</span>(),V.<span class="built_in">end</span>());</span><br><span class="line">    <span class="type">int</span> len=V.<span class="built_in">erase</span>(<span class="built_in">unique</span>(V.<span class="built_in">begin</span>(),V.<span class="built_in">end</span>()),V.<span class="built_in">end</span>())-V.<span class="built_in">begin</span>();</span><br><span class="line">    <span class="keyword">for</span>(re <span class="type">int</span> i=<span class="number">1</span>;i&lt;=N;++i)</span><br><span class="line">    &#123;</span><br><span class="line">        Root[i]=Root[i<span class="number">-1</span>];</span><br><span class="line">        <span class="built_in">underModify</span>(Root[i],<span class="number">1</span>,len,<span class="built_in">lower_bound</span>(V.<span class="built_in">begin</span>(),V.<span class="built_in">end</span>(),Val[i])-V.<span class="built_in">begin</span>()+<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> Ql,Qr,Qk;M;M--)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">underRead</span>(Ql),<span class="built_in">underRead</span>(Qr),<span class="built_in">underRead</span>(Qk);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,V[<span class="built_in">underQuery</span>(Root[Ql<span class="number">-1</span>],Root[Qr],<span class="number">1</span>,len,Qk)<span class="number">-1</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">5 5</span></span><br><span class="line"><span class="comment">25957 6405 15770 26287 26465 </span></span><br><span class="line"><span class="comment">2 2 1</span></span><br><span class="line"><span class="comment">3 4 1</span></span><br><span class="line"><span class="comment">4 5 1</span></span><br><span class="line"><span class="comment">1 2 2</span></span><br><span class="line"><span class="comment">4 4 1</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure></details><h2 id="可持久化数组"><a href="#可持久化数组" class="headerlink" title="可持久化数组"></a>可持久化数组</h2><p>其实差不多，只是多了一个建树操作。因为它有一个初始数列，这道题真的就是字面意思的<strong>可持久化</strong>了。</p><p><a href="https://www.luogu.com.cn/problem/P3919">P3919 【模板】可持久化线段树 1（可持久化数组）</a></p><h3 id="AC-Code-1"><a href="#AC-Code-1" class="headerlink" title="AC Code"></a>AC Code</h3><details>    <summary>查看代码</summary><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;ctime&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iomanip&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stack&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;map&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> gh() getchar()</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> underMax(x,y) ((x)&gt;(y)?(x):(y))</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> underMin(x,y) ((x)&lt;(y)?(x):(y))</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> ll;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN=<span class="number">1e6</span>+<span class="number">1</span>;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">underRead</span><span class="params">(T &amp;x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    x=<span class="number">0</span>;</span><br><span class="line">    <span class="type">char</span> ch=<span class="built_in">gh</span>(),t=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(ch&lt;<span class="string">&#x27;0&#x27;</span>||ch&gt;<span class="string">&#x27;9&#x27;</span>) t|=ch==<span class="string">&#x27;-&#x27;</span>,ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">while</span>(ch&gt;=<span class="string">&#x27;0&#x27;</span>&amp;&amp;ch&lt;=<span class="string">&#x27;9&#x27;</span>) x=(x&lt;&lt;<span class="number">3</span>)+(x&lt;&lt;<span class="number">1</span>)+(ch^<span class="number">48</span>),ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">if</span>(t) x=-x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> N,M,Idx,Root[MAXN];</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">SegmentTree</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> l,r,dat;</span><br><span class="line">&#125;Tree[MAXN*<span class="number">100</span>];</span><br><span class="line"><span class="type">int</span> Val[MAXN],op,Ql,Qv,Qk;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">underBuild</span><span class="params">(<span class="type">int</span> &amp;x,<span class="type">int</span> l,<span class="type">int</span> r)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    x=++Idx;</span><br><span class="line">    <span class="keyword">if</span>(l==r)</span><br><span class="line">    &#123;</span><br><span class="line">        Tree[x].dat=Val[l];</span><br><span class="line">        <span class="keyword">return</span> ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> mid=(l+r)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">    <span class="built_in">underBuild</span>(Tree[x].l,l,mid),<span class="built_in">underBuild</span>(Tree[x].r,mid+<span class="number">1</span>,r);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">underModify</span><span class="params">(<span class="type">int</span> &amp;x,<span class="type">int</span> l,<span class="type">int</span> r,<span class="type">int</span> d,<span class="type">int</span> k)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Tree[++Idx]=Tree[x];</span><br><span class="line">    x=Idx;</span><br><span class="line">    <span class="keyword">if</span>(l==r)</span><br><span class="line">    &#123;</span><br><span class="line">        Tree[x].dat=k;</span><br><span class="line">        <span class="keyword">return</span> ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> mid=(l+r)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span>(d&lt;=mid) <span class="built_in">underModify</span>(Tree[x].l,l,mid,d,k);</span><br><span class="line">    <span class="keyword">else</span> <span class="built_in">underModify</span>(Tree[x].r,mid+<span class="number">1</span>,r,d,k);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">underQuery</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> l,<span class="type">int</span> r,<span class="type">int</span> d)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(l==r) <span class="keyword">return</span> Tree[x].dat;</span><br><span class="line">    <span class="type">int</span> mid=(l+r)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span>(d&lt;=mid) <span class="keyword">return</span> <span class="built_in">underQuery</span>(Tree[x].l,l,mid,d);</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">return</span> <span class="built_in">underQuery</span>(Tree[x].r,mid+<span class="number">1</span>,r,d);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// freopen(&quot;PST-fake.in&quot;,&quot;r&quot;,stdin);</span></span><br><span class="line">    <span class="comment">// freopen(&quot;PST-fake.out&quot;,&quot;w&quot;,stdout);</span></span><br><span class="line">    <span class="built_in">underRead</span>(N),<span class="built_in">underRead</span>(M);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=N;++i) <span class="built_in">underRead</span>(Val[i]);</span><br><span class="line">    <span class="built_in">underBuild</span>(Root[<span class="number">0</span>],<span class="number">1</span>,N);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=M;++i)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">underRead</span>(Qv),<span class="built_in">underRead</span>(op);</span><br><span class="line">        Root[i]=Root[Qv];</span><br><span class="line">        <span class="keyword">if</span>(op==<span class="number">1</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">underRead</span>(Ql),<span class="built_in">underRead</span>(Qk);</span><br><span class="line">            <span class="built_in">underModify</span>(Root[i],<span class="number">1</span>,N,Ql,Qk);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">underRead</span>(Ql);</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,<span class="built_in">underQuery</span>(Root[i],<span class="number">1</span>,N,Ql));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">5 10</span></span><br><span class="line"><span class="comment">59 46 14 87 41</span></span><br><span class="line"><span class="comment">0 2 1</span></span><br><span class="line"><span class="comment">0 1 1 14</span></span><br><span class="line"><span class="comment">0 1 1 57</span></span><br><span class="line"><span class="comment">0 1 1 88</span></span><br><span class="line"><span class="comment">4 2 4</span></span><br><span class="line"><span class="comment">0 2 5</span></span><br><span class="line"><span class="comment">0 2 4</span></span><br><span class="line"><span class="comment">4 2 1</span></span><br><span class="line"><span class="comment">2 2 2</span></span><br><span class="line"><span class="comment">1 1 5 91</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure></details>]]></content>
      
      
      <categories>
          
          <category> 学习笔记 </category>
          
          <category> OI </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 平衡树 </tag>
            
            <tag> 线段树 </tag>
            
            <tag> 主席树 </tag>
            
            <tag> 可持久化数据结构 </tag>
            
            <tag> 可持久化线段树 </tag>
            
            <tag> 可持久化数组 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>欧拉函数</title>
      <link href="/Eternity/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/OI/euler-function/"/>
      <url>/Eternity/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/OI/euler-function/</url>
      
        <content type="html"><![CDATA[<p>“下一个就是你了，承太郎“</p><span id="more"></span><h2 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h2><blockquote><p>指的是满足小于等于$N$且与$N$互质的数目和。</p></blockquote><p>用 $\varphi(N)$ 来表示。</p><h2 id="欧拉公式求解"><a href="#欧拉公式求解" class="headerlink" title="欧拉公式求解"></a>欧拉公式求解</h2><p>对于一个正整数$N$满足：</p><blockquote><p>$\varphi(x)=\sum_{k}[(k, n)=1][k \in N][k&lt;n]$</p></blockquote><p>则有</p><blockquote><p>$\varphi(n)=n\left(1-\frac{1}{p_{1}}\right)\left(1-\frac{1}{p_{2}}\right)\left(1-\frac{1}{p_{3}}\right) \cdots\left(1-\frac{1}{p_{k}}\right)$</p></blockquote><p>有 $N=\prod p_i^{c_i}$ ，则有 $\varphi(N)=N\times\prod \frac{p_i+1}{p_i}$ 。</p><h2 id="欧拉函数的性质："><a href="#欧拉函数的性质：" class="headerlink" title="欧拉函数的性质："></a>欧拉函数的性质：</h2><h3 id="当-N-0-时"><a href="#当-N-0-时" class="headerlink" title="当 $N=0$ 时"></a>当 $N=0$ 时</h3><blockquote><p>$\varphi(0)=0$.</p></blockquote><h3 id="当-N-1-时"><a href="#当-N-1-时" class="headerlink" title="当 $N=1$ 时"></a>当 $N=1$ 时</h3><blockquote><p>$\varphi(1)=1$.因为1与自身互质。</p></blockquote><h3 id="当-N-为质数时"><a href="#当-N-为质数时" class="headerlink" title="当 $N$ 为质数时"></a>当 $N$ 为质数时</h3><blockquote><p>$\varphi(N)=N-1$.</p></blockquote><h3 id="如果-P-是质数，而-N-是-P-的正整数次方"><a href="#如果-P-是质数，而-N-是-P-的正整数次方" class="headerlink" title="如果 $ P$ 是质数，而 $N$ 是 $P$ 的正整数次方"></a>如果 $ P$ 是质数，而 $N$ 是 $P$ 的正整数次方</h3><blockquote><p>$\varphi(P^N)=P^N(1-\frac{1}{p})$</p></blockquote><h2 id="欧拉定理"><a href="#欧拉定理" class="headerlink" title="欧拉定理"></a>欧拉定理</h2><p>设$a,m \in N^+$，且$(a,m)=1$，那么则有</p><blockquote><p>$a^{\varphi(m)} \equiv 1 \pmod m$</p><p>且$a$对模$m$的阶$\delta_m(a)$必须整除$\varphi(a)$.</p></blockquote><p>证明：</p><blockquote><p>取模$m$的缩系，$a_1,a_2,a_3……a_{\varphi(m)}$，</p><p>则$aa_1,aa_2,aa_3……aa_{\varphi(m)}$也是$m$的缩系.</p><p>故有$\prod_{i=1}^{\varphi(m)}a_i \equiv \prod_{i=1}^{\varphi(m)}aa_i \equiv a^{\varphi(m)}\prod_{i=1}^{\varphi(m)}a_i \pmod m$</p><p>则可以推出$a^{\varphi(m)} \equiv 1 \pmod m$. </p></blockquote><p>证毕</p><p>欧拉定理可以推出<strong>费马小定理</strong>：</p><blockquote><p>如果p是一个质数，而整数$a$不是$p$的倍数，</p><p>则有$a^{(p-1)} \equiv 1 \pmod p$。</p></blockquote><h2 id="例题"><a href="#例题" class="headerlink" title="例题"></a>例题</h2><h3 id="CF1114F"><a href="#CF1114F" class="headerlink" title="CF1114F"></a>CF1114F</h3><p><a href="https://www.luogu.com.cn/problem/CF1114F">CF1114F Please, another Queries on Array?</a></p><p>线段树维护欧拉函数区间修改。</p><p>用一棵线段树维护区间积，因为有 $a_i,x\le 300$ ，所以可以选择开六十余棵线段树来维护质因数的出现情况，但这样必死无疑。所以选择压位，可以用 <code>std::bitset</code> 或者 <code>long long</code> 来状态压缩。</p>]]></content>
      
      
      <categories>
          
          <category> 学习笔记 </category>
          
          <category> OI </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 数论 </tag>
            
            <tag> 函数 </tag>
            
            <tag> 欧拉函数 </tag>
            
            <tag> 欧拉反演 </tag>
            
            <tag> 积性函数 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>同余</title>
      <link href="/Eternity/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/OI/congruence/"/>
      <url>/Eternity/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/OI/congruence/</url>
      
        <content type="html"><![CDATA[<p>“虽然我们相差甚远，但至少初心是一致的。”</p><span id="more"></span><h2 id="同余"><a href="#同余" class="headerlink" title="同余"></a>同余</h2><h3 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h3><p>$a$ 与 $b$ 同余，当且仅当 $a$ 与 $b$ 除以 $p$ 的余数相同，记作 $a$ 与 $b$ 模 $p$ 同余，写作 $a \equiv b \pmod p$。</p><h3 id="同余的性质"><a href="#同余的性质" class="headerlink" title="同余的性质"></a>同余的性质</h3><ul><li><p>若 $a \equiv b \pmod p$ ，则有 $a+c \equiv b+c \pmod p$</p></li><li><p>若 $a \equiv b \pmod p$ ，则有 $ac \equiv bc \pmod p$</p></li><li><p>若 $a \equiv b \pmod p$ ，且 $c \equiv d \pmod p$ ，则有 $a \pm c \equiv b \pm d \pmod p$</p></li><li><p>若 $ac \equiv bc \pmod p$ ，且 $(c,m)=1$ ，那么 $a \equiv b \pmod p$</p></li><li><p>若 $a \equiv b \pmod p$ ，且 $c \equiv d \pmod p$ ，则有 $ac \equiv bd \pmod p$</p></li><li><p>若 $a \equiv b \pmod p$ ，则有 $ac \equiv bc \pmod {pc}$</p></li><li><p>若 $a$ 和 $b$ 都是整数，且 $d$ 和 $m$ 都是正整数， $d$ 是 $a,b,m$ 中任一公因数，则如果 $a \equiv b \pmod m$ 成立时，则有 $\frac{a}{d} \equiv \frac{b}{d} \pmod {\frac{p}{d}}$</p></li><li><p>若 $a$ 和 $b$ 都是整数，且 $d$ 和 $m$ 都是正整数，且 $d|m$，则如果 $a \equiv b \pmod m$ 成立时，则有 $a \equiv b \pmod d$ 。</p></li><li><p>若 $a$ 和 $b$ 都是整数，且 $d$ 和 $m$ 都是正整数，如果 $a \equiv b \pmod m$ 成立时，则有 $(a,m)=(b,m)$ ，且若如果 $d$ 能够整除 $a,b,m$ 中的任意一个， $d$ 也就能整除 $a,b$ 中的另一个。</p></li></ul><h2 id="扩展欧几里得算法"><a href="#扩展欧几里得算法" class="headerlink" title="扩展欧几里得算法"></a>扩展欧几里得算法</h2><p>若 $(a,b)=d$ ，那么对于方程 $ax+by=d$ 的解有一组特殊解为 $x=x_0,y=y_0$ ，那么该方程的通解为 $x=x_0+\frac{b}{d}\times t,y=y_0-\frac{a}{d}\times t$ ，而我们用这个通解来逆向推出 $gcd$ ，因为我们有<strong>欧几里得定理</strong>：</p><blockquote><p>$(a,b)=d$ ，则有 $(b,a \bmod b)=d$</p></blockquote><p>那么就会推出： $d=a\times y_1+b\times (x_1-y_1\times\frac{a}{b})$ </p><p>在这个算式中满足： $x=y_1,y=x_1-\frac{a}{b}\times y_1$</p><h3 id="扩欧解同余方程"><a href="#扩欧解同余方程" class="headerlink" title="扩欧解同余方程"></a>扩欧解同余方程</h3><p>对于方程 $ax \equiv 1 \pmod b$ ，已知 $a$ 与 $b$ ，求出最小的 $x$ 。</p><p><a href="https://www.luogu.com.cn/problem/P1082">LuoguP1082</a></p><p>妥妥的扩欧模板题：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;ctime&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iomanip&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stack&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;map&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> gh() getchar()</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> underMax(x,y) ((x)&gt;(y)?(x):(y))</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> underMin(x,y) ((x)&lt;(y)?(x):(y))</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> LL;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">underRead</span><span class="params">(T &amp;x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    x=<span class="number">0</span>;</span><br><span class="line">    <span class="type">char</span> ch=<span class="built_in">gh</span>(),t=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(ch&lt;<span class="string">&#x27;0&#x27;</span>||ch&gt;<span class="string">&#x27;9&#x27;</span>) t|=ch==<span class="string">&#x27;-&#x27;</span>,ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">while</span>(ch&gt;=<span class="string">&#x27;0&#x27;</span>&amp;&amp;ch&lt;=<span class="string">&#x27;9&#x27;</span>) x=(x&lt;&lt;<span class="number">3</span>)+(x&lt;&lt;<span class="number">1</span>)+(ch^<span class="number">48</span>),ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">if</span>(t) x=-x;</span><br><span class="line">&#125;</span><br><span class="line">LL a,b,x,y;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">underExgcd</span><span class="params">(LL a,LL b)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(!b)</span><br><span class="line">    &#123;</span><br><span class="line">        x=<span class="number">1</span>,y=<span class="number">7</span>;            <span class="comment">//一对特殊解</span></span><br><span class="line">        <span class="keyword">return</span> ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">underExgcd</span>(b,a%b);</span><br><span class="line">    LL tx=x;</span><br><span class="line">    x=y;</span><br><span class="line">    y=tx-a/b*y;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// freopen(&quot;exgcd.in&quot;,&quot;r&quot;,stdin);</span></span><br><span class="line">    <span class="comment">// freopen(&quot;exgcd.out&quot;,&quot;w&quot;,stdout);</span></span><br><span class="line">    <span class="built_in">underRead</span>(a),<span class="built_in">underRead</span>(b);</span><br><span class="line">    <span class="built_in">underExgcd</span>(a,b);</span><br><span class="line">    x=(x%b+b)%b;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%lld&quot;</span>,x);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">3 10</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><h2 id="中国剩余定理"><a href="#中国剩余定理" class="headerlink" title="中国剩余定理"></a>中国剩余定理</h2><p><a href="https://www.luogu.com.cn/problem/P1495">LuoguP1495曹冲养猪</a></p><p>有一个同余方程组满足：</p><script type="math/tex; mode=display">\left\{\begin{matrix}x \equiv a_1 \pmod {m_1} \\x \equiv a_2 \pmod {m_2} \\x \equiv a_3 \pmod {m_3} \\x \equiv a_4 \pmod {m_4} \\x \equiv a_5 \pmod {m_5} \\...... \\x \equiv a_k \pmod {m_k}\end{matrix}\right. \nonumber</script><p> ，求出最小的 $x$ 。</p><h3 id="思路"><a href="#思路" class="headerlink" title="思路"></a>思路</h3><p>设 $M=m_1m_2m_3…m_k$ ，令 $M_i=\frac{M}{m_i}$ ，$t_i$ 是 $M_i$  的逆元，有 $M_it_i \equiv 1 \pmod m_i$</p><p>则 $x=\sum_{i=1}^{k}{a_iM_it_i}$</p><p>则可构造特殊解 $x_0=x+k\times M$</p><p>最小正整数解即为 $x_{min}=x_0 \bmod M$</p><h3 id="P3868-AC-Code"><a href="#P3868-AC-Code" class="headerlink" title="P3868 AC Code"></a>P3868 AC Code</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;ctime&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iomanip&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stack&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;map&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> gh() getchar()</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> underMax(x,y) ((x)&gt;(y)?(x):(y))</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> underMin(x,y) ((x)&lt;(y)?(x):(y))</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> LL;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN=<span class="number">1e5</span>+<span class="number">1</span>;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">underRead</span><span class="params">(T &amp;x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    x=<span class="number">0</span>;</span><br><span class="line">    <span class="type">char</span> ch=<span class="built_in">gh</span>(),t=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(ch&lt;<span class="string">&#x27;0&#x27;</span>||ch&gt;<span class="string">&#x27;9&#x27;</span>) t|=ch==<span class="string">&#x27;-&#x27;</span>,ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">while</span>(ch&gt;=<span class="string">&#x27;0&#x27;</span>&amp;&amp;ch&lt;=<span class="string">&#x27;9&#x27;</span>) x=(x&lt;&lt;<span class="number">3</span>)+(x&lt;&lt;<span class="number">1</span>)+(ch^<span class="number">48</span>),ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">if</span>(t) x=-x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> N;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Node</span></span><br><span class="line">&#123;</span><br><span class="line">    LL type,mod;</span><br><span class="line">&#125;Num[MAXN];</span><br><span class="line">LL M[MAXN],Mul=<span class="number">1</span>,Mi[MAXN],X;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">underExgcd</span><span class="params">(LL a,LL b,LL &amp;x,LL &amp;y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(!b)</span><br><span class="line">    &#123;</span><br><span class="line">        x=<span class="number">1</span>,y=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">return</span> ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">underExgcd</span>(b,a%b,x,y);</span><br><span class="line">    LL z=x;x=y;y=z-y*(a/b);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// freopen(&quot;china.in&quot;,&quot;r&quot;,stdin);</span></span><br><span class="line">    <span class="comment">// freopen(&quot;china.out&quot;,&quot;w&quot;,stdout);</span></span><br><span class="line">    <span class="built_in">underRead</span>(N);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=N;++i)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">underRead</span>(Num[i].type),<span class="built_in">underRead</span>(Num[i].mod);</span><br><span class="line">        Mul*=Num[i].type;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> t=<span class="number">1</span>;t&lt;=N;++t)</span><br><span class="line">    &#123;</span><br><span class="line">        Mi[t]=Mul/Num[t].type;</span><br><span class="line">        LL x=<span class="number">0</span>,y=<span class="number">0</span>;</span><br><span class="line">        <span class="built_in">underExgcd</span>(Mi[t],Num[t].type,x,y);</span><br><span class="line">        X+=Num[t].mod*Mi[t]*(x&lt;<span class="number">0</span>?x+Num[t].type:x);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%lld&quot;</span>,X%Mul);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">3</span></span><br><span class="line"><span class="comment">3 1</span></span><br><span class="line"><span class="comment">5 1</span></span><br><span class="line"><span class="comment">7 2</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><hr>]]></content>
      
      
      <categories>
          
          <category> 学习笔记 </category>
          
          <category> OI </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 数论 </tag>
            
            <tag> 质数 </tag>
            
            <tag> 同余 </tag>
            
            <tag> gcd </tag>
            
            <tag> lcm </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>数列与极限 #2</title>
      <link href="/Eternity/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/Math/analytical-mathematics-series-limits-2/"/>
      <url>/Eternity/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/Math/analytical-mathematics-series-limits-2/</url>
      
        <content type="html"><![CDATA[<p>“当我趋近于你，我们之间的感情便成为了确值”</p><span id="more"></span><h2 id="实数的完备性定理（部分）"><a href="#实数的完备性定理（部分）" class="headerlink" title="实数的完备性定理（部分）"></a>实数的完备性定理（部分）</h2><h3 id="单调有界定理"><a href="#单调有界定理" class="headerlink" title="单调有界定理"></a>单调有界定理</h3><ol><li><p>若数列 $\{ x_n \}$ 递增且有上界，则</p><script type="math/tex; mode=display">\lim \limits_{n \to +\infty} x_n = \sup \{ x_n | n \in N \}</script></li><li><p>若数列 $\{ x_n \}$ 递减且有下界，则</p><script type="math/tex; mode=display">\lim \limits_{n \to +\infty} x_n = \inf \{ x_n | n \in N\}</script></li></ol><h3 id="柯西收敛原理"><a href="#柯西收敛原理" class="headerlink" title="柯西收敛原理"></a>柯西收敛原理</h3><p>设 $ \{ x_n \} $ 是一个数列，如果对于任意一个 $\epsilon &gt; 0$ ，存在 $N \in \mathbb{Z^<em>}$ ，只要 $n$ 满足 $n &gt; N$ ，则对于任意正整数 $p$ 而言，都有 $| x_{n+p}-x_n | &lt; \epsilon$ ，这样的数列 $\{ x_n \}$ 便称为<em>*柯西数列</em></em>。</p><p>这样的<strong>渐进稳定性</strong>和<strong>收敛性</strong>是等价的，即为<strong>充分必要条件</strong>。</p><p>简单来说：</p><script type="math/tex; mode=display">数列 \{ x_n \} 收敛的充要条件是 \forall \epsilon \in \mathbb{R^+} , \exists N \in \mathbb{Z^+} , \forall n,m > N ( | x_m - x_n | < \epsilon )</script><h3 id="戴德金原理"><a href="#戴德金原理" class="headerlink" title="戴德金原理"></a>戴德金原理</h3><p>如果 $\mathbb{R}$ 的两个子集 $A$ 和 $B$ 满足：</p><script type="math/tex; mode=display">\begin{aligned}&1. A \neq \emptyset \wedge B \neq \emptyset \\&2. A \cup B = \mathbb{R}\\&3. \forall x \in A , \forall y \in B ( x < y ) \\\end{aligned}</script><p>那么， $\exists c \in \mathbb{R} ( \forall a \in A , \forall b \in B ( a  \leq c \leq b) )$ 。</p><h3 id="闭区间套定理"><a href="#闭区间套定理" class="headerlink" title="闭区间套定理"></a>闭区间套定理</h3><p>如果数列 $\{ a_n \}$ 和 $\{ b_n \}$ 满足：</p><script type="math/tex; mode=display">\begin{aligned}&1. \forall n \in \mathbb{Z^+} ( a_n \leq a_{n+1} < b_{n+1} \leq b_n ) \\&2. \lim \limits_{n \to +\infty} ( b_n - a_n ) = 0 \\\end{aligned}</script><p>那么以下结论成立：</p><script type="math/tex; mode=display">\begin{aligned}&1. \lim \limits_{n \to +\infty} a_n = \lim \limits =_{n \to +\infty} b_n (该极限值记为 c )\\&2. 上述 c 是满足 \forall n \in \mathbb{Z^+} ( a_n \leq c \leq b_n ) 的唯一实数\end{aligned}</script><h3 id="确界存在原理"><a href="#确界存在原理" class="headerlink" title="确界存在原理"></a>确界存在原理</h3><p>对于 $\mathbb{R}$ 的任何非空子集 $S$ ，若 $S$ 在 $\mathbb{R}$ 内有上界，则 $S$ 在 $\mathbb{R}$ 内有上确界。</p>]]></content>
      
      
      <categories>
          
          <category> 学习笔记 </category>
          
          <category> Math </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 数论 </tag>
            
            <tag> 分析数学 </tag>
            
            <tag> 微积分 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>数列与极限</title>
      <link href="/Eternity/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/Math/analytical-mathematics-series-limits/"/>
      <url>/Eternity/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/Math/analytical-mathematics-series-limits/</url>
      
        <content type="html"><![CDATA[<blockquote><p>数学不能凭 $\text{sense}$ ，必须要追求<strong>严谨</strong>。—— $Zq$</p></blockquote><span id="more"></span><h2 id="数列定义"><a href="#数列定义" class="headerlink" title="数列定义"></a>数列定义</h2><p>一种从自然数（或正整数）到实数（或其它域）的映射 $f : \mathbb{N} \to \mathbb{R}$ ，这便是一个<strong>数列</strong>。一般来说，设 $a_n=f(n)$ ，则该数列记作 $\{ a_n \}_{n=0}^{+ \infty}$</p><p>定义一个数列 $f : \mathbb{N} \to \mathbb{R}$ 的子数列为一个数列 $g : L \to \mathbb{R}$ 满足 $L \subseteq \mathbb{N} \wedge \forall n \in L , g(n) = f(n) \wedge \mid L \mid = + \infty$ 。</p><h2 id="极限"><a href="#极限" class="headerlink" title="极限"></a>极限</h2><p>对于一个数列 ${a_n\}_{n = 1}^{+ \infty }$ ，若 $\exists \delta \in R, s.t. \forall \epsilon &gt; 0, \exists N &gt; 0 \wedge N \in \mathbb{N}^+, s.t. \forall n &gt; N , \mid a_n - \delta \mid &lt; \epsilon$ ，我们就称 $\delta$ 为数列的极限，记作 $\lim\limits _{n \to + \infty} a_n = \delta$ ，或者 $a_n \to \delta(n \to + \infty)$ ，有时候括号内的可以省略。（上面的 $s.t$ 指 “使得”）</p><p>对于一个数列，如果它存在极限，我们就称这个数列<strong>收敛</strong>，否则就称其<strong>发散</strong>。</p><h2 id="数列极限的几何意义"><a href="#数列极限的几何意义" class="headerlink" title="数列极限的几何意义"></a>数列极限的几何意义</h2><p>对于一个数列满足：</p><script type="math/tex; mode=display">\begin{aligned}当 n > N 时，均有不等式 | x_n - a | < \epsilon\end{aligned}</script><p>即表示：</p><script type="math/tex; mode=display">\begin{aligned}\\所有下标大于 N 的 x_n 都落在 ( a - \epsilon , a + \epsilon ) 内，\\且落在 ( a - \epsilon , a + \epsilon ) 之外的点至多有 N 个（有限）\end{aligned}</script><p>如果存在某个值 $\epsilon_0$ 使得数列 ${x_n}$ 中有无穷个项落在 $( a - \epsilon_0 , a+ \epsilon_0)$ 之外，则 ${x_n}$ 一定不以 $a$ 为极限。</p><h2 id="数列极限的性质："><a href="#数列极限的性质：" class="headerlink" title="数列极限的性质："></a>数列极限的性质：</h2><h3 id="唯一性"><a href="#唯一性" class="headerlink" title="唯一性"></a>唯一性</h3><p>若一个数列的极限存在，则极限值是唯一的，且它的任何子列的极限与原数列相等。</p><p>证明，即：若 $a_n \to b, a_n \to c$ 则 $b = c$</p><p>有：</p><script type="math/tex; mode=display">\begin{aligned}\forall \epsilon > 0, \exists N_b > 0, s.t. \forall n > N_b, \mid a_n - b \mid < \epsilon \\\forall \epsilon > 0, \exists N_c > 0, s.t. \forall n > N_c, \mid a_n - c \mid < \epsilon \\\end{aligned}</script><p>记 $N = \max(N_b, N_c)$ 有：</p><script type="math/tex; mode=display">\forall n > N, \mid a_n - c \mid + \mid a_n - b \mid < 2 \epsilon</script><p>由三角不等式 $\mid a \mid - \mid b \mid \le \mid a \pm b \mid \le \mid a \mid + \mid b \mid$ 得：</p><script type="math/tex; mode=display">\mid b - c \mid < 2 \epsilon</script><p>由于 $\epsilon$ 可以无限小，故有 $b = c$</p><p>QED</p><h3 id="有界性"><a href="#有界性" class="headerlink" title="有界性"></a>有界性</h3><p>如果一个数列收敛，则这个数列一定有界。</p><p><strong>但如果一个数列有界，它不一定收敛</strong> $e.g. {x_n}=(-1)^n$</p><h3 id="保号性"><a href="#保号性" class="headerlink" title="保号性"></a>保号性</h3><p>若 $\lim \limits_{n \to +\infty} x_n = a &gt; 0$ （或 $<0$ ） ，则对任何 $m \in ( 0 , a )( a < 0$ 时则是 $m \in ( a , 0 )$ ，存在 $N > 0$ ，使 $n &gt; N$ 时有 $x_n &gt; M$ （相应的是 $x_n&lt;m$ ）</p><h3 id="基本运算法则"><a href="#基本运算法则" class="headerlink" title="基本运算法则"></a>基本运算法则</h3><ul><li>若 $C$ 为常数，则 $\lim \limits_{n \to + \infty} C = C$</li><li>若 $C$ 为常数，则 $\lim \limits_{n \to + \infty} \frac{C}{n} = 0$</li><li>若 $| a | &lt; 1$ ，则 $\lim \limits_{n \to +\infty} a^n = 0$</li><li>如果 $\lim \limits_{n \to +\infty} a_n = A , \lim \limits_{n \to + \infty} b_n =B$ 且 $C$ 为常数。则：</li></ul><script type="math/tex; mode=display">\begin{aligned}\\ \lim \limits_{n \to +\infty} (a_n \pm b_n) = A \pm B\\ \lim \limits_{n \to +\infty} (a_n · b_n) = A · B\end{aligned}</script><h2 id="子数列的极限"><a href="#子数列的极限" class="headerlink" title="子数列的极限"></a>子数列的极限</h2><p>对于一个数列 $\{a_n\}{n = 1}^{+ \infty}$ 的子数列 $\{a{n_k}\}{k = 1}^{+ \infty}$ ，若 $a_n \to \delta$ ，则 $a{n_k} \to \delta$</p><p>证明：</p><p>对于所有 $k$ ，有 $n_k \ge k$ ，又因为 $\forall \epsilon &gt; 0, \exists N &gt; 0, s.t. \forall n &gt; N, \mid a_n - b \mid &lt; \epsilon$</p><p>故 $\forall \epsilon &gt; 0$ ，取 $K = N$ ，有 $\forall k &gt; K, n_k \ge k &gt; K = N$ ，故 $\mid a_{n_k} - b \mid &lt; \epsilon$ ，即 $a_{n_k} \to \delta$</p><p>QED</p><h2 id="级数"><a href="#级数" class="headerlink" title="级数"></a>级数</h2><p>级数是指将数列的项依次用加号连接起来的函数，用 $OIer$ 的话来说就是数列的前缀和，即对于数列 $\{s _n\} _{n = 1}^{+ \infty}$ ，有 $s _n = \sum _{i = 1}^n a _i$ </p><h2 id="数列的和"><a href="#数列的和" class="headerlink" title="数列的和"></a>数列的和</h2><p>对于数列 $\{a _n\} _{n = 1}^{+ \infty}$ ，它的和 $\sum _{n = 1}^{+ \infty} a _n$ 有意义，当且仅当它的级数数列 $\{s _n\} _{n = 1}^{+ \infty}$ 收敛</p><p>正确性显然</p><p>这里补充一个等比数列求和公式（设公比为 $q$ ）： $(1 - q)(1 + q + q^2 + … + q^n) = 1 - q^{n + 1}$</p><h2 id="极限的线性可加性"><a href="#极限的线性可加性" class="headerlink" title="极限的线性可加性"></a>极限的线性可加性</h2><p>设 $a_n \to a, b_m \to b$ ，则 $\lim \limits _{n \to + \infty} (\alpha a_n + \beta b_n) = \alpha a + \beta b$</p><p>证明：</p><script type="math/tex; mode=display">\begin{aligned}& \mid \alpha a _n + \beta b _n - (\alpha a + \beta b) \mid \\\le & \mid \alpha \mid \mid a _n - a \mid + \mid \beta \mid \mid b _n - b \mid \\& = \mid \alpha \mid \epsilon ‘ + \mid \beta \mid \epsilon ‘\end{aligned}</script><h2 id="夹逼定理"><a href="#夹逼定理" class="headerlink" title="夹逼定理"></a>夹逼定理</h2><p>设 $a_n \le b_n \le c_n$ ，且 $\lim \limits _{n \to + \infty} a_n = \lim \limits _{n \to + \infty} c_n$ ，则 $\lim \limits _{n \to + \infty} a_n = \lim \limits _{n \to + \infty} b_n$ </p>]]></content>
      
      
      <categories>
          
          <category> 学习笔记 </category>
          
          <category> Math </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 数论 </tag>
            
            <tag> 分析数学 </tag>
            
            <tag> 微积分 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>函数与极限</title>
      <link href="/Eternity/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/Math/analytical-mathematics-limits-of-functions/"/>
      <url>/Eternity/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/Math/analytical-mathematics-limits-of-functions/</url>
      
        <content type="html"><![CDATA[<p>“一步一步向前，直到终点”</p><span id="more"></span><p>在了解函数极限之前，我们需要知道一些概念。</p><p><a href="https://dyd-true.github.io/2022/02/12/%E5%87%BD%E6%95%B0%E7%9A%84%E6%9E%81%E9%99%90/#more">资料参考：Dyd巨佬</a></p><h2 id="拓扑空间"><a href="#拓扑空间" class="headerlink" title="拓扑空间"></a>拓扑空间</h2><h3 id="拓扑空间的邻域定义"><a href="#拓扑空间的邻域定义" class="headerlink" title="拓扑空间的邻域定义"></a>拓扑空间的邻域定义</h3><p>设 $X$ 是一个集合， $\mathfrak{U}_x$ 为其子集族，其元称为 $x$ 的<strong>邻域</strong>，令 $\mathfrak{U} = \{ \mathfrak{U}_x \}_{x \in X}$ ，则 $( X , \mathfrak{U})$ 被称为一个<strong>拓扑空间</strong>。</p><h2 id="邻域"><a href="#邻域" class="headerlink" title="邻域"></a>邻域</h2><p>邻域，是指集合上的一种基础的拓扑结构。</p><p>对于实数 $\alpha , \delta$  ：</p><p>定义数集 $\{x \in R \mid a - \delta &lt; x &lt; a + \delta\}$ 为 $a$ 以 $\delta$ 为半径的<strong>邻域</strong>，记做 $U(a, \delta)$ </p><p>定义数集 $\{x \in R \mid a - \delta &lt; x &lt; a 或 a &lt; x &lt; a + \delta\}$ 为 $a$ 以 $\delta$ 为半径的<strong>去心邻域</strong>，记做 $\mathring{U}(a, \delta)$ </p><p> 定义数集 $\{x \in R \mid a - \delta &lt; x &lt; a\}$ 为 $a$ 以 $\delta$ 为半径的<strong>去心左邻域</strong>，记做 $\mathring{U} _- (a, \delta)$ </p><p> 定义数集 $\{x \in R \mid a &lt; x &lt; a + \delta\}$ 为 $a$ 以 $\delta$ 为半径的<strong>去心右邻域</strong>，记做 $\mathring{U} _+ (a, \delta)$ </p><p>函数的左极限和右极限统称为<strong>侧边极限</strong></p><p>明显， $\lim \limits _{x \to {x _0} _+} f(x) = a$ 且 $\lim \limits _{x  \to {x _0} _-} f(x) = a$ 与 $\lim \limits _{x \to x _0} f(x) = a$ 互为充要条件</p><h2 id="性质"><a href="#性质" class="headerlink" title="性质"></a>性质</h2><h3 id="唯一性"><a href="#唯一性" class="headerlink" title="唯一性"></a>唯一性</h3><p>若 $f(x) \to a(x \to r)$ 且 $f(x) \to b (x \to r)$ ，则 $a = b$</p><h3 id="局部有界"><a href="#局部有界" class="headerlink" title="局部有界"></a>局部有界</h3><p>若在某一个过程时 $f(x)$ 有极限，则存在一个时刻以后 $f(x)$ 有界。</p><p>即若极限 $\lim \limits_{x \to x_0} f(x)$ 存在，则函数 $f(x)$ 在 $x_0$ 的某一空心邻域上有界。</p><h3 id="局部保号性"><a href="#局部保号性" class="headerlink" title="局部保号性"></a>局部保号性</h3><p>若 $\lim \limits_{x \to x_0} f(x) = A$ ，且 $A &gt; 0$ ，则 $\exists \delta &gt; 0$ ，当 $x \in U^0 ( x_0 , \delta )$ 时， $ f(x)&gt;0 $ 。</p><h3 id="迫敛性"><a href="#迫敛性" class="headerlink" title="迫敛性"></a>迫敛性</h3><p>如果函数 $f(x),g(x),h(x)$ 满足：</p><ol><li>$g(x) \leq f(x) \leq h(x)$ </li><li>$\lim g(x) = A , \lim h(x) = A$ </li></ol><p>那么 $\lim f(x)$ 存在且为 $A$ 。</p>]]></content>
      
      
      <categories>
          
          <category> 学习笔记 </category>
          
          <category> Math </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 数论 </tag>
            
            <tag> 分析数学 </tag>
            
            <tag> 微积分 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>OIP2022.03.05模拟赛</title>
      <link href="/Eternity/%E6%A8%A1%E6%8B%9F%E8%B5%9B-%E6%AF%94%E8%B5%9B/20220305/"/>
      <url>/Eternity/%E6%A8%A1%E6%8B%9F%E8%B5%9B-%E6%AF%94%E8%B5%9B/20220305/</url>
      
        <content type="html"><![CDATA[<p>“<del>提高模拟能考出省选题来</del>“</p><span id="more"></span><h2 id="题目I——最短路径-path"><a href="#题目I——最短路径-path" class="headerlink" title="题目I——最短路径(path)"></a>题目I——最短路径(path)</h2><h3 id="题目描述"><a href="#题目描述" class="headerlink" title="题目描述"></a>题目描述</h3><p>一个 $N$ 个点，$M$ 条边的有向权值图，求全源最短路中每条边被经过的次数。</p><p><strong>最短路径</strong>：从 $a$ 到 $b$ 的最短路径是指一条路径当且仅当不存在另一条从 $a -&gt; b$ 的路径比该路径更短。</p><blockquote><p>意思是<strong>两点之间的最短路径不止一条</strong></p></blockquote><p>求每条边通过的最短路径的个数。取模 $10^9+7$。</p><h3 id="思路I"><a href="#思路I" class="headerlink" title="思路I"></a>思路I</h3><p>用 $Spfa$ 跑 $n$ 遍最短路，跑完之后枚举每条边，记录所有满足 $val_i+c_{i,j}=val_j$ 的边。再以此对于每一遍 $Spfa$ 跑一遍 $Topo$ 排序。</p><h3 id="思路II"><a href="#思路II" class="headerlink" title="思路II"></a>思路II</h3><p>依然是跑 $n$ 遍最短路，求出<strong>最短路径图</strong>，即只含最短路的边。用 $f_i$ 表示从 $1$ 点至 $i$ 点有多少条路径， $g_i$ 表示从 $i$ 号点往后走有多少条路径。则以 $i$ 为起点的所有最短路中，经过 $c_j(u,v)$ 边的路径条数为 $f_u*g_v$</p><h3 id="另话"><a href="#另话" class="headerlink" title="另话"></a>另话</h3><p>这道题在洛谷上是双倍经验。一道紫一道灰。<del>这样做 $NOIp$ 模拟的第一题真的好吗</del></p><h3 id="Task-One-Ac-Code"><a href="#Task-One-Ac-Code" class="headerlink" title="Task One Ac Code"></a>Task One Ac Code</h3><details>    <summary>思路I</summary><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;ctime&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iomanip&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stack&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;map&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> gh() getchar()</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> underMax(x,y) ((x)&gt;(y)?(x):(y))</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> underMin(x,y) ((x)&lt;(y)?(x):(y))</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> ll;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN=<span class="number">1501</span>,MAXM=<span class="number">5001</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> Mod=<span class="number">1e9</span>+<span class="number">7</span>;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">underRead</span><span class="params">(T &amp;x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    x=<span class="number">0</span>;</span><br><span class="line">    <span class="type">char</span> ch=<span class="built_in">gh</span>(),t=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(ch&lt;<span class="string">&#x27;0&#x27;</span>||ch&gt;<span class="string">&#x27;9&#x27;</span>) t|=ch==<span class="string">&#x27;-&#x27;</span>,ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">while</span>(ch&gt;=<span class="string">&#x27;0&#x27;</span>&amp;&amp;ch&lt;=<span class="string">&#x27;9&#x27;</span>) x=x*<span class="number">10</span>+(ch^<span class="number">48</span>),ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">if</span>(t) x=-x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> N,M,u,v,w;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Node</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> from,to,next,val;</span><br><span class="line">&#125;Edge[MAXM&lt;&lt;<span class="number">1</span>];</span><br><span class="line"><span class="type">int</span> First[MAXN],Total,Dist[MAXN],Que[MAXM&lt;&lt;<span class="number">1</span>];</span><br><span class="line"><span class="type">bool</span> Vis[MAXN],Is[MAXM];</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">underAdd</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> y,<span class="type">int</span> z)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Edge[++Total]=(Node)&#123;x,y,First[x],z&#125;;First[x]=Total;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">underSPFA</span><span class="params">(<span class="type">int</span> x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">memset</span>(Dist,<span class="number">0x7f7f7f7f</span>,<span class="built_in">sizeof</span>(Dist));</span><br><span class="line">    <span class="built_in">memset</span>(Is,<span class="number">0</span>,<span class="built_in">sizeof</span>(Is));</span><br><span class="line">    <span class="keyword">register</span> <span class="type">int</span> len;</span><br><span class="line">    Dist[Que[len=<span class="number">1</span>]=x]=<span class="number">0</span>,Vis[x]=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=len;++i)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> u=Que[i];Vis[u]=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> e=First[u],v;e;e=Edge[e].next)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span>(Dist[u]+Edge[e].val&lt;Dist[v=Edge[e].to])</span><br><span class="line">&#123;</span><br><span class="line">    Dist[v]=Dist[u]+Edge[e].val;</span><br><span class="line">    <span class="keyword">if</span>(!Vis[v]) Vis[Que[++len]=v]=<span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=M;++i)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span>(Dist[Edge[i].from]+Edge[i].val==Dist[Edge[i].to])</span><br><span class="line">&#123;</span><br><span class="line">    Is[i]=<span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> Deg[MAXN],Cnt[<span class="number">3</span>][MAXN],Ord[MAXN],len,Ans[MAXM];</span><br><span class="line">queue&lt;<span class="type">int</span>&gt;Q;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">underTopo</span><span class="params">(<span class="type">int</span> s)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">while</span>(!Q.<span class="built_in">empty</span>()) Q.<span class="built_in">pop</span>();</span><br><span class="line">    <span class="built_in">memset</span>(Deg,<span class="number">0</span>,<span class="built_in">sizeof</span>(Deg));</span><br><span class="line">    <span class="built_in">memset</span>(Cnt,<span class="number">0</span>,<span class="built_in">sizeof</span>(Cnt));</span><br><span class="line">    len=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=M;++i) <span class="keyword">if</span>(Is[i]) ++Deg[Edge[i].to];</span><br><span class="line">    Q.<span class="built_in">push</span>(s); Cnt[<span class="number">1</span>][s]=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span>(!Q.<span class="built_in">empty</span>())</span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> u=Q.<span class="built_in">front</span>();Q.<span class="built_in">pop</span>();</span><br><span class="line">    Ord[++len]=u;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> e=First[u];e;e=Edge[e].next)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span>(!Is[e]) <span class="keyword">continue</span>;</span><br><span class="line">    <span class="type">int</span> v=Edge[e].to;</span><br><span class="line">    Cnt[<span class="number">1</span>][v]=(Cnt[<span class="number">1</span>][v]+Cnt[<span class="number">1</span>][u])%Mod;</span><br><span class="line">    <span class="keyword">if</span>(--Deg[v]==<span class="number">0</span>) Q.<span class="built_in">push</span>(v);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> j=len;j&gt;=<span class="number">1</span>;--j)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> x=Ord[j];++Cnt[<span class="number">2</span>][x];</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> e=First[x];e;e=Edge[e].next)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span>(!Is[e]) <span class="keyword">continue</span>;</span><br><span class="line">    Cnt[<span class="number">2</span>][x]=(Cnt[<span class="number">2</span>][x]+Cnt[<span class="number">2</span>][Edge[e].to])%Mod;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="built_in">freopen</span>(<span class="string">&quot;path.in&quot;</span>,<span class="string">&quot;r&quot;</span>,stdin);</span><br><span class="line"><span class="built_in">freopen</span>(<span class="string">&quot;path.out&quot;</span>,<span class="string">&quot;w&quot;</span>,stdout);</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>,&amp;N,&amp;M);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=M;++i)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d%d%d&quot;</span>,&amp;u,&amp;v,&amp;w);</span><br><span class="line">    <span class="built_in">underAdd</span>(u,v,w);</span><br><span class="line">&#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=N;++i)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">underSPFA</span>(i);<span class="built_in">underTopo</span>(i);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">1</span>;j&lt;=M;++j)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span>(Is[j]) Ans[j]=(Ans[j]+<span class="number">1ll</span>*Cnt[<span class="number">1</span>][Edge[j].from]*Cnt[<span class="number">2</span>][Edge[j].to]%Mod)%Mod;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=M;++i) <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,Ans[i]);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">4 4</span></span><br><span class="line"><span class="comment">1 2 5</span></span><br><span class="line"><span class="comment">2 3 5</span></span><br><span class="line"><span class="comment">3 4 5</span></span><br><span class="line"><span class="comment">1 4 8</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br></pre></td></tr></table></figure></details><details>    <summary>思路II</summary><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> P = <span class="number">1000000007</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Edge</span> &#123;</span><br><span class="line">    <span class="type">int</span> x, y, w, next, ans;</span><br><span class="line">    <span class="type">bool</span> flag;</span><br><span class="line">&#125; map[<span class="number">5101</span>];</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> n, m, st, ed;</span><br><span class="line"><span class="type">int</span> d[<span class="number">1510</span>], r[<span class="number">1510</span>], dis[<span class="number">1510</span>], f[<span class="number">1510</span>], g[<span class="number">1510</span>], head[<span class="number">1510</span>];</span><br><span class="line"><span class="type">bool</span> flag[<span class="number">1510</span>];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">cmp</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> dis[a] &lt; dis[b];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">add_edge</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y, <span class="type">int</span> w, <span class="type">int</span> c)</span> </span>&#123;</span><br><span class="line">    map[c].x = x;</span><br><span class="line">    map[c].y = y;</span><br><span class="line">    map[c].w = w;</span><br><span class="line">    map[c].ans = <span class="number">0</span>;</span><br><span class="line">    map[c].next = head[x];</span><br><span class="line">    head[x] = c;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="built_in">freopen</span>(<span class="string">&quot;path.in&quot;</span>, <span class="string">&quot;r&quot;</span>, stdin);</span><br><span class="line"><span class="built_in">freopen</span>(<span class="string">&quot;path.out&quot;</span>, <span class="string">&quot;w&quot;</span>, stdout);</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>, &amp;n, &amp;m);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">0</span>; i&lt;n; i++)</span><br><span class="line">        head[i] = <span class="number">-1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">0</span>; i&lt;m; i++) &#123;</span><br><span class="line">        <span class="type">int</span> x, y, w;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d%d%d&quot;</span>, &amp;x, &amp;y, &amp;w);</span><br><span class="line">        x --; y --;</span><br><span class="line">        <span class="built_in">add_edge</span>(x, y, w, i);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">0</span>; i&lt;n; i++) r[i] = i;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> start=<span class="number">0</span>; start&lt;n; start++) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">0</span>; i&lt;n; i++) dis[i] = <span class="number">99999999</span>;</span><br><span class="line">        dis[start] = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">0</span>; i&lt;n; i++) flag[i] = <span class="literal">true</span>;</span><br><span class="line">        flag[start] = <span class="literal">false</span>;</span><br><span class="line">        st = ed = <span class="number">0</span>;</span><br><span class="line">        d[ed++] = start;</span><br><span class="line">        <span class="keyword">while</span> (st &lt; ed) &#123;</span><br><span class="line">            <span class="type">int</span> i = d[(st++) % n];</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> j=head[i]; j&gt;<span class="number">-1</span>; j=map[j].next)</span><br><span class="line">                <span class="keyword">if</span> (dis[i] + map[j].w &lt; dis[map[j].y]) &#123;</span><br><span class="line">                    dis[map[j].y] = dis[i] + map[j].w;</span><br><span class="line">                    <span class="keyword">if</span> (flag[map[j].y]) &#123;</span><br><span class="line">                        flag[map[j].y] = <span class="literal">false</span>;</span><br><span class="line">                        d[(ed++) % n] = map[j].y;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            flag[i] = <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//for (int i=0; i&lt;n; i++)</span></span><br><span class="line">        <span class="comment">//    printf(&quot;%d--&gt;%d: %d\n&quot;, start, i, dis[i]);</span></span><br><span class="line">        <span class="comment">//printf(&quot;start: %d\n&quot;, start);</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">0</span>; i&lt;m; i++)</span><br><span class="line">            <span class="keyword">if</span> (dis[map[i].x] + map[i].w == dis[map[i].y]) &#123;</span><br><span class="line">                map[i].flag = <span class="literal">true</span>;</span><br><span class="line">        <span class="comment">//        printf(&quot;%d--&gt;%d(%d)  &quot;, map[i].x, map[i].y, map[i].w);</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                map[i].flag = <span class="literal">false</span>;</span><br><span class="line">        <span class="comment">//printf(&quot;\n&quot;);</span></span><br><span class="line">        <span class="built_in">sort</span>(r, r+n, cmp);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">0</span>; i&lt;n; i++) f[i] = <span class="number">0</span>;</span><br><span class="line">        f[start] = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">0</span>; i&lt;n; i++) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> j=head[r[i]]; j&gt;<span class="number">-1</span>; j=map[j].next)</span><br><span class="line">                <span class="keyword">if</span> (map[j].flag)</span><br><span class="line">                    f[map[j].y] = (f[map[j].y] + f[r[i]]) % P;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//for (int i=0; i&lt;n; i++)</span></span><br><span class="line">        <span class="comment">//    printf(&quot;f[%d]=%d  &quot;, i, f[i]);</span></span><br><span class="line">        <span class="comment">//printf(&quot;\n&quot;);</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i=n<span class="number">-1</span>; i&gt;<span class="number">0</span>; i--) &#123;</span><br><span class="line">            g[r[i]] = <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> j=head[r[i]]; j&gt;<span class="number">-1</span>; j=map[j].next)</span><br><span class="line">                <span class="keyword">if</span> (map[j].flag)</span><br><span class="line">                    g[r[i]] = (g[r[i]] + g[map[j].y]) % P;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//for (int i=0; i&lt;n; i++)</span></span><br><span class="line">        <span class="comment">//    printf(&quot;g[%d]=%d  &quot;, i, g[i]);</span></span><br><span class="line">        <span class="comment">//printf(&quot;\n&quot;);</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">0</span>; i&lt;m; i++)</span><br><span class="line">            <span class="keyword">if</span> (map[i].flag) &#123;</span><br><span class="line">                <span class="comment">//printf(&quot;%d--&gt;%d  &quot;, map[i].x, map[i].y);</span></span><br><span class="line">                map[i].ans = (map[i].ans + g[map[i].y] * (<span class="type">long</span> <span class="type">long</span>)(f[map[i].x])) % P;</span><br><span class="line">            &#125;</span><br><span class="line">        <span class="comment">//printf(&quot;\n&quot;);</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">0</span>; i&lt;m; i++)</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, map[i].ans);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></details><h2 id="题目II——数列-seq"><a href="#题目II——数列-seq" class="headerlink" title="题目II——数列(seq)"></a>题目II——数列(seq)</h2><h3 id="题目描述-1"><a href="#题目描述-1" class="headerlink" title="题目描述"></a>题目描述</h3><p>对于一个长度为 $n$ 的数列，有 $m$ 个询问：</p><ol><li>$C\ i\ x$ 表示将下标为 $i$ 的数改为 $x$</li><li>$Q\ i$ 求满足 $\forall i \leq k \leq j,A_k \leq \max\{A_i,A_j\}$ 中 $j$ 的个数</li></ol><p>复杂度不大于 $O(n \log n)$</p><h3 id="题意思路"><a href="#题意思路" class="headerlink" title="题意思路"></a>题意思路</h3><p>根据其查询，我们需要找到所有的“谷段”，即如果我们将整个数列看作一个波峰图，如下图所示：</p><p><img src="https://violeteternal.github.io/blog/post-images/1646537618216.png" alt=""></p><p>那么我们就需要找到所有类似于开口向上的二次函数的个数。不难发现：当我们第一次找到 $A_p \leq A_j$ 时，$p$ 到 $j$ 之间的任意位置都是满足要求的。</p><p>然而，当第一次：</p><blockquote><p>当 $A_p = A_j$ 时，对于 $j$ 之后下一个满足要求的位置 $k$ 时，$j$ 与 $k$ 之间的任意位置也是可以取的。</p><p>而当 $A_p &lt; A_j$ 时，对于 $j$ 之后下一个满足要求的位置 $k$ 时，就仅仅只能取 $k$ 位置了。</p></blockquote><p>其缘由读者可自行思考。</p><h3 id="算法思路"><a href="#算法思路" class="headerlink" title="算法思路"></a>算法思路</h3><p><del>又是线段树打爆的一天</del></p><p>使用一种类似分块但胜似分块的神奇思路。</p><p>将整个数列分成 $\sqrt n$ 段：</p><ol><li>对于每一段，维护其向左向右的递增序列；</li><li>对于相邻的段，维护其向左向右的递增序列。</li></ol><p><del>虽然我觉得这题解类似没写又胜似没写</del></p><p>用 $L_i$ 存储第 $i$ 段的左坐标，$R_i$ 存储第 $i$ 段的右坐标。数组 $Bel_i$ 存储 $i$ 位置所属的段编号。</p><h4 id="初始化-修改操作"><a href="#初始化-修改操作" class="headerlink" title="初始化/修改操作"></a>初始化/修改操作</h4><p>对于每一段都有一个数 $top$ 和一个数组 $st_i$ 。$st$ 数组存储的是该区间内的最长不下降子序列，而 $top$ 则是 $st$ 数组的长度。然后求就完事儿了，复杂度 $O(\sqrt n)$</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">underModify</span><span class="params">(<span class="type">int</span> l,<span class="type">int</span> r,<span class="type">int</span> st[],<span class="type">int</span> &amp;top)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">top=<span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> i=r;i&gt;=l;--i)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">while</span>(top&amp;&amp;Num[st[top]]&lt;Num[i]) --top;</span><br><span class="line">st[++top]=i;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="查询操作"><a href="#查询操作" class="headerlink" title="查询操作"></a>查询操作</h4><p>暴力求本区间，复杂度 $O(\sqrt n )$</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> ans=<span class="number">0</span>;</span><br><span class="line"><span class="type">int</span> bl=Bel[p],Max=Num[p];</span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> i=p+<span class="number">1</span>;i&lt;=R[bl];++i)</span><br><span class="line">&#123;</span><br><span class="line">    Max=<span class="built_in">underMax</span>(Max,Num[i]);</span><br><span class="line">    <span class="keyword">if</span>(Max&lt;=<span class="built_in">underMax</span>(Num[p],Num[i])) ++ans;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>记查询点为 $p$ ,则对于 $Bel_p+1$ 到 $Bel_n$ 的区间操作为：</p><p>二分该区间的 $st$ 数组，找到第一个 $l$ 位置满足 $A_p \leq A_l$ ，如果当前 $Max$ 与 $A_p$ 是相等的，则可以计算该区间 $l$ 之前的任意位置；反之，计算 $l$ 之后的个数和（不比 $A_p$ 小的个数），当然，$Max=A_p$ 时也要计算该区间。</p><p>然后更改 $Max$ 值，查找下一区间。</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span>(<span class="type">int</span> i=bl+<span class="number">1</span>;i&lt;=num;++i)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> l=<span class="number">0</span>,r=Top[i];</span><br><span class="line">    <span class="keyword">if</span>(Max==Num[p])</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">while</span>(l&lt;r)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="type">int</span> mid=(l+r+<span class="number">1</span>)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">            <span class="keyword">if</span>(Num[St[i][mid]]&gt;Max) l=mid;</span><br><span class="line">            <span class="keyword">else</span> r=mid<span class="number">-1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(l==<span class="number">0</span>) ans+=R[i]-L[i]+<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            ans+=St[i][l]<span class="number">-1</span>-L[i]+<span class="number">1</span>;</span><br><span class="line">            ans+=l<span class="number">-1</span>+<span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">while</span>(l&lt;r)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="type">int</span> mid=(l+r+<span class="number">1</span>)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">            <span class="keyword">if</span>(Num[St[i][mid]]&gt;=Max) l=mid;</span><br><span class="line">            <span class="keyword">else</span> r=mid<span class="number">-1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        ans+=l<span class="number">-1</span>+<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    Max=<span class="built_in">underMax</span>(Max,Num[St[i][<span class="number">1</span>]]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> ans;</span><br></pre></td></tr></table></figure><h3 id="另话-1"><a href="#另话-1" class="headerlink" title="另话"></a>另话</h3><p>这道题题意很简单，主要原因还是时间复杂度的问题。我使用线段树二分查找的复杂度不稳定，<del>所以很氢凇被卡了</del></p><h3 id="Task-Two-Ac-Code"><a href="#Task-Two-Ac-Code" class="headerlink" title="Task Two Ac Code"></a>Task Two Ac Code</h3><details>    <summary>查看代码</summary><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;ctime&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iomanip&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stack&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;map&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> gh() getchar()</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> ll;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN=<span class="number">50001</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXM=<span class="number">101</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXB=<span class="number">1001</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> INF=<span class="number">0x7f7f7f7f</span>;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">underRead</span><span class="params">(T &amp;x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    x=<span class="number">0</span>;</span><br><span class="line">    <span class="type">char</span> ch=<span class="built_in">gh</span>(),t=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(ch&lt;<span class="string">&#x27;0&#x27;</span>||ch&gt;<span class="string">&#x27;9&#x27;</span>) t|=ch==<span class="string">&#x27;-&#x27;</span>,ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">while</span>(ch&gt;=<span class="string">&#x27;0&#x27;</span>&amp;&amp;ch&lt;=<span class="string">&#x27;9&#x27;</span>) x=(x&lt;&lt;<span class="number">3</span>)+(x&lt;&lt;<span class="number">1</span>)+(ch^<span class="number">48</span>),ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">if</span>(t) x=-x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> N,M,Num[MAXN],Qi,Qx;</span><br><span class="line"><span class="type">char</span> op;</span><br><span class="line"><span class="type">int</span> Bel[MAXN],L[MAXM],R[MAXM],St[MAXM][MAXB],Top[MAXM];</span><br><span class="line"><span class="comment">/*struct SegmentTree</span></span><br><span class="line"><span class="comment">&#123;</span></span><br><span class="line"><span class="comment">int l,r,dat;</span></span><br><span class="line"><span class="comment">&#125;Tree[MAXN&lt;&lt;2];*/</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">underMax</span><span class="params">(<span class="type">int</span> a,<span class="type">int</span> b)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">return</span> (a&gt;b?a:b);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">underMin</span><span class="params">(<span class="type">int</span> a,<span class="type">int</span> b)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">return</span> (a&lt;b?a:b);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*inline void underPushUp(int p)</span></span><br><span class="line"><span class="comment">&#123;</span></span><br><span class="line"><span class="comment">Tree[p].dat=underMax(Tree[p&lt;&lt;1].dat,Tree[p&lt;&lt;1|1].dat);</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment">inline bool underCheck(int p)</span></span><br><span class="line"><span class="comment">&#123;</span></span><br><span class="line"><span class="comment">if(Tree[p].dat==Num[Tree[p].l]||Tree[p].dat==Num[Tree[p].r]) return 1;</span></span><br><span class="line"><span class="comment">return 0;</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment">inline void underBuild(int p,int l,int r)</span></span><br><span class="line"><span class="comment">&#123;</span></span><br><span class="line"><span class="comment">Tree[p].l=l,Tree[p].r=r;</span></span><br><span class="line"><span class="comment">if(l==r)</span></span><br><span class="line"><span class="comment">&#123;</span></span><br><span class="line"><span class="comment">Tree[p].dat=Num[l];</span></span><br><span class="line"><span class="comment">return ;</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment">int mid=(l+r)&gt;&gt;1;</span></span><br><span class="line"><span class="comment">underBuild(p&lt;&lt;1,l,mid),underBuild(p&lt;&lt;1|1,mid+1,r);</span></span><br><span class="line"><span class="comment">underPushUp(p);</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment">inline void underModify(int p,int d,int x)</span></span><br><span class="line"><span class="comment">&#123;</span></span><br><span class="line"><span class="comment">if(Tree[p].l==d&amp;&amp;Tree[p].r==d)</span></span><br><span class="line"><span class="comment">&#123;</span></span><br><span class="line"><span class="comment">Tree[p].dat=x;</span></span><br><span class="line"><span class="comment">return ;</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment">int mid=(Tree[p].l+Tree[p].r)&gt;&gt;1;</span></span><br><span class="line"><span class="comment">if(d&lt;=mid) underModify(p&lt;&lt;1,d,x);</span></span><br><span class="line"><span class="comment">if(mid&lt;d) underModify(p&lt;&lt;1|1,d,x);</span></span><br><span class="line"><span class="comment">underPushUp(p);</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment">inline int underQueryMax(int p,int l,int r)</span></span><br><span class="line"><span class="comment">&#123;</span></span><br><span class="line"><span class="comment">if(l&lt;=Tree[p].l&amp;&amp;Tree[p].r&lt;=r) return Tree[p].dat;</span></span><br><span class="line"><span class="comment">int mid=(Tree[p].l+Tree[p].r)&gt;&gt;1;</span></span><br><span class="line"><span class="comment">int val=-INF;</span></span><br><span class="line"><span class="comment">if(l&lt;=mid) val=underMax(val,underQueryMax(p&lt;&lt;1,l,r));</span></span><br><span class="line"><span class="comment">if(mid&lt;r) val=underMax(val,underQueryMax(p&lt;&lt;1|1,l,r));</span></span><br><span class="line"><span class="comment">return val;</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment">inline void underNeverGonnaGiveYouUp()</span></span><br><span class="line"><span class="comment">&#123;</span></span><br><span class="line"><span class="comment">for(int i=1;i&lt;=M;++i)</span></span><br><span class="line"><span class="comment">&#123;</span></span><br><span class="line"><span class="comment">scanf(&quot;%c&quot;,&amp;op);</span></span><br><span class="line"><span class="comment">if(op==&#x27;Q&#x27;)</span></span><br><span class="line"><span class="comment">&#123;</span></span><br><span class="line"><span class="comment">underRead(Qi);</span></span><br><span class="line"><span class="comment">int Ans=0,Maxn=Num[Qi];</span></span><br><span class="line"><span class="comment">for(int j=Qi+1;j&lt;=N;++j)</span></span><br><span class="line"><span class="comment">&#123;</span></span><br><span class="line"><span class="comment">Maxn=underMax(Maxn,Num[j]);</span></span><br><span class="line"><span class="comment">if(Maxn&lt;=Num[Qi]||Maxn&lt;=Num[j]) ++Ans;</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment">printf(&quot;%d\n&quot;,Ans);</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment">else</span></span><br><span class="line"><span class="comment">&#123;</span></span><br><span class="line"><span class="comment">underRead(Qi),underRead(Qx);</span></span><br><span class="line"><span class="comment">Num[Qi]=Qx;</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment">exit(0);</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment">inline int underExpr(int p,int x)</span></span><br><span class="line"><span class="comment">&#123;</span></span><br><span class="line"><span class="comment">if(x==N) return 0;</span></span><br><span class="line"><span class="comment">if(underQueryMax(1,x+1,N)&lt;Num[x])</span></span><br><span class="line"><span class="comment">&#123;</span></span><br><span class="line"><span class="comment">if(p&gt;1) return 0;</span></span><br><span class="line"><span class="comment">else return N-x;</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment">int l=x+1,r=N;</span></span><br><span class="line"><span class="comment">while(l&lt;r)</span></span><br><span class="line"><span class="comment">&#123;</span></span><br><span class="line"><span class="comment">int mid=(l+r)&gt;&gt;1;</span></span><br><span class="line"><span class="comment">int val=underQueryMax(1,x+1,mid);</span></span><br><span class="line"><span class="comment">if(val&lt;Num[x]) l=mid+1;</span></span><br><span class="line"><span class="comment">else r=mid;</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment">//printf(&quot;[%d,%d] &quot;,x,l);</span></span><br><span class="line"><span class="comment">if(p&gt;1) return 1+underExpr(p,l);</span></span><br><span class="line"><span class="comment">else if(Num[l]==Num[x]) return l-x+underExpr(p,l);</span></span><br><span class="line"><span class="comment">else return l-x+underExpr(p+1,l);</span></span><br><span class="line"><span class="comment">&#125;*/</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">underModify</span><span class="params">(<span class="type">int</span> l,<span class="type">int</span> r,<span class="type">int</span> st[],<span class="type">int</span> &amp;top)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">top=<span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> i=r;i&gt;=l;--i)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">while</span>(top&amp;&amp;Num[st[top]]&lt;Num[i]) --top;</span><br><span class="line">st[++top]=i;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">underQuery</span><span class="params">(<span class="type">int</span> p,<span class="type">int</span> num)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="type">int</span> ans=<span class="number">0</span>;</span><br><span class="line"><span class="type">int</span> bl=Bel[p],Max=Num[p];</span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> i=p+<span class="number">1</span>;i&lt;=R[bl];++i)</span><br><span class="line">&#123;</span><br><span class="line">Max=<span class="built_in">underMax</span>(Max,Num[i]);</span><br><span class="line"><span class="keyword">if</span>(Max&lt;=<span class="built_in">underMax</span>(Num[p],Num[i])) ++ans;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> i=bl+<span class="number">1</span>;i&lt;=num;++i)</span><br><span class="line">&#123;</span><br><span class="line"><span class="type">int</span> l=<span class="number">0</span>,r=Top[i];</span><br><span class="line"><span class="keyword">if</span>(Max==Num[p])</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">while</span>(l&lt;r)</span><br><span class="line">&#123;</span><br><span class="line"><span class="type">int</span> mid=(l+r+<span class="number">1</span>)&gt;&gt;<span class="number">1</span>;</span><br><span class="line"><span class="keyword">if</span>(Num[St[i][mid]]&gt;Max) l=mid;</span><br><span class="line"><span class="keyword">else</span> r=mid<span class="number">-1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(l==<span class="number">0</span>) ans+=R[i]-L[i]+<span class="number">1</span>;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">ans+=St[i][l]<span class="number">-1</span>-L[i]+<span class="number">1</span>;</span><br><span class="line">ans+=l<span class="number">-1</span>+<span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">while</span>(l&lt;r)</span><br><span class="line">&#123;</span><br><span class="line"><span class="type">int</span> mid=(l+r+<span class="number">1</span>)&gt;&gt;<span class="number">1</span>;</span><br><span class="line"><span class="keyword">if</span>(Num[St[i][mid]]&gt;=Max) l=mid;</span><br><span class="line"><span class="keyword">else</span> r=mid<span class="number">-1</span>;</span><br><span class="line">&#125;</span><br><span class="line">ans+=l<span class="number">-1</span>+<span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line">Max=<span class="built_in">underMax</span>(Max,Num[St[i][<span class="number">1</span>]]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="built_in">freopen</span>(<span class="string">&quot;seq.in&quot;</span>,<span class="string">&quot;r&quot;</span>,stdin);</span><br><span class="line"><span class="built_in">freopen</span>(<span class="string">&quot;seq.out&quot;</span>,<span class="string">&quot;w&quot;</span>,stdout);</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>,&amp;N,&amp;M);</span><br><span class="line"><span class="type">int</span> siz=<span class="built_in">sqrt</span>(N*<span class="built_in">log2</span>(N)),num=(N+siz<span class="number">-1</span>)/siz;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=N;++i) <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;Num[i]),Bel[i]=(i+siz<span class="number">-1</span>)/siz;</span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=num;++i)</span><br><span class="line">&#123;</span><br><span class="line">L[i]=R[i<span class="number">-1</span>]+<span class="number">1</span>,R[i]=<span class="built_in">underMin</span>(i*siz,N);</span><br><span class="line"><span class="built_in">underModify</span>(L[i],R[i],St[i],Top[i]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//if(N&lt;=5000) underNeverGonnaGiveYouUp();</span></span><br><span class="line">    <span class="comment">/*underBuild(1,1,N);*/</span></span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> T=<span class="number">1</span>;T&lt;=M;++T)</span><br><span class="line">&#123;</span><br><span class="line">cin&gt;&gt;op;</span><br><span class="line"><span class="keyword">if</span>(op==<span class="string">&#x27;Q&#x27;</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;Qi);</span><br><span class="line"><span class="comment">/*if(underQueryMax(1,Qi,N)==Num[Qi]) printf(&quot;%d\n&quot;,N-Qi);</span></span><br><span class="line"><span class="comment">else if(Tree[1].dat==Num[Qi])printf(&quot;%d\n&quot;,N-Qi);</span></span><br><span class="line"><span class="comment">else printf(&quot;%d\n&quot;,underExpr(1,Qi));</span></span><br><span class="line"><span class="comment">printf(&quot;%d\n&quot;,underQuery(1,Qi-1,Qi+1));*/</span></span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,<span class="built_in">underQuery</span>(Qi,num));</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>,&amp;Qi,&amp;Qx);</span><br><span class="line">Num[Qi]=Qx;</span><br><span class="line"><span class="type">int</span> bl=Bel[Qi];</span><br><span class="line"><span class="built_in">underModify</span>(L[bl],R[bl],St[bl],Top[bl]);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">5 3</span></span><br><span class="line"><span class="comment">1 3 2 3 2</span></span><br><span class="line"><span class="comment">Q 1</span></span><br><span class="line"><span class="comment">C 1 3</span></span><br><span class="line"><span class="comment">Q 1</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">10 12</span></span><br><span class="line"><span class="comment">1 2 3 4 5 6 7 8 9 10</span></span><br><span class="line"><span class="comment">Q 1</span></span><br><span class="line"><span class="comment">C 1 10</span></span><br><span class="line"><span class="comment">Q 1</span></span><br><span class="line"><span class="comment">C 2 11</span></span><br><span class="line"><span class="comment">Q 1</span></span><br><span class="line"><span class="comment">C 3 11</span></span><br><span class="line"><span class="comment">Q 1</span></span><br><span class="line"><span class="comment">C 4 10</span></span><br><span class="line"><span class="comment">C 5 11</span></span><br><span class="line"><span class="comment">Q 1</span></span><br><span class="line"><span class="comment">C 1 11</span></span><br><span class="line"><span class="comment">Q 1</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">1 5 3 6 3 3 6</span></span><br><span class="line"><span class="comment">st[1]=6 top=1 i=7</span></span><br><span class="line"><span class="comment">st[2]=6,3 top=2 i=6</span></span><br><span class="line"><span class="comment">st[3]=6,3,3 top=3 i=5</span></span><br><span class="line"><span class="comment">st[2]=6,6 top=2 i=4</span></span><br><span class="line"><span class="comment">st[3]=6,6,3 top=3 i=3</span></span><br><span class="line"><span class="comment">st[3]=6,6,5 top=3 i=2</span></span><br><span class="line"><span class="comment">st[4]=6,6,5,1 top=4 i=1</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br></pre></td></tr></table></figure></details>]]></content>
      
      
      <categories>
          
          <category> 模拟赛/比赛 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 数论 </tag>
            
            <tag> 优化 </tag>
            
            <tag> RMQ </tag>
            
            <tag> 最短路 </tag>
            
            <tag> 图论 </tag>
            
            <tag> SPFA </tag>
            
            <tag> 二分 </tag>
            
            <tag> 线段树 </tag>
            
            <tag> 面积并 </tag>
            
            <tag> 几何 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CF19B Checkout Assistant</title>
      <link href="/Eternity/%E9%A2%98%E8%A7%A3/cf19b/"/>
      <url>/Eternity/%E9%A2%98%E8%A7%A3/cf19b/</url>
      
        <content type="html"><![CDATA[<p>$01$ 背包变形<br><span id="more"></span><br><a href="https://www.luogu.com.cn/problem/CF19B">题目传送门</a></p><p><del>虽然我也不知道为什么被卡了反正就是听取WA声一片</del></p><p>扫描第$i$件物品能够得到$t_i+1$件物品，则将题目转化为：</p><p>一共有$n$件物品，第$i$件物品的体积为$t_i+1$，价值为$c_i$。</p><p>$AC\ Code$：</p><details>    <summary>查看代码</summary><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;algorithm&gt;</span> </span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> ll;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> M=<span class="number">2005</span>,N=<span class="number">4005</span>;</span><br><span class="line"><span class="type">int</span> n,t[M],v;</span><br><span class="line">ll c[M],dp[N],ans=<span class="number">2e12</span>;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;n);</span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++)</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">scanf</span>(<span class="string">&quot;%d%lld&quot;</span>,&amp;t[i],&amp;c[i]);</span><br><span class="line">t[i]++;</span><br><span class="line">v=<span class="built_in">max</span>(v,t[i]);</span><br><span class="line">&#125;</span><br><span class="line">v+=n;</span><br><span class="line"><span class="built_in">memset</span>(dp,<span class="number">0x7f</span>,<span class="built_in">sizeof</span>(dp));dp[<span class="number">0</span>]=<span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++)</span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> j=v;j&gt;=t[i];j--)</span><br><span class="line">dp[j]=<span class="built_in">min</span>(dp[j],dp[j-t[i]]+c[i]);</span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> i=n;i&lt;=v;i++)</span><br><span class="line">ans=<span class="built_in">min</span>(ans,dp[i]);</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;%lld&quot;</span>,ans);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></details>]]></content>
      
      
      <categories>
          
          <category> 题解 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> DP </tag>
            
            <tag> 背包 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ST表（Sparse Table，稀疏表）</title>
      <link href="/Eternity/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/OI/sparse-table/"/>
      <url>/Eternity/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/OI/sparse-table/</url>
      
        <content type="html"><![CDATA[<p>“聚二为一”</p><span id="more"></span><h2 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h2><p>$ST$ 表是一种用来求 $RMQ$ ，即区间最值问题的数据结构。其速度极快，可以做到 $O(n \log n)$ 的预处理以及 $O(1)$ 的查询时，且可以在线查询。</p><p>$ST$ 表运用到了倍增的思想，将整个数列存储在一个二维数组 $f$ 中。其中：</p><blockquote><p>$f_{i,j}$ 表示区间 $[f_{i,j},f_{i,i+2^j-1}]$ 的最值。</p></blockquote><p>而查询的思路便是将区间分成左右两部分并取出两部分的最值。</p><p>对于区间 $[l,r]$ 的最大值，则是 $\max\{f_{l,k},f_{r-k+1,k}\}$，其中 $k$ 表示 $\log(r-l+1)$ 。</p><p>初始状态： $f_{i,0}=a_i$ ，然后外层遍历 $i$ ，内层遍历 $j$ 处理 $f$ 即可。</p><h2 id="例题"><a href="#例题" class="headerlink" title="例题"></a>例题</h2><p><a href="https://www.luogu.com.cn/problem/P3865">【模板】ST表</a></p><p>区间最大值。</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;ctime&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iomanip&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stack&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;map&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> gh() getchar()</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> underMax(x,y) ((x)&gt;(y)?(x):(y))</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> underMin(x,y) ((x)&lt;(y)?(x):(y))</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> ll;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">underRead</span><span class="params">(T &amp;x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    x=<span class="number">0</span>;</span><br><span class="line">    <span class="type">char</span> ch=<span class="built_in">gh</span>(),t=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(ch&lt;<span class="string">&#x27;0&#x27;</span>||ch&gt;<span class="string">&#x27;9&#x27;</span>) t|=ch==<span class="string">&#x27;-&#x27;</span>,ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">while</span>(ch&gt;=<span class="string">&#x27;0&#x27;</span>&amp;&amp;ch&lt;=<span class="string">&#x27;9&#x27;</span>) x=(x&lt;&lt;<span class="number">3</span>)+(x&lt;&lt;<span class="number">1</span>)+(ch^<span class="number">48</span>),ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">if</span>(t) x=-x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> n,m,a[<span class="number">100001</span>],f[<span class="number">100001</span>][<span class="number">64</span>],k[<span class="number">100001</span>];</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">underGet</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;++i) k[i]=<span class="built_in">log2</span>(i);</span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;++i) f[i][<span class="number">0</span>]=a[i];</span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;(<span class="number">1</span>&lt;&lt;i)&lt;=n;++i)</span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">1</span>;j+(<span class="number">1</span>&lt;&lt;i)<span class="number">-1</span>&lt;=n;++j)</span><br><span class="line">f[j][i]=<span class="built_in">underMax</span>(f[j][i<span class="number">-1</span>],f[j+(<span class="number">1</span>&lt;&lt;(i<span class="number">-1</span>))][i<span class="number">-1</span>]); </span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// freopen(&quot;st.in&quot;,&quot;r&quot;,stdin);</span></span><br><span class="line">    <span class="comment">// freopen(&quot;st.out&quot;,&quot;w&quot;,stdout);</span></span><br><span class="line"><span class="built_in">underRead</span>(n),<span class="built_in">underRead</span>(m);</span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;++i) <span class="built_in">underRead</span>(a[i]);</span><br><span class="line"><span class="built_in">underGet</span>();</span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> l,r;m;--m)</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">underRead</span>(l),<span class="built_in">underRead</span>(r);</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,<span class="built_in">underMax</span>(f[l][k[r-l+<span class="number">1</span>]],f[r-(<span class="number">1</span>&lt;&lt;(k[r-l+<span class="number">1</span>]))+<span class="number">1</span>][k[r-l+<span class="number">1</span>]]));</span><br><span class="line">&#125; </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">8 8</span></span><br><span class="line"><span class="comment">9 3 1 7 5 6 0 8</span></span><br><span class="line"><span class="comment">1 6</span></span><br><span class="line"><span class="comment">1 5</span></span><br><span class="line"><span class="comment">2 7</span></span><br><span class="line"><span class="comment">2 6</span></span><br><span class="line"><span class="comment">1 8</span></span><br><span class="line"><span class="comment">4 8</span></span><br><span class="line"><span class="comment">3 7</span></span><br><span class="line"><span class="comment">1 8</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="练习"><a href="#练习" class="headerlink" title="练习"></a>练习</h2><p><a href="https://www.luogu.com.cn/problem/P2251">P2251 质量检测</a></p><p><a href="https://www.luogu.com.cn/problem/P1816">P1816 忠诚</a></p>]]></content>
      
      
      <categories>
          
          <category> 学习笔记 </category>
          
          <category> OI </category>
          
      </categories>
      
      
        <tags>
            
            <tag> RMQ </tag>
            
            <tag> ST表 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>扫描线</title>
      <link href="/Eternity/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/OI/scan-line/"/>
      <url>/Eternity/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/OI/scan-line/</url>
      
        <content type="html"><![CDATA[<p>“地毯式搜索”</p><span id="more"></span><p><a href="https://www.luogu.com.cn/problem/P5490">P5490 扫描线</a></p><h2 id="思路"><a href="#思路" class="headerlink" title="思路"></a>思路</h2><p>用线段树维护一个横区间内所有的矩形个数，对于每个不为 $0$ 的区间则计算答案。</p><p>因为坐标过大，所以线段树维护的是离散化之后的坐标。</p><p>在扫描线算法中，我们总共需要两次排序：将端点的横坐标排序和横线的纵坐标排序。在进行排序之后，我们还需要将端点横坐标离散化和去重，用 $STL$ 的 $unique$ 函数就可以了。</p><p>最后，扫描横边，查询每一个横边所在区间的竖边即可。</p><p><a href="https://2745518585.github.io/post/Scan%20line/">参考资料：赵悦岑’s blog’</a></p><h2 id="AC-Code："><a href="#AC-Code：" class="headerlink" title="AC Code："></a>AC Code：</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;ctime&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iomanip&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stack&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;map&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> gh() getchar()</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> underMax(x,y) ((x)&gt;(y)?(x):(y))</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> underMin(x,y) ((x)&lt;(y)?(x):(y))</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> ll;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN=<span class="number">1e6</span>+<span class="number">1</span>;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">underRead</span><span class="params">(T &amp;x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    x=<span class="number">0</span>;</span><br><span class="line">    <span class="type">char</span> ch=<span class="built_in">gh</span>(),t=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(ch&lt;<span class="string">&#x27;0&#x27;</span>||ch&gt;<span class="string">&#x27;9&#x27;</span>) t|=ch==<span class="string">&#x27;-&#x27;</span>,ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">while</span>(ch&gt;=<span class="string">&#x27;0&#x27;</span>&amp;&amp;ch&lt;=<span class="string">&#x27;9&#x27;</span>) x=(x&lt;&lt;<span class="number">3</span>)+(x&lt;&lt;<span class="number">1</span>)+(ch^<span class="number">48</span>),ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">if</span>(t) x=-x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Segment_Tree</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> l,r,dat;</span><br><span class="line">    ll tag;</span><br><span class="line">&#125;Tree[MAXN&lt;&lt;<span class="number">2</span>];</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Sort_Str</span></span><br><span class="line">&#123;</span><br><span class="line">    ll l,r,dat;</span><br><span class="line">    <span class="type">int</span> tag;</span><br><span class="line">&#125;Num[MAXN&lt;&lt;<span class="number">2</span>];</span><br><span class="line"><span class="type">int</span> n,m;</span><br><span class="line">ll b[MAXN&lt;&lt;<span class="number">4</span>],l1,l2,r1,r2;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">underCmp</span><span class="params">(Sort_Str a,Sort_Str b)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> a.dat&lt;b.dat;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">underPushUp</span><span class="params">(<span class="type">int</span> p)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(Tree[p].dat) Tree[p].tag=b[Tree[p].r+<span class="number">1</span>]-b[Tree[p].l];</span><br><span class="line">    <span class="keyword">else</span> Tree[p].tag=Tree[p&lt;&lt;<span class="number">1</span>].tag+Tree[p&lt;&lt;<span class="number">1</span>|<span class="number">1</span>].tag;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">underBuild</span><span class="params">(<span class="type">int</span> p,<span class="type">int</span> l,<span class="type">int</span> r)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Tree[p].l=l,Tree[p].r=r,Tree[p].tag=Tree[p].dat=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span>(l==r) <span class="keyword">return</span> ;</span><br><span class="line">    <span class="type">int</span> mid=(l+r)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">    <span class="built_in">underBuild</span>(p&lt;&lt;<span class="number">1</span>,l,mid),<span class="built_in">underBuild</span>(p&lt;&lt;<span class="number">1</span>|<span class="number">1</span>,mid+<span class="number">1</span>,r);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">underAdd</span><span class="params">(<span class="type">int</span> p,ll l,ll r,<span class="type">int</span> k)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(b[Tree[p].l]&gt;=r||b[Tree[p].r+<span class="number">1</span>]&lt;=l) <span class="keyword">return</span> ;</span><br><span class="line">    <span class="keyword">if</span>(b[Tree[p].l]&gt;=l&amp;&amp;b[Tree[p].r+<span class="number">1</span>]&lt;=r)</span><br><span class="line">    &#123;</span><br><span class="line">        Tree[p].dat+=k;</span><br><span class="line">        <span class="built_in">underPushUp</span>(p);</span><br><span class="line">        <span class="keyword">return</span> ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">underAdd</span>(p&lt;&lt;<span class="number">1</span>,l,r,k),<span class="built_in">underAdd</span>(p&lt;&lt;<span class="number">1</span>|<span class="number">1</span>,l,r,k);</span><br><span class="line">    <span class="built_in">underPushUp</span>(p);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// freopen(&quot;segmenttree.in&quot;,&quot;r&quot;,stdin);</span></span><br><span class="line">    <span class="comment">// freopen(&quot;segmenttree.out&quot;,&quot;w&quot;,stdout);</span></span><br><span class="line">    <span class="built_in">underRead</span>(n);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;++i)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%lld%lld%lld%lld&quot;</span>,&amp;l1,&amp;r1,&amp;l2,&amp;r2);</span><br><span class="line">        Num[(i&lt;&lt;<span class="number">1</span>)<span class="number">-1</span>]=(Sort_Str)&#123;l1,l2,r1,<span class="number">1</span>&#125;;</span><br><span class="line">        Num[i&lt;&lt;<span class="number">1</span>]=(Sort_Str)&#123;l1,l2,r2,<span class="number">-1</span>&#125;;</span><br><span class="line">        b[(i&lt;&lt;<span class="number">1</span>)<span class="number">-1</span>]=l1,b[i&lt;&lt;<span class="number">1</span>]=l2;</span><br><span class="line">    &#125;</span><br><span class="line">    n&lt;&lt;=<span class="number">1</span>;</span><br><span class="line">    <span class="built_in">sort</span>(Num+<span class="number">1</span>,Num+<span class="number">1</span>+n,underCmp);</span><br><span class="line">    <span class="built_in">sort</span>(b+<span class="number">1</span>,b+<span class="number">1</span>+n);</span><br><span class="line">    m=<span class="built_in">unique</span>(b+<span class="number">1</span>,b+n+<span class="number">1</span>)-(b+<span class="number">1</span>);</span><br><span class="line">    <span class="built_in">underBuild</span>(<span class="number">1</span>,<span class="number">1</span>,m<span class="number">-1</span>);</span><br><span class="line">    ll s=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;n;++i)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">underAdd</span>(<span class="number">1</span>,Num[i].l,Num[i].r,Num[i].tag);</span><br><span class="line">        s+=Tree[<span class="number">1</span>].tag*(Num[i+<span class="number">1</span>].dat-Num[i].dat);</span><br><span class="line">        <span class="comment">// printf(&quot;%d %d\n&quot;,Tree[1].tag,(Num[i+1].dat-Num[i].dat));</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%lld&quot;</span>,s);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">2</span></span><br><span class="line"><span class="comment">100 100 200 200</span></span><br><span class="line"><span class="comment">150 150 250 255</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 学习笔记 </category>
          
          <category> OI </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 离散化 </tag>
            
            <tag> 线段树 </tag>
            
            <tag> 面积并 </tag>
            
            <tag> 几何 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>单调队列优化Dp</title>
      <link href="/Eternity/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/OI/dp-of-monotonous-queue/"/>
      <url>/Eternity/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/OI/dp-of-monotonous-queue/</url>
      
        <content type="html"><![CDATA[<p>“我永远对你保有最诚挚的热情。”</p><span id="more"></span><h2 id="单调队列"><a href="#单调队列" class="headerlink" title="单调队列"></a>单调队列</h2><p>单调队列是一种<strong>队列内的元素有单调性</strong>（递增或递减）的队列。答案（最优解）存在队首。一般用于维护区间最值或者降低 $Dp$ 数组的维度来减少空间及时间的目的。</p><details>    <summary>单调队列的作用</summary>    1. 维护区间最值 <Br />    2. 优化 DP</details><hr><p>单调队列在队首和队尾都可以进行<strong>出队操作</strong>，但只有队尾可以进行<strong>入队</strong>操作。这样的操作类似于双端队列（$deque$）允许双端弹出。但一般来说，还是不建议使用 $STL$ 库，手写方便且比较节省时间。</p><p>总的来说，单调队列的实现有三步：</p><ol><li>将 $head$ 之前所有已在区间之外的答案删掉（ $++head$ ）</li><li>更新答案为 $Queue[head]$</li><li>将尾部的非最优答案排除（ $—tail$ ），并入队最新答案。</li></ol><h3 id="栗子"><a href="#栗子" class="headerlink" title="栗子"></a>栗子</h3><p><a href="https://www.luogu.com.cn/problem/P1886">【模板】单调队列/滑动窗口</a></p><h4 id="题意"><a href="#题意" class="headerlink" title="题意"></a>题意</h4><p>求出区间最大值和最小值，因为复杂度限制 $O(n \log n)$ 所以无法暴力。就使用单调队列的优化。</p><h4 id="AC-Code："><a href="#AC-Code：" class="headerlink" title="AC Code："></a>AC Code：</h4><details>    <summary>查看代码</summary><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;ctime&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iomanip&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stack&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;map&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">using</span> std::cin;</span><br><span class="line"><span class="keyword">using</span> std::cout;</span><br><span class="line"><span class="type">int</span> N,K,A[<span class="number">1000001</span>];</span><br><span class="line"><span class="type">int</span> Q[<span class="number">10000001</span>];</span><br><span class="line"><span class="type">int</span> P[<span class="number">10000001</span>],head,tail;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">underMax</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">head=<span class="number">1</span>;</span><br><span class="line">tail=<span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=N;++i)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">while</span>(head&lt;=tail&amp;&amp;Q[tail]&lt;=A[i])</span><br><span class="line">&#123;</span><br><span class="line">tail--;</span><br><span class="line">&#125;</span><br><span class="line">Q[++tail]=A[i];</span><br><span class="line">P[tail]=i;</span><br><span class="line"><span class="keyword">while</span>(P[head]&lt;=i-K)</span><br><span class="line">&#123;</span><br><span class="line">head++;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(i&gt;=K)</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;%d &quot;</span>,Q[head]);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">underMin</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">head=<span class="number">1</span>;</span><br><span class="line">tail=<span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=N;++i)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">while</span>(head&lt;=tail&amp;&amp;Q[tail]&gt;=A[i])</span><br><span class="line">&#123;</span><br><span class="line">tail--;</span><br><span class="line">&#125;</span><br><span class="line">Q[++tail]=A[i];</span><br><span class="line">P[tail]=i;</span><br><span class="line"><span class="keyword">while</span>(P[head]&lt;=i-K)</span><br><span class="line">&#123;</span><br><span class="line">head++;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(i&gt;=K)</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;%d &quot;</span>,Q[head]);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="comment">//freopen(&quot;.in&quot;,&quot;r&quot;,stdin);</span></span><br><span class="line"><span class="comment">//freopen(&quot;.out&quot;,&quot;w&quot;,stdout);</span></span><br><span class="line"><span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>,&amp;N,&amp;K);</span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=N;++i)</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;A[i]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">underMin</span>();</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line"><span class="built_in">underMax</span>();</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">8 3</span></span><br><span class="line"><span class="comment">1 3 -1 -3 5 3 6 7</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure></details><h3 id="单调队列优化多重背包"><a href="#单调队列优化多重背包" class="headerlink" title="单调队列优化多重背包"></a>单调队列优化多重背包</h3><p><a href="https://2745518585.github.io/post/Monotone%20queue%20Knapsack/">巨佬的讲解</a></p><p><a href="https://www.acwing.com/problem/content/6/">Acwing 6 多重背包III</a></p><details>    <summary>查看代码</summary><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;ctime&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iomanip&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stack&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;map&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">using</span> std::cin;</span><br><span class="line"><span class="keyword">using</span> std::cout;</span><br><span class="line"><span class="type">int</span> n,V;</span><br><span class="line"><span class="type">int</span> v,w,s;</span><br><span class="line"><span class="type">int</span> dp[<span class="number">20001</span>],pre[<span class="number">20001</span>],q[<span class="number">20001</span>];</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>,&amp;n,&amp;V);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;++i)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">memcpy</span>(pre, dp, <span class="built_in">sizeof</span>(dp));</span><br><span class="line">        <span class="type">int</span> v, w, s;</span><br><span class="line">        cin &gt;&gt;v&gt;&gt;w&gt;&gt;s;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j=<span class="number">0</span>;j&lt;v;++j)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="type">int</span> head=<span class="number">0</span>, tail=<span class="number">-1</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> k=j;k&lt;=V;k+=v)</span><br><span class="line">            &#123;</span><br><span class="line">                        <span class="keyword">if</span> (head&lt;=tail&amp;&amp;k-s*v&gt;q[head]) ++head;</span><br><span class="line">            <span class="keyword">while</span>(head&lt;=tail&amp;&amp;pre[q[tail]]-(q[tail]-j)/v*w&lt;=pre[k]-(k-j)/v*w) --tail;</span><br><span class="line">            <span class="keyword">if</span> (head&lt;=tail) dp[k]=<span class="built_in">max</span>(dp[k],pre[q[head]]+(k-q[head])/v*w);</span><br><span class="line">            q[++tail]=k;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;%d&quot;</span>,dp[V]);</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br></pre></td></tr></table></figure></details><h3 id="提升"><a href="#提升" class="headerlink" title="提升"></a>提升</h3><p><a href="https://www.luogu.com.cn/problem/P2216">P2216 [HAOI2007]理想的正方形</a></p><h4 id="解释"><a href="#解释" class="headerlink" title="解释"></a>解释</h4><p>二维的滑动窗口，也就那样做就对了。</p><h4 id="AC-Code"><a href="#AC-Code" class="headerlink" title="AC Code"></a>AC Code</h4><details>    <summary>查看代码</summary><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;ctime&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iomanip&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stack&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;map&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> gh() getchar()</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> re register</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> db double</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> ll;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN=<span class="number">1001</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> INF=<span class="number">0x7f7f7f7f</span>;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    x=<span class="number">0</span>;</span><br><span class="line">    <span class="type">char</span> ch=<span class="built_in">gh</span>(),tail=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(ch&lt;<span class="string">&#x27;0&#x27;</span>||ch&gt;<span class="string">&#x27;9&#x27;</span>) tail|=ch==<span class="string">&#x27;-&#x27;</span>,ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">while</span>(ch&gt;=<span class="string">&#x27;0&#x27;</span>&amp;&amp;ch&lt;=<span class="string">&#x27;9&#x27;</span>) x=(x&lt;&lt;<span class="number">3</span>)+(x&lt;&lt;<span class="number">1</span>)+(ch^<span class="number">48</span>),ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">if</span>(tail) x=-x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T,<span class="keyword">class</span> ...T1&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x,T1 &amp;...x1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">read</span>(x),<span class="built_in">read</span>(x1...);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">checkMax</span><span class="params">(T &amp;x,T &amp;y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x&lt;y?x=y,<span class="number">1</span>:<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">checkMin</span><span class="params">(T &amp;x,T &amp;y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x&gt;y?x=y,<span class="number">1</span>:<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> N,M,K;</span><br><span class="line"><span class="type">int</span> val[MAXN][MAXN],Row_max[MAXN][MAXN],Row_min[MAXN][MAXN];</span><br><span class="line"><span class="type">int</span> Que[MAXN];</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">get_min</span><span class="params">(<span class="type">int</span> a[],<span class="type">int</span> b[],<span class="type">int</span> m)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">memset</span>(Que,<span class="number">0</span>,<span class="built_in">sizeof</span>(Que));</span><br><span class="line">    <span class="type">int</span> head=<span class="number">0</span>,tail=<span class="number">-1</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=m;++i)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(head&lt;=tail&amp;&amp;Que[head]&lt;=i-K) ++head;</span><br><span class="line">        <span class="keyword">while</span>(head&lt;=tail&amp;&amp;a[Que[tail]]&gt;=a[i]) --tail;</span><br><span class="line">        Que[++tail]=i;</span><br><span class="line">        b[i]=a[Que[head]];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">get_max</span><span class="params">(<span class="type">int</span> a[],<span class="type">int</span> b[],<span class="type">int</span> m)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">memset</span>(Que,<span class="number">0</span>,<span class="built_in">sizeof</span>(Que));</span><br><span class="line">    <span class="type">int</span> head=<span class="number">0</span>,tail=<span class="number">-1</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=m;++i)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(head&lt;=tail&amp;&amp;Que[head]&lt;=i-K) ++head;</span><br><span class="line">        <span class="keyword">while</span>(head&lt;=tail&amp;&amp;a[Que[tail]]&lt;=a[i]) --tail;</span><br><span class="line">        Que[++tail]=i;</span><br><span class="line">        b[i]=a[Que[head]];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// freopen(&quot;dp-deque.in&quot;,&quot;r&quot;,stdin);</span></span><br><span class="line">    <span class="comment">// freopen(&quot;dp-deque.out&quot;,&quot;w&quot;,stdout);</span></span><br><span class="line">    <span class="built_in">read</span>(N,M,K);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=N;++i)</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">1</span>;j&lt;=M;++j)</span><br><span class="line">            <span class="built_in">read</span>(val[i][j]);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=N;++i)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">get_min</span>(val[i],Row_min[i],M);</span><br><span class="line">        <span class="built_in">get_max</span>(val[i],Row_max[i],M);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> res=INF;</span><br><span class="line">    <span class="type">int</span> a[MAXN],b[MAXN],c[MAXN];</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=K;i&lt;=M;++i)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">1</span>;j&lt;=N;++j) a[j]=Row_min[j][i];</span><br><span class="line">        <span class="built_in">get_min</span>(a,b,N);</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">1</span>;j&lt;=N;++j) a[j]=Row_max[j][i];</span><br><span class="line">        <span class="built_in">get_max</span>(a,c,N);</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j=K;j&lt;=N;++j) res=<span class="built_in">min</span>(res,c[j]-b[j]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d&quot;</span>,res);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">5 4 2</span></span><br><span class="line"><span class="comment">1 2 5 6</span></span><br><span class="line"><span class="comment">0 17 16 0</span></span><br><span class="line"><span class="comment">16 17 2 1</span></span><br><span class="line"><span class="comment">2 10 2 1</span></span><br><span class="line"><span class="comment">1 2 2 2</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure></details><h3 id="练习"><a href="#练习" class="headerlink" title="练习"></a>练习</h3><p><a href="https://www.luogu.com.cn/problem/P1440">P1440 求m区间内的最小值</a></p><p><a href="https://www.luogu.com.cn/problem/P2032">P2032 扫描</a></p><p><a href="https://www.luogu.com.cn/problem/P1725">P1725 琪露诺</a></p><h2 id="单调栈"><a href="#单调栈" class="headerlink" title="单调栈"></a>单调栈</h2><p>同样的，表示一个栈 $S$ 中的元素满足单调递增或者单调递减的性质，可以用来维护 <code>RMQ</code> 问题。</p><p>栈是一种<strong>先进后出、后进先出</strong>的数据结构，栈和队列应该是最简单的两种数据结构了，其原理与实现非常简单。<strong>单调栈中的元素是严格单调递增或者递减的</strong>，也就是说：<strong>从栈底到栈顶，元素的值逐渐增大或者减小</strong>。虽然单调栈的性质很简单，但是其用处很大，可以<strong>用于求解元素的左右大小边界问题</strong>。</p><h3 id="例题"><a href="#例题" class="headerlink" title="例题"></a>例题</h3><p><a href="https://www.luogu.com.cn/problem/P5788">单调栈模板</a></p><p>对于查询后继的题，具有后效性，对我而言不太好处理；所以我们考虑倒序枚举。将问题转化为查找前继中第一个比该数大的下标，以样例为例：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1 4 2 3 5</span><br></pre></td></tr></table></figure><p>建立一个单调递减的栈 $S$ ，接下来我们来手动模拟：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">输入 5 </span><br><span class="line">栈为空，则 dp[5]=0 ，将 5 入栈，当前栈为 5 。</span><br><span class="line">输入 3</span><br><span class="line">栈数为 1 ，有 5&gt;3 ，则 dp[4]=5 ，入栈 3 ，当前栈为 5 3</span><br><span class="line">输入 2</span><br><span class="line">栈数为 2 ，有 3&gt;2 ，则 dp[3]=4 ，入栈 2 ，当前栈为 5 3 2</span><br><span class="line">输入 4</span><br><span class="line">栈数为 3 ，有 2&lt;4 ，维护单减性，出栈 2 ，同样出栈 3 ，更新答案为 dp[2]=5 ，入栈 4 ，当前栈为 5 4</span><br><span class="line">输入 1</span><br><span class="line">栈数为 2 ，有 4&gt;1 ，则 dp[1]=2 ，入栈 1 ，当前栈为 5 4 1</span><br><span class="line">结束，答案为 2 5 4 5 0</span><br></pre></td></tr></table></figure><p>一些小问题：</p><ol><li>关于栈空的处理，如果是使用 $STL$ 的话，要先判是否为空，否则会 $RE$ 。且对于栈空的情况，有些题目是需要特判的。</li><li>关于取不取等的情况，视题目而定，就这道题而言，因为我们查找的是最近的一个，所以对于有 $a_i=a_j,i&lt;j$ 的话，肯定有 $i$ 答案是更优的，所以在此题，相等情况下是需要出栈的。</li></ol><details>    <summary>AC Code</summary><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;ctime&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iomanip&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stack&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;map&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> gh() getchar()</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> re register</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> ll;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN=<span class="number">3e6</span>+<span class="number">1</span>;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    x=<span class="number">0</span>;</span><br><span class="line">    <span class="type">char</span> ch=<span class="built_in">gh</span>(),t=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(ch&lt;<span class="string">&#x27;0&#x27;</span>||ch&gt;<span class="string">&#x27;9&#x27;</span>) t|=ch==<span class="string">&#x27;-&#x27;</span>,ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">while</span>(ch&gt;=<span class="string">&#x27;0&#x27;</span>&amp;&amp;ch&lt;=<span class="string">&#x27;9&#x27;</span>) x=(x&lt;&lt;<span class="number">3</span>)+(x&lt;&lt;<span class="number">1</span>)+(ch^<span class="number">48</span>),ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">if</span>(t) x=-x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T,<span class="keyword">class</span> ...T1&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x,T1 &amp;...x1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">read</span>(x),<span class="built_in">read</span>(x1...);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">checkMax</span><span class="params">(T &amp;x,T &amp;y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x&lt;y?x=y,<span class="number">1</span>:<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">checkMin</span><span class="params">(T &amp;x,T &amp;y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x&gt;y?x=y,<span class="number">1</span>:<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> N,x[MAXN],Stk[MAXN&lt;&lt;<span class="number">1</span>],Top,dp[MAXN];</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// freopen(&quot;stack-monotonous.in&quot;,&quot;r&quot;,stdin);</span></span><br><span class="line">    <span class="comment">// freopen(&quot;stack-monotonous.out&quot;,&quot;w&quot;,stdout);</span></span><br><span class="line">    <span class="built_in">read</span>(N);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=N;++i) <span class="built_in">read</span>(x[i]);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=N;i&gt;=<span class="number">1</span>;--i)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">while</span>(Top&amp;&amp;x[Stk[Top]]&lt;=x[i]) --Top;</span><br><span class="line">        <span class="keyword">if</span>(!Top) dp[i]=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">else</span> dp[i]=Stk[Top];</span><br><span class="line">        Stk[++Top]=i;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=N;++i) <span class="built_in">printf</span>(<span class="string">&quot;%d &quot;</span>,dp[i]);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">5</span></span><br><span class="line"><span class="comment">1 4 2 3 5</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure></details><hr><h3 id="巩固"><a href="#巩固" class="headerlink" title="巩固"></a>巩固</h3><p><a href="https://www.luogu.com.cn/problem/P6510">P6510 奶牛排队</a></p><p>考虑枚举右端点 $B$。根据题意，因为左端点 $A$ 一定是最矮的，所以 $A$ 一定是当前序列（从 $1$ 到 $B$）的后缀最小值所在的位置。</p><p>因为 $B$ 一定是最高的，所以 $A$ 到 $B$ 之间不能有任何元素比 $B$ 高，因此 $A$ 的右侧一定只有 $B$ 一个位置可以作为当前序列的后缀最大值。换句话说，我们要找到从后向前数第二个后缀最大值的位置 $k$，$A$ 一定在该位置的右侧。并且只要 $A$ 在 $k$ 右侧且 $A$ 是当前序列的后缀最小值，那么 $A$ 就是一个合法的左端点。</p><p>考虑用单调栈来维护当前序列的后缀最大最小值，每次新枚举到一个 $B$ 时，先不将新位置入栈，此时的最大值栈顶就是第二个后缀最大值的位置。而维护后缀最小值的单调栈中的下标也是单调的，因此直接在最小值栈上二分即可找到最靠左的对应 $A$ 的位置。更新答案即可。时间复杂度 $\mathcal O(n \log n)$。</p><details>    <summary>AC Code</summary><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;ctime&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iomanip&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stack&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;map&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> gh() getchar()</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> re register</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> ll;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN=<span class="number">1e5</span>+<span class="number">1</span>;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    x=<span class="number">0</span>;</span><br><span class="line">    <span class="type">char</span> ch=<span class="built_in">gh</span>(),t=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(ch&lt;<span class="string">&#x27;0&#x27;</span>||ch&gt;<span class="string">&#x27;9&#x27;</span>) t|=ch==<span class="string">&#x27;-&#x27;</span>,ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">while</span>(ch&gt;=<span class="string">&#x27;0&#x27;</span>&amp;&amp;ch&lt;=<span class="string">&#x27;9&#x27;</span>) x=(x&lt;&lt;<span class="number">3</span>)+(x&lt;&lt;<span class="number">1</span>)+(ch^<span class="number">48</span>),ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">if</span>(t) x=-x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T,<span class="keyword">class</span> ...T1&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x,T1 &amp;...x1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">read</span>(x),<span class="built_in">read</span>(x1...);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">checkMax</span><span class="params">(T &amp;x,T &amp;y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x&lt;y?x=y,<span class="number">1</span>:<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">checkMin</span><span class="params">(T &amp;x,T &amp;y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x&gt;y?x=y,<span class="number">1</span>:<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> N,x[MAXN],dp[MAXN];</span><br><span class="line"><span class="type">int</span> Stk[<span class="number">2</span>][MAXN&lt;&lt;<span class="number">1</span>],Top[<span class="number">2</span>],ans;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// freopen(&quot;dp-mono.in&quot;,&quot;r&quot;,stdin);</span></span><br><span class="line">    <span class="comment">// freopen(&quot;dp-mono.out&quot;,&quot;w&quot;,stdout);</span></span><br><span class="line">    <span class="built_in">read</span>(N);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=N;++i)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">read</span>(x[i]);</span><br><span class="line">        <span class="keyword">while</span>(Top[<span class="number">0</span>]&amp;&amp;x[Stk[<span class="number">0</span>][Top[<span class="number">0</span>]]]&gt;=x[i]) --Top[<span class="number">0</span>];</span><br><span class="line">        <span class="keyword">while</span>(Top[<span class="number">1</span>]&amp;&amp;x[Stk[<span class="number">1</span>][Top[<span class="number">1</span>]]]&lt; x[i]) --Top[<span class="number">1</span>];</span><br><span class="line">        <span class="type">int</span> k=<span class="built_in">upper_bound</span>(Stk[<span class="number">0</span>]+<span class="number">1</span>,Stk[<span class="number">0</span>]+<span class="number">1</span>+Top[<span class="number">0</span>],Stk[<span class="number">1</span>][Top[<span class="number">1</span>]])-Stk[<span class="number">0</span>];</span><br><span class="line">        <span class="keyword">if</span>(k!=(Top[<span class="number">0</span>]+<span class="number">1</span>)) ans=<span class="built_in">max</span>(ans,i-Stk[<span class="number">0</span>][k]+<span class="number">1</span>);</span><br><span class="line">        Stk[<span class="number">0</span>][++Top[<span class="number">0</span>]]=i;</span><br><span class="line">        Stk[<span class="number">1</span>][++Top[<span class="number">1</span>]]=i;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d&quot;</span>,ans);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">5</span></span><br><span class="line"><span class="comment">1</span></span><br><span class="line"><span class="comment">2</span></span><br><span class="line"><span class="comment">3</span></span><br><span class="line"><span class="comment">4</span></span><br><span class="line"><span class="comment">1</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure></details><hr><p><a href="https://www.luogu.com.cn/problem/P2422">P2422 良好的感觉</a></p><p>维护比第 $x$ 个数大的偏左和偏右下标，每一个点贡献的答案就是：</p><p>$ans=\max\limits_{1\le i\le n}\{x_i\times(s_{right_i}-s_{left_i-1})\}$</p><p>从前往后，从后往前各一次单调栈后统计答案，应该要开 <code>long long</code> ，没试过。</p><details>    <summary>AC Code</summary><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;ctime&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iomanip&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stack&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;map&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> gh() getchar()</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> re register</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> ll;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN=<span class="number">1e5</span>+<span class="number">1</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> INF=<span class="number">0x7f7f7f7f</span>;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    x=<span class="number">0</span>;</span><br><span class="line">    <span class="type">char</span> ch=<span class="built_in">gh</span>(),t=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(ch&lt;<span class="string">&#x27;0&#x27;</span>||ch&gt;<span class="string">&#x27;9&#x27;</span>) t|=ch==<span class="string">&#x27;-&#x27;</span>,ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">while</span>(ch&gt;=<span class="string">&#x27;0&#x27;</span>&amp;&amp;ch&lt;=<span class="string">&#x27;9&#x27;</span>) x=(x&lt;&lt;<span class="number">3</span>)+(x&lt;&lt;<span class="number">1</span>)+(ch^<span class="number">48</span>),ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">if</span>(t) x=-x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T,<span class="keyword">class</span> ...T1&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x,T1 &amp;...x1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">read</span>(x),<span class="built_in">read</span>(x1...);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">checkMax</span><span class="params">(T &amp;x,T &amp;y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x&lt;y?x=y,<span class="number">1</span>:<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">checkMin</span><span class="params">(T &amp;x,T &amp;y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x&gt;y?x=y,<span class="number">1</span>:<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> N,Stk[MAXN&lt;&lt;<span class="number">1</span>],Top;</span><br><span class="line"><span class="type">int</span> Le[MAXN],Ri[MAXN];</span><br><span class="line">ll s[MAXN],x[MAXN],ans;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// freopen(&quot;stack-mono.in&quot;,&quot;r&quot;,stdin);</span></span><br><span class="line">    <span class="comment">// freopen(&quot;stack-mono.out&quot;,&quot;w&quot;,stdout);</span></span><br><span class="line">    <span class="built_in">read</span>(N);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=N;++i) <span class="built_in">read</span>(x[i]),s[i]=s[i<span class="number">-1</span>]+x[i];</span><br><span class="line">    x[<span class="number">0</span>]=x[N+<span class="number">1</span>]=-INF;</span><br><span class="line">    Stk[++Top]=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=N;++i)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">while</span>(Top&amp;&amp;x[Stk[Top]]&gt;x[i]) --Top;</span><br><span class="line">        Le[i]=Stk[Top]+<span class="number">1</span>;</span><br><span class="line">        Stk[++Top]=i;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">memset</span>(Stk,<span class="number">0</span>,<span class="built_in">sizeof</span>(Stk));</span><br><span class="line">    Stk[Top=<span class="number">1</span>]=N+<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=N;i&gt;=<span class="number">1</span>;--i)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">while</span>(Top&amp;&amp;x[Stk[Top]]&gt;x[i]) --Top;</span><br><span class="line">        Ri[i]=Stk[Top]<span class="number">-1</span>;</span><br><span class="line">        Stk[++Top]=i;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=N;++i) ans=<span class="built_in">max</span>(ans,x[i]*(s[Ri[i]]-s[Le[i]<span class="number">-1</span>]));</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%lld&quot;</span>,ans);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">6</span></span><br><span class="line"><span class="comment">3 1 6 4 5 2</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure></details><p> —</p>]]></content>
      
      
      <categories>
          
          <category> 学习笔记 </category>
          
          <category> OI </category>
          
      </categories>
      
      
        <tags>
            
            <tag> DP </tag>
            
            <tag> 优化 </tag>
            
            <tag> RMQ </tag>
            
            <tag> 队列 </tag>
            
            <tag> 背包 </tag>
            
            <tag> STL </tag>
            
            <tag> 分析法 </tag>
            
            <tag> 单调队列 </tag>
            
            <tag> 单调栈 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>NOIP2022.02.12模拟赛</title>
      <link href="/Eternity/%E6%A8%A1%E6%8B%9F%E8%B5%9B-%E6%AF%94%E8%B5%9B/20220212/"/>
      <url>/Eternity/%E6%A8%A1%E6%8B%9F%E8%B5%9B-%E6%AF%94%E8%B5%9B/20220212/</url>
      
        <content type="html"><![CDATA[<p>还彳亍</p><span id="more"></span><h2 id="题目I——城墙（wall）"><a href="#题目I——城墙（wall）" class="headerlink" title="题目I——城墙（wall）"></a>题目I——城墙（wall）</h2><h3 id="题目描述"><a href="#题目描述" class="headerlink" title="题目描述"></a>题目描述</h3><p>给出一个长度为 $n$ 的序列和一个数 $S$ ，求出最短的区间使得区间和大于等于 $S$ 。</p><h3 id="思路"><a href="#思路" class="headerlink" title="思路"></a>思路</h3><p>因为 $n \leq 1500000$ ，所以复杂度最大为 $O(n \log n)$ ，统计前缀和，二分统计长度是否能达到，每次暴力区间和。复杂度合适。</p><h3 id="Task-One-AC-Code"><a href="#Task-One-AC-Code" class="headerlink" title="Task One AC Code"></a>Task One AC Code</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;ctime&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iomanip&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stack&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;map&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> gh() getchar()</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> underMax(x,y) ((x)&gt;(y)?(x):(y))</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> underMin(x,y) ((x)&lt;(y)?(x):(y))</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> ll;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN=<span class="number">1500001</span>;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">underRead</span><span class="params">(T &amp;x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    x=<span class="number">0</span>;</span><br><span class="line">    <span class="type">char</span> ch=<span class="built_in">gh</span>(),t=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(ch&lt;<span class="string">&#x27;0&#x27;</span>||ch&gt;<span class="string">&#x27;9&#x27;</span>) t|=ch==<span class="string">&#x27;-&#x27;</span>,ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">while</span>(ch&gt;=<span class="string">&#x27;0&#x27;</span>&amp;&amp;ch&lt;=<span class="string">&#x27;9&#x27;</span>) x=(x&lt;&lt;<span class="number">3</span>)+(x&lt;&lt;<span class="number">1</span>)+(ch^<span class="number">48</span>),ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">if</span>(t) x=-x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> n,S,num[MAXN];</span><br><span class="line">ll sum[MAXN];</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">underCheck</span><span class="params">(<span class="type">int</span> k)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=k;i&lt;=n;++i) <span class="keyword">if</span>(sum[i]-sum[i-k]&gt;=S) <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">freopen</span>(<span class="string">&quot;wall.in&quot;</span>,<span class="string">&quot;r&quot;</span>,stdin);</span><br><span class="line">    <span class="built_in">freopen</span>(<span class="string">&quot;wall.out&quot;</span>,<span class="string">&quot;w&quot;</span>,stdout);</span><br><span class="line">    <span class="built_in">underRead</span>(n),<span class="built_in">underRead</span>(S);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;++i)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">underRead</span>(num[i]);</span><br><span class="line">        sum[i]=sum[i<span class="number">-1</span>]+num[i];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> l=<span class="number">1</span>,r=n;</span><br><span class="line">    <span class="keyword">if</span>(sum[n]&lt;S)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;0&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span>(l&lt;r)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> mid=(l+r)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span>(<span class="built_in">underCheck</span>(mid)) r=mid;</span><br><span class="line">        <span class="keyword">else</span> l=mid+<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d&quot;</span>,l);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">10 15</span></span><br><span class="line"><span class="comment">5 1 3 5 10 7 4 9 2 8</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><h2 id="题目II——岗哨（sentry）"><a href="#题目II——岗哨（sentry）" class="headerlink" title="题目II——岗哨（sentry）"></a>题目II——岗哨（sentry）</h2><h3 id="题目含义："><a href="#题目含义：" class="headerlink" title="题目含义："></a>题目含义：</h3><p>给出一个长度为 $n(n \leq 10^6)$ 的序列：</p><p>第一个答案求的是一段最长的，严格递增的，右端点最小的子区间，输出该子区间的右端点。</p><p>第二行答案求的是去掉一个区间后，一段最长的，严格递增的，右端点最小的子区间，输出该子区间的右端点和长度。</p><h3 id="其他事项"><a href="#其他事项" class="headerlink" title="其他事项"></a>其他事项</h3><p>洛谷有一道类似题目——<a href="https://www.luogu.com.cn/problem/UVA1471">UVA1471防线</a></p><p>根据<del>机房老大哥</del>的教导，这道题的方法多样：树状数组，线段树，$Dp$，离散化等。</p><h3 id="思路-1"><a href="#思路-1" class="headerlink" title="思路"></a>思路</h3><p><strong>注：本人的线段树写挂了，所以以下方法来自同机房巨佬<a href="https://www.luogu.com.cn/user/109659">_Live_</a>的题解</strong></p><p>对于第一个答案，用 $num_i$ 结构体统计每一个连续上升子区间的信息，得出最大的子区间长度，输出右端点即可。</p><p>对于第二个答案，用 $f_i$ 统计以 $i$ 为起点的最长上升子序列的大小， $g_i$ 来统计以 $i$ 结尾的最长上升子序列的大小。枚举 $a_i , i \in ( 1 , n )$ ，找到每一个 $k$ 使 $a_k &lt; a_i$ 时的 $g_k + f_i$ 最大。</p><p>这样子看来，这个模拟的过程类似于求 $LIS$ （最长上升子序列）的过程。以 $b_i$ 数组存储能够使 $g_i$ 的值为 $i$ 的最小的 $a_i$ 的值。最后我们求到的 $dp$ 位置是第二个区间的左端点，所以最后输出的应该是 $dp+f_{dp}-1$ 的位置。</p><h3 id="Task-Two-AC-Code"><a href="#Task-Two-AC-Code" class="headerlink" title="Task Two AC Code"></a>Task Two AC Code</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;ctime&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iomanip&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stack&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;map&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> gh() getchar()</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> underMax(x,y) ((x)&gt;(y)?(x):(y))</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> underMin(x,y) ((x)&lt;(y)?(x):(y))</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> ll;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN=<span class="number">1e6</span>+<span class="number">1</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> INF=<span class="number">1e9</span>;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">underRead</span><span class="params">(T &amp;x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    x=<span class="number">0</span>;</span><br><span class="line">    <span class="type">char</span> ch=<span class="built_in">gh</span>(),t=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(ch&lt;<span class="string">&#x27;0&#x27;</span>||ch&gt;<span class="string">&#x27;9&#x27;</span>) t|=ch==<span class="string">&#x27;-&#x27;</span>,ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">while</span>(ch&gt;=<span class="string">&#x27;0&#x27;</span>&amp;&amp;ch&lt;=<span class="string">&#x27;9&#x27;</span>) x=(x&lt;&lt;<span class="number">3</span>)+(x&lt;&lt;<span class="number">1</span>)+(ch^<span class="number">48</span>),ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">if</span>(t) x=-x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> T,n,v[MAXN&lt;&lt;<span class="number">2</span>],a[MAXN],g[MAXN],f[MAXN],b[MAXN];</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">underBuild</span><span class="params">(<span class="type">int</span> p,<span class="type">int</span> l,<span class="type">int</span> r)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    v[p]=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span>(l==r) <span class="keyword">return</span> ;</span><br><span class="line">    <span class="type">int</span> mid=(l+r)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">    <span class="built_in">underBuild</span>(p&lt;&lt;<span class="number">1</span>,l,mid),<span class="built_in">underBuild</span>(p&lt;&lt;<span class="number">1</span>|<span class="number">1</span>,mid+<span class="number">1</span>,r);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">underModify</span><span class="params">(<span class="type">int</span> p,<span class="type">int</span> l,<span class="type">int</span> r,<span class="type">int</span> x,<span class="type">int</span> d)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    v[p]=<span class="built_in">underMax</span>(v[p],d);</span><br><span class="line">    <span class="keyword">if</span>(l==r) <span class="keyword">return</span> ;</span><br><span class="line">    <span class="type">int</span> mid=(l+r)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span>(x&lt;=mid) <span class="built_in">underModify</span>(p&lt;&lt;<span class="number">1</span>,l,mid,x,d);</span><br><span class="line">    <span class="keyword">if</span>(mid&lt;x) <span class="built_in">underModify</span>(p&lt;&lt;<span class="number">1</span>|<span class="number">1</span>,mid+<span class="number">1</span>,r,x,d);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">underQuery</span><span class="params">(<span class="type">int</span> p,<span class="type">int</span> l,<span class="type">int</span> r,<span class="type">int</span> x,<span class="type">int</span> y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(x&lt;=l&amp;&amp;r&lt;=y) <span class="keyword">return</span> v[p];</span><br><span class="line">    <span class="type">int</span> mid=(l+r)&gt;&gt;<span class="number">1</span>,ans=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span>(x&lt;=mid&amp;&amp;y&gt;=l) ans=<span class="built_in">underQuery</span>(p&lt;&lt;<span class="number">1</span>,l,mid,x,y);</span><br><span class="line">    <span class="keyword">if</span>(y&gt;mid&amp;&amp;x&lt;=r) ans=<span class="built_in">underMax</span>(ans,<span class="built_in">underQuery</span>(p&lt;&lt;<span class="number">1</span>|<span class="number">1</span>,mid+<span class="number">1</span>,r,x,y));</span><br><span class="line">    <span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> h[MAXN],tot,Max,Dp,t[MAXN];</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Node</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> l,r;</span><br><span class="line">&#125;num[MAXN];</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">underWork</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// underRead(n);</span></span><br><span class="line">    <span class="built_in">memset</span>(b,<span class="number">0x7f7f7f7f</span>,<span class="built_in">sizeof</span>(b));</span><br><span class="line">    a[<span class="number">0</span>]=a[n+<span class="number">1</span>]=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;++i) </span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// underRead(a[i]);</span></span><br><span class="line">        a[i]=h[i];</span><br><span class="line">        g[i]=<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span>(a[i]&gt;a[i<span class="number">-1</span>]) g[i]=g[i<span class="number">-1</span>]+<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> ans=<span class="number">0</span>,dp=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=n;i;--i)</span><br><span class="line">    &#123;</span><br><span class="line">        f[i]=<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span>(a[i]&lt;a[i+<span class="number">1</span>]) f[i]=f[i+<span class="number">1</span>]+<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;++i)</span><br><span class="line">        <span class="keyword">if</span>(ans&lt;<span class="built_in">underMax</span>(f[i],g[i]))</span><br><span class="line">        &#123;</span><br><span class="line">            ans=<span class="built_in">underMax</span>(f[i],g[i]);</span><br><span class="line">            dp=i;</span><br><span class="line">        &#125;</span><br><span class="line">    <span class="comment">/*sort(b+1,b+1+n);</span></span><br><span class="line"><span class="comment">    int cnt=unique(b+1,b+1+n)-b-1;</span></span><br><span class="line"><span class="comment">    underBuild(1,1,cnt+1);*/</span></span><br><span class="line">    b[<span class="number">1</span>]=a[<span class="number">1</span>];</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;++i)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> k=<span class="built_in">lower_bound</span>(b+<span class="number">1</span>,b+<span class="number">1</span>+n,a[i])-b<span class="number">-1</span>;</span><br><span class="line">        <span class="keyword">if</span>(f[i]+k&gt;ans)</span><br><span class="line">        &#123;</span><br><span class="line">            ans=f[i]+k;</span><br><span class="line">            dp=i;</span><br><span class="line">        &#125;</span><br><span class="line">        b[g[i]]=<span class="built_in">underMin</span>(b[g[i]],a[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/*for(int i=1;i&lt;=n;++i)</span></span><br><span class="line"><span class="comment">    &#123;</span></span><br><span class="line"><span class="comment">        int x=lower_bound(b+1,b+1+n,a[i])-b;</span></span><br><span class="line"><span class="comment">        ans=underMax(ans,f[i]+underQuery(1,1,cnt+1,1,x));</span></span><br><span class="line"><span class="comment">        underModify(1,1,cnt+1,x+1,g[i]);</span></span><br><span class="line"><span class="comment">    &#125;*/</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d %d&quot;</span>,dp+f[dp]<span class="number">-1</span>,ans);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*inline int underDisc(int x)</span></span><br><span class="line"><span class="comment">&#123;</span></span><br><span class="line"><span class="comment">    int l=1,r=tot;</span></span><br><span class="line"><span class="comment">    while(l&lt;r)</span></span><br><span class="line"><span class="comment">    &#123;</span></span><br><span class="line"><span class="comment">        int mid=(l+r)&gt;&gt;1;</span></span><br><span class="line"><span class="comment">        if(num[mid].l&lt;=x&amp;&amp;x&lt;=num[mid].r) return mid;</span></span><br><span class="line"><span class="comment">        else if(num[mid].l&gt;x) r=mid;</span></span><br><span class="line"><span class="comment">        else if(num[mid].r&lt;x) l=mid+1;</span></span><br><span class="line"><span class="comment">    &#125;</span></span><br><span class="line"><span class="comment">    return l;</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment">inline void underCheck()</span></span><br><span class="line"><span class="comment">&#123;</span></span><br><span class="line"><span class="comment">    for(int l=1;l&lt;n;++l)</span></span><br><span class="line"><span class="comment">    &#123;</span></span><br><span class="line"><span class="comment">        if(Max&gt;=n-l) return ;</span></span><br><span class="line"><span class="comment">        for(int i=2;i&lt;=n-l;++i)</span></span><br><span class="line"><span class="comment">        &#123;</span></span><br><span class="line"><span class="comment">            //i ~ i+l-1</span></span><br><span class="line"><span class="comment">            int u1=i-1,u2=i+l;</span></span><br><span class="line"><span class="comment">            if(t[u1]==t[u2])</span></span><br><span class="line"><span class="comment">            &#123;</span></span><br><span class="line"><span class="comment">                i=num[t[u2]].r-l;</span></span><br><span class="line"><span class="comment">                continue;</span></span><br><span class="line"><span class="comment">            &#125;</span></span><br><span class="line"><span class="comment">            //i+l=num[t[u2]].r</span></span><br><span class="line"><span class="comment">            if(h[u1]&lt;h[u2])</span></span><br><span class="line"><span class="comment">            &#123;</span></span><br><span class="line"><span class="comment">                int len=(u1-num[t[u1]].l+1)+(num[t[u2]].r-u2+1);</span></span><br><span class="line"><span class="comment">                if(len&gt;Max) Max=len,Dp=num[t[u2]].r;</span></span><br><span class="line"><span class="comment">            &#125;</span></span><br><span class="line"><span class="comment">        &#125;</span></span><br><span class="line"><span class="comment">    &#125;</span></span><br><span class="line"><span class="comment">&#125;*/</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">freopen</span>(<span class="string">&quot;sentry.in&quot;</span>,<span class="string">&quot;r&quot;</span>,stdin);</span><br><span class="line">    <span class="built_in">freopen</span>(<span class="string">&quot;sentry.out&quot;</span>,<span class="string">&quot;w&quot;</span>,stdout);</span><br><span class="line">    <span class="built_in">underRead</span>(n);</span><br><span class="line">    num[++tot].l=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;++i)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">underRead</span>(h[i]);</span><br><span class="line">        <span class="keyword">if</span>(h[i<span class="number">-1</span>]&gt;=h[i])</span><br><span class="line">        &#123;</span><br><span class="line">            num[tot].r=i<span class="number">-1</span>;</span><br><span class="line">            num[++tot].l=i;</span><br><span class="line">        &#125;</span><br><span class="line">        t[i]=tot;</span><br><span class="line">    &#125;</span><br><span class="line">    num[tot].r=n;</span><br><span class="line">    <span class="keyword">if</span>(tot==<span class="number">1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d\n%d %d&quot;</span>,n,n,n);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(tot==n)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;1\n1 1&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> maxn=<span class="number">0</span>,dp=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=tot;++i) </span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> k=num[i].r-num[i].l+<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span>(k&gt;maxn)</span><br><span class="line">        &#123;</span><br><span class="line">            maxn=k;</span><br><span class="line">            dp=num[i].r;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// Max=maxn,Dp=dp;</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,dp);</span><br><span class="line">    <span class="built_in">underWork</span>();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">8</span></span><br><span class="line"><span class="comment">1 2 3 7 6 4 5 2</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><h2 id="题目III——黑客（Hack）"><a href="#题目III——黑客（Hack）" class="headerlink" title="题目III——黑客（Hack）"></a>题目III——黑客（Hack）</h2><h3 id="题目含义"><a href="#题目含义" class="headerlink" title="题目含义"></a>题目含义</h3><p>给定一个有向图，从任意一点出发遍历所有点，删除所有经过的边；再从任意一点出发遍历所有点，如果能达到，求出两次所需的最小权值和。</p><h3 id="思路-2"><a href="#思路-2" class="headerlink" title="思路"></a>思路</h3><p><del>说实话，当看到 $n \leq 10 , m \leq 25$ 时我真的以为正解是爆搜</del>。然而测试数据有 $1000$ 套。</p><p>跑一遍最小生成树（建议 $Kruskal$ ），求出这棵树上的必要边（删掉会使原图最小生成树的总权值变大的边）。这些边必在第二棵最小生成树里。枚举必要边在 $A$ 和 $B$ 生成树里的情况，则 $ans = \min ( a + b )$ 。</p><p><del>可惜蒟蒻到最后也没打出来qwq</del></p><h3 id="Task-Three-AC-Code"><a href="#Task-Three-AC-Code" class="headerlink" title="Task Three AC Code"></a>Task Three AC Code</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;ctime&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iomanip&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stack&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;map&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> gh() getchar()</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> underMax(x,y) ((x)&gt;(y)?(x):(y))</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> underMin(x,y) ((x)&lt;(y)?(x):(y))</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> ll;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN=<span class="number">101</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXM=<span class="number">206</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> INF=<span class="number">1e9</span>;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">underRead</span><span class="params">(T &amp;x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    x=<span class="number">0</span>;</span><br><span class="line">    <span class="type">char</span> ch=<span class="built_in">gh</span>(),t=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(ch&lt;<span class="string">&#x27;0&#x27;</span>||ch&gt;<span class="string">&#x27;9&#x27;</span>) t|=ch==<span class="string">&#x27;-&#x27;</span>,ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">while</span>(ch&gt;=<span class="string">&#x27;0&#x27;</span>&amp;&amp;ch&lt;=<span class="string">&#x27;9&#x27;</span>) x=(x&lt;&lt;<span class="number">3</span>)+(x&lt;&lt;<span class="number">1</span>)+(ch^<span class="number">48</span>),ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">if</span>(t) x=-x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Node</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> u,v,w;</span><br><span class="line">&#125;Edge[MAXM&lt;&lt;<span class="number">2</span>];</span><br><span class="line"><span class="type">int</span> id[MAXN],b[MAXN],c[MAXN];</span><br><span class="line"><span class="type">int</span> f[MAXN],coun,cnt,num,n,m;</span><br><span class="line"><span class="type">bool</span> vis[MAXM];</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">underCmp</span><span class="params">(Node a,Node b)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> a.w&lt;b.w;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">underFind</span><span class="params">(<span class="type">int</span> x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(id[x]==x) <span class="keyword">return</span> x;</span><br><span class="line">    <span class="keyword">return</span> id[x]=<span class="built_in">underFind</span>(id[x]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">underInit</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    cnt=num=<span class="number">0</span>;</span><br><span class="line">    <span class="built_in">memset</span>(vis,<span class="number">0</span>,<span class="built_in">sizeof</span>(vis));</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">underInPut</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">underRead</span>(m);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=m;++i) <span class="built_in">scanf</span>(<span class="string">&quot;%d%d%d&quot;</span>,&amp;Edge[i].u,&amp;Edge[i].v,&amp;Edge[i].w);</span><br><span class="line">    <span class="built_in">sort</span>(Edge+<span class="number">1</span>,Edge+<span class="number">1</span>+m,underCmp);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">underKruskal</span><span class="params">(<span class="type">int</span> x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> ret=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;=n+<span class="number">1</span>;++i) id[i]=i;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=m;++i)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> p1=<span class="built_in">underFind</span>(Edge[i].u),p2=<span class="built_in">underFind</span>(Edge[i].v);</span><br><span class="line">        <span class="keyword">if</span>(p1!=p2&amp;!vis[i])</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span>(x==<span class="number">1</span>) b[cnt++]=i;</span><br><span class="line">            <span class="keyword">if</span>(x==<span class="number">3</span>) f[coun++]=i;</span><br><span class="line">            ret+=Edge[i].w;</span><br><span class="line">            id[p2]=p1;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> tp=<span class="built_in">underFind</span>(<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;++i) <span class="keyword">if</span>(<span class="built_in">underFind</span>(i)!=tp) <span class="keyword">return</span> INF;</span><br><span class="line">    <span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">underDeal</span><span class="params">(<span class="type">int</span> cd)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> tp=<span class="number">0</span>,d[MAXN];</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">0</span>;j&lt;num;++j) <span class="keyword">if</span>(cd&amp;(<span class="number">1</span>&lt;&lt;j)) d[tp++]=c[j];</span><br><span class="line">    <span class="built_in">memset</span>(vis,<span class="number">0</span>,<span class="built_in">sizeof</span>(vis));</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;tp;++i) vis[d[i]]=<span class="number">1</span>;</span><br><span class="line">    coun=<span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> x1=<span class="built_in">underKruskal</span>(<span class="number">3</span>);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;coun;++i) vis[f[i]]=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;tp;++i) vis[d[i]]=<span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> x2=<span class="built_in">underKruskal</span>(<span class="number">2</span>);</span><br><span class="line">    <span class="keyword">return</span> x1+x2;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">underAns</span><span class="params">(<span class="type">int</span> x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(x&gt;=INF) <span class="built_in">printf</span>(<span class="string">&quot;Too young too simple,sometimes naive!\n&quot;</span>);</span><br><span class="line">    <span class="keyword">else</span> <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,x);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">underWork</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> ret=<span class="built_in">underKruskal</span>(<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;cnt;++i)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">memset</span>(vis,<span class="number">0</span>,<span class="built_in">sizeof</span>(vis));</span><br><span class="line">        vis[b[i]]=<span class="number">1</span>;</span><br><span class="line">        <span class="type">int</span> tp=<span class="built_in">underKruskal</span>(<span class="number">2</span>);</span><br><span class="line">        <span class="keyword">if</span>(ret&lt;tp) c[num++]=b[i];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> len=<span class="number">1</span>&lt;&lt;num,ans=INF;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;len;++i) ans=<span class="built_in">underMin</span>(ans,<span class="built_in">underDeal</span>(i));</span><br><span class="line">    <span class="built_in">underAns</span>(ans);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">freopen</span>(<span class="string">&quot;hack.in&quot;</span>,<span class="string">&quot;r&quot;</span>,stdin);</span><br><span class="line">    <span class="built_in">freopen</span>(<span class="string">&quot;hack.out&quot;</span>,<span class="string">&quot;w&quot;</span>,stdout);</span><br><span class="line">    <span class="keyword">while</span>(<span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;n)!=EOF)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(!n) <span class="keyword">break</span>;</span><br><span class="line">        <span class="built_in">underInit</span>();</span><br><span class="line">        <span class="built_in">underInPut</span>();</span><br><span class="line">        <span class="built_in">underWork</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">2</span></span><br><span class="line"><span class="comment">3</span></span><br><span class="line"><span class="comment">1 2 10</span></span><br><span class="line"><span class="comment">2 1 20</span></span><br><span class="line"><span class="comment">1 2 30</span></span><br><span class="line"><span class="comment">3</span></span><br><span class="line"><span class="comment">3</span></span><br><span class="line"><span class="comment">1 2 10</span></span><br><span class="line"><span class="comment">1 2 20</span></span><br><span class="line"><span class="comment">2 3 50</span></span><br><span class="line"><span class="comment">0</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><h2 id="题目IV——膜拜大会（fake）"><a href="#题目IV——膜拜大会（fake）" class="headerlink" title="题目IV——膜拜大会（fake）"></a>题目IV——膜拜大会（fake）</h2><p>过于毒瘤，不会qwq</p><p><a href="https://blog.csdn.net/qq_43649416/article/details/101123235">给一个链接</a></p>]]></content>
      
      
      <categories>
          
          <category> 模拟赛/比赛 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 数论 </tag>
            
            <tag> DP </tag>
            
            <tag> 图论 </tag>
            
            <tag> 二分 </tag>
            
            <tag> 生成树 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CF451E Devus and Flowers</title>
      <link href="/Eternity/%E9%A2%98%E8%A7%A3/cf451e/"/>
      <url>/Eternity/%E9%A2%98%E8%A7%A3/cf451e/</url>
      
        <content type="html"><![CDATA[<p>数论</p><span id="more"></span><p><a href="https://www.luogu.com.cn/problem/CF451E">题目传送门</a></p><h2 id="注意"><a href="#注意" class="headerlink" title="注意"></a>注意</h2><p>用费马小定理推答案，记得卡常和开 $long\ long$ 。</p><h2 id="AC-Code："><a href="#AC-Code：" class="headerlink" title="AC Code："></a>AC Code：</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;ctime&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iomanip&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stack&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;map&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> gh() getchar()</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> underMax(x,y) ((x)&gt;(y)?(x):(y))</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> underMin(x,y) ((x)&lt;(y)?(x):(y))</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> ll;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN=<span class="number">21</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> Mod=<span class="number">1e9</span>+<span class="number">7</span>;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">underRead</span><span class="params">(T &amp;x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    x=<span class="number">0</span>;</span><br><span class="line">    <span class="type">char</span> ch=<span class="built_in">gh</span>(),t=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(ch&lt;<span class="string">&#x27;0&#x27;</span>||ch&gt;<span class="string">&#x27;9&#x27;</span>) t|=ch==<span class="string">&#x27;-&#x27;</span>,ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">while</span>(ch&gt;=<span class="string">&#x27;0&#x27;</span>&amp;&amp;ch&lt;=<span class="string">&#x27;9&#x27;</span>) x=(x&lt;&lt;<span class="number">3</span>)+(x&lt;&lt;<span class="number">1</span>)+(ch^<span class="number">48</span>),ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">if</span>(t) x=-x;</span><br><span class="line">&#125;</span><br><span class="line">ll A[MAXN];</span><br><span class="line"><span class="type">int</span> down=<span class="number">1</span>;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">underQmi</span><span class="params">(<span class="type">int</span> a,<span class="type">int</span> k,<span class="type">int</span> p)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> res=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span>(k)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(k&amp;<span class="number">1</span>) res=(ll)res*a%p;</span><br><span class="line">        a=(ll)a*a%p;</span><br><span class="line">        k&gt;&gt;=<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">underC</span><span class="params">(ll a,ll b)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(a&lt;b) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> up=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>(ll i=a;i&gt;a-b;--i) up=i%Mod*up%Mod;</span><br><span class="line">    <span class="keyword">return</span> (ll)up*down%Mod; <span class="comment">//费马小定理</span></span><br><span class="line">&#125; </span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// freopen(&quot;DaF.in&quot;,&quot;r&quot;,stdin);</span></span><br><span class="line">    <span class="comment">// freopen(&quot;DaF.out&quot;,&quot;w&quot;,stdout);</span></span><br><span class="line">    ll n,m;</span><br><span class="line">    <span class="built_in">underRead</span>(n),<span class="built_in">underRead</span>(m);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;n;++i) <span class="built_in">underRead</span>(A[i]);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">1</span>;j&lt;n;++j) down=(ll)j*down%Mod;</span><br><span class="line">    down=<span class="built_in">underQmi</span>(down,Mod<span class="number">-2</span>,Mod);</span><br><span class="line">    <span class="type">int</span> res=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;<span class="number">1</span>&lt;&lt;n;++i)</span><br><span class="line">    &#123;</span><br><span class="line">        ll a=n+m<span class="number">-1</span>,b=n<span class="number">-1</span>;</span><br><span class="line">        <span class="type">int</span> sign=<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">0</span>;j&lt;n;++j)</span><br><span class="line">            <span class="keyword">if</span>(i&gt;&gt;j&amp;<span class="number">1</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                sign*=<span class="number">-1</span>;</span><br><span class="line">                a-=A[j]+<span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        res=(res+<span class="built_in">underC</span>(a,b)*sign)%Mod;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d&quot;</span>,(res+Mod)%Mod);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">3 5</span></span><br><span class="line"><span class="comment">1 3 2</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 题解 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 数论 </tag>
            
            <tag> 费马小定理 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>闫氏DP分析法</title>
      <link href="/Eternity/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/OI/dp-yan-analysis/"/>
      <url>/Eternity/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/OI/dp-yan-analysis/</url>
      
        <content type="html"><![CDATA[<blockquote><p>“所有的 $DP$ 问题，本质上都是有限集中的最值问题”——闫学灿</p></blockquote><span id="more"></span><p><a href="https://www.bilibili.com/video/BV1X741127ZM?from=search&amp;seid=1472099735408379551">原作指路</a></p><h2 id="核心思想"><a href="#核心思想" class="headerlink" title="核心思想"></a>核心思想</h2><p>从<strong>集合</strong>的方式来考虑 $DP$ 的状态。</p><h2 id="阶段"><a href="#阶段" class="headerlink" title="阶段"></a>阶段</h2><p> $DP$ 的阶段：状态和状态转移。</p><p> 所以有：<strong>状态表示</strong>和<strong>状态计算</strong>。</p><h2 id="状态表示"><a href="#状态表示" class="headerlink" title="状态表示"></a>状态表示</h2><p>把几个具有相同点的元素合在一起考虑，成为一个状态</p><p>对于一个状态 $F_i$ ，考虑两个角度：</p><p>1.集合： $f(i)$ 表示什么集合</p><p>由于 $F_i$ 表示的是一堆东西(这也是 $DP$ 优于枚举的核心)，我们要考虑这一堆东西的共同特征，如：所有满足某个条件的元素集合。这一点请仔细考虑，到底是大于等于，大于，小于，小于等于，等于……这些的不同会导致状态计算方式的不同</p><p>2.属性： $f(i)$ 的属性</p><p>存的数与集合的关系：如 $max,min,count,sum$ 等。</p><p>很明显， $F_i$ 大多数时候是一个数，代表这个集合的某一个属性，多是最大值、最小值、数量、总和等。题目问什么，属性一般就是什么。</p><h2 id="状态计算"><a href="#状态计算" class="headerlink" title="状态计算"></a>状态计算</h2><p>对于 $F_i$ 所表示的集合，我们将其划分为多个子集。</p><ul><li><p>划分的依据——找最后一个不同点（依题而定，即关键决策）</p></li><li><p>划分之后，根据其子集求 $F_i$ 的值。 </p></li><li><p>举例：当属性为 $max$ 时， $F_i=max($ 子集的 $max)$ ，当属性为 $count$ 时， $F_i=\sum($ 子集的 $count)$ 等。</p></li></ul><h2 id="其他链接"><a href="#其他链接" class="headerlink" title="其他链接"></a>其他链接</h2><p><a href="https://www.cnblogs.com/IzayoiMiku/p/13635809.html">IzayoiMiku</a></p><p><a href="https://blog.csdn.net/weixin_44289697/article/details/105125613">XinyueRao</a></p><p><a href="https://www.acwing.com/file_system/file/content/whole/index/content/406072/">AcWing</a></p>]]></content>
      
      
      <categories>
          
          <category> 学习笔记 </category>
          
          <category> OI </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 数论 </tag>
            
            <tag> DP </tag>
            
            <tag> 分析法 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>矩阵</title>
      <link href="/Eternity/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/OI/matrix/"/>
      <url>/Eternity/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/OI/matrix/</url>
      
        <content type="html"><![CDATA[<p>“我们的结合，拥有着我们的一部分”</p><span id="more"></span><h2 id="矩阵："><a href="#矩阵：" class="headerlink" title="矩阵："></a>矩阵：</h2><p>矩阵(Matrix)是指一个按照长方阵列排列的集合。一个由 $n$ 行 $m$ 列个数字排列的列表称为“ $m$ 行 $n$ 列”的矩阵，简称 $n*m$ 矩阵，记作：<br>$\begin{Bmatrix}<br>a_1&amp;a_2&amp;a_3&amp;…&amp;a_m\\<br>a_{m+1}&amp;…&amp;…&amp;…&amp;a_{2m}\\<br>…&amp;…&amp;…&amp;…&amp;…\\<br>a_{m(n-1)+1}&amp;…&amp;…&amp;…&amp;a_{nm}<br>\end{Bmatrix}$</p><h2 id="矩阵加法-减法："><a href="#矩阵加法-减法：" class="headerlink" title="矩阵加法/减法："></a>矩阵加法/减法：</h2><p>令 $A,B$ 都是 $n*m$ 矩阵，则 $A+B=C$ ，满足：</p><p>$C=\begin{Bmatrix}<br>a_1+b_1&amp;a_2+b_2&amp;a_3+b_3&amp;…&amp;a_m+b_m\\<br>a_{m+1}+b_{m+1}&amp;…&amp;…&amp;…&amp;a_{2m}+b_{2m}\\<br>…&amp;…&amp;…&amp;…&amp;…\\<br>a_{m(n-1)+1}+b_{m(n-1)+1}&amp;…&amp;…&amp;…&amp;a_{nm}+b_{nm}<br>\end{Bmatrix}$</p><p>简单来说，即 $C_{i,j}=A_{i,j}+B_{i,j}$ ，减法同理。</p><h2 id="矩阵乘法："><a href="#矩阵乘法：" class="headerlink" title="矩阵乘法："></a>矩阵乘法：</h2><p>$A<em>B=C$ 满足 $C_{i,j}=\sum_{k=1}^{n}{A_{i,k}</em>B_{k,j}}$</p><p>矩阵乘法能够实现，仅当 $A$ 的行数与 $B$ 的列数相等时。</p><p><strong>举个栗子：</strong></p><p>$A=\begin{Bmatrix}1&amp;2&amp;3\\1&amp;2&amp;3\\\end{Bmatrix}$ ， $B=\begin{Bmatrix}3&amp;2\\1&amp;3\\2&amp;1\\\end{Bmatrix}$</p><p>那么对于 $C=A*B$ ，则</p><script type="math/tex; mode=display">C_{1,1} = A_{1,1} * B_{1,1} + A_{1,2} * B_{2,1} + A_{1,3} * B_{3,1}</script><p>简单来讲就是</p><p> $C_{1,1}=\sum_{k=1}^{n=3}{A_{1,k}}*\sum_{k=1}^{m=3}{B_{k,1}}$</p><p>那么矩阵乘法的代码实现即是：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;++i)</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">1</span>;j&lt;=n;++j)</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> k=<span class="number">1</span>;k&lt;=n;++k)</span><br><span class="line">            c[i][j]+=a[i][k]*b[k][j];</span><br></pre></td></tr></table></figure><h2 id="矩阵快速幂："><a href="#矩阵快速幂：" class="headerlink" title="矩阵快速幂："></a>矩阵快速幂：</h2><p>对于一个矩阵 $G$ 来说， $G^k$ 中 $G_{i,j}$ 的含义为从 $i$ 走到 $j$ 步数为 $k$ 的方案数。</p><p>不用理解太多，就是用矩阵实现快速幂即可，将数乘换成矩阵乘法（<del>蒟蒻改了一下午，才发现把 $i$ 打成了 $j$</del>）</p><p><a href="https://www.luogu.com.cn/problem/P3390">LuoguP3390</a></p><h3 id="AC-Code："><a href="#AC-Code：" class="headerlink" title="AC Code："></a>AC Code：</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;ctime&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iomanip&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stack&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;map&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> gh() getchar()</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> underMax(x,y) ((x)&gt;(y)?(x):(y))</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> underMin(x,y) ((x)&lt;(y)?(x):(y))</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> ll;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> ll p=<span class="number">1e9</span>+<span class="number">7</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N=<span class="number">101</span>;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">underRead</span><span class="params">(T &amp;x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    x=<span class="number">0</span>;</span><br><span class="line">    <span class="type">char</span> ch=<span class="built_in">gh</span>(),t=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(ch&lt;<span class="string">&#x27;0&#x27;</span>||ch&gt;<span class="string">&#x27;9&#x27;</span>) t|=ch==<span class="string">&#x27;-&#x27;</span>,ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">while</span>(ch&gt;=<span class="string">&#x27;0&#x27;</span>&amp;&amp;ch&lt;=<span class="string">&#x27;9&#x27;</span>) x=(x&lt;&lt;<span class="number">3</span>)+(x&lt;&lt;<span class="number">1</span>)+(ch^<span class="number">48</span>),ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">if</span>(t) x=-x;</span><br><span class="line">&#125;</span><br><span class="line">ll n,k;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Matrix</span></span><br><span class="line">&#123;</span><br><span class="line">    ll m[N][N];             <span class="comment">// 记得开long long</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> Matrix <span class="title">underCalc</span><span class="params">(Matrix a,Matrix b)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Matrix res;</span><br><span class="line">    <span class="built_in">memset</span>(res.m,<span class="number">0</span>,<span class="built_in">sizeof</span>(res.m));</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;++i)</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">1</span>;j&lt;=n;++j)</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> l=<span class="number">1</span>;l&lt;=n;++l)</span><br><span class="line">                res.m[i][j]=(res.m[i][j]+(a.m[i][l]*b.m[l][j])%p)%p;</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line">Matrix a;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">underExpr</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Matrix temp;</span><br><span class="line">    <span class="built_in">memset</span>(temp.m,<span class="number">0</span>,<span class="built_in">sizeof</span>(temp.m));</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;++i) temp.m[i][i]=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span>(k)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(k&amp;<span class="number">1</span>) temp=<span class="built_in">underCalc</span>(a,temp);</span><br><span class="line">        a=<span class="built_in">underCalc</span>(a,a);</span><br><span class="line">        k&gt;&gt;=<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;++i)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">1</span>;j&lt;=n;++j)</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;%lld &quot;</span>,temp.m[i][j]%p);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// freopen(&quot;matrix.in&quot;,&quot;r&quot;,stdin);</span></span><br><span class="line">    <span class="comment">// freopen(&quot;matrix.out&quot;,&quot;w&quot;,stdout);</span></span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%lld%lld&quot;</span>,&amp;n,&amp;k);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;++i)</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">1</span>;j&lt;=n;++j)</span><br><span class="line">            <span class="built_in">scanf</span>(<span class="string">&quot;%lld&quot;</span>,&amp;a.m[i][j]);</span><br><span class="line">    <span class="built_in">underExpr</span>();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">2 1</span></span><br><span class="line"><span class="comment">1 1</span></span><br><span class="line"><span class="comment">1 1</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 学习笔记 </category>
          
          <category> OI </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 数论 </tag>
            
            <tag> 矩阵快速幂，矩阵乘法 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>NOIP2022.01.26模拟赛</title>
      <link href="/Eternity/%E6%A8%A1%E6%8B%9F%E8%B5%9B-%E6%AF%94%E8%B5%9B/20220126/"/>
      <url>/Eternity/%E6%A8%A1%E6%8B%9F%E8%B5%9B-%E6%AF%94%E8%B5%9B/20220126/</url>
      
        <content type="html"><![CDATA[<p>无论哪个学科，最难的部分永远是数学</p><span id="more"></span><h2 id="题目I——集合均值-mos"><a href="#题目I——集合均值-mos" class="headerlink" title="题目I——集合均值(mos)"></a>题目I——集合均值(mos)</h2><blockquote><p>MOS=Mean Of Set</p></blockquote><p>一道完美的数学题，指不推公式你完全不知道它居然求的是**<del>（暂且保密）</del>。</p><p>因为每一次都需要从B中随机一个数，那么第一次取到了 $a_i$ 的话，求到的 $ans$ 应该加上 $\frac{a_i}{2}$ ，以此类推，当第二次取到了 $a_j$ 的时候，求到了 $ans$ 就取到 $\frac{a_i+a_j}{3}$ ，然后继续计算，我们会发现 $B$ 中的所有数对最终答案的贡献系数都是一样的，并且其贡献系数与其在 $B$ 中的位置没有关系，只会和 $B$ 的大小有关系，然后继续推算，答案就<del>显而易见</del>了：<br>$ans=f(|B|)\sum_{x\in B}{a_x}$</p><p>那么现在的问题就在于求出 $f(i)$ 了，我们可以模拟从 $B$ 移动到 $A$ 的过程，花费 $O{m}$ 的时间，这也是 $40pt$ 的做法。然而这道题的关键在于：我们最后求出的期望值是一个有理数 $frac{a}{b}$ ，所以我们需要进行<a href="https://www.luogu.com.cn/problem/P2613">有理数取余</a>，而进行<strong>逆元</strong>操作。（逆元便是这道题的正解）</p><h3 id="怎么想到使用逆元的："><a href="#怎么想到使用逆元的：" class="headerlink" title="怎么想到使用逆元的："></a>怎么想到使用逆元的：</h3><p>首先，我们已经推出了 $ans=f(|B|)\sum_{x\in B}{a}$ ，设 $i$ 为当前 $A$ ，即已经已过去了的数的个数，那么 $|B|=\frac{i-1}{i}$ 了。我们需要在计算的过程中取模，也就自然想到使用逆元了。<del>（虽然考的时候完全没有想到）</del></p><p>具体来说：</p><ul><li>暴力模拟求逆元可得 $70pt$</li><li>线性求逆元可得 $100pt$</li><li>事实上，我们需要的也是这些逆元的和即可，根据原作者的话来说，会有一种<del>强力的</del>的多项式<del>高科技</del>能使求逆元的复杂度达到 $O(\sqrt{nm}\log{nm})$ 。但在这道题来说($n<em>m ≦ 2</em>10^7$)，线性求逆元已经完全足够了。</li></ul><h2 id="Task-One-Ac-Code"><a href="#Task-One-Ac-Code" class="headerlink" title="Task One Ac Code:"></a>Task One Ac Code:</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;ctime&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iomanip&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stack&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;map&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> gh() getchar()</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> underMax(x,y) ((x)&gt;(y)?(x):(y))</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> underMin(x,y) ((x)&lt;(y)?(x):(y))</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> ll;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN=<span class="number">2e7</span>+<span class="number">1</span>;</span><br><span class="line"><span class="type">const</span> ll Mod=<span class="number">998244353</span>;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">underRead</span><span class="params">(T &amp;x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    x=<span class="number">0</span>;</span><br><span class="line">    <span class="type">char</span> ch=<span class="built_in">gh</span>(),t=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(ch&lt;<span class="string">&#x27;0&#x27;</span>||ch&gt;<span class="string">&#x27;9&#x27;</span>) t|=ch==<span class="string">&#x27;-&#x27;</span>,ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">while</span>(ch&gt;=<span class="string">&#x27;0&#x27;</span>&amp;&amp;ch&lt;=<span class="string">&#x27;9&#x27;</span>) x=(x&lt;&lt;<span class="number">3</span>)+(x&lt;&lt;<span class="number">1</span>)+(ch^<span class="number">48</span>),ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">if</span>(t) x=-x;</span><br><span class="line">&#125;</span><br><span class="line">ll n,m,x,Num[MAXN],Sum,Inv[MAXN];</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">freopen</span>(<span class="string">&quot;mos.in&quot;</span>,<span class="string">&quot;r&quot;</span>,stdin);</span><br><span class="line">    <span class="built_in">freopen</span>(<span class="string">&quot;mos.out&quot;</span>,<span class="string">&quot;w&quot;</span>,stdout);</span><br><span class="line">    <span class="built_in">underRead</span>(n),<span class="built_in">underRead</span>(m);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;++i) <span class="built_in">underRead</span>(Num[i]),Sum+=Num[i];</span><br><span class="line">    Sum%=Mod;</span><br><span class="line">    Sum=(Sum*m)%Mod;</span><br><span class="line">    Inv[<span class="number">1</span>]=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">2</span>;i&lt;=n*m+<span class="number">1</span>;++i)</span><br><span class="line">    &#123;</span><br><span class="line">        Inv[i]=(Mod-Mod/i)*Inv[Mod%i]%Mod;</span><br><span class="line">        x=(x+(i<span class="number">-1</span>)*Inv[i])%Mod;</span><br><span class="line">    &#125;</span><br><span class="line">    x=(x*Inv[n*m])%Mod;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%lld&quot;</span>,Sum*x%Mod);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">3 3</span></span><br><span class="line"><span class="comment">1 2 3</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><h2 id="题目II——聚烷撑乙二醇-pag"><a href="#题目II——聚烷撑乙二醇-pag" class="headerlink" title="题目II——聚烷撑乙二醇(pag)"></a>题目II——聚烷撑乙二醇(pag)</h2><blockquote><p>PAG=Play A Game</p></blockquote><p><del>做题最大的收获是知道了 $PAG$ 是聚烷撑乙二醇的意思</del></p><h3 id="题目含义："><a href="#题目含义：" class="headerlink" title="题目含义："></a>题目含义：</h3><p>鲁迅曾经说过，要多去尝试，才能最终发现最优的答案。</p><p>鲁迅也还说过，要珍惜当下，把握住眼前的机会。</p><p>有 $n$ 个随机数生成器，第 $i$ 个生成器可以均匀随机地生成 $[L_i,R_i]$ 内的一个实数。</p><p>现在你要玩个游戏，从第 $1$ 个生成器到第 $n$ 个生成器，每次当前生成器会生成一个数，你需要选择：</p><ul><li><p>相信鲁迅，拿走这个数，游戏结束。</p></li><li><p>相信鲁迅，放弃这个数和这个生成器，使用下一个生成器（前提是下一个生成器必须存在）。</p></li></ul><p>求使用使得期望答案最大的策略时，期望答案是多少。</p><p><del><strong>很玄学的题意和标题</strong></del></p><h3 id="思路详解："><a href="#思路详解：" class="headerlink" title="思路详解："></a>思路详解：</h3><p>其实想明白后十分简单，主要是想到这道题到底是怎样操作的。假设现在我们到了第 $i$ 的随机数生成器，第二个生成器产生的数的期望是 $Y=\frac{L_{i+1}+R_{i+1}}{2}$ 。如果第 $i$ 个生成器产生了 $X$ ，当 $X&lt;Y$ 时，我们当然放弃 $X$ 更优，反之则取出 $X$ 。</p><p>那我们将 $i$ 与 $i+1$ 扩展到 $1$ 到 $n$ 的思路。对于每一组来说，我们都这样来扩展答案，就可以得到下面的算式：</p><blockquote><p>当 $ans&lt;L_i$ 时 $ans=\frac{L_i+R_i}{2}$</p><p>当 $L_i&lt;ans&lt;R_i$ 时 $ans=\frac{ans<em>(ans-L_i)+\frac{ans+R_i}{2}</em>(R_i-ans)}{R_i-L_i}$</p><p>否则， $ans=ans$ ，当然，这步不用在代码里体现。</p></blockquote><p>明白这件事之后，还有一个需要注意的，那就是：</p><p><strong>我们在扩展答案是应该从 $N$ 到 $1$ 扩展：</strong></p><p>因为我们只有在知道了 $i+1$ 的区间之后才能知道第 $i$ 个到底取不取。</p><h2 id="Task-Two-Ac-Code："><a href="#Task-Two-Ac-Code：" class="headerlink" title="Task Two Ac Code："></a>Task Two Ac Code：</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;ctime&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iomanip&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stack&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;map&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> gh() getchar()</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> underMax(x,y) ((x)&gt;(y)?(x):(y))</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> underMin(x,y) ((x)&lt;(y)?(x):(y))</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> ll;</span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">double</span> ld;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN=<span class="number">1e6</span>+<span class="number">1</span>;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">underRead</span><span class="params">(T &amp;x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    x=<span class="number">0</span>;</span><br><span class="line">    <span class="type">char</span> ch=<span class="built_in">gh</span>(),t=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(ch&lt;<span class="string">&#x27;0&#x27;</span>||ch&gt;<span class="string">&#x27;9&#x27;</span>) t|=ch==<span class="string">&#x27;-&#x27;</span>,ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">while</span>(ch&gt;=<span class="string">&#x27;0&#x27;</span>&amp;&amp;ch&lt;=<span class="string">&#x27;9&#x27;</span>) x=(x&lt;&lt;<span class="number">3</span>)+(x&lt;&lt;<span class="number">1</span>)+(ch^<span class="number">48</span>),ch=<span class="built_in">gh</span>();</span><br><span class="line">    <span class="keyword">if</span>(t) x=-x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> n,l[MAXN],r[MAXN];</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">freopen</span>(<span class="string">&quot;pag.in&quot;</span>,<span class="string">&quot;r&quot;</span>,stdin);</span><br><span class="line">    <span class="built_in">freopen</span>(<span class="string">&quot;pag.out&quot;</span>,<span class="string">&quot;w&quot;</span>,stdout);</span><br><span class="line">    <span class="built_in">underRead</span>(n);</span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;++i) <span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>,&amp;l[i],&amp;r[i]);</span><br><span class="line">ld ans=<span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> i=n;i&gt;<span class="number">0</span>;--i)</span><br><span class="line">&#123;</span><br><span class="line"><span class="type">int</span> L=l[i],R=r[i];</span><br><span class="line"><span class="keyword">if</span>(ans&lt;L) ans=<span class="built_in">ld</span>(L+R)/<span class="number">2</span>;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span>(ans&lt;R) ans=(ans*(ans-L)+(R+ans)/<span class="number">2</span>*(R-ans))/(R-L);</span><br><span class="line"><span class="comment">// else ans=ans;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;%.5Lf&quot;</span>,ans);</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 模拟赛/比赛 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 数论 </tag>
            
            <tag> 质数 </tag>
            
            <tag> 费马小定理 </tag>
            
            <tag> 概率论 </tag>
            
            <tag> 期望 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>P1144 最短路计数</title>
      <link href="/Eternity/%E9%A2%98%E8%A7%A3/p1144/"/>
      <url>/Eternity/%E9%A2%98%E8%A7%A3/p1144/</url>
      
        <content type="html"><![CDATA[<p>最短路计数</p><span id="more"></span><h3 id="题目链接："><a href="#题目链接：" class="headerlink" title="题目链接："></a>题目链接：</h3><p><a href="https://www.luogu.com.cn/problem/P1144">最短路计数</a></p><h3 id="题目概述-amp-解题思路："><a href="#题目概述-amp-解题思路：" class="headerlink" title="题目概述&amp;解题思路："></a>题目概述&amp;解题思路：</h3><p>字面意思，不多做解释。求出所有的最短路个数，对 $10^6+3$  取模。当然，如果起点到编号为 $i$ 的点不连通当然数目就为0啦。</p><p>对于简单的思路，那就是跑出最短路，再跑一遍遍历，看有多少种情况能够走到 $i$ 点，然后统计。但是这样是绝对会超时的</p><p>对于 $100%$ 的数据, $N ≦ 1000000,M ≦ 2000000$ .所以我们应该选择 <del>SPFA</del> ，啊对，就是选择SPFA，<del>有些算法死了，它还活着</del>。</p><p>我们可以用一个数组 $AnsL$ 来存储从 $1$ 号点到第 $i$ 号点的最短路个数，然后一边跑 $SPFA$ 一边修改 $AnsL$ 的值，即当我们当前从 $u$ 点跑到了 $v$ 点的话费与 $Dist_v$ 的值相同时，那么现在是一条目前找到的最短路（之后可能会存在更短路），那么就有：</p><blockquote><p>$Ans_v=Ans_u+1$</p></blockquote><p>的推导公式。</p><p>而如果我们找到了更短路，那就把当前点的计数清零。从 $u$ 点出发到的 $v$ 点的路即是最短路（目前），则传递答案为：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Dist[v]=Dist[u]+<span class="number">1</span>;</span><br><span class="line">Ans[v]=AnsL[v]=Ans[u];</span><br></pre></td></tr></table></figure><p>这就是两种传递的方式，也就是本题最关键的代码核心。</p><p>其他的注意事项则在代码里体现：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;ctime&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iomanip&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stack&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;map&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">using</span> std::cin;</span><br><span class="line"><span class="keyword">using</span> std::cout;</span><br><span class="line"><span class="type">int</span> N,M,x,y,Cnt;</span><br><span class="line"><span class="type">int</span> Dis[<span class="number">1000001</span>];</span><br><span class="line"><span class="type">bool</span> Vis[<span class="number">1000001</span>];</span><br><span class="line"><span class="type">int</span> Ans[<span class="number">1000001</span>];</span><br><span class="line"><span class="type">int</span> AnsL[<span class="number">1000001</span>];</span><br><span class="line"><span class="type">int</span> First[<span class="number">1000001</span>];</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Node</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="type">int</span> To,Next;</span><br><span class="line">&#125;Edge[<span class="number">2000001</span>];</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">SPFA</span><span class="params">(<span class="type">int</span> x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">Dis[x]=<span class="number">0</span>;</span><br><span class="line">Vis[x]=<span class="number">1</span>;</span><br><span class="line">queue&lt;<span class="type">int</span>&gt;Q;</span><br><span class="line">Q.<span class="built_in">push</span>(x);</span><br><span class="line"><span class="keyword">while</span>(!Q.<span class="built_in">empty</span>())</span><br><span class="line">&#123;</span><br><span class="line"><span class="type">int</span> u=Q.<span class="built_in">front</span>();</span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> e=First[u];e;e=Edge[e].Next)</span><br><span class="line">&#123;</span><br><span class="line"><span class="type">int</span> Now=Edge[e].To;</span><br><span class="line"><span class="keyword">if</span>(Dis[Now]&gt;Dis[u]+<span class="number">1</span>)</span><br><span class="line">&#123;</span><br><span class="line">Dis[Now]=Dis[u]+<span class="number">1</span>;</span><br><span class="line">Ans[Now]=AnsL[Now]=Ans[u]%<span class="number">100003</span>;</span><br><span class="line"><span class="keyword">if</span>(!Vis[Now])</span><br><span class="line">&#123;</span><br><span class="line">Vis[Now]=<span class="number">1</span>;</span><br><span class="line">Q.<span class="built_in">push</span>(Now);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span>(Dis[Now]==Dis[u]+<span class="number">1</span>)</span><br><span class="line">&#123;</span><br><span class="line">AnsL[Now]=(AnsL[Now]+Ans[u])%<span class="number">100003</span>;</span><br><span class="line">Ans[Now]=(Ans[Now]+Ans[u])%<span class="number">100003</span>;</span><br><span class="line"><span class="keyword">if</span>(!Vis[Now])</span><br><span class="line">&#123;</span><br><span class="line">Vis[Now]=<span class="number">1</span>;</span><br><span class="line">Q.<span class="built_in">push</span>(Now);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">Ans[u]=<span class="number">0</span>;</span><br><span class="line">Q.<span class="built_in">pop</span>();</span><br><span class="line">Vis[u]=<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="comment">//freopen(&quot;.in&quot;,&quot;r&quot;,stdin);</span></span><br><span class="line"><span class="comment">//freopen(&quot;.out&quot;,&quot;w&quot;,stdout);</span></span><br><span class="line"><span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>,&amp;N,&amp;M);</span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=M;++i)</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>,&amp;x,&amp;y);</span><br><span class="line">Edge[++Cnt].To=y;</span><br><span class="line">Edge[Cnt].Next=First[x];</span><br><span class="line">First[x]=Cnt;</span><br><span class="line">Edge[++Cnt].To=x;</span><br><span class="line">Edge[Cnt].Next=First[y];</span><br><span class="line">First[y]=Cnt;</span><br><span class="line">&#125;</span><br><span class="line">AnsL[<span class="number">1</span>]=Ans[<span class="number">1</span>]=<span class="number">1</span>;</span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=N;++i)</span><br><span class="line">&#123;</span><br><span class="line">Dis[i]=<span class="number">0x7f7f7f7f</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">SPFA</span>(<span class="number">1</span>);</span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=N;++i)</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,AnsL[i]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">5 7</span></span><br><span class="line"><span class="comment">1 2</span></span><br><span class="line"><span class="comment">1 3</span></span><br><span class="line"><span class="comment">2 4</span></span><br><span class="line"><span class="comment">3 4</span></span><br><span class="line"><span class="comment">2 3</span></span><br><span class="line"><span class="comment">4 5</span></span><br><span class="line"><span class="comment">4 5</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 题解 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 最短路 </tag>
            
            <tag> 图论 </tag>
            
            <tag> SPFA </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>线段树</title>
      <link href="/Eternity/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/OI/segment-tree/"/>
      <url>/Eternity/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/OI/segment-tree/</url>
      
        <content type="html"><![CDATA[<p>“我一步一步走向深处，寻找你的身影，又将你拉回——我们的起点”</p><span id="more"></span><p>线段树是用来维护区间权值的一种数据结构，根据同机房巨佬而言，一般需要使用线段树的题考点都不在线段树上，<del>不过线段树真滴好用</del></p><hr><h2 id="线段树的操作："><a href="#线段树的操作：" class="headerlink" title="线段树的操作："></a>线段树的操作：</h2><h2 id="Ⅰ-建树"><a href="#Ⅰ-建树" class="headerlink" title="Ⅰ.建树"></a>Ⅰ.建树</h2><p>我的习惯为使用结构体存储（就和链式前向星一样），也可以分开打：<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">SegmentTree</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="type">int</span> l,r,dat;</span><br><span class="line"><span class="comment">//int tag;</span></span><br><span class="line">&#125;Tree[N&lt;&lt;<span class="number">2</span>];</span><br></pre></td></tr></table></figure><br>一般来说，线段树的数组需要开四倍 $N$ 空间，因为他比线性结构要多一层，而开四倍一般不会爆。</p><h3 id="代码讲解："><a href="#代码讲解：" class="headerlink" title="代码讲解："></a>代码讲解：</h3><p>对于其中之一 $Tree[p]$ 中：</p><p>$l$ 表示第p个编号所表示的区域起点为原线性结构的 $A_l$ ；</p><p>$r$ 表示第p个编号所表示的区域终点为原线性结构的 $A_r$ ；</p><p>子节点保证： $l=r$ ；</p><p>$dat$ 表示该区域的一个数据，一般视题目而定，且 $dat$ 的个数也不定。</p><p>$tag$ 可有也可不有（如果是区间修改的题一般都有），表示“懒惰标记”，之后详解。</p><p>$p$ 结点的子结点为 $p<em>2$ 和 $p</em>2+1$ ，一般在代码中写为 $p&lt;&lt;1$ 和 $p&lt;&lt;1|1$ 来节约时间（因为位运算时间复杂度＜乘法复杂度）</p><h3 id="建树一般使用递归建树："><a href="#建树一般使用递归建树：" class="headerlink" title="建树一般使用递归建树："></a>建树一般使用递归建树：</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">underBuild</span><span class="params">(<span class="type">int</span> p,<span class="type">int</span> l,<span class="type">int</span> r)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Tree[p].l=l;</span><br><span class="line">    Tree[p].r=r;</span><br><span class="line">    <span class="keyword">if</span>(l==r)<span class="comment">//到达子结点</span></span><br><span class="line">    &#123;</span><br><span class="line">        Tree[p].dat=Val[l];</span><br><span class="line">        <span class="keyword">return</span> ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> mid=(l+r)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">    <span class="built_in">underBuild</span>(p&lt;&lt;<span class="number">1</span>,l,mid);</span><br><span class="line">    <span class="built_in">underBuild</span>(p&lt;&lt;<span class="number">1</span>|<span class="number">1</span>,mid+<span class="number">1</span>,r);</span><br><span class="line">    <span class="built_in">underPushUp</span>(p);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Ⅱ-查询"><a href="#Ⅱ-查询" class="headerlink" title="Ⅱ.查询"></a>Ⅱ.查询</h2><p><strong>以查询该区间权值和为例：</strong></p><p>如果该结点在需要查询的区间内，返回该点权值；</p><p>如果不在搜索子结点，如果需要的 $l$ 比该结点的 $mid$ 小，则搜索 $(l,mid)$；如果需要的 $r$ 比该结点的 $mid$ 大，则搜索$(mid+1,r)$。 </p><p>具体操作看函数：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">long</span> <span class="type">long</span> <span class="title">underQuery</span><span class="params">(<span class="type">int</span> p,<span class="type">int</span> l,<span class="type">int</span> r)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(Tree[p].l&gt;=l&amp;&amp;r&gt;=Tree[p].r)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> Tree[p].dat;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">underSpread</span>(p);<span class="comment">//区间修改的操作，之后详解</span></span><br><span class="line">    <span class="type">int</span> mid=(Tree[p].l+Tree[p].r)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">    <span class="type">long</span> <span class="type">long</span> val=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span>(l&lt;=mid)</span><br><span class="line">    &#123;</span><br><span class="line">        val+=<span class="built_in">underQuery</span>(p&lt;&lt;<span class="number">1</span>,l,r);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(mid&lt;r)</span><br><span class="line">    &#123;</span><br><span class="line">        val+=<span class="built_in">underQuery</span>(p&lt;&lt;<span class="number">1</span>|<span class="number">1</span>,l,r);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> val;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Ⅲ-单点修改"><a href="#Ⅲ-单点修改" class="headerlink" title="Ⅲ.单点修改"></a>Ⅲ.单点修改</h2><p>找到该点的编号，从下至上修改它的所有父结点直到，依然使用递归操作。</p><p><strong>$dat$ 存储该区间的区间和</strong>：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">underChange</span><span class="params">(<span class="type">int</span> p,<span class="type">int</span> v,<span class="type">int</span> k)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(Tree[p].l==v&amp;&amp;Tree[p].r==v)</span><br><span class="line">    &#123;</span><br><span class="line">        Tree[p].dat=k;<span class="comment">//到达子结点后修改dat值</span></span><br><span class="line">        <span class="keyword">return</span> ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> mid=(Tree[p].l+Tree[p].r)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span>(v&lt;=mid)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">underChange</span>(p&lt;&lt;<span class="number">1</span>,l,r,k);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(v&gt;mid)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">underChange</span>(p&lt;&lt;<span class="number">1</span>|<span class="number">1</span>,l,r,k);</span><br><span class="line">    &#125;</span><br><span class="line">    Tree[p].dat=Tree[p&lt;&lt;<span class="number">1</span>].dat+Tree[p&lt;&lt;<span class="number">1</span>|<span class="number">1</span>].dat;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Ⅳ-向上传递（pushup）"><a href="#Ⅳ-向上传递（pushup）" class="headerlink" title="Ⅳ.向上传递（pushup）"></a>Ⅳ.向上传递（pushup）</h2><p>即函数underPushUp，一般都是视题目而定。</p><p><strong>以区间和为例：</strong></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">underPushUp</span><span class="params">(<span class="type">int</span> p)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">Tree[p].dat=Tree[p&lt;&lt;<span class="number">1</span>].dat+Tree[p&lt;&lt;<span class="number">1</span>|<span class="number">1</span>].dat;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><del>似乎这个例子没什么说服力</del>，不过的确是这样的。</p><h2 id="Ⅴ-向下传递（pushdown-spread）"><a href="#Ⅴ-向下传递（pushdown-spread）" class="headerlink" title="Ⅴ.向下传递（pushdown/spread）"></a>Ⅴ.向下传递（pushdown/spread）</h2><p>只限于懒惰标记。当我们需要改变该区间中的子区间才会向下传递，这样可以优化时间，否则每一次区间修改都会花费 $O(N)$ 的时间复杂度。</p><p><strong>依然以区间和为例：</strong></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">underSpread</span><span class="params">(<span class="type">int</span> p)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(Tree[p].tag)</span><br><span class="line">    &#123;</span><br><span class="line">        Tree[p&lt;&lt;<span class="number">1</span>].dat+=Tree[p].tag*(Tree[p&lt;&lt;<span class="number">1</span>].r-Tree[p&lt;&lt;<span class="number">1</span>].l+<span class="number">1</span>);</span><br><span class="line">        Tree[p&lt;&lt;<span class="number">1</span>|<span class="number">1</span>].dat+=Tree[p].tag*(Tree[p&lt;&lt;<span class="number">1</span>|<span class="number">1</span>].r-Tree[p&lt;&lt;<span class="number">1</span>|<span class="number">1</span>].l+<span class="number">1</span>);</span><br><span class="line">        Tree[p&lt;&lt;<span class="number">1</span>].tag+=Tree[p].tag;</span><br><span class="line">        Tree[p&lt;&lt;<span class="number">1</span>|<span class="number">1</span>].tag+=Tree[p].tag;</span><br><span class="line">        Tree[p].tag=<span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Ⅵ-区间修改"><a href="#Ⅵ-区间修改" class="headerlink" title="Ⅵ.区间修改"></a>Ⅵ.区间修改</h2><p>使用懒惰标记，可以让时间复杂度降到 $O(logN)$ 。</p><p><strong>依然以区间和为例：</strong></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">underModify</span><span class="params">(<span class="type">int</span> p,<span class="type">int</span> l,<span class="type">int</span> r,<span class="type">int</span> k)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(l&lt;=Tree[p].l&amp;&amp;Tree[p].r&lt;=r)</span><br><span class="line">    &#123;</span><br><span class="line">        Tree[p].dat+=k*(Tree[p].r-Tree[p].l+<span class="number">1</span>);</span><br><span class="line">        Tree[p].tag+=k;</span><br><span class="line">        <span class="keyword">return</span> ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">underSpread</span>(p);</span><br><span class="line">    <span class="type">int</span> mid=(Tree[p].l+Tree[p].r)/<span class="number">2</span>;</span><br><span class="line">    <span class="keyword">if</span>(l&lt;=mid)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">underModify</span>(p&lt;&lt;<span class="number">1</span>,l,r,k);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(r&gt;mid)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">underModify</span>(p&lt;&lt;<span class="number">1</span>|<span class="number">1</span>,l,r,k);</span><br><span class="line">    &#125;</span><br><span class="line">    Tree[p].dat=Tree[p&lt;&lt;<span class="number">1</span>].dat+Tree[p&lt;&lt;<span class="number">1</span>|<span class="number">1</span>].dat;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="一些练习"><a href="#一些练习" class="headerlink" title="一些练习"></a>一些练习</h2><p><a href="https://www.luogu.com.cn/problem/P3372">区间修改区间查找模板题</a></p><p><a href="https://www.luogu.com.cn/problem/P4513">区间最大子段和模板题</a></p><p><a href="https://www.luogu.com.cn/problem/P2574">P2574 XOR的艺术</a></p><p><a href="https://www.luogu.com.cn/problem/P6327">区间求sin和，需要使用数学知识</a></p><p><a href="https://www.luogu.com.cn/problem/P5648">卡常卡码风的毒瘤题</a></p><p>头图来源：<br><a href="https://space.bilibili.com/53456/?spm_id_from=333.999.0.0">Warma</a></p>]]></content>
      
      
      <categories>
          
          <category> 学习笔记 </category>
          
          <category> OI </category>
          
      </categories>
      
      
        <tags>
            
            <tag> RMQ </tag>
            
            <tag> 数据结构 </tag>
            
            <tag> 线段树 </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
